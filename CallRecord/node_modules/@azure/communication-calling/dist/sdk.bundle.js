// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the Microsoft Software License Terms for the Azure Communications Services, Azure CPaaS, AZURE COMMUNICATION SERVICES VOICE AND VIDEO CALLING CLIENT LIBRARY
// See EULA.txt for license information.
!function(F,B){"object"==typeof exports&&"undefined"!=typeof module?B(exports,require("@azure/logger"),require("@azure/communication-common")):"function"==typeof define&&define.amd?define(["exports","@azure/logger","@azure/communication-common"],B):B((F="undefined"!=typeof globalThis?globalThis:F||self)["azure-communication-calling"]={},F.logger,F.communicationCommon)}(this,(function(F,B,G){"use strict";var W,z="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}function createCommonjsModule(F,B,G){return F(G={path:B,exports:{},require:function(F,B){return commonjsRequire(F,null==B?G.path:B)}},G.exports),G.exports}function getAugmentedNamespace(F){if(F.__esModule)return F;var B=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(F).forEach((function(G){var W=Object.getOwnPropertyDescriptor(F,G);Object.defineProperty(B,G,W.get?W:{enumerable:!0,get:function(){return F[G]}})})),B}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}
/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */!function(F){!function(B){var G="object"==typeof z?z:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),W=makeExporter(F);function makeExporter(F,B){return function(G,W){"function"!=typeof F[G]&&Object.defineProperty(F,G,{configurable:!0,writable:!0,value:W}),B&&B(G,W)}}void 0===G.Reflect?G.Reflect=F:W=makeExporter(G.Reflect,W),B(W)}((function(F){var B=Object.prototype.hasOwnProperty,G="function"==typeof Symbol,W=G&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",z=G&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",K="function"==typeof Object.create,J={__proto__:[]}instanceof Array,Q=!K&&!J,Y={create:K?function(){return MakeDictionary(Object.create(null))}:J?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:Q?function(F,G){return B.call(F,G)}:function(F,B){return B in F},get:Q?function(F,G){return B.call(F,G)?F[G]:void 0}:function(F,B){return F[B]}},$=Object.getPrototypeOf(Function),X="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,Z=X||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?CreateMapPolyfill():Map,ee=X||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?CreateSetPolyfill():Set,te=new(X||"function"!=typeof WeakMap?CreateWeakMapPolyfill():WeakMap);function decorate(F,B,G,W){if(IsUndefined(G)){if(!IsArray(F))throw new TypeError;if(!IsConstructor(B))throw new TypeError;return DecorateConstructor(F,B)}if(!IsArray(F))throw new TypeError;if(!IsObject(B))throw new TypeError;if(!IsObject(W)&&!IsUndefined(W)&&!IsNull(W))throw new TypeError;return IsNull(W)&&(W=void 0),DecorateProperty(F,B,G=ToPropertyKey(G),W)}function metadata(F,B){function decorator(G,W){if(!IsObject(G))throw new TypeError;if(!IsUndefined(W)&&!IsPropertyKey(W))throw new TypeError;OrdinaryDefineOwnMetadata(F,B,G,W)}return decorator}function defineMetadata(F,B,G,W){if(!IsObject(G))throw new TypeError;return IsUndefined(W)||(W=ToPropertyKey(W)),OrdinaryDefineOwnMetadata(F,B,G,W)}function hasMetadata(F,B,G){if(!IsObject(B))throw new TypeError;return IsUndefined(G)||(G=ToPropertyKey(G)),OrdinaryHasMetadata(F,B,G)}function hasOwnMetadata(F,B,G){if(!IsObject(B))throw new TypeError;return IsUndefined(G)||(G=ToPropertyKey(G)),OrdinaryHasOwnMetadata(F,B,G)}function getMetadata(F,B,G){if(!IsObject(B))throw new TypeError;return IsUndefined(G)||(G=ToPropertyKey(G)),OrdinaryGetMetadata(F,B,G)}function getOwnMetadata(F,B,G){if(!IsObject(B))throw new TypeError;return IsUndefined(G)||(G=ToPropertyKey(G)),OrdinaryGetOwnMetadata(F,B,G)}function getMetadataKeys(F,B){if(!IsObject(F))throw new TypeError;return IsUndefined(B)||(B=ToPropertyKey(B)),OrdinaryMetadataKeys(F,B)}function getOwnMetadataKeys(F,B){if(!IsObject(F))throw new TypeError;return IsUndefined(B)||(B=ToPropertyKey(B)),OrdinaryOwnMetadataKeys(F,B)}function deleteMetadata(F,B,G){if(!IsObject(B))throw new TypeError;IsUndefined(G)||(G=ToPropertyKey(G));var W=GetOrCreateMetadataMap(B,G,!1);if(IsUndefined(W))return!1;if(!W.delete(F))return!1;if(W.size>0)return!0;var z=te.get(B);return z.delete(G),z.size>0||te.delete(B),!0}function DecorateConstructor(F,B){for(var G=F.length-1;G>=0;--G){var W=(0,F[G])(B);if(!IsUndefined(W)&&!IsNull(W)){if(!IsConstructor(W))throw new TypeError;B=W}}return B}function DecorateProperty(F,B,G,W){for(var z=F.length-1;z>=0;--z){var K=(0,F[z])(B,G,W);if(!IsUndefined(K)&&!IsNull(K)){if(!IsObject(K))throw new TypeError;W=K}}return W}function GetOrCreateMetadataMap(F,B,G){var W=te.get(F);if(IsUndefined(W)){if(!G)return;W=new Z,te.set(F,W)}var z=W.get(B);if(IsUndefined(z)){if(!G)return;z=new Z,W.set(B,z)}return z}function OrdinaryHasMetadata(F,B,G){if(OrdinaryHasOwnMetadata(F,B,G))return!0;var W=OrdinaryGetPrototypeOf(B);return!IsNull(W)&&OrdinaryHasMetadata(F,W,G)}function OrdinaryHasOwnMetadata(F,B,G){var W=GetOrCreateMetadataMap(B,G,!1);return!IsUndefined(W)&&ToBoolean(W.has(F))}function OrdinaryGetMetadata(F,B,G){if(OrdinaryHasOwnMetadata(F,B,G))return OrdinaryGetOwnMetadata(F,B,G);var W=OrdinaryGetPrototypeOf(B);return IsNull(W)?void 0:OrdinaryGetMetadata(F,W,G)}function OrdinaryGetOwnMetadata(F,B,G){var W=GetOrCreateMetadataMap(B,G,!1);if(!IsUndefined(W))return W.get(F)}function OrdinaryDefineOwnMetadata(F,B,G,W){GetOrCreateMetadataMap(G,W,!0).set(F,B)}function OrdinaryMetadataKeys(F,B){var G=OrdinaryOwnMetadataKeys(F,B),W=OrdinaryGetPrototypeOf(F);if(null===W)return G;var z=OrdinaryMetadataKeys(W,B);if(z.length<=0)return G;if(G.length<=0)return z;for(var K=new ee,J=[],Q=0,Y=G;Q<Y.length;Q++){var $=Y[Q];K.has($)||(K.add($),J.push($))}for(var X=0,Z=z;X<Z.length;X++){$=Z[X];K.has($)||(K.add($),J.push($))}return J}function OrdinaryOwnMetadataKeys(F,B){var G=[],W=GetOrCreateMetadataMap(F,B,!1);if(IsUndefined(W))return G;for(var z=GetIterator(W.keys()),K=0;;){var J=IteratorStep(z);if(!J)return G.length=K,G;var Q=IteratorValue(J);try{G[K]=Q}catch(F){try{IteratorClose(z)}finally{throw F}}K++}}function Type(F){if(null===F)return 1;switch(typeof F){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===F?1:6;default:return 6}}function IsUndefined(F){return void 0===F}function IsNull(F){return null===F}function IsSymbol(F){return"symbol"==typeof F}function IsObject(F){return"object"==typeof F?null!==F:"function"==typeof F}function ToPrimitive(F,B){switch(Type(F)){case 0:case 1:case 2:case 3:case 4:case 5:return F}var G=3===B?"string":5===B?"number":"default",z=GetMethod(F,W);if(void 0!==z){var K=z.call(F,G);if(IsObject(K))throw new TypeError;return K}return OrdinaryToPrimitive(F,"default"===G?"number":G)}function OrdinaryToPrimitive(F,B){if("string"===B){var G=F.toString;if(IsCallable(G))if(!IsObject(z=G.call(F)))return z;if(IsCallable(W=F.valueOf))if(!IsObject(z=W.call(F)))return z}else{var W;if(IsCallable(W=F.valueOf))if(!IsObject(z=W.call(F)))return z;var z,K=F.toString;if(IsCallable(K))if(!IsObject(z=K.call(F)))return z}throw new TypeError}function ToBoolean(F){return!!F}function ToString(F){return""+F}function ToPropertyKey(F){var B=ToPrimitive(F,3);return IsSymbol(B)?B:ToString(B)}function IsArray(F){return Array.isArray?Array.isArray(F):F instanceof Object?F instanceof Array:"[object Array]"===Object.prototype.toString.call(F)}function IsCallable(F){return"function"==typeof F}function IsConstructor(F){return"function"==typeof F}function IsPropertyKey(F){switch(Type(F)){case 3:case 4:return!0;default:return!1}}function GetMethod(F,B){var G=F[B];if(null!=G){if(!IsCallable(G))throw new TypeError;return G}}function GetIterator(F){var B=GetMethod(F,z);if(!IsCallable(B))throw new TypeError;var G=B.call(F);if(!IsObject(G))throw new TypeError;return G}function IteratorValue(F){return F.value}function IteratorStep(F){var B=F.next();return!B.done&&B}function IteratorClose(F){var B=F.return;B&&B.call(F)}function OrdinaryGetPrototypeOf(F){var B=Object.getPrototypeOf(F);if("function"!=typeof F||F===$)return B;if(B!==$)return B;var G=F.prototype,W=G&&Object.getPrototypeOf(G);if(null==W||W===Object.prototype)return B;var z=W.constructor;return"function"!=typeof z||z===F?B:z}function CreateMapPolyfill(){var F={},B=[],G=function(){function MapIterator(F,B,G){this._index=0,this._keys=F,this._values=B,this._selector=G}return MapIterator.prototype["@@iterator"]=function(){return this},MapIterator.prototype[z]=function(){return this},MapIterator.prototype.next=function(){var F=this._index;if(F>=0&&F<this._keys.length){var G=this._selector(this._keys[F],this._values[F]);return F+1>=this._keys.length?(this._index=-1,this._keys=B,this._values=B):this._index++,{value:G,done:!1}}return{value:void 0,done:!0}},MapIterator.prototype.throw=function(F){throw this._index>=0&&(this._index=-1,this._keys=B,this._values=B),F},MapIterator.prototype.return=function(F){return this._index>=0&&(this._index=-1,this._keys=B,this._values=B),{value:F,done:!0}},MapIterator}();return function(){function Map(){this._keys=[],this._values=[],this._cacheKey=F,this._cacheIndex=-2}return Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.has=function(F){return this._find(F,!1)>=0},Map.prototype.get=function(F){var B=this._find(F,!1);return B>=0?this._values[B]:void 0},Map.prototype.set=function(F,B){var G=this._find(F,!0);return this._values[G]=B,this},Map.prototype.delete=function(B){var G=this._find(B,!1);if(G>=0){for(var W=this._keys.length,z=G+1;z<W;z++)this._keys[z-1]=this._keys[z],this._values[z-1]=this._values[z];return this._keys.length--,this._values.length--,B===this._cacheKey&&(this._cacheKey=F,this._cacheIndex=-2),!0}return!1},Map.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=F,this._cacheIndex=-2},Map.prototype.keys=function(){return new G(this._keys,this._values,getKey)},Map.prototype.values=function(){return new G(this._keys,this._values,getValue)},Map.prototype.entries=function(){return new G(this._keys,this._values,getEntry)},Map.prototype["@@iterator"]=function(){return this.entries()},Map.prototype[z]=function(){return this.entries()},Map.prototype._find=function(F,B){return this._cacheKey!==F&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=F)),this._cacheIndex<0&&B&&(this._cacheIndex=this._keys.length,this._keys.push(F),this._values.push(void 0)),this._cacheIndex},Map}();function getKey(F,B){return F}function getValue(F,B){return B}function getEntry(F,B){return[F,B]}}function CreateSetPolyfill(){return function(){function Set(){this._map=new Z}return Object.defineProperty(Set.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set.prototype.has=function(F){return this._map.has(F)},Set.prototype.add=function(F){return this._map.set(F,F),this},Set.prototype.delete=function(F){return this._map.delete(F)},Set.prototype.clear=function(){this._map.clear()},Set.prototype.keys=function(){return this._map.keys()},Set.prototype.values=function(){return this._map.values()},Set.prototype.entries=function(){return this._map.entries()},Set.prototype["@@iterator"]=function(){return this.keys()},Set.prototype[z]=function(){return this.keys()},Set}()}function CreateWeakMapPolyfill(){var F=16,G=Y.create(),W=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}return WeakMap.prototype.has=function(F){var B=GetOrCreateWeakMapTable(F,!1);return void 0!==B&&Y.has(B,this._key)},WeakMap.prototype.get=function(F){var B=GetOrCreateWeakMapTable(F,!1);return void 0!==B?Y.get(B,this._key):void 0},WeakMap.prototype.set=function(F,B){return GetOrCreateWeakMapTable(F,!0)[this._key]=B,this},WeakMap.prototype.delete=function(F){var B=GetOrCreateWeakMapTable(F,!1);return void 0!==B&&delete B[this._key]},WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap}();function CreateUniqueKey(){var F;do{F="@@WeakMap@@"+CreateUUID()}while(Y.has(G,F));return G[F]=!0,F}function GetOrCreateWeakMapTable(F,G){if(!B.call(F,W)){if(!G)return;Object.defineProperty(F,W,{value:Y.create()})}return F[W]}function FillRandomBytes(F,B){for(var G=0;G<B;++G)F[G]=255*Math.random()|0;return F}function GenRandomBytes(F){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(F)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(F)):FillRandomBytes(new Uint8Array(F),F):FillRandomBytes(new Array(F),F)}function CreateUUID(){var B=GenRandomBytes(F);B[6]=79&B[6]|64,B[8]=191&B[8]|128;for(var G="",W=0;W<F;++W){var z=B[W];4!==W&&6!==W&&8!==W||(G+="-"),z<16&&(G+="0"),G+=z.toString(16).toLowerCase()}return G}}function MakeDictionary(F){return F.__=void 0,delete F.__,F}F("decorate",decorate),F("metadata",metadata),F("defineMetadata",defineMetadata),F("hasMetadata",hasMetadata),F("hasOwnMetadata",hasOwnMetadata),F("getMetadata",getMetadata),F("getOwnMetadata",getOwnMetadata),F("getMetadataKeys",getMetadataKeys),F("getOwnMetadataKeys",getOwnMetadataKeys),F("deleteMetadata",deleteMetadata)}))}(W||(W={}));var K=createCommonjsModule((function(F,B){(function(){var G,W="4.17.21",K=200,J="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",Q="Expected a function",Y="Invalid `variable` option passed into `_.template`",$="__lodash_hash_undefined__",X=500,Z="__lodash_placeholder__",ee=1,te=2,ne=4,ie=1,re=2,oe=1,ae=2,se=4,ce=8,le=16,de=32,ue=64,pe=128,he=256,ge=512,fe=30,me="...",ve=800,ye=16,Se=1,_e=2,Ce=3,Te=1/0,Ee=9007199254740991,be=17976931348623157e292,Ie=NaN,Ae=4294967295,Re=Ae-1,Pe=Ae>>>1,Oe=[["ary",pe],["bind",oe],["bindKey",ae],["curry",ce],["curryRight",le],["flip",ge],["partial",de],["partialRight",ue],["rearg",he]],Me="[object Arguments]",we="[object Array]",De="[object AsyncFunction]",Ne="[object Boolean]",Le="[object Date]",ke="[object DOMException]",Fe="[object Error]",xe="[object Function]",Ue="[object GeneratorFunction]",je="[object Map]",Be="[object Number]",He="[object Null]",Ve="[object Object]",Ge="[object Promise]",We="[object Proxy]",qe="[object RegExp]",ze="[object Set]",Ke="[object String]",Je="[object Symbol]",Qe="[object Undefined]",Ye="[object WeakMap]",$e="[object WeakSet]",Xe="[object ArrayBuffer]",Ze="[object DataView]",et="[object Float32Array]",tt="[object Float64Array]",nt="[object Int8Array]",it="[object Int16Array]",rt="[object Int32Array]",ot="[object Uint8Array]",at="[object Uint8ClampedArray]",st="[object Uint16Array]",ct="[object Uint32Array]",lt=/\b__p \+= '';/g,dt=/\b(__p \+=) '' \+/g,ut=/(__e\(.*?\)|\b__t\)) \+\n'';/g,pt=/&(?:amp|lt|gt|quot|#39);/g,ht=/[&<>"']/g,gt=RegExp(pt.source),ft=RegExp(ht.source),mt=/<%-([\s\S]+?)%>/g,vt=/<%([\s\S]+?)%>/g,yt=/<%=([\s\S]+?)%>/g,St=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,_t=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Tt=/[\\^$.*+?()[\]{}|]/g,Et=RegExp(Tt.source),bt=/^\s+/,It=/\s/,At=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Rt=/\{\n\/\* \[wrapped with (.+)\] \*/,Pt=/,? & /,Ot=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Mt=/[()=,{}\[\]\/\s]/,wt=/\\(\\)?/g,Dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Nt=/\w*$/,Lt=/^[-+]0x[0-9a-f]+$/i,kt=/^0b[01]+$/i,Ft=/^\[object .+?Constructor\]$/,xt=/^0o[0-7]+$/i,Ut=/^(?:0|[1-9]\d*)$/,jt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Bt=/($^)/,Ht=/['\n\r\u2028\u2029\\]/g,Vt="\\ud800-\\udfff",Gt="\\u0300-\\u036f"+"\\ufe20-\\ufe2f"+"\\u20d0-\\u20ff",Wt="\\u2700-\\u27bf",qt="a-z\\xdf-\\xf6\\xf8-\\xff",zt="A-Z\\xc0-\\xd6\\xd8-\\xde",Kt="\\ufe0e\\ufe0f",Jt="\\xac\\xb1\\xd7\\xf7"+"\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf"+"\\u2000-\\u206f"+" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qt="['’]",Yt="["+Vt+"]",$t="["+Jt+"]",Xt="["+Gt+"]",Zt="\\d+",en="["+Wt+"]",tn="["+qt+"]",nn="[^"+Vt+Jt+Zt+Wt+qt+zt+"]",rn="\\ud83c[\\udffb-\\udfff]",on="[^"+Vt+"]",an="(?:\\ud83c[\\udde6-\\uddff]){2}",sn="[\\ud800-\\udbff][\\udc00-\\udfff]",cn="["+zt+"]",ln="\\u200d",dn="(?:"+tn+"|"+nn+")",un="(?:"+cn+"|"+nn+")",pn="(?:"+Qt+"(?:d|ll|m|re|s|t|ve))?",hn="(?:"+Qt+"(?:D|LL|M|RE|S|T|VE))?",gn="(?:"+Xt+"|"+rn+")"+"?",fn="["+Kt+"]?",mn="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",yn=fn+gn+("(?:"+ln+"(?:"+[on,an,sn].join("|")+")"+fn+gn+")*"),Sn="(?:"+[en,an,sn].join("|")+")"+yn,_n="(?:"+[on+Xt+"?",Xt,an,sn,Yt].join("|")+")",Cn=RegExp(Qt,"g"),Tn=RegExp(Xt,"g"),En=RegExp(rn+"(?="+rn+")|"+_n+yn,"g"),bn=RegExp([cn+"?"+tn+"+"+pn+"(?="+[$t,cn,"$"].join("|")+")",un+"+"+hn+"(?="+[$t,cn+dn,"$"].join("|")+")",cn+"?"+dn+"+"+pn,cn+"+"+hn,vn,mn,Zt,Sn].join("|"),"g"),In=RegExp("["+ln+Vt+Gt+Kt+"]"),An=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Rn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Pn=-1,On={};On[et]=On[tt]=On[nt]=On[it]=On[rt]=On[ot]=On[at]=On[st]=On[ct]=!0,On[Me]=On[we]=On[Xe]=On[Ne]=On[Ze]=On[Le]=On[Fe]=On[xe]=On[je]=On[Be]=On[Ve]=On[qe]=On[ze]=On[Ke]=On[Ye]=!1;var Mn={};Mn[Me]=Mn[we]=Mn[Xe]=Mn[Ze]=Mn[Ne]=Mn[Le]=Mn[et]=Mn[tt]=Mn[nt]=Mn[it]=Mn[rt]=Mn[je]=Mn[Be]=Mn[Ve]=Mn[qe]=Mn[ze]=Mn[Ke]=Mn[Je]=Mn[ot]=Mn[at]=Mn[st]=Mn[ct]=!0,Mn[Fe]=Mn[xe]=Mn[Ye]=!1;var wn={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},Dn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Nn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ln={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},kn=parseFloat,Fn=parseInt,xn="object"==typeof z&&z&&z.Object===Object&&z,Un="object"==typeof self&&self&&self.Object===Object&&self,jn=xn||Un||Function("return this")(),Bn=B&&!B.nodeType&&B,Hn=Bn&&F&&!F.nodeType&&F,Vn=Hn&&Hn.exports===Bn,Gn=Vn&&xn.process,Wn=function(){try{var F=Hn&&Hn.require&&Hn.require("util").types;return F||Gn&&Gn.binding&&Gn.binding("util")}catch(F){}}(),qn=Wn&&Wn.isArrayBuffer,zn=Wn&&Wn.isDate,Kn=Wn&&Wn.isMap,Jn=Wn&&Wn.isRegExp,Qn=Wn&&Wn.isSet,Yn=Wn&&Wn.isTypedArray;function apply(F,B,G){switch(G.length){case 0:return F.call(B);case 1:return F.call(B,G[0]);case 2:return F.call(B,G[0],G[1]);case 3:return F.call(B,G[0],G[1],G[2])}return F.apply(B,G)}function arrayAggregator(F,B,G,W){for(var z=-1,K=null==F?0:F.length;++z<K;){var J=F[z];B(W,J,G(J),F)}return W}function arrayEach(F,B){for(var G=-1,W=null==F?0:F.length;++G<W&&!1!==B(F[G],G,F););return F}function arrayEachRight(F,B){for(var G=null==F?0:F.length;G--&&!1!==B(F[G],G,F););return F}function arrayEvery(F,B){for(var G=-1,W=null==F?0:F.length;++G<W;)if(!B(F[G],G,F))return!1;return!0}function arrayFilter(F,B){for(var G=-1,W=null==F?0:F.length,z=0,K=[];++G<W;){var J=F[G];B(J,G,F)&&(K[z++]=J)}return K}function arrayIncludes(F,B){return!!(null==F?0:F.length)&&baseIndexOf(F,B,0)>-1}function arrayIncludesWith(F,B,G){for(var W=-1,z=null==F?0:F.length;++W<z;)if(G(B,F[W]))return!0;return!1}function arrayMap(F,B){for(var G=-1,W=null==F?0:F.length,z=Array(W);++G<W;)z[G]=B(F[G],G,F);return z}function arrayPush(F,B){for(var G=-1,W=B.length,z=F.length;++G<W;)F[z+G]=B[G];return F}function arrayReduce(F,B,G,W){var z=-1,K=null==F?0:F.length;for(W&&K&&(G=F[++z]);++z<K;)G=B(G,F[z],z,F);return G}function arrayReduceRight(F,B,G,W){var z=null==F?0:F.length;for(W&&z&&(G=F[--z]);z--;)G=B(G,F[z],z,F);return G}function arraySome(F,B){for(var G=-1,W=null==F?0:F.length;++G<W;)if(B(F[G],G,F))return!0;return!1}var $n=baseProperty("length");function asciiToArray(F){return F.split("")}function asciiWords(F){return F.match(Ot)||[]}function baseFindKey(F,B,G){var W;return G(F,(function(F,G,z){if(B(F,G,z))return W=G,!1})),W}function baseFindIndex(F,B,G,W){for(var z=F.length,K=G+(W?1:-1);W?K--:++K<z;)if(B(F[K],K,F))return K;return-1}function baseIndexOf(F,B,G){return B==B?strictIndexOf(F,B,G):baseFindIndex(F,baseIsNaN,G)}function baseIndexOfWith(F,B,G,W){for(var z=G-1,K=F.length;++z<K;)if(W(F[z],B))return z;return-1}function baseIsNaN(F){return F!=F}function baseMean(F,B){var G=null==F?0:F.length;return G?baseSum(F,B)/G:Ie}function baseProperty(F){return function(B){return null==B?G:B[F]}}function basePropertyOf(F){return function(B){return null==F?G:F[B]}}function baseReduce(F,B,G,W,z){return z(F,(function(F,z,K){G=W?(W=!1,F):B(G,F,z,K)})),G}function baseSortBy(F,B){var G=F.length;for(F.sort(B);G--;)F[G]=F[G].value;return F}function baseSum(F,B){for(var W,z=-1,K=F.length;++z<K;){var J=B(F[z]);J!==G&&(W=W===G?J:W+J)}return W}function baseTimes(F,B){for(var G=-1,W=Array(F);++G<F;)W[G]=B(G);return W}function baseToPairs(F,B){return arrayMap(B,(function(B){return[B,F[B]]}))}function baseTrim(F){return F?F.slice(0,trimmedEndIndex(F)+1).replace(bt,""):F}function baseUnary(F){return function(B){return F(B)}}function baseValues(F,B){return arrayMap(B,(function(B){return F[B]}))}function cacheHas(F,B){return F.has(B)}function charsStartIndex(F,B){for(var G=-1,W=F.length;++G<W&&baseIndexOf(B,F[G],0)>-1;);return G}function charsEndIndex(F,B){for(var G=F.length;G--&&baseIndexOf(B,F[G],0)>-1;);return G}function countHolders(F,B){for(var G=F.length,W=0;G--;)F[G]===B&&++W;return W}var Xn=basePropertyOf(wn),Zn=basePropertyOf(Dn);function escapeStringChar(F){return"\\"+Ln[F]}function getValue(F,B){return null==F?G:F[B]}function hasUnicode(F){return In.test(F)}function hasUnicodeWord(F){return An.test(F)}function iteratorToArray(F){for(var B,G=[];!(B=F.next()).done;)G.push(B.value);return G}function mapToArray(F){var B=-1,G=Array(F.size);return F.forEach((function(F,W){G[++B]=[W,F]})),G}function overArg(F,B){return function(G){return F(B(G))}}function replaceHolders(F,B){for(var G=-1,W=F.length,z=0,K=[];++G<W;){var J=F[G];J!==B&&J!==Z||(F[G]=Z,K[z++]=G)}return K}function setToArray(F){var B=-1,G=Array(F.size);return F.forEach((function(F){G[++B]=F})),G}function setToPairs(F){var B=-1,G=Array(F.size);return F.forEach((function(F){G[++B]=[F,F]})),G}function strictIndexOf(F,B,G){for(var W=G-1,z=F.length;++W<z;)if(F[W]===B)return W;return-1}function strictLastIndexOf(F,B,G){for(var W=G+1;W--;)if(F[W]===B)return W;return W}function stringSize(F){return hasUnicode(F)?unicodeSize(F):$n(F)}function stringToArray(F){return hasUnicode(F)?unicodeToArray(F):asciiToArray(F)}function trimmedEndIndex(F){for(var B=F.length;B--&&It.test(F.charAt(B)););return B}var ei=basePropertyOf(Nn);function unicodeSize(F){for(var B=En.lastIndex=0;En.test(F);)++B;return B}function unicodeToArray(F){return F.match(En)||[]}function unicodeWords(F){return F.match(bn)||[]}var ti=function runInContext(F){var B,z=(F=null==F?jn:ni.defaults(jn.Object(),F,ni.pick(jn,Rn))).Array,It=F.Date,Ot=F.Error,Vt=F.Function,Gt=F.Math,Wt=F.Object,qt=F.RegExp,zt=F.String,Kt=F.TypeError,Jt=z.prototype,Qt=Vt.prototype,Yt=Wt.prototype,$t=F["__core-js_shared__"],Xt=Qt.toString,Zt=Yt.hasOwnProperty,en=0,tn=(B=/[^.]+$/.exec($t&&$t.keys&&$t.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"",nn=Yt.toString,rn=Xt.call(Wt),on=jn._,an=qt("^"+Xt.call(Zt).replace(Tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),sn=Vn?F.Buffer:G,cn=F.Symbol,ln=F.Uint8Array,dn=sn?sn.allocUnsafe:G,un=overArg(Wt.getPrototypeOf,Wt),pn=Wt.create,hn=Yt.propertyIsEnumerable,gn=Jt.splice,fn=cn?cn.isConcatSpreadable:G,mn=cn?cn.iterator:G,vn=cn?cn.toStringTag:G,yn=function(){try{var F=getNative(Wt,"defineProperty");return F({},"",{}),F}catch(F){}}(),Sn=F.clearTimeout!==jn.clearTimeout&&F.clearTimeout,_n=It&&It.now!==jn.Date.now&&It.now,En=F.setTimeout!==jn.setTimeout&&F.setTimeout,bn=Gt.ceil,In=Gt.floor,An=Wt.getOwnPropertySymbols,wn=sn?sn.isBuffer:G,Dn=F.isFinite,Nn=Jt.join,Ln=overArg(Wt.keys,Wt),xn=Gt.max,Un=Gt.min,Bn=It.now,Hn=F.parseInt,Gn=Gt.random,Wn=Jt.reverse,$n=getNative(F,"DataView"),ti=getNative(F,"Map"),ii=getNative(F,"Promise"),ri=getNative(F,"Set"),oi=getNative(F,"WeakMap"),ai=getNative(Wt,"create"),si=oi&&new oi,ci={},li=toSource($n),di=toSource(ti),ui=toSource(ii),pi=toSource(ri),hi=toSource(oi),gi=cn?cn.prototype:G,fi=gi?gi.valueOf:G,mi=gi?gi.toString:G;function lodash(F){if(isObjectLike(F)&&!_r(F)&&!(F instanceof LazyWrapper)){if(F instanceof LodashWrapper)return F;if(Zt.call(F,"__wrapped__"))return wrapperClone(F)}return new LodashWrapper(F)}var vi=function(){function object(){}return function(F){if(!isObject(F))return{};if(pn)return pn(F);object.prototype=F;var B=new object;return object.prototype=G,B}}();function baseLodash(){}function LodashWrapper(F,B){this.__wrapped__=F,this.__actions__=[],this.__chain__=!!B,this.__index__=0,this.__values__=G}function LazyWrapper(F){this.__wrapped__=F,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ae,this.__views__=[]}function lazyClone(){var F=new LazyWrapper(this.__wrapped__);return F.__actions__=copyArray(this.__actions__),F.__dir__=this.__dir__,F.__filtered__=this.__filtered__,F.__iteratees__=copyArray(this.__iteratees__),F.__takeCount__=this.__takeCount__,F.__views__=copyArray(this.__views__),F}function lazyReverse(){if(this.__filtered__){var F=new LazyWrapper(this);F.__dir__=-1,F.__filtered__=!0}else(F=this.clone()).__dir__*=-1;return F}function lazyValue(){var F=this.__wrapped__.value(),B=this.__dir__,G=_r(F),W=B<0,z=G?F.length:0,K=getView(0,z,this.__views__),J=K.start,Q=K.end,Y=Q-J,$=W?Q:J-1,X=this.__iteratees__,Z=X.length,ee=0,te=Un(Y,this.__takeCount__);if(!G||!W&&z==Y&&te==Y)return baseWrapperValue(F,this.__actions__);var ne=[];e:for(;Y--&&ee<te;){for(var ie=-1,re=F[$+=B];++ie<Z;){var oe=X[ie],ae=oe.iteratee,se=oe.type,ce=ae(re);if(se==_e)re=ce;else if(!ce){if(se==Se)continue e;break e}}ne[ee++]=re}return ne}function Hash(F){var B=-1,G=null==F?0:F.length;for(this.clear();++B<G;){var W=F[B];this.set(W[0],W[1])}}function hashClear(){this.__data__=ai?ai(null):{},this.size=0}function hashDelete(F){var B=this.has(F)&&delete this.__data__[F];return this.size-=B?1:0,B}function hashGet(F){var B=this.__data__;if(ai){var W=B[F];return W===$?G:W}return Zt.call(B,F)?B[F]:G}function hashHas(F){var B=this.__data__;return ai?B[F]!==G:Zt.call(B,F)}function hashSet(F,B){var W=this.__data__;return this.size+=this.has(F)?0:1,W[F]=ai&&B===G?$:B,this}function ListCache(F){var B=-1,G=null==F?0:F.length;for(this.clear();++B<G;){var W=F[B];this.set(W[0],W[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(F){var B=this.__data__,G=assocIndexOf(B,F);return!(G<0)&&(G==B.length-1?B.pop():gn.call(B,G,1),--this.size,!0)}function listCacheGet(F){var B=this.__data__,W=assocIndexOf(B,F);return W<0?G:B[W][1]}function listCacheHas(F){return assocIndexOf(this.__data__,F)>-1}function listCacheSet(F,B){var G=this.__data__,W=assocIndexOf(G,F);return W<0?(++this.size,G.push([F,B])):G[W][1]=B,this}function MapCache(F){var B=-1,G=null==F?0:F.length;for(this.clear();++B<G;){var W=F[B];this.set(W[0],W[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(ti||ListCache),string:new Hash}}function mapCacheDelete(F){var B=getMapData(this,F).delete(F);return this.size-=B?1:0,B}function mapCacheGet(F){return getMapData(this,F).get(F)}function mapCacheHas(F){return getMapData(this,F).has(F)}function mapCacheSet(F,B){var G=getMapData(this,F),W=G.size;return G.set(F,B),this.size+=G.size==W?0:1,this}function SetCache(F){var B=-1,G=null==F?0:F.length;for(this.__data__=new MapCache;++B<G;)this.add(F[B])}function setCacheAdd(F){return this.__data__.set(F,$),this}function setCacheHas(F){return this.__data__.has(F)}function Stack(F){var B=this.__data__=new ListCache(F);this.size=B.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(F){var B=this.__data__,G=B.delete(F);return this.size=B.size,G}function stackGet(F){return this.__data__.get(F)}function stackHas(F){return this.__data__.has(F)}function stackSet(F,B){var G=this.__data__;if(G instanceof ListCache){var W=G.__data__;if(!ti||W.length<K-1)return W.push([F,B]),this.size=++G.size,this;G=this.__data__=new MapCache(W)}return G.set(F,B),this.size=G.size,this}function arrayLikeKeys(F,B){var G=_r(F),W=!G&&Sr(F),z=!G&&!W&&Tr(F),K=!G&&!W&&!z&&Rr(F),J=G||W||z||K,Q=J?baseTimes(F.length,zt):[],Y=Q.length;for(var $ in F)!B&&!Zt.call(F,$)||J&&("length"==$||z&&("offset"==$||"parent"==$)||K&&("buffer"==$||"byteLength"==$||"byteOffset"==$)||isIndex($,Y))||Q.push($);return Q}function arraySample(F){var B=F.length;return B?F[baseRandom(0,B-1)]:G}function arraySampleSize(F,B){return shuffleSelf(copyArray(F),baseClamp(B,0,F.length))}function arrayShuffle(F){return shuffleSelf(copyArray(F))}function assignMergeValue(F,B,W){(W!==G&&!eq(F[B],W)||W===G&&!(B in F))&&baseAssignValue(F,B,W)}function assignValue(F,B,W){var z=F[B];Zt.call(F,B)&&eq(z,W)&&(W!==G||B in F)||baseAssignValue(F,B,W)}function assocIndexOf(F,B){for(var G=F.length;G--;)if(eq(F[G][0],B))return G;return-1}function baseAggregator(F,B,G,W){return yi(F,(function(F,z,K){B(W,F,G(F),K)})),W}function baseAssign(F,B){return F&&copyObject(B,keys(B),F)}function baseAssignIn(F,B){return F&&copyObject(B,keysIn(B),F)}function baseAssignValue(F,B,G){"__proto__"==B&&yn?yn(F,B,{configurable:!0,enumerable:!0,value:G,writable:!0}):F[B]=G}function baseAt(F,B){for(var W=-1,K=B.length,J=z(K),Q=null==F;++W<K;)J[W]=Q?G:get(F,B[W]);return J}function baseClamp(F,B,W){return F==F&&(W!==G&&(F=F<=W?F:W),B!==G&&(F=F>=B?F:B)),F}function baseClone(F,B,W,z,K,J){var Q,Y=B&ee,$=B&te,X=B&ne;if(W&&(Q=K?W(F,z,K,J):W(F)),Q!==G)return Q;if(!isObject(F))return F;var Z=_r(F);if(Z){if(Q=initCloneArray(F),!Y)return copyArray(F,Q)}else{var ie=Mi(F),re=ie==xe||ie==Ue;if(Tr(F))return cloneBuffer(F,Y);if(ie==Ve||ie==Me||re&&!K){if(Q=$||re?{}:initCloneObject(F),!Y)return $?copySymbolsIn(F,baseAssignIn(Q,F)):copySymbols(F,baseAssign(Q,F))}else{if(!Mn[ie])return K?F:{};Q=initCloneByTag(F,ie,Y)}}J||(J=new Stack);var oe=J.get(F);if(oe)return oe;J.set(F,Q),Ar(F)?F.forEach((function(G){Q.add(baseClone(G,B,W,G,F,J))})):br(F)&&F.forEach((function(G,z){Q.set(z,baseClone(G,B,W,z,F,J))}));var ae=Z?G:(X?$?getAllKeysIn:getAllKeys:$?keysIn:keys)(F);return arrayEach(ae||F,(function(G,z){ae&&(G=F[z=G]),assignValue(Q,z,baseClone(G,B,W,z,F,J))})),Q}function baseConforms(F){var B=keys(F);return function(G){return baseConformsTo(G,F,B)}}function baseConformsTo(F,B,W){var z=W.length;if(null==F)return!z;for(F=Wt(F);z--;){var K=W[z],J=B[K],Q=F[K];if(Q===G&&!(K in F)||!J(Q))return!1}return!0}function baseDelay(F,B,W){if("function"!=typeof F)throw new Kt(Q);return Ni((function(){F.apply(G,W)}),B)}function baseDifference(F,B,G,W){var z=-1,J=arrayIncludes,Q=!0,Y=F.length,$=[],X=B.length;if(!Y)return $;G&&(B=arrayMap(B,baseUnary(G))),W?(J=arrayIncludesWith,Q=!1):B.length>=K&&(J=cacheHas,Q=!1,B=new SetCache(B));e:for(;++z<Y;){var Z=F[z],ee=null==G?Z:G(Z);if(Z=W||0!==Z?Z:0,Q&&ee==ee){for(var te=X;te--;)if(B[te]===ee)continue e;$.push(Z)}else J(B,ee,W)||$.push(Z)}return $}lodash.templateSettings={escape:mt,evaluate:vt,interpolate:yt,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=vi(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=vi(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var yi=createBaseEach(baseForOwn),Si=createBaseEach(baseForOwnRight,!0);function baseEvery(F,B){var G=!0;return yi(F,(function(F,W,z){return G=!!B(F,W,z)})),G}function baseExtremum(F,B,W){for(var z=-1,K=F.length;++z<K;){var J=F[z],Q=B(J);if(null!=Q&&(Y===G?Q==Q&&!isSymbol(Q):W(Q,Y)))var Y=Q,$=J}return $}function baseFill(F,B,W,z){var K=F.length;for((W=toInteger(W))<0&&(W=-W>K?0:K+W),(z=z===G||z>K?K:toInteger(z))<0&&(z+=K),z=W>z?0:toLength(z);W<z;)F[W++]=B;return F}function baseFilter(F,B){var G=[];return yi(F,(function(F,W,z){B(F,W,z)&&G.push(F)})),G}function baseFlatten(F,B,G,W,z){var K=-1,J=F.length;for(G||(G=isFlattenable),z||(z=[]);++K<J;){var Q=F[K];B>0&&G(Q)?B>1?baseFlatten(Q,B-1,G,W,z):arrayPush(z,Q):W||(z[z.length]=Q)}return z}var _i=createBaseFor(),Ci=createBaseFor(!0);function baseForOwn(F,B){return F&&_i(F,B,keys)}function baseForOwnRight(F,B){return F&&Ci(F,B,keys)}function baseFunctions(F,B){return arrayFilter(B,(function(B){return isFunction(F[B])}))}function baseGet(F,B){for(var W=0,z=(B=castPath(B,F)).length;null!=F&&W<z;)F=F[toKey(B[W++])];return W&&W==z?F:G}function baseGetAllKeys(F,B,G){var W=B(F);return _r(F)?W:arrayPush(W,G(F))}function baseGetTag(F){return null==F?F===G?Qe:He:vn&&vn in Wt(F)?getRawTag(F):objectToString(F)}function baseGt(F,B){return F>B}function baseHas(F,B){return null!=F&&Zt.call(F,B)}function baseHasIn(F,B){return null!=F&&B in Wt(F)}function baseInRange(F,B,G){return F>=Un(B,G)&&F<xn(B,G)}function baseIntersection(F,B,W){for(var K=W?arrayIncludesWith:arrayIncludes,J=F[0].length,Q=F.length,Y=Q,$=z(Q),X=1/0,Z=[];Y--;){var ee=F[Y];Y&&B&&(ee=arrayMap(ee,baseUnary(B))),X=Un(ee.length,X),$[Y]=!W&&(B||J>=120&&ee.length>=120)?new SetCache(Y&&ee):G}ee=F[0];var te=-1,ne=$[0];e:for(;++te<J&&Z.length<X;){var ie=ee[te],re=B?B(ie):ie;if(ie=W||0!==ie?ie:0,!(ne?cacheHas(ne,re):K(Z,re,W))){for(Y=Q;--Y;){var oe=$[Y];if(!(oe?cacheHas(oe,re):K(F[Y],re,W)))continue e}ne&&ne.push(re),Z.push(ie)}}return Z}function baseInverter(F,B,G,W){return baseForOwn(F,(function(F,z,K){B(W,G(F),z,K)})),W}function baseInvoke(F,B,W){var z=null==(F=parent(F,B=castPath(B,F)))?F:F[toKey(last(B))];return null==z?G:apply(z,F,W)}function baseIsArguments(F){return isObjectLike(F)&&baseGetTag(F)==Me}function baseIsArrayBuffer(F){return isObjectLike(F)&&baseGetTag(F)==Xe}function baseIsDate(F){return isObjectLike(F)&&baseGetTag(F)==Le}function baseIsEqual(F,B,G,W,z){return F===B||(null==F||null==B||!isObjectLike(F)&&!isObjectLike(B)?F!=F&&B!=B:baseIsEqualDeep(F,B,G,W,baseIsEqual,z))}function baseIsEqualDeep(F,B,G,W,z,K){var J=_r(F),Q=_r(B),Y=J?we:Mi(F),$=Q?we:Mi(B),X=(Y=Y==Me?Ve:Y)==Ve,Z=($=$==Me?Ve:$)==Ve,ee=Y==$;if(ee&&Tr(F)){if(!Tr(B))return!1;J=!0,X=!1}if(ee&&!X)return K||(K=new Stack),J||Rr(F)?equalArrays(F,B,G,W,z,K):equalByTag(F,B,Y,G,W,z,K);if(!(G&ie)){var te=X&&Zt.call(F,"__wrapped__"),ne=Z&&Zt.call(B,"__wrapped__");if(te||ne){var re=te?F.value():F,oe=ne?B.value():B;return K||(K=new Stack),z(re,oe,G,W,K)}}return!!ee&&(K||(K=new Stack),equalObjects(F,B,G,W,z,K))}function baseIsMap(F){return isObjectLike(F)&&Mi(F)==je}function baseIsMatch(F,B,W,z){var K=W.length,J=K,Q=!z;if(null==F)return!J;for(F=Wt(F);K--;){var Y=W[K];if(Q&&Y[2]?Y[1]!==F[Y[0]]:!(Y[0]in F))return!1}for(;++K<J;){var $=(Y=W[K])[0],X=F[$],Z=Y[1];if(Q&&Y[2]){if(X===G&&!($ in F))return!1}else{var ee=new Stack;if(z)var te=z(X,Z,$,F,B,ee);if(!(te===G?baseIsEqual(Z,X,ie|re,z,ee):te))return!1}}return!0}function baseIsNative(F){return!(!isObject(F)||isMasked(F))&&(isFunction(F)?an:Ft).test(toSource(F))}function baseIsRegExp(F){return isObjectLike(F)&&baseGetTag(F)==qe}function baseIsSet(F){return isObjectLike(F)&&Mi(F)==ze}function baseIsTypedArray(F){return isObjectLike(F)&&isLength(F.length)&&!!On[baseGetTag(F)]}function baseIteratee(F){return"function"==typeof F?F:null==F?identity:"object"==typeof F?_r(F)?baseMatchesProperty(F[0],F[1]):baseMatches(F):property(F)}function baseKeys(F){if(!isPrototype(F))return Ln(F);var B=[];for(var G in Wt(F))Zt.call(F,G)&&"constructor"!=G&&B.push(G);return B}function baseKeysIn(F){if(!isObject(F))return nativeKeysIn(F);var B=isPrototype(F),G=[];for(var W in F)("constructor"!=W||!B&&Zt.call(F,W))&&G.push(W);return G}function baseLt(F,B){return F<B}function baseMap(F,B){var G=-1,W=isArrayLike(F)?z(F.length):[];return yi(F,(function(F,z,K){W[++G]=B(F,z,K)})),W}function baseMatches(F){var B=getMatchData(F);return 1==B.length&&B[0][2]?matchesStrictComparable(B[0][0],B[0][1]):function(G){return G===F||baseIsMatch(G,F,B)}}function baseMatchesProperty(F,B){return isKey(F)&&isStrictComparable(B)?matchesStrictComparable(toKey(F),B):function(W){var z=get(W,F);return z===G&&z===B?hasIn(W,F):baseIsEqual(B,z,ie|re)}}function baseMerge(F,B,W,z,K){F!==B&&_i(B,(function(J,Q){if(K||(K=new Stack),isObject(J))baseMergeDeep(F,B,Q,W,baseMerge,z,K);else{var Y=z?z(safeGet(F,Q),J,Q+"",F,B,K):G;Y===G&&(Y=J),assignMergeValue(F,Q,Y)}}),keysIn)}function baseMergeDeep(F,B,W,z,K,J,Q){var Y=safeGet(F,W),$=safeGet(B,W),X=Q.get($);if(X)assignMergeValue(F,W,X);else{var Z=J?J(Y,$,W+"",F,B,Q):G,ee=Z===G;if(ee){var te=_r($),ne=!te&&Tr($),ie=!te&&!ne&&Rr($);Z=$,te||ne||ie?_r(Y)?Z=Y:isArrayLikeObject(Y)?Z=copyArray(Y):ne?(ee=!1,Z=cloneBuffer($,!0)):ie?(ee=!1,Z=cloneTypedArray($,!0)):Z=[]:isPlainObject($)||Sr($)?(Z=Y,Sr(Y)?Z=toPlainObject(Y):isObject(Y)&&!isFunction(Y)||(Z=initCloneObject($))):ee=!1}ee&&(Q.set($,Z),K(Z,$,z,J,Q),Q.delete($)),assignMergeValue(F,W,Z)}}function baseNth(F,B){var W=F.length;if(W)return isIndex(B+=B<0?W:0,W)?F[B]:G}function baseOrderBy(F,B,G){B=B.length?arrayMap(B,(function(F){return _r(F)?function(B){return baseGet(B,1===F.length?F[0]:F)}:F})):[identity];var W=-1;B=arrayMap(B,baseUnary(getIteratee()));var z=baseMap(F,(function(F,G,z){var K=arrayMap(B,(function(B){return B(F)}));return{criteria:K,index:++W,value:F}}));return baseSortBy(z,(function(F,B){return compareMultiple(F,B,G)}))}function basePick(F,B){return basePickBy(F,B,(function(B,G){return hasIn(F,G)}))}function basePickBy(F,B,G){for(var W=-1,z=B.length,K={};++W<z;){var J=B[W],Q=baseGet(F,J);G(Q,J)&&baseSet(K,castPath(J,F),Q)}return K}function basePropertyDeep(F){return function(B){return baseGet(B,F)}}function basePullAll(F,B,G,W){var z=W?baseIndexOfWith:baseIndexOf,K=-1,J=B.length,Q=F;for(F===B&&(B=copyArray(B)),G&&(Q=arrayMap(F,baseUnary(G)));++K<J;)for(var Y=0,$=B[K],X=G?G($):$;(Y=z(Q,X,Y,W))>-1;)Q!==F&&gn.call(Q,Y,1),gn.call(F,Y,1);return F}function basePullAt(F,B){for(var G=F?B.length:0,W=G-1;G--;){var z=B[G];if(G==W||z!==K){var K=z;isIndex(z)?gn.call(F,z,1):baseUnset(F,z)}}return F}function baseRandom(F,B){return F+In(Gn()*(B-F+1))}function baseRange(F,B,G,W){for(var K=-1,J=xn(bn((B-F)/(G||1)),0),Q=z(J);J--;)Q[W?J:++K]=F,F+=G;return Q}function baseRepeat(F,B){var G="";if(!F||B<1||B>Ee)return G;do{B%2&&(G+=F),(B=In(B/2))&&(F+=F)}while(B);return G}function baseRest(F,B){return Li(overRest(F,B,identity),F+"")}function baseSample(F){return arraySample(values(F))}function baseSampleSize(F,B){var G=values(F);return shuffleSelf(G,baseClamp(B,0,G.length))}function baseSet(F,B,W,z){if(!isObject(F))return F;for(var K=-1,J=(B=castPath(B,F)).length,Q=J-1,Y=F;null!=Y&&++K<J;){var $=toKey(B[K]),X=W;if("__proto__"===$||"constructor"===$||"prototype"===$)return F;if(K!=Q){var Z=Y[$];(X=z?z(Z,$,Y):G)===G&&(X=isObject(Z)?Z:isIndex(B[K+1])?[]:{})}assignValue(Y,$,X),Y=Y[$]}return F}var Ti=si?function(F,B){return si.set(F,B),F}:identity,Ei=yn?function(F,B){return yn(F,"toString",{configurable:!0,enumerable:!1,value:constant(B),writable:!0})}:identity;function baseShuffle(F){return shuffleSelf(values(F))}function baseSlice(F,B,G){var W=-1,K=F.length;B<0&&(B=-B>K?0:K+B),(G=G>K?K:G)<0&&(G+=K),K=B>G?0:G-B>>>0,B>>>=0;for(var J=z(K);++W<K;)J[W]=F[W+B];return J}function baseSome(F,B){var G;return yi(F,(function(F,W,z){return!(G=B(F,W,z))})),!!G}function baseSortedIndex(F,B,G){var W=0,z=null==F?W:F.length;if("number"==typeof B&&B==B&&z<=Pe){for(;W<z;){var K=W+z>>>1,J=F[K];null!==J&&!isSymbol(J)&&(G?J<=B:J<B)?W=K+1:z=K}return z}return baseSortedIndexBy(F,B,identity,G)}function baseSortedIndexBy(F,B,W,z){var K=0,J=null==F?0:F.length;if(0===J)return 0;for(var Q=(B=W(B))!=B,Y=null===B,$=isSymbol(B),X=B===G;K<J;){var Z=In((K+J)/2),ee=W(F[Z]),te=ee!==G,ne=null===ee,ie=ee==ee,re=isSymbol(ee);if(Q)var oe=z||ie;else oe=X?ie&&(z||te):Y?ie&&te&&(z||!ne):$?ie&&te&&!ne&&(z||!re):!ne&&!re&&(z?ee<=B:ee<B);oe?K=Z+1:J=Z}return Un(J,Re)}function baseSortedUniq(F,B){for(var G=-1,W=F.length,z=0,K=[];++G<W;){var J=F[G],Q=B?B(J):J;if(!G||!eq(Q,Y)){var Y=Q;K[z++]=0===J?0:J}}return K}function baseToNumber(F){return"number"==typeof F?F:isSymbol(F)?Ie:+F}function baseToString(F){if("string"==typeof F)return F;if(_r(F))return arrayMap(F,baseToString)+"";if(isSymbol(F))return mi?mi.call(F):"";var B=F+"";return"0"==B&&1/F==-Te?"-0":B}function baseUniq(F,B,G){var W=-1,z=arrayIncludes,J=F.length,Q=!0,Y=[],$=Y;if(G)Q=!1,z=arrayIncludesWith;else if(J>=K){var X=B?null:Ai(F);if(X)return setToArray(X);Q=!1,z=cacheHas,$=new SetCache}else $=B?[]:Y;e:for(;++W<J;){var Z=F[W],ee=B?B(Z):Z;if(Z=G||0!==Z?Z:0,Q&&ee==ee){for(var te=$.length;te--;)if($[te]===ee)continue e;B&&$.push(ee),Y.push(Z)}else z($,ee,G)||($!==Y&&$.push(ee),Y.push(Z))}return Y}function baseUnset(F,B){return null==(F=parent(F,B=castPath(B,F)))||delete F[toKey(last(B))]}function baseUpdate(F,B,G,W){return baseSet(F,B,G(baseGet(F,B)),W)}function baseWhile(F,B,G,W){for(var z=F.length,K=W?z:-1;(W?K--:++K<z)&&B(F[K],K,F););return G?baseSlice(F,W?0:K,W?K+1:z):baseSlice(F,W?K+1:0,W?z:K)}function baseWrapperValue(F,B){var G=F;return G instanceof LazyWrapper&&(G=G.value()),arrayReduce(B,(function(F,B){return B.func.apply(B.thisArg,arrayPush([F],B.args))}),G)}function baseXor(F,B,G){var W=F.length;if(W<2)return W?baseUniq(F[0]):[];for(var K=-1,J=z(W);++K<W;)for(var Q=F[K],Y=-1;++Y<W;)Y!=K&&(J[K]=baseDifference(J[K]||Q,F[Y],B,G));return baseUniq(baseFlatten(J,1),B,G)}function baseZipObject(F,B,W){for(var z=-1,K=F.length,J=B.length,Q={};++z<K;){var Y=z<J?B[z]:G;W(Q,F[z],Y)}return Q}function castArrayLikeObject(F){return isArrayLikeObject(F)?F:[]}function castFunction(F){return"function"==typeof F?F:identity}function castPath(F,B){return _r(F)?F:isKey(F,B)?[F]:ki(toString(F))}var bi=baseRest;function castSlice(F,B,W){var z=F.length;return W=W===G?z:W,!B&&W>=z?F:baseSlice(F,B,W)}var Ii=Sn||function(F){return jn.clearTimeout(F)};function cloneBuffer(F,B){if(B)return F.slice();var G=F.length,W=dn?dn(G):new F.constructor(G);return F.copy(W),W}function cloneArrayBuffer(F){var B=new F.constructor(F.byteLength);return new ln(B).set(new ln(F)),B}function cloneDataView(F,B){var G=B?cloneArrayBuffer(F.buffer):F.buffer;return new F.constructor(G,F.byteOffset,F.byteLength)}function cloneRegExp(F){var B=new F.constructor(F.source,Nt.exec(F));return B.lastIndex=F.lastIndex,B}function cloneSymbol(F){return fi?Wt(fi.call(F)):{}}function cloneTypedArray(F,B){var G=B?cloneArrayBuffer(F.buffer):F.buffer;return new F.constructor(G,F.byteOffset,F.length)}function compareAscending(F,B){if(F!==B){var W=F!==G,z=null===F,K=F==F,J=isSymbol(F),Q=B!==G,Y=null===B,$=B==B,X=isSymbol(B);if(!Y&&!X&&!J&&F>B||J&&Q&&$&&!Y&&!X||z&&Q&&$||!W&&$||!K)return 1;if(!z&&!J&&!X&&F<B||X&&W&&K&&!z&&!J||Y&&W&&K||!Q&&K||!$)return-1}return 0}function compareMultiple(F,B,G){for(var W=-1,z=F.criteria,K=B.criteria,J=z.length,Q=G.length;++W<J;){var Y=compareAscending(z[W],K[W]);if(Y)return W>=Q?Y:Y*("desc"==G[W]?-1:1)}return F.index-B.index}function composeArgs(F,B,G,W){for(var K=-1,J=F.length,Q=G.length,Y=-1,$=B.length,X=xn(J-Q,0),Z=z($+X),ee=!W;++Y<$;)Z[Y]=B[Y];for(;++K<Q;)(ee||K<J)&&(Z[G[K]]=F[K]);for(;X--;)Z[Y++]=F[K++];return Z}function composeArgsRight(F,B,G,W){for(var K=-1,J=F.length,Q=-1,Y=G.length,$=-1,X=B.length,Z=xn(J-Y,0),ee=z(Z+X),te=!W;++K<Z;)ee[K]=F[K];for(var ne=K;++$<X;)ee[ne+$]=B[$];for(;++Q<Y;)(te||K<J)&&(ee[ne+G[Q]]=F[K++]);return ee}function copyArray(F,B){var G=-1,W=F.length;for(B||(B=z(W));++G<W;)B[G]=F[G];return B}function copyObject(F,B,W,z){var K=!W;W||(W={});for(var J=-1,Q=B.length;++J<Q;){var Y=B[J],$=z?z(W[Y],F[Y],Y,W,F):G;$===G&&($=F[Y]),K?baseAssignValue(W,Y,$):assignValue(W,Y,$)}return W}function copySymbols(F,B){return copyObject(F,Pi(F),B)}function copySymbolsIn(F,B){return copyObject(F,Oi(F),B)}function createAggregator(F,B){return function(G,W){var z=_r(G)?arrayAggregator:baseAggregator,K=B?B():{};return z(G,F,getIteratee(W,2),K)}}function createAssigner(F){return baseRest((function(B,W){var z=-1,K=W.length,J=K>1?W[K-1]:G,Q=K>2?W[2]:G;for(J=F.length>3&&"function"==typeof J?(K--,J):G,Q&&isIterateeCall(W[0],W[1],Q)&&(J=K<3?G:J,K=1),B=Wt(B);++z<K;){var Y=W[z];Y&&F(B,Y,z,J)}return B}))}function createBaseEach(F,B){return function(G,W){if(null==G)return G;if(!isArrayLike(G))return F(G,W);for(var z=G.length,K=B?z:-1,J=Wt(G);(B?K--:++K<z)&&!1!==W(J[K],K,J););return G}}function createBaseFor(F){return function(B,G,W){for(var z=-1,K=Wt(B),J=W(B),Q=J.length;Q--;){var Y=J[F?Q:++z];if(!1===G(K[Y],Y,K))break}return B}}function createBind(F,B,G){var W=B&oe,z=createCtor(F);function wrapper(){return(this&&this!==jn&&this instanceof wrapper?z:F).apply(W?G:this,arguments)}return wrapper}function createCaseFirst(F){return function(B){var W=hasUnicode(B=toString(B))?stringToArray(B):G,z=W?W[0]:B.charAt(0),K=W?castSlice(W,1).join(""):B.slice(1);return z[F]()+K}}function createCompounder(F){return function(B){return arrayReduce(words(deburr(B).replace(Cn,"")),F,"")}}function createCtor(F){return function(){var B=arguments;switch(B.length){case 0:return new F;case 1:return new F(B[0]);case 2:return new F(B[0],B[1]);case 3:return new F(B[0],B[1],B[2]);case 4:return new F(B[0],B[1],B[2],B[3]);case 5:return new F(B[0],B[1],B[2],B[3],B[4]);case 6:return new F(B[0],B[1],B[2],B[3],B[4],B[5]);case 7:return new F(B[0],B[1],B[2],B[3],B[4],B[5],B[6])}var G=vi(F.prototype),W=F.apply(G,B);return isObject(W)?W:G}}function createCurry(F,B,W){var K=createCtor(F);function wrapper(){for(var J=arguments.length,Q=z(J),Y=J,$=getHolder(wrapper);Y--;)Q[Y]=arguments[Y];var X=J<3&&Q[0]!==$&&Q[J-1]!==$?[]:replaceHolders(Q,$);return(J-=X.length)<W?createRecurry(F,B,createHybrid,wrapper.placeholder,G,Q,X,G,G,W-J):apply(this&&this!==jn&&this instanceof wrapper?K:F,this,Q)}return wrapper}function createFind(F){return function(B,W,z){var K=Wt(B);if(!isArrayLike(B)){var J=getIteratee(W,3);B=keys(B),W=function(F){return J(K[F],F,K)}}var Q=F(B,W,z);return Q>-1?K[J?B[Q]:Q]:G}}function createFlow(F){return flatRest((function(B){var W=B.length,z=W,K=LodashWrapper.prototype.thru;for(F&&B.reverse();z--;){var J=B[z];if("function"!=typeof J)throw new Kt(Q);if(K&&!Y&&"wrapper"==getFuncName(J))var Y=new LodashWrapper([],!0)}for(z=Y?z:W;++z<W;){var $=getFuncName(J=B[z]),X="wrapper"==$?Ri(J):G;Y=X&&isLaziable(X[0])&&X[1]==(pe|ce|de|he)&&!X[4].length&&1==X[9]?Y[getFuncName(X[0])].apply(Y,X[3]):1==J.length&&isLaziable(J)?Y[$]():Y.thru(J)}return function(){var F=arguments,G=F[0];if(Y&&1==F.length&&_r(G))return Y.plant(G).value();for(var z=0,K=W?B[z].apply(this,F):G;++z<W;)K=B[z].call(this,K);return K}}))}function createHybrid(F,B,W,K,J,Q,Y,$,X,Z){var ee=B&pe,te=B&oe,ne=B&ae,ie=B&(ce|le),re=B&ge,se=ne?G:createCtor(F);function wrapper(){for(var G=arguments.length,oe=z(G),ae=G;ae--;)oe[ae]=arguments[ae];if(ie)var ce=getHolder(wrapper),le=countHolders(oe,ce);if(K&&(oe=composeArgs(oe,K,J,ie)),Q&&(oe=composeArgsRight(oe,Q,Y,ie)),G-=le,ie&&G<Z){var de=replaceHolders(oe,ce);return createRecurry(F,B,createHybrid,wrapper.placeholder,W,oe,de,$,X,Z-G)}var ue=te?W:this,pe=ne?ue[F]:F;return G=oe.length,$?oe=reorder(oe,$):re&&G>1&&oe.reverse(),ee&&X<G&&(oe.length=X),this&&this!==jn&&this instanceof wrapper&&(pe=se||createCtor(pe)),pe.apply(ue,oe)}return wrapper}function createInverter(F,B){return function(G,W){return baseInverter(G,F,B(W),{})}}function createMathOperation(F,B){return function(W,z){var K;if(W===G&&z===G)return B;if(W!==G&&(K=W),z!==G){if(K===G)return z;"string"==typeof W||"string"==typeof z?(W=baseToString(W),z=baseToString(z)):(W=baseToNumber(W),z=baseToNumber(z)),K=F(W,z)}return K}}function createOver(F){return flatRest((function(B){return B=arrayMap(B,baseUnary(getIteratee())),baseRest((function(G){var W=this;return F(B,(function(F){return apply(F,W,G)}))}))}))}function createPadding(F,B){var W=(B=B===G?" ":baseToString(B)).length;if(W<2)return W?baseRepeat(B,F):B;var z=baseRepeat(B,bn(F/stringSize(B)));return hasUnicode(B)?castSlice(stringToArray(z),0,F).join(""):z.slice(0,F)}function createPartial(F,B,G,W){var K=B&oe,J=createCtor(F);function wrapper(){for(var B=-1,Q=arguments.length,Y=-1,$=W.length,X=z($+Q),Z=this&&this!==jn&&this instanceof wrapper?J:F;++Y<$;)X[Y]=W[Y];for(;Q--;)X[Y++]=arguments[++B];return apply(Z,K?G:this,X)}return wrapper}function createRange(F){return function(B,W,z){return z&&"number"!=typeof z&&isIterateeCall(B,W,z)&&(W=z=G),B=toFinite(B),W===G?(W=B,B=0):W=toFinite(W),baseRange(B,W,z=z===G?B<W?1:-1:toFinite(z),F)}}function createRelationalOperation(F){return function(B,G){return"string"==typeof B&&"string"==typeof G||(B=toNumber(B),G=toNumber(G)),F(B,G)}}function createRecurry(F,B,W,z,K,J,Q,Y,$,X){var Z=B&ce;B|=Z?de:ue,(B&=~(Z?ue:de))&se||(B&=~(oe|ae));var ee=[F,B,K,Z?J:G,Z?Q:G,Z?G:J,Z?G:Q,Y,$,X],te=W.apply(G,ee);return isLaziable(F)&&Di(te,ee),te.placeholder=z,setWrapToString(te,F,B)}function createRound(F){var B=Gt[F];return function(F,G){if(F=toNumber(F),(G=null==G?0:Un(toInteger(G),292))&&Dn(F)){var W=(toString(F)+"e").split("e");return+((W=(toString(B(W[0]+"e"+(+W[1]+G)))+"e").split("e"))[0]+"e"+(+W[1]-G))}return B(F)}}var Ai=ri&&1/setToArray(new ri([,-0]))[1]==Te?function(F){return new ri(F)}:noop;function createToPairs(F){return function(B){var G=Mi(B);return G==je?mapToArray(B):G==ze?setToPairs(B):baseToPairs(B,F(B))}}function createWrap(F,B,W,z,K,J,Y,$){var X=B&ae;if(!X&&"function"!=typeof F)throw new Kt(Q);var Z=z?z.length:0;if(Z||(B&=~(de|ue),z=K=G),Y=Y===G?Y:xn(toInteger(Y),0),$=$===G?$:toInteger($),Z-=K?K.length:0,B&ue){var ee=z,te=K;z=K=G}var ne=X?G:Ri(F),ie=[F,B,W,z,K,ee,te,J,Y,$];if(ne&&mergeData(ie,ne),F=ie[0],B=ie[1],W=ie[2],z=ie[3],K=ie[4],!($=ie[9]=ie[9]===G?X?0:F.length:xn(ie[9]-Z,0))&&B&(ce|le)&&(B&=~(ce|le)),B&&B!=oe)re=B==ce||B==le?createCurry(F,B,$):B!=de&&B!=(oe|de)||K.length?createHybrid.apply(G,ie):createPartial(F,B,W,z);else var re=createBind(F,B,W);return setWrapToString((ne?Ti:Di)(re,ie),F,B)}function customDefaultsAssignIn(F,B,W,z){return F===G||eq(F,Yt[W])&&!Zt.call(z,W)?B:F}function customDefaultsMerge(F,B,W,z,K,J){return isObject(F)&&isObject(B)&&(J.set(B,F),baseMerge(F,B,G,customDefaultsMerge,J),J.delete(B)),F}function customOmitClone(F){return isPlainObject(F)?G:F}function equalArrays(F,B,W,z,K,J){var Q=W&ie,Y=F.length,$=B.length;if(Y!=$&&!(Q&&$>Y))return!1;var X=J.get(F),Z=J.get(B);if(X&&Z)return X==B&&Z==F;var ee=-1,te=!0,ne=W&re?new SetCache:G;for(J.set(F,B),J.set(B,F);++ee<Y;){var oe=F[ee],ae=B[ee];if(z)var se=Q?z(ae,oe,ee,B,F,J):z(oe,ae,ee,F,B,J);if(se!==G){if(se)continue;te=!1;break}if(ne){if(!arraySome(B,(function(F,B){if(!cacheHas(ne,B)&&(oe===F||K(oe,F,W,z,J)))return ne.push(B)}))){te=!1;break}}else if(oe!==ae&&!K(oe,ae,W,z,J)){te=!1;break}}return J.delete(F),J.delete(B),te}function equalByTag(F,B,G,W,z,K,J){switch(G){case Ze:if(F.byteLength!=B.byteLength||F.byteOffset!=B.byteOffset)return!1;F=F.buffer,B=B.buffer;case Xe:return!(F.byteLength!=B.byteLength||!K(new ln(F),new ln(B)));case Ne:case Le:case Be:return eq(+F,+B);case Fe:return F.name==B.name&&F.message==B.message;case qe:case Ke:return F==B+"";case je:var Q=mapToArray;case ze:var Y=W&ie;if(Q||(Q=setToArray),F.size!=B.size&&!Y)return!1;var $=J.get(F);if($)return $==B;W|=re,J.set(F,B);var X=equalArrays(Q(F),Q(B),W,z,K,J);return J.delete(F),X;case Je:if(fi)return fi.call(F)==fi.call(B)}return!1}function equalObjects(F,B,W,z,K,J){var Q=W&ie,Y=getAllKeys(F),$=Y.length;if($!=getAllKeys(B).length&&!Q)return!1;for(var X=$;X--;){var Z=Y[X];if(!(Q?Z in B:Zt.call(B,Z)))return!1}var ee=J.get(F),te=J.get(B);if(ee&&te)return ee==B&&te==F;var ne=!0;J.set(F,B),J.set(B,F);for(var re=Q;++X<$;){var oe=F[Z=Y[X]],ae=B[Z];if(z)var se=Q?z(ae,oe,Z,B,F,J):z(oe,ae,Z,F,B,J);if(!(se===G?oe===ae||K(oe,ae,W,z,J):se)){ne=!1;break}re||(re="constructor"==Z)}if(ne&&!re){var ce=F.constructor,le=B.constructor;ce==le||!("constructor"in F)||!("constructor"in B)||"function"==typeof ce&&ce instanceof ce&&"function"==typeof le&&le instanceof le||(ne=!1)}return J.delete(F),J.delete(B),ne}function flatRest(F){return Li(overRest(F,G,flatten),F+"")}function getAllKeys(F){return baseGetAllKeys(F,keys,Pi)}function getAllKeysIn(F){return baseGetAllKeys(F,keysIn,Oi)}var Ri=si?function(F){return si.get(F)}:noop;function getFuncName(F){for(var B=F.name+"",G=ci[B],W=Zt.call(ci,B)?G.length:0;W--;){var z=G[W],K=z.func;if(null==K||K==F)return z.name}return B}function getHolder(F){return(Zt.call(lodash,"placeholder")?lodash:F).placeholder}function getIteratee(){var F=lodash.iteratee||iteratee;return F=F===iteratee?baseIteratee:F,arguments.length?F(arguments[0],arguments[1]):F}function getMapData(F,B){var G=F.__data__;return isKeyable(B)?G["string"==typeof B?"string":"hash"]:G.map}function getMatchData(F){for(var B=keys(F),G=B.length;G--;){var W=B[G],z=F[W];B[G]=[W,z,isStrictComparable(z)]}return B}function getNative(F,B){var W=getValue(F,B);return baseIsNative(W)?W:G}function getRawTag(F){var B=Zt.call(F,vn),W=F[vn];try{F[vn]=G;var z=!0}catch(F){}var K=nn.call(F);return z&&(B?F[vn]=W:delete F[vn]),K}var Pi=An?function(F){return null==F?[]:(F=Wt(F),arrayFilter(An(F),(function(B){return hn.call(F,B)})))}:stubArray,Oi=An?function(F){for(var B=[];F;)arrayPush(B,Pi(F)),F=un(F);return B}:stubArray,Mi=baseGetTag;function getView(F,B,G){for(var W=-1,z=G.length;++W<z;){var K=G[W],J=K.size;switch(K.type){case"drop":F+=J;break;case"dropRight":B-=J;break;case"take":B=Un(B,F+J);break;case"takeRight":F=xn(F,B-J)}}return{start:F,end:B}}function getWrapDetails(F){var B=F.match(Rt);return B?B[1].split(Pt):[]}function hasPath(F,B,G){for(var W=-1,z=(B=castPath(B,F)).length,K=!1;++W<z;){var J=toKey(B[W]);if(!(K=null!=F&&G(F,J)))break;F=F[J]}return K||++W!=z?K:!!(z=null==F?0:F.length)&&isLength(z)&&isIndex(J,z)&&(_r(F)||Sr(F))}function initCloneArray(F){var B=F.length,G=new F.constructor(B);return B&&"string"==typeof F[0]&&Zt.call(F,"index")&&(G.index=F.index,G.input=F.input),G}function initCloneObject(F){return"function"!=typeof F.constructor||isPrototype(F)?{}:vi(un(F))}function initCloneByTag(F,B,G){var W=F.constructor;switch(B){case Xe:return cloneArrayBuffer(F);case Ne:case Le:return new W(+F);case Ze:return cloneDataView(F,G);case et:case tt:case nt:case it:case rt:case ot:case at:case st:case ct:return cloneTypedArray(F,G);case je:return new W;case Be:case Ke:return new W(F);case qe:return cloneRegExp(F);case ze:return new W;case Je:return cloneSymbol(F)}}function insertWrapDetails(F,B){var G=B.length;if(!G)return F;var W=G-1;return B[W]=(G>1?"& ":"")+B[W],B=B.join(G>2?", ":" "),F.replace(At,"{\n/* [wrapped with "+B+"] */\n")}function isFlattenable(F){return _r(F)||Sr(F)||!!(fn&&F&&F[fn])}function isIndex(F,B){var G=typeof F;return!!(B=null==B?Ee:B)&&("number"==G||"symbol"!=G&&Ut.test(F))&&F>-1&&F%1==0&&F<B}function isIterateeCall(F,B,G){if(!isObject(G))return!1;var W=typeof B;return!!("number"==W?isArrayLike(G)&&isIndex(B,G.length):"string"==W&&B in G)&&eq(G[B],F)}function isKey(F,B){if(_r(F))return!1;var G=typeof F;return!("number"!=G&&"symbol"!=G&&"boolean"!=G&&null!=F&&!isSymbol(F))||(_t.test(F)||!St.test(F)||null!=B&&F in Wt(B))}function isKeyable(F){var B=typeof F;return"string"==B||"number"==B||"symbol"==B||"boolean"==B?"__proto__"!==F:null===F}function isLaziable(F){var B=getFuncName(F),G=lodash[B];if("function"!=typeof G||!(B in LazyWrapper.prototype))return!1;if(F===G)return!0;var W=Ri(G);return!!W&&F===W[0]}function isMasked(F){return!!tn&&tn in F}($n&&Mi(new $n(new ArrayBuffer(1)))!=Ze||ti&&Mi(new ti)!=je||ii&&Mi(ii.resolve())!=Ge||ri&&Mi(new ri)!=ze||oi&&Mi(new oi)!=Ye)&&(Mi=function(F){var B=baseGetTag(F),W=B==Ve?F.constructor:G,z=W?toSource(W):"";if(z)switch(z){case li:return Ze;case di:return je;case ui:return Ge;case pi:return ze;case hi:return Ye}return B});var wi=$t?isFunction:stubFalse;function isPrototype(F){var B=F&&F.constructor;return F===("function"==typeof B&&B.prototype||Yt)}function isStrictComparable(F){return F==F&&!isObject(F)}function matchesStrictComparable(F,B){return function(W){return null!=W&&(W[F]===B&&(B!==G||F in Wt(W)))}}function memoizeCapped(F){var B=memoize(F,(function(F){return G.size===X&&G.clear(),F})),G=B.cache;return B}function mergeData(F,B){var G=F[1],W=B[1],z=G|W,K=z<(oe|ae|pe),J=W==pe&&G==ce||W==pe&&G==he&&F[7].length<=B[8]||W==(pe|he)&&B[7].length<=B[8]&&G==ce;if(!K&&!J)return F;W&oe&&(F[2]=B[2],z|=G&oe?0:se);var Q=B[3];if(Q){var Y=F[3];F[3]=Y?composeArgs(Y,Q,B[4]):Q,F[4]=Y?replaceHolders(F[3],Z):B[4]}return(Q=B[5])&&(Y=F[5],F[5]=Y?composeArgsRight(Y,Q,B[6]):Q,F[6]=Y?replaceHolders(F[5],Z):B[6]),(Q=B[7])&&(F[7]=Q),W&pe&&(F[8]=null==F[8]?B[8]:Un(F[8],B[8])),null==F[9]&&(F[9]=B[9]),F[0]=B[0],F[1]=z,F}function nativeKeysIn(F){var B=[];if(null!=F)for(var G in Wt(F))B.push(G);return B}function objectToString(F){return nn.call(F)}function overRest(F,B,W){return B=xn(B===G?F.length-1:B,0),function(){for(var G=arguments,K=-1,J=xn(G.length-B,0),Q=z(J);++K<J;)Q[K]=G[B+K];K=-1;for(var Y=z(B+1);++K<B;)Y[K]=G[K];return Y[B]=W(Q),apply(F,this,Y)}}function parent(F,B){return B.length<2?F:baseGet(F,baseSlice(B,0,-1))}function reorder(F,B){for(var W=F.length,z=Un(B.length,W),K=copyArray(F);z--;){var J=B[z];F[z]=isIndex(J,W)?K[J]:G}return F}function safeGet(F,B){if(("constructor"!==B||"function"!=typeof F[B])&&"__proto__"!=B)return F[B]}var Di=shortOut(Ti),Ni=En||function(F,B){return jn.setTimeout(F,B)},Li=shortOut(Ei);function setWrapToString(F,B,G){var W=B+"";return Li(F,insertWrapDetails(W,updateWrapDetails(getWrapDetails(W),G)))}function shortOut(F){var B=0,W=0;return function(){var z=Bn(),K=ye-(z-W);if(W=z,K>0){if(++B>=ve)return arguments[0]}else B=0;return F.apply(G,arguments)}}function shuffleSelf(F,B){var W=-1,z=F.length,K=z-1;for(B=B===G?z:B;++W<B;){var J=baseRandom(W,K),Q=F[J];F[J]=F[W],F[W]=Q}return F.length=B,F}var ki=memoizeCapped((function(F){var B=[];return 46===F.charCodeAt(0)&&B.push(""),F.replace(Ct,(function(F,G,W,z){B.push(W?z.replace(wt,"$1"):G||F)})),B}));function toKey(F){if("string"==typeof F||isSymbol(F))return F;var B=F+"";return"0"==B&&1/F==-Te?"-0":B}function toSource(F){if(null!=F){try{return Xt.call(F)}catch(F){}try{return F+""}catch(F){}}return""}function updateWrapDetails(F,B){return arrayEach(Oe,(function(G){var W="_."+G[0];B&G[1]&&!arrayIncludes(F,W)&&F.push(W)})),F.sort()}function wrapperClone(F){if(F instanceof LazyWrapper)return F.clone();var B=new LodashWrapper(F.__wrapped__,F.__chain__);return B.__actions__=copyArray(F.__actions__),B.__index__=F.__index__,B.__values__=F.__values__,B}function chunk(F,B,W){B=(W?isIterateeCall(F,B,W):B===G)?1:xn(toInteger(B),0);var K=null==F?0:F.length;if(!K||B<1)return[];for(var J=0,Q=0,Y=z(bn(K/B));J<K;)Y[Q++]=baseSlice(F,J,J+=B);return Y}function compact(F){for(var B=-1,G=null==F?0:F.length,W=0,z=[];++B<G;){var K=F[B];K&&(z[W++]=K)}return z}function concat(){var F=arguments.length;if(!F)return[];for(var B=z(F-1),G=arguments[0],W=F;W--;)B[W-1]=arguments[W];return arrayPush(_r(G)?copyArray(G):[G],baseFlatten(B,1))}var Fi=baseRest((function(F,B){return isArrayLikeObject(F)?baseDifference(F,baseFlatten(B,1,isArrayLikeObject,!0)):[]})),xi=baseRest((function(F,B){var W=last(B);return isArrayLikeObject(W)&&(W=G),isArrayLikeObject(F)?baseDifference(F,baseFlatten(B,1,isArrayLikeObject,!0),getIteratee(W,2)):[]})),Ui=baseRest((function(F,B){var W=last(B);return isArrayLikeObject(W)&&(W=G),isArrayLikeObject(F)?baseDifference(F,baseFlatten(B,1,isArrayLikeObject,!0),G,W):[]}));function drop(F,B,W){var z=null==F?0:F.length;return z?baseSlice(F,(B=W||B===G?1:toInteger(B))<0?0:B,z):[]}function dropRight(F,B,W){var z=null==F?0:F.length;return z?baseSlice(F,0,(B=z-(B=W||B===G?1:toInteger(B)))<0?0:B):[]}function dropRightWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3),!0,!0):[]}function dropWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3),!0):[]}function fill(F,B,G,W){var z=null==F?0:F.length;return z?(G&&"number"!=typeof G&&isIterateeCall(F,B,G)&&(G=0,W=z),baseFill(F,B,G,W)):[]}function findIndex(F,B,G){var W=null==F?0:F.length;if(!W)return-1;var z=null==G?0:toInteger(G);return z<0&&(z=xn(W+z,0)),baseFindIndex(F,getIteratee(B,3),z)}function findLastIndex(F,B,W){var z=null==F?0:F.length;if(!z)return-1;var K=z-1;return W!==G&&(K=toInteger(W),K=W<0?xn(z+K,0):Un(K,z-1)),baseFindIndex(F,getIteratee(B,3),K,!0)}function flatten(F){return(null==F?0:F.length)?baseFlatten(F,1):[]}function flattenDeep(F){return(null==F?0:F.length)?baseFlatten(F,Te):[]}function flattenDepth(F,B){return(null==F?0:F.length)?baseFlatten(F,B=B===G?1:toInteger(B)):[]}function fromPairs(F){for(var B=-1,G=null==F?0:F.length,W={};++B<G;){var z=F[B];W[z[0]]=z[1]}return W}function head(F){return F&&F.length?F[0]:G}function indexOf(F,B,G){var W=null==F?0:F.length;if(!W)return-1;var z=null==G?0:toInteger(G);return z<0&&(z=xn(W+z,0)),baseIndexOf(F,B,z)}function initial(F){return(null==F?0:F.length)?baseSlice(F,0,-1):[]}var ji=baseRest((function(F){var B=arrayMap(F,castArrayLikeObject);return B.length&&B[0]===F[0]?baseIntersection(B):[]})),Bi=baseRest((function(F){var B=last(F),W=arrayMap(F,castArrayLikeObject);return B===last(W)?B=G:W.pop(),W.length&&W[0]===F[0]?baseIntersection(W,getIteratee(B,2)):[]})),Hi=baseRest((function(F){var B=last(F),W=arrayMap(F,castArrayLikeObject);return(B="function"==typeof B?B:G)&&W.pop(),W.length&&W[0]===F[0]?baseIntersection(W,G,B):[]}));function join(F,B){return null==F?"":Nn.call(F,B)}function last(F){var B=null==F?0:F.length;return B?F[B-1]:G}function lastIndexOf(F,B,W){var z=null==F?0:F.length;if(!z)return-1;var K=z;return W!==G&&(K=(K=toInteger(W))<0?xn(z+K,0):Un(K,z-1)),B==B?strictLastIndexOf(F,B,K):baseFindIndex(F,baseIsNaN,K,!0)}function nth(F,B){return F&&F.length?baseNth(F,toInteger(B)):G}var Vi=baseRest(pullAll);function pullAll(F,B){return F&&F.length&&B&&B.length?basePullAll(F,B):F}function pullAllBy(F,B,G){return F&&F.length&&B&&B.length?basePullAll(F,B,getIteratee(G,2)):F}function pullAllWith(F,B,W){return F&&F.length&&B&&B.length?basePullAll(F,B,G,W):F}var Gi=flatRest((function(F,B){var G=null==F?0:F.length,W=baseAt(F,B);return basePullAt(F,arrayMap(B,(function(F){return isIndex(F,G)?+F:F})).sort(compareAscending)),W}));function remove(F,B){var G=[];if(!F||!F.length)return G;var W=-1,z=[],K=F.length;for(B=getIteratee(B,3);++W<K;){var J=F[W];B(J,W,F)&&(G.push(J),z.push(W))}return basePullAt(F,z),G}function reverse(F){return null==F?F:Wn.call(F)}function slice(F,B,W){var z=null==F?0:F.length;return z?(W&&"number"!=typeof W&&isIterateeCall(F,B,W)?(B=0,W=z):(B=null==B?0:toInteger(B),W=W===G?z:toInteger(W)),baseSlice(F,B,W)):[]}function sortedIndex(F,B){return baseSortedIndex(F,B)}function sortedIndexBy(F,B,G){return baseSortedIndexBy(F,B,getIteratee(G,2))}function sortedIndexOf(F,B){var G=null==F?0:F.length;if(G){var W=baseSortedIndex(F,B);if(W<G&&eq(F[W],B))return W}return-1}function sortedLastIndex(F,B){return baseSortedIndex(F,B,!0)}function sortedLastIndexBy(F,B,G){return baseSortedIndexBy(F,B,getIteratee(G,2),!0)}function sortedLastIndexOf(F,B){if(null==F?0:F.length){var G=baseSortedIndex(F,B,!0)-1;if(eq(F[G],B))return G}return-1}function sortedUniq(F){return F&&F.length?baseSortedUniq(F):[]}function sortedUniqBy(F,B){return F&&F.length?baseSortedUniq(F,getIteratee(B,2)):[]}function tail(F){var B=null==F?0:F.length;return B?baseSlice(F,1,B):[]}function take(F,B,W){return F&&F.length?baseSlice(F,0,(B=W||B===G?1:toInteger(B))<0?0:B):[]}function takeRight(F,B,W){var z=null==F?0:F.length;return z?baseSlice(F,(B=z-(B=W||B===G?1:toInteger(B)))<0?0:B,z):[]}function takeRightWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3),!1,!0):[]}function takeWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3)):[]}var Wi=baseRest((function(F){return baseUniq(baseFlatten(F,1,isArrayLikeObject,!0))})),qi=baseRest((function(F){var B=last(F);return isArrayLikeObject(B)&&(B=G),baseUniq(baseFlatten(F,1,isArrayLikeObject,!0),getIteratee(B,2))})),zi=baseRest((function(F){var B=last(F);return B="function"==typeof B?B:G,baseUniq(baseFlatten(F,1,isArrayLikeObject,!0),G,B)}));function uniq(F){return F&&F.length?baseUniq(F):[]}function uniqBy(F,B){return F&&F.length?baseUniq(F,getIteratee(B,2)):[]}function uniqWith(F,B){return B="function"==typeof B?B:G,F&&F.length?baseUniq(F,G,B):[]}function unzip(F){if(!F||!F.length)return[];var B=0;return F=arrayFilter(F,(function(F){if(isArrayLikeObject(F))return B=xn(F.length,B),!0})),baseTimes(B,(function(B){return arrayMap(F,baseProperty(B))}))}function unzipWith(F,B){if(!F||!F.length)return[];var W=unzip(F);return null==B?W:arrayMap(W,(function(F){return apply(B,G,F)}))}var Ki=baseRest((function(F,B){return isArrayLikeObject(F)?baseDifference(F,B):[]})),Ji=baseRest((function(F){return baseXor(arrayFilter(F,isArrayLikeObject))})),Qi=baseRest((function(F){var B=last(F);return isArrayLikeObject(B)&&(B=G),baseXor(arrayFilter(F,isArrayLikeObject),getIteratee(B,2))})),Yi=baseRest((function(F){var B=last(F);return B="function"==typeof B?B:G,baseXor(arrayFilter(F,isArrayLikeObject),G,B)})),$i=baseRest(unzip);function zipObject(F,B){return baseZipObject(F||[],B||[],assignValue)}function zipObjectDeep(F,B){return baseZipObject(F||[],B||[],baseSet)}var Xi=baseRest((function(F){var B=F.length,W=B>1?F[B-1]:G;return W="function"==typeof W?(F.pop(),W):G,unzipWith(F,W)}));function chain(F){var B=lodash(F);return B.__chain__=!0,B}function tap(F,B){return B(F),F}function thru(F,B){return B(F)}var Zi=flatRest((function(F){var B=F.length,W=B?F[0]:0,z=this.__wrapped__,interceptor=function(B){return baseAt(B,F)};return!(B>1||this.__actions__.length)&&z instanceof LazyWrapper&&isIndex(W)?((z=z.slice(W,+W+(B?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:G}),new LodashWrapper(z,this.__chain__).thru((function(F){return B&&!F.length&&F.push(G),F}))):this.thru(interceptor)}));function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){this.__values__===G&&(this.__values__=toArray(this.value()));var F=this.__index__>=this.__values__.length;return{done:F,value:F?G:this.__values__[this.__index__++]}}function wrapperToIterator(){return this}function wrapperPlant(F){for(var B,W=this;W instanceof baseLodash;){var z=wrapperClone(W);z.__index__=0,z.__values__=G,B?K.__wrapped__=z:B=z;var K=z;W=W.__wrapped__}return K.__wrapped__=F,B}function wrapperReverse(){var F=this.__wrapped__;if(F instanceof LazyWrapper){var B=F;return this.__actions__.length&&(B=new LazyWrapper(this)),(B=B.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:G}),new LodashWrapper(B,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var er=createAggregator((function(F,B,G){Zt.call(F,G)?++F[G]:baseAssignValue(F,G,1)}));function every(F,B,W){var z=_r(F)?arrayEvery:baseEvery;return W&&isIterateeCall(F,B,W)&&(B=G),z(F,getIteratee(B,3))}function filter(F,B){return(_r(F)?arrayFilter:baseFilter)(F,getIteratee(B,3))}var tr=createFind(findIndex),nr=createFind(findLastIndex);function flatMap(F,B){return baseFlatten(map(F,B),1)}function flatMapDeep(F,B){return baseFlatten(map(F,B),Te)}function flatMapDepth(F,B,W){return W=W===G?1:toInteger(W),baseFlatten(map(F,B),W)}function forEach(F,B){return(_r(F)?arrayEach:yi)(F,getIteratee(B,3))}function forEachRight(F,B){return(_r(F)?arrayEachRight:Si)(F,getIteratee(B,3))}var ir=createAggregator((function(F,B,G){Zt.call(F,G)?F[G].push(B):baseAssignValue(F,G,[B])}));function includes(F,B,G,W){F=isArrayLike(F)?F:values(F),G=G&&!W?toInteger(G):0;var z=F.length;return G<0&&(G=xn(z+G,0)),isString(F)?G<=z&&F.indexOf(B,G)>-1:!!z&&baseIndexOf(F,B,G)>-1}var rr=baseRest((function(F,B,G){var W=-1,K="function"==typeof B,J=isArrayLike(F)?z(F.length):[];return yi(F,(function(F){J[++W]=K?apply(B,F,G):baseInvoke(F,B,G)})),J})),or=createAggregator((function(F,B,G){baseAssignValue(F,G,B)}));function map(F,B){return(_r(F)?arrayMap:baseMap)(F,getIteratee(B,3))}function orderBy(F,B,W,z){return null==F?[]:(_r(B)||(B=null==B?[]:[B]),_r(W=z?G:W)||(W=null==W?[]:[W]),baseOrderBy(F,B,W))}var ar=createAggregator((function(F,B,G){F[G?0:1].push(B)}),(function(){return[[],[]]}));function reduce(F,B,G){var W=_r(F)?arrayReduce:baseReduce,z=arguments.length<3;return W(F,getIteratee(B,4),G,z,yi)}function reduceRight(F,B,G){var W=_r(F)?arrayReduceRight:baseReduce,z=arguments.length<3;return W(F,getIteratee(B,4),G,z,Si)}function reject(F,B){return(_r(F)?arrayFilter:baseFilter)(F,negate(getIteratee(B,3)))}function sample(F){return(_r(F)?arraySample:baseSample)(F)}function sampleSize(F,B,W){return B=(W?isIterateeCall(F,B,W):B===G)?1:toInteger(B),(_r(F)?arraySampleSize:baseSampleSize)(F,B)}function shuffle(F){return(_r(F)?arrayShuffle:baseShuffle)(F)}function size(F){if(null==F)return 0;if(isArrayLike(F))return isString(F)?stringSize(F):F.length;var B=Mi(F);return B==je||B==ze?F.size:baseKeys(F).length}function some(F,B,W){var z=_r(F)?arraySome:baseSome;return W&&isIterateeCall(F,B,W)&&(B=G),z(F,getIteratee(B,3))}var sr=baseRest((function(F,B){if(null==F)return[];var G=B.length;return G>1&&isIterateeCall(F,B[0],B[1])?B=[]:G>2&&isIterateeCall(B[0],B[1],B[2])&&(B=[B[0]]),baseOrderBy(F,baseFlatten(B,1),[])})),cr=_n||function(){return jn.Date.now()};function after(F,B){if("function"!=typeof B)throw new Kt(Q);return F=toInteger(F),function(){if(--F<1)return B.apply(this,arguments)}}function ary(F,B,W){return B=W?G:B,B=F&&null==B?F.length:B,createWrap(F,pe,G,G,G,G,B)}function before(F,B){var W;if("function"!=typeof B)throw new Kt(Q);return F=toInteger(F),function(){return--F>0&&(W=B.apply(this,arguments)),F<=1&&(B=G),W}}var lr=baseRest((function(F,B,G){var W=oe;if(G.length){var z=replaceHolders(G,getHolder(lr));W|=de}return createWrap(F,W,B,G,z)})),dr=baseRest((function(F,B,G){var W=oe|ae;if(G.length){var z=replaceHolders(G,getHolder(dr));W|=de}return createWrap(B,W,F,G,z)}));function curry(F,B,W){var z=createWrap(F,ce,G,G,G,G,G,B=W?G:B);return z.placeholder=curry.placeholder,z}function curryRight(F,B,W){var z=createWrap(F,le,G,G,G,G,G,B=W?G:B);return z.placeholder=curryRight.placeholder,z}function debounce(F,B,W){var z,K,J,Y,$,X,Z=0,ee=!1,te=!1,ne=!0;if("function"!=typeof F)throw new Kt(Q);function invokeFunc(B){var W=z,J=K;return z=K=G,Z=B,Y=F.apply(J,W)}function leadingEdge(F){return Z=F,$=Ni(timerExpired,B),ee?invokeFunc(F):Y}function remainingWait(F){var G=B-(F-X);return te?Un(G,J-(F-Z)):G}function shouldInvoke(F){var W=F-X;return X===G||W>=B||W<0||te&&F-Z>=J}function timerExpired(){var F=cr();if(shouldInvoke(F))return trailingEdge(F);$=Ni(timerExpired,remainingWait(F))}function trailingEdge(F){return $=G,ne&&z?invokeFunc(F):(z=K=G,Y)}function cancel(){$!==G&&Ii($),Z=0,z=X=K=$=G}function flush(){return $===G?Y:trailingEdge(cr())}function debounced(){var F=cr(),W=shouldInvoke(F);if(z=arguments,K=this,X=F,W){if($===G)return leadingEdge(X);if(te)return Ii($),$=Ni(timerExpired,B),invokeFunc(X)}return $===G&&($=Ni(timerExpired,B)),Y}return B=toNumber(B)||0,isObject(W)&&(ee=!!W.leading,J=(te="maxWait"in W)?xn(toNumber(W.maxWait)||0,B):J,ne="trailing"in W?!!W.trailing:ne),debounced.cancel=cancel,debounced.flush=flush,debounced}var ur=baseRest((function(F,B){return baseDelay(F,1,B)})),pr=baseRest((function(F,B,G){return baseDelay(F,toNumber(B)||0,G)}));function flip(F){return createWrap(F,ge)}function memoize(F,B){if("function"!=typeof F||null!=B&&"function"!=typeof B)throw new Kt(Q);var memoized=function(){var G=arguments,W=B?B.apply(this,G):G[0],z=memoized.cache;if(z.has(W))return z.get(W);var K=F.apply(this,G);return memoized.cache=z.set(W,K)||z,K};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(F){if("function"!=typeof F)throw new Kt(Q);return function(){var B=arguments;switch(B.length){case 0:return!F.call(this);case 1:return!F.call(this,B[0]);case 2:return!F.call(this,B[0],B[1]);case 3:return!F.call(this,B[0],B[1],B[2])}return!F.apply(this,B)}}function once(F){return before(2,F)}memoize.Cache=MapCache;var hr=bi((function(F,B){var G=(B=1==B.length&&_r(B[0])?arrayMap(B[0],baseUnary(getIteratee())):arrayMap(baseFlatten(B,1),baseUnary(getIteratee()))).length;return baseRest((function(W){for(var z=-1,K=Un(W.length,G);++z<K;)W[z]=B[z].call(this,W[z]);return apply(F,this,W)}))})),gr=baseRest((function(F,B){var W=replaceHolders(B,getHolder(gr));return createWrap(F,de,G,B,W)})),fr=baseRest((function(F,B){var W=replaceHolders(B,getHolder(fr));return createWrap(F,ue,G,B,W)})),mr=flatRest((function(F,B){return createWrap(F,he,G,G,G,B)}));function rest(F,B){if("function"!=typeof F)throw new Kt(Q);return baseRest(F,B=B===G?B:toInteger(B))}function spread(F,B){if("function"!=typeof F)throw new Kt(Q);return B=null==B?0:xn(toInteger(B),0),baseRest((function(G){var W=G[B],z=castSlice(G,0,B);return W&&arrayPush(z,W),apply(F,this,z)}))}function throttle(F,B,G){var W=!0,z=!0;if("function"!=typeof F)throw new Kt(Q);return isObject(G)&&(W="leading"in G?!!G.leading:W,z="trailing"in G?!!G.trailing:z),debounce(F,B,{leading:W,maxWait:B,trailing:z})}function unary(F){return ary(F,1)}function wrap(F,B){return gr(castFunction(B),F)}function castArray(){if(!arguments.length)return[];var F=arguments[0];return _r(F)?F:[F]}function clone(F){return baseClone(F,ne)}function cloneWith(F,B){return baseClone(F,ne,B="function"==typeof B?B:G)}function cloneDeep(F){return baseClone(F,ee|ne)}function cloneDeepWith(F,B){return baseClone(F,ee|ne,B="function"==typeof B?B:G)}function conformsTo(F,B){return null==B||baseConformsTo(F,B,keys(B))}function eq(F,B){return F===B||F!=F&&B!=B}var vr=createRelationalOperation(baseGt),yr=createRelationalOperation((function(F,B){return F>=B})),Sr=baseIsArguments(function(){return arguments}())?baseIsArguments:function(F){return isObjectLike(F)&&Zt.call(F,"callee")&&!hn.call(F,"callee")},_r=z.isArray,Cr=qn?baseUnary(qn):baseIsArrayBuffer;function isArrayLike(F){return null!=F&&isLength(F.length)&&!isFunction(F)}function isArrayLikeObject(F){return isObjectLike(F)&&isArrayLike(F)}function isBoolean(F){return!0===F||!1===F||isObjectLike(F)&&baseGetTag(F)==Ne}var Tr=wn||stubFalse,Er=zn?baseUnary(zn):baseIsDate;function isElement(F){return isObjectLike(F)&&1===F.nodeType&&!isPlainObject(F)}function isEmpty(F){if(null==F)return!0;if(isArrayLike(F)&&(_r(F)||"string"==typeof F||"function"==typeof F.splice||Tr(F)||Rr(F)||Sr(F)))return!F.length;var B=Mi(F);if(B==je||B==ze)return!F.size;if(isPrototype(F))return!baseKeys(F).length;for(var G in F)if(Zt.call(F,G))return!1;return!0}function isEqual(F,B){return baseIsEqual(F,B)}function isEqualWith(F,B,W){var z=(W="function"==typeof W?W:G)?W(F,B):G;return z===G?baseIsEqual(F,B,G,W):!!z}function isError(F){if(!isObjectLike(F))return!1;var B=baseGetTag(F);return B==Fe||B==ke||"string"==typeof F.message&&"string"==typeof F.name&&!isPlainObject(F)}function isFinite(F){return"number"==typeof F&&Dn(F)}function isFunction(F){if(!isObject(F))return!1;var B=baseGetTag(F);return B==xe||B==Ue||B==De||B==We}function isInteger(F){return"number"==typeof F&&F==toInteger(F)}function isLength(F){return"number"==typeof F&&F>-1&&F%1==0&&F<=Ee}function isObject(F){var B=typeof F;return null!=F&&("object"==B||"function"==B)}function isObjectLike(F){return null!=F&&"object"==typeof F}var br=Kn?baseUnary(Kn):baseIsMap;function isMatch(F,B){return F===B||baseIsMatch(F,B,getMatchData(B))}function isMatchWith(F,B,W){return W="function"==typeof W?W:G,baseIsMatch(F,B,getMatchData(B),W)}function isNaN(F){return isNumber(F)&&F!=+F}function isNative(F){if(wi(F))throw new Ot(J);return baseIsNative(F)}function isNull(F){return null===F}function isNil(F){return null==F}function isNumber(F){return"number"==typeof F||isObjectLike(F)&&baseGetTag(F)==Be}function isPlainObject(F){if(!isObjectLike(F)||baseGetTag(F)!=Ve)return!1;var B=un(F);if(null===B)return!0;var G=Zt.call(B,"constructor")&&B.constructor;return"function"==typeof G&&G instanceof G&&Xt.call(G)==rn}var Ir=Jn?baseUnary(Jn):baseIsRegExp;function isSafeInteger(F){return isInteger(F)&&F>=-Ee&&F<=Ee}var Ar=Qn?baseUnary(Qn):baseIsSet;function isString(F){return"string"==typeof F||!_r(F)&&isObjectLike(F)&&baseGetTag(F)==Ke}function isSymbol(F){return"symbol"==typeof F||isObjectLike(F)&&baseGetTag(F)==Je}var Rr=Yn?baseUnary(Yn):baseIsTypedArray;function isUndefined(F){return F===G}function isWeakMap(F){return isObjectLike(F)&&Mi(F)==Ye}function isWeakSet(F){return isObjectLike(F)&&baseGetTag(F)==$e}var Pr=createRelationalOperation(baseLt),Or=createRelationalOperation((function(F,B){return F<=B}));function toArray(F){if(!F)return[];if(isArrayLike(F))return isString(F)?stringToArray(F):copyArray(F);if(mn&&F[mn])return iteratorToArray(F[mn]());var B=Mi(F);return(B==je?mapToArray:B==ze?setToArray:values)(F)}function toFinite(F){return F?(F=toNumber(F))===Te||F===-Te?(F<0?-1:1)*be:F==F?F:0:0===F?F:0}function toInteger(F){var B=toFinite(F),G=B%1;return B==B?G?B-G:B:0}function toLength(F){return F?baseClamp(toInteger(F),0,Ae):0}function toNumber(F){if("number"==typeof F)return F;if(isSymbol(F))return Ie;if(isObject(F)){var B="function"==typeof F.valueOf?F.valueOf():F;F=isObject(B)?B+"":B}if("string"!=typeof F)return 0===F?F:+F;F=baseTrim(F);var G=kt.test(F);return G||xt.test(F)?Fn(F.slice(2),G?2:8):Lt.test(F)?Ie:+F}function toPlainObject(F){return copyObject(F,keysIn(F))}function toSafeInteger(F){return F?baseClamp(toInteger(F),-Ee,Ee):0===F?F:0}function toString(F){return null==F?"":baseToString(F)}var Mr=createAssigner((function(F,B){if(isPrototype(B)||isArrayLike(B))copyObject(B,keys(B),F);else for(var G in B)Zt.call(B,G)&&assignValue(F,G,B[G])})),wr=createAssigner((function(F,B){copyObject(B,keysIn(B),F)})),Dr=createAssigner((function(F,B,G,W){copyObject(B,keysIn(B),F,W)})),Nr=createAssigner((function(F,B,G,W){copyObject(B,keys(B),F,W)})),Lr=flatRest(baseAt);function create(F,B){var G=vi(F);return null==B?G:baseAssign(G,B)}var kr=baseRest((function(F,B){F=Wt(F);var W=-1,z=B.length,K=z>2?B[2]:G;for(K&&isIterateeCall(B[0],B[1],K)&&(z=1);++W<z;)for(var J=B[W],Q=keysIn(J),Y=-1,$=Q.length;++Y<$;){var X=Q[Y],Z=F[X];(Z===G||eq(Z,Yt[X])&&!Zt.call(F,X))&&(F[X]=J[X])}return F})),Fr=baseRest((function(F){return F.push(G,customDefaultsMerge),apply(Hr,G,F)}));function findKey(F,B){return baseFindKey(F,getIteratee(B,3),baseForOwn)}function findLastKey(F,B){return baseFindKey(F,getIteratee(B,3),baseForOwnRight)}function forIn(F,B){return null==F?F:_i(F,getIteratee(B,3),keysIn)}function forInRight(F,B){return null==F?F:Ci(F,getIteratee(B,3),keysIn)}function forOwn(F,B){return F&&baseForOwn(F,getIteratee(B,3))}function forOwnRight(F,B){return F&&baseForOwnRight(F,getIteratee(B,3))}function functions(F){return null==F?[]:baseFunctions(F,keys(F))}function functionsIn(F){return null==F?[]:baseFunctions(F,keysIn(F))}function get(F,B,W){var z=null==F?G:baseGet(F,B);return z===G?W:z}function has(F,B){return null!=F&&hasPath(F,B,baseHas)}function hasIn(F,B){return null!=F&&hasPath(F,B,baseHasIn)}var xr=createInverter((function(F,B,G){null!=B&&"function"!=typeof B.toString&&(B=nn.call(B)),F[B]=G}),constant(identity)),Ur=createInverter((function(F,B,G){null!=B&&"function"!=typeof B.toString&&(B=nn.call(B)),Zt.call(F,B)?F[B].push(G):F[B]=[G]}),getIteratee),jr=baseRest(baseInvoke);function keys(F){return isArrayLike(F)?arrayLikeKeys(F):baseKeys(F)}function keysIn(F){return isArrayLike(F)?arrayLikeKeys(F,!0):baseKeysIn(F)}function mapKeys(F,B){var G={};return B=getIteratee(B,3),baseForOwn(F,(function(F,W,z){baseAssignValue(G,B(F,W,z),F)})),G}function mapValues(F,B){var G={};return B=getIteratee(B,3),baseForOwn(F,(function(F,W,z){baseAssignValue(G,W,B(F,W,z))})),G}var Br=createAssigner((function(F,B,G){baseMerge(F,B,G)})),Hr=createAssigner((function(F,B,G,W){baseMerge(F,B,G,W)})),Vr=flatRest((function(F,B){var G={};if(null==F)return G;var W=!1;B=arrayMap(B,(function(B){return B=castPath(B,F),W||(W=B.length>1),B})),copyObject(F,getAllKeysIn(F),G),W&&(G=baseClone(G,ee|te|ne,customOmitClone));for(var z=B.length;z--;)baseUnset(G,B[z]);return G}));function omitBy(F,B){return pickBy(F,negate(getIteratee(B)))}var Gr=flatRest((function(F,B){return null==F?{}:basePick(F,B)}));function pickBy(F,B){if(null==F)return{};var G=arrayMap(getAllKeysIn(F),(function(F){return[F]}));return B=getIteratee(B),basePickBy(F,G,(function(F,G){return B(F,G[0])}))}function result(F,B,W){var z=-1,K=(B=castPath(B,F)).length;for(K||(K=1,F=G);++z<K;){var J=null==F?G:F[toKey(B[z])];J===G&&(z=K,J=W),F=isFunction(J)?J.call(F):J}return F}function set(F,B,G){return null==F?F:baseSet(F,B,G)}function setWith(F,B,W,z){return z="function"==typeof z?z:G,null==F?F:baseSet(F,B,W,z)}var Wr=createToPairs(keys),qr=createToPairs(keysIn);function transform(F,B,G){var W=_r(F),z=W||Tr(F)||Rr(F);if(B=getIteratee(B,4),null==G){var K=F&&F.constructor;G=z?W?new K:[]:isObject(F)&&isFunction(K)?vi(un(F)):{}}return(z?arrayEach:baseForOwn)(F,(function(F,W,z){return B(G,F,W,z)})),G}function unset(F,B){return null==F||baseUnset(F,B)}function update(F,B,G){return null==F?F:baseUpdate(F,B,castFunction(G))}function updateWith(F,B,W,z){return z="function"==typeof z?z:G,null==F?F:baseUpdate(F,B,castFunction(W),z)}function values(F){return null==F?[]:baseValues(F,keys(F))}function valuesIn(F){return null==F?[]:baseValues(F,keysIn(F))}function clamp(F,B,W){return W===G&&(W=B,B=G),W!==G&&(W=(W=toNumber(W))==W?W:0),B!==G&&(B=(B=toNumber(B))==B?B:0),baseClamp(toNumber(F),B,W)}function inRange(F,B,W){return B=toFinite(B),W===G?(W=B,B=0):W=toFinite(W),baseInRange(F=toNumber(F),B,W)}function random(F,B,W){if(W&&"boolean"!=typeof W&&isIterateeCall(F,B,W)&&(B=W=G),W===G&&("boolean"==typeof B?(W=B,B=G):"boolean"==typeof F&&(W=F,F=G)),F===G&&B===G?(F=0,B=1):(F=toFinite(F),B===G?(B=F,F=0):B=toFinite(B)),F>B){var z=F;F=B,B=z}if(W||F%1||B%1){var K=Gn();return Un(F+K*(B-F+kn("1e-"+((K+"").length-1))),B)}return baseRandom(F,B)}var zr=createCompounder((function(F,B,G){return B=B.toLowerCase(),F+(G?capitalize(B):B)}));function capitalize(F){return Zr(toString(F).toLowerCase())}function deburr(F){return(F=toString(F))&&F.replace(jt,Xn).replace(Tn,"")}function endsWith(F,B,W){F=toString(F),B=baseToString(B);var z=F.length,K=W=W===G?z:baseClamp(toInteger(W),0,z);return(W-=B.length)>=0&&F.slice(W,K)==B}function escape(F){return(F=toString(F))&&ft.test(F)?F.replace(ht,Zn):F}function escapeRegExp(F){return(F=toString(F))&&Et.test(F)?F.replace(Tt,"\\$&"):F}var Kr=createCompounder((function(F,B,G){return F+(G?"-":"")+B.toLowerCase()})),Jr=createCompounder((function(F,B,G){return F+(G?" ":"")+B.toLowerCase()})),Qr=createCaseFirst("toLowerCase");function pad(F,B,G){F=toString(F);var W=(B=toInteger(B))?stringSize(F):0;if(!B||W>=B)return F;var z=(B-W)/2;return createPadding(In(z),G)+F+createPadding(bn(z),G)}function padEnd(F,B,G){F=toString(F);var W=(B=toInteger(B))?stringSize(F):0;return B&&W<B?F+createPadding(B-W,G):F}function padStart(F,B,G){F=toString(F);var W=(B=toInteger(B))?stringSize(F):0;return B&&W<B?createPadding(B-W,G)+F:F}function parseInt(F,B,G){return G||null==B?B=0:B&&(B=+B),Hn(toString(F).replace(bt,""),B||0)}function repeat(F,B,W){return B=(W?isIterateeCall(F,B,W):B===G)?1:toInteger(B),baseRepeat(toString(F),B)}function replace(){var F=arguments,B=toString(F[0]);return F.length<3?B:B.replace(F[1],F[2])}var Yr=createCompounder((function(F,B,G){return F+(G?"_":"")+B.toLowerCase()}));function split(F,B,W){return W&&"number"!=typeof W&&isIterateeCall(F,B,W)&&(B=W=G),(W=W===G?Ae:W>>>0)?(F=toString(F))&&("string"==typeof B||null!=B&&!Ir(B))&&!(B=baseToString(B))&&hasUnicode(F)?castSlice(stringToArray(F),0,W):F.split(B,W):[]}var $r=createCompounder((function(F,B,G){return F+(G?" ":"")+Zr(B)}));function startsWith(F,B,G){return F=toString(F),G=null==G?0:baseClamp(toInteger(G),0,F.length),B=baseToString(B),F.slice(G,G+B.length)==B}function template(F,B,W){var z=lodash.templateSettings;W&&isIterateeCall(F,B,W)&&(B=G),F=toString(F),B=Dr({},B,z,customDefaultsAssignIn);var K,J,Q=Dr({},B.imports,z.imports,customDefaultsAssignIn),$=keys(Q),X=baseValues(Q,$),Z=0,ee=B.interpolate||Bt,te="__p += '",ne=qt((B.escape||Bt).source+"|"+ee.source+"|"+(ee===yt?Dt:Bt).source+"|"+(B.evaluate||Bt).source+"|$","g"),ie="//# sourceURL="+(Zt.call(B,"sourceURL")?(B.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Pn+"]")+"\n";F.replace(ne,(function(B,G,W,z,Q,Y){return W||(W=z),te+=F.slice(Z,Y).replace(Ht,escapeStringChar),G&&(K=!0,te+="' +\n__e("+G+") +\n'"),Q&&(J=!0,te+="';\n"+Q+";\n__p += '"),W&&(te+="' +\n((__t = ("+W+")) == null ? '' : __t) +\n'"),Z=Y+B.length,B})),te+="';\n";var re=Zt.call(B,"variable")&&B.variable;if(re){if(Mt.test(re))throw new Ot(Y)}else te="with (obj) {\n"+te+"\n}\n";te=(J?te.replace(lt,""):te).replace(dt,"$1").replace(ut,"$1;"),te="function("+(re||"obj")+") {\n"+(re?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(K?", __e = _.escape":"")+(J?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+te+"return __p\n}";var oe=eo((function(){return Vt($,ie+"return "+te).apply(G,X)}));if(oe.source=te,isError(oe))throw oe;return oe}function toLower(F){return toString(F).toLowerCase()}function toUpper(F){return toString(F).toUpperCase()}function trim(F,B,W){if((F=toString(F))&&(W||B===G))return baseTrim(F);if(!F||!(B=baseToString(B)))return F;var z=stringToArray(F),K=stringToArray(B);return castSlice(z,charsStartIndex(z,K),charsEndIndex(z,K)+1).join("")}function trimEnd(F,B,W){if((F=toString(F))&&(W||B===G))return F.slice(0,trimmedEndIndex(F)+1);if(!F||!(B=baseToString(B)))return F;var z=stringToArray(F);return castSlice(z,0,charsEndIndex(z,stringToArray(B))+1).join("")}function trimStart(F,B,W){if((F=toString(F))&&(W||B===G))return F.replace(bt,"");if(!F||!(B=baseToString(B)))return F;var z=stringToArray(F);return castSlice(z,charsStartIndex(z,stringToArray(B))).join("")}function truncate(F,B){var W=fe,z=me;if(isObject(B)){var K="separator"in B?B.separator:K;W="length"in B?toInteger(B.length):W,z="omission"in B?baseToString(B.omission):z}var J=(F=toString(F)).length;if(hasUnicode(F)){var Q=stringToArray(F);J=Q.length}if(W>=J)return F;var Y=W-stringSize(z);if(Y<1)return z;var $=Q?castSlice(Q,0,Y).join(""):F.slice(0,Y);if(K===G)return $+z;if(Q&&(Y+=$.length-Y),Ir(K)){if(F.slice(Y).search(K)){var X,Z=$;for(K.global||(K=qt(K.source,toString(Nt.exec(K))+"g")),K.lastIndex=0;X=K.exec(Z);)var ee=X.index;$=$.slice(0,ee===G?Y:ee)}}else if(F.indexOf(baseToString(K),Y)!=Y){var te=$.lastIndexOf(K);te>-1&&($=$.slice(0,te))}return $+z}function unescape(F){return(F=toString(F))&&gt.test(F)?F.replace(pt,ei):F}var Xr=createCompounder((function(F,B,G){return F+(G?" ":"")+B.toUpperCase()})),Zr=createCaseFirst("toUpperCase");function words(F,B,W){return F=toString(F),(B=W?G:B)===G?hasUnicodeWord(F)?unicodeWords(F):asciiWords(F):F.match(B)||[]}var eo=baseRest((function(F,B){try{return apply(F,G,B)}catch(F){return isError(F)?F:new Ot(F)}})),to=flatRest((function(F,B){return arrayEach(B,(function(B){B=toKey(B),baseAssignValue(F,B,lr(F[B],F))})),F}));function cond(F){var B=null==F?0:F.length,G=getIteratee();return F=B?arrayMap(F,(function(F){if("function"!=typeof F[1])throw new Kt(Q);return[G(F[0]),F[1]]})):[],baseRest((function(G){for(var W=-1;++W<B;){var z=F[W];if(apply(z[0],this,G))return apply(z[1],this,G)}}))}function conforms(F){return baseConforms(baseClone(F,ee))}function constant(F){return function(){return F}}function defaultTo(F,B){return null==F||F!=F?B:F}var no=createFlow(),io=createFlow(!0);function identity(F){return F}function iteratee(F){return baseIteratee("function"==typeof F?F:baseClone(F,ee))}function matches(F){return baseMatches(baseClone(F,ee))}function matchesProperty(F,B){return baseMatchesProperty(F,baseClone(B,ee))}var ro=baseRest((function(F,B){return function(G){return baseInvoke(G,F,B)}})),oo=baseRest((function(F,B){return function(G){return baseInvoke(F,G,B)}}));function mixin(F,B,G){var W=keys(B),z=baseFunctions(B,W);null!=G||isObject(B)&&(z.length||!W.length)||(G=B,B=F,F=this,z=baseFunctions(B,keys(B)));var K=!(isObject(G)&&"chain"in G&&!G.chain),J=isFunction(F);return arrayEach(z,(function(G){var W=B[G];F[G]=W,J&&(F.prototype[G]=function(){var B=this.__chain__;if(K||B){var G=F(this.__wrapped__);return(G.__actions__=copyArray(this.__actions__)).push({func:W,args:arguments,thisArg:F}),G.__chain__=B,G}return W.apply(F,arrayPush([this.value()],arguments))})})),F}function noConflict(){return jn._===this&&(jn._=on),this}function noop(){}function nthArg(F){return F=toInteger(F),baseRest((function(B){return baseNth(B,F)}))}var ao=createOver(arrayMap),so=createOver(arrayEvery),co=createOver(arraySome);function property(F){return isKey(F)?baseProperty(toKey(F)):basePropertyDeep(F)}function propertyOf(F){return function(B){return null==F?G:baseGet(F,B)}}var lo=createRange(),uo=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return!0}function times(F,B){if((F=toInteger(F))<1||F>Ee)return[];var G=Ae,W=Un(F,Ae);B=getIteratee(B),F-=Ae;for(var z=baseTimes(W,B);++G<F;)B(G);return z}function toPath(F){return _r(F)?arrayMap(F,toKey):isSymbol(F)?[F]:copyArray(ki(toString(F)))}function uniqueId(F){var B=++en;return toString(F)+B}var po=createMathOperation((function(F,B){return F+B}),0),ho=createRound("ceil"),go=createMathOperation((function(F,B){return F/B}),1),fo=createRound("floor");function max(F){return F&&F.length?baseExtremum(F,identity,baseGt):G}function maxBy(F,B){return F&&F.length?baseExtremum(F,getIteratee(B,2),baseGt):G}function mean(F){return baseMean(F,identity)}function meanBy(F,B){return baseMean(F,getIteratee(B,2))}function min(F){return F&&F.length?baseExtremum(F,identity,baseLt):G}function minBy(F,B){return F&&F.length?baseExtremum(F,getIteratee(B,2),baseLt):G}var mo,vo=createMathOperation((function(F,B){return F*B}),1),yo=createRound("round"),So=createMathOperation((function(F,B){return F-B}),0);function sum(F){return F&&F.length?baseSum(F,identity):0}function sumBy(F,B){return F&&F.length?baseSum(F,getIteratee(B,2)):0}return lodash.after=after,lodash.ary=ary,lodash.assign=Mr,lodash.assignIn=wr,lodash.assignInWith=Dr,lodash.assignWith=Nr,lodash.at=Lr,lodash.before=before,lodash.bind=lr,lodash.bindAll=to,lodash.bindKey=dr,lodash.castArray=castArray,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.concat=concat,lodash.cond=cond,lodash.conforms=conforms,lodash.constant=constant,lodash.countBy=er,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=kr,lodash.defaultsDeep=Fr,lodash.defer=ur,lodash.delay=pr,lodash.difference=Fi,lodash.differenceBy=xi,lodash.differenceWith=Ui,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatMap=flatMap,lodash.flatMapDeep=flatMapDeep,lodash.flatMapDepth=flatMapDepth,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flattenDepth=flattenDepth,lodash.flip=flip,lodash.flow=no,lodash.flowRight=io,lodash.fromPairs=fromPairs,lodash.functions=functions,lodash.functionsIn=functionsIn,lodash.groupBy=ir,lodash.initial=initial,lodash.intersection=ji,lodash.intersectionBy=Bi,lodash.intersectionWith=Hi,lodash.invert=xr,lodash.invertBy=Ur,lodash.invokeMap=rr,lodash.iteratee=iteratee,lodash.keyBy=or,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=Br,lodash.mergeWith=Hr,lodash.method=ro,lodash.methodOf=oo,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=nthArg,lodash.omit=Vr,lodash.omitBy=omitBy,lodash.once=once,lodash.orderBy=orderBy,lodash.over=ao,lodash.overArgs=hr,lodash.overEvery=so,lodash.overSome=co,lodash.partial=gr,lodash.partialRight=fr,lodash.partition=ar,lodash.pick=Gr,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=Vi,lodash.pullAll=pullAll,lodash.pullAllBy=pullAllBy,lodash.pullAllWith=pullAllWith,lodash.pullAt=Gi,lodash.range=lo,lodash.rangeRight=uo,lodash.rearg=mr,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.reverse=reverse,lodash.sampleSize=sampleSize,lodash.set=set,lodash.setWith=setWith,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=sr,lodash.sortedUniq=sortedUniq,lodash.sortedUniqBy=sortedUniqBy,lodash.split=split,lodash.spread=spread,lodash.tail=tail,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=Wr,lodash.toPairsIn=qr,lodash.toPath=toPath,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.unary=unary,lodash.union=Wi,lodash.unionBy=qi,lodash.unionWith=zi,lodash.uniq=uniq,lodash.uniqBy=uniqBy,lodash.uniqWith=uniqWith,lodash.unset=unset,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=update,lodash.updateWith=updateWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.without=Ki,lodash.words=words,lodash.wrap=wrap,lodash.xor=Ji,lodash.xorBy=Qi,lodash.xorWith=Yi,lodash.zip=$i,lodash.zipObject=zipObject,lodash.zipObjectDeep=zipObjectDeep,lodash.zipWith=Xi,lodash.entries=Wr,lodash.entriesIn=qr,lodash.extend=wr,lodash.extendWith=Dr,mixin(lodash,lodash),lodash.add=po,lodash.attempt=eo,lodash.camelCase=zr,lodash.capitalize=capitalize,lodash.ceil=ho,lodash.clamp=clamp,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.cloneDeepWith=cloneDeepWith,lodash.cloneWith=cloneWith,lodash.conformsTo=conformsTo,lodash.deburr=deburr,lodash.defaultTo=defaultTo,lodash.divide=go,lodash.endsWith=endsWith,lodash.eq=eq,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=tr,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=nr,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.floor=fo,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.get=get,lodash.gt=vr,lodash.gte=yr,lodash.has=has,lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.invoke=jr,lodash.isArguments=Sr,lodash.isArray=_r,lodash.isArrayBuffer=Cr,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=isBoolean,lodash.isBuffer=Tr,lodash.isDate=Er,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isEqualWith=isEqualWith,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=br,lodash.isMatch=isMatch,lodash.isMatchWith=isMatchWith,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNil=isNil,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=Ir,lodash.isSafeInteger=isSafeInteger,lodash.isSet=Ar,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=Rr,lodash.isUndefined=isUndefined,lodash.isWeakMap=isWeakMap,lodash.isWeakSet=isWeakSet,lodash.join=join,lodash.kebabCase=Kr,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lowerCase=Jr,lodash.lowerFirst=Qr,lodash.lt=Pr,lodash.lte=Or,lodash.max=max,lodash.maxBy=maxBy,lodash.mean=mean,lodash.meanBy=meanBy,lodash.min=min,lodash.minBy=minBy,lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=stubObject,lodash.stubString=stubString,lodash.stubTrue=stubTrue,lodash.multiply=vo,lodash.nth=nth,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=cr,lodash.pad=pad,lodash.padEnd=padEnd,lodash.padStart=padStart,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.replace=replace,lodash.result=result,lodash.round=yo,lodash.runInContext=runInContext,lodash.sample=sample,lodash.size=size,lodash.snakeCase=Yr,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedIndexBy=sortedIndexBy,lodash.sortedIndexOf=sortedIndexOf,lodash.sortedLastIndex=sortedLastIndex,lodash.sortedLastIndexBy=sortedLastIndexBy,lodash.sortedLastIndexOf=sortedLastIndexOf,lodash.startCase=$r,lodash.startsWith=startsWith,lodash.subtract=So,lodash.sum=sum,lodash.sumBy=sumBy,lodash.template=template,lodash.times=times,lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=toLower,lodash.toNumber=toNumber,lodash.toSafeInteger=toSafeInteger,lodash.toString=toString,lodash.toUpper=toUpper,lodash.trim=trim,lodash.trimEnd=trimEnd,lodash.trimStart=trimStart,lodash.truncate=truncate,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.upperCase=Xr,lodash.upperFirst=Zr,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(mo={},baseForOwn(lodash,(function(F,B){Zt.call(lodash.prototype,B)||(mo[B]=F)})),mo),{chain:!1}),lodash.VERSION=W,arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(F){lodash[F].placeholder=lodash})),arrayEach(["drop","take"],(function(F,B){LazyWrapper.prototype[F]=function(W){W=W===G?1:xn(toInteger(W),0);var z=this.__filtered__&&!B?new LazyWrapper(this):this.clone();return z.__filtered__?z.__takeCount__=Un(W,z.__takeCount__):z.__views__.push({size:Un(W,Ae),type:F+(z.__dir__<0?"Right":"")}),z},LazyWrapper.prototype[F+"Right"]=function(B){return this.reverse()[F](B).reverse()}})),arrayEach(["filter","map","takeWhile"],(function(F,B){var G=B+1,W=G==Se||G==Ce;LazyWrapper.prototype[F]=function(F){var B=this.clone();return B.__iteratees__.push({iteratee:getIteratee(F,3),type:G}),B.__filtered__=B.__filtered__||W,B}})),arrayEach(["head","last"],(function(F,B){var G="take"+(B?"Right":"");LazyWrapper.prototype[F]=function(){return this[G](1).value()[0]}})),arrayEach(["initial","tail"],(function(F,B){var G="drop"+(B?"":"Right");LazyWrapper.prototype[F]=function(){return this.__filtered__?new LazyWrapper(this):this[G](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(F){return this.filter(F).head()},LazyWrapper.prototype.findLast=function(F){return this.reverse().find(F)},LazyWrapper.prototype.invokeMap=baseRest((function(F,B){return"function"==typeof F?new LazyWrapper(this):this.map((function(G){return baseInvoke(G,F,B)}))})),LazyWrapper.prototype.reject=function(F){return this.filter(negate(getIteratee(F)))},LazyWrapper.prototype.slice=function(F,B){F=toInteger(F);var W=this;return W.__filtered__&&(F>0||B<0)?new LazyWrapper(W):(F<0?W=W.takeRight(-F):F&&(W=W.drop(F)),B!==G&&(W=(B=toInteger(B))<0?W.dropRight(-B):W.take(B-F)),W)},LazyWrapper.prototype.takeRightWhile=function(F){return this.reverse().takeWhile(F).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(Ae)},baseForOwn(LazyWrapper.prototype,(function(F,B){var W=/^(?:filter|find|map|reject)|While$/.test(B),z=/^(?:head|last)$/.test(B),K=lodash[z?"take"+("last"==B?"Right":""):B],J=z||/^find/.test(B);K&&(lodash.prototype[B]=function(){var B=this.__wrapped__,Q=z?[1]:arguments,Y=B instanceof LazyWrapper,$=Q[0],X=Y||_r(B),interceptor=function(F){var B=K.apply(lodash,arrayPush([F],Q));return z&&Z?B[0]:B};X&&W&&"function"==typeof $&&1!=$.length&&(Y=X=!1);var Z=this.__chain__,ee=!!this.__actions__.length,te=J&&!Z,ne=Y&&!ee;if(!J&&X){B=ne?B:new LazyWrapper(this);var ie=F.apply(B,Q);return ie.__actions__.push({func:thru,args:[interceptor],thisArg:G}),new LodashWrapper(ie,Z)}return te&&ne?F.apply(this,Q):(ie=this.thru(interceptor),te?z?ie.value()[0]:ie.value():ie)})})),arrayEach(["pop","push","shift","sort","splice","unshift"],(function(F){var B=Jt[F],G=/^(?:push|sort|unshift)$/.test(F)?"tap":"thru",W=/^(?:pop|shift)$/.test(F);lodash.prototype[F]=function(){var F=arguments;if(W&&!this.__chain__){var z=this.value();return B.apply(_r(z)?z:[],F)}return this[G]((function(G){return B.apply(_r(G)?G:[],F)}))}})),baseForOwn(LazyWrapper.prototype,(function(F,B){var G=lodash[B];if(G){var W=G.name+"";Zt.call(ci,W)||(ci[W]=[]),ci[W].push({name:B,func:G})}})),ci[createHybrid(G,ae).name]=[{name:"wrapper",func:G}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.at=Zi,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.next=wrapperNext,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.first=lodash.prototype.head,mn&&(lodash.prototype[mn]=wrapperToIterator),lodash},ni=ti();Hn?((Hn.exports=ni)._=ni,Bn._=ni):jn._=ni}).call(z)})),J=createCommonjsModule((function(F,B){function vsprintf(F,B){var G=0;return F.replace(/%[dixs%]/g,(function(F){var W=0;if("%"!==F[W++])return"";var z=F[W++];return"%"===z?"%":"s"===z||"d"===z||"i"===z?B[G++]:"x"===z?B[G++].toString(16):F}))}function sprintf(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];return vsprintf(F,B)}
/*!
	 *  AufLog.ts
	 *  AUF
	 *
	 *  Created by Johan Blumenberg on 2016-12-29
	 *  Copyright 2016 Microsoft. All rights reserved.
	 *
	 */
Object.defineProperty(B,"__esModule",{value:!0}),function(F){F[F.Trace=10]="Trace",F[F.Debug6=16]="Debug6",F[F.Debug5=18]="Debug5",F[F.Debug4=20]="Debug4",F[F.Debug3=30]="Debug3",F[F.Debug2=40]="Debug2",F[F.Debug1=50]="Debug1",F[F.Warning=60]="Warning",F[F.Error=70]="Error",F[F.Fatal=80]="Fatal",F[F.MetaData=90]="MetaData"}(B.LogLevel||(B.LogLevel={})),function(F){F[F.UseDefault=0]="UseDefault",F[F.Compress=1]="Compress",F[F.Disabled=2]="Disabled"}(B.LogFileCompression||(B.LogFileCompression={})),function(F){F[F.Raw=0]="Raw",F[F.Base64=1]="Base64"}(B.LogFileEncoding||(B.LogFileEncoding={})),function(F){F[F.Unencrypted=0]="Unencrypted",F[F.Encrypted=1]="Encrypted"}(B.LogFileEncryption||(B.LogFileEncryption={})),function(F){F[F.PEM=0]="PEM",F[F.DER=1]="DER",F[F.BER=2]="BER"}(B.CertStoreFormat||(B.CertStoreFormat={})),function(F){F[F.InsertFront=8]="InsertFront"}(B.AppenderFlags||(B.AppenderFlags={})),B.vsprintf=vsprintf,B.sprintf=sprintf})),Q=createCommonjsModule((function(F,B){
/*!
	 *  LogFactory.ts
	 *  AUF
	 *
	 *  Created by Johan Blumenberg on 2016-12-29
	 *  Copyright 2016 Microsoft. All rights reserved.
	 *
	 */
var G,W,K=z&&z.__extends||(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])},function(F,B){function __(){this.constructor=F}G(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});function hash(F){if(null===F)return-1;for(var B=0,G=F.length-1;G>=0;G--)B=37*B+F.charCodeAt(G)|0;var W="__auf_literal:";for(G=W.length-1;G>=0;G--)B=37*B+W.charCodeAt(G)|0;return B}Object.defineProperty(B,"__esModule",{value:!0}),function(F){F[F.Unsafe=0]="Unsafe",F[F.Safe=1]="Safe",F[F.Inherited_Unsafe=2]="Inherited_Unsafe",F[F.Inherited_Safe=3]="Inherited_Safe",F[F.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(W||(W={}));var Q,Y=function(){function LogComponentImpl(F,B){this._level=J.LogLevel.Debug4,this._threshold=255,this._safe=W.Inherited_Unsafe,this._name=F,B&&(this._level=B.level(),this._safe=B.safe()?W.Inherited_Safe:W.Inherited_Unsafe,this._extendedInfo=B.extendedInfo())}return LogComponentImpl.prototype.name=function(){return this._name},LogComponentImpl.prototype.safe=function(){return this._safe===W.Safe||this._safe===W.Inherited_Safe},LogComponentImpl.prototype.safety=function(){return this._safe},LogComponentImpl.prototype.setSafety=function(F){this._safe=F},LogComponentImpl.prototype.description=function(){return this._desc},LogComponentImpl.prototype.setDescription=function(F){this._desc=F},LogComponentImpl.prototype.level=function(){return this._level},LogComponentImpl.prototype.setLevel=function(F){Q.setLevel(this,F)},LogComponentImpl.prototype._setLevel=function(F){this._level=F},LogComponentImpl.prototype._setThreshold=function(F){this._threshold=F},LogComponentImpl.prototype.isEnabled=function(F){return this._threshold<=F},LogComponentImpl.prototype.setExtendedInfo=function(F){this._extendedInfo=F},LogComponentImpl.prototype.extendedInfo=function(){return this._extendedInfo},LogComponentImpl.prototype.trace=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Trace,hash(F),F].concat(B))},LogComponentImpl.prototype.debug6=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Debug6,hash(F),F].concat(B))},LogComponentImpl.prototype.debug5=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Debug5,hash(F),F].concat(B))},LogComponentImpl.prototype.debug4=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Debug4,hash(F),F].concat(B))},LogComponentImpl.prototype.debug3=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Debug3,hash(F),F].concat(B))},LogComponentImpl.prototype.debug2=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Debug2,hash(F),F].concat(B))},LogComponentImpl.prototype.debug1=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Debug1,hash(F),F].concat(B))},LogComponentImpl.prototype.warn=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Warning,hash(F),F].concat(B))},LogComponentImpl.prototype.error=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Error,hash(F),F].concat(B))},LogComponentImpl.prototype.fatal=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.Fatal,hash(F),F].concat(B))},LogComponentImpl.prototype.meta=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];Q.log.apply(Q,[this,J.LogLevel.MetaData,hash(F),F].concat(B))},LogComponentImpl}(),$=function(){function LogFactory(){}return LogFactory.instance=function(){return Q},LogFactory.levelToString=function(F){return F<=J.LogLevel.Trace?"TRACE":F<=J.LogLevel.Debug6?"DEBUG6":F<=J.LogLevel.Debug5?"DEBUG5":F<=J.LogLevel.Debug4?"DEBUG4":F<=J.LogLevel.Debug3?"DEBUG3":F<=J.LogLevel.Debug2?"DEBUG2":F<=J.LogLevel.Debug1?"DEBUG1":F<=J.LogLevel.Warning?"WARN":F<=J.LogLevel.Error?"ERROR":F<=J.LogLevel.Fatal?"FATAL":(J.LogLevel.MetaData,"META")},LogFactory.levelFromString=function(F){return this._levelFromString[F]||parseInt(F,10)},LogFactory}();function findLevel(F,B){for(var G=B.name();G.length>0;){if(F[G])return F[G];var W=G.lastIndexOf(".");G=W<0?"":G.substr(0,W)}return F[""]?F[""]:J.LogLevel.Debug4}function findThreshold(F,B){var G=255;return B.forEach((function(B){var W=255;B.appender.levels()?W=Math.min(W,findLevel(B.appender.levels(),F)):B.appender.receiveAll()||(W=Math.min(W,F.level())),G=Math.min(G,W)})),G}function appenderMatches(F,B,G){return!!F.appender.receiveAll()||(F.appender.levels()?G>=findLevel(F.appender.levels(),B):G>=B.level())}$._levelFromString={TRACE:J.LogLevel.Trace,DEBUG6:J.LogLevel.Debug6,DEBUG5:J.LogLevel.Debug5,DEBUG4:J.LogLevel.Debug4,DEBUG3:J.LogLevel.Debug3,DEBUG2:J.LogLevel.Debug2,DEBUG1:J.LogLevel.Debug1,WARN:J.LogLevel.Warning,ERROR:J.LogLevel.Error,FATAL:J.LogLevel.Fatal,META:J.LogLevel.MetaData},B.LogFactory=$;var X=function(F){function LogFactoryImpl(){var B=F.call(this)||this;return B._nextId=0,B._appenders=[],B._components={},B._componentBlacklist=[],B._components[""]=new Y("",null),B}return K(LogFactoryImpl,F),LogFactoryImpl.prototype.toHex=function(F){return(4294967296+F).toString(16).substr(-8)},LogFactoryImpl.prototype.addAppender=function(F,B){void 0===B&&(B=0);var G=this._nextId++;return B&J.AppenderFlags.InsertFront?this._appenders.unshift({appender:F,handle:G}):this._appenders.push({appender:F,handle:G}),this.recalcComponentThresholds(),G},LogFactoryImpl.prototype.removeAppender=function(F){for(var B=0;B<this._appenders.length;B++)if(this._appenders[B].handle===F){this._appenders.splice(B,1);break}this.recalcComponentThresholds()},LogFactoryImpl.prototype.log=function(F,B,G,W){for(var z=[],K=4;K<arguments.length;K++)z[K-4]=arguments[K];try{if(F.isEnabled(B)){var J={timestamp:(new Date).getTime(),component:F,level:B};this._appenders.forEach((function(K){appenderMatches(K,F,B)&&K.appender.log(J,G,W,z)}))}}catch(F){}},LogFactoryImpl.prototype.parent=function(F){for(;;){var B=F.lastIndexOf(".");if(F=B>=0?F.substr(0,B):"",this._components[F])return this._components[F]}},LogFactoryImpl.prototype.children=function(F){var B=[];for(var G in this._components)this.parent(G).name()===F&&B.push(this._components[G]);return B},LogFactoryImpl.prototype.component=function(F){if(this._components[F])return this._components[F];var B=new Y(F,this.parent(F));this._components[F]=B;var G=findThreshold(B,this._appenders);return B._setThreshold(G),B},LogFactoryImpl.prototype.rootComponent=function(){return this.component("")},LogFactoryImpl.prototype.setSafetyRecursive=function(F,B){var G=this;this.children(F).forEach((function(F){F.safety()!==W.Inherited_Safe&&F.safety()!==W.Inherited_Unsafe||(F.setSafety(B),G.setSafetyRecursive(F.name(),B))}))},LogFactoryImpl.prototype.declareComponentSafe=function(F,B){var G=this.component(F);-1!==this._componentBlacklist.indexOf(G.name())?G.setSafety(W.Blacklisted_Unsafe):G.setSafety(B?W.Safe:W.Unsafe),this.setSafetyRecursive(F,B?W.Inherited_Safe:W.Inherited_Unsafe)},LogFactoryImpl.prototype.declareComponentDescription=function(F,B){this.component(F).setDescription(B)},LogFactoryImpl.prototype.setExtendedInfoRecursive=function(F,B){var G=this;this.children(F).forEach((function(F){void 0===F.extendedInfo()&&(F.setExtendedInfo(B),G.setExtendedInfoRecursive(F.name(),B))}))},LogFactoryImpl.prototype.declareComponentExtendedInfo=function(F,B){var G=this.component(F);G.setExtendedInfo(B),this.setExtendedInfoRecursive(G.name(),B)},LogFactoryImpl.prototype.recalcComponentThresholds=function(){for(var F in this._components){var B=this._components[F],G=findThreshold(B,this._appenders);B._setThreshold(G)}},LogFactoryImpl.prototype.setLevel=function(F,B){if(""===F.name())for(var G in this._components){(K=this._components[G])._setLevel(B);var W=findThreshold(K,this._appenders);K._setThreshold(W)}else{var z=F.name()+".";F._setLevel(B);W=findThreshold(F,this._appenders);for(var G in F._setThreshold(W),this._components){var K;if((K=this._components[G]).name().substr(0,z.length)===z){K._setLevel(B);var J=findThreshold(K,this._appenders);K._setThreshold(J)}}}},LogFactoryImpl.prototype.setComponentBlacklist=function(F){for(var B in this._componentBlacklist=F,this._components){var G=this._components[B];-1!==this._componentBlacklist.indexOf(G.name())&&G.setSafety(W.Blacklisted_Unsafe)}},LogFactoryImpl}($);Q=new X})),Y=createCommonjsModule((function(F,B){function fromThenable(F){var B=Defer();return F.then((function(F){B.resolve(F)}),(function(F){B.reject(F)})),B.promise().thenAsync((function(F){return F}))}function isThenable(F){return null!=F&&"function"==typeof F.then}function isCancelable(F){return null!=F&&"function"==typeof F.cancel}function run(F,G){if(!B.config.catchExceptions)return F();try{return F()}catch(F){return G(F)}}Object.defineProperty(B,"__esModule",{value:!0}),B.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(F){throw F}},B.fromThenable=fromThenable;var G,W=[],z="undefined"!=typeof setImmediate;function asyncCallback(F){W.push(F),1===W.length&&(z?setImmediate(resolveAsyncCallbacks):setTimeout(resolveAsyncCallbacks,0))}function resolveAsyncCallbacks(){var F=W;W=[];for(var B=0;B<F.length;B++)F[B]()}function all(F){if(0===F.length)return Resolved([]);var B,W=Defer(),z=F.length,K=Array(F.length);W.onCancel((function(B){F.forEach((function(F){isCancelable(F)&&G.SyncTask.cancelOtherInternal(F,B)}))}));var checkFinish=function(){0==--z&&(void 0!==B?W.reject(B):W.resolve(K))};return F.forEach((function(F,G){isThenable(F)?F.then((function(F){K[G]=F,checkFinish()}),(function(F){void 0===B&&(B=void 0===F||F),checkFinish()})):(K[G]=F,checkFinish())})),W.promise()}function Defer(){return new G.SyncTask}function Resolved(F){return(new G.SyncTask).resolve(F).promise()}function Rejected(F){return(new G.SyncTask).reject(F).promise()}function race(F){var B=Defer(),W=!1;return B.onCancel((function(B){F.forEach((function(F){isCancelable(F)&&G.SyncTask.cancelOtherInternal(F,B)}))})),F.forEach((function(F){isThenable(F)?F.then((function(F){W||(W=!0,B.resolve(F))}),(function(F){W||(W=!0,B.reject(F))})):W||(W=!0,B.resolve(F))})),B.promise()}function raceTimer(F,B){var G=Defer(),W=setTimeout((function(){G.resolve({timedOut:!0})}),B);return race([F.then((function(F){return clearTimeout(W),{timedOut:!1,result:F}})),G.promise()])}B.asyncCallback=asyncCallback,function(F){var G=function(){function SyncTask(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return SyncTask.prototype._addCallbackSet=function(F,B){var G=this,W=new SyncTask;return W.onCancel((function(B){F.wasCanceled=!0,F.cancelContext=B,G._cancelInternal(B)})),F.task=W,this._storedCallbackSets.push(F),B?this._mustHandleError=!1:W._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),W.promise()},SyncTask.prototype.onCancel=function(F){return this._completedSuccess||this._completedFail||(this._wasCanceled?F(this._cancelContext):this._cancelCallbacks.push(F)),this},SyncTask.prototype.then=function(F,B){return this._addCallbackSet({successFunc:F,failFunc:B},!0)},SyncTask.prototype.thenAsync=function(F,B){return this._addCallbackSet({successFunc:F,failFunc:B,asyncCallback:!0},!0)},SyncTask.prototype.catch=function(F){return this._addCallbackSet({failFunc:F},!0)},SyncTask.prototype.always=function(F){return this._addCallbackSet({successFunc:F,failFunc:F},!0)},SyncTask.prototype.setTracingEnabled=function(F){return this._traceEnabled=F,this},SyncTask.prototype.finally=function(F){return this._addCallbackSet({successFunc:F,failFunc:F},!1),this},SyncTask.prototype.done=function(F){return this._addCallbackSet({successFunc:F},!1),this},SyncTask.prototype.fail=function(F){return this._addCallbackSet({failFunc:F},!1),this},SyncTask.prototype.resolve=function(F){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=F,this._cancelCallbacks=[],this._resolveSuccesses(),this},SyncTask.prototype.reject=function(F){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=F,this._cancelCallbacks=[],this._resolveFailures(),SyncTask._enforceErrorHandled(this),this},SyncTask.prototype._checkState=function(F){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var G="Failed to "+(F?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(G)}(B.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},SyncTask._enforceErrorHandled=function(F){F._mustHandleError&&(SyncTask._rejectedTasks.push(F),SyncTask._enforceErrorHandledTimer||(SyncTask._enforceErrorHandledTimer=setTimeout((function(){SyncTask._enforceErrorHandledTimer=void 0;var F=SyncTask._rejectedTasks;SyncTask._rejectedTasks=[],F.forEach((function(F,G){F._mustHandleError&&B.config.unhandledErrorHandler(F._storedErrResolution)}))}),0)))},SyncTask.prototype.cancel=function(F){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(F)},SyncTask.prototype._cancelInternal=function(F){var B=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=F;var G=this._cancelCallbacks;this._cancelCallbacks=[],G.length>0&&G.forEach((function(F){B._completedSuccess||B._completedFail||F(B._cancelContext)}))}},SyncTask.cancelOtherInternal=function(F,B){var G=F;G._storedCallbackSets&&G._cancelInternal?G._cancelInternal(B):F.cancel(B)},SyncTask.prototype.promise=function(){return this},SyncTask.prototype._resolveSuccesses=function(){var F=this;for(this._resolving=!0;this._storedCallbackSets.length;){var B=this._storedCallbackSets;this._storedCallbackSets=[],B.forEach((function(B){B.asyncCallback?asyncCallback((function(){return F._resolveSuccessCallback(B)})):F._resolveSuccessCallback(B)}))}this._resolving=!1},SyncTask.prototype._resolveSuccessCallback=function(F){var B=this;F.successFunc?run((function(){var G=F.successFunc(B._storedResolution);isCancelable(G)&&(F.wasCanceled?SyncTask.cancelOtherInternal(G,F.cancelContext):F.task.onCancel((function(F){return SyncTask.cancelOtherInternal(G,F)}))),isThenable(G)?G.then((function(B){F.task.resolve(B)}),(function(B){F.task.reject(B)})):F.task.resolve(G)}),(function(G){B._handleException(G,"SyncTask caught exception in success block: "+G.toString()),F.task.reject(G)})):F.task.resolve(this._storedResolution)},SyncTask.prototype._resolveFailures=function(){var F=this;for(this._resolving=!0;this._storedCallbackSets.length;){var B=this._storedCallbackSets;this._storedCallbackSets=[],B.forEach((function(B){B.asyncCallback?asyncCallback((function(){return F._resolveFailureCallback(B)})):F._resolveFailureCallback(B)}))}this._resolving=!1},SyncTask.prototype._resolveFailureCallback=function(F){var B=this;F.failFunc?run((function(){var G=F.failFunc(B._storedErrResolution);isCancelable(G)&&(F.wasCanceled?SyncTask.cancelOtherInternal(G,F.cancelContext):F.task.onCancel((function(F){return SyncTask.cancelOtherInternal(G,F)}))),isThenable(G)?G.then((function(B){F.task.resolve(B)}),(function(B){F.task.reject(B)})):F.task.resolve(G)}),(function(G){B._handleException(G,"SyncTask caught exception in failure block: "+G.toString()),F.task.reject(G)})):F.task.reject(this._storedErrResolution)},SyncTask.prototype._handleException=function(F,G){B.config.exceptionsToConsole&&console.error(G),B.config.exceptionHandler&&B.config.exceptionHandler(F)},SyncTask.prototype.toEs6Promise=function(){var F=this;return new Promise((function(B,G){return F.then(B,G)}))},SyncTask._rejectedTasks=[],SyncTask}();F.SyncTask=G}(G||(G={})),B.all=all,B.Defer=Defer,B.Resolved=Resolved,B.Rejected=Rejected,B.race=race,B.raceTimer=raceTimer})),$=createCommonjsModule((function(F,B){
/*!
	 *  Appenders.ts
	 *  AUF
	 *
	 *  Created by Johan Blumenberg on 2016-12-29
	 *  Copyright 2016 Microsoft. All rights reserved.
	 *
	 */
var G,W=z&&z.__extends||(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])},function(F,B){function __(){this.constructor=F}G(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K,Y=function(){function AbstractLogAppender(F){this._formatter=F||new $}return AbstractLogAppender.prototype.formatter=function(){return this._formatter},AbstractLogAppender.prototype.receiveAll=function(){return!1},AbstractLogAppender.prototype.levels=function(){return null},AbstractLogAppender}();function toHex(F){return(4294967296+F).toString(16).substr(-8)}function pad(F,B){return(1e12+F).toString(10).substr(-B)}B.AbstractLogAppender=Y,function(F){F[F.Timestamp=1]="Timestamp",F[F.Component=4]="Component",F[F.Level=8]="Level",F[F.FullDate=32]="FullDate",F[F.LogId=64]="LogId"}(K=B.SLF_Flags||(B.SLF_Flags={}));var $=function(){function StandardLogFormatter(F){void 0===F&&(F=4294967295),this._flags=F}return StandardLogFormatter.prototype.format=function(F,B,G,W){var z="";if(this._flags&K.FullDate)z+=new Date(F.timestamp).toISOString()+" ";else if(this._flags&K.Timestamp){var Y=new Date(F.timestamp);z+=pad(Y.getHours(),2)+":"+pad(Y.getMinutes(),2)+":"+pad(Y.getSeconds(),2)+"."+pad(Y.getMilliseconds(),2)+" "}return this._flags&K.LogId&&(z+="[#"+toHex(B)+"-"+(F.component.safe()?"S":"u")+"] "),this._flags&K.Level&&(z+="["+Q.LogFactory.levelToString(F.level)+"] "),this._flags&K.Component&&(z+="["+F.component.name()+"] "),G||""===G?z+J.vsprintf(G,W):z+toHex(B)+": "+W.join(" ")},StandardLogFormatter}();B.StandardLogFormatter=$;var X=console,Z=console.log||function(){},ee=console.info||Z,te=console.warn||ee,ne=console.error||te,ie=function(F){function ConsoleAppender(){return null!==F&&F.apply(this,arguments)||this}return W(ConsoleAppender,F),ConsoleAppender.prototype.log=function(F,B,G,W){W=W.slice(0);var z=F.level<=J.LogLevel.Debug3?Z:F.level<=J.LogLevel.Debug1?ee:F.level<=J.LogLevel.Warning?te:ne;if(-1===B){var K=this.formatter().format(F,B,"",[]);"string"==typeof W[0]&&(K+=W.shift()),z.apply(X,[K].concat(W))}else{for(var Q=void 0,Y=[];Q=G.match(/\s*%@\s*$/);)G=G.substr(0,G.length-Q[0].length),Y.unshift(W.pop());K=this.formatter().format(F,B,G,W);z.apply(X,[K].concat(Y))}},ConsoleAppender}(Y);B.ConsoleAppender=ie;var re=function(){function ChainedLogAppender(F){this._chained=F}return ChainedLogAppender.prototype.log=function(F,B,G,W){this._chained.log(F,B,G,W)},ChainedLogAppender.prototype.receiveAll=function(){return this._chained.receiveAll()},ChainedLogAppender.prototype.levels=function(){return this._chained.levels()},ChainedLogAppender}();B.ChainedLogAppender=re;var oe=function(F){function LevelWrappedAppender(B,G){var W=F.call(this,B)||this;return W._levels=G,W}return W(LevelWrappedAppender,F),LevelWrappedAppender.prototype.levels=function(){return this._levels},LevelWrappedAppender}(re);function wrapAppenderWithLogLevels(F,B){return new oe(F,B)}B.wrapAppenderWithLogLevels=wrapAppenderWithLogLevels})),X=createCommonjsModule((function(F,B){
/*!
	 *  RootToolsManager.ts
	 *  AUF
	 *
	 *  Created by Johan Blumenberg on 2016-12-29
	 *  Copyright 2016 Microsoft. All rights reserved.
	 *
	 */
var G,W=z&&z.__extends||(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])},function(F,B){function __(){this.constructor=F}G(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=Q.LogFactory.instance().component("RootToolsManager");Q.LogFactory.instance().declareComponentSafe("RootToolsManager",!0);var X,Z="638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104";!function(F){F[F.InternalBuild=0]="InternalBuild",F[F.PublicBuild=1]="PublicBuild"}(X=B.BuildType||(B.BuildType={}));var ee=X.InternalBuild;function setBuildType(F){var B=ee;return ee=F,B}function toHex(F){return(4294967296+F).toString(16).substr(-8)}function map(F,B){var G=[];for(var W in F)G.push(B(W,F[W]));return G}function arrayEquals(F,B,G){if(null==F)return null==B||0===B.length;if(null==B)return null==F||0===F.length;if(F.length===B.length){for(var W=0;W<F.length;W++)if(!G(F[W],B[W]))return!1;return!0}return!1}function matcherEquals(F,B){return null==F?null==B:null==B?null==F:F.arg===B.arg&&F.op===B.op&&F.value===B.value}function conditionEquals(F,B){return null==F?null==B||0===B.logId:null==B?null==F||0===F.logId:F.logId===B.logId&&F.name===B.name&&arrayEquals(F.matchers,B.matchers,matcherEquals)}function filterEqualsToNativeFilter(F,B){return null==F?null==B:null==B?null==F:F.component===B.component&&F.parsedLevel===B.level}function filterEquals(F,B){return null==F?null==B:null==B?null==F:F.component===B.component&&F.level===B.level}function formatArgs(F){for(var B=[],G=0;G<F.length;G++)"string"==typeof F[G]||"number"==typeof F[G]?B.push(F[G]):B.push(JSON.stringify(F[G]));return B}B.setBuildType=setBuildType;var te=function(F){function Trigger(B,G,W){var z=F.call(this)||this;return z._unmetConditions=[],z._rtMan=B,z._triggerCallback=G,z._ecsConfig=W,z.resetConditions(),z}return W(Trigger,F),Trigger.prototype.config=function(){return this._ecsConfig},Trigger.prototype.configEquals=function(F){return this._ecsConfig.includeUnsafe===F.includeUnsafe&&this._ecsConfig.mutualSubmissionType===F.mutualSubmissionType&&this._ecsConfig.name===F.name&&this._ecsConfig.reenableAfterTriggering===F.reenableAfterTriggering&&this._ecsConfig.experimentTarget===F.experimentTarget&&conditionEquals(this._ecsConfig.resetCondition,F.resetCondition)&&arrayEquals(this._ecsConfig.conditions,F.conditions,conditionEquals)&&arrayEquals(this._ecsConfig.filters,F.filters,filterEquals)},Trigger.prototype.nativeConfigEquals=function(F){return this._ecsConfig.includeUnsafe===F.includeUnsafe&&this._ecsConfig.name===F.name&&this._ecsConfig.reenableAfterTriggering===F.reenableAfterTriggering&&conditionEquals(this._ecsConfig.resetCondition,F.resetCondition)&&arrayEquals(this._ecsConfig.conditions,F.conditions,conditionEquals)&&arrayEquals(this._ecsConfig.filters,F.filters,filterEqualsToNativeFilter)},Trigger.prototype.needReset=function(F){return!this.configEquals(F)},Trigger.prototype.resetConditions=function(){this._unmetConditions=[];for(var F=0;F<this._ecsConfig.conditions.length;F++)this._unmetConditions.push(F)},Trigger.prototype.matcherMatches=function(F,B){if(F.arg>=B.length)return!1;var G=B[F.arg],W="string"==typeof G?F.value:parseInt(F.value,10);return"="===F.op||"=="===F.op?G===W:"!="===F.op?G!==W:"<"===F.op?G<W:"<="===F.op?G<=W:">"===F.op?G>W:">="===F.op?G>=W:"CONTAINS"===F.op.toUpperCase()&&(""+G).indexOf(F.value)>=0},Trigger.prototype.conditionMatches=function(F,B,G){if(B!==F.logId)return!1;if(F.matchers)for(var W=0;W<F.matchers.length;W++)if(!this.matcherMatches(F.matchers[W],G))return!1;return!0},Trigger.prototype.log=function(F,B,G,W){if(0!==this._unmetConditions.length&&F.component!==K){var z=this._ecsConfig;z.resetCondition&&this.conditionMatches(z.resetCondition,B,W)&&(K.debug4("LogTrigger %s: resetCondition met",z.name),this.resetConditions());for(var J=0;J<this._unmetConditions.length;J++){var Q=this._unmetConditions[J];if(this.conditionMatches(z.conditions[Q],B,W)){K.debug4("LogTrigger %s: condition %s met",z.name,z.conditions[Q].name),this._unmetConditions.splice(J,1);break}}0===this._unmetConditions.length&&(K.debug1("LogTrigger %s has triggered, trying to send the log",z.name),this._triggerCallback.call(this._rtMan,z),z.reenableAfterTriggering&&this.resetConditions())}},Trigger.prototype.receiveAll=function(){return!0},Trigger}($.AbstractLogAppender),ne=function(F){function CircularBuffer(B,G,W){var z=F.call(this)||this;return z._circularBuffer=[],z._circularBufferMaxSize=0,z._onBufferOverflow=null,z._circularBuffer=[],z._circularBufferMaxSize=G,z._includeUnsafe=B,z._onBufferOverflow=W||function(){return z._circularBuffer.shift()},z}return W(CircularBuffer,F),CircularBuffer.prototype.log=function(F,B,G,W){if((this._includeUnsafe||F.component.safe())&&!(this._circularBuffer.length>this._circularBufferMaxSize)){var z={md:F,logId:B,messages:formatArgs(W)};this._circularBuffer.push(z),this._circularBuffer.length>this._circularBufferMaxSize&&this._onBufferOverflow()}},CircularBuffer.prototype.visitReverseOrder=function(F){for(var B=this._circularBuffer.length-1;B>=0;B--){var G=this._circularBuffer[B];if(!F(G.md,G.logId,G.messages))return}},CircularBuffer.prototype.visitForwardOrder=function(F){for(var B=0;B<this._circularBuffer.length;B++){var G=this._circularBuffer[B];if(!F(G.md,G.logId,G.messages))return}},CircularBuffer.prototype.needReset=function(F,B){return F!==this._includeUnsafe||B!==this._circularBufferMaxSize},CircularBuffer.prototype.dumpLogBuffer=function(F,B,G){var W=this,z=new ie(F.reverse),K=F.filter.map((function(F){return{component:"root"===F.component?"":F.component,parsedLevel:F.level}})),J=G||{matchedLines:0,totalLines:0};return(F.reverse?this.visitReverseOrder:this.visitForwardOrder).apply(this,[function(F,G,Q){return J.totalLines++,W.filterMatches(F,G,Q,K)&&(J.matchedLines++,z.log(F.component,F.timestamp,F.level,G,Q)),!B||z._data.length<B}]),z.close(),z.data()},CircularBuffer.prototype.filterMatches=function(F,B,G,W){for(var z=0;z<W.length;z++)if((""===W[z].component||F.component.name()===W[z].component||F.component.name().substr(0,W[z].component.length)===W[z].component&&"."===F.component.name().charAt(W[z].component.length))&&F.level>=W[z].parsedLevel)return!0;return!1},CircularBuffer.prototype.clear=function(){this._circularBuffer=[]},CircularBuffer.prototype.size=function(){return this._circularBuffer.length},CircularBuffer.prototype.empty=function(){return 0===this.size()},CircularBuffer.prototype.capacity=function(){return this._circularBufferMaxSize},CircularBuffer}($.AbstractLogAppender);B.CircularBuffer=ne;var ie=function(){function BinaryLogFormatter(F){this._reverse=F,this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2"+String.fromCharCode(33)+String.fromCharCode(32),this._data+=F?String.fromCharCode(34):String.fromCharCode(32),this._data+=String.fromCharCode(32)}return BinaryLogFormatter.prototype._add8=function(F){if(this._pending.push(255&F),3===this._pending.length){var B=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),G=this._base64chars[B>>18&63]+this._base64chars[B>>12&63]+this._base64chars[B>>6&63]+this._base64chars[B>>0&63];this._data+=G,this._pending=[]}},BinaryLogFormatter.prototype._add16=function(F){this._add8(F>>8&255),this._add8(F>>0&255)},BinaryLogFormatter.prototype._add32=function(F){this._add8(F>>24&255),this._add8(F>>16&255),this._add8(F>>8&255),this._add8(F>>0&255)},BinaryLogFormatter.prototype._add64=function(F){this._add32(F/4294967296|0),this._add32(0|F)},BinaryLogFormatter.prototype._addS=function(F){for(var B=0;B<F.length;B++)this._add8(F.charCodeAt(B));this._add8(0)},BinaryLogFormatter.prototype._close=function(){for(;this._pending.length;)this._add8(0)},BinaryLogFormatter.prototype.log=function(F,B,G,W,z){var K=this._components[F.name()];K||(K=++this._componentCount,this._components[F.name()]=K,this._add8(2),this._add16(K),this._addS(F.name()),this._addS(""),this._addS(""),this._add8(F.safe()?1:0));var J=128;this._first&&(J|=2);var Q=B-this._lastts;this._lastts=B,Q>-128&&Q<128&&(J|=1),this._add8(J),1&J?this._add8(Q):this._add64(1e3*B),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(K),this._add8(G),this._add32(W),this._add8(z.length);for(var Y=0;Y<z.length;Y++)this._add8(8),this._addS(""+z[Y]);this._first=!1},BinaryLogFormatter.prototype.close=function(){this._add8(7),this._close()},BinaryLogFormatter.prototype.data=function(){return this._data},BinaryLogFormatter.prototype.empty=function(){return this._first},BinaryLogFormatter}(),re=function(F){function DumperBuffer(B,G,W,z){var K=F.call(this)||this;return K._capacity=B,K._onBufferOverflow=G,K._enableThrottling=W,K._maxVerbosityLevel=z,K._outputFormatter=new ie(!1),K._linesStored=0,K._throttling=!1,K._linesThrottled=0,K}return W(DumperBuffer,F),DumperBuffer.prototype.log=function(F,B,G,W){this._maxVerbosityLevel&&F.level<this._maxVerbosityLevel||(this._throttling?this._linesThrottled++:(this._linesStored++,this._outputFormatter.log(F.component,F.timestamp,F.level,B,formatArgs(W))),this._linesStored>this._capacity&&(this._enableThrottling?this._throttling||(this._throttling=!0):this._onBufferOverflow()))},DumperBuffer.prototype.dumpAndReset=function(){if(this._outputFormatter.empty())return"";this._linesThrottled>0&&this._outputFormatter.log(K,(new Date).getTime(),J.LogLevel.Fatal,-1,["RooToolsManager: Log buffer overflow! "+this._linesThrottled+" lines thrown away"]),this._outputFormatter.close();var F=this._outputFormatter.data();return this.clearBuffer(),F},DumperBuffer.prototype.empty=function(){return this._outputFormatter.empty()},DumperBuffer.prototype.clearBuffer=function(){this._outputFormatter=new ie(!1),this._linesStored=0,this._linesThrottled=0,this._throttling=!1},DumperBuffer.prototype.capacity=function(){return this._capacity},DumperBuffer.prototype.throttlingEnabled=function(){return this._enableThrottling},DumperBuffer.prototype.size=function(){return this._linesStored},DumperBuffer.prototype.maxVerbosityLevel=function(){return this._maxVerbosityLevel},DumperBuffer}($.AbstractLogAppender);function validateExperimentTarget(F){return"Native"===F||"JavaScript"===F||"Mixed"===F}B.DumperBuffer=re;var oe=function(){function RootToolsManagerImpl(){this._maxUploadSize=0,this._jsToNativeBuffer=null,this._jsToNativeBufferHandle=null,this._jsToNativeFlushTimer=null,this._jsToNativeFlushInterval=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:J.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed",this._BRBCallback=null}return RootToolsManagerImpl.prototype.setDelegate=function(F){this._glue=F,this.registerListeners()},RootToolsManagerImpl.prototype.isDelegateSet=function(){return null!=this._glue},RootToolsManagerImpl.prototype.setNativeFunctions=function(F){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=F,this._native&&this._native.log_config.addLogTriggerListener(this)},RootToolsManagerImpl.prototype.applyLogLevels=function(){var F={};for(var B in this._localLogLevels)F[B]=this._localLogLevels[B];F[""]=F.root||J.LogLevel.Debug4,delete F.root;var G=map(F,(function(F,B){return{component:F,level:B}}));G.sort((function(F,B){return F.component.length-B.component.length})),G.forEach((function(F){return Q.LogFactory.instance().component(F.component).setLevel(F.level)})),this._native&&this._native.log_config.setLogLevelConfig(G)},RootToolsManagerImpl.prototype.setLocalLogLevelConfig=function(F){this._localLogLevels=F,this.applyLogLevels()},RootToolsManagerImpl.prototype.parseMatcher=function(F){return null==F||null==F.arg||null==F.op||null==F.value?null:{arg:F.arg,op:F.op,value:F.value}},RootToolsManagerImpl.prototype.parseCondition=function(F){if(null==F||null==F.logId)return null;if(F.matchers&&!(F.matchers instanceof Array))return null;var B={name:F.name||toHex(F.logId),logId:F.logId,matchers:[]};if(F.matchers&&F.matchers.length)for(var G=0,W=F.matchers;G<W.length;G++){var z=W[G],K=this.parseMatcher(z);K&&B.matchers.push(K)}return B},RootToolsManagerImpl.prototype.parseFilter=function(F){return null==F||null==F.component||0===F.component.length?null:{component:F.component,level:F.level,parsedLevel:Q.LogFactory.levelFromString(F.level)}},RootToolsManagerImpl.prototype.parseConfig=function(F,B,G){if(null==F)return null;if(!(F.conditions instanceof Array)||0==F.conditions.length)return null;if(!(F.filters instanceof Array)||0==F.filters.length)return null;if(F.resetCondition&&!this.parseCondition(F.resetCondition))return null;for(var W={name:F.name||B+"->"+G,ecsNs:B,reenableAfterTriggering:F.reenableAfterTriggering||!1,mutualSubmissionType:F.mutualSubmissionType||"",includeUnsafe:ee!==X.PublicBuild&&(F.includeUnsafe||!1),experimentTarget:validateExperimentTarget(F.experimentTarget)&&F.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==F.resetCondition?F.resetCondition:this.parseCondition(F.resetCondition),filters:[]},z=0,K=F.conditions;z<K.length;z++){var J=K[z],Q=this.parseCondition(J);Q&&W.conditions.push(Q)}for(var Y=0,$=F.filters;Y<$.length;Y++){var Z=$[Y],te=this.parseFilter(Z);te&&W.filters.push(te)}return 0===W.conditions.length?null:W},RootToolsManagerImpl.prototype.isExperimentListed=function(F,B,G,W){return!!F&&(!(!W||!F.some((function(F){return"*"===F.namespace})))||F.some((function(F){return F.namespace===B&&(F.experiment===G||"*"==F.experiment)})))},RootToolsManagerImpl.prototype.isExperimentAllowed=function(F,B,G){return!this.isExperimentListed(F.blacklist,B,G,!0)||this.isExperimentListed(F.whitelist,B,G,!1)},RootToolsManagerImpl.prototype.findTrigger=function(F,B){for(var G in F)if(F[G].configEquals(B))return G;return null},RootToolsManagerImpl.prototype.findTriggerByNativeConfig=function(F,B){for(var G in F)if(F[G].nativeConfigEquals(B))return G;return null},RootToolsManagerImpl.prototype.OnEcsChange=function(){var F=this;function forEachAsync(F,B,G){return B<F.length?G(F[B]).then((function(){return forEachAsync(F,B+1,G)})):Y.Resolved()}return null==this._glue?Y.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then((function(B){K.debug4("Reloading ULBaseline config - new config: %@",B),B||(K.warn("No ULBaseline config"),B={}),F._maxUploadSize=B.logUpload&&B.logUpload.maxSize||1024;var G=[],W=F._triggers;F._triggers={};var z=(B.logUpload&&B.logUpload.maxSize||1024)/100,Y=B.circularBuffer&&B.circularBuffer.enabled,X=B.circularBuffer&&B.circularBuffer.buffers||F._defaultBuffers,Z=B.circularBuffer&&B.circularBuffer.storeUnsafe;F._defaultExperimentTarget=validateExperimentTarget(B.defaultExperimentTarget)&&B.defaultExperimentTarget||"Mixed";var ee=B.killswitch||F._defaultKillswitch,ie=B.blacklists||F._defaultBlacklists;ie.component.length>0&&Q.LogFactory.instance().setComponentBlacklist(ie.component);var re={};(B.componentLevels||[]).forEach((function(F){return re[F.component]=F.level})),forEachAsync(B.configPaths||[],0,(function(B){return F._glue.fetchEcsConfig(B.ns,B.key).then((function(z){var J=z instanceof Array?z:[z];K.debug4("Reloading ECS config for %s->%s - new config: %@",B.ns,B.key,J);for(var Q=0,$=J;Q<$.length;Q++){var X=$[Q];if(null!=X){var te=F.parseConfig(X,B.ns,B.key);if(null!=te)if("JavaScript"===te.experimentTarget||"Mixed"===te.experimentTarget)if(K.debug2("Parsed ECS config for %s->%s - %@",B.ns,B.key,te),F.isExperimentAllowed(ee,B.ns,te.name)){K.debug2("Allowing %s->%s:%s according to killswitch",B.ns,B.key,te.name),Y=!0;var ne=F.findTrigger(W,te);null!=ne?(K.debug2("Triggers updated, keeping trigger %s",te.name),F._triggers[ne]=W[ne],delete W[ne]):G.push(te),te.filters&&te.filters.forEach((function(F){return re[F.component]=Math.min(re[F.component]||255,F.parsedLevel)})),te.includeUnsafe&&(Z=!0)}else K.debug2("Disallowing %s->%s according to killswitch",B.ns,B.key);else K.debug4("Skipping %s->%s, targeted for %s",B.ns,B.key,te);else K.error("Failed to parse ECS config for %s->%s",B.ns,B.key)}}}))})).always((function(){for(var B in F.applyLogLevels(),W)K.debug2("Triggers updated, removing trigger %s",W[B].config().name),Q.LogFactory.instance().removeAppender(+B);if(G.forEach((function(B){K.debug2("Triggers updated, adding trigger %s",B.name);var G=new te(F,F._triggered,B),W=Q.LogFactory.instance().addAppender(G);F._triggers[String(W)]=G})),re[""]=re.root||J.LogLevel.Debug4,delete re.root,!F._circularBuffer||Y&&!F._circularBuffer.needReset(Z,z)?F._circularBuffer&&(Object.keys(W).length>0||G.length>0?(K.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),Q.LogFactory.instance().removeAppender(F._circularBufferHandle),F._circularBufferHandle=null):K.debug2("Buffer updated, no change")):(K.debug2("Buffer updated, removing existing buffer"),Q.LogFactory.instance().removeAppender(F._circularBufferHandle),F._circularBuffer=null,F._circularBufferHandle=null),Y&&(F._circularBuffer||(K.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",Z,z),F._circularBuffer=new ne(Z,z)),null==F._circularBufferHandle&&(K.debug2("Creating log level wrapper"),F._circularBufferHandle=Q.LogFactory.instance().addAppender($.wrapAppenderWithLogLevels(F._circularBuffer,re),J.AppenderFlags.InsertFront))),F._native){var ee=map(re,(function(F,B){return{component:F,level:B}}));ee.sort((function(F,B){return F.component.length-B.component.length})),F._native.log_config.setLogBufferConfig(Y,{storeUnsafe:Z,buffers:X},ee);var ie=[];for(var oe in F._triggers){var ae=F._triggers[oe].config();ie.push({name:ae.name,ecsNs:ae.ecsNs,conditions:ae.conditions,resetCondition:ae.resetCondition,includeUnsafe:ae.includeUnsafe,reenableAfterTriggering:ae.reenableAfterTriggering,filters:ae.filters.map((function(F){return{component:F.component,level:F.parsedLevel}})),dumpFile:!1,metadata:{}})}F._native.log_config.setLogTriggerConfig(ie,{})}}))}))},RootToolsManagerImpl.prototype._send=function(F,B){null!=this._glue&&(this._glue.sendTelemetry(Z,{logTriggerName:F.name,logEcsNs:F.ecsNs,logdata:B}),K.debug4("LogSender::send, sent %d bytes",B.length))},RootToolsManagerImpl.prototype.triggered=function(F,B){},RootToolsManagerImpl.prototype.triggeredPartially=function(F,B,G,W,z){var K=this.findTriggerByNativeConfig(this._triggers,F);if(K){var J={level:B.level,component:Q.LogFactory.instance().component(B.component),timestamp:B.timestamp};this._triggers[K].log(J,G,W,z)}},RootToolsManagerImpl.prototype.reset=function(F){var B=this.findTriggerByNativeConfig(this._triggers,F);B&&this._triggers[B].resetConditions()},RootToolsManagerImpl.prototype.dumpLogBuffer=function(F,B){if(this._circularBuffer){var G={matchedLines:0,totalLines:0},W=this._circularBuffer.dumpLogBuffer(F,this._maxUploadSize,G);if(K.debug4("dumpLogBuffer: dumped %d of %d lines, size of payload: %d",G.matchedLines,G.totalLines,null!=W?W.length:0),this._native){var z=Y.Defer();return this._native.log_config.mergeAndDumpLogBuffer(W,F,B,(function(F){return z.resolve(F)})),z.promise()}return Y.Resolved(W)}return K.warn("dumpLogBuffer: no log buffer enabled"),Y.Rejected()},RootToolsManagerImpl.prototype._triggered=function(F){var B=this,G={compression:J.LogFileCompression.Compress,encoding:J.LogFileEncoding.Base64,encryption:J.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},W={includeUnsafe:F.includeUnsafe,filter:F.filters.map((function(F){return{component:F.component,level:F.parsedLevel}})),reverse:!0};this.dumpLogBuffer(W,G).then((function(G){return B._send(F,G)}))},RootToolsManagerImpl.prototype.sendBRBEvent=function(F){try{if(K.debug2("sendBRBEvent %s",JSON.stringify(F)),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var B={eventType:"uploadBRB",mutualSubmissionType:"call",payload:F};this._glue.sendLoggingEventToNative(JSON.stringify(B),"")}}catch(F){K.error("sendBRBEvent %s: %s",F.name,F.message)}},RootToolsManagerImpl.prototype.setBRBCallback=function(F){K.debug2("setBRBCallback"),null!=this._glue?"function"==typeof this._glue.setNativeLoggingEventCallback?this._BRBCallback=F:K.warn("setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method"):K.warn("setBRBCallback: RootToolsManagerDelegate is not set")},RootToolsManagerImpl.prototype.registerListeners=function(){var F=this;null!=this._glue&&"function"==typeof this._glue.setNativeLoggingEventCallback?this._glue.setNativeLoggingEventCallback((function(B,G){return F.handleNativeLoggingEvent(B,G)})):K.warn("registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method")},RootToolsManagerImpl.prototype.handleNativeLoggingEvent=function(F,B){try{K.debug2("Native Log event message: %s aux: %s",F,B);var G=JSON.parse(F);if(G.eventType&&"uploadBRB"===G.eventType){if("function"!=typeof this._BRBCallback)return void K.warn("BRBCallback not set, ignoring native event");K.debug4("Sending BRB callback: %@",G.payload),this._BRBCallback(G.payload)}else G.eventType&&"jsLogFileConfiguration"===G.eventType&&this.handleLogFileConfigEvent(G)}catch(F){K.error("handleNativeLoggingEvent %s: %s",F.name,F.message)}},RootToolsManagerImpl.prototype.handleLogFileConfigEvent=function(F){if(F.payload){var B=F.payload;if(B.enabled){if(B.chunkSize&&B.flushInterval){var G={chunkSize:B.chunkSize,flushInterval:B.flushInterval,enableThrottling:B.enableThrottling,maxVerbosityLevel:B.maxVerbosityLevel};this.startJsToNativeLogging(G)}}else this.flushDisableJsToNativeLogging()}},RootToolsManagerImpl.prototype.logExternalForDDL=function(F,B){try{if(K.debug2("logExternalForDDL %s %s",F,B),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var G={eventType:"logInSClog",payload:{message:F,parameters:B}};this._glue.sendLoggingEventToNative(JSON.stringify(G),"")}else K.warn("ignoring logExternalForDDL, delegate misconfigured")}catch(F){K.error("logExternalForDDL %s: %s",F.name,F.message)}},RootToolsManagerImpl.prototype.startJsToNativeLogging=function(F){var B=this,G=F.chunkSize,W=F.flushInterval,z=F.enableThrottling,J=this._getVerbosityLevelFromConfig(F.maxVerbosityLevel);if(this._jsToNativeBuffer){if(this._jsToNativeBuffer.capacity()===G&&this._jsToNativeFlushInterval===W&&this._jsToNativeBuffer.throttlingEnabled()===z&&this._jsToNativeBuffer.maxVerbosityLevel()===J)return void K.debug1("Same JS2Native settings received - doing nothing");K.debug1("Reapplying js to native settings"),this.flushDisableJsToNativeLogging()}this._jsToNativeBuffer=new re(G,(function(){B.onJsToNativeBufferReady(B._jsToNativeBuffer)}),z,J),this.setJsToNativeFlushTimeout(W),this._jsToNativeFlushInterval=W,this._jsToNativeBufferHandle=Q.LogFactory.instance().addAppender(this._jsToNativeBuffer)},RootToolsManagerImpl.prototype._getVerbosityLevelFromConfig=function(F){return F?Q.LogFactory.levelFromString(F):null},RootToolsManagerImpl.prototype.flushDisableJsToNativeLogging=function(){this._jsToNativeBuffer&&this.onJsToNativeBufferReady(this._jsToNativeBuffer),this.plainDisableJsToNativeLogging()},RootToolsManagerImpl.prototype.plainDisableJsToNativeLogging=function(){this.clearJsToNativeFlushTimeout(),this._jsToNativeBufferHandle&&(Q.LogFactory.instance().removeAppender(this._jsToNativeBufferHandle),this._jsToNativeBufferHandle=0,this._jsToNativeBuffer=null,K.debug1("Disabling forwarding JS logs to native"))},RootToolsManagerImpl.prototype.onJsToNativeBufferReady=function(F){null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative?(this.clearJsToNativeFlushTimeout(),this.dumpJsToNativeBuffer(F),this.setJsToNativeFlushTimeout(this._jsToNativeFlushInterval)):this.plainDisableJsToNativeLogging()},RootToolsManagerImpl.prototype.dumpJsToNativeBuffer=function(F){if(!F.empty()){var B=F.dumpAndReset(),G={eventType:"writeLogData"};this._glue.sendLoggingEventToNative(JSON.stringify(G),B)}},RootToolsManagerImpl.prototype.clearJsToNativeFlushTimeout=function(){this._jsToNativeFlushTimer&&(clearTimeout(this._jsToNativeFlushTimer),this._jsToNativeFlushTimer=null)},RootToolsManagerImpl.prototype.setJsToNativeFlushTimeout=function(F){var B=this;!this._jsToNativeFlushTimer&&F&&(this._jsToNativeFlushTimer=setTimeout((function(){B._jsToNativeFlushTimer=null,B.onJsToNativeBufferReady(B._jsToNativeBuffer)}),F))},RootToolsManagerImpl.prototype.stopAsyncOperations=function(){this.flushDisableJsToNativeLogging()},RootToolsManagerImpl}();B.RootToolsManager=new oe})),Z=createCommonjsModule((function(F,B){
/*!
	 *  pii.ts
	 *  AUF
	 *
	 *  Created by Johan Blumenberg on 2017-01-16
	 *  Copyright 2017 Microsoft. All rights reserved.
	 *
	 */
Object.defineProperty(B,"__esModule",{value:!0});var DefaultTagger=function(F){return F},G=!0,W=DefaultTagger,z={},K=0;function addName(F){return z[F]="u"+ ++K}var J,Q=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(F){F[F.MSA=1]="MSA",F[F.S4B_Bridge=2]="S4B_Bridge",F[F.PSTN=4]="PSTN",F[F.SkypeId=8]="SkypeId",F[F.Thread=19]="Thread",F[F.LegacyShortCircuit=20]="LegacyShortCircuit",F[F.OneToOneTextMessage=21]="OneToOneTextMessage",F[F.GroupTextMessage=22]="GroupTextMessage",F[F.Bot=28]="Bot",F[F.InternalSkype=48]="InternalSkype"}(J||(J={}));var Y=[J.Thread,J.InternalSkype,J.Bot];function enableAnonymization(F){G=F}function useTagger(F){W=F||DefaultTagger}B.enableAnonymization=enableAnonymization,B.useTagger=useTagger,function(F){function untaggedUserName(F){return G?F?z[F]||addName(F):null:F}function UserName(F){var B=untaggedUserName(F);return W(B)}function Mri(F){var B,G=F.match(Q);if(G){var z=Number(G[1]),K=G[2];B=-1!=Y.indexOf(z)?F:z+":"+untaggedUserName(K)}else B=untaggedUserName(F);return W(B)}function Omit(F){var B;return B=G?"number"==typeof F?19229:"string"==typeof F?F.charAt(0)+"...":null:F,W(B)}F.UserName=UserName,F.Mri=Mri,F.Omit=Omit}(B.pii||(B.pii={}))})),ee=createCommonjsModule((function(F,B){
/*!
	 *  index.ts
	 *  AUF
	 *
	 *  Created by Johan Blumenberg on 2016-12-29
	 *  Copyright 2016 Microsoft. All rights reserved.
	 *
	 */
function __export(F){for(var G in F)B.hasOwnProperty(G)||(B[G]=F[G])}Object.defineProperty(B,"__esModule",{value:!0}),__export(J),__export(Q),__export(X),__export($),__export(Z)})),te=createCommonjsModule((function(F,B){!function webpackUniversalModuleDefinition(B,G){F.exports=G(K,ee)}(window,(function(F,B){return function(F){var B={};function __webpack_require__(G){if(B[G])return B[G].exports;var W=B[G]={i:G,l:!1,exports:{}};return F[G].call(W.exports,W,W.exports,__webpack_require__),W.l=!0,W.exports}return __webpack_require__.m=F,__webpack_require__.c=B,__webpack_require__.d=function(F,B,G){__webpack_require__.o(F,B)||Object.defineProperty(F,B,{enumerable:!0,get:G})},__webpack_require__.r=function(F){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})},__webpack_require__.t=function(F,B){if(1&B&&(F=__webpack_require__(F)),8&B)return F;if(4&B&&"object"==typeof F&&F&&F.__esModule)return F;var G=Object.create(null);if(__webpack_require__.r(G),Object.defineProperty(G,"default",{enumerable:!0,value:F}),2&B&&"string"!=typeof F)for(var W in F)__webpack_require__.d(G,W,function(B){return F[B]}.bind(null,W));return G},__webpack_require__.n=function(F){var B=F&&F.__esModule?function getDefault(){return F.default}:function getModuleExports(){return F};return __webpack_require__.d(B,"a",B),B},__webpack_require__.o=function(F,B){return Object.prototype.hasOwnProperty.call(F,B)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=175)}([function(F,B,G){G.d(B,"w",(function(){return isTypeof})),G.d(B,"x",(function(){return isUndefined})),G.d(B,"r",(function(){return isNullOrUndefined})),G.d(B,"p",(function(){return isNotNullOrUndefined})),G.d(B,"j",(function(){return hasOwnProperty})),G.d(B,"t",(function(){return isObject})),G.d(B,"o",(function(){return isFunction})),G.d(B,"e",(function(){return attachEvent})),G.d(B,"g",(function(){return detachEvent})),G.d(B,"z",(function(){return objForEachKey})),G.d(B,"F",(function(){return strEndsWith})),G.d(B,"G",(function(){return strStartsWith})),G.d(B,"E",(function(){return strContains})),G.d(B,"m",(function(){return isDate})),G.d(B,"k",(function(){return me})),G.d(B,"n",(function(){return isError})),G.d(B,"u",(function(){return isString})),G.d(B,"s",(function(){return isNumber})),G.d(B,"l",(function(){return isBoolean})),G.d(B,"J",(function(){return toISOString})),G.d(B,"a",(function(){return arrForEach})),G.d(B,"b",(function(){return arrIndexOf})),G.d(B,"c",(function(){return arrMap})),G.d(B,"d",(function(){return arrReduce})),G.d(B,"H",(function(){return strTrim})),G.d(B,"B",(function(){return objKeys})),G.d(B,"y",(function(){return objDefineAccessors})),G.d(B,"A",(function(){return Se})),G.d(B,"f",(function(){return dateNow})),G.d(B,"h",(function(){return getExceptionName})),G.d(B,"D",(function(){return setValue})),G.d(B,"i",(function(){return getSetValue})),G.d(B,"q",(function(){return isNotTruthy})),G.d(B,"v",(function(){return isTruthy})),G.d(B,"I",(function(){return throwError})),G.d(B,"C",(function(){return optimizeObject}));var W=G(2),z=G(29),K="on",J="attachEvent",Q="addEventListener",Y="detachEvent",$="removeEventListener",X="toISOString",Z="endsWith",ee="startsWith",te="indexOf",ne="map",ie="reduce",re="trim",oe="toString",ae=W.d,se=W.b.freeze,ce=(W.b.seal,W.b.keys),le=String[W.k],de=le[re],ue=le[Z],pe=le[ee],he=Date[W.k][X],ge=Array.isArray,fe=W.f[oe];W.e[oe].call(W.b);function isTypeof(F,B){return typeof F===B}function isUndefined(F){return void 0===F||typeof F===W.l}function isNullOrUndefined(F){return null===F||isUndefined(F)}function isNotNullOrUndefined(F){return!isNullOrUndefined(F)}function hasOwnProperty(F,B){return!(!F||!W.e.call(F,B))}function isObject(F){return!(!F||typeof F!==W.j)}function isFunction(F){return!(!F||typeof F!==W.h)}function attachEvent(F,B,G,W){void 0===W&&(W=!1);var z=!1;if(!isNullOrUndefined(F))try{isNullOrUndefined(F[Q])?isNullOrUndefined(F[J])||(F[J](K+B,G),z=!0):(F[Q](B,G,W),z=!0)}catch(F){}return z}function detachEvent(F,B,G,W){if(void 0===W&&(W=!1),!isNullOrUndefined(F))try{isNullOrUndefined(F[$])?isNullOrUndefined(F[Y])||F[Y](K+B,G):F[$](B,G,W)}catch(F){}}function objForEachKey(F,B){if(F)for(var G in F)W.e.call(F,G)&&B.call(F,G,F[G])}function strEndsWith(F,B){var G=!1;return F&&B&&!(G=F===B)&&(G=ue?F[Z](B):_strEndsWithPoly(F,B)),G}function _strEndsWithPoly(F,B){var G=!1,W=B?B.length:0,z=F?F.length:0;if(W&&z&&z>=W&&!(G=F===B)){for(var K=z-1,J=W-1;J>=0;J--){if(F[K]!=B[J])return!1;K--}G=!0}return G}function strStartsWith(F,B){var G=!1;return F&&B&&!(G=F===B)&&(G=pe?F[ee](B):_strStartsWithPoly(F,B)),G}function _strStartsWithPoly(F,B){var G=!1,W=B?B.length:0;if(F&&W&&F.length>=W&&!(G=F===B)){for(var z=0;z<W;z++)if(F[z]!==B[z])return!1;G=!0}return G}function strContains(F,B){return!(!F||!B)&&-1!==F.indexOf(B)}function isDate(F){return!(!F||"[object Date]"!==fe.call(F))}var me=ge||_isArrayPoly;function _isArrayPoly(F){return!(!F||"[object Array]"!==fe.call(F))}function isError(F){return!(!F||"[object Error]"!==fe.call(F))}function isString(F){return"string"==typeof F}function isNumber(F){return"number"==typeof F}function isBoolean(F){return"boolean"==typeof F}function toISOString(F){if(F)return he?F[X]():_toISOStringPoly(F)}function _toISOStringPoly(F){if(F&&F.getUTCFullYear){var pad=function(F){var B=String(F);return 1===B.length&&(B="0"+B),B};return F.getUTCFullYear()+"-"+pad(F.getUTCMonth()+1)+"-"+pad(F.getUTCDate())+"T"+pad(F.getUTCHours())+":"+pad(F.getUTCMinutes())+":"+pad(F.getUTCSeconds())+"."+String((F.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}function arrForEach(F,B,G){var W=F.length;try{for(var z=0;z<W&&(!(z in F)||-1!==B.call(G||F,F[z],z,F));z++);}catch(F){}}function arrIndexOf(F,B,G){if(F){if(F[te])return F[te](B,G);var W=F.length,z=G||0;try{for(var K=Math.max(z>=0?z:W-Math.abs(z),0);K<W;K++)if(K in F&&F[K]===B)return K}catch(F){}}return-1}function arrMap(F,B,G){var W;if(F){if(F[ne])return F[ne](B,G);var z=F.length,K=G||F;W=new Array(z);try{for(var J=0;J<z;J++)J in F&&(W[J]=B.call(K,F[J],F))}catch(F){}}return W}function arrReduce(F,B,G){var W;if(F){if(F[ie])return F[ie](B,G);var z=F.length,K=0;if(arguments.length>=3)W=arguments[2];else{for(;K<z&&!(K in F);)K++;W=F[K++]}for(;K<z;)K in F&&(W=B(W,F[K],K,F)),K++}return W}function strTrim(F){return F&&(F=de&&F[re]?F[re]():F.replace?F.replace(/^\s+|\s+$/g,""):F),F}var ve=!{toString:null}.propertyIsEnumerable("toString"),ye=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];function objKeys(F){var B=typeof F;if(B===W.h||B===W.j&&null!==F||Object(z.c)("objKeys called on non-object"),!ve&&ce)return ce(F);var G=[];for(var K in F)F&&W.e.call(F,K)&&G.push(K);if(ve)for(var J=ye.length,Q=0;Q<J;Q++)F&&W.e.call(F,ye[Q])&&G.push(ye[Q]);return G}function objDefineAccessors(F,B,G,W){if(ae)try{var z={enumerable:!0,configurable:!0};return G&&(z.get=G),W&&(z.set=W),ae(F,B,z),!0}catch(F){}return!1}function _doNothing(F){return F}var Se=se||_doNothing;function dateNow(){var F=Date;return F.now?F.now():(new F).getTime()}function getExceptionName(F){return isError(F)?F.name:""}function setValue(F,B,G,W,z){var K=G;return F&&((K=F[B])===G||z&&!z(K)||W&&!W(G)||(K=G,F[B]=K)),K}function getSetValue(F,B,G){var W;return F?!(W=F[B])&&isNullOrUndefined(W)&&(W=isUndefined(G)?{}:G,F[B]=W):W=isUndefined(G)?{}:G,W}function isNotTruthy(F){return!F}function isTruthy(F){return!!F}function throwError(F){throw new Error(F)}function optimizeObject(F){return F&&W.a&&(F=Object(W.b)(Object(W.a)({},F))),F}},function(F,B,G){var W,z,K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},J=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.sampleseries=B.rebaseHistogramTimestamps=B.rebaseTime=B.hptimeOrigin=B.hptime=B.getLast=B.addGetterFields=B.arrayPushFixedSize=B.limitArraySize=B.scrubDeviceLabelPii=B.round=B.getAverage=B.levenshteinDistance=B.getLongestCommonContiguousSubstring=B.subtractFrom=B.getFrom=B.isInRange=B.getClosestValue=B.throwIfFeatureNotSupported=B.throwIfNotSupported=B.getMaxSubstring=B.deepEqual=B.uniqueId=B.removeUndefinedFields=B.deepClone=B.shallowClone=B.keys=B.isEmpty=B.assign=B.values=B.compareArraysBy=B.remove=B.average=B.forOwnRec=B.forOwn=B.stringifyObject=void 0;var Q=G(26);Object.defineProperty(B,"stringifyObject",{enumerable:!0,get:function(){return Q.stringifyObject}});var Y=G(4);function forOwn(F,B){for(var G in F)F.hasOwnProperty(G)&&B(F[G],G)}function forOwnRec(F,B){for(var G in F)F.hasOwnProperty(G)&&("object"==typeof F[G]?forOwnRec(F[G],B):B(F[G],G,F))}function average(F){var B=0;return F.forEach((function(F){return B+=F})),B/=F.length}function remove(F,B){for(var G=!1,W=F.length;W-- >0;)B(F[W],W,F)&&(F.splice(W,1),G=!0);return G}function compareArraysBy(F,B,G){var W=[];return F.forEach((function(F){B.some((function(B){return G(F,B)}))||W.push(F)})),0===W.length&&F.length===B.length}function values(F){var B=[];for(var G in F)F.hasOwnProperty(G)&&B.push(F[G]);return B}function assign(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])}function isEmpty(F){return!Object.keys(F).length}function keys(F){return Object.keys(F)}function shallowClone(F){var B={};return forOwn(F,(function(F,G){B[G]=F})),B}function deepClone(F){var B;if(!F||"object"!=typeof F)return F;if(F instanceof Date)return(B=new Date).setTime(F.getTime()),B;if(F instanceof Array){B=[];for(var G=0,W=F.length;G<W;G++)B[G]=deepClone(F[G]);return B}if(F instanceof Object)return B={},forOwn(F,(function(F,G){B[G]=deepClone(F)})),B;throw new Error("Unable to copy: "+(0,Q.stringifyObject)(F))}function removeUndefinedFields(F){return Object.keys(F).forEach((function(B){void 0===F[B]&&delete F[B]})),F}function uniqueId(){var segment=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return segment()+segment()+segment()+"4"+segment().substring(1)+"b"+segment().substring(1)+segment()+segment()+segment()}function deepEqual(F,B){var G,W=typeof F;if(F===B)return!0;if(W!==typeof B||"object"!==W&&"function"!==W)return!1;if(null===F||null===B)return F===B;if(F instanceof Date&&B instanceof Date)return+F==+B;if(F instanceof Map&&B instanceof Map)return compareMaps(F,B);for(G in F)if(!(G in B)||!deepEqual(F[G],B[G]))return!1;for(G in B)if(!(G in F)||!deepEqual(F[G],B[G]))return!1;return!0}function compareMaps(F,B){var G;if(F.size!==B.size)return!1;var W=!0;return F.forEach((function(F,z){((G=B.get(z))!==F||void 0===G&&!B.has(z))&&(W=!1)})),W}function getMaxSubstring(F,B){return B.reduce((function(B,G){var W=F.includes(G)?G.length:0;return B.length<W?G:B}),"")}function throwIfNotSupported(F,B){if(-1===B.indexOf(F))throw{detail:"".concat(F," mediaContent.contentType is not supported"),type:Y.default.MEDIA_ERROR.incompatibleOffer}}function throwIfFeatureNotSupported(F,B){F.forEach((function(F){if(""!==F&&-1!==B.findIndex((function(B){return B===F})))throw{detail:"Required feature '".concat(F,"' is not acceptable."),type:Y.default.MEDIA_ERROR.incompatibleOffer}}))}function getClosestValue(F,B,G,W){void 0===W&&(W=0);for(var z=1;z<F.length;z++)if(F[z-1]+W<B&&B<=F[z]+W)return G?F[z]:F[z-1];return F[0]}function isInRange(F,B,G){return B<=F&&F<=G}function getFrom(F){for(var B,G,W=[],z=1;z<arguments.length;z++)W[z-1]=arguments[z];try{for(var J=K(W),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;if(Y.hasOwnProperty(F))return Y[F]}}catch(F){B={error:F}}finally{try{Q&&!Q.done&&(G=J.return)&&G.call(J)}finally{if(B)throw B.error}}}function subtractFrom(F,B){return F.filter((function(F){return!B.some((function(B){return B===F}))}))}function getLongestCommonContiguousSubstring(F,B){if(F===B)return F;for(var G=0,W=0,z="",K=0;K<F.length&&!(z.length>F.length-K);K++){var J=K;W-G>z.length&&(z=F.substring(G,W),K=W-1),G=K,W=K;for(var Q=0;Q<B.length;Q++)J<F.length&&B[Q]===F[J++]?W=J:(J=K,W-G>z.length&&(z=F.substring(G,W),K=W-1),G=K,W=K)}return z}function levenshteinDistance(F,B){for(var G=new Array(F.length+1),W=0;W<F.length+1;W++){G[W]=new Array(B.length+1);for(var z=0;z<B.length+1;z++)G[W][z]=0}for(W=1;W<F.length+1;W++)G[W][0]=W;for(W=1;W<B.length+1;W++)G[0][W]=W;for(W=1;W<F.length+1;W++)for(z=1;z<B.length+1;z++){var K=1;F[W-1]===B[z-1]&&(K=0),G[W][z]=Math.min(G[W-1][z]+1,G[W][z-1]+1,G[W-1][z-1]+K)}return G[F.length][B.length]}function getAverage(F){return 0===F.length?0:F.reduce((function(F,B){return F+B}),0)/F.length}function round(F,B){return void 0===B&&(B=3),F&&parseFloat(F.toFixed(B))}function scrubDeviceLabelPii(F,B){if(!F)return"";if(F.length<3)return F;var G=[],W=F.match(/\(([0-9a-zA-Z]+:[0-9a-zA-Z]+)\)/);W&&G.push(W[1]);try{if(null==B?void 0:B.length)for(var z=new RegExp("(".concat(B.join("|"),")"),"gi"),K=z.exec(F);K;)G.push(K[1]),K=z.exec(F);else G.push("no_keywords")}catch(F){G.push("Error: ".concat((0,Q.stringifyObject)(F)))}return 0===G.length?"unknown":G.join(" ")}function limitArraySize(F,B,G){return void 0===G&&(G=0),B>0&&F.length>B&&F.splice(G,F.length-B),F}function arrayPushFixedSize(F,B,G,W){void 0===W&&(W=0),G&&limitArraySize(F,G-1,W),F.push(B)}function addGetterFields(F,B){var G={};for(var W in B)G[W]={get:B[W],configurable:!1,enumerable:!0};Object.defineProperties(F,G)}function getLast(F){return(null==F?void 0:F.length)>0?F[F.length-1]:void 0}B.forOwn=forOwn,B.forOwnRec=forOwnRec,B.average=average,B.remove=remove,B.compareArraysBy=compareArraysBy,B.values=values,B.assign=assign,B.isEmpty=isEmpty,B.keys=keys,B.shallowClone=shallowClone,B.deepClone=deepClone,B.removeUndefinedFields=removeUndefinedFields,B.uniqueId=uniqueId,B.deepEqual=deepEqual,B.getMaxSubstring=getMaxSubstring,B.throwIfNotSupported=throwIfNotSupported,B.throwIfFeatureNotSupported=throwIfFeatureNotSupported,B.getClosestValue=getClosestValue,B.isInRange=isInRange,B.getFrom=getFrom,B.subtractFrom=subtractFrom,B.getLongestCommonContiguousSubstring=getLongestCommonContiguousSubstring,B.levenshteinDistance=levenshteinDistance,B.getAverage=getAverage,B.round=round,B.scrubDeviceLabelPii=scrubDeviceLabelPii,B.limitArraySize=limitArraySize,B.arrayPushFixedSize=arrayPushFixedSize,B.addGetterFields=addGetterFields,B.getLast=getLast;var $=(null===(W=null===window||void 0===window?void 0:window.performance)||void 0===W?void 0:W.now)&&(null===(z=null===window||void 0===window?void 0:window.performance)||void 0===z?void 0:z.timeOrigin),X=$?function(){return window.performance.now()}:function(){return Date.now()},Z=$?window.performance.timeOrigin:0;function rebaseTime(F,B,G){var W,z;if((null==F?void 0:F.length)>0){var J=[];try{for(var Q=K(F),Y=Q.next();!Y.done;Y=Q.next()){var $=deepClone(Y.value);$[B]=$[B]&&$[B]-G,J.push($)}}catch(F){W={error:F}}finally{try{Y&&!Y.done&&(z=Q.return)&&z.call(Q)}finally{if(W)throw W.error}}return J}}function rebaseHistogramTimestamps(F,B){var G,W,z,Q;if(F){var Y={seconds1to3:[],seconds3to5:[],seconds5to8:[],seconds8to15:[],seconds15to60:[],seconds60toMax:[]};try{for(var $=K(Object.entries(F)),X=$.next();!X.done;X=$.next()){var Z=J(X.value,2),ee=Z[0],te=Z[1];try{for(var ne=(z=void 0,K(te)),ie=ne.next();!ie.done;ie=ne.next()){var re=ie.value;Y[ee].push(re-B)}}catch(F){z={error:F}}finally{try{ie&&!ie.done&&(Q=ne.return)&&Q.call(ne)}finally{if(z)throw z.error}}}}catch(F){G={error:F}}finally{try{X&&!X.done&&(W=$.return)&&W.call($)}finally{if(G)throw G.error}}return Y}}function sampleseries(F,B,G){void 0===G&&(G=!1);var W=null==F?void 0:F.map(B).filter((function(F){return void 0!==F&&!isNaN(F)&&null!==F&&""!==F&&(!1===G||0!==F)}));return(null==W?void 0:W.length)?W.join(","):void 0}B.hptime=X,B.hptimeOrigin=Z,B.rebaseTime=rebaseTime,B.rebaseHistogramTimestamps=rebaseHistogramTimestamps,B.sampleseries=sampleseries},function(F,B,G){G.d(B,"h",(function(){return W})),G.d(B,"j",(function(){return z})),G.d(B,"l",(function(){return K})),G.d(B,"k",(function(){return J})),G.d(B,"i",(function(){return Q})),G.d(B,"g",(function(){return Y})),G.d(B,"b",(function(){return $})),G.d(B,"f",(function(){return X})),G.d(B,"a",(function(){return Z})),G.d(B,"c",(function(){return ee})),G.d(B,"d",(function(){return te})),G.d(B,"e",(function(){return ne}));var W="function",z="object",K="undefined",J="prototype",Q="hasOwnProperty",Y="default",$=Object,X=$[J],Z=$.assign,ee=$.create,te=$.defineProperty,ne=X[Q]},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},z=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.getTokenMetadata=B.getRequestTypeAsString=B.extractAuthenticationHeaders=B.getTokenType=B.convertStringToTokenType=B.isRetryable=B.isTrouterAndNavigatorConnected=B.defer=B.decodeMessage=B.parseRawHttpMessage=B.isMessageEncodingSupported=B.isEncodedMessage=B.getMessageResultFromCache=B.cacheMessageResult=B.extractCauseIdFromMessage=B.isDuplicateMessage=B.getErrorForXHRFailure=B.tryParse=B.escapeRegExp=B.getHashTableCount=B.tryRemoveKeyFromHashTable=B.tryAddNewKeyToHashTable=B.arrayContains=B.stringEndsWith=B.stringContains=B.getMediaTypes=B.assertCallEndReason=B.assertNotNullArrayContent=B.assertNotNull=B.assertNotNullOrEmpty=B.assert=B.newGuid=B.newMessageId=B.causeId=B.stripMri=B.is1to1Mri=void 0;var K=G(8),J=G(90),Q=G(14),Y=G(5),$=G(74);function is1to1Mri(F){return!!F.match(/^8:/)}function stripMri(F){return F.replace(/^\d+:/,"")}function causeId(){return newGuid().substr(0,8)}function newMessageId(F){return F&&/^[a-z0-9]{8}$/.test(F)?F+newGuid().substr(8):newGuid()}function newGuid(){for(var F="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",B="0123456789abcdef",G="",W=0,z=0;z<36;){var K=F[z];switch(W=z%8==0?4294967295*Math.random()|0:W>>4,K){case"x":G+=B[15&W];break;case"y":G+=B[3&W|8];break;case"4":case"-":G+=K}z++}return G}function assert(F,B){if(!F)throw new Error("Assert failed".concat(void 0!==B?":".concat(B):""))}function assertNotNullOrEmpty(F,B){if(!F||F instanceof String&&""===F||F instanceof Array&&0===F.length)throw new Error("AssertNotNullOrEmpty failed. ".concat(void 0!==B?": ".concat(B):""))}function assertNotNull(F,B){if(!F)throw new Error("AssertNotNull failed. ".concat(void 0!==B?": ".concat(B):""))}function assertNotNullArrayContent(F,B){if(0===F.length)throw new Error("assertNotNullArrayContent failed. ".concat(void 0!==B?": ".concat(B):""));F.forEach((function(F){if(!F)throw new Error("assertNotNullArrayContent failed. ".concat(void 0!==B?"contains null value: ".concat(B):""))}))}function assertCallEndReason(F){if(assertNotNullOrEmpty(F,"callEndReason cannot be null or empty"),void 0===F.code||void 0===F.subCode||void 0===F.phrase||F.code<0||F.subCode<0||" "===F.phrase)throw new Error("callEndReason must specify code, subCode and phrase. Invalid reason : ".concat((0,Q.getPrintableObject)(F)))}function getMediaTypes(F){var B,G;assertNotNull(F,"MediaTypes passed cannot be null");var z=[],K=Y.default.MEDIA_TYPES;try{for(var J=W(Object.keys(K)),Q=J.next();!Q.done;Q=J.next()){var $=Q.value;arrayContains(F,K[$])&&z.push(K[$])}}catch(F){B={error:F}}finally{try{Q&&!Q.done&&(G=J.return)&&G.call(J)}finally{if(B)throw B.error}}return z}function stringContains(F,B){return F.indexOf(B)>-1}function stringEndsWith(F,B){return F.length>=B.length&&F.indexOf(B,F.length-B.length)>-1}function arrayContains(F,B){var G=B.toString().toLowerCase();return F.map((function(F){return F.toString().toLowerCase()})).indexOf(G)>-1}function tryAddNewKeyToHashTable(F,B,G){return!F.hasOwnProperty(B)&&(F[B]=G,!0)}function tryRemoveKeyFromHashTable(F,B){return!!F.hasOwnProperty(B)&&(delete F[B],!0)}function getHashTableCount(F){return Object.keys(F).length}function escapeRegExp(F){return F.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function tryParse(F){var B=null;try{return"object"==typeof(B=JSON.parse(F))?B:null}catch(F){return null}}function getErrorForXHRFailure(F,B){if(!F)return{telemetryEndSubCode:Y.default.CALL_END_CODE.UNKNOWN_ERROR,error:Y.default.CALL_END_UNKNOWN_ERROR};var G;if("object"==typeof F.response)G=F.response;else try{G=JSON.parse(F.response)}catch(F){}if(F.skypeTokenError)return{telemetryEndSubCode:Y.default.CALL_END_CODE.SKYPE_TOKEN_ERROR,error:Y.default.CALL_END_SKYPE_TOKEN_ERROR};if(G&&(G.operationFailure||G.broadcastOperationFailure)){var W=G.operationFailure||G.broadcastOperationFailure;return{telemetryEndSubCode:W.code,error:W}}return G&&G.code?{telemetryEndSubCode:G.code,error:G}:isNaN(F.status)||F.status!==Y.default.CALL_END_CODE.NOT_FOUND?isNaN(F.status)||(null==B?void 0:B.enableErrorCodeImprovementsForNetworkFailures)&&0===F.status&&isNaN(F.response)?{telemetryEndSubCode:Y.default.CALL_END_CODE.NETWORK_ERROR,error:Y.default.CALL_END_NETWORK_ERROR}:{telemetryEndSubCode:F.status,error:{code:F.status,subCode:isNaN(F.response)?0:F.response,phrase:F.statusText,resultCategories:[Y.RESULT_CATEGORIES.UnexpectedClientError]}}:{telemetryEndSubCode:Y.default.CALL_END_CODE.NOT_FOUND,error:Y.default.RESOURCE_NOT_FOUND_ERROR}}function isDuplicateMessage(F,B){if(F&&B){var G=F[Y.default.HEADERS.ORIGINAL_MESSAGE_ID]||null,W=F[Y.default.HEADERS.MESSAGE_ID]||null;if(W&&arrayContains(B,W)||G&&arrayContains(B,G))return!0;B.length>9&&B.shift(),B.push(G||W)}return!1}function extractCauseIdFromMessage(F){try{return F.headers[Y.default.HEADERS.ORIGINAL_MESSAGE_ID].replace("-","").substr(0,8)}catch(F){return causeId()}}function cacheMessageResult(F,B,G){if(F&&B){var W=F[Y.default.HEADERS.ORIGINAL_MESSAGE_ID]||F[Y.default.HEADERS.MESSAGE_ID]||null;W&&(B[W]=G)}}function getMessageResultFromCache(F,B){return F&&B[F[Y.default.HEADERS.ORIGINAL_MESSAGE_ID]||F[Y.default.HEADERS.MESSAGE_ID]||null]||null}function isEncodedMessage(F){return F&&F.hasOwnProperty(Y.default.HEADERS.CONTENT_ENCODING)}function isMessageEncodingSupported(F){return F&&Y.default.KNOWN_PAYLOAD_ENCODINGS.hasOwnProperty(F[Y.default.HEADERS.CONTENT_ENCODING].toUpperCase())}function parseRawHttpMessage(F){var B,G,J=F.split(/\r?\n\r?\n/),Q=J[0].split(/\r?\n/),Y=J[1].split(/\r?\n/),$=Q.shift().split(" "),X=$[0],Z=$[1]||"",ee={};try{for(var te=W(Q),ne=te.next();!ne.done;ne=te.next()){var ie=ne.value;try{var re=z(ie.split(":").map((function(F){return K.trim(F)})),2),oe=re[0],ae=re[1];ee[oe]=ae}catch(F){throw new Error("Malformed header: ".concat(ie+F))}}}catch(F){B={error:F}}finally{try{ne&&!ne.done&&(G=te.return)&&G.call(te)}finally{if(B)throw B.error}}return{url:Z,headers:ee,method:X,body:Y.join("")}}function decodeMessage(F){var B=atob(F);return J.inflate(B,{to:"string"})}function defer(){var F,B,G=!0;return{isPending:function(){return G},promise:new Promise((function(G,W){F=G,B=W})),resolve:function(B){G&&(F(B),G=!1)},reject:function(F){G&&(B(F),G=!1)}}}function isTrouterAndNavigatorConnected(F){var B=!1;try{if(B=F&&F.state()===$.TrouterState.Connected,navigator.onLine&&B)return 3;if(!navigator.onLine&&B)return 2;if(navigator.onLine&&!B)return 1}catch(F){}return 0}function isRetryable(F){return[Y.default.HTTP_STATUS_CODES.UNKNOWN,Y.default.HTTP_STATUS_CODES.UNAUTHORIZED,Y.default.HTTP_STATUS_CODES.NETWORK_ERROR,Y.default.HTTP_STATUS_CODES.OFFLINE,Y.default.HTTP_STATUS_CODES.TIMEOUT,Y.default.HTTP_STATUS_CODES.INTERNAL_SERVER_ERROR,Y.default.HTTP_STATUS_CODES.BAD_GATEWAY,Y.default.HTTP_STATUS_CODES.SERVICE_UNAVAILABLE,Y.default.HTTP_STATUS_CODES.GATEWAY_TIMEOUT].indexOf(F)>=0}function convertStringToTokenType(F){switch(F){case Y.default.HEADERS.BEARER_KEYWORD.toLowerCase():return 4;case Y.default.HEADERS.POP_KEYWORD.toLowerCase():return 2;default:return 1}}function getTokenType(F,B,G,W){var z=1;if(!B)return 1;if(!W){if(G)return 1;F.callingServiceSupportsAADTokens&&(z|=4)}return z}function extractAuthenticationHeaders(F){if(F&&F[Y.default.HEADERS.AUTHENTICATE.toLowerCase()])return{authenticationHeaders:[F[Y.default.HEADERS.AUTHENTICATE.toLowerCase()]]}}function getRequestTypeAsString(F){switch(F){case 0:return"GET";case 1:return"POST";case 2:return"PUT";case 3:return"DELETE"}throw Error("[getRequestTypeAsString]: should never reach here")}function getTokenMetadata(F,B,G,W,z,K){void 0===z&&(z=!1);var J="{ verb: ".concat(getRequestTypeAsString(G),", path: ").concat(W.url," }"),Q=K?extractAuthenticationHeaders(K):void 0;return{tokenType:getTokenType(F,B,z,Q),factorsJson:J,requestMetadataJson:Q}}B.is1to1Mri=is1to1Mri,B.stripMri=stripMri,B.causeId=causeId,B.newMessageId=newMessageId,B.newGuid=newGuid,B.assert=assert,B.assertNotNullOrEmpty=assertNotNullOrEmpty,B.assertNotNull=assertNotNull,B.assertNotNullArrayContent=assertNotNullArrayContent,B.assertCallEndReason=assertCallEndReason,B.getMediaTypes=getMediaTypes,B.stringContains=stringContains,B.stringEndsWith=stringEndsWith,B.arrayContains=arrayContains,B.tryAddNewKeyToHashTable=tryAddNewKeyToHashTable,B.tryRemoveKeyFromHashTable=tryRemoveKeyFromHashTable,B.getHashTableCount=getHashTableCount,B.escapeRegExp=escapeRegExp,B.tryParse=tryParse,B.getErrorForXHRFailure=getErrorForXHRFailure,B.isDuplicateMessage=isDuplicateMessage,B.extractCauseIdFromMessage=extractCauseIdFromMessage,B.cacheMessageResult=cacheMessageResult,B.getMessageResultFromCache=getMessageResultFromCache,B.isEncodedMessage=isEncodedMessage,B.isMessageEncodingSupported=isMessageEncodingSupported,B.parseRawHttpMessage=parseRawHttpMessage,B.decodeMessage=decodeMessage,B.defer=defer,B.isTrouterAndNavigatorConnected=isTrouterAndNavigatorConnected,B.isRetryable=isRetryable,B.convertStringToTokenType=convertStringToTokenType,B.getTokenType=getTokenType,B.extractAuthenticationHeaders=extractAuthenticationHeaders,B.getRequestTypeAsString=getRequestTypeAsString,B.getTokenMetadata=getTokenMetadata},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",z="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",K="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00";B.default={MEDIA_STATE:{send:"sendonly",receive:"recvonly",sendReceive:"sendrecv",inactive:"inactive"},MEDIA_DIRECTION:{SEND:"send",RECV:"recv"},MEDIA_DEVICE_KIND:{audioInput:"audioinput",audioOutput:"audiooutput",videoInput:"videoinput",compositeAudio:"compositeAudio"},MEDIA_DEVICE:{camera:"camera",microphone:"microphone",speaker:"speaker",compositeAudio:"compositeAudio",defaultId:"default",communicationsId:"communications",defaultDeviceLabel:"Default"},MEDIA_ERROR:{constraintNotSatisfiedError:"ConstraintNotSatisfiedError",iceConnectionError:"iceConnectionError",srtpError:"srtpError",permissionDeniedError:"permissionDeniedError",internalError:"internalError",sourceUnavailableError:"SourceUnavailableError",devicesNotFoundError:"DevicesNotFoundError",noDeviceSelected:"noDeviceSelected",noNetworkError:"noNetworkError",incompatibleOffer:"IncompatibleOffer",mediaStreamRequestError:"MediaStreamRequestError",extensionNotFoundError:"ExtensionNotFoundError",sharingCancelledError:"SharingCancelledError",permissionDeniedBySystemError:"PermissionsDeniedBySystem",chromeRuntimeNotDefinedError:"ChromeRuntimeNotDefinedError",mediaStreamRequestTimedOut:"MediaStreamRequestTimedout",unsupportedStream:"UnsupportedStream",webGlRendererError:"WebGlRendererError"},HISTOGRAM_BATCH:{seconds1to3:2,seconds3to5:4,seconds5to8:7,seconds8to15:14,seconds15to60:59,seconds60toMax:1e6},RENEGOTIATION_ERROR:{local:"local",glare:"glare",signaling:"signaling",media:"media",escalation:"escalation"},MSI:{unsubscribe:-1,subscribeAny:-2},MEDIA_LABEL:{audio:"main-audio",video:"main-video",sharing:"applicationsharing-video",data:"data"},MEDIA_TYPE:{audio:"audio",video:"video",sharing:"sharing",data:"x-data",dataChannel:"application"},MODALITY:{audio:"audio",video:"video",sharing:"sharing",data:"data"},ICE_TRANSPORT_POLICY:{all:"all",relay:"relay"},EXTENSION_TYPE:{dominantSpeakerHistory:"dominantSpeakerHistory",videoStreamControl:"videoStreamControl",optimalVideoCount:"optimalVideoCount"},RENDERER_TYPE:{video:"video",sharing:"sharing"},CONTENT_TYPE:{SDP:"application/sdp"},ALLOWED_CONTENT_TYPES:{SDP_ONLY:["application/sdp"],SDP_NGC:["application/sdp","application/sdp-ngc-0.5","application/sdp-ngc-1.0"]},STREAMING_STATE:{created:"created",started:"started",active:"active",inactive:"inactive",stopped:"stopped",removed:"removed",failed:"failed"},TIME_INTERVAL:{SEC_1:1},DISPLAY_SOURCE_ID:"display",SYSTEM_AUDIO_SOURCE_ID:"system",MULTIPLE_RECV_STREAMS:"multipleVideoStreams",PROFILES:{udpTlsRtpSavpf:"UDP/TLS/RTP/SAVPF",rtpSavpf:"RTP/SAVPF",rtpSavp:"RTP/SAVP",udpDtlsSctp:"UDP/DTLS/SCTP"},REPORTING_PROFILE:{RT_PROFILE:"REAL_TIME",BE_PROFILE:"BEST_EFFORT",NRT_PROFILE:"NEAR_REAL_TIME"},PAYLOAD_TYPE:{DATA_CHANNEL:"webrtc-datachannel",X_DATA:"127 126"},VIDEO_CAPABILITIES:{MAX_FS_PATH:"max-fs",MAX_MBPS_PATH:"max-mbps",MAX_FPS_PATH:"max-fps",MAX_BR_PATH:"max-br",SSRC_PATH:"ssrc",RID_PATH:"rid",KEYFRAME_PATH:"KeyFrame",MAX_WIDTH:"max-width",MAX_HEIGHT:"max-height",VLA_DEBUG:"vla-debug"},TRANSPORT_CC:{EXT_URI:W,MSSDP_ENCODED_URI:W.replace(/\//g,"\\"),ATTRIBUTE:"transport-cc"},ABS_SEND_TIME:{EXT_URI:z,MSSDP_ENCODED_URI:z.replace(/\//g,"\\")},VLA:{EXT_URI:K,EXT_URI_NON_ADV:K+"-non-advertised",DEFAULT_VALUE:10}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.PAYLOAD_PROPERTY=B.URL_PATH=B.REQUEST_DISPATCHER_RESPONSE=B.RESULT_CATEGORIES=void 0,B.RESULT_CATEGORIES={Success:"Success",ExpectedError:"ExpectedError",UnexpectedClientError:"UnexpectedClientError",UnexpectedServerError:"UnexpectedServerError"};var W={INCOMING_MESSAGE_ORIGIN:{TROUTER:"Trouter",BROKER:"Broker"},INVITATION_TYPE:{NUDGE:"nudge"},KNOWN_PAYLOAD_ENCODINGS:{GZIP:!0},WEBRTC_NOTIFICATION_TYPE:{CONTROL_VIDEO_STREAMING:"ControlVideoStreaming",DOMINANT_SPEAKER_INFO:"DominantSpeakerInfo",CSRC_INFO:"CsrcInfo"},PARTICIPANT_AUDIO_STATE:{CONNECTING:"Connecting",RINGING:"Ringing",CONNECTED:"Connected",OTHER:"Other"},HEADERS:{MESSAGE_ID:"X-Microsoft-Skype-Message-ID",ORIGINAL_MESSAGE_ID:"X-Microsoft-Skype-Original-Message-ID",CONTENT_ENCODING:"X-Microsoft-Skype-Content-Encoding",CORRELATION_ID:"X-Microsoft-Skype-Chain-ID",CONTENT_SHARING_CORRELATION_ID:"X-Microsoft-Skype-ContentSharing-Chain-ID",CLIENT_USER_AGENT:"X-Microsoft-Skype-Client",SKYPE_TOKEN:"X-Skypetoken",AUTHORIZATION:"Authorization",BEARER_KEYWORD:"Bearer",POP_KEYWORD:"Pop",CACHE_SKYPE_TOKEN:"X-CacheSkypeToken",AUTHENTICATE:"WWW-Authenticate",BROKER_USE_BATCHING_HEADER_NAME:"X-UseBatching",PARTICIPANT_ID:"X-Microsoft-Skype-Participant-ID",CONTENT_TYPE:"Content-Type",RING:"MS-Teams-Ring",REGION:"MS-Teams-Region",PARTITION:"MS-Teams-Partition"},KNOWN_BOTS:{VOICEMAIL_BOT_ID:"28:14524421-25b4-403a-a0f7-e62d4379cabc"},HTTP_STACK_ERROR:{NONE:0,CANNOT_CONNECT:7,REQUEST_TIMEOUT:10,ATTEMPT_TIMEOUT:30,REQUEST_ABORTED:16,ATTEMPT_ABORTED:31,ABORTED_OTHER_ATTEMPT_SUCCESSFUL:32},HTTP_STATUS_CODES:{UNKNOWN:0,OK:200,CREATED:201,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,FORBIDDEN:403,PRECONDITION_FAILED:412,UNPROCESSABLE_ENTITY:422,NETWORK_ERROR:490,SKYPE_TOKEN_ERROR:495,OFFLINE:496,TIMEOUT:498,ABORTED:498,OTHER:499,INTERNAL_SERVER_ERROR:500,CONFLICT:409,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504},CALL_END_SKYPE_TOKEN_ERROR:{code:495,subCode:4507,phrase:"CallEndReasonSkypeTokenFetchError",resultCategories:[B.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_LOCAL_HTTP_STACK_ERROR:{code:496,subCode:4520,phrase:"LocalHTTPStackError",resultCategories:[B.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_UNKNOWN_ERROR:{code:497,subCode:3121,phrase:"CallEndReasonUnknownError",resultCategories:[B.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_NETWORK_ERROR:{code:490,subCode:4502,phrase:"CallEndReasonNetworkError",resultCategories:[B.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_LOCAL_DECLINE:{code:486,subCode:4508,phrase:"LocalDecline",resultCategories:[B.RESULT_CATEGORIES.Success]},RESOURCE_NOT_FOUND_ERROR:{code:404,subCode:404,phrase:"ResourceNotFound",resultCategories:[B.RESULT_CATEGORIES.ExpectedError]},CALL_STATUS:{IDLE:"Idle",RINGING:"Ringing",CONNECTING:"Connecting",CONNECTED:"Connected",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly",LOCAL_TERMINATED:"LocalTerminated",REMOTE_TERMINATED:"RemoteTerminated"},MEDIA_TYPES:{AUDIO:"Audio",VIDEO:"Video",SCREEN_SHARER:"ScreenSharer",SCREEN_VIEWER:"ScreenViewer"},MUTE_SCOPE:{MYSELF:"Myself",EVERYONE_ELSE:"EveryoneElse",SPECIFIED_PARTICIPANTS:"SpecifiedParticipants"},URL_BASE:{CALLAGENT:"callAgent"},LINKS:{HANGUP:"hangup",MEDIA_REJECTION:"mediaRejection",MEDIA_ANSWER:"mediaAnswer",MEDIA_RENEGOTIATION:"mediaRenegotiation",ACCEPT:"accept",ATTACH:"attach",REJECT:"reject",REDIRECT:"redirect",REPLACE:"replace",TRANSFER:"transfer",NEW_OFFER:"newOffer",TRANSFER_ACCEPTANCE:"transferAcceptance",TRANSFER_COMPLETION:"transferCompletion",CONVERSATION_CONTROLLER:"conversationController",ADD_PARTICIPANT:"addParticipant",ADD_PARTICIPANTS_AND_MODALITY:"addParticipantsAndModality",LEAVE:"leave",NOTIFICATION_LINKS:"notificationLinks",REMOVE_PARTICIPANT:"removeParticipant",KEEPALIVE:"keepAlive",ADD_MODALITY:"AddModality",REMOVE_MODALITY:"RemoveModality",CONTENT_SHARING_CONTROLLER:"contentSharingController",CONTENT_SHARING_TAKE_CONTROL:"contentSharingTakeControl",CONTENT_SHARING_UPDATE_SESSION_STATE:"contentSharingUpdateSessionState",CONTENT_SHARING_UPDATE_PARTICIPANT_STATE:"contentSharingUpdateParticipantState",CONTENT_SHARING_NOTIFICATION_LINKS:"contentSharingNotificationLinks",CONTENT_SHARING_LEAVE:"contentSharingLeave",MUTE:"mute",UNMUTE:"unmute",ADMIT:"admit",ADMIT_ALL:"admitAll",CONTROL_VIDEO_STREAMING:"controlVideoStreaming",APPLY_CHANNEL_PARAMETERS:"applyChannelParameters",UPDATE_ENDPOINT_STATE:"updateEndpointState",UPDATE_ENDPOINT_METADATA:"updateEndpointMetadata",LMC_NOTIFICATION_LINKS:"lmcNotificationLinks",UPDATE_PARTICIPANT_ROLE:"updateParticipantRole",PUBLISH_STATE:"publishState",REMOVE_STATE:"removeState",UPDATE_MEETING_SETTINGS:"updateMeetingSettings",SEARCH_PARTICIPANTS:"searchParticipants",GET_ALL_PARTICIPANTS:"getAllParticipants",PARK:"park",UNPARK:"unpark",UPDATE_MEETING_LIVE_STATE:"updateMeetingLiveState",UPDATE_MEETING_GROUPS:"updateMeetingGroups",SET_MEETING_LAYOUT:"setMeetingLayout",UPDATE_PARTICIPANT_INTERPRETATION_STATE:"updateParticipantInterpretationState",JOIN_MEETING_GROUP:"joinMeetingGroup",LEAVE_MEETING_GROUP:"leaveMeetingGroup"},CONTENT_TYPE:{JSON:"application/json",SDP:"application/sdp"},TROUTER_EVENT_TYPE:{SKYPE_SKYPE_CALL:107,LYNC_SKYPE_CALL:105},MISC:{CONVERSATION:"conversation",LOBBY_CALL_CONTROLLER:"lobby",LOBBY_PARTICIPANT_STATE:"lobby"},SIGNALING_FSM_STATE:{IDLE:"Idle",INCOMING:"Incoming",WAITING_CALL_ACCEPTANCE_ACK:"WaitingCallAcceptanceAck",OUTGOING:"Outgoing",CONNECTED:"Connected",OUTGOING_FOR_ROSTER_ONLY:"OutgoingForRosterOnly",CONNECTED_FOR_ROSTER_ONLY:"ConnectedForRosterOnly"},MEDIA_RENEGOTIATION_FSM_STATE:{IDLE:"Idle",CALL_CONNECTED:"Connected",INCOMING_RENEGOTIATION:"IncomingRenegotiation",OUTGOING_RENEGOTIATION:"OutgoingRenegotiation",RENEGOTIATION_GLARE:"RenegotiationGlare"},CONTENT_SHARING_FSM_STATE:{IDLE:"Idle",CONTENT_SHARING_START_INITIATED:"ContentSharingStartInitiated",CONTENT_SHARING_JOIN_INITIATED:"ContentSharingJoinInitiated",CONTENT_SHARING_LEAVE_INITIATED:"ContentSharingLeaveInitiated",CONTENT_SHARING_DELETE_INITIATED:"ContentSharingDeleteInitiated",CONTENT_SHARING_CONNECTED:"ContentSharingConnected"},TIMEOUT_OPERATIONS:{ADD_PARTICIPANT:"AddParticipant",NUDGE_PARTICIPANT:"NudgeParticipant",REMOVE_PARTICIPANT:"RemoveParticipant",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT:"Admit",CALL_REDIRECT:"CallRedirect",CALL_ME_BACK:"CallMeBack",INCOMING_CALL_ESTABLISHMENT:"IncomingCallEstablishment",OUTGOING_CALL_ESTABLISHMENT:"OutgoingCallEstablishment",MEDIA_ANSWER:"MediaAnswer",MEDIA_ANSWER_ACKNOWLEDGEMENT:"MediaAnswerAcknowledgement",ADD_MODALITY:"AddModality",UNMUTE:"Unmute",UPDATE_MEETING_ROLE:"UpdateMeetingRole",MAX_PREAHEATED_TIMEOUT:"MaxPreheateadTimeout",PARK_COMPLETION:"ParkCompletion",UNPARK_COMPLETION:"UnparkCompletion",UPDATE_MEETING_LIVE_STATE_COMPLETION:"UpdateMeetingLiveStateCompletion",UPDATE_MEETING_GROUPS_COMPLETION:"UpgradeMeetingGroupsCompletion",UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION:"UpdateParticipantInterpretationStateCompletion",JOIN_MEETING_GROUP_COMPLETION:"JoinMeetingGroupCompletion",LEAVE_MEETING_GROUP_COMPLETION:"LeaveMeetingGroupCompletion",SET_MEETING_LAYOUT_COMPLETION:"SetMeetingLayoutCompletion"},TIMEOUT_VALUES_IN_SECONDS:{ADD_PARTICIPANT_TIMEOUT:130,REMOVE_PARTICIPANT_TIMEOUT:60,INCOMING_CALL_ESTABLISHMENT_TIMEOUT:75,OUTGOING_CALL_ESTABLISHMENT_TIMEOUT:90,MEDIA_ANSWER_TIMEOUT:35,MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT:15,ADD_MODALITY_TIMEOUT:65,UNMUTE_TIMEOUT:35,ADMIT_PARTICIPANT_TIMEOUT:30,ADMIT_TIMEOUT:60,UPDATE_MEETING_ROLE_TIMEOUT:15,NUDGE_PARTICIPANT_TIMEOUT:60,CALL_ME_BACK_TIMEOUT:120,MAX_PREAHEATED_TIMEOUT:60,PARK_COMPLETION_TIMEOUT:45,UNPARK_COMPLETION_TIMEOUT:45,UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:45,UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:45,SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:45,UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION_TIMEOUT:45,JOIN_MEETING_GROUP_COMPLETION_TIMEOUT:45,LEAVE_MEETING_GROUP_COMPLETION_TIMEOUT:45,CONVERSATION_KEEP_ALIVE_TIMEOUT:2700},CALL_END_CODE:{REJECT:603,SUCCESS:0,CALL_REDIRECTED:302,CANCEL:487,TIMEOUT:408,SERVICE_UNAVAILABLE:500,BAD_REQUEST:406,NO_NGC_ENDPOINT:480,P2P_FALLBACK_FOR_SCREENSHARING:460,CONFLICT:409,MEDIA_ERROR:410,CONF_PARTICIPANT_COUNT_LIMIT_REACHED:413,CALL_DOES_NOT_EXIST:481,CALL_ACCEPTED:450,CALL_FORWARDED:451,CALL_FORWARDED_TO_VOICEMAIL:452,P2P_REJECT_CALL:453,P2P_FALLBACK_DUE_TO_GROUPCALL:461,CALL_LEG_ENDED_ON_SERVICE:470,NOT_ACCEPTABLE_HERE:488,NETWORK_ERROR:490,UNKNOWN_ERROR:497,LOCAL_ERROR:498,CALL_MODALITY_FAILURE:580,ATC_CONTROLLER_FAILURE:581,CVA_CONTROLLER_FAILURE:586,GLARE_ERROR:491,NOT_FOUND:404,SKYPE_TOKEN_ERROR:495,LOCAL_HTTP_STACK_ERROR:496,HTTP_OTHER_ERROR:499,DECODING_FAILED:407,NOT_AUTHORIZED:403,BAD_SERVICE_RESPONSE:400},CALL_END_SUB_CODE:{SUCCESS:0,CALL_REDIRECTED_SUCCESS:3020,DOWNGRADE_TO_STREAMING_CLIENT:3099,MEDIA_DROP_DURING_CONNECT:3100,MEDIA_DROP_AFTER_CONNECT:3101,MEDIA_ANSWER_PROCESSING_ERROR:3102,MEDIA_FINAL_ANSWER_PROCESSING_ERROR:3103,MEDIA_OFFER_TIMEOUT:3104,MEDIA_FINAL_ANSWER_TIMEOUT:3105,MEDIA_OFFER_NULL:3106,MEDIA_AUDIO_DEVICE_ERROR:3107,MEDIA_RENEGOTIATION_ERROR:3108,MEDIA_PERMISSION_ERROR:3109,MEDIA_UNKNOWN_ERROR:3110,MEDIA_OFFER_PROCESSING_ERROR:3111,MEDIA_WHITELISTING_ISSUE:3112,MEDIA_MUTE_MICROPHONE_ERROR:3114,MEDIA_MUTE_SPEAKER_ERROR:3115,MEDIA_UNMUTE_MICROPHONE_ERROR:3116,MEDIA_UNMUTE_SPEAKER_ERROR:3117,MEDIA_GLARE_ERROR:3118,CONVERSATION_TERMINATION_UNKNOWN_ERROR:3121,CALL_NOT_ATTEMPTED:4500,CONV_URL_NOT_SET:4501,FAILED_TO_REACH_SERVICE:4502,PLACE_CALL_FAILED:4503,ATTACH_CALL_FAILED:4504,BAD_NOTIFICATION_PAYLOAD:4505,CALL_ESTABLISHMENT_TIMEOUT:4506,SKYPE_TOKEN_ERROR:4507,CONVERSATION_RESOLUTION_CONFLICT:5704,CALL_PARTICIPANT_REMOVAL_TIMEOUT:4507,UNMUTE_REQUEST_TIMEOUT:4509,UNMUTE_REQUEST_REJECTED:4510,CONFLICT_IN_NG:4090,CONFLICT_WITH_P2P:4091,CONVERSATION_END_RECEIVED_FROM_SERVICE:4100,TRANSFER_COMPLETE_TIMEOUT:4101,ATTACH_TO_NON_EXISTENT_CALL:4102,ATTACH_ACTION_FAILED:4103,ATTACH_FAILED:4105,CONVERSATION_ESTABLISHMENT_FAILED:4106,BEFORE_CONNECT:4107,AFTER_CONNECT:4108,AFTER_ACCEPT:4109,TROUTER_CONNECTION_DROPPED:4111,DUE_TO_CALL_ASSIMILATION:4112,PREHEATED_CALL_TIMEDOUT:4113,UNPARK_COMPLETION_TIMEOUT:4114,PARK_COMPLETION_TIMEOUT:4115,UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:4116,UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:4117,SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:4118,UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:4119,JOIN_MEETING_GROUP_TIMEOUT:4120,LEAVE_MEETING_GROUP_TIMEOUT:4121,LOCAL_HTTP_STACK_ERROR:4520,BEACON:4521,CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:5014,UNABLE_TO_GENERATE_MEETUP_ID:5015,UPDATE_MEETING_ROLE_REJECTED:5651,UPDATE_MEETING_ROLE_TIMEOUT:5652,PUBLISH_STATE_LINK_MISSING:5653,PUBLISH_STATE_INVALID_CONTENT:5654,PUBLISH_STATE_INVALID_SERVICE_RESPONSE:5655,REMOVE_STATE_LINK_MISSING:5656,REMOVE_STATE_MISSING_ARGUMENTS:5657,UPDATE_MEETING_SETTINGS_LINK_MISSING:5658,UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS:5659,ADMIT_ALL_LINK_MISSING:5660,ADMIT_TIMEOUT:5661,CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE:5670,ROSTER_HANDLING_INVALID_SERVICE_RESPONSE:5671,SEARCH_PARTICIPANTS_LINK_MISSING:5672,SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5673,GET_ALL_PARTICIPANTS_LINK_MISSING:5674,GET_ALL_PARTICIPANTS_INVALID_SCOPE:5675,GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5676,PARK_UNPARK_TYPE_MISSING:5680,PARK_UNPARK_V2_DISABLED:5682,CALL_ENDED_BY_PLATFORM_AGENT:7e3},CALL_END_PHRASE:{UNKNOWN:"CallEndReasonUnknown",MEDIA_ERROR:"CallEndReasonMediaError",MEDIA_OFFER_TIMEOUT:"CallEndReasonMediaOfferTimeout",MEDIA_FINAL_ANSWER_TIMEOUT:"CallEndReasonMediaFinalAnswerTimeout",MEDIA_ANSWER_ERROR:"CallEndReasonMediaAnswerError",MEDIA_FINAL_ANSWER_ERROR:"CallEndReasonFinalAnswerError",MEDIA_PERMISSION_ERROR:"CallEndReasonMediaPermissionError",MEDIA_RENEGOTIATION_ERROR:"CallEndReasonRenegotiationError",MEDIA_DROP_DURING_CONNECT:"CallEndReasonMediaDropDuringConnectError",MEDIA_DROP_AFTER_CONNECT:"CallEndReasonMediaDropAfterConnectError",MEDIA_OFFER_PROCESSING_ERROR:"CallEndReasonMediaOfferProcessingError",MEDIA_WHITELISTING_ISSUE:"MediaWhitelistingIssue",AUDIO_ERROR:"CallEndReasonAudioDeviceError",BAD_NOTIFICATION_PAYLOAD:"BadCallNotificationPayload",NETWORK_ERROR:"CallEndReasonNetworkError",LOCAL_USER_INITIATED:"CallEndReasonLocalUserInitiated",REMOTE_USER_INITIATED:"CallEndReasonRemoteUserInitiated",ESTABLISHMENT_TIMEOUT:"CallEndReasonEstablishmentTimeout",PARTICIPANT_REMOVAL_TIMEOUT:"CallParticipantRemovalTimeout",LOCAL_ERROR:"CallEndReasonLocalError",CALL_UPDATE_ERROR:"CallEndReasonCallUpdateError",CALL_REDIRECT_IS_NOT_ALLOWED:"CallRedirectisNotAllowed",P2P_FORK_CONNECTED:"CallEndReasonP2pForkConnected",P2P_FORK_FORWARDED:"CallEndReasonP2pForkForwarded",P2P_FORK_FORWARDED_TO_VOICEMAIL:"CallEndReasonP2pForkForwardedToVoiceMail",P2P_FALLBACK_FOR_SCREENSHARING:"CallEndReasonP2pFallbackForScreensharing",P2P_FALLBACK_FOR_GROUPCALL:"CallEndReasonP2pFallbackForGroupCall",P2P_FALLBACK_FOR_CALL_ASSIMILATION:"CallEndReasonP2pFallbackForCallAssimilation",P2P_FALLBACK_FOR_TRANSLATION:"CallEndReasonP2pFallbackForCallTranslation",P2P_FORK_REJECTED:"CallEndReasonP2pForkRejected",TROUTER_CONNECTION_DROPPED:"CallEndReasonTrouterConnectionDropped",REMOVED_FROM_CALL:"CallEndReasonRemovedFromCall",TRANSFER_COMPLETION_TIMEOUT:"CallEndReasonTransferCompletionTimeout",CALL_DOES_NOT_EXIST:"CallEndReasonCallDoesNotExist",ATTACH_ACTION_FAILED:"CallEndReasonAttachActionFailed",ATTACH_FAILED:"CallEndReasonAttachFailed",CONVERSATION_ESTABLISHMENT_FAILED:"CallEndReasonConversationEstablishmentFailed",CONV_END_FROM_SERVICE:"CallEndReasonConversationEndReceivedFromService",CONV_END_FROM_SERVICE_WITH_ERROR:"CallEndReasonConversationEndReceivedFromServiceWithError",SERVICE_ERROR:"CallEndReasonServiceError",CONFLICT:"CallEndReasonConflict",CALL_ALREADY_IN_P2P:"CallEndReasonCallAlreadyExistsInP2p",CONV_END_NO_MODALITY:"ConversationEndNoModalityConnected",CONV_END_FOR_ALL_INITIATED:"ConversationEndForAllInitiated",RENEGOTIATION_IN_PROGRESS:"NegotiationIsInProgress",ADD_PARTICIPANT_URL_MISSING:"AddParticipantUrlMissing",ADMIT_PARTICIPANT_URL_MISSING:"AdmitParticipantUrlMissing",ADMIT_ALL_URL_MISSING:"AdmitAllUrlMissing",UPDATE_PARTICIPANT_INTERPRETATION_STATE_URL_MISSING:"UpdateParticipantInterpretationStateUrlMissing",ADMIT_TIMEOUT:"AdmitTimeout",UNABLE_TO_GENERATE_MEETUP_ID:"Unable to generate GroupChat meetup id.",ENDED_BY_PMA:"Call ended by media agent.",OWNERSHIP_RESOLUTION_CONFLICT:"Conversation cannot be created due to a failure to resolve ownership.",CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:"This conversation has ended since we were unable to determine a potential host for the group call.",UNMUTE_REQUEST_TIMEOUT:"UnmuteRequestTimeout",UNMUTE_REQUEST_REJECTED:"UnmuteRequestRejected",UPDATE_MEETING_ROLE_TIMEOUT:"UpdateMeetingRoleTimeout",UPDATE_MEETING_ROLE_REJECTED:"Update meeting role operation failed due to insufficient privileges.",PARK_REQUEST_FAILED:"Park Request Failed",PARK_COMPLETION_TIMEOUT:"ParkCompletionTimeout",PARK_COMPLETION_FAILED:"ParkCompletionFailed",UNPARK_REQUEST_FAILED:"UnparkFailed",UNPARK_COMPLETION_TIMEOUT:"UnparkCompletionTimeout",UNPARK_COMPLETION_FAILED:"UnparkCompletionFailed",BAD_SERVICE_RESPONSE:"BadServiceResponse",UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:"UpdateMeetingLiveStateCompletionTimeout",UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:"UpdateMeetingGroupsCompletionTimeout",SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:"SetMeetingLayoutCompletionTimeout",UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:"UpdateParticipantInterpretationTimeout",JOIN_MEETING_GROUP_TIMEOUT:"JoinMeetingGroupTimeout",LEAVE_MEETING_GROUP_TIMEOUT:"LeaveMeetingGroupTimeout",DOWNGRADE_TO_STREAMING_CLIENT:"DowngradeToStreamingClient"},TRANSACTION_END_CODE:{SUCCESS:0},URL_DEFAULTS:{UPLOAD_LOG_URL:"https://api.cc.skype.com/cc/v1/uploadlog/"},SUCCESS_TRANSACTION_END:{code:0,resultCategories:[B.RESULT_CATEGORIES.Success]}};B.REQUEST_DISPATCHER_RESPONSE={REQUEST_TIMEOUT:{status:W.HTTP_STATUS_CODES.TIMEOUT,statusText:"Request timed out",readyState:0,response:W.HTTP_STACK_ERROR.REQUEST_TIMEOUT},ATTEMPT_TIMEOUT:{status:W.HTTP_STATUS_CODES.TIMEOUT,statusText:"Attempt timed out",readyState:0,response:W.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT},REQUEST_ABORTED:{status:W.HTTP_STATUS_CODES.ABORTED,statusText:"Request Aborted",readyState:0,response:W.HTTP_STACK_ERROR.REQUEST_ABORTED},ATTEMPT_ABORTED:{status:W.HTTP_STATUS_CODES.ABORTED,statusText:"Attempt Aborted",readyState:0,response:W.HTTP_STACK_ERROR.ATTEMPT_ABORTED}},B.URL_PATH={MEDIA_ACKNOWLEDGEMENT:"/call/mediaAcknowledgement/",MEDIA_REJECTION:"/call/rejection/",ACKNOWLEDGEMENT:"/call/acknowledgement/",MEDIA_RENEGOTIATION:"/call/mediaRenegotiation/",REPLACE:"/call/replacement/",PROGRESS:"/call/progress/",MEDIA_ANSWER:"/call/mediaAnswer/",NEW_MEDIA_OFFER:"/call/newMediaOffer/",REDIRECTION:"/call/redirection/",BALANCE_UPDATE:"/call/balanceUpdate/",ACCEPT:"/call/acceptance/",CONTROL_VIDEO_STREAMING:"/call/controlVideoStreaming/",DOMINANT_SPEAKER_INFO:"/call/dominantSpeakerInfo/",CSRC_INFO:"/call/csrcInfo/",END:"/call/end/",RETARGET_COMPLETION:"/call/retargetCompletion/",TRANSFER:"/call/transfer/",TRANSFER_ACCEPTANCE:"/call/transferAcceptance/",TRANSFER_COMPLETION:"/call/transferCompletion/",PARK_COMPLETION:"/call/holdCompletion/",UNPARK_COMPLETION:"/call/resumeCompletion/",CONV_END:"/conversation/end/",CONV_UPDATE:"/conversation/update/",CONV_LOCAL_PARTICIPANT_UPDATE:"/conversation/localParticipantUpdate/",CONV_ROSTER_UPDATE:"/conversation/rosterUpdate/",CONV_ADD_PARTICIPANT_SUCCESS:"/conversation/addParticipantSuccess/",CONV_ADD_PARTICIPANT_FAILURE:"/conversation/addParticipantFailure/",CONV_NUDGE_PARTICIPANT_SUCCESS:"/conversation/nudgeParticipantSuccess/",CONV_NUDGE_PARTICIPANT_FAILURE:"/conversation/nudgeParticipantFailure/",CONV_ADMIT_PARTICIPANT_SUCCESS:"/conversation/admitParticipantSuccess/",CONV_ADMIT_PARTICIPANT_FAILURE:"/conversation/admitParticipantFailure/",CONV_ADMIT_ALL_STATUS:"/conversation/admitAllStatus/",CONV_REMOVE_PARTICIPANT_SUCCESS:"/conversation/removeParticipantSuccess/",CONV_REMOVE_PARTICIPANT_FAILURE:"/conversation/removeParticipantFailure/",CONV_ADD_MODALITY_SUCCESS:"/conversation/addModalitySuccess/",CONV_ADD_MODALITY_FAILURE:"/conversation/addModalityFailure/",CONV_CONTENT_SHARING_UPDATE:"/conversation/contentSharingUpdate/",CONV_CONTENT_SHARING_END:"/conversation/contentSharingEnd/",CONV_BROADCAST_UPDATE:"/conversation/broadcastUpdate/",CONV_CONFIRM_UNMUTE:"/conversation/confirmUnmute/",CONV_UNMUTE_SUCCESS:"/conversation/unmuteSuccess/",CONV_UNMUTE_FAILURE:"/conversation/unmuteFailure/",LWJ_END:"/lwj/end/",LWJ_ACCEPTANCE:"/lwj/acceptance/",UPDATE_MEETING_LIVE_STATE_STATUS:"/conversation/updateMeetingLiveStateStatus/",UPDATE_MEETING_GROUPS_STATUS:"/conversation/updateMeetingGroupsStatus/",SET_MEETING_LAYOUT_STATUS:"/conversation/setMeetingLayoutStatus/",UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS:"/conversation/updateParticipantInterpretationStateStatus/",JOIN_MEETING_GROUP_STATUS:"/conversation/joinMeetingGroupStatus/",LEAVE_MEETING_GROUP_STATUS:"/conversation/leaveMeetingGroupStatus/",RECEIVE_MESSAGE:"/conversation/receiveMessage/"},B.PAYLOAD_PROPERTY={CALL_NOTIFICATION:"callNotification",MEDIA_ANSWER:"mediaAnswer",MEDIA_ACKNOWLEDGEMENT:"mediaAcknowledgement",CALL_ACCEPTANCE:"callAcceptance",CALL_END:"callEnd",CALL_PROGRESS:"callProgress",CALL_ACCEPTANCE_ACKNOWLEDGEMENT:"callAcceptanceAcknowledgement",MEDIA_NEGOTIATION:"mediaNegotiation",MEDIA_NEGOTIATION_FAILURE:"mediaNegotiationFailure",BALANCE_UPDATE:"balanceUpdate",RETARGET_COMPLETED:"retargetCompleted",CALL_TRANSFER:"callTransfer",TRANSFER_COMPLETION:"transferCompletion",TRANSFER_ACCEPTANCE:"transferAcceptance",PARK_COMPLETION:"holdCompletion",UNPARK_COMPLETION:"resumeCompletion",UPDATE_MEETING_LIVE_STATE_RESPONSE:"updateMeetingLiveStateResponse",UPDATE_MEETING_GROUPS_RESPONSE:"updateMeetingGroupsResponse",SET_MEETING_LAYOUT_RESPONSE:"setMeetingLayoutResponse"},B.default=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(15);B.default=W.default},function(F,B,G){
/*!
	 * Microsoft Dynamic Proto Utility, 1.1.4
	 * Copyright (c) Microsoft and contributors. All rights reserved.
	 */
var W="constructor",z="prototype",K="function",J="_dynInstFuncs",Q="_isDynProxy",Y="_dynClass",$="_dynCls$",X="_dynInstChk",Z=X,ee="_dfOpts",te="_unknown_",ne="__proto__",ie="useBaseInst",re="setInstFuncs",oe=Object,ae=oe.getPrototypeOf,se=0;function _hasOwnProperty(F,B){return F&&oe[z].hasOwnProperty.call(F,B)}function _isObjectOrArrayPrototype(F){return F&&(F===oe[z]||F===Array[z])}function _isObjectArrayOrFunctionPrototype(F){return _isObjectOrArrayPrototype(F)||F===Function[z]}function _getObjProto(F){if(F){if(ae)return ae(F);var B=F[ne]||F[z]||(F[W]?F[W][z]:null);if(B)return B}return null}function _forEachProp(F,B){var G=[],W=oe.getOwnPropertyNames;if(W)G=W(F);else for(var z in F)"string"==typeof z&&_hasOwnProperty(F,z)&&G.push(z);if(G&&G.length>0)for(var K=0;K<G.length;K++)B(G[K])}function _isDynamicCandidate(F,B,G){return B!==W&&typeof F[B]===K&&(G||_hasOwnProperty(F,B))}function _throwTypeError(F){throw new TypeError("DynamicProto: "+F)}function _getInstanceFuncs(F){var B={};return _forEachProp(F,(function(G){!B[G]&&_isDynamicCandidate(F,G,!1)&&(B[G]=F[G])})),B}function _hasVisited(F,B){for(var G=F.length-1;G>=0;G--)if(F[G]===B)return!0;return!1}function _getBaseFuncs(F,B,G,W){function _instFuncProxy(F,B,G){var z=B[G];if(z[Q]&&W){var K=F[J]||{};!1!==K[Z]&&(z=(K[B[Y]]||{})[G]||z)}return function(){return z.apply(F,arguments)}}var z={};_forEachProp(G,(function(F){z[F]=_instFuncProxy(B,G,F)}));for(var K=_getObjProto(F),$=[];K&&!_isObjectArrayOrFunctionPrototype(K)&&!_hasVisited($,K);)_forEachProp(K,(function(F){!z[F]&&_isDynamicCandidate(K,F,!ae)&&(z[F]=_instFuncProxy(B,K,F))})),$.push(K),K=_getObjProto(K);return z}function _getInstFunc(F,B,G,W){var z=null;if(F&&_hasOwnProperty(G,Y)){var Q=F[J]||{};if((z=(Q[G[Y]]||{})[B])||_throwTypeError("Missing ["+B+"] "+K),!z[X]&&!1!==Q[Z]){for(var $=!_hasOwnProperty(F,B),ee=_getObjProto(F),te=[];$&&ee&&!_isObjectArrayOrFunctionPrototype(ee)&&!_hasVisited(te,ee);){var ne=ee[B];if(ne){$=ne===W;break}te.push(ee),ee=_getObjProto(ee)}try{$&&(F[B]=z),z[X]=1}catch(F){Q[Z]=!1}}}return z}function _getProtoFunc(F,B,G){var W=B[F];return W===G&&(W=_getObjProto(B)[F]),typeof W!==K&&_throwTypeError("["+F+"] is not a "+K),W}function _populatePrototype(F,B,G,W,z){function _createDynamicPrototype(F,B){var dynProtoProxy=function(){return(_getInstFunc(this,B,F,dynProtoProxy)||_getProtoFunc(B,F,dynProtoProxy)).apply(this,arguments)};return dynProtoProxy[Q]=1,dynProtoProxy}if(!_isObjectOrArrayPrototype(F)){var K=G[J]=G[J]||{},Y=K[B]=K[B]||{};!1!==K[Z]&&(K[Z]=!!z),_forEachProp(G,(function(B){_isDynamicCandidate(G,B,!1)&&G[B]!==W[B]&&(Y[B]=G[B],delete G[B],(!_hasOwnProperty(F,B)||F[B]&&!F[B][Q])&&(F[B]=_createDynamicPrototype(F,B)))}))}}function _checkPrototype(F,B){if(ae)for(var G=[],W=_getObjProto(B);W&&!_isObjectArrayOrFunctionPrototype(W)&&!_hasVisited(G,W);){if(W===F)return!0;G.push(W),W=_getObjProto(W)}return!1}function _getObjName(F,B){return _hasOwnProperty(F,z)?F.name||B||te:((F||{})[W]||{}).name||B||te}function dynamicProto(F,B,G,W){_hasOwnProperty(F,z)||_throwTypeError("theClass is an invalid class definition.");var K=F[z];_checkPrototype(K,B)||_throwTypeError("["+_getObjName(F)+"] is not in class hierarchy of ["+_getObjName(B)+"]");var J=null;_hasOwnProperty(K,Y)?J=K[Y]:(J=$+_getObjName(F,"_")+"$"+se,se++,K[Y]=J);var Q=dynamicProto[ee],X=!!Q[ie];X&&W&&void 0!==W[ie]&&(X=!!W[ie]);var Z=_getInstanceFuncs(B);G(B,_getBaseFuncs(K,B,Z,X));var te=!!ae&&!!Q[re];te&&W&&(te=!!W[re]),_populatePrototype(K,J,B,Z,!1!==te)}var ce={setInstFuncs:!0,useBaseInst:!0};dynamicProto[ee]=ce,B.a=dynamicProto},function(B,G){B.exports=F},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getIdFromUrl=B.get=void 0;var W=G(5),z=G(3);function get(F,B,G){return void 0===G&&(G=z.causeId()),z.assertNotNullOrEmpty(B,"trailingPath cannot be null"),z.assertNotNull(F,"signalingSession cannot be null"),z.assertNotNull(F.baseMessagingChannelUrl,"messaging channel url is not set"),"".concat(F.baseMessagingChannelUrl).concat(W.default.URL_BASE.CALLAGENT,"/").concat(F.sessionId,"/").concat(G).concat(B)}function getIdFromUrl(F){var B=F.match(new RegExp("/".concat(z.escapeRegExp(W.default.URL_BASE.CALLAGENT),"/+([^/]+)"),"i"));return B?B[1]:null}B.get=get,B.getIdFromUrl=getIdFromUrl},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.printMediaStream=B.allowProvisionalAnswer=B.convertToCodecInfo=B.getSimulcastConfigForMediaType=B.isVersionGreaterOrEqual=B.getAllowedCodecs=B.allowDataChannel=B.canUseWebrtc1_0=B.preferSdesSrtp=B.scrubConstraints=B.scrubDevices=B.scrubSelectedDevices=B.scrubObjectExcludingFields=B.scrubObjectFields=B.sendStreamsToModalities=B.mediaTypeToModality=B.modalityToMediaType=B.mergeSendModalities=B.getSendMediaModalities=B.isSendModalityAdded=B.parseCandidateString=B.removeChangedSendDirection=B.excludePassiveModalities=B.getSrtpInfo=B.areSendDirectionsFulfilled=B.areNegotiatedDirectionsFulfilled=B.areNegotiatedDirectionsAcceptable=B.negotiateModalities=B.isOnHold=B.addReceiveDirectionality=B.hasReceiveDirectionality=B.hasSendDirectionality=B.removeSendDirectionality=B.invertModalities=B.negotiateDirectionality=void 0;var J=G(17),Q=G(1),Y=G(4),$=G(27);function invertDirectionality(F){switch(F){case Y.default.MEDIA_STATE.send:return Y.default.MEDIA_STATE.receive;case Y.default.MEDIA_STATE.receive:return Y.default.MEDIA_STATE.send;default:return F}}function negotiateDirectionality(F,B){var G=hasSendDirectionality(F)&&hasSendDirectionality(B),W=hasReceiveDirectionality(F)&&hasReceiveDirectionality(B);return G&&W?Y.default.MEDIA_STATE.sendReceive:G?Y.default.MEDIA_STATE.send:W?Y.default.MEDIA_STATE.receive:F===Y.default.MEDIA_STATE.inactive&&B||F&&B===Y.default.MEDIA_STATE.inactive?Y.default.MEDIA_STATE.inactive:void 0}function invertModalities(F){var B={},G=invertDirectionality(F.audio);G&&(B.audio=G);var W=invertDirectionality(F.video);W&&(B.video=W);var z=invertDirectionality(F.sharing);z&&(B.sharing=z);var K=invertDirectionality(F.data);return K&&(B.data=K),B}function removeSendDirectionality(F){return F===Y.default.MEDIA_STATE.sendReceive?Y.default.MEDIA_STATE.receive:void 0}function hasSendDirectionality(F){return F===Y.default.MEDIA_STATE.send||F===Y.default.MEDIA_STATE.sendReceive}function hasReceiveDirectionality(F){return F===Y.default.MEDIA_STATE.receive||F===Y.default.MEDIA_STATE.sendReceive}function addReceiveDirectionality(F){return hasReceiveDirectionality(F)?F:F===Y.default.MEDIA_STATE.send?Y.default.MEDIA_STATE.sendReceive:Y.default.MEDIA_STATE.receive}function isOnHold(F){return!(F.audio!==Y.default.MEDIA_STATE.inactive||F.video&&F.video!==Y.default.MEDIA_STATE.inactive||F.sharing&&F.sharing!==Y.default.MEDIA_STATE.inactive)}function negotiateModalities(F,B){var G={},W=negotiateDirectionality(F.audio,B.audio);W&&(G.audio=W);var z=negotiateDirectionality(F.video,B.video);z&&(G.video=z);var K=negotiateDirectionality(F.sharing,B.sharing);K&&(G.sharing=K);var J=negotiateDirectionality(F.data,B.data);return J&&(G.data=J),G}function isNegotiatedDirectionAcceptable(F,B,G){var W=hasSendDirectionality(F)&&hasSendDirectionality(B)||!hasSendDirectionality(F)&&!hasSendDirectionality(G),z=!G||hasReceiveDirectionality(F)&&hasReceiveDirectionality(B)||!hasReceiveDirectionality(F)&&!hasReceiveDirectionality(G);return W&&z}function areNegotiatedDirectionsAcceptable(F,B,G){return isNegotiatedDirectionAcceptable(F.audio,B.audio,G.audio)&&isNegotiatedDirectionAcceptable(F.video,B.video,G.video)&&isNegotiatedDirectionAcceptable(F.sharing,B.sharing,G.sharing)&&isNegotiatedDirectionAcceptable(F.data,B.data,G.data)}function areNegotiatedDirectionsFulfilled(F,B){function isNegotiatedDirectionFulfilled(F,B){var G=hasSendDirectionality(F)===hasSendDirectionality(B),W=hasReceiveDirectionality(F)===hasReceiveDirectionality(B)||hasReceiveDirectionality(F)&&!B;return G&&W}return isNegotiatedDirectionFulfilled(F.audio,B.audio)&&isNegotiatedDirectionFulfilled(F.video,B.video)&&isNegotiatedDirectionFulfilled(F.sharing,B.sharing)&&isNegotiatedDirectionFulfilled(F.data,B.data)}function areSendDirectionsFulfilled(F,B){var isSendDirectionFulfilled=function(F,B){return hasSendDirectionality(F)===hasSendDirectionality(B)};return isSendDirectionFulfilled(F.audio,B.audio)&&isSendDirectionFulfilled(F.video,B.video)&&isSendDirectionFulfilled(F.sharing,B.sharing)&&isSendDirectionFulfilled(F.data,B.data)}function getSrtpInfo(F){var B={dtls:!1,sdes:!1};return B.dtls=!!F.fingerprint,F.media.forEach((function(F){B.dtls=B.dtls||!!F.fingerprint,B.sdes=B.sdes||!!F.crypto})),B}function shouldAddModality(F,B,G,W){if(!B[G])return!0;if(F){if(!(hasSendDirectionality(W)||F[G]&&F[G]===W))return!1}else if(B[G]===W)return!1;return!0}function excludePassiveModalities(F,B,G){if(!B||Q.isEmpty(B))return F;var W={};return Q.forOwn(F,(function(z,K){shouldAddModality(G,B,K,z)&&(W[K]=F[K])})),W}function removeChangedSendDirection(F,B){if(!B||Q.isEmpty(B))return F;var G={};return Q.forOwn(F,(function(F,W){W===Y.default.MODALITY.data?G[W]=removeChangedDataSendDirection(F,B[W]):G[W]=removeChangedMediaSendDirection(F,B[W])})),G}function removeChangedMediaSendDirection(F,B){return hasSendDirectionality(F)&&!hasSendDirectionality(B)?removeSendDirectionality(F)||B:F}function removeChangedDataSendDirection(F,B){return hasSendDirectionality(F)&&!hasSendDirectionality(B)?B:F}function parseCandidateString(F){var B=(F||"").split(" ");return{component:B[1],protocol:B[2],priority:B[3],ip:B[4],port:B[5],type:B[7]}}function isSendModalityAdded(F,B){return!hasSendDirectionality(F)&&hasSendDirectionality(B)}function getSendMediaModalities(F){var B;return(B={}).Audio=hasSendDirectionality(F.audio),B.Video=hasSendDirectionality(F.video),B.ScreenShare=hasSendDirectionality(F.sharing),B.Data=hasSendDirectionality(F.data),B}function mergeSendModalities(F,B){var G=Q.shallowClone(F);return Q.forOwn(F,(function(F,W){var z=modalityToMediaType(W);hasSendDirectionality(F)&&!B[z]&&(G[W]=removeSendDirectionality(F))})),G}function modalityToMediaType(F){switch(F){case"audio":return"Audio";case"video":return"Video";case"sharing":return"ScreenShare";default:return null}}function mediaTypeToModality(F){switch(F){case"Audio":return"audio";case"Video":return"video";case"ScreenShare":return"sharing";default:return null}}function sendStreamsToModalities(F){var B={};return Q.keys(F).forEach((function(G){return B[G]=!!F[G]})),B}function scrubObjectFields(F,B,G){var Q,Y;if(!F)return F;var $=W({},F);try{for(var X=z(Object.entries(F)),Z=X.next();!Z.done;Z=X.next()){var ee=K(Z.value,2),te=ee[0],ne=ee[1];"object"==typeof ne?$[te]=scrubObjectFields(ne,B):ne&&B.includes(te)&&($[te]=G?G(ne):J.scrubMriOrOmit(ne))}}catch(F){Q={error:F}}finally{try{Z&&!Z.done&&(Y=X.return)&&Y.call(X)}finally{if(Q)throw Q.error}}return $}function scrubObjectExcludingFields(F,B,G){var Q,Y;if(!F)return F;var $=W({},F);try{for(var X=z(Object.entries(F)),Z=X.next();!Z.done;Z=X.next()){var ee=K(Z.value,2),te=ee[0],ne=ee[1];"object"==typeof ne?$[te]=scrubObjectExcludingFields(ne,B):ne&&!B.includes(te)&&($[te]=G?G(ne):J.scrubMriOrOmit(ne))}}catch(F){Q={error:F}}finally{try{Z&&!Z.done&&(Y=X.return)&&Y.call(X)}finally{if(Q)throw Q.error}}return $}function scrubSelectedDevices(F){return F?scrubObjectExcludingFields(F,[]):F}function scrubDevices(F,B){if(!F)return F;var G=scrubObjectFields(F,["deviceId","groupId","guid"]);return scrubObjectFields(G,["label"],(function(F){return Q.scrubDeviceLabelPii(F,B)}))}function scrubConstraints(F){return scrubObjectFields(F,["sourceId","deviceId"])}function preferSdesSrtp(F){return!(!F.configProvider.config.webrtcForceSdesForS1||!F.configProvider.config.checkSupportForWebrtc_1_0||F.configProvider.mediaConfig.simulcastSessionEnabled)||(F.config.isPstnCall?F.configProvider.config.preferSdesSrtpPstn:F.configProvider.config.preferSdesSrtp)}function canUseWebrtc1_0(F){return!F||$.UserAgentConfig.hasUnifiedPlanSupport()}function allowDataChannel(F){return!!F.configProvider.mediaConfig.simulcastSessionEnabled&&(F.config.isPstnCall?F.configProvider.config.enableDataChannelPstn:F.configProvider.config.enableDataChannel)}function getAllowedCodecs(F,B){switch(B){case Y.default.MEDIA_TYPE.audio:return F.config.allowedAudioCodecs;case Y.default.MEDIA_TYPE.video:return F.config.allowedVideoCodecs;default:return[]}}function isVersionGreaterOrEqual(F,B){var G=B.split(".").map((function(F){return parseInt(F,10)})),W=F.split(".").map((function(F){return parseInt(F,10)}));return W[0]>G[0]||W[0]===G[0]&&W[1]>=G[1]}function getSimulcastConfigForMediaType(F,B){var G,W;return"Video"===F?null===(G=B.config.specCompliantSimulcast)||void 0===G?void 0:G.video:"ScreenShare"===F?null===(W=B.config.specCompliantSimulcast)||void 0===W?void 0:W.sharing:null}function convertToCodecInfo(F){return F.map((function(F){var B=F.mimeType.split("/"),G={codec:B[1]||B[0],rate:F.clockRate};return F.channels&&(G.encoding=F.channels),F.sdpFmtpLine&&(G.fmtpLine=F.sdpFmtpLine),G}))}function allowProvisionalAnswer(F){return F.config.isPstnCall?F.configProvider.config.allowProvisionalAnswerPstn:F.configProvider.config.allowProvisionalAnswer}function printMediaStream(F){return"".concat(null==F?void 0:F.id,":").concat(JSON.stringify(null==F?void 0:F.getTracks().map((function(F){return F.id}))),"}")}B.negotiateDirectionality=negotiateDirectionality,B.invertModalities=invertModalities,B.removeSendDirectionality=removeSendDirectionality,B.hasSendDirectionality=hasSendDirectionality,B.hasReceiveDirectionality=hasReceiveDirectionality,B.addReceiveDirectionality=addReceiveDirectionality,B.isOnHold=isOnHold,B.negotiateModalities=negotiateModalities,B.areNegotiatedDirectionsAcceptable=areNegotiatedDirectionsAcceptable,B.areNegotiatedDirectionsFulfilled=areNegotiatedDirectionsFulfilled,B.areSendDirectionsFulfilled=areSendDirectionsFulfilled,B.getSrtpInfo=getSrtpInfo,B.excludePassiveModalities=excludePassiveModalities,B.removeChangedSendDirection=removeChangedSendDirection,B.parseCandidateString=parseCandidateString,B.isSendModalityAdded=isSendModalityAdded,B.getSendMediaModalities=getSendMediaModalities,B.mergeSendModalities=mergeSendModalities,B.modalityToMediaType=modalityToMediaType,B.mediaTypeToModality=mediaTypeToModality,B.sendStreamsToModalities=sendStreamsToModalities,B.scrubObjectFields=scrubObjectFields,B.scrubObjectExcludingFields=scrubObjectExcludingFields,B.scrubSelectedDevices=scrubSelectedDevices,B.scrubDevices=scrubDevices,B.scrubConstraints=scrubConstraints,B.preferSdesSrtp=preferSdesSrtp,B.canUseWebrtc1_0=canUseWebrtc1_0,B.allowDataChannel=allowDataChannel,B.getAllowedCodecs=getAllowedCodecs,B.isVersionGreaterOrEqual=isVersionGreaterOrEqual,B.getSimulcastConfigForMediaType=getSimulcastConfigForMediaType,B.convertToCodecInfo=convertToCodecInfo,B.allowProvisionalAnswer=allowProvisionalAnswer,B.printMediaStream=printMediaStream},function(F,B,G){G.d(B,"e",(function(){return getGlobalInst})),G.d(B,"k",(function(){return getWindow})),G.d(B,"d",(function(){return getDocument})),G.d(B,"i",(function(){return getNavigator})),G.d(B,"g",(function(){return getLocation})),G.d(B,"b",(function(){return getConsole})),G.d(B,"j",(function(){return getPerformance})),G.d(B,"l",(function(){return hasJSON})),G.d(B,"f",(function(){return getJSON})),G.d(B,"c",(function(){return getCrypto})),G.d(B,"h",(function(){return getMsCrypto})),G.d(B,"p",(function(){return isReactNative})),G.d(B,"o",(function(){return isIE})),G.d(B,"a",(function(){return dumpObj})),G.d(B,"m",(function(){return isBeaconsSupported})),G.d(B,"n",(function(){return isFetchSupported})),G.d(B,"r",(function(){return useXDomainRequest})),G.d(B,"q",(function(){return isXhrSupported}));var W=G(2),z=G(29),K=G(0),J="window",Q="document",Y="navigator",$="location",X="console",Z="performance",ee="JSON",te="crypto",ne="msCrypto",ie="ReactNative",re="msie",oe="trident/",ae=null,se=null,ce=!1,le=null,de=null;function _hasProperty(F,B){var G=!1;if(F){try{if(!(G=B in F)){var z=F[W.k];z&&(G=B in z)}}catch(F){}if(!G)try{var J=new F;G=!Object(K.x)(J[B])}catch(F){}}return G}function getGlobalInst(F){var B=Object(z.a)();return B&&B[F]?B[F]:F===J&&hasWindow()?window:null}function hasWindow(){return Boolean(typeof window===W.j&&window)}function getWindow(){return hasWindow()?window:getGlobalInst(J)}function hasDocument(){return Boolean(typeof document===W.j&&document)}function getDocument(){return hasDocument()?document:getGlobalInst(Q)}function hasNavigator(){return Boolean(typeof navigator===W.j&&navigator)}function getNavigator(){return hasNavigator()?navigator:getGlobalInst(Y)}function getLocation(F){if(F&&ce){var B=getGlobalInst("__mockLocation");if(B)return B}return typeof location===W.j&&location?location:getGlobalInst($)}function getConsole(){return typeof console!==W.l?console:getGlobalInst(X)}function getPerformance(){return getGlobalInst(Z)}function hasJSON(){return Boolean(typeof JSON===W.j&&JSON||null!==getGlobalInst(ee))}function getJSON(){return hasJSON()?JSON||getGlobalInst(ee):null}function getCrypto(){return getGlobalInst(te)}function getMsCrypto(){return getGlobalInst(ne)}function isReactNative(){var F=getNavigator();return!(!F||!F.product)&&F.product===ie}function isIE(){var F=getNavigator();if(F&&(F.userAgent!==se||null===ae)){var B=((se=F.userAgent)||"").toLowerCase();ae=Object(K.E)(B,re)||Object(K.E)(B,oe)}return ae}function dumpObj(F){var B=Object[W.k].toString.call(F),G="";return"[object Error]"===B?G="{ stack: '"+F.stack+"', message: '"+F.message+"', name: '"+F.name+"'":hasJSON()&&(G=getJSON().stringify(F)),B+G}function isBeaconsSupported(){return null===de&&(de=hasNavigator()&&Boolean(getNavigator().sendBeacon)),de}function isFetchSupported(F){var B=!1;try{B=!!getGlobalInst("fetch");var G=getGlobalInst("Request");B&&F&&G&&(B=_hasProperty(G,"keepalive"))}catch(F){}return B}function useXDomainRequest(){return null===le&&(le="undefined"!=typeof XDomainRequest)&&isXhrSupported()&&(le=le&&!_hasProperty(getGlobalInst("XMLHttpRequest"),"withCredentials")),le}function isXhrSupported(){var F=!1;try{F=!!getGlobalInst("XMLHttpRequest")}catch(F){}return F}},,function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.validateCauseId=B.generateCauseId=void 0;var W=8;function generateCauseId(){for(var F="abcdef0123456789",B=F.length,G="",z=0;z<W;z++)G+=F.charAt(Math.floor(Math.random()*B));return G}function validateCauseId(F){return new RegExp("^[a-f0-9]{8}$").test(F)&&F.length===W}B.generateCauseId=generateCauseId,B.validateCauseId=validateCauseId},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPIISafeCallInitOptions=B.truncate=B.safeJsonStringify=B.getPrintableObject=B.getPIISafeObject=void 0;var W=G(17),z=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","phrase","subCode","reason"];function getPIISafeObject(F){try{return JSON.parse(JSON.stringify(F,z,4))}catch(F){return{error:"failed to parse object"}}}B.getPIISafeObject=getPIISafeObject;var processStackTrace=function(F){try{return F.split("\n")[0]}catch(F){return"invalid stack"}};function getPrintableObject(F,B){if(void 0===B&&(B=!1),void 0===F)return"void";if(F instanceof Error)return F.toString();if(F instanceof String||F instanceof Number||F instanceof Boolean)return F.toString();try{return F.stack&&(F.stack=processStackTrace(F.stack)),(B?JSON.stringify(F):JSON.stringify(F,z,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(B){return"failed to get error information:".concat(F&&"function"==typeof F.toString&&F.toString()," ").concat((null==F?void 0:F.response)&&JSON.stringify(F.response))}}function safeJsonStringify(F){try{return JSON.stringify(F,null,2)}catch(B){return"failed to stringify obj ".concat(F)}}function truncate(F,B){try{return F.substring(0,length)}catch(B){return F}}function hasValue(F){return F||!1===F||""===F||0===F}function getPIISafeCallInitOptions(F){var B={mediaPeerType:F.mediaPeerType,threadId:(0,W.getLoggableThreadId)(F.threadId)};return hasValue(F.messageId)&&(B.messageId=F.messageId),hasValue(F.enableGroupCallMeetupGeneration)&&(B.enableGroupCallMeetupGeneration=F.enableGroupCallMeetupGeneration),hasValue(F.endpointMetadata)&&(B.endpointMetadata=F.endpointMetadata),hasValue(F.onBehalfOf)&&(B.onBehalfOf=(0,W.scrubMriOrOmit)(F.onBehalfOf)),hasValue(F.emergencyContent)&&(B.emergencyContent=F.emergencyContent),hasValue(F.isEmergency)&&(B.isEmergency=F.isEmergency),hasValue(F.broadcastContext)&&(B.broadcastContext=F.broadcastContext),F.meetingInfo&&(B.meetingInfo={tenantId:F.meetingInfo.tenantId,organizerId:(0,W.scrubMriOrOmit)(F.meetingInfo.organizerId)},hasValue(F.meetingInfo.meetingType)&&(B.meetingInfo.meetingType=F.meetingInfo.meetingType),hasValue(F.meetingInfo.replyChainMessageId)&&(B.meetingInfo.replyChainMessageId=F.meetingInfo.replyChainMessageId)),F.transferContext&&(B.transferContext={transferorMri:(0,W.scrubMriOrOmit)(F.transferContext.transferorMri),targetMri:(0,W.scrubMriOrOmit)(F.transferContext.targetMri),context:F.transferContext.context},hasValue(F.transferContext.transferType)&&(B.transferContext.transferType=F.transferContext.transferType)),B}B.getPrintableObject=getPrintableObject,B.safeJsonStringify=safeJsonStringify,B.truncate=truncate,B.getPIISafeCallInitOptions=getPIISafeCallInitOptions},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},J=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var Q=function(F){function ObservableBase(B){return F.call(this,B)||this}return z(ObservableBase,F),ObservableBase.prototype.changed=function(F,B){return this.subscribe({changed:{skipEventConfig:B,handler:F},on:void 0})},ObservableBase.prototype.on=function(F,B){return this.subscribe({changed:void 0,on:{name:String(F),handler:this._toEventCallback(B)}})},ObservableBase.prototype.once=function(F,B,G){var W,z=this,onceSubscription=function(){for(var F=[],Q=0;Q<arguments.length;Q++)F[Q]=arguments[Q];W.dispose(G),z._toEventCallback(B).apply(void 0,J([],K(F),!1))};return W=this.on(F,this._fromEventCallback(onceSubscription))},ObservableBase.prototype.raiseChanged=function(F){var B=this;this.raiseEvents((function(G){if(G.changed){var W=G.changed,z=W.skipEventConfig,K=W.handler;!B.getShouldSkipChangedEvent(F,z)&&K()}}))},ObservableBase.prototype.event=function(F){var B=this;return{raise:this._fromEventCallback((function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];return B._raiseEventImpl.apply(B,J([String(F)],K(G),!1))}))}},ObservableBase.prototype._raiseEventImpl=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];this.raiseEvents((function(G){var W;return G.on&&G.on.name===F&&(W=G.on).handler.apply(W,J([],K(B),!1))}))},ObservableBase.prototype._toEventCallback=function(F){return F},ObservableBase.prototype._fromEventCallback=function(F){return F},ObservableBase.prototype.getShouldSkipChangedEvent=function(F,B){return(null==F?void 0:F.skipDominantSpeakerUpdatesOnCall)?!!(null==B?void 0:B.skipDominantSpeakerUpdatesOnCall):!!(null==F?void 0:F.skipParticipantsUpdatesOnCall)&&!!(null==B?void 0:B.skipParticipantsUpdatesOnCall)},ObservableBase}(G(177).EventSourceImpl);B.default=Q},,function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getLoggableThreadId=B.mriOrId=B.scrubMriOrOmitList=B.scrubMriOrOmit=void 0;var W=G(31);function scrubMriOrOmit(F){return"string"==typeof F?W.pii.Mri(F):W.pii.Omit(F)}function scrubMriOrOmitList(F){return F.forEach(scrubMriOrOmit)}function mriOrId(F){return F&&W.pii.Mri(F)}function getLoggableThreadId(F){var B=_scrubThreadId(F);return B&&B.substr(0,8)}function _scrubThreadId(F){var B="99:";return F&&F.substr(0,3)===B?W.pii.Omit(F):F}B.scrubMriOrOmit=scrubMriOrOmit,B.scrubMriOrOmitList=scrubMriOrOmitList,B.mriOrId=mriOrId,B.getLoggableThreadId=getLoggableThreadId},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W,z=G(23);"undefined"!=typeof window&&"undefined"!=typeof navigator&&(W=window,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.MediaStream=window.MediaStream||window.webkitMediaStream||window.mozMediaStream||window.msMediaStream,window.attachMediaStream=function(F,B){"srcObject"in F?F.srcObject=B:void 0!==F.src&&(F.src=window.URL.createObjectURL(B))},window.AudioContext=window.AudioContext||window.webkitAudioContext,window.detachMediaStream=function(F){if("srcObject"in F)F.srcObject=null;else if(void 0!==F.src&&F.src){var B=F.src;F.src="",window.URL.revokeObjectURL(B)}},void 0!==navigator.webkitGetUserMedia&&"undefined"!=typeof webkitRTCPeerConnection&&"Electron"===(0,z.getBrowserInfo)().name?(window.RTCPeerConnection=webkitRTCPeerConnection,navigator.getUserMedia=function(F,B,G){var polyfillDeviceId=function(F){var B;(null===(B=null==F?void 0:F.deviceId)||void 0===B?void 0:B.exact)&&(F.mandatory||(F.mandatory={}),F.mandatory.sourceId=F.deviceId.exact,delete F.deviceId)};return F&&(polyfillDeviceId(F.audio),polyfillDeviceId(F.video)),navigator.webkitGetUserMedia(F,B,G)}):navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(F,B,G){return navigator.mediaDevices.getUserMedia(F).then(B).catch(G)})),B.default={window:W}},function(F,B,G){G.d(B,"e",(function(){return K})),G.d(B,"a",(function(){return J})),G.d(B,"c",(function(){return Q})),G.d(B,"b",(function(){return Y})),G.d(B,"d",(function(){return $})),G.d(B,"f",(function(){return X}));var W=G(173),z=G(20),K={NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,CustomerContent_GenericContent:32},J={Normal:1,CostDeferred:2,RealTime:3,Immediate:4},Q={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},Y={Normal:1,Critical:2},$={NONE:0,ERROR:1,WARNING:2,INFORMATION:3},X=Object(W.a)(Object(W.a)({},z.b),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520})},function(F,B,G){var W;G.d(B,"a",(function(){return W})),G.d(B,"b",(function(){return z})),function(F){F[F.CRITICAL=1]="CRITICAL",F[F.WARNING=2]="WARNING"}(W||(W={}));var z={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103,FailedAddingCustomDefinedRequestContext:104,InMemoryStorageBufferFull:105}},function(F,B,G){G.d(B,"d",(function(){return randomValue})),G.d(B,"c",(function(){return random32})),G.d(B,"b",(function(){return mwcRandomSeed})),G.d(B,"a",(function(){return mwcRandom32}));var W=G(11),z=G(0),K=4294967296,J=4294967295,Q=!1,Y=123456789,$=987654321;function _mwcSeed(F){F<0&&(F>>>=0),Y=123456789+F&J,$=987654321-F&J,Q=!0}function _autoSeedMwc(){try{var F=2147483647&Object(z.f)();_mwcSeed((Math.random()*K^F)+F)}catch(F){}}function randomValue(F){return F>0?Math.floor(random32()/J*(F+1))>>>0:0}function random32(F){var B,G=Object(W.c)()||Object(W.h)();return G&&G.getRandomValues?B=G.getRandomValues(new Uint32Array(1))[0]&J:Object(W.o)()?(Q||_autoSeedMwc(),B=mwcRandom32()&J):B=Math.floor(K*Math.random()|0),F||(B>>>=0),B}function mwcRandomSeed(F){F?_mwcSeed(F):_autoSeedMwc()}function mwcRandom32(F){var B=(($=36969*(65535&$)+($>>16)&J)<<16)+(65535&(Y=18e3*(65535&Y)+(Y>>16)&J))>>>0&J|0;return F||(B>>>=0),B}},function(F,B,G){var W=G(97),z=Object.prototype.toString;function isArray(F){return"[object Array]"===z.call(F)}function isUndefined(F){return void 0===F}function isBuffer(F){return null!==F&&!isUndefined(F)&&null!==F.constructor&&!isUndefined(F.constructor)&&"function"==typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}function isArrayBuffer(F){return"[object ArrayBuffer]"===z.call(F)}function isFormData(F){return"undefined"!=typeof FormData&&F instanceof FormData}function isArrayBufferView(F){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(F):F&&F.buffer&&F.buffer instanceof ArrayBuffer}function isString(F){return"string"==typeof F}function isNumber(F){return"number"==typeof F}function isObject(F){return null!==F&&"object"==typeof F}function isDate(F){return"[object Date]"===z.call(F)}function isFile(F){return"[object File]"===z.call(F)}function isBlob(F){return"[object Blob]"===z.call(F)}function isFunction(F){return"[object Function]"===z.call(F)}function isStream(F){return isObject(F)&&isFunction(F.pipe)}function isURLSearchParams(F){return"undefined"!=typeof URLSearchParams&&F instanceof URLSearchParams}function trim(F){return F.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(F,B){if(null!=F)if("object"!=typeof F&&(F=[F]),isArray(F))for(var G=0,W=F.length;G<W;G++)B.call(null,F[G],G,F);else for(var z in F)Object.prototype.hasOwnProperty.call(F,z)&&B.call(null,F[z],z,F)}function merge(){var F={};function assignValue(B,G){"object"==typeof F[G]&&"object"==typeof B?F[G]=merge(F[G],B):F[G]=B}for(var B=0,G=arguments.length;B<G;B++)forEach(arguments[B],assignValue);return F}function deepMerge(){var F={};function assignValue(B,G){"object"==typeof F[G]&&"object"==typeof B?F[G]=deepMerge(F[G],B):F[G]="object"==typeof B?deepMerge({},B):B}for(var B=0,G=arguments.length;B<G;B++)forEach(arguments[B],assignValue);return F}function extend(F,B,G){return forEach(B,(function assignValue(B,z){F[z]=G&&"function"==typeof B?W(B,G):B})),F}F.exports={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,deepMerge:deepMerge,extend:extend,trim:trim}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getBrowserInfo=void 0;var W="0.0";function getBrowserVersion(F,B){var G=[];return B.some((function(B){return!!(G=F.match(B))})),!G||G.length<2?W:G[1]&&G[1].replace(/_/g,".")||W}function getFormFactor(F){var B="136";return getOsSkuInfo()===B?"Hololens":/iPhone|iPad|iPod|Android|Mobi/i.test(F)?"Mobile":"Desktop"}function getOsSkuInfo(){var F="os-sku",B=window.external;return(null==B?void 0:B.getHostEnvironmentValue)?JSON.parse(B.getHostEnvironmentValue(F))[F]:"-1"}function getBrowserInfo(){var F="((\\d+\\.?){2,4})",B={name:"Unknown",engine:"Unknown",version:W,formFactor:"Unknown"},G=[{name:"Edge",engine:"Edge",key:"Edge",masks:[new RegExp("".concat("Edge","/").concat(F))]},{name:"EdgeAnaheim",engine:"Chromium",key:"EdgA",masks:[new RegExp("".concat("Chrome","/").concat(F))]},{name:"EdgeAnaheim",engine:"Chromium",key:"Edg",masks:[new RegExp("".concat("Edg","/").concat(F))]},{name:"Chromium",engine:"Chromium",key:"Chromium",masks:[new RegExp("".concat("Chromium","/").concat(F))]},{name:"Opera",engine:"Chromium",key:"OPR",masks:[new RegExp("".concat("Chrome","/").concat(F))]},{name:"YandexBrowser",engine:"Chromium",key:"YaBrowser",masks:[new RegExp("".concat("Chrome","/").concat(F))]},{name:"Electron",engine:"Chromium",key:"Electron",masks:[new RegExp("".concat("Electron","/").concat(F))]},{name:"CiscoOS",engine:"Chromium",key:"Cisco",masks:[new RegExp("".concat("Chrome","/").concat(F))]},{name:"ZoomRoom",engine:"Chromium",key:"ZoomRoom",masks:[new RegExp("".concat("Chrome","/").concat(F))]},{name:"SamsungTV",engine:"Chromium",key:"TeamsSamsungTVBrowser",masks:[new RegExp("".concat("Chrome","/").concat(F))]},{name:"Chrome",engine:"Chromium",key:"Chrome",masks:[new RegExp("".concat("Chrome","/").concat(F))]},{name:"Firefox",engine:"Firefox",key:"Firefox",masks:[new RegExp("".concat("Firefox","/").concat(F))]},{name:"Safari",engine:"Safari",key:"Safari",masks:[new RegExp("Version/".concat(F,".*?").concat("Safari","/"))]},{name:"AppleWebView",engine:"Safari",key:"Mac OS X",masks:[new RegExp("(\\d+_\\d+(_\\d+)?).*".concat("Mac OS X")),new RegExp("(\\d+_\\d+(_\\d+)?).*")]},{name:"MSIE",engine:"MSIE",key:"Trident",masks:[new RegExp("MSIE ".concat(F)),new RegExp("rv:".concat(F))]}],z=navigator.userAgent,K=B;return G.some((function(F){return-1!==z.indexOf(F.key)&&(K={name:F.name,engine:F.engine,version:getBrowserVersion(z,F.masks),formFactor:getFormFactor(z)},!0)})),K}B.getBrowserInfo=getBrowserInfo},function(F,B,G){G.d(B,"a",(function(){return _gblCookieMgr})),G.d(B,"d",(function(){return safeGetCookieMgr})),G.d(B,"c",(function(){return createCookieMgr})),G.d(B,"b",(function(){return areCookiesSupported})),G.d(B,"e",(function(){return uaDisallowsSameSiteNone}));var W=G(20),z=G(11),K=G(0),J="toGMTString",Q="toUTCString",Y="cookie",$="expires",X="enabled",Z="isCookieUseDisabled",ee="disableCookiesUsage",te="_ckMgr",ne="",ie=null,re=null,oe=null,ae=Object(z.d)(),se={},ce={};function _gblCookieMgr(F,B){var G=createCookieMgr[te]||ce[te];return G||(G=createCookieMgr[te]=createCookieMgr(F,B),ce[te]=G),G}function _isMgrEnabled(F){return!F||F.isEnabled()}function _createCookieMgrConfig(F){var B=F.cookieCfg=F.cookieCfg||{};if(Object(K.D)(B,"domain",F.cookieDomain,K.p,K.r),Object(K.D)(B,"path",F.cookiePath||"/",null,K.r),Object(K.r)(B[X])){var G=void 0;Object(K.x)(F[Z])||(G=!F[Z]),Object(K.x)(F[ee])||(G=!F[ee]),B[X]=G}return B}function safeGetCookieMgr(F,B){var G;if(F)G=F.getCookieMgr();else if(B){var W=B.cookieCfg;G=W[te]?W[te]:createCookieMgr(B)}return G||(G=_gblCookieMgr(B,(F||{}).logger)),G}function createCookieMgr(F,B){var G=_createCookieMgrConfig(F||ce),W=G.path||"/",Y=G.domain,Z=!1!==G[X],ee={isEnabled:function(){var F=Z&&areCookiesSupported(B),G=ce[te];return F&&G&&ee!==G&&(F=_isMgrEnabled(G)),F},setEnabled:function(F){Z=!1!==F},set:function(F,B,X,Z,te){var ie=!1;if(_isMgrEnabled(ee)){var oe={},ae=Object(K.H)(B||ne),se=ae.indexOf(";");if(-1!==se&&(ae=Object(K.H)(B.substring(0,se)),oe=_extractParts(B.substring(se+1))),Object(K.D)(oe,"domain",Z||Y,K.v,K.x),!Object(K.r)(X)){var ce=Object(z.o)();if(Object(K.x)(oe[$])){var le=Object(K.f)()+1e3*X;if(le>0){var de=new Date;de.setTime(le),Object(K.D)(oe,$,_formatDate(de,ce?J:Q)||_formatDate(de,ce?J:Q)||ne,K.v)}}ce||Object(K.D)(oe,"max-age",ne+X,null,K.x)}var ue=Object(z.g)();ue&&"https:"===ue.protocol&&(Object(K.D)(oe,"secure",null,null,K.x),null===re&&(re=!uaDisallowsSameSiteNone((Object(z.i)()||{}).userAgent)),re&&Object(K.D)(oe,"SameSite","None",null,K.x)),Object(K.D)(oe,"path",te||W,null,K.x),(G.setCookie||_setCookieValue)(F,_formatCookieValue(ae,oe)),ie=!0}return ie},get:function(F){var B=ne;return _isMgrEnabled(ee)&&(B=(G.getCookie||_getCookieValue)(F)),B},del:function(F,B){var G=!1;return _isMgrEnabled(ee)&&(G=ee.purge(F,B)),G},purge:function(F,W){var K,J=!1;if(areCookiesSupported(B)){var Q=((K={}).path=W||"/",K[$]="Thu, 01 Jan 1970 00:00:01 GMT",K);Object(z.o)()||(Q["max-age"]="0"),(G.delCookie||_setCookieValue)(F,_formatCookieValue(ne,Q)),J=!0}return J}};return ee[te]=ee,ee}function areCookiesSupported(F){if(null===ie){ie=!1;try{ie=void 0!==(ae||{})[Y]}catch(B){F&&F.throwInternal(W.a.WARNING,W.b.CannotAccessCookie,"Cannot access document.cookie - "+Object(K.h)(B),{exception:Object(z.a)(B)})}}return ie}function _extractParts(F){var B={};if(F&&F.length){var G=Object(K.H)(F).split(";");Object(K.a)(G,(function(F){if(F=Object(K.H)(F||ne)){var G=F.indexOf("=");-1===G?B[F]=null:B[Object(K.H)(F.substring(0,G))]=Object(K.H)(F.substring(G+1))}}))}return B}function _formatDate(F,B){return Object(K.o)(F[B])?F[B]():null}function _formatCookieValue(F,B){var G=F||ne;return Object(K.z)(B,(function(F,B){G+="; "+F+(Object(K.r)(B)?ne:"="+B)})),G}function _getCookieValue(F){var B=ne;if(ae){var G=ae[Y]||ne;oe!==G&&(se=_extractParts(G),oe=G),B=Object(K.H)(se[F]||ne)}return B}function _setCookieValue(F,B){ae&&(ae[Y]=F+"="+B)}function uaDisallowsSameSiteNone(F){return!!Object(K.u)(F)&&(!(!Object(K.E)(F,"CPU iPhone OS 12")&&!Object(K.E)(F,"iPad; CPU OS 12"))||(!!(Object(K.E)(F,"Macintosh; Intel Mac OS X 10_14")&&Object(K.E)(F,"Version/")&&Object(K.E)(F,"Safari"))||(!(!Object(K.E)(F,"Macintosh; Intel Mac OS X 10_14")||!Object(K.F)(F,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))||(!(!Object(K.E)(F,"Chrome/5")&&!Object(K.E)(F,"Chrome/6"))||(!(!Object(K.E)(F,"UnrealEngine")||Object(K.E)(F,"Chrome"))||!(!Object(K.E)(F,"UCBrowser/12")&&!Object(K.E)(F,"UCBrowser/11")))))))}},function(F,B,G){var W;Object.defineProperty(B,"__esModule",{value:!0}),B.NETWORK_REQUESTS=B.CONTROLLER=B.EVENTS=void 0,B.EVENTS={HANDLE_MEDIA_ACKNOWLEDGEMENT:"HandleMediaAcknowledgement",HANDLE_MEDIA_NEGOTIATION_FAILURE:"HandleMediaNegotiationFailure",HANDLE_MEDIA_ANSWER:"HandleMediaAnswer",HANDLE_MEDIA_ANSWER_FAILED:"HandleMediaAnswerFailed",HANDLE_MEDIA_OFFER:"HandleMediaOffer",REJECT_RENEGOTIATION:"RejectRenegotiation",HANDLE_RETARGET_COMPLETED:"HandleRetargetCompleted",HANDLE_MEDIA_ANSWER_TIMEOUT:"HandleMediaAnswerTimeout",HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT:"HandleMediaAcknowledgementTimeout",ACCEPT_RENEGOTIATION:"AcceptRenegotiation",START_RENEGOTIATION:"StartRenegotiation",MEDIA_FSM_STATE_CHANGED:"MediaFsmStateChanged",ADD_MODALITY_TIMEOUT:"AddModalityTimeout",ADD_PARTICIPANT:"AddParticipant",ADD_PARTICIPANT_TIMEOUT:"AddParticipantTimeout",ADD_PARTICIPANT_WITH_REPLACES:"AddParticipantWithReplaces",ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT:"AddParticipantWithReplacesTimeout",ADD_PARTICIPANTS_AND_MODALITY:"AddParticipantsAndModality",ADMIT_PARTICIPANT:"AdmitParticipant",ADMIT_PARTICIPANT_TIMEOUT:"AdmitParticipantTimeout",ADMIT:"Admit",ADMIT_TIMEOUT:"AdmitTimeout",ADMIT_FAILURE:"AdmitFailure",ADMIT_SUCCESS:"AdmitSuccess",CALL_ME_BACK:"CallMeBack",CALL_ME_BACK_TIMEOUT:"CallMeBackTimeout",REMOVE_PARTICIPANT:"RemoveParticipant",REMOVE_PARTICIPANT_OTHERS:"RemoveParticipantOthers",REMOVE_PARTICIPANT_SPECIFIED:"RemoveParticipantSpecified",REMOVE_PARTICIPANT_TIMEOUT:"RemoveParticipantTimeout",HANDLE_ADD_PARTICIPANT_SUCCESS:"HandleAddParticipantSuccess",HANDLE_ADD_PARTICIPANT_FAILURE:"HandleAddParticipantFailure",HANDLE_ADMIT_PARTICIPANT_SUCCESS:"HandleAdmitParticipantSuccess",HANDLE_ADMIT_PARTICIPANT_FAILURE:"HandleAdmitParticipantFailure",HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE:"HandleAddParticipantModalityFailure",HANDLE_REMOVE_PARTICIPANT_SUCCESS:"HandleRemoveParticipantSuccess",HANDLE_REMOVE_PARTICIPANT_FAILURE:"HandleRemoveParticipantFailure",HANDLE_ROSTER_UPDATE:"HandleRosterUpdate",HANDLE_ROSTER_UPDATE_FAIL:"HandleRosterUpdateFail",HANDLE_CONVERSATION_UPDATE:"HandleConversationUpdate",HANDLE_LOCAL_PARTICIPANT_UPDATE:"HandleLocalParticipantUpdate",SET_SUBJECT:"SetSubject",SET_JOINED_FROM:"SetJoinedFrom",SET_DEVICETYPE:"SetDeviceType",GET_EMERGENCY_CONTENT:"GetEmergencyContent",SET_MULTIPARTY:"SetMultiparty",SET_GROUPID:"SetGroupId",SET_THREADID:"SetThreadId",SET_CALLOPTIONS:"SetCallOptions",SET_TRANSFER_CONTEXT:"SetTransferContext",START_CALL:"StartCall",JOIN_CALL:"JoinCall",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:"JoinConversationWithoutCallModality",HANDLE_INCOMING_CALL:"HandleIncomingCall",END_CALL:"EndCall",END_WITH_BEACON:"EndWithBeacon",CONFLICTED_CALL:"ConflictedCall",SET_PROVISIONAL_ANSWER:"SetProvisionalAnswer",SET_PROVISIONAL_ANSWER_FAILED:"SetProvisionalAnswerFailed",ACCEPT_CALL:"AcceptCall",ACCEPT_CALL_FAILED:"AcceptCallFailed",HANDLE_CALL_ACCEPTANCE_ACK:"HandleCallAcceptanceAck",HANDLE_CALL_ACCEPTANCE:"HandleCallAcceptance",HANDLE_CALL_ACCEPTANCE_SYNC:"HandleCallAcceptanceSync",HANDLE_CALL_ACCEPTANCE_FAILED:"HandleCallAcceptanceFailed",HANDLE_CALL_ESTABLISHMENT_TIMEOUT:"HandleCallEstablishmentTimeout",HANDLE_CALL_END:"HandleCallEnd",HANDLE_CALL_PROGRESS:"HandleCallProgress",HANDLE_LWJ_ACCEPTANCE:"HandleLwjAcceptance",HANDLE_LWJ_END:"HandleLwjEnd",TROUTER_URL_CHANGED:"TrouterUrlChanged",TROUTER_STATE_CHANGED:"TrouterStateChanged",TROUTER_URL_CHANGED_TO_INVALID:"TrouterUrlChangedToInvalid",TROUTER_URL_UPDATE_FAILED:"TrouterUrlUpdateFailed",ADD_CONTENT_SHARING_MODALITY:"AddContentSharingModality",ACCEPTED_BEFORE_RINGING:"AcceptedBeforeRinging",LEAVE_CONTENT_SHARING:"LeaveContentSharing",DELETE_CONTENT_SHARING:"DeleteContentSharing",TAKE_CONTROL_CONTENT_SHARING:"TakeControlContentSharing",UPDATE_SESSION_STATE_CONTENT_SHARING:"UpdateSessionStateContentSharing",JOIN_CONTENT_SHARING:"JoinContentSharing",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:"UpdateParticipantStateContentSharing",HANDLE_CONTENT_SHARING_UPDATE:"HandleContentSharingUpdate",HANDLE_CONTENT_SHARING_END:"HandleContentSharingEnd",CONTENT_SHARING_START_FROM_ROSTER:"ContentSharingStartFromRoster",CONTENT_SHARING_END_FROM_ROSTER:"ContentSharingEndFromRoster",HANDLE_ADD_MODALITY_SUCCESS:"HandleAddModalitySuccess",HANDLE_ADD_MODALITY_FAILURE:"HandleAddModalityFailure",ADD_BROADCAST_MODALITY:"AddBroadcastModality",UPDATE_BROADCAST_DETAILS:"UpdateBroadcastDetails",WAITING_FOR_ADD_BROADCAST_MODALITY_COMPLETION:"WaitingForAddBroadcastModalityCompletion",MUTE:"Mute",NUDGE_PARTICIPANT_TIMEOUT:"NudgeParticipantTimeout",UNMUTE:"Unmute",UNMUTE_TIMEOUT:"UnmuteTimeout",HANDLE_UNMUTE_CONFIRM:"HandleUnmuteConfirm",HANDLE_UNMUTE_SUCCESS:"HandleUnmuteSuccess",HANDLE_UNMUTE_FAILURE:"HandleUnmuteFailure",APPROVE_UNMUTE:"ApproveUnmute",REJECT_UNMUTE:"RejectUnmute",HANDLE_CONTROL_VIDEO_STREAMING:"HandleControlVideoStreaming",HANDLE_DOMINANT_SPEAKER_CHANGED_COUNT:"HandleDominantSpeakerChangedCount",HANDLE_CSRC_INFO:"HandleCsrcInfo",SEND_WEBRTC_MEDIA_NOTIFICATION:"SendWebRtcMediaNotification",HANDLE_BALANCE_UPDATE:"HandleBalanceUpdate",TRANSFER_CALL:"TransferCall",PARK_CALL:"ParkCall",CALL_REDIRECT:"CallRedirect",CALL_REDIRECT_REQUEST_FAILED:"CallRedirectRequestFailed",TRANSFER_COMPLETION_FAILED:"TransferCompletionFailed",TRANSFER_REQUEST_RECEIVED:"TransferRequestReceived",HANDLE_PARK_REQUESTED:"HandleParkRequested",HANDLE_SERVER_HOLD:"HandleServerHold",DUPLICATE_MESSAGE_IGNORED:"DuplicateMessageIgnored",CORRELATION_ID_UPDATED:"CorrelationIdUpdated",UNKNOWN_MESSAGE_TYPE:"UnkownMessageType",FAILED_TO_HANDLE_MESSAGE:"FailedToHandleMessage",CONNECTIVITY_CHANGED:"ConnectivityChanged",TROUTER_DECODE_PAYLOAD_FAILURE:"TrouterDecodePayloadFailure",UPDATE_ENDPOINT_STATE:"UpdateEndpointState",UPDATE_ENDPOINT_STATE_SUCCESS:"UpdateEndpointStateSuccess",UPDATE_ENDPOINT_STATE_FAILURE:"UpdateEndpointStateFailure",BROKER_DECODE_PAYLOAD_FAILURE:"BrokerDecodePayloadFailure",BROKER_SUBSCRIPTION_TIMEOUT:"BrokerSubscriptionTimeout",BROKER_SUBSCRIPTION_SUCCESSFUL:"BrokerSubscriptionSuccessful",BROKER_SUBSCRIPTION_FAILED:"BrokerSubscriptionFailed",FAILED_TO_HANDLE_TROUTER_MESSAGE:"FailedToHandleTrouterMessage",FAILED_TO_HANDLE_BROKER_MESSAGE:"FailedToHandleBrokerMessage",BROKER_DISABLED_SUBSCRIBE_URL_PRESENT:"BrokerDisabledSubscribeUrlPresent",CONNECTED:"Connected",IN_LOBBY:"InLobby",STAGING:"Staging",MESSAGE_MISSING_BODY:"MessageMissingBody",BROADCAST_STATE_CHANGED:"BroadcastStateChanged",HANDLE_CALL_NOTIFICATION:"HandleCallNotification",HANDLE_INCOMING_CALL_REPLACEMENT:"HandleIncomingCallReplacement",HANDLE_PSTN_BALANCE_UPDATE:"HandlePstnBalanceUpdate",IGNORE_OLD_ROSTER:"IgnoreOldRoster",HANDLE_MEDIA_ACK:"HandleMediaAck",HANDLE_MEDIA_PROVISIONAL_ACK:"HandleMediaProvisionalAck",UPDATE_CALL_STATUS:"UpdateCallStatus",SEND_ATTACH:"SendAttach",REQUEST_NEW_OFFER:"RequestNewOffer",HANDLE_NEW_OFFER:"HandleNewOffer",UPDATE_CONVERSATION_LINKS:"UpdateConversationLinks",UPDATE_CONVERSATION_LINKS_SUCCESS:"UpdateConversationLinksSuccess",UPDATE_CONVERSATION_LINKS_FAILED:"UpdateConversationLinksFailed",UPDATE_LWJ_LINKS:"UpdateLwjLinks",UPDATE_LWJ_LINKS_SUCCESS:"UpdateLwjLinksSuccess",UPDATE_LWJ_LINKS_FAILED:"UpdateLwjLinksFailed",PROCESS_INITIAL_OFFER:"ProcessInitialOffer",SEND_PROGRESS:"SendProgress",SEND_PROGRESS_FAILED:"SendProgressFailed",PROCESS_CALL_ACCEPTANCE:"ProcessCallAcceptance",PROCESS_LWJ_ACCEPTANCE:"ProcessLwjAcceptance",ACCEPTANCE_USER_IN_LOBBY:"AcceptanceUserInLobby",REJECT_INCOMING_CALL:"RejectIncomingCall",SEND_KEEP_ALIVE:"SendKeepAlive",SEND_KEEP_ALIVE_LWJ:"SendKeepAliveLwj",SEND_KEEP_ALIVE_FAILED:"SendKeepAliveFailed",SEND_CONVERSATION_KEEP_ALIVE_FAILED:"SendConversationKeepAliveFailed",SEND_KEEP_ALIVE_LWJ_FAILED:"SendKeepAliveLwjFailed",START_AUDIO:"StartAudio",STOP_AUDIO:"StopAudio",UPDATE_MEETING_ROLE:"UpdateMeetingRole",UPDATE_MEETING_ROLE_TIMEOUT:"UpdateMeetingRoleTimeout",PREHEAT_ENABLING:"EnablingPreheat",PREHEAT_DISABLING:"DisablingPreheat",PREHEAT_DISABLED:"PreheatDisabled",TRANSFER_REQUEST_SENT:"TransferRequestSent",CALL_REDIRECT_REQUEST_SENT:"CallRedirectRequestSent",TRANSFER_REQUEST_FAILED:"TransferRequestFailed",SEND_ACCEPT_TRANSFER:"SendAcceptTransfer",SEND_ACCEPT_TRANSFER_FAIL:"SendAcceptTransferFail",WAITING_FOR_TRANSFER_COMPLETION:"WaitingForTransferCompletion",WAITING_FOR_TRANSFER_COMPLETION_FAIL:"WaitingForTransferCompletionFail",WAITING_FOR_TRANSFER_ACCEPTANCE_FAIL:"WaitingForTransferAcceptanceFail",WAITING_FOR_TRANSFER_ACCEPTANCE:"WaitingForTransferAcceptance",TRANSFER_COMPLETED:"TransferCompleted",SEND_COMPLETE_TRANSFER:"SendCompleteTransfer",SEND_COMPLETE_TRANSFER_FAILED:"SendCompleteTransferFailed",PICKUP_CODE_SET:"PickupCodeSet",ADD_PARTICIPANT_WITH_PICKUP_CODE:"AddParticipantWithPickupCode",ADD_PARTICIPANT_WITH_PICKUP_CODE_TIMEOUT:"AddParticipantWithPickupCodeTimeout",PUBLISH_STATE:"PublishState",PUBLISH_STATE_FAILURE:"PublishStateFailure",REMOVE_STATE:"RemoveState",REMOVE_STATE_FAILURE:"RemoveStateFailure",UPDATE_MEETING_SETTINGS:"UpdateMeetingSettings",UPDATE_MEETING_SETTINGS_FAILURE:"UpdateMeetingSettingsFailure",UPDATE_ENDPOINT_METADATA_SUCCESS:"UpdateEndpointMetadataSuccess",UPDATE_ENDPOINT_METADATA_FAILURE:"UpdateEndpointMetadataFailure",SEARCH_PARTICIPANTS:"SearchParticipants",GET_ALL_PARTICIPANTS:"GetAllParticipants",SEARCH_PARTICIPANTS_FAILURE:"SearchParticipantsFailure",GET_ALL_PARTICIPANTS_FAILURE:"GetAllParticipantsFailure",PARK_REQUEST:"SendParkRequest",PARK_REQUEST_FAILED:"ParkRequestFailed",WAITING_FOR_PARK_COMPLETION:"WaitingForParkCompletion",WAITING_FOR_PARK_COMPLETION_TIMEOUT:"WaitingForParkCompletionTimeout",PARK_COMPLETED:"ParkCompleted",PARK_FAILED:"ParkFailed",SEND_UNPARK_REQUEST:"SendUnparkRequest",UNPARK_REQUEST_FAILED:"UnparkRequestFailed",WAITING_FOR_UNPARK_COMPLETION:"WaitingForUnparkCompletion",WAITING_FOR_UNPARK_COMPLETION_TIMEOUT:"WaitingForUnparkCompletionTimeout",UNPARK_COMPLETED:"UnparkCompleted",UNPARK_FAILED:"UnparkFailed",UPDATE_MEETING_LIVE_STATE:"UpdateMeetingLiveState",WAITING_FOR_UPDATE_MEETING_LIVE_STATE_COMPLETION:"WaitingForUpdateMeetingLiveStateCompletion",UPDATE_MEETING_LIVE_STATE_REQUEST_FAILED:"UpdateMeetingLiveStateRequestFailed",UPDATE_MEETING_LIVE_STATE_RESPONSE_FAILURE:"UpdateMeetingLiveStateResponseFailure",UPDATE_MEETING_LIVE_STATE_RESPONSE_SUCCESS:"UpdateMeetingLiveStateResponseSuccess",UPDATE_MEETING_GROUPS:"UpdateMeetingGroups",UPDATE_PARTICIPANT_INTERPRETATION_STATE:"UpdateParticipantInterpretationState",JOIN_MEETING_GROUP:"JoinMeetingGroup",LEAVE_MEETING_GROUP:"LeaveMeetingGroup",INCOMING_PROXIED_MESSAGES:"incomingProxiedMessages",WAITING_FOR_UPDATE_MEETING_GROUPS_COMPLETION:"WaitingForUpdateMeetingGroupsCompletion",UPDATE_MEETING_GROUPS_REQUEST_FAILED:"UpdateMeetingGroupsRequestFailed",UPDATE_MEETING_GROUPS_REQUEST_COMPLETED:"UpdateMeetingGroupsRequestCompleted",UPDATE_MEETING_GROUPS_RESPONSE_FAILURE:"UpdateMeetingGroupsRequestFailure",UPDATE_MEETING_GROUPS_RESPONSE_SUCCESS:"UpdateMeetingGroupsResponseSuccess",SET_MEETING_LAYOUT:"SetMeetingLayout",WAITING_FOR_SET_MEETING_LAYOUT_COMPLETION:"WaitingForSetMeetingLayoutCompletion",SET_MEETING_LAYOUT_REQUEST_FAILED:"SetMeetingLayoutRequestFailed",SET_MEETING_LAYOUT_RESPONSE_FAILURE:"SetMeetingLayoutResponseFailure",SET_MEETING_LAYOUT_RESPONSE_SUCCESS:"SetMeetingLayoutResponseSuccess",WAITING_FOR_UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION:"WaitingForUpdateParticipantInterpretationStateCompletion",UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:"UpdateParticipantInterpretationStateTimeout",UPDATE_PARTICIPANT_INTERPRETATION_STATE_REQUEST_FAILED:"UpdateParticipantInterpretationStateRequestFailed",UPDATE_PARTICIPANT_INTERPRETATION_STATE_REQUEST_COMPLETED:"UpdateParticipantInterpretationStateRequestCompleted",UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_FAILED:"UpdateParticipantInterpretationStateResponseFailed",UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_COMPLETED:"UpdateParticipantInterpretationStateResponseCompleted",WAITING_FOR_JOIN_MEETING_GROUP_COMPLETION:"WaitingForJoinMeetingGroupCompletion",JOIN_MEETING_GROUP_REQUEST_FAILED:"JoinMeetingGroupRequestFailed",JOIN_MEETING_GROUP_REQUEST_COMPLETED:"JoinMeetingGroupRequestCompleted",JOIN_MEETING_GROUP_RESPONSE_FAILED:"JoinMeetingGroupRequestFailed",JOIN_MEETING_GROUP_RESPONSE_COMPLETED:"JoinMeetingGroupRequestCompleted",WAITING_FOR_LEAVE_MEETING_GROUP_COMPLETION:"WaitingForLeaveMeetingGroupCompletion",LEAVE_MEETING_GROUP_REQUEST_FAILED:"LeaveMeetingGroupRequestFailed",LEAVE_MEETING_GROUP_REQUEST_COMPLETED:"LeaveMeetingGroupRequestCompleted",LEAVE_MEETING_GROUP_RESPONSE_FAILED:"LeaveMeetingGroupRequestFailed",LEAVE_MEETING_GROUP_RESPONSE_COMPLETED:"LeaveMeetingGroupRequestCompleted",SUBSCRIBE_URL_FOUND:"SubscribeUrlFound",SUBSCRIBE_URL_MISSING:"SubscribeUrlMissing"},function(F){F[F.Call=0]="Call",F[F.Conversation=1]="Conversation",F[F.Broker=2]="Broker",F[F.ContentShare=3]="ContentShare",F[F.LMC=4]="LMC",F[F.Unknown=5]="Unknown"}(W=B.CONTROLLER||(B.CONTROLLER={})),B.NETWORK_REQUESTS={SEND_MEDIA_ANSWER:{name:"SendMediaAnswer",controller:W.Call},START_RENEGOTIATION:{name:"StartRenegotiation",controller:W.Call},SEND_MEDIA_ACKNOWLEDGEMENT:{name:"SendMediaAcknowledgement",controller:W.Call},SEND_MEDIA_REJECTION:{name:"SendMediaRejection",controller:W.Call},ADD_PARTICIPANT:{name:"AddParticipant",controller:W.Conversation},ADD_PARTICIPANT_WITH_REPLACES:{name:"AddParticipantWithReplaces",controller:W.Conversation},NUDGE_PARTICIPANT:{name:"NudgeParticipant",controller:W.Conversation},REMOVE_PARTICIPANT_NONE:{name:"RemoveParticipant",controller:W.Conversation},REMOVE_PARTICIPANT_OTHERS:{name:"RemoveParticipantOthers",controller:W.Conversation},REMOVE_PARTICIPANT_SPECIFIED:{name:"RemoveParticipantSpecified",controller:W.Conversation},ADMIT_PARTICIPANT:{name:"AdmitParticipant",controller:W.Conversation},ADMIT:{name:"Admit",controller:W.Conversation},BROKER_SUBSCRIBE:{name:"BrokerSubscribe",controller:W.Broker},CALL_ME_BACK:{name:"CallMeBack",controller:W.Conversation},SEND_ACCEPTANCE:{name:"SendAcceptance",controller:W.Call},SEND_ACCEPTANCE_ACKNOWLEDGEMENT:{name:"SendAcceptanceAcknowledgement",controller:W.Call},END_CALL:{name:"EndCall",controller:W.Conversation},CANCEL_CALL:{name:"CancelCall",controller:W.Conversation},REJECT_CALL:{name:"RejectCall",controller:W.Call},JOIN_CONVERSATION:{name:"JoinConversation",controller:W.Conversation},JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:{name:"JoinConversationWithoutCallModality",controller:W.Conversation},LEAVE_CONVERSATION:{name:"LeaveConversation",controller:W.Conversation},DELETE_CONVERSATION:{name:"DeleteConversation",controller:W.Conversation},START_CALL:{name:"StartCall",controller:W.Conversation},PLACE_NUDGE_CALL:{name:"PlaceNudgeCall",controller:W.Unknown},UPDATE_CONVERSATION_LINKS:{name:"UpdateConversationLinks",controller:W.Conversation},SEND_CONVERSATION_KEEP_ALIVE:{name:"SendConversationKeepAlive",controller:W.Conversation},UPDATE_LWJ_LINKS:{name:"UpdateLwjLinks",controller:W.LMC},SEND_CALL_ATTACH:{name:"SendCallAttach",controller:W.Call},SEND_CALL_PROGRESS:{name:"SendCallProgress",controller:W.Call},SEND_KEEP_ALIVE:{name:"SendKeepAlive",controller:W.Call},SEND_KEEP_ALIVE_LWJ:{name:"SendKeepAliveLwj",controller:W.Call},ADD_CONTENT_SHARING_MODALITY:{name:"AddContentSharingModality",controller:W.Conversation},DELETE_CONTENT_SHARING:{name:"DeleteContentSharing",controller:W.ContentShare},TAKE_CONTROL_CONTENT_SHARING:{name:"TakeControlContentSharing",controller:W.ContentShare},UPDATE_SESSION_STATE_CONTENT_SHARING:{name:"UpdateSessionStateContentSharing",controller:W.ContentShare},JOIN_CONTENT_SHARING:{name:"JoinContentSharing",controller:W.ContentShare},UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:{name:"UpdateParticipantStateContentSharing",controller:W.ContentShare},UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS:{name:"UpdateContentSharingNotificationLinks",controller:W.ContentShare},MUTE_ALL:{name:"MuteAll",controller:W.Conversation},MUTE_ALL_SYNC:{name:"MuteAllSync",controller:W.Conversation},MUTE_SPECIFIED:{name:"MuteSpecified",controller:W.Conversation},MUTE_SPECIFIED_SYNC:{name:"MuteSpecifiedSync",controller:W.Conversation},MUTE_MYSELF:{name:"MuteMyself",controller:W.Conversation},UNMUTE:{name:"Unmute",controller:W.Conversation},UNMUTE_SYNC:{name:"UnmuteMyselfSync",controller:W.Conversation},SEND_CONTROL_VIDEO_STREAMING:{name:"SendControlVideoStreaming",controller:W.Call},SEND_APPLY_CHANNEL_PARAMETERS:{name:"SendApplyChannelParameters",controller:W.Call},APPROVE_UNMUTE:{name:"ApproveUnmute",controller:W.Unknown},REJECT_UNMUTE:{name:"RejectUnmute",controller:W.Unknown},SEND_CALL_REDIRECT_REQUEST:{name:"SendCallRedirectRequest",controller:W.Call},SEND_TRANSFER_REQUEST:{name:"SendTransferRequest",controller:W.Call},SEND_PARK_REQUEST:{name:"SendParkRequest",controller:W.Call},SEND_SHARED_LINE_PARK_REQUEST:{name:"SharedLinePark",controller:W.Call},SEND_SERVER_HOLD_REQUEST:{name:"ServerHoldRequest",controller:W.Call},PARK_REQUEST:{name:"ParkRequest",controller:W.Call},SEND_UNPARK_REQUEST:{name:"UnparkRequest",controller:W.Call},TRANSFER_ACCEPTANCE:{name:"TransferAcceptance",controller:W.Call},TRANSFER_COMPLETION:{name:"TransferCompletion",controller:W.Call},TRANSFER_COMPLETION_FAILED:{name:"TransferCompletionFailed",controller:W.Call},UPDATE_ENDPOINT_STATE:{name:"UpdateEndpointState",controller:W.Conversation},DISABLE_PREHEAT:{name:"DisablePreheat",controller:W.Unknown},REQUEST_NEW_OFFER:{name:"RequestNewOffer",controller:W.Call},UPDATE_ENDPOINT_METADATA:{name:"UpdateEndpointMetadata",controller:W.Conversation},UPDATE_MEETING_ROLE_ATTENDEE:{name:"UpdateMeetingRoleToAttendee",controller:W.Conversation},UPDATE_MEETING_ROLE_PRESENTER:{name:"UpdateMeetingRoleToPresenter",controller:W.Conversation},UPDATE_MEETING_ROLE_ORGANIZER:{name:"UpdateMeetingRoleToOrganizer",controller:W.Conversation},ADD_PARTICIPANT_WITH_PICKUP_CODE:{name:"AddParticipantWithPickupCode",controller:W.Conversation},PUBLISH_STATE:{name:"PublishState",controller:W.Conversation},REMOVE_STATE:{name:"RemoveState",controller:W.Conversation},UPDATE_MEETING_SETTINGS:{name:"UpdateMeetingSettings",controller:W.Conversation},ADD_PARTICIPANTS_AND_MODALITY:{name:"AddParticipantsAndModality",controller:W.Conversation},ADD_BROADCAST_MODALITY:{name:"AddBroadcastModality",controller:W.Conversation},SEARCH_PARTICIPANTS:{name:"SearchParticipants",controller:W.Conversation},GET_ALL_PARTICIPANTS:{name:"GetAllParticipants",controller:W.Conversation},UPDATE_MEETING_LIVE_STATE:{name:"UpdateMeetingLiveState",controller:W.Conversation},UPDATE_MEETING_GROUPS:{name:"UpdateMeetingGroups",controller:W.Conversation},SET_MEETING_LAYOUT:{name:"SetMeetingLayout",controller:W.Conversation},UPDATE_PARTICIPANT_INTERPRETATION_STATE:{name:"UpdateParticipantInterpretationState",controller:W.Conversation},JOIN_MEETING_GROUP:{name:"JoinMeetingGroup",controller:W.Conversation},LEAVE_MEETING_GROUP:{name:"LeaveMeetingGroup",controller:W.Conversation}};var z={EVENT_SOURCE:{TROUTER:"Trouter",BROKER:"Broker",UDP:"UDP",LOCAL:"Local"},SOURCE:{NGC_SOURCE:"SkypeConcore"},EVENT_TYPE:{CONVERSATION_CALL_MODALITY:"skypecosi_concore_web_csa_conversation_callmodality",CONVERSATION_CONTENT_SHARING:"skypecosi_concore_web_csa_conversation_contentsharing",CONVERSATION_HTTP_REQUEST:"skypecosi_concore_web_csa_conversation_httprequest"},EXTENSIONS:{DATA_VERSION:"DataVersion",DIRECTION:"Direction",CONTENT_SHARING_DIRECTION:"ContentSharingDirection",CONNECTED_DURATION_IN_MS:"ConnectedDurationInMsecs",PREHEATED_CALL_SETUP_DURATION_IN_S:"PreheatedCallSetupDurationInSeconds",CALL_CANCELATION_DURATION_IN_S:"CallCancelationDurationInSeconds",IS_PREHEATED:"IsPreheated",TIME_TO_RING_IN_MS:"TimeToRingInMsecs",CALL_TERMINATING_END:"CallTerminatingEnd",NETWORK_REQUESTS_PENDING:"NetworkRequestsPending",NETWORK_REQUESTS_COMPLETED:"NetworkRequestsCompleted",LOCAL_OPERATIONS_PERFORMED:"LocalOperationsPerformed",TROUTER_WAIT_OPERATIONS:"TrouterWaitOperations",CALL_START_TIME:"CallStartTime",CALL_END_TIME:"CallEndTime",IS_GROUP_CALL:"IsGroupCall",IS_HOSTLESS_CALL:"IsHostLessCall",IS_CAST_CALL:"IsCastCall",IS_MEETUP_CALL:"IsMeetupCall",IS_ON_BEHALF_OF_CALL:"IsOnBehalfOfCall",IS_SDP_IN_CALL_NOTIFICATION:"SdpInCallNotification",CALL_END_CODE:"Code",CALL_END_SUB_CODE:"SubCode",CALL_PHRASE:"Phrase",CALL_END_RESULT_CATEGORIES:"ResultCategories",CALL_END_CAUSE_ID:"CauseId",CONTENT_SHARING_END_CODE:"ContentSharingEndReasonServiceCode",CONTENT_SHARING_END_SUB_CODE:"ContentSharingEndReasonServiceSubCode",CONVERSATION_SERVICE_URL:"ConversationServiceUrl",CONTENT_SHARING_SERVICE_URL:"ContentSharingServiceUrl",MEETING_INFO:"MeetingInfo",JOINED_FROM:"JoinedFrom",RESULT_VALUE:"ResultValue",RESULT_DETAIL:"ResultDetail",RESULT_CAUSE_ID:"ResultCauseId",RESULT_CODE:"ResultCode",LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS:"LocalOfferAnswerGenerationTimestamps",SELF_PARTICIPANT_ROLE:"SelfParticipantRole",SCENARIO:"Scenario",CALLER_TYPE:"Caller_Type",CALLEE_TYPE:"Callee_Type",CALL_TYPE:"Call_Type",TEST_CONTEXT_ID:"Test_Context_Id",OUTGOING_MODALITIES:"Outgoing_Modalities",INCOMING_MODALITIES:"Incoming_Modalities",OFFERED_MODALITIES:"CallOfferredModalities",ANSWERED_MODALITIES:"CallAnsweredModalities",VBSS_OPERATIONS:"VBSS_Operations",CHANGING_CORRELATION_ID_NEW_ID:"ChangingCorrelationId_NewId",CHANGING_CORRELATION_ID_OLD_ID:"ChangingCorrelationId_OldId",MESSAGING_CHANNEL:"MessagingChannel",EVENT_TIMESTAMP_BAG:"EventTimestampBag",ROSTER_UPDATES_BAG:"RosterUpdatesBag",NETWORK_REQUESTS_BAG:"NetworkRequestBag",CLIENT_INFORMATION:"ClientInformation",ECS_ETAG:"EcsEtag",APPLICATION_TYPE:"ApplicationType",RING:"Ring",TENANT_ID:"TenantId",USER_HEX_CID:"UserHexCID",ACS_RESOURCE_ID:"AcsResourceId",REGION:"Region",PARTITION:"Partition",CALL_END_CLIENT_SUB_CODE:"CallEventCallEndClientSubCode",CALL_END_CLIENT_PHRASE:"CallEventCallEndClientPhrase",MEETING_CODE:"MeetingCode",MEETING_URL:"MeetingJoinUrl"},MESSAGING_CHANNEL:{TROUTER:"Trouter",BROKER:"Broker"},SIGNALING_CONFIG:"JsCsaConfig",SIGNALING_CONFIG_FLAGS:{BROKER_OUTGOING_ENABLED:"BrokerOutgoingEnabled",BROKER_INCOMING_ENABLED:"BrokerIncomingEnabled",BROKER_REQUEST_BATCHING_ENABLED:"BrokerRequestBatchingEnabled",BROKER_EXCLUSIVELY_ENABLED:"BrokerExclusivelyEnabled",SUPPORTS_COMPRESSED_PAYLOAD:"SupportsCompressedPayload",SYNC_TROUTER_RESPONSE:"SyncTrouterResponse",SERVER_MUTE_UNMUTE:"serverMuteUnmute",HANDLE_OFFER_FROM_NOTIFICATION:"handleMediaOfferFromPushNotification",HANDLE_NEW_OFFER_REQUEST:"handleNewOfferRequest",SEND_PROGRESS_FROM_CC:"sendProgressFromCC",HANDLE_UNMUTE_MUTE_FROM_RESPONSE:"handleUnmuteMuteFromResponse",INTERNAL_HTTP_DISPATCHER:"internalHttpDispatcher",ENABLE_TOKEN_CACHE:"enableTokenCache",ENABLE_TOKEN_PREFETCH:"enableTokenPrefetch",REQUEST_HEDGING:"requestHedging",PROCESS_SELF_DATA_FROM_SUBSCRIBE_RESPONSE:"processSelfDataFromSubscribeResponse",SUPPORT_MEDIA_RETARGET_WHILE_INCOMING_RENEGOTIATION:"supportMediaRetargetWhileIncomingRenegotiation",ENABLE_ERROR_CODE_IMPROVEMENTS_FOR_NETWORK_FAILURES:"enableErrorCodeImprovementsForNetworkFailures",ENABLE_CALL_ESTABLISHMENT_TIMEOUTS_FOR_START_OR_JOIN_CALL:"enableCallEstablishmentTimeoutsForStartJoinCall"},CONTEXT_ID:{CORRELATION_ID:"CorrelationId",SHARED_CORRELATION_ID:"SharedCorrelationId",SIGNALING_SESSION_ID:"SignalingSessionId",GROUP_ID:"GroupId",THREAD_ID:"ThreadId",TEAMS_MESSAGEID:"TeamsMessageId",TEAMS_MEETINGINFO:"TeamsMeetingInfo",ENDPOINT_ID:"EndpointId",PARTICIPANT_ID:"ParticipantId",DATA_VERSION:"DataVersion",CONTENT_SHARING_ID:"ContentSharingSessionId",CONTENT_SHARING_CORRELATION_ID:"ContentSharingCorrelationId"},CALL_TERMINATING_END:{LOCAL:"Local",REMOTE:"Remote"},RESULT_VALUE:{SUCCESS:"Success",FAILURE:"Failure"},DIRECTION:{INCOMING:"Incoming",OUTGOING:"Outgoing"},ROLE:{CALLER:"caller",CALLEE:"callee",JOIN:"join",JOIN_FOR_ROSTER_ONLY:"joinForRosterOnly",PREHEAT:"preheat"},VBSS_OPERATION:{START:"Start",STOP:"Stop",REJECTED:"Rejected",REMOTE_START:"RemoteStart",TIMEOUT:"Timeout",CALL_END:"CallEnd"},LOCAL_OFFER_ANSWER_OPERATIONS:{INITIAL_OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",INITIAL_OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",FINAL_ANSWER_PROCESSING_STARTED:"FinalAnswerProcessingStarted",FINAL_ANSWER_PROCESSING_ENDED:"FinalAnswerProcessingEnded",PROVISIONAL_ANSWER_PROCESSING_STARTED:"ProvisonalAnswerProcessingStarted",PROVISIONAL_ANSWER_PROCESSING_ENDED:"ProvisonalAnswerProcessingEnded",NEGOTIATION_COMPLETED:"NegotiationCompleted",INITIAL_OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",INITIAL_OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",FINAL_ANSWER_GENERATION_STARTED:"FinalAnswerGenerationStarted",FINAL_ANSWER_GENERATION_ENDED:"FinalAnswerGenerationEnded",PROVISIONAL_ANSWER_GENERATION_STARTED:"ProvisionalAnswerGenerationStarted",PROVISIONAL_ANSWER_GENERATION_ENDED:"ProvisionalAnswerGenerationEnded",RENEGOTIATION_OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",RENEGOTIATION_OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",RENEGOTIATION_ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",RENEGOTIATION_ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",RENEGOTIATION_OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",RENEGOTIATION_OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",RENEGOTIATION_ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",RENEGOTIATION_ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"},TROUTER_WAIT_OPERATION:{STARTED:"Started",ENDED:"Ended",FAILED:"Failed"}};B.default=z},function(F,B,G){function getRandomizedTimeout(F){var B=Math.floor(11*Math.random())+10;return Math.floor(F*(1-B/100))}function isStringBase64(F){if(!F)return!1;try{return atob(F),!0}catch(F){return!1}}function isPromiseLike(F){return!!F&&"function"==typeof F.then}function stringifyObject(F){if(!F)return"".concat(F);if(F instanceof Map)return mapToString(F);var B=F.toString();return B.endsWith("[object Object]")?JSON.stringify(F):B}function mapToString(F){var B={};return F.forEach((function(F,G){B[G.toString()]=F})),JSON.stringify(B)}function stringToBuffer(F){for(var B=new ArrayBuffer(F.length),G=new Uint8Array(B),W=0;W<F.length;W++)G[W]=F.charCodeAt(W);return G}Object.defineProperty(B,"__esModule",{value:!0}),B.stringToBuffer=B.stringifyObject=B.isPromiseLike=B.isStringBase64=B.getRandomizedTimeout=void 0,B.getRandomizedTimeout=getRandomizedTimeout,B.isStringBase64=isStringBase64,B.isPromiseLike=isPromiseLike,B.stringifyObject=stringifyObject,B.stringToBuffer=stringToBuffer},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.UserAgentConfig=void 0;var Q=G(23),Y=G(4),$=G(6),X=G(18),Z=function(F){function UserAgentConfig(B){var G=F.call(this)||this;return G.configProvider=B,G.isAudioOutputSelectionSupportedValue=!1,G.configProvider.on("configUpdated",(function(){return G.updateConfig()})),G.updateConfig(),G.hasRollbackSupported(),G}return z(UserAgentConfig,F),Object.defineProperty(UserAgentConfig.prototype,"isAudioOutputSelectionSupported",{get:function(){return this.isAudioOutputSelectionSupportedValue},enumerable:!1,configurable:!0}),Object.defineProperty(UserAgentConfig.prototype,"isBrowserRollbackSupported",{get:function(){return this.isBrowserRollbackSupportedValue},enumerable:!1,configurable:!0}),UserAgentConfig.hasApplyConstraints=function(){return void 0!==MediaStreamTrack.prototype.applyConstraints},UserAgentConfig.hasPermissionsApi=function(){return void 0!==navigator.permissions&&"Firefox"!==(0,Q.getBrowserInfo)().name},Object.defineProperty(UserAgentConfig,"hardwareConcurrency",{get:function(){return window.navigator.hardwareConcurrency},enumerable:!1,configurable:!0}),Object.defineProperty(UserAgentConfig,"unmaskedGlRenderer",{get:function(){if(this.renderer)return this.renderer===Y.default.MEDIA_ERROR.webGlRendererError?void 0:this.renderer;try{var F=document.createElement("canvas").getContext("webgl"),B=null==F?void 0:F.getExtension("WEBGL_debug_renderer_info"),G=B&&F.getParameter(B.UNMASKED_RENDERER_WEBGL);return this.renderer=G,G}catch(F){return void(this.renderer=Y.default.MEDIA_ERROR.webGlRendererError)}},enumerable:!1,configurable:!0}),UserAgentConfig.prototype.hasRollbackSupported=function(){return K(this,void 0,void 0,(function(){var F,B;return J(this,(function(G){switch(G.label){case 0:F=X.default.window.RTCPeerConnection&&new X.default.window.RTCPeerConnection,G.label=1;case 1:return G.trys.push([1,6,7,8]),F?[4,F.createOffer()]:[3,5];case 2:return B=G.sent(),[4,F.setLocalDescription(B)];case 3:return G.sent(),[4,F.setLocalDescription({type:"rollback"})];case 4:G.sent(),this.isBrowserRollbackSupportedValue=!0,G.label=5;case 5:return[3,8];case 6:return G.sent(),this.isBrowserRollbackSupportedValue=!1,[3,8];case 7:return F&&F.close(),[7];case 8:return[2]}}))}))},UserAgentConfig.hasH264CodecSupport=function(F){return K(this,void 0,void 0,(function(){var B,G,W;return J(this,(function(z){switch(z.label){case 0:if(B="v=0\no=- 596983 0 IN IP4 127.0.0.1\ns=session\nc=IN IP4 0.0.0.0\nt=0 0\na=msid-semantic: WMS *\nm=video 3480 RTP/SAVPF 107 99\na=rtpmap:107 H264/90000\na=rtpmap:99 rtx/90000\na=fmtp:107 max-fs=240;max-mbps=3600;max-br=208;max-fps=1500;profile-level-id=42C02A;packetization-mode=1\na=fmtp:99 apt=107\na=setup:actpass\na=mid:video\na=recvonly\na=rtcp-mux\na=ice-ufrag:CvYq\na=ice-pwd:axsjsa0GOz3kz6TuGvNgJZWO\na=fingerprint:sha-256 34:DF:5C:15:60:FF:28:3E:E8:96:4B:F8:85:61:E4:C0:57:D1:60:82:21:FD:BC:D2:90:41:06:FA:03:FD:12:A2\n",!(G=X.default.window.RTCPeerConnection&&new X.default.window.RTCPeerConnection))return[2,!1];z.label=1;case 1:return z.trys.push([1,3,4,5]),[4,G.setRemoteDescription({sdp:B,type:"offer"})];case 2:return z.sent(),[2,!0];case 3:return W=z.sent(),F.error("H264 not supported",W),[2,!1];case 4:try{G.close()}catch(F){}return[7];case 5:return[2]}}))}))},UserAgentConfig.hasMediaApi=function(){return navigator.getUserMedia&&"undefined"!=typeof RTCPeerConnection},UserAgentConfig.hasCapabilitiesApi=function(){var F;return!!(null===(F=X.default.window.RTCRtpReceiver)||void 0===F?void 0:F.getCapabilities)},UserAgentConfig.isAudioOutputSelectionSupportedByBrowser=function(){var F,B;return!!(null===(B=null===(F=X.default.window)||void 0===F?void 0:F.HTMLAudioElement)||void 0===B?void 0:B.prototype.setSinkId)},UserAgentConfig.prototype.updateConfig=function(){var F=UserAgentConfig.isAudioOutputSelectionSupportedByBrowser();F!==this.isAudioOutputSelectionSupportedValue&&(this.isAudioOutputSelectionSupportedValue=F,this.event("isAudioOutputSelectionSupportedChanged").raise())},UserAgentConfig.hasUnifiedPlanSupport=function(){var F;try{F=X.default.window.RTCPeerConnection&&new X.default.window.RTCPeerConnection({sdpSemantics:"unified-plan"})}catch(F){return!1}var B=!1;return F&&(B=!!F.addTransceiver,F.close()),B},UserAgentConfig}($.default);B.UserAgentConfig=Z},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.ResolutionInfo=void 0;var z=16;function createResolutionTable(F){return F.map((function(F){return new K(F.w,F.h,F.minBr,F.maxBr)}))}var K=function(){function ResolutionInfo(F,B,G,W){void 0===G&&(G=0),void 0===W&&(W=0),this.width=F,this.height=B,this.minBitrate=G,this.maxBitrate=W,this.fs=Math.ceil(F/z)*Math.ceil(B/z)}return ResolutionInfo.prototype.toString=function(){return this.height?"".concat(this.height,"p"):"".concat(this.fs,"fs")},ResolutionInfo}();B.ResolutionInfo=K;var J=function(){function ResolutionTable(F){this.resolutions=[new K(320,180,2e4,2e5),new K(426,240,16e4,5e5),new K(640,360,4e5,12e5),new K(960,540,11e5,18e5),new K(1280,720,15e5,25e5),new K(1920,1080,18e5,1e8)],F&&(this.resolutions=createResolutionTable(F))}return Object.defineProperty(ResolutionTable.prototype,"initialResolution",{get:function(){return this.resolutions[this.resolutions.length-1]},enumerable:!1,configurable:!0}),ResolutionTable.prototype.getResolutionByFs=function(F){for(var B=this.resolutions.length-1;B>=0;B--)if(this.resolutions[B].fs<=F)return this.resolutions[B];return this.resolutions[0]},ResolutionTable.prototype.getMaxFS=function(F,B){return this.getResolutionRecord(F,B).fs},ResolutionTable.prototype.getResolutionForBitrate=function(F){return{lowRes:this.resolutions.filter((function(B){return B.maxBitrate&&B.maxBitrate>=F})).shift(),highRes:this.resolutions.filter((function(B){return B.minBitrate&&B.minBitrate<=F})).pop()}},ResolutionTable.prototype.getBitrateForResolution=function(F,B){var G=this.getResolutionRecord(F,B);return{minBitrate:G.minBitrate,maxBitrate:G.maxBitrate}},ResolutionTable.prototype.getResolutionForHeight=function(F){for(var B=this.resolutions.length-1;B>=0;B--)if(this.resolutions[B].height<=F)return this.resolutions[B];return this.resolutions[0]},ResolutionTable.prototype.getResolutionRecord=function(F,B){var G,z,K=Math.max(F,B),J=Math.min(F,B);try{for(var Q=W(this.resolutions),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;if($.width>=K&&$.height>=J)return $}}catch(F){G={error:F}}finally{try{Y&&!Y.done&&(z=Q.return)&&z.call(Q)}finally{if(G)throw G.error}}return this.resolutions[this.resolutions.length-1]},ResolutionTable.prototype.getResolutions=function(){return this.resolutions},ResolutionTable}();B.default=J},function(F,B,G){(function(F){G.d(B,"a",(function(){return getGlobal})),G.d(B,"c",(function(){return throwTypeError})),G.d(B,"b",(function(){return objCreateFn}));var W=G(2),z=null;function getGlobal(B){return void 0===B&&(B=!0),z&&B||(typeof globalThis!==W.l&&globalThis&&(z=globalThis),typeof self!==W.l&&self&&(z=self),typeof window!==W.l&&window&&(z=window),typeof F!==W.l&&F&&(z=F)),z}function throwTypeError(F){throw new TypeError(F)}function objCreateFn(F){var B=W.c;if(B)return B(F);if(null==F)return{};var G=typeof F;function tmpFunc(){}return G!==W.j&&G!==W.h&&throwTypeError("Object prototype may only be an Object:"+F),tmpFunc[W.k]=F,new tmpFunc}}).call(this,G(49))},,function(F,G){F.exports=B},function(F,B,G){function getTsCallingVersion(){return"2022.35.01.27"}function getOvb(){return"c254a26c13fae42e97d064e7d99cbda991faa174"}Object.defineProperty(B,"__esModule",{value:!0}),B.getOvb=B.getTsCallingVersion=void 0,B.getTsCallingVersion=getTsCallingVersion,B.getOvb=getOvb},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.PromiseQueue=void 0;var W=G(38),z=G(1),K=G(13),J=function(){function PromiseQueue(F){this.logger=F,this.queue=Promise.resolve()}return PromiseQueue.prototype.add=function(F,B){var G,J=this;void 0===B&&(B=(0,K.generateCauseId)()),G=F instanceof W.SettablePromise?function(){return F.promise}:F;var Q=this.queue.then(G);return this.queue=Q.catch((function(F){J.queue&&J.logger.safe.error("[".concat(B,"] Error from promiseQueue! ").concat(z.stringifyObject(F)))})),Q},PromiseQueue.prototype.dispose=function(){this.queue=null},PromiseQueue}();B.PromiseQueue=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.Constants=B.Helper=B.MediaAgent=void 0;var W=G(4),z=G(10);B.Helper=z;var K=G(354);Object.defineProperty(B,"MediaAgent",{enumerable:!0,get:function(){return K.default}}),B.Constants=W.default},function(F,B,G){G.d(B,"a",(function(){return $}));var W=G(43),z=G(42),K=G(20),J=G(0),Q=G(11),Y=function(){function TelemetryPluginChain(F,B){var G=this,W=null,Y=Object(J.o)(F.processTelemetry),$=Object(J.o)(F.setNextPlugin);G._hasRun=!1,G.getPlugin=function(){return F},G.getNext=function(){return W},G.setNext=function(F){W=F},G.processTelemetry=function(J,X){X||(X=B);var Z=F?F.identifier:"TelemetryPluginChain";Object(z.b)(X?X.core():null,(function(){return Z+":processTelemetry"}),(function(){if(F&&Y){G._hasRun=!0;try{X.setNext(W),$&&F.setNextPlugin(W),W&&(W._hasRun=!1),F.processTelemetry(J,X)}catch(G){var B=W&&W._hasRun;W&&B||X.diagLog().throwInternal(K.a.CRITICAL,K.b.PluginException,"Plugin ["+F.identifier+"] failed during processTelemetry - "+Object(Q.a)(G)),W&&!B&&W.processTelemetry(J,X)}}else W&&(G._hasRun=!0,W.processTelemetry(J,X))}),(function(){return{item:J}}),!J.sync)}}return TelemetryPluginChain}();function _createProxyChain(F,B){var G=[];if(F&&F.length>0)for(var W=null,z=0;z<F.length;z++){var K=F[z];if(K&&Object(J.o)(K.processTelemetry)){var Q=new Y(K,B);G.push(Q),W&&W.setNext(Q),W=Q}}return G.length>0?G[0]:null}function _copyProxyChain(F,B,G){var W=[],z=!G;if(F)for(;F;){var K=F.getPlugin();(z||K===G)&&(z=!0,W.push(K)),F=F.getNext()}return z||W.push(G),_createProxyChain(W,B)}function _copyPluginChain(F,B,G){var W=F,z=!1;return G&&F&&(W=[],Object(J.a)(F,(function(F){(z||F===G)&&(z=!0,W.push(F))}))),G&&!z&&(W||(W=[]),W.push(G)),_createProxyChain(W,B)}var $=function(){function ProcessTelemetryContext(F,B,G,z){var K=this,Q=null;null!==z&&(F&&Object(J.o)(F.getPlugin)?Q=_copyProxyChain(F,K,z||F.getPlugin()):z?Q=_copyPluginChain(F,K,z):Object(J.x)(z)&&(Q=_createProxyChain(F,K))),K.core=function(){return G},K.diagLog=function(){return Object(W.c)(G,B)},K.getCfg=function(){return B},K.getExtCfg=function(F,G){var W;if(void 0===G&&(G={}),B){var z=B.extensionConfig;z&&F&&(W=z[F])}return W||G},K.getConfig=function(F,G,W){var z;void 0===W&&(W=!1);var Q=K.getExtCfg(F,null);return Q&&!Object(J.r)(Q[G])?z=Q[G]:B&&!Object(J.r)(B[G])&&(z=B[G]),Object(J.r)(z)?W:z},K.hasNext=function(){return null!=Q},K.getNext=function(){return Q},K.setNext=function(F){Q=F},K.processNext=function(F){var B=Q;B&&(Q=B.getNext(),B.processTelemetry(F,K))},K.createNew=function(F,W){return void 0===F&&(F=null),new ProcessTelemetryContext(F||Q,B,G,W)}}return ProcessTelemetryContext}()},function(F,B,G){G.d(B,"a",(function(){return addEventHandler})),G.d(B,"d",(function(){return addPageUnloadEventListener})),G.d(B,"b",(function(){return addPageHideEventListener})),G.d(B,"c",(function(){return addPageShowEventListener})),G.d(B,"f",(function(){return newGuid})),G.d(B,"h",(function(){return perfNow})),G.d(B,"g",(function(){return newId})),G.d(B,"e",(function(){return generateW3CId}));var W,z=G(2),K=G(29),J=G(24),Q=G(11),Y=G(0),$=G(21),X="visibilitychange",Z="pagehide",ee="pageshow",te=null;z.l;function addEventHandler(F,B){var G=!1,W=Object(Q.k)();W&&(G=Object(Y.e)(W,F,B),G=Object(Y.e)(W.body,F,B)||G);var z=Object(Q.d)();return z&&(G=Object(Y.e)(z,F,B)||G),G}function addEventListeners(F,B,G){var W=!1;if(B&&F&&Object(Y.k)(F)){var z=[];Object(Y.a)(F,(function(F){Object(Y.u)(F)&&(G&&-1!==Object(Y.b)(G,F)?z.push(F):W=addEventHandler(F,B)||W)})),!W&&z.length>0&&(W=addEventListeners(z,B))}return W}function addPageUnloadEventListener(F,B){return addEventListeners(["beforeunload","unload","pagehide"],F,B)}function addPageHideEventListener(F,B){function _handlePageVisibility(B){var G=Object(Q.d)();F&&G&&"hidden"===G.visibilityState&&F(B)}var G=!1;return B&&-1!==Object(Y.b)(B,Z)||(G=addEventHandler(Z,F)),B&&-1!==Object(Y.b)(B,X)||(G=addEventHandler(X,_handlePageVisibility)||G),!G&&B&&(G=addPageHideEventListener(F)),G}function addPageShowEventListener(F,B){function _handlePageVisibility(B){var G=Object(Q.d)();F&&G&&"visible"===G.visibilityState&&F(B)}var G=!1;return B&&-1!==Object(Y.b)(B,ee)||(G=addEventHandler(ee,F)),B&&-1!==Object(Y.b)(B,X)||(G=addEventHandler(X,_handlePageVisibility)||G),!G&&B&&(G=addPageShowEventListener(F)),G}function newGuid(){function randomHexDigit(){return Object($.d)(15)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(ie,(function(F){var B=0|randomHexDigit();return("x"===F?B:3&B|8).toString(16)}))}function perfNow(){var F=Object(Q.j)();return F&&F.now?F.now():Object(Y.f)()}function newId(F){void 0===F&&(F=22);for(var B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",G=Object($.c)()>>>0,W=0,z="";z.length<F;)W++,z+=B.charAt(63&G),G>>>=6,5===W&&(G=(Object($.c)()<<2&4294967295|3&G)>>>0,W=0);return z}function generateW3CId(){for(var F,B=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],G="",W=0;W<4;W++)G+=B[15&(F=Object($.c)())]+B[F>>4&15]+B[F>>8&15]+B[F>>12&15]+B[F>>16&15]+B[F>>20&15]+B[F>>24&15]+B[F>>28&15];var z=B[8+(3&Object($.c)())|0];return G.substr(0,8)+G.substr(9,4)+"4"+G.substr(13,3)+z+G.substr(16,3)+G.substr(19,12)}var ne={_canUseCookies:void 0,isTypeof:Y.w,isUndefined:Y.x,isNullOrUndefined:Y.r,hasOwnProperty:Y.j,isFunction:Y.o,isObject:Y.t,isDate:Y.m,isArray:Y.k,isError:Y.n,isString:Y.u,isNumber:Y.s,isBoolean:Y.l,toISOString:Y.J,arrForEach:Y.a,arrIndexOf:Y.b,arrMap:Y.c,arrReduce:Y.d,strTrim:Y.H,objCreate:K.b,objKeys:Y.B,objDefineAccessors:Y.y,addEventHandler:addEventHandler,dateNow:Y.f,isIE:Q.o,disableCookies:disableCookies,newGuid:newGuid,perfNow:perfNow,newId:newId,randomValue:$.d,random32:$.c,mwcRandomSeed:$.b,mwcRandom32:$.a,generateW3CId:generateW3CId},ie=/[xy]/g;Y.e,Y.e,Y.g,Y.g;function _legacyCookieMgr(F,B){var G=Object(J.a)(F,B),z=ne._canUseCookies;return null===te&&(te=[],W=z,Object(Y.y)(ne,"_canUseCookies",(function(){return W}),(function(F){W=F,Object(Y.a)(te,(function(B){B.setEnabled(F)}))}))),-1===Object(Y.b)(te,G)&&te.push(G),Object(Y.l)(z)&&G.setEnabled(z),Object(Y.l)(W)&&G.setEnabled(W),G}function disableCookies(){_legacyCookieMgr().setEnabled(!1)}},function(F,B,G){var W="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(F,B){return Object.prototype.hasOwnProperty.call(F,B)}B.assign=function(F){for(var B=Array.prototype.slice.call(arguments,1);B.length;){var G=B.shift();if(G){if("object"!=typeof G)throw new TypeError(G+"must be non-object");for(var W in G)_has(G,W)&&(F[W]=G[W])}}return F},B.shrinkBuf=function(F,B){return F.length===B?F:F.subarray?F.subarray(0,B):(F.length=B,F)};var z={arraySet:function(F,B,G,W,z){if(B.subarray&&F.subarray)F.set(B.subarray(G,G+W),z);else for(var K=0;K<W;K++)F[z+K]=B[G+K]},flattenChunks:function(F){var B,G,W,z,K,J;for(W=0,B=0,G=F.length;B<G;B++)W+=F[B].length;for(J=new Uint8Array(W),z=0,B=0,G=F.length;B<G;B++)K=F[B],J.set(K,z),z+=K.length;return J}},K={arraySet:function(F,B,G,W,z){for(var K=0;K<W;K++)F[z+K]=B[G+K]},flattenChunks:function(F){return[].concat.apply([],F)}};B.setTyped=function(F){F?(B.Buf8=Uint8Array,B.Buf16=Uint16Array,B.Buf32=Int32Array,B.assign(B,z)):(B.Buf8=Array,B.Buf16=Array,B.Buf32=Array,B.assign(B,K))},B.setTyped(W)},function(F,B,G){var W;Object.defineProperty(B,"__esModule",{value:!0}),B.SettablePromise=B.SettablePromiseState=void 0,function(F){F[F.Pending=0]="Pending",F[F.Rejected=1]="Rejected",F[F.Resolved=2]="Resolved"}(W=B.SettablePromiseState||(B.SettablePromiseState={}));var z=function(){function SettablePromise(){var F=this;this.stateInt=W.Pending,this.promiseInt=new Promise((function(B,G){F.resolveInt=B,F.rejectInt=G}))}return Object.defineProperty(SettablePromise.prototype,"state",{get:function(){return this.stateInt},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,"resolve",{get:function(){var F=this;return function(B){F.stateInt=W.Resolved,F.resolveInt(B)}},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,"reject",{get:function(){var F=this;return function(B){F.stateInt=W.Rejected,F.rejectInt(B)}},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,"promise",{get:function(){return this.promiseInt},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,"isPending",{get:function(){return this.stateInt===W.Pending},enumerable:!1,configurable:!0}),SettablePromise}();B.SettablePromise=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getBundle=B.getTypeFromModality=B.getModalities=B.getLabelForModality=B.getModality=B.getModalityForMedia=B.filterCodecs=B.removeCodec=B.forCodec=B.forAllCodecs=B.forOneCodec=B.updatePayload=void 0;var W=G(8),z=G(4);function updatePayload(F,B,G){if(F.rtp){var W=F.rtp.filter((function(F){return F.payload===B}))[0];W&&forOneCodec(F,{name:W.codec,rate:W.rate,payload:W.payload},(function(F){return F.rtp.payload=G,F}))}}function forOneCodec(F,B,G){forCodec(F,B,!0,G)}function forAllCodecs(F,B,G){forCodec(F,B,!1,G)}function forCodec(F,B,G,W){if(F.rtp){for(var _loop_1=function(z){var K=F.rtp[z],J=K.payload;if(B.name.toLowerCase()!==K.codec.toLowerCase()||B.rate!==K.rate||B.encoding!==K.encoding||B.payload&&B.payload!==K.payload)return"continue";var Q={rtp:K};F.fmtp||(F.fmtp=[]);var Y=F.fmtp.find((function(F){return K.payload===F.payload}));Q.fmtp=Y,F.rtcpFb||(F.rtcpFb=[]),Q.rtcpFb=F.rtcpFb.filter((function(F){return F.payload===K.payload}));var $=Q.rtcpFb.length>0;if(null===W(Q))F.payloads=F.payloads.toString().split(" ").filter((function(F){return K.payload!==+F})).join(" "),F.fmtp=F.fmtp.filter((function(F){return K.payload!==F.payload})),F.rtcpFb=F.rtcpFb.filter((function(F){return K.payload!==F.payload})),F.rtp[z]=null;else{if(Q.rtp.payload!==J){var X=Q.rtp.payload;F.payloads=F.payloads.toString().split(" ").map((function(F){return+F===J?X:+F})).join(" "),Q.fmtp&&(Q.fmtp.payload=X),Q.rtcpFb&&Q.rtcpFb.forEach((function(F){return F.payload=X})),F.fmtp.filter((function(F){return F.config&&F.config.indexOf("apt=".concat(J))>-1})).forEach((function(F){return F.config=F.config.replace("apt=".concat(J),"apt=".concat(X))}))}!Y&&Q.fmtp&&F.fmtp.push(Q.fmtp),!$&&Q.rtcpFb&&Q.rtcpFb.forEach((function(B){return F.rtcpFb.push(B)}))}return G?"break":void 0},z=0;z<F.rtp.length;z++){if("break"===_loop_1(z))break}F.rtp=F.rtp.filter((function(F){return!!F}))}}function removeCodec(F,B){if(F.rtp){var G=-1;if(F.rtp.forEach((function(F,W){B.codec.toLowerCase()===F.codec.toLowerCase()&&B.rate===F.rate&&B.encoding===F.encoding&&(G=W)})),G>=0&&F.rtp.length>1){var W=F.rtp[G].payload;F.rtp.splice(G,1),F.payloads=F.payloads.split(" ").filter((function(F){return W!==+F})).join(" "),F.fmtp=F.fmtp&&F.fmtp.filter((function(F){return W!==F.payload}))}}}function isCodecsMatch(F,B,G){if(!W.isUndefined(F.rate)&&F.rate!==B.rate)return!1;if(!W.isUndefined(F.codec)&&F.codec.toLowerCase()!==B.codec.toLowerCase())return!1;if(!W.isUndefined(F.encoding)){if(!W.isUndefined(B.encoding)&&F.encoding!==B.encoding)return!1;if(W.isUndefined(B.encoding)&&1!==F.encoding)return!1}return!!W.isUndefined(F.fmtpLine)||!!(G&&G.find((function(G){return G.payload===B.payload&&-1!==G.config.toLowerCase().indexOf(F.fmtpLine.toLowerCase())})))}function isPayloadMatch(F,B){return B===F||"*"===B}function filterCodecs(F,B,G,K){if(F.rtp&&F.rtp.length){var J=F.rtp.filter((function(G){return B.some((function(B){return isCodecsMatch(B,G,F.fmtp)}))}));F.type===z.default.MEDIA_TYPE.video&&(J=J.filter((function(B){var G=F.fmtp&&F.fmtp.find((function(F){return F.payload===B.payload&&F.config.startsWith("apt=")}));if(G){var W=+G.config.split(";")[0].split("=")[1];return J.some((function(F){return F.payload===W}))}return!0}))),J.length?(F.rtp=J,G&&(F.rtp=W.flatten(B.map((function(B){return F.rtp.filter((function(G){return isCodecsMatch(B,G,F.fmtp)}))})))),F.payloads=F.rtp.map((function(F){return F.payload})).join(" "),F.fmtp=F.fmtp&&F.fmtp.filter((function(B){return F.rtp.some((function(F){return isPayloadMatch(F.payload,B.payload)}))})),F.rtcpFb=F.rtcpFb&&F.rtcpFb.filter((function(B){return F.rtp.some((function(F){return isPayloadMatch(F.payload,B.payload)}))}))):K&&K.warn("Empty rtp list after filtering")}}function getModalityForMedia(F){if(F.label)switch(F.label){case z.default.MEDIA_LABEL.audio:return"Audio";case z.default.MEDIA_LABEL.video:return"Video";case z.default.MEDIA_LABEL.sharing:return"ScreenShare";case z.default.MEDIA_LABEL.data:return"Data"}else switch(F.type){case z.default.MEDIA_TYPE.audio:return"Audio";case z.default.MEDIA_TYPE.video:return"Video";case z.default.MEDIA_TYPE.data:case z.default.MEDIA_TYPE.dataChannel:return"Data"}return null}function getModality(F){if(F.label)switch(F.label){case z.default.MEDIA_LABEL.audio:return z.default.MODALITY.audio;case z.default.MEDIA_LABEL.video:return z.default.MODALITY.video;case z.default.MEDIA_LABEL.sharing:return z.default.MODALITY.sharing;case z.default.MEDIA_LABEL.data:return z.default.MODALITY.data}else switch(F.type){case z.default.MEDIA_TYPE.audio:return z.default.MODALITY.audio;case z.default.MEDIA_TYPE.video:return z.default.MODALITY.video;case z.default.MEDIA_TYPE.data:case z.default.MEDIA_TYPE.dataChannel:return z.default.MODALITY.data}return null}function getLabelForModality(F){switch(F){case z.default.MODALITY.audio:return z.default.MEDIA_LABEL.audio;case z.default.MODALITY.video:return z.default.MEDIA_LABEL.video;case z.default.MODALITY.sharing:return z.default.MEDIA_LABEL.sharing;case z.default.MODALITY.data:return z.default.MEDIA_LABEL.data;default:return null}}function getModalities(F){return F.media.reduce((function(F,B){if(0!==B.port){var G=getModality(B);if(!(G in F)){var W=B.direction?B.direction.toLowerCase():z.default.MEDIA_STATE.sendReceive;F[G]=W}}return F}),{})}function getTypeFromModality(F){switch(F){case z.default.MODALITY.audio:return z.default.MEDIA_TYPE.audio;case z.default.MODALITY.video:case z.default.MODALITY.sharing:return z.default.MEDIA_TYPE.video;case z.default.MODALITY.data:return z.default.MEDIA_TYPE.data;default:return null}}function getBundle(F){var B,G=null===(B=F.groups)||void 0===B?void 0:B.find((function(F){return"BUNDLE"===F.type}));if(G){var W=G.mids.toString().split(" ")[0];return F.media.find((function(F){var B="number"==typeof F.mid?F.mid.toString():F.mid;return W===B}))||null}return null}B.updatePayload=updatePayload,B.forOneCodec=forOneCodec,B.forAllCodecs=forAllCodecs,B.forCodec=forCodec,B.removeCodec=removeCodec,B.filterCodecs=filterCodecs,B.getModalityForMedia=getModalityForMedia,B.getModality=getModality,B.getLabelForModality=getLabelForModality,B.getModalities=getModalities,B.getTypeFromModality=getTypeFromModality,B.getBundle=getBundle},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});function asap(F){return new Promise((function(B){B(F())}))}Object.defineProperty(B,"__esModule",{value:!0}),B.delay=B.timedDefer=B.defer=B.Timer=B.TimeoutError=B.asap=void 0,B.asap=asap;var K=function(F){function TimeoutError(){return null!==F&&F.apply(this,arguments)||this}return z(TimeoutError,F),TimeoutError}(Error);B.TimeoutError=K;var J=function(){function Timer(F){this.ontimeout=F}return Timer.prototype.start=function(F){this.timeoutId=window.setTimeout(this.ontimeout,F)},Timer.prototype.stop=function(){clearTimeout(this.timeoutId)},Timer}();function defer(){var F,B;return{promise:new Promise((function(G,W){F=G,B=W})),resolve:F,reject:B}}function timedDefer(F,B){var G,W;void 0===B&&(B="deferred timed out after ".concat(F,"ms"));var z=new J((function(){return W(new K(B))})),Q=new Promise((function(F,B){G=function(B){z.stop(),F(B)},W=function(F){z.stop(),B(F)}}));return z.start(F),{promise:Q,resolve:G,reject:W}}function delay(F){return new Promise((function(B){return setTimeout(B,F)}))}B.Timer=J,B.defer=defer,B.timedDefer=timedDefer,B.delay=delay},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.EMPTY_COUNTS=B.TRANSACTION_END_PHRASE=B.TRANSACTION_END_SUBCODE=B.TRANSACTION_END_CODE=B.UNPARK_CODE=B.TELEMETRY_EVENT_NAMES=B.CALL_REGISTRY_OPERATIONS=B.CONTENT_SHARING_OPERATIONS_INTERNAL=B.CONTENT_SHARING_OPERATIONS=B.PARTICIPANT_OPERATIONS_INTERNAL=B.PARTICIPANT_OPERATIONS=B.MEDIA_EVENT=B.OPERATION_VARIANTS=B.CALL_OPERATIONS_INTERNAL=B.OPERATION_TAGS=B.CALL_OPERATIONS=void 0,function(F){F.INITIALIZE="Initialize",F.START_CALL="StartCall",F.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",F.STOP_CALL="StopCall",F.STOP_CALL_WITH_BEACON="StopCallWithBeacon",F.JOIN_CALL="JoinCall",F.JOIN_PREHEATED_CALL="JoinPreheatedCall",F.SUBSCRIBE="Subscribe",F.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",F.ACKNOWLEDGE="Acknowledge",F.ACCEPT="Accept",F.REJECT="Reject",F.START_VIDEO="StartVideo",F.STOP_VIDEO="StopVideo",F.LOCAL_HOLD="LocalHold",F.LOCAL_UNHOLD="LocalUnhold",F.HOLD="Hold",F.UNHOLD="Unhold",F.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",F.SEND_DTMF_TONE="SendDtmfTone",F.SET_AUDIO_USAGE="SetAudioUsage",F.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",F.BLIND_TRANSFER="BlindTransfer",F.SAFE_TRANSFER="SafeTransfer",F.TRANSFER_TO_VOICEMAIL="TransferToVoicemail",F.CALL_REDIRECT="CallRedirect",F.CONSULTATIVE_TRANSFER="ConsultativeTransfer",F.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE="ConsultativeTransferWithPickupCode",F.START_SCREEN_SHARING="StartScreenSharing",F.STOP_SCREEN_SHARING="StopScreenSharing",F.START_LOCAL_RECORDING="StartLocalRecording",F.STOP_LOCAL_RECORDING="StopLocalRecording",F.INCLUDE_SYSTEM_AUDIO="IncludeSystemAudioInLocalRecording",F.START_DATA_CHANNEL="StartDataChannel",F.STOP_DATA_CHANNEL="StopDataChannel",F.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",F.START_MULTICHANNEL_AUDIO_DEVICE="StartMultichannelAudioDevice",F.STOP_MULTICHANNEL_AUDIO_DEVICE="StopMultichannelAudioDevice",F.START_FACESTREAM="StartFaceStream",F.STOP_FACESTREAM="StopfaceStream",F.START_INROOM_FACE_ATRRIBUTION="StartInRoomFaceAtrribution",F.STOP_INROOM_FACE_ATRRIBUTION="StopInRoomFaceAtrribution",F.MUTE="Mute",F.UNMUTE="Unmute",F.MUTE_SPEAKER="MuteSpeaker",F.UNMUTE_SPEAKER="UnmuteSpeaker",F.MUTE_PARTICIPANTS="MuteParticipants",F.UPDATE_MEETING_ROLE="UpdateMeetingRole",F.START_AUDIO="StartAudio",F.STOP_AUDIO="StopAudio",F.ASSIMILATE="Assimilate",F.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",F.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",F.START_CALL_WITH_NUDGE="StartCallWithNudge",F.START_CALL_AND_UNPARK="StartCallAndUnpark",F.PARK_CALL="ParkCall",F.UNPARK_CALL="UnparkCall",F.NUDGE_PARTICIPANTS="NudgeParticipants",F.LWJ_FALLBACK="LwjFallback",F.ELECTRON_SHOW_CQF_INFO="ElectronShowCQFInfo",F.ELECTRON_IS_CQF_RENDERED="ElectronIsCQFRendered",F.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",F.MERGE_CALL="MergeCall",F.ADD_GROUP_MODALITY="AddGroupModality",F.MERGE_WITH_PICKUP_CODE="MergeWithPickupCode",F.PUBLISH_STATE="PublishState",F.REMOVE_STATE="RemoveState",F.UPDATE_MEETING_SETTINGS="UpdateMeetingSettings",F.MERGE_PARTICIPANT="MergeParticipant",F.MERGE_PARTICIPANTS="MergeParticipants",F.ADMIT="Admit",F.SEARCH_PARTICIPANTS="SearchParticipants",F.GET_ALL_PARTICIPANTS="GetAllParticipants",F.SET_AUDIO_MIDCALL_CONFIG="SetAudioMidcallConfig",F.SET_PARTICIPANT_SPATIAL_POSITIONS="SetParticipantSpatialAudioPositions",F.START_WITH_MEETING_DATA="StartWithMeetingData",F.JOIN_WITH_MEETING_DATA="JoinWithMeetingData",F.SUBSCRIBE_WITH_MEETING_DATA="SubscribeWithMeetingData",F.SET_AUDIO_MIDCALL_CONFIG_JSON="SetAudioMidcallConfigJon",F.GET_TECHNICAL_INFORMATION_JSON="getTechnicalInformationJson",F.UPDATE_MEETING_GROUPS="UpdateMeetingGroups",F.ADD_BROADCAST_MODALITY="AddBroadcastModality",F.UPDATE_MEETING_LIVE_STATE="UpdateMeetingLiveState",F.SET_MEETING_LAYOUT="SetMeetingLayout",F.UPDATE_PARTICIPANT_INTERPRETATION_STATE="UpdateParticipantInterpretationState",F.JOIN_MEETING_GROUP="JoinMeetingGroup",F.LEAVE_MEETING_GROUP="LeaveMeetingGroup",F.SEND_MESSAGES="SendMessages"}(B.CALL_OPERATIONS||(B.CALL_OPERATIONS={})),function(F){F.NOT_SUPPORTED_IN_STREAMING_MODE="NOT_SUPPORTED_IN_STREAMING_MODE",F.NOT_SUPPORTED_IN_E2EE="NOT_SUPPORTED_IN_E2EE"}(B.OPERATION_TAGS||(B.OPERATION_TAGS={})),function(F){F.CALL_START_OR_JOIN_INITIATED="_CallStartOrJoinInitiated",F.INCOMING_INITIALIZE="_IncomingInitialize",F.CALL_ENDED="_CallEnded",F.RECONNECT="_Reconnect",F.RENEGOTIATE="_Renegotiate",F.RENEGOTIATE_OUTGOING="_RenegotiateOutgoing",F.RENEGOTIATE_INCOMING="_RenegotiateIncoming",F.COMPLETE_NEGOTIATION_FAILED="_CompleteNegotiationFailed",F.UPDATE_LOCAL_MEDIA_STATUS="_UpdateLocalMediaStatus",F.START_PREVIEW_VIDEO="_StartPreviewVideo",F.START_LOCAL_VIDEO="_StartLocalVideo",F.SET_LOCAL_VIDEO="_SetLocalVideo",F.SET_LOCAL_AUDIO="_SetLocalAudio",F.CALL_TRANSFER_IN_PROGRESS="_CallTransferInProgress",F.CALL_REDIRECT_IN_PROGRESS="_CallRedirectInProgress",F.ON_TRANSFER_REQUESTED="_OnTransferRequested",F.ON_TRANSFER_REQUESTED_INVALID="_OnTransferRequestedInvalid",F.ON_INCOMING_CALL_REPLACEMENT="_onIncomingCallReplacement",F.GET_CALL_REPLACEMENT_DETAILS="_GetCallReplacementDetails",F.SET_CALL_STATE="_SetCallState",F.SET_TRANSFER_STATE="_SetTransferState",F.SET_PARK_STATE="_SetParkState",F.SET_MUTED="_SetMuted",F.SET_MUTED_SPEAKER="_SetMutedSpeaker",F.SET_SCREEN_SHARING="_SetScreenSharing",F.SET_CALL_ORIGIN="_SetCallOrigin",F.CONNECT_CALL="_ConnectCall",F.WAIT_FOR_ANSWER="_WaitForAnswer",F.MEDIA_ACKNOWLEDGMENT="_MediaAcknowledgment",F.SIGNALING_STATE_CHANGED="_SignalingStateChanged",F.CALL_TERMINATION_INFO="_CallTerminationInfo",F.MEDIA_WHITELISTING_ISSUE_DETECTED="_MediaWhiteListingIssueDetected",F.CALL_ESCALATED_TO_CONFERENCE="_CallEscalatedToConference",F.WEB_ON_OFFER="_WebOnOffer",F.WEB_ON_ANSWER="_WebOnAnswer",F.WEB_ON_RETARGET_SUCCESS="_WebRetargetSuccess",F.WEB_ON_RETARGET_FAILURE="_WebRetargetFailure",F.WEB_ON_ESCALATION_SUCCESS="_WebOnEscalationSuccess",F.WEB_ON_ESCALATION_FAILURE="_WebOnEscalationFailure",F.CALL_USES_MIXER="_CallUsesMixer",F.ESCALATION_IN_PROGRESS="_EscalationInProgress",F.ESCALATION_COMPLETED="_EscalationCompleted",F.ELECTRON_WAIT_FOR_HANDLE_PUSH="_ElectronWaitForHandlePush",F.ELECTRON_WAIT_FOR_RINGING="_ElectronWaitForRinging",F.ELECTRON_START_SCREEN_SHARING="_ElectronStartScreenSharing",F.ELECTRON_STOP_SCREEN_SHARING="_ElectronStopScreenSharing",F.ELECTRON_SLIMCORE_READY="_ElectronSlimcoreReady",F.ELECTRON_DATA_CHANNEL_CREATED="_ElectronDataChannelCreated",F.ELECTRON_ATTACH_SLIMCORE_CALL="_ElectronAttachSlimcoreCall",F.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED="_ElectronAttachSlimcoreCallFailed",F.ELECTRON_LEAVE_CALL="_ElectronLeaveCall",F.PROCESS_CALL_START_OPTIONS="_ProcessCallStartOptions",F.CALL_MODE_CHANGED="_CallModeChanged",F.UPDATE_MEETING_GROUPS_DETAILS="_UpdateMeetingGroupDetails",F.PROMOTION_TO_REALTIME="_PromotionToRealtime"}(B.CALL_OPERATIONS_INTERNAL||(B.CALL_OPERATIONS_INTERNAL={})),function(F){F.CCWM="CCWM",F.ENCRYPTED="Encrypted",F.LWJ="LWJ",F.PREHEAT="Preheat",F.MULTIPLEVIDEOS="MultipleVideos",F.SPECIFIED="Specified",F.ALL="All",F.NONE="None"}(B.OPERATION_VARIANTS||(B.OPERATION_VARIANTS={})),function(F){F.AUDIO_QUALITY_CHANGED="AudioQualityChanged",F.SESSION_ERROR="SessionError",F.NEGOTIATION_REQUIRED="NegotiationRequired",F.OUTGOING_NEGOTIATION_FAILURE="OutgoingNegotiationFailure",F.INCOMING_NEGOTIATION_FAILURE="IncomingNegotiationFailure",F.NEGOTIATION_FATAL_ERROR="NegotiationFatalError",F.NEGOTIATION_COMPLETION="NegotiationCompletion",F.AUDIO_STATE_CHANGED="AudioStateChanged",F.INCOMPATIBLE_OFFER="IncompatibleOffer",F.NEW_OFFER_FAILED="NewOfferFailed",F.CREATING_CONFERENCE="CreatingConference",F.CREATED_CONFERENCE="CreatedConference"}(B.MEDIA_EVENT||(B.MEDIA_EVENT={})),function(F){F.ADD_PARTICIPANT="AddParticipant",F.REMOVE_PARTICIPANT="RemoveParticipant",F.ADMIT_PARTICIPANT="AdmitParticipant",F.CALL_ME_BACK="CallMeBack",F.ADD_PARTICIPANTS="AddParticipants",F.SEARCH_PARTICIPANTS="SearchParticipants",F.GET_ALL_PARTICIPANTS="GetALLParticipants"}(B.PARTICIPANT_OPERATIONS||(B.PARTICIPANT_OPERATIONS={})),function(F){F.SET_PARTICIPANT_STATE_INVALID="_SetParticipantStateInvalid",F.UPDATE_LOCAL_PARTICIPANT_STREAM="_UpdateLocalParticipantStream",F.PARTICIPANT_JOINED="_ParticipantJoined",F.SELF_PARTICIPANT_UPDATED="_SelfParticipantUpdated"}(B.PARTICIPANT_OPERATIONS_INTERNAL||(B.PARTICIPANT_OPERATIONS_INTERNAL={})),function(F){F.START_CONTENT_SHARING="StartContentSharing",F.STOP_CONTENT_SHARING="StopContentSharing",F.JOIN_CONTENT_SHARING="JoinContentSharing",F.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",F.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",F.UPDATE_PARTICIPANT_STATE="UpdateParticipantState"}(B.CONTENT_SHARING_OPERATIONS||(B.CONTENT_SHARING_OPERATIONS={})),function(F){F.SET_CONTENT_SHARING_STATUS="_SetContentSharingStatus"}(B.CONTENT_SHARING_OPERATIONS_INTERNAL||(B.CONTENT_SHARING_OPERATIONS_INTERNAL={})),function(F){F.INITIALIZE="Initialize",F.LOGOUT="Logout",F.GET_CALL_STATE="GetCallState"}(B.CALL_REGISTRY_OPERATIONS||(B.CALL_REGISTRY_OPERATIONS={})),B.TELEMETRY_EVENT_NAMES={CALL_SETUP_NATIVE:"skypecosi_concore_native_ts_calling_call_setup_session",CALL_IN_CALL_NATIVE:"skypecosi_concore_native_ts_calling_in_call_session",REGISTRY_WEB:"skypecosi_concore_web_ts_calling_registry",REGISTRY_NATIVE:"skypecosi_concore_native_ts_calling_registry"},B.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12",SERVER_HOLD:"*13"},function(F){F[F.SUCCESS=0]="SUCCESS",F[F.FORBIDDEN=403]="FORBIDDEN",F[F.INVALID_PARTICIPANT=406]="INVALID_PARTICIPANT",F[F.CLIENT_ERROR=499]="CLIENT_ERROR",F[F.SIGNALING_ERROR=599]="SIGNALING_ERROR"}(B.TRANSACTION_END_CODE||(B.TRANSACTION_END_CODE={})),function(F){F[F.LOCAL_REJECT=0]="LOCAL_REJECT",F[F.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",F[F.UNMUTE_ERROR=3124]="UNMUTE_ERROR",F[F.TRANSACTION_NOT_ALLOWED=3548]="TRANSACTION_NOT_ALLOWED",F[F.INVALID_ARGUMENT=3549]="INVALID_ARGUMENT",F[F.CANNOT_PARSE_RESULT=3550]="CANNOT_PARSE_RESULT",F[F.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE=3551]="TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE",F[F.INVITE_FAILURE=5201]="INVITE_FAILURE",F[F.NOT_IN_LOBBY=3552]="NOT_IN_LOBBY",F[F.LEFT_LOBBY=3553]="LEFT_LOBBY",F[F.DENIED_IN_LOBBY=3554]="DENIED_IN_LOBBY",F[F.TIMED_OUT_IN_LOBBY=3555]="TIMED_OUT_IN_LOBBY",F[F.TRANSACTION_NOT_ALLOWED_FOR_E2EE=3556]="TRANSACTION_NOT_ALLOWED_FOR_E2EE"}(B.TRANSACTION_END_SUBCODE||(B.TRANSACTION_END_SUBCODE={})),function(F){F.TRANSACTION_COMPLETE="TransactionComplete",F.TRANSACTION_ALLOWED="TransactionAllowed",F.TRANSACTION_DISALLOWED="TransactionDisallowed",F.UNKNOWN="Unknown",F.STACK_NOT_INTIALIZED="Stack not intialized yet",F.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE="TransactionNotAllowedForStreamMode",F.TRANSACTION_NOT_ALLOWED_FOR_E2EE="TransactionNotAllowedForE2EE",F.NOT_IN_LOBBY="Participant is not in lobby state",F.NOT_IMPLEMENTED="Not implemented"}(B.TRANSACTION_END_PHRASE||(B.TRANSACTION_END_PHRASE={})),B.EMPTY_COUNTS={totalParticipants:0,preheatedParticipants:0,lobbyParticipants:0,totalPresenters:0,requestingAttentionPresenters:0,totalAttendees:0,requestingAttentionAttendees:0,overflowAttendees:0}},function(F,B,G){G.d(B,"a",(function(){return Y})),G.d(B,"b",(function(){return doPerf})),G.d(B,"c",(function(){return getGblPerfMgr}));var W=G(7),z=G(0),K="ctx",J=null,Q=function(){function PerfEvent(F,B,G){var W,J=this,Q=!1;(J.start=Object(z.f)(),J.name=F,J.isAsync=G,J.isChildEvt=function(){return!1},Object(z.o)(B))&&(Q=Object(z.y)(J,"payload",(function(){return!W&&Object(z.o)(B)&&(W=B(),B=null),W})));J.getCtx=function(F){return F?F===PerfEvent.ParentContextKey||F===PerfEvent.ChildrenContextKey?J[F]:(J[K]||{})[F]:null},J.setCtx=function(F,B){if(F)if(F===PerfEvent.ParentContextKey)J[F]||(J.isChildEvt=function(){return!0}),J[F]=B;else if(F===PerfEvent.ChildrenContextKey)J[F]=B;else{(J[K]=J[K]||{})[F]=B}},J.complete=function(){var F=0,G=J.getCtx(PerfEvent.ChildrenContextKey);if(Object(z.k)(G))for(var W=0;W<G.length;W++){var K=G[W];K&&(F+=K.time)}J.time=Object(z.f)()-J.start,J.exTime=J.time-F,J.complete=function(){},!Q&&Object(z.o)(B)&&(J.payload=B())}}return PerfEvent.ParentContextKey="parent",PerfEvent.ChildrenContextKey="childEvts",PerfEvent}(),Y=function(){function PerfManager(F){this.ctx={},Object(W.a)(PerfManager,this,(function(B){B.create=function(F,B,G){return new Q(F,B,G)},B.fire=function(B){B&&(B.complete(),F&&Object(z.o)(F.perfEvent)&&F.perfEvent(B))},B.setCtx=function(F,G){F&&((B[K]=B[K]||{})[F]=G)},B.getCtx=function(F){return(B[K]||{})[F]}}))}return PerfManager}(),$="CoreUtils.doPerf";function doPerf(F,B,G,W,K){if(F){var J=F;if(Object(z.o)(J.getPerfMgr)&&(J=J.getPerfMgr()),J){var Y=void 0,X=J.getCtx($);try{if(Y=J.create(B(),W,K)){if(X&&Y.setCtx&&(Y.setCtx(Q.ParentContextKey,X),X.getCtx&&X.setCtx)){var Z=X.getCtx(Q.ChildrenContextKey);Z||(Z=[],X.setCtx(Q.ChildrenContextKey,Z)),Z.push(Y)}return J.setCtx($,Y),G(Y)}}catch(F){Y&&Y.setCtx&&Y.setCtx("exception",F)}finally{Y&&J.fire(Y),J.setCtx($,X)}}}return G()}function getGblPerfMgr(){return J}},function(F,B,G){G.d(B,"b",(function(){return te})),G.d(B,"c",(function(){return safeGetLogger})),G.d(B,"a",(function(){return ne}));var W=G(20),z=G(11),K=G(7),J=G(0),Q=G(66),Y="AI (Internal): ",$="AI: ",X="AITR_",Z="errorToConsole",ee="warnToConsole";function _sanitizeDiagnosticText(F){return F?'"'+F.replace(/\"/g,"")+'"':""}function _logToConsole(F,B){var G=Object(z.b)();if(G){var W="log";G[F]&&(W=F),Object(J.o)(G[W])&&G[W](B)}}var te=function(){function _InternalLogMessage(F,B,G,W){void 0===G&&(G=!1);var K=this;K.messageId=F,K.message=(G?$:Y)+F;var J="";Object(z.l)()&&(J=Object(z.f)().stringify(W));var Q=(B?" message:"+_sanitizeDiagnosticText(B):"")+(W?" props:"+_sanitizeDiagnosticText(J):"");K.message+=Q}return _InternalLogMessage.dataType="MessageData",_InternalLogMessage}();function safeGetLogger(F,B){return(F||{}).logger||new ne(B)}var ne=function(){function DiagnosticLogger(F){this.identifier="DiagnosticLogger",this.queue=[];var B=0,G={};Object(K.a)(DiagnosticLogger,this,(function(z){function _getConfigValue(B,G){var W=F[B];return Object(J.r)(W)?G:W}function _areInternalMessagesThrottled(){return B>=z.maxInternalMessageLimit()}function _debugExtMsg(B,G){var W=Object(Q.a)(F);W&&W.diagLog&&W.diagLog(B,G)}Object(J.r)(F)&&(F={}),z.consoleLoggingLevel=function(){return _getConfigValue("loggingLevelConsole",0)},z.telemetryLoggingLevel=function(){return _getConfigValue("loggingLevelTelemetry",1)},z.maxInternalMessageLimit=function(){return _getConfigValue("maxMessageLimit",25)},z.enableDebugExceptions=function(){return _getConfigValue("enableDebugExceptions",!1)},z.throwInternal=function(F,B,K,Q,Y){void 0===Y&&(Y=!1);var $=new te(B,K,Y,Q);if(z.enableDebugExceptions())throw $;var X=F===W.a.CRITICAL?Z:ee;if(Object(J.x)($.message))_debugExtMsg("throw"+(F===W.a.CRITICAL?"Critical":"Warning"),$);else{var ne=z.consoleLoggingLevel();if(Y){var ie=+$.messageId;!G[ie]&&ne>=F&&(z[X]($.message),G[ie]=!0)}else ne>=F&&z[X]($.message);z.logInternalMessage(F,$)}},z.warnToConsole=function(F){_logToConsole("warn",F),_debugExtMsg("warning",F)},z.errorToConsole=function(F){_logToConsole("error",F),_debugExtMsg("error",F)},z.resetInternalMessageCount=function(){B=0,G={}},z.logInternalMessage=function(F,K){if(!_areInternalMessagesThrottled()){var J=!0,Q=X+K.messageId;if(G[Q]?J=!1:G[Q]=!0,J&&(F<=z.telemetryLoggingLevel()&&(z.queue.push(K),B++,_debugExtMsg(F===W.a.CRITICAL?"error":"warn",K)),B===z.maxInternalMessageLimit())){var Y="Internal events throttle limit per PageView reached for this app.",$=new te(W.b.MessageLimitPerPVExceeded,Y,!1);z.queue.push($),F===W.a.CRITICAL?z.errorToConsole(Y):z.warnToConsole(Y)}}}}))}return DiagnosticLogger}()},,function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.getSharingParticipantLeg=B.getParticipantIdForSourceId=B.getSourceId=B.getSourceIdForMediaType=B.hasStagingGroup=B.findParticipantUsingParticipantLegId=void 0;var z=G(58),K=G(59);function hasParticipantLegId(F,B){var G,W,z;return null!==(z=null===(W=null===(G=F.endpoints)||void 0===G?void 0:G.endpointDetails)||void 0===W?void 0:W.some((function(F){return F.participantId===B})))&&void 0!==z&&z}function findParticipantUsingParticipantLegId(F,B){return F.participants.find((function(F){return hasParticipantLegId(F,B)}))}function hasStagingGroup(F){var B;return!!(null===(B=null==F?void 0:F.meetingGroupDetails)||void 0===B?void 0:B.groups)&&Object.keys(F.meetingGroupDetails.groups).some((function(F){return"stagingGroup"===F}))}function getSourceIdForMediaType(F,B){var G,J,Q,Y,$=-1;try{if(F.endpoints)try{e:for(var X=W(F.endpoints.endpointDetails),Z=X.next();!Z.done;Z=X.next()){var ee=Z.value;if(null!==ee&&void 0!==ee.mediaStreams)try{for(var te=(Q=void 0,W(ee.mediaStreams)),ne=te.next();!ne.done;ne=te.next()){var ie=ne.value;if(K.mapMediaTypeStringToMediaType(ie.type)===B){$=ie.sourceId;break e}}}catch(F){Q={error:F}}finally{try{ne&&!ne.done&&(Y=te.return)&&Y.call(te)}finally{if(Q)throw Q.error}}else $=z.DATA_SOURCE_ID_ANY}}catch(F){G={error:F}}finally{try{Z&&!Z.done&&(J=X.return)&&J.call(X)}finally{if(G)throw G.error}}}catch(F){return-1}return $}function getSourceId(F,B,G){if(!F||!F.endpoints)return-1;var W=F.endpoints.endpointDetails.find((function(F){return(null==F?void 0:F.participantId)===B}));if(!W)return getSourceIdForMediaType(F,G);if(!W.mediaStreams)return getSourceIdForMediaType(F,G);var z=W.mediaStreams.find((function(F){var B=F.type;return K.mapMediaTypeStringToMediaType(B)===G}));return z?z.sourceId:-1}function getParticipantIdForSourceId(F,B,G){var z,J,Q,Y,$;try{if(!F.endpoints)return;try{for(var X=W(F.endpoints.endpointDetails),Z=X.next();!Z.done;Z=X.next()){var ee=Z.value;if(null==ee?void 0:ee.mediaStreams)try{for(var te=(Q=void 0,W(ee.mediaStreams)),ne=te.next();!ne.done;ne=te.next()){var ie=ne.value;if(G===ie.sourceId&&K.mapMediaTypeStringToMediaType(ie.type)===B)return null!==($=ee.participantId)&&void 0!==$?$:null}}catch(F){Q={error:F}}finally{try{ne&&!ne.done&&(Y=te.return)&&Y.call(te)}finally{if(Q)throw Q.error}}}}catch(F){z={error:F}}finally{try{Z&&!Z.done&&(J=X.return)&&J.call(X)}finally{if(z)throw z.error}}return}catch(F){return}}function isScreenSharerStream(F){return"sendonly"===F.direction&&"applicationsharing-video"===F.label}function getSharingParticipantLeg(F){var B,G;if(null===(B=F.endpoints)||void 0===B?void 0:B.endpointDetails)return 1===F.endpoints.endpointDetails.length?F.endpoints.endpointDetails[0].participantId:null===(G=F.endpoints.endpointDetails.find((function(F){var B;return null===(B=null==F?void 0:F.mediaStreams)||void 0===B?void 0:B.some(isScreenSharerStream)})))||void 0===G?void 0:G.participantId}B.findParticipantUsingParticipantLegId=findParticipantUsingParticipantLegId,B.hasStagingGroup=hasStagingGroup,B.getSourceIdForMediaType=getSourceIdForMediaType,B.getSourceId=getSourceId,B.getParticipantIdForSourceId=getParticipantIdForSourceId,B.getSharingParticipantLeg=getSharingParticipantLeg},function(F,B,G){var W=G(286),z=G(287);B.write=z,B.parse=W.parse,B.parseParams=W.parseParams,B.parseFmtpConfig=W.parseFmtpConfig,B.parsePayloads=W.parsePayloads,B.parseRemoteCandidates=W.parseRemoteCandidates,B.parseImageAttributes=W.parseImageAttributes,B.parseSimulcastStreamList=W.parseSimulcastStreamList},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.FormatParameters=void 0;var W=G(1),z=function(){function FormatParameters(F){var B=this;this.parameters={},F&&F.split(";").forEach((function(F){var G=F.split("=");B.parameters[G[0]]=G[1]}))}return FormatParameters.prototype.setIfMissing=function(F,B){this.contains(F)||(this.parameters[F]=B)},FormatParameters.prototype.removeIfPresent=function(F){this.contains(F)&&delete this.parameters[F]},FormatParameters.prototype.get=function(F){return this.parameters[F]},FormatParameters.prototype.names=function(){return Object.keys(this.parameters)},FormatParameters.prototype.contains=function(F){return this.parameters.hasOwnProperty(F)},FormatParameters.prototype.toString=function(){var F="";return W.forOwn(this.parameters,(function(B,G){F+=(F?";":"")+G,void 0!==B&&(F+="=".concat(B))})),F},FormatParameters}();B.FormatParameters=z,B.default={build:function(F){return new z(F)}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.build=B.Stopwatch=void 0;var W=function(){function Stopwatch(){var F=this;this.msElapsed=0,this.isPaused=!1,this.startTime=(new Date).getTime(),this.pause=function(){F.isPaused||(F.msElapsed+=(new Date).getTime()-F.startTime,F.isPaused=!0)},this.resume=function(){F.isPaused&&(F.isPaused=!1,F.startTime=(new Date).getTime())},this.duration=function(){return F.isPaused?F.msElapsed:F.msElapsed+(new Date).getTime()-F.startTime},this.durationInMinutes=function(){var B=F.duration()/6e4;return Math.ceil(B)},this.durationInSeconds=function(){var B=F.duration()/1e3;return Math.ceil(B)}}return Stopwatch}();function build(){return new W}B.Stopwatch=W,B.build=build},function(F,B){var G;G=function(){return this}();try{G=G||new Function("return this")()}catch(F){"object"==typeof window&&(G=window)}F.exports=G},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.UntilFullStatsBuffer=B.SlidingWindow=B.StatsBuffer=void 0;var K=function(){function StatsBuffer(F){this.size=F,this.items=[]}return StatsBuffer.prototype.clear=function(){this.items=[]},StatsBuffer}();B.StatsBuffer=K;var J=function(F){function SlidingWindow(){return null!==F&&F.apply(this,arguments)||this}return z(SlidingWindow,F),Object.defineProperty(SlidingWindow.prototype,"isFull",{get:function(){return this.items.length>=this.size},enumerable:!1,configurable:!0}),SlidingWindow.prototype.add=function(F){return this.isFull&&this.items.shift(),this.items.push(F),!0},SlidingWindow}(K);B.SlidingWindow=J;var Q=function(F){function UntilFullStatsBuffer(){return null!==F&&F.apply(this,arguments)||this}return z(UntilFullStatsBuffer,F),UntilFullStatsBuffer.prototype.add=function(F){return!(this.items.length>=this.size)&&(this.items.push(F),!0)},UntilFullStatsBuffer}(K);B.UntilFullStatsBuffer=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});function asap(F){return new Promise((function(B){B(F())}))}Object.defineProperty(B,"__esModule",{value:!0}),B.timeout=B.delay=B.defer=B.Timer=B.TimeoutError=B.asap=void 0,B.asap=asap;var K=function(F){function TimeoutError(){return null!==F&&F.apply(this,arguments)||this}return z(TimeoutError,F),TimeoutError}(Error);B.TimeoutError=K;var J=function(){function Timer(F){this.ontimeout=F,this.active=!1}return Object.defineProperty(Timer.prototype,"isActive",{get:function(){return this.active},enumerable:!1,configurable:!0}),Timer.prototype.start=function(F){var B=this;void 0!==this.timeoutId&&this.stop(),this.timeoutId=setTimeout((function(){B.ontimeout(),B.active=!1}),F),this.active=!0},Timer.prototype.stop=function(){clearTimeout(this.timeoutId),this.timeoutId=void 0,this.active=!1},Timer}();function defer(){var F,B,G=!0;return{isPending:function(){return G},promise:new Promise((function(G,W){F=G,B=W})),resolve:function(B){G&&(F(B),G=!1)},reject:function(F){G&&(B(F),G=!1)}}}function delay(F){return new Promise((function(B){return setTimeout(B,F)}))}function timeout(F,B,G,W){var z,K=[F,new Promise((function(F,W){z=setTimeout(W.bind(null,new Error("Promise timed out ".concat(G?": ".concat(G):""," after ").concat(B," ms"))),B)}))];W&&K.push(W);var J=Promise.race(K),always=function(){z&&clearTimeout(z)};return J.then(always,always),J}B.Timer=J,B.defer=defer,B.delay=delay,B.timeout=timeout},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MediaSourceIdentifiers=void 0;var W=function(){function MediaSourceIdentifiers(){}return MediaSourceIdentifiers.SourceNone=-1,MediaSourceIdentifiers.SourceAny=-2,MediaSourceIdentifiers}();B.MediaSourceIdentifiers=W},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.sequentialize=void 0;var sequentialize=function(){return function(F,B,G){var K=G.value;return G.value=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B];return this.serialQueue.add(K.bind.apply(K,z([this],W(F),!1)))},G}};B.sequentialize=sequentialize},function(F,B,G){G.d(B,"b",(function(){return W})),G.d(B,"a",(function(){return z}));var W="iKey",z="extensionConfig"},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.calculateJoinedFromForTelemetry=B.getEndpointInformationForTelemetry=B.CallTelemetry=B.CallRegistryTelemetry=B.TelemetryUtilities=B.SELF_PARTICIPANT_ROLE=B.DIRECTION=B.RESULT_VALUE=B.CALL_TERMINATING_END=void 0;var K,J,Q=G(31),Y=G(13),$=G(14),X=G(17),Z=G(32),ee=150;!function(F){F.Pending="Pending",F.Success="Success",F.Failure="Failure",F.Timeout="Timeout"}(K||(K={})),function(F){F[F.Event=0]="Event",F[F.Operation=1]="Operation"}(J||(J={}));var te,ne=function(){function Event(F,B,G,W,z){this.eventName=F,this.eventStartTime=B,this.type=G,this.causeId=W,this.status=K.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.type===J.Event&&delete this.status,z&&this.data.push(z)}return Object.defineProperty(Event.prototype,"variant",{set:function(F){this.eventVariant=F},enumerable:!1,configurable:!0}),Event.prototype.recordSuccess=function(F,B){this.recordResult(K.Success,F,B)},Event.prototype.recordFailure=function(F,B){this.recordResult(K.Failure,F,B)},Event.prototype.recordTimeout=function(F,B){this.recordResult(K.Timeout,F,B)},Event.prototype.addData=function(F){this.data.push(F)},Event.prototype.isPending=function(){return this.status===K.Pending},Event.prototype.getEvent=function(){var F,B=this,G={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,causeId:this.causeId,resultCauseId:this.resultCauseId,variant:this.eventVariant,data:this.data.map((function(F){return B.prepareData(F,!0)})).filter((function(F){return!!F}))};return this.type===J.Event&&delete G.status,G.data.length||delete G.data,G.causeId||delete G.causeId,G.resultCauseId||delete G.resultCauseId,G.result||delete G.result,G.variant||delete G.variant,(F={})[this.eventName]=G,F},Event.prototype.recordResult=function(F,B,G){this.status=F,this.result=this.prepareData(B),this.causeId!==G&&(this.resultCauseId=G),this.duration=(new Date).getTime()-this.eventStartTimestamp},Event.prototype.prepareData=function(F,B){if(void 0===B&&(B=!1),null==F)return"";if("string"==typeof F)return(0,X.scrubMriOrOmit)(F);if("number"==typeof F||"boolean"==typeof F)return String(F);if("function"==typeof F)return"";if(F instanceof Error)return F.toString();try{return Object.keys(F).length?B?F:(0,$.getPIISafeObject)(F):""}catch(F){return"invalid"}},Event}();!function(F){F.LOCAL="Local",F.REMOTE="Remote"}(B.CALL_TERMINATING_END||(B.CALL_TERMINATING_END={})),function(F){F.SUCCESS="Success",F.FAILURE="Failure"}(B.RESULT_VALUE||(B.RESULT_VALUE={})),function(F){F.INCOMING="Incoming",F.OUTGOING="Outgoing"}(B.DIRECTION||(B.DIRECTION={})),function(F){F.CALLER="caller",F.CALLEE="callee",F.JOIN="join",F.SUBSCRIBE="SUBSCRIBE"}(B.SELF_PARTICIPANT_ROLE||(B.SELF_PARTICIPANT_ROLE={})),function(F){F.SUCCESS="Success",F.FAILURE="Failure",F.TIMEOUT="Timeout"}(te||(te={}));var ie=function(){function TelemetryUtilities(F,B,G){this.logger=F,this.startTime=B,this.maxEventsExceeded=G,this.recordedEvents=[],this.ongoingOperations={}}return TelemetryUtilities.prototype.recordEvent=function(F,B,G){void 0===G&&(G=(0,Y.generateCauseId)()),this.logger.debug("Event:",F,Q.pii.Omit(B));var W=new ne(F,this.getEventStartTime(),J.Event,G,B);return this.pushToRecordedEvents(W),W},TelemetryUtilities.prototype.recordOperationSuccess=function(F,B,G,W,z){void 0===B&&(B=null),this.logger.info("Event success:",W,F,Q.pii.Omit(G),Q.pii.Omit(B)),this.recordOperationResult(F,B,te.SUCCESS,G,W,z)},TelemetryUtilities.prototype.recordOperationFailure=function(F,B,G,W,z){this.logger.info("Event failure:",F,Q.pii.Omit(G),B),this.recordOperationResult(F,B,te.FAILURE,G,W,z)},TelemetryUtilities.prototype.recordOperationTimeout=function(F,B,G,W,z){this.logger.info("Event timeout:",F,Q.pii.Omit(G),B),this.recordOperationResult(F,B,te.TIMEOUT,G,W,z)},TelemetryUtilities.prototype.maybeRecordOperationSuccess=function(F,B,G,W,z){void 0===B&&(B=null),this.hasOngoingEvent(F,G)&&this.recordOperationSuccess(F,B,G,W,z)},TelemetryUtilities.prototype.maybeRecordOperationFailure=function(F,B,G,W,z){this.hasOngoingEvent(F,G)&&this.recordOperationFailure(F,B,G,W,z)},TelemetryUtilities.prototype.maybeRecordOperationTimeout=function(F,B,G,W,z){this.hasOngoingEvent(F,G)&&this.recordOperationTimeout(F,B,G,W,z)},TelemetryUtilities.prototype.recordOperationResult=function(F,B,G,W,z,K){this.hasOngoingEvent(F,W)||this.recordOperation(F,z,W);var J=this.ongoingOperations[F];switch(W&&(J=J[W]),K&&J.addData(K),G){case te.SUCCESS:J.recordSuccess(B,z);break;case te.FAILURE:J.recordFailure(B,z);break;case te.TIMEOUT:J.recordTimeout(B,z);break;default:this.logger.error("Unknown operation record state in record operation result.")}W?delete this.ongoingOperations[F][W]:delete this.ongoingOperations[F]},TelemetryUtilities.prototype.recordOperation=function(F,B,G,W){this.logger.debug("Event create:",B,F,Q.pii.Omit(G),W);var z=new ne(F,this.getEventStartTime(),J.Operation,B,W);return this.ongoingOperations[F]||(this.ongoingOperations[F]={}),G?this.ongoingOperations[F][G]=z:this.ongoingOperations[F]=z,this.pushToRecordedEvents(z),z},TelemetryUtilities.prototype.setOperationVariant=function(F,B,G){var W;(W=G?this.ongoingOperations[F][G]:this.ongoingOperations[F])?W.variant=B:this.logger.error("Could not find operation ".concat(F," to set variant ").concat(B))},TelemetryUtilities.prototype.updateOperationData=function(F,B,G,W){try{if(!this.ongoingOperations[F])return void this.recordEvent(F,B,G);W?this.ongoingOperations[F][W]&&this.ongoingOperations[F][W].addData(B):this.ongoingOperations[F].addData(B)}catch(B){return void this.logger.info("Unable to update operation: ".concat(F," data"))}},TelemetryUtilities.prototype.pushToRecordedEvents=function(F){this.maxEventsExceeded&&this.maxEventsExceeded()&&this.recordedEvents.shift(),this.recordedEvents.push(F)},TelemetryUtilities.prototype.hasOngoingEvent=function(F,B){return this.ongoingOperations[F]?!(B&&!this.ongoingOperations[F][B])||(this.logger.warn("Unable to find event for name\\id ".concat(F,"\\").concat(Q.pii.Omit(B))),!1):(this.logger.warn("Unable to find event for name ".concat(F)),!1)},TelemetryUtilities.prototype.getEventStartTime=function(){return(new Date).getTime()-this.startTime},TelemetryUtilities.prototype.getEventTimestampBag=function(F,B){var G=B?[B.getEvent()]:this.recordedEvents.filter((function(B){return!F||!B.isPending()})).map((function(F){return F.getEvent()})),W=JSON.stringify({eventStart:this.startTime,events:G});return this.logger.info("Call eventTimestampBag ".concat(Q.pii.Omit(W))),W},TelemetryUtilities.prototype.removeRecordedEvent=function(F){var B=this.recordedEvents.indexOf(F);B>-1&&this.recordedEvents.splice(B,1)},TelemetryUtilities}();B.TelemetryUtilities=ie;var re=function(F){function CallRegistryTelemetry(B,G){var W=F.call(this,B,G,(function(){return W.recordedEvents.length>ee}))||this;return W.getHostName=function(){try{return"localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost":"<redacted>"}catch(F){return"unknown"}},W.tsCallingVersion=(0,Z.getTsCallingVersion)(),W.logger=B.createChild("CallRegistryTelemetry"),W}return z(CallRegistryTelemetry,F),CallRegistryTelemetry.prototype.setEndpointId=function(F){this.endpointId=F},CallRegistryTelemetry.prototype.setSkypeId=function(F){this.skypeId=F},CallRegistryTelemetry.prototype.setApplicationType=function(F){this.applicationType=F},CallRegistryTelemetry.prototype.setRing=function(F){this.ring=F},CallRegistryTelemetry.prototype.setTenantId=function(F){this.tenantId=F},CallRegistryTelemetry.prototype.setUserHexCID=function(F){this.userHexCID=F},CallRegistryTelemetry.prototype.setAcsResourceId=function(F){this.acsResourceId=F},CallRegistryTelemetry.prototype.setRegion=function(F){this.region=F},CallRegistryTelemetry.prototype.setPartition=function(F){this.partition=F},CallRegistryTelemetry.prototype.getEvent=function(F,B){var getValue=function(F){return void 0===F?"":F};return{EndpointId:getValue(this.endpointId),SkypeId:getValue(this.skypeId),ApplicationType:getValue(this.applicationType),Ring:getValue(this.ring),TenantId:getValue(this.tenantId),userHexCID:getValue(this.userHexCID),AcsResourceId:getValue(this.acsResourceId),Region:getValue(this.region),Partition:getValue(this.partition),TsCallingVersion:getValue(this.tsCallingVersion),HostName:this.getHostName(),EventTimestampBag:this.getEventTimestampBag(F,B),DiagnosticInfo:this.callEndDiagnosticInfo}},CallRegistryTelemetry.prototype.removeNonPendingOperations=function(){this.recordedEvents=this.recordedEvents.filter((function(F){return F.isPending()}))},CallRegistryTelemetry}(ie);B.CallRegistryTelemetry=re;var oe=function(F){function CallTelemetry(B,G){var W=F.call(this,B,G,(function(){return W.inCallMode&&W.recordedEvents.length>ee}))||this;return W.inCallMode=!1,W.tsCallingVersion=(0,Z.getTsCallingVersion)(),W.logger=B.createChild("CallTelemetry"),W}return z(CallTelemetry,F),CallTelemetry.prototype.setCallId=function(F){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=F},CallTelemetry.prototype.setConsultativeCallId=function(F){this.consultativeCallId=F},CallTelemetry.prototype.setEndpointId=function(F){this.endpointId=F},CallTelemetry.prototype.setParticipantId=function(F){this.participantId=F},CallTelemetry.prototype.setPreheatFlags=function(F){this.preheatFlags=F},CallTelemetry.prototype.setCallOrigin=function(F){this.origin=F},CallTelemetry.prototype.setGroupId=function(F){this.groupId=F},CallTelemetry.prototype.setThreadId=function(F){this.threadId=F},CallTelemetry.prototype.setMesageId=function(F){this.messageId=F},CallTelemetry.prototype.setSkypeId=function(F){this.skypeId=F},CallTelemetry.prototype.setApplicationType=function(F){this.applicationType=F},CallTelemetry.prototype.setRing=function(F){this.ring=F},CallTelemetry.prototype.setTenantId=function(F){this.tenantId=F},CallTelemetry.prototype.setUserHexCID=function(F){this.userHexCID=F},CallTelemetry.prototype.setAcsResourceId=function(F){this.acsResourceId=F},CallTelemetry.prototype.setRegion=function(F){this.region=F},CallTelemetry.prototype.setPartition=function(F){this.partition=F},CallTelemetry.prototype.setFailureType=function(F){this.failureType=F},CallTelemetry.prototype.setIsCast=function(F){this.isCast=F?"True":"False"},CallTelemetry.prototype.setIsEmergency=function(F){this.isEmergency=F?"True":"False"},CallTelemetry.prototype.setRole=function(F){this.isAnonymous="admin"===F?"False":"True"},CallTelemetry.prototype.setCallType=function(F){this.callType=F},CallTelemetry.prototype.setConversationType=function(F){this.conversationType=F},CallTelemetry.prototype.setDirection=function(F){this.direction=F},CallTelemetry.prototype.setSelfParticipantRole=function(F){this.selfParticipantRole=F},CallTelemetry.prototype.setTerminationState=function(F){this.terminationState=F},CallTelemetry.prototype.setTerminationReason=function(F){this.terminationReason=F},CallTelemetry.prototype.setCallEndDiagnosticInfo=function(F){this.callEndDiagnosticInfo=F},CallTelemetry.prototype.setStackConfig=function(F){this.stackConfig=F},CallTelemetry.prototype.setJoinedFrom=function(F){this.joinedFrom=F},CallTelemetry.prototype.setMeetingCode=function(F){this.meetingCode=F},CallTelemetry.prototype.setMeetingUrl=function(F){this.meetingUrl=F},CallTelemetry.prototype.getEvent=function(F,B){var getValue=function(F){return void 0===F?"":F};return{CorrelationId:getValue(this.currentCallId),PreviousCorrelationId:getValue(this.previousCallId),ConsultativeCallId:getValue(this.consultativeCallId),EndpointId:getValue(this.endpointId),SkypeId:getValue(this.skypeId),ParticipantId:getValue(this.participantId),PreheatFlags:getValue(this.preheatFlags),CallType:getValue(this.callType),ConversationType:getValue(this.conversationType),Direction:getValue(this.direction),Origin:getValue(this.origin),SelfParticipantRole:getValue(this.selfParticipantRole),IsAnonymous:getValue(this.isAnonymous),GroupId:(0,X.scrubMriOrOmit)(getValue(this.groupId)),ThreadId:(0,X.getLoggableThreadId)(getValue(this.threadId)),MessageId:getValue(this.messageId),ApplicationType:getValue(this.applicationType),Ring:getValue(this.ring),TenantId:getValue(this.tenantId),userHexCID:getValue(this.userHexCID),AcsResourceId:getValue(this.acsResourceId),Region:getValue(this.region),Partition:getValue(this.partition),FailureType:getValue(this.failureType),IsCast:getValue(this.isCast),IsEmergency:getValue(this.isEmergency),TsCallingVersion:getValue(this.tsCallingVersion),TerminationState:getValue(this.terminationState),TerminationReason:getValue(this.terminationReason),StackConfig:getValue(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(F,B),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo,JoinedFrom:this.joinedFrom,MeetingCode:this.meetingCode,MeetingUrl:this.meetingUrl}},CallTelemetry.prototype.switchToInCallTelemetry=function(){this.recordedEvents=this.recordedEvents.filter((function(F){return F.isPending()})),this.inCallMode=!0},CallTelemetry.prototype.getHostName=function(){try{return location.host}catch(F){return"unknown"}},CallTelemetry}(ie);B.CallTelemetry=oe;var getEndpointInformationForTelemetry=function(F){return Array.isArray(F)?F.map((function(F){return{endpointId:F.endpointId,participantId:F.participantId}})):null};B.getEndpointInformationForTelemetry=getEndpointInformationForTelemetry;var calculateJoinedFromForTelemetry=function(F,B,G,W,z){if(F){if(F.meetingUrl)return"MeetingUrl";if(F.meetingCode)return"MeetingCode"}return B||G?"ThreadContext":W?"GroupId":z?"Awareness":""};B.calculateJoinedFromForTelemetry=calculateJoinedFromForTelemetry},function(F,B,G){var W,z,K;Object.defineProperty(B,"__esModule",{value:!0}),B.ResultCategory=B.CallAckMediaPhase=B.CallAckSignalingPhase=B.CallSetupMediaPhase=B.CallSetupSignalingPhase=B.RenegotiationPhase=B.jsCallEndPhrase=B.RenegotiationOfferType=B.ParticipantMuteState=B.EnterpisePstnTerminationCode=B.PstnTerminationCode=B.logUploadEvents=B.proxiedEvents=B.incomingCallEvents=B.pstnEnterpriseResponseCodeMap=B.pstnConsumerResponseCodeMap=B.responseCodeMap=B.jsCallEndSubCodes=B.jsCallEndCodes=void 0,B.jsCallEndCodes={Cancel:487,Reject:603,NoNgcEndpoint:480,Forbidden:403,PreconditionFailed:412,Success:0,CallRedirected:302,BadRequest:400,NotFound:404,NotAcceptable:406,Timeout:408,Conflict:409,MediaError:410,ConfParticipantCountLimitReached:413,CallAccepted:450,CallForwarded:451,CallForwardedToVoicemail:452,P2pRejectCall:453,P2pFallbackForScreensharing:460,P2pFallbackDueToGroupCall:461,CallLegEndedOnService:470,CallDoesNotExist:481,NotAcceptableHere:488,NetworkError:490,GlareError:491,SkypeTokenError:495,LocalHttpStackError:496,UnknownError:497,LocalError:498,InternalServerError:500,CallModalityFailure:580,ServiceUnavailable:503},B.jsCallEndSubCodes={Success:0,CallRedirectedSuccess:3020,InsufficientCapabilities:5204,PolicyRestriction:5448,UserBlocked:10005,MaxLobbyParticipantLimitReached:5807,MaxParticipantLimitReached:5808,MaxParticipantLimitReached2:5817,SharingStolenError:10029,DowngradeToStreamingClient:3099,MediaDropDuringConnect:3100,MediaDropAfterConnect:3101,MediaAnswerProcessingError:3102,MediaFinalAnswerProcessingError:3103,MediaOfferTimeout:3104,MediaFinalAnswerTimeout:3105,MediaOfferNull:3106,MediaAudioDeviceError:3107,MediaRenegotiationError:3108,MediaPermissionError:3109,MediaUnknownError:3110,MediaOfferProcessingError:3111,MediaWhiteListingIssue:3112,MediaMuteMicrophoneError:3113,MediaMuteSpeakerError:3114,MediaUnmuteMicrophoneError:3115,MediaUnmuteSpeakerError:3115,AttachActionFailed:4103,AttachFailed:4105,PreheatedCallTimedout:4113,RemovedFromConversation:5e3,DeniedInLobby:5854,RemovedFromCall:5300,TimedOutInLobby:5855,AnonymousJoinDisabledByPolicy:5723,B2bJoinDisabledByPolicy:5724,NoLobbyForBroadcastJoin:5354,NotAllowedDueToInformationBarrier:5810,TeamParkPolicyDisabled:10193,BroadcastLimitReached:800100},B.responseCodeMap=((W={})[B.jsCallEndCodes.Success]=1,W[B.jsCallEndCodes.Cancel]=12,W[B.jsCallEndCodes.Reject]=10,W[B.jsCallEndCodes.NoNgcEndpoint]=2,W[B.jsCallEndCodes.Timeout]=6,W[B.jsCallEndCodes.CallAccepted]=30,W[B.jsCallEndCodes.CallRedirected]=75,W[B.jsCallEndCodes.NotFound]=24,W[B.jsCallEndCodes.CallDoesNotExist]=46,W[B.jsCallEndCodes.NotAcceptable]=5,W[B.jsCallEndCodes.BadRequest]=5,W[B.jsCallEndCodes.MediaError]=4,W[B.jsCallEndCodes.ConfParticipantCountLimitReached]=59,W[B.jsCallEndCodes.CallModalityFailure]=4,W[B.jsCallEndCodes.NetworkError]=3,W[B.jsCallEndCodes.LocalHttpStackError]=31,W[B.jsCallEndCodes.LocalError]=25,W[B.jsCallEndCodes.CallForwarded]=27,W[B.jsCallEndCodes.CallForwardedToVoicemail]=28,W[B.jsCallEndCodes.SkypeTokenError]=29,W[B.jsCallEndCodes.InternalServerError]=7,W[B.jsCallEndCodes.Conflict]=7,W[B.jsCallEndCodes.GlareError]=7,W[B.jsCallEndCodes.CallLegEndedOnService]=7,W[B.jsCallEndCodes.NotAcceptableHere]=26,W[B.jsCallEndCodes.UnknownError]=32,W[B.jsCallEndCodes.Forbidden]=8,W[B.jsCallEndCodes.PreconditionFailed]=65,W),B.pstnConsumerResponseCodeMap=((z={})[9401]=33,z[9422]=33,z[6102]=1,z[6423]=14,z[9402]=14,z[9432]=14,z[6519]=3,z[9403]=15,z[9410]=36,z[9411]=37,z[1e3]=2,z[9407]=17,z[13430]=18,z[6009]=19,z[10484]=19,z[10604]=19,z[10404]=19,z[10420]=19,z[10403]=20,z[17401]=20,z[10408]=9,z[10486]=11,z[10600]=11,z[10686]=11,z[10487]=21,z[10500]=3,z[10501]=3,z[10502]=3,z[10503]=3,z[10504]=3,z[10480]=22,z[10482]=22,z[10603]=10,z[13406]=23,z[13416]=23,z),B.pstnEnterpriseResponseCodeMap=((K={})[500]=39,K[403]=41,K[404]=42,K[480]=40,K),B.incomingCallEvents={INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_PSTN_NGC_CALL:111,INCOMING_SCREENSHARE_WITH_CHAT:119},B.proxiedEvents={SHARED_LINE_CALL_RECORD:121,SHARED_LINE_V2_CALL_RECORD:123},B.logUploadEvents={LOG_UPLOAD_EVENT:120},function(F){F[F.CallTerminationSubCodeSipGWMin=2e5]="CallTerminationSubCodeSipGWMin",F[F.CallTerminationSubCodeSipGWMax=299999]="CallTerminationSubCodeSipGWMax"}(B.PstnTerminationCode||(B.PstnTerminationCode={})),function(F){F[F.CallTerminationSubCodeSipGWMin=4e5]="CallTerminationSubCodeSipGWMin",F[F.CallTerminationSubCodeSipGWMax=499999]="CallTerminationSubCodeSipGWMax"}(B.EnterpisePstnTerminationCode||(B.EnterpisePstnTerminationCode={})),function(F){F[F.Unmuted=0]="Unmuted",F[F.ServerMuted=1]="ServerMuted",F[F.Muted=2]="Muted",F[F.AttemptingUnmute=3]="AttemptingUnmute"}(B.ParticipantMuteState||(B.ParticipantMuteState={})),function(F){F[F.Undefined=0]="Undefined",F[F.Hold=1]="Hold",F[F.Resume=2]="Resume"}(B.RenegotiationOfferType||(B.RenegotiationOfferType={})),B.jsCallEndPhrase={Unknown:"CallEndReasonUnknown",MediaError:"CallEndReasonMediaError",MediaOfferTimeout:"CallEndReasonMediaOfferTimeout",MediaFinalAnswerTimeout:"CallEndReasonMediaFinalAnswerTimeout",MediaAnswerError:"CallEndReasonMediaAnswerError",MediaFinalAnswerError:"CallEndReasonFinalAnswerError",MediaPermissionError:"CallEndReasonMediaPermissionError",MediaRenegotiationError:"CallEndReasonRenegotiationError",MediaDropDuringConnect:"CallEndReasonMediaDropDuringConnectError",MediaDropAfterConnect:"CallEndReasonMediaDropAfterConnectError",MediaOfferProcessingError:"CallEndReasonMediaOfferProcessingError",DowngradeToStreamingClient:"DowngradeToStreamingClient",IncompatibleOffer:"CallEndReasonIncompatibleOffer",MediaWhiteListingIssue:"MediaWhitelistingIssue",AudioDeviceError:"CallEndReasonAudioDeviceError",AttachFailed:"CallEndReasonAttachFailed",BadNotificationPayload:"CallEndReasonBadNotificationPayload",RetargetNotSupported:"RetargetNotSupported",CallEndReasonLocalUserInitiated:"CallEndReasonLocalUserInitiated",EndedByRemoteEndpoint:"EndedByRemoteEndpoint",CallEndReasonRedirected:"CallEndReasonRedirected"},function(F){F.MediaCreateOffer="MediaCreateOffer",F.SignalingStartNegotiation="SignalingStartNegotiation",F.SignalingRenegotiationAnswer="SignalingRenegotiationAnswer",F.MediaProcessAnswer="MediaProcessAnswer",F.MediaProcessOffer="MediaProcessOffer",F.MediaCreateAnswer="MediaCreateAnswer",F.SignalingAcceptRenegotiation="SignalingAcceptRenegotiation",F.SignalingMediaAcknowledgement="SignalingMediaAcknowledgement",F.CompleteNegotiation="CompleteNegotiation"}(B.RenegotiationPhase||(B.RenegotiationPhase={})),function(F){F.GetSignalingMediaTypes="GetSignalingMediaTypes",F.CallStart="CallStart",F.WaitForAnswer="WaitForAnswer",F.WaitForConnect="WaitForConnect",F.Accept="Accept"}(B.CallSetupSignalingPhase||(B.CallSetupSignalingPhase={})),function(F){F.InitializeMediaSession="InitializeMediaSession",F.UpdateMediaModalities="UpdateMediaModalities",F.CreateOffer="CreateOffer",F.CreateAnswer="CreateAnswer",F.ProcessAnswer="ProcessAnswer",F.GetSignalingMediaTypes="GetSignalingMediaTypes",F.MuteUnmute="MuteUnmute",F.MuteUnmuteSpeakers="MuteUnmuteSpeakers",F.StartVideoSafe="StartVideoSafe",F.CompleteNegotiation="CompleteNegotiation",F.MuteInput="MuteInput",F.MuteOutput="MuteOutput",F.UnmuteInput="UnmuteInput",F.UnmuteOutput="UnmuteOutput",F.handleEndpointStatesForAccept="handleEndpointStatesForAccept"}(B.CallSetupMediaPhase||(B.CallSetupMediaPhase={})),function(F){F.ProcessIncomingCallRequest="ProcessIncomingCallRequest",F.ResolvePotentialConflict="ResolvePotentialConflict",F.SendAttach="SendAttach",F.WaitForMediaOffer="WaitForMediaOffer",F.OnAcknowledgeSuccess="OnAcknowledgeSuccess"}(B.CallAckSignalingPhase||(B.CallAckSignalingPhase={})),function(F){F.InitializeMediaSession="InitializeMediaSession",F.ProcessOffer="ProcessOffer",F.ProcessOfferedModalities="ProcessOfferedModalities",F.TrySendingProvisionalAnswer="TrySendingProvisionalAnswer"}(B.CallAckMediaPhase||(B.CallAckMediaPhase={})),function(F){F.Success="Success",F.ExpectedError="ExpectedError",F.UnexpectedClientError="UnexpectedClientError",F.UnexpectedServerError="UnexpectedServerError"}(B.ResultCategory||(B.ResultCategory={}))},function(F,B,G){function generateGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(F){var B=16*Math.random()|0;return("x"===F?B:3&B|8).toString(16)}))}Object.defineProperty(B,"__esModule",{value:!0}),B.default=generateGuid},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.DATA_SOURCE_ID_ANY=B.CONSTANTS=void 0,B.CONSTANTS={CODE:{SUCCESS:0,CLIENT_ERROR_CODE:499},SUB_CODE:{ACTION_NOT_ALLOWED:3548,ABANDONED:4990,ENDED_BY_REMOTE_ENDPOINT:5028,BEACON:4521}},B.DATA_SOURCE_ID_ANY=4294967294},function(F,B,G){function getMediaLabel(F){switch(F){case 0:return"main-audio";case 1:return"main-video";case 2:return"applicationsharing-video";case 3:return"data"}throw new Error("Invalid media type")}function getMediaType(F){switch(F){case"main-audio":return 0;case"main-video":return 1;case"applicationsharing-video":return 2;case"data":return 3}throw new Error("Invalid media label")}function mapMediaTypeStringToMediaType(F){switch(F){case"audio":return 0;case"video":return 1;case"applicationsharing-video":return 2;case"data":return 3;default:return}}Object.defineProperty(B,"__esModule",{value:!0}),B.mapMediaTypeStringToMediaType=B.getMediaType=B.getMediaLabel=void 0,B.getMediaLabel=getMediaLabel,B.getMediaType=getMediaType,B.mapMediaTypeStringToMediaType=mapMediaTypeStringToMediaType},function(F,B,G){var W,z,K,J,Q,Y,$=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.CallTelemetryBuilder=B.LocalStats=B.MediaReceiverStats=B.MediaSenderStats=B.AudioStats=B.MediaModalityStats=B.CallStats=B.Events=B.Props=B.MediaReceiverEvent=B.MediaSenderEvent=B.MediaEvent=B.CallEvent=void 0;var X,Z,ee,te,ne=G(8),ie=G(57),re=G(32);!function(F){F[F.CallStateChanged=0]="CallStateChanged",F[F.TrouterStateChanged=1]="TrouterStateChanged",F[F.MultiPartyModeSet=2]="MultiPartyModeSet",F[F.MediaRetargetSucceeded=3]="MediaRetargetSucceeded",F[F.MediaRetargetFailed=4]="MediaRetargetFailed"}(X=B.CallEvent||(B.CallEvent={})),function(F){F[F.StartModality=0]="StartModality",F[F.StopModality=1]="StopModality",F[F.StreamStateChanged=2]="StreamStateChanged",F[F.NegotiationStateChanged=3]="NegotiationStateChanged"}(Z=B.MediaEvent||(B.MediaEvent={})),function(F){F[F.SelectSource=0]="SelectSource",F[F.AttachSource=1]="AttachSource",F[F.DetachSource=2]="DetachSource"}(ee=B.MediaSenderEvent||(B.MediaSenderEvent={})),function(F){F[F.Available=0]="Available",F[F.Subscribe=1]="Subscribe",F[F.Subscribed=2]="Subscribed",F[F.Unsubscribe=3]="Unsubscribe",F[F.Unsubscribed=4]="Unsubscribed",F[F.RenderingStarted=5]="RenderingStarted",F[F.RenderingStopped=6]="RenderingStopped"}(te=B.MediaReceiverEvent||(B.MediaReceiverEvent={}));var oe=function(){function PiiValue(F,B){this.value=F,this.piiKind=B}return PiiValue}(),ae=function(){function Props(){}return Props.agentEnvironmentId="agent_environment_id",Props.correlationId="CorrelationId",Props.participantId="participant_id",Props.tenantId="TenantId",Props.userHexCID="UserHexCID",Props.acsResourceId="AcsResourceId",Props.endpointId="endpoint_id",Props.mediaLegId="media_leg_id",Props.webMediaConfigIds="web_media_config_ids",Props.tsCallingVersion="ts_calling_version",Props}();B.Props=ae;var se=function(){function Events(){}return Events.diagnostics="MediaDiagnostic",Events.qoeStats="QoE",Events.webrtcSession="webrtc_session",Events.webrtcSessionInitial="webrtc_session_initial",Events.realtimeTelemetry="realtimetelemetry",Events.mediaSession="pluginless_modality_session",Events.callSession="pluginless_call_session",Events}();B.Events=se;var ce=function(){function Stats(F){this.eventName=F,this.ended=!1,this.events=[]}return Stats.prototype.setLocalUserId=function(F){this.localUserId=F},Stats.prototype.start=function(){this.ended||(this.startTime=Date.now())},Stats.prototype.end=function(F){void 0===F&&(F=0),this.ended||(this.ended=!0,this.resultCode=F)},Stats.prototype.asStatsRecord=function(F){var B=this;if(void 0===F&&(F={}),ne.isEmpty(this.events))return null;var G=ne.uniqBy(this.events,(function(F){return JSON.stringify(F)})).map((function(F){var G,W=((G={})[F.type]=F.timestamp-B.startTime,G);return ne.isEmpty(F.data)||(W.data=F.data),W}));return{name:this.eventName,record:ne.assign({LocalUser:this.localUserId,ResultCode:String(this.resultCode),EventTimestampBag:JSON.stringify({eventStart:this.startTime,events:G})},F)}},Stats.prototype.add=function(F){!this.ended&&F.type&&(ne.isUndefined(this.startTime)&&(this.startTime=Date.now()),ne.isUndefined(F.timestamp)&&(F.timestamp=Date.now()),this.events.push(F))},Stats}(),le=function(F){function CallStats(){return F.call(this,se.callSession)||this}return $(CallStats,F),CallStats.prototype.callStateChanged=function(B){F.prototype.add.call(this,{type:X[X.CallStateChanged],data:CallStats.callStateToString[B]||B})},CallStats.prototype.event=function(B){F.prototype.add.call(this,{type:X[B]})},CallStats.callStateToString=((z={})[0]="None",z[1]="Notified",z[2]="Connecting",z[3]="Connected",z[4]="LocalHold",z[5]="RemoteHold",z[6]="Disconnecting",z[7]="Disconnected",z[8]="Observing",z[10]="Lobby",z),CallStats}(ce);B.CallStats=le;var de=function(F){function MediaModalityStats(B,G){var W=F.call(this,se.mediaSession)||this;return W.mediaType=B,W.mediaDirection=G,W.streamDirection=MediaModalityStats.mediaDirectionToStream[W.mediaDirection],W}return $(MediaModalityStats,F),MediaModalityStats.prototype.addEvent=function(B,G){F.prototype.add.call(this,{type:B,data:G})},MediaModalityStats.prototype.lifecycle=function(F){this.addEvent(Z[F])},MediaModalityStats.prototype.streamStateChanged=function(F,B){void 0===B&&(B=this.streamDirection);var G=Z[Z.StreamStateChanged];this.addEvent(G,{state:MediaModalityStats.streamStateToString[F],direction:MediaModalityStats.streamDirectionToString[B]})},MediaModalityStats.prototype.negotiationStateChanged=function(F,B,G){void 0===G&&(G=this.streamDirection);var W=Z[Z.NegotiationStateChanged];this.addEvent(W,{state:MediaModalityStats.negotiationStateToString[F],reason:B})},MediaModalityStats.prototype.asStatsRecord=function(B){return void 0===B&&(B={}),F.prototype.asStatsRecord.call(this,ne.assign({MediaType:MediaModalityStats.mediaTypeToString[this.mediaType],Role:MediaModalityStats.mediaDirectionToRole[this.mediaDirection]},B))},MediaModalityStats.negotiationStateToString={started:"NegotiationStarted",rejected:"NegotiationRejected",completed:"NegotiationCompleted"},MediaModalityStats.streamStateToString={created:"StreamCreated",started:"StreamStarted",active:"StreamActive",inactive:"StreamInactive",stopped:"StreamStopped",removed:"StreamRemoved",failed:"StreamFailed",cancelled:"StreamCancelled"},MediaModalityStats.streamDirectionToString={send:"Send",receive:"Receive"},MediaModalityStats.mediaTypeToString=((K={})[0]="Audio",K[1]="Video",K[2]="ScreenShare",K[3]="Data",K),MediaModalityStats.mediaDirectionToRole=((J={})[1]="Receiver",J[2]="Sender",J[4]="Bidirectional",J),MediaModalityStats.mediaDirectionToStream=((Q={})[1]="receive",Q[2]="send",Q),MediaModalityStats}(ce);B.MediaModalityStats=de;var ue=function(F){function AudioStats(){return F.call(this,0,4)||this}return $(AudioStats,F),AudioStats.prototype.start=function(){F.prototype.start.call(this),F.prototype.lifecycle.call(this,Z.StartModality)},AudioStats.prototype.stop=function(){F.prototype.lifecycle.call(this,Z.StopModality)},AudioStats}(de);B.AudioStats=ue;var pe=function(F){function MediaSenderStats(B){var G=F.call(this,B,2)||this;return G.mediaType=B,G}return $(MediaSenderStats,F),MediaSenderStats.prototype.start=function(){F.prototype.start.call(this),F.prototype.lifecycle.call(this,Z.StartModality)},MediaSenderStats.prototype.stop=function(){F.prototype.lifecycle.call(this,Z.StopModality)},MediaSenderStats.prototype.event=function(B){F.prototype.addEvent.call(this,ee[B])},MediaSenderStats}(de);B.MediaSenderStats=pe;var he=function(F){function MediaReceiverStats(B,G){var W=F.call(this,B,1)||this;return W.mediaType=B,W.remoteParticipantId=G,W.rendererCounter=0,W}return $(MediaReceiverStats,F),MediaReceiverStats.prototype.newRendererId=function(){return this.rendererCounter+=1,String(this.rendererCounter)},MediaReceiverStats.prototype.event=function(B,G,W){F.prototype.addEvent.call(this,te[B],ne.isUndefined(W)?{rendererId:G}:{rendererId:G,sourceId:W})},MediaReceiverStats.prototype.asStatsRecord=function(){return F.prototype.asStatsRecord.call(this,{TargetUser:this.remoteParticipantId})},MediaReceiverStats}(de);B.MediaReceiverStats=he;var ge=function(){function LocalStats(){this.allStats=[],this.ended=!1}return LocalStats.prototype.setLocalUserId=function(F){this.localUserId=F},Object.defineProperty(LocalStats.prototype,"call",{get:function(){return this.callStats||this.startCall()},enumerable:!1,configurable:!0}),Object.defineProperty(LocalStats.prototype,"audio",{get:function(){return this.audioStats||this.newSession(0)},enumerable:!1,configurable:!0}),Object.defineProperty(LocalStats.prototype,"video",{get:function(){return this.videoStats||this.newSession(1)},enumerable:!1,configurable:!0}),Object.defineProperty(LocalStats.prototype,"screenShare",{get:function(){return this.sharingStats||this.newSession(2)},enumerable:!1,configurable:!0}),LocalStats.prototype.renderer=function(F,B){var G=this.renderingStats[B];return G||(G=this.renderingStats[B]=this.receive(F,B)),G},LocalStats.prototype.startCall=function(){return this.callStats?this.callStats:(this.callStats=new le,this.callStats.start(),this.addStats(this.callStats))},LocalStats.prototype.endCall=function(F){void 0===F&&(F=0),this.ended=!0,this.call.end(F),this.allStats.forEach((function(F){return F.end()})),this.cleanUp()},LocalStats.prototype.cleanUp=function(){this.audioStats&&(this.audioStats.stop(),this.audioStats=null),this.videoStats&&(this.videoStats.stop(),this.videoStats=null),this.sharingStats&&(this.sharingStats.stop(),this.sharingStats=null)},LocalStats.prototype.newSession=function(F){var B;switch(F){case 0:B=this.audioStats=new ue;break;case 1:B=this.videoStats=new pe(F);break;case 2:B=this.sharingStats=new pe(F)}return this.addStats(B)},LocalStats.prototype.receive=function(F,B){var G=new he(F,B);return G.start(),this.addStats(G)},LocalStats.prototype.buildStatsRecords=function(){return this.allStats.map((function(F){return F.asStatsRecord()})).filter((function(F){return!!F}))},LocalStats.prototype.addStats=function(F){return this.ended||(this.allStats.push(F),F.setLocalUserId(this.localUserId)),F},LocalStats}();B.LocalStats=ge;var fe=function(){function CallTelemetryBuilder(){this.localStats=new ge,this.tsCallingVersion=(0,re.getTsCallingVersion)()}return CallTelemetryBuilder.prototype.setCallId=function(F){this.callId=F},CallTelemetryBuilder.prototype.setTenantId=function(F){this.tenantId=F},CallTelemetryBuilder.prototype.setUserHexCID=function(F){this.userHexCID=F},CallTelemetryBuilder.prototype.setParticipantId=function(F){this.participantId=F},CallTelemetryBuilder.prototype.setEndpointId=function(F){this.endpointId=F},CallTelemetryBuilder.prototype.setMediaLegId=function(F){this.mediaLegId=F},CallTelemetryBuilder.prototype.setMediaStats=function(F){this.mediaStats=F},CallTelemetryBuilder.prototype.setAcsResourceId=function(F){this.acsResourceId=F},CallTelemetryBuilder.prototype.appendDataChannelInfo=function(F){var B;(null===(B=this.mediaStats)||void 0===B?void 0:B.data)&&F&&(this.mediaStats.data.DataHandlers=F)},CallTelemetryBuilder.prototype.appendSharingControlInfo=function(F){var B;(null===(B=this.mediaStats)||void 0===B?void 0:B.data)&&(this.mediaStats.data.SharingControlEnabled=F?"true":"false")},CallTelemetryBuilder.prototype.appendMediaControlPaneInfo=function(F){var B;(null===(B=this.mediaStats)||void 0===B?void 0:B.data)&&F&&(this.mediaStats.data.MediaControlPlane=F)},CallTelemetryBuilder.prototype.appendTerminationInfo=function(F,B){var G;(null===(G=this.mediaStats)||void 0===G?void 0:G.data)&&(this.mediaStats.data.TerminatedReason="".concat(F),this.mediaStats.data.TerminatedState="".concat(B))},CallTelemetryBuilder.prototype.appendPictureInPictureInfo=function(F){var B;(null===(B=this.mediaStats)||void 0===B?void 0:B.data)&&F&&(this.mediaStats.data.PictureInPicture=F)},CallTelemetryBuilder.prototype.buildFromMediaStats=function(){var F;return"WebRtcMediaStats"===(null===(F=this.mediaStats)||void 0===F?void 0:F.type)?[this.buildEvent(this.mediaStats.data,se.webrtcSession)]:[]},CallTelemetryBuilder.prototype.buildMediaTelemetry=function(){if(this.mediaStats){var F=this.buildEvent(this.mediaStats.data,null).props,B={};return Object.keys(F).forEach((function(G){void 0===F[G].piiKind?B[G]=F[G]:B[G]=F[G].value})),B}},CallTelemetryBuilder.prototype.buildFromCallSetupStats=function(){var F;return"WebRtcMediaStats"===(null===(F=this.mediaStats)||void 0===F?void 0:F.type)?[this.buildEvent(this.mediaStats.data,se.webrtcSessionInitial)]:[]},CallTelemetryBuilder.prototype.buildFromLocalStats=function(){var F=this;return this.localStats.buildStatsRecords().map((function(B){return F.buildEvent(B.record,B.name)}))},CallTelemetryBuilder.prototype.buildEvent=function(F,B){var G={};return G[ae.agentEnvironmentId]=CallTelemetryBuilder.agentEnvironmentId,G[ae.correlationId]=this.callId||"",G[ae.tenantId]=this.tenantId||"",G[ae.userHexCID]=this.userHexCID||"",G[ae.participantId]=this.participantId||"",G[ae.endpointId]=this.endpointId||"",G[ae.mediaLegId]=this.mediaLegId||"",G[ae.webMediaConfigIds]=this.webMediaConfigIds||"",G[ae.tsCallingVersion]=this.tsCallingVersion||"",G[ae.acsResourceId]=this.acsResourceId||"",{eventName:B,props:this.buildProps(F,null,G)}},CallTelemetryBuilder.prototype.normalizeKey=function(F){return F.replace(/[^a-zA-Z0-9._]/g,"_")},CallTelemetryBuilder.prototype.createPiiValueFromMAStat=function(F,B){if(!(B in CallTelemetryBuilder.piiDict))throw new Error("unknown PII type");return new oe(F,CallTelemetryBuilder.piiDict[B])},CallTelemetryBuilder.prototype.buildProps=function(F,B,G){var W=this;return ne.keys(F).forEach((function(z){var K=W.normalizeKey(z),J=B?"".concat(B,"_").concat(K):K,Q=F[z];if(ne.isString(Q))G[J]=W.getPiiAwareValue(z,Q);else if(ne.isArray(Q)){if(Q.length>0){var Y=Q,$=Y.map((function(F){return F.value})).toString();G[J]=W.createPiiValueFromMAStat($,Y[0].type)}}else if(ne.isObject(Q))if(Q.__VALUE__){var X=Q;ne.isBoolean(X.value)&&(X.value=X.value?"true":"false"),G[J]=W.createPiiValueFromMAStat(X.value,X.type)}else W.buildProps(Q,J,G)})),G},CallTelemetryBuilder.prototype.getPiiAwareValue=function(F,B){return CallTelemetryBuilder.piiProps.hasOwnProperty(F)?new oe(B,CallTelemetryBuilder.piiProps[F]):B},CallTelemetryBuilder.prototype.build=function(){return ne.flatten([this.buildFromMediaStats(),this.buildFromLocalStats()])},CallTelemetryBuilder.agentEnvironmentId=(0,ie.default)(),CallTelemetryBuilder.piiProps={IPAddr:13,MACAddr:13,IPAddress:13,OpaqueData:0,LocalSite:13,RemoteSite:13,BaseAddress:13,LocalAddress:13,RemoteAddress:13,NetworkName:12,LocalUser:10,TargetUser:10},CallTelemetryBuilder.piiDict=((Y={})[0]=0,Y[13]=13,Y[4]=4,Y),CallTelemetryBuilder}();B.CallTelemetryBuilder=fe},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(14),J=G(15),Q=G(38),Y=G(62),$=function(F){function Stream(B,G,W){var z=F.call(this,G)||this;return z.mediaSession=B,z.isAvailable=!1,z.mediaSessionInitPromise=new Q.SettablePromise,z.currentIsStreaming=!1,B&&z.mediaSessionInitPromise.resolve(),z.id=W,z.logger=G.createChild("Stream[".concat(z.id,"]")),z}return z(Stream,F),Object.defineProperty(Stream.prototype,"isStreaming",{get:function(){return this.currentIsStreaming},set:function(F){this.currentIsStreaming=F,this.raiseChanged()},enumerable:!1,configurable:!0}),Stream.prototype.update=function(F,B){var G=void 0===F?{}:F,W=G.sourceId,z=void 0===W?null:W,J=G.direction,Q=void 0===J?Y.streamDirections.receive:J,$=G.participantId,X=void 0===$?null:$,Z=G.endpointId,ee=void 0===Z?null:Z;this.logger.info("[".concat(B,"][update before]  sourceId=").concat(z,", direction=").concat(Q,", participantId=").concat(X,", endpointId=").concat((0,K.truncate)(ee,8))),this.id=z,this.isAvailable=Q===Y.streamDirections.sendReceive||Q===Y.streamDirections.send,this.participantId=X,this.endpointId=ee,this.logger.info("[".concat(B,"][update after]  sourceId=").concat(z,", direction=").concat(Q,", participantId=").concat(X,", endpointId=").concat((0,K.truncate)(ee,8))),this.raiseChanged()},Stream.prototype.setMediaSession=function(F,B){var G=F&&F.getAllowedModalities&&F.getAllowedModalities()||{};this.logger.info("[".concat(B,"][setMediaSession] ").concat(JSON.stringify(G))),this.mediaSession=F,F?this.mediaSessionInitPromise.resolve():this.mediaSessionInitPromise.reject(new Error("MediaSession is null"))},Stream.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},Stream}(J.default);B.default=$},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ngcStreamTypes=B.streamDirections=void 0,B.streamDirections={send:"sendonly",receive:"recvonly",sendReceive:"sendrecv"},B.ngcStreamTypes={audio:"audio",video:"video",sharing:"applicationsharing-video",audioteleconference:"audio-teleconferencing"}},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.RemoteImageRenderer=B.RemoteVideoRenderer=B.LocalVideoRenderer=B.toMediaAgentScalingMode=void 0;var Q=G(15),Y=G(60);function toMediaAgentScalingMode(F){switch(F){case 1:return"crop";case 0:return"stretch";default:return"fit"}}B.toMediaAgentScalingMode=toMediaAgentScalingMode;var $=function(F){function VideoRendererBase(){var B=null!==F&&F.apply(this,arguments)||this;return B.isRendering=!1,B.frameType=-1,B}return z(VideoRendererBase,F),Object.defineProperty(VideoRendererBase.prototype,"rendererType",{get:function(){return 0},enumerable:!1,configurable:!0}),VideoRendererBase.prototype.captureFrame=function(){if(this.renderer.captureFrame)return this.renderer.captureFrame();throw new Error("Not implemented yet")},VideoRendererBase.prototype.getStats=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){if(this.renderer.getStats)return[2,this.renderer.getStats()];throw new Error("Renderer does not support stats")}))}))},VideoRendererBase.prototype.setScalingMode=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this.renderer.setScalingMode(toMediaAgentScalingMode(F)),[2]}))}))},VideoRendererBase.prototype.dumpVideoSourceImages=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},VideoRendererBase.prototype.cameraAutoControl=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},VideoRendererBase.prototype.getCameraManualControlStates=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},VideoRendererBase.prototype.setCameraManualControlStates=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},VideoRendererBase.prototype.enumerateCameraManualControls=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},VideoRendererBase.prototype.onVideoSizeChanged=function(F,B){this.streamSize={width:F,height:B},this.event("videoSizeChanged").raise(F,B),this.raiseChanged()},VideoRendererBase}(Q.default),X=function(F){function LocalVideoRenderer(B,G){var W=F.call(this)||this;return W.renderer=G.createPreviewRenderer(B),W.renderer.on("onVideoSizeChanged",(function(F,B){return W.onVideoSizeChanged(F,B)})),W}return z(LocalVideoRenderer,F),LocalVideoRenderer.prototype.onVideoSizeChanged=function(B,G){this.isRendering=B>0&&G>0,F.prototype.onVideoSizeChanged.call(this,B,G)},LocalVideoRenderer.prototype.setVideoMirroring=function(F){this.renderer.setVideoMirroring(F)},LocalVideoRenderer.prototype.startVideoAsync=function(){return this.renderer.startVideoAsync()},LocalVideoRenderer.prototype.dispose=function(){this.renderer&&(this.renderer.dispose(),this.renderer=null)},LocalVideoRenderer}($);B.LocalVideoRenderer=X;var Z=function(F){function RemoteVideoRenderer(B,G,W,z){var K=F.call(this)||this;return K.target=B,K.rendererStats=W,K.configProvider=z,K.subscriptionActive=!1,K.firstFrameRendered=!1,K.rendererId=W.newRendererId(),K.renderer=G.createRemoteRenderer(B),K.renderer.on("onVideoSizeChanged",(function(F,B){return K.onVideoSizeChanged(F,B)})),K.renderer.on("onVideoStateChanged",(function(F){return K.onVideoStateChanged(F)})),K.renderer.on("onIsRenderingChanged",(function(F){return K.onIsRenderingChanged(F)})),K}return z(RemoteVideoRenderer,F),RemoteVideoRenderer.prototype.onVideoStateChanged=function(F){this.rendererStats.streamStateChanged(F.stream)},RemoteVideoRenderer.prototype.onVideoSizeChanged=function(B,G){this.configProvider.config.videoIsRenderingCheck&&this.setIsRendering(B>0&&G>0),F.prototype.onVideoSizeChanged.call(this,B,G)},RemoteVideoRenderer.prototype.setIsRendering=function(F){this.isRendering!==F&&(this.isRendering=F,this.rendererStats.event(this.isRendering?Y.MediaReceiverEvent.RenderingStarted:Y.MediaReceiverEvent.RenderingStopped,this.rendererId),this.configProvider.config.isStreamingMatchIsRendering&&this.currentVideoStream&&(this.currentVideoStream.isStreaming=F),this.isRendering&&!this.firstFrameRendered&&(this.firstFrameRendered=!0,this.event("firstFrameRendered").raise()))},RemoteVideoRenderer.prototype.onIsRenderingChanged=function(F){this.setIsRendering(F),this.raiseChanged()},RemoteVideoRenderer.prototype.subscribeVideoAsync=function(F){var B=this;this.currentVideoStream=F,this.rendererStats.event(Y.MediaReceiverEvent.Subscribe,this.rendererId,F.id);var G=this.renderer.subscribeVideoAsync(F.id,1===F.type);return this.subscriptionActive=!0,G.then((function(){B.rendererStats.event(Y.MediaReceiverEvent.Subscribed,B.rendererId,F.id),B.watchStream(F)})),G},RemoteVideoRenderer.prototype.watchStream=function(F){var B=this;this.changeSub&&this.changeSub.dispose(),this.changeSub=F.changed((function(){F.isAvailable?B.subscriptionActive||B.subscribeVideoAsync(F):(B.subscriptionActive=!1,B.rendererStats.event(Y.MediaReceiverEvent.Unsubscribe,B.rendererId),B.renderer.unsubscribeNow(),B.rendererStats.event(Y.MediaReceiverEvent.Unsubscribed,B.rendererId))}))},RemoteVideoRenderer.prototype.dispose=function(){this.renderer&&(this.subscriptionActive&&(this.rendererStats.event(Y.MediaReceiverEvent.Unsubscribe,this.rendererId),this.currentVideoStream&&!this.currentVideoStream.isAvailable&&this.renderer.unsubscribeNow()),this.renderer.dispose(),this.subscriptionActive&&this.rendererStats.event(Y.MediaReceiverEvent.Unsubscribed,this.rendererId),this.renderer=null,this.currentVideoStream=null),this.changeSub&&(this.changeSub.dispose(),this.changeSub=null)},RemoteVideoRenderer}($);B.RemoteVideoRenderer=Z;var ee=function(F){function RemoteImageRenderer(B,G,W){var z=F.call(this)||this;return z.imageRenderingSession=B,z.target=G,z.id=W,z}return z(RemoteImageRenderer,F),RemoteImageRenderer.prototype.start=function(F){var B=this;return this.renderer?Promise.reject("RemoteImageRenderer already started id: ".concat(this.id)):this.imageRenderingSession?(this.renderer=this.imageRenderingSession.imageRendererProvider.createRenderer({frameUris:F,frameContainer:this.target,callParams:this.imageRenderingSession.callParams,id:this.id}),this.eventSubscription=this.renderer.once("onRendererDisposed",(function(){B.dispose()})),this.renderer.start().then((function(){B.isRendering=!0,B.raiseChanged()})).catch((function(F){return B.dispose(),Promise.reject(F)}))):Promise.reject("imageRenderingSession not provided id: ".concat(this.id))},RemoteImageRenderer.prototype.dispose=function(){this.renderer&&(this.renderer.dispose(),this.renderer=void 0),this.eventSubscription&&(this.eventSubscription.dispose(),this.eventSubscription=void 0),this.isRendering=!1,this.raiseChanged()},RemoteImageRenderer}($);B.RemoteImageRenderer=ee},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},J=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},Q=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.disabledMedia=B.PartialIceRestartFixup=B.ExtUriNormalizer=B.RemoveNonAdvVLADecoratorExtension=B.AddNonAdvVLADecoratorExtension=B.RemoveVLAHeaderExtension=B.AddVLAHeaderExtension=B.AddMsidFixup=B.SimulcastToMsSDPMediaFixup=B.SimulcastFromMsSDPMediaFixup=B.NoCandidatesFixup=B.CandidatesFixup=B.NoBundleInAnswerFixup=B.BundleOnlyMediaFixup=B.BundleGroupModifier=B.RemoveH264SpsPpsIdrInKeyframe=B.InjectH264SpsPpsIdrInKeyframe=B.RemoveH264ParamsModifier=B.InjectH264ParamsModifier=B.InjectTransportCCAudio=B.AudioPrimaryCodecsModifier=B.NoAudioFixup=B.InOpusEnforcedFmtp=B.G722Fixup=B.ComfortNoiseFixup=B.FilterCodecs=B.RemoveMsRTCAttributes=B.RemoveExtmapAllowMixed=B.AddExtmapAllowMixed=B.ExtensionsFixup=B.IceRestartChecker=B.OutSdpBandwidthModifier=B.InSdpBandwidthModifier=B.RemoveLabelsModifier=B.AddLabelsModifier=B.InSdpReceiveSsrcFixup=B.OutSdpReceiveSsrcFixup=B.SendOnlyModalityFixup=B.IncomingDataModalityFixup=B.RemoveVideoOrientationExtension=B.AddVideoOrientationExtension=B.OutgoingDataModalityFixup=B.InsertDisabledXData=B.RollbackEntitiesFixup=B.DisabledMediaFixup=B.OutgoingDtlsRoleModifier=B.IncomingSrtpFixup=B.MsSdpRemoteModifier=B.MsSdpLocalModifier=void 0;var Y=G(17),$=G(47),X=G(4),Z=G(10),ee=G(39),te=G(369),ne=function(){function MsSdpLocalModifier(F,B,G){this.context=F,this.mediaManager=B,this.sessionType=G,this.msSdpT=new te.MsSdpTransform(this.context,this.mediaManager)}return MsSdpLocalModifier.prototype.modify=function(F){this.msSdpT.toMsSdp(F,this.sessionType)},MsSdpLocalModifier}();B.MsSdpLocalModifier=ne;var ie=function(){function MsSdpRemoteModifier(F,B,G){this.context=F,this.mediaManager=B,this.sessionType=G,this.msSdpT=new te.MsSdpTransform(this.context,this.mediaManager)}return MsSdpRemoteModifier.prototype.modify=function(F){this.msSdpT.fromMsSdp(F,this.sessionType)},MsSdpRemoteModifier}();B.MsSdpRemoteModifier=ie;var re=function(){function IncomingSrtpFixup(F){this.context=F}return IncomingSrtpFixup.prototype.modify=function(F){var B=Z.preferSdesSrtp(this.context),G=Z.getSrtpInfo(F),W=F.media.find((function(F){return!!F.crypto}));F.media.forEach((function(F){F.type!==X.default.MEDIA_TYPE.dataChannel&&(!B&&F.fingerprint&&F.crypto&&delete F.crypto,F.protocol=!G.dtls||G.sdes&&B?X.default.PROFILES.rtpSavpf:X.default.PROFILES.udpTlsRtpSavpf,0===F.port&&F.protocol===X.default.PROFILES.rtpSavpf&&W&&(F.crypto=W.crypto))}))},IncomingSrtpFixup}();B.IncomingSrtpFixup=re;var oe=function(){function OutgoingDtlsRoleModifier(F,B,G){this.mediaManager=F,this.isOffer=B,this.configProvider=G}return OutgoingDtlsRoleModifier.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){var W=F.setup,z=B.mediaManager.getMediaEntities()[G],K=z.getExtension("setup");W&&z.isEnabled()&&("actpass"!==W?z.setExtension("setup",W):B.isOffer&&void 0!==K&&"actpass"!==K&&!B.configProvider.config.disableOutgoingDtlsRoleOverride&&(F.setup=K))}))},OutgoingDtlsRoleModifier}();B.OutgoingDtlsRoleModifier=oe;var ae=function(){function DisabledMediaFixup(F,B){this.mediaManager=F,this.modalities=B}return DisabledMediaFixup.prototype.modify=function(F){var B=this,G=0;F.media.forEach((function(F,B){var W=parseInt(F.mid,10);!isNaN(W)&&W>=G&&(G=W+1)})),F.media.forEach((function(W,z){var K=B.mediaManager.getMediaEntities()[z];if(0===W.port||K.isDisabled()||!(K.getModality()in B.modalities)){var J=K.getExtension("midApplied")?void 0:W.mid||"".concat(G++);0===z?W.direction=X.default.MEDIA_STATE.inactive:F.media[z]=disabledMedia(W.type,void 0,W.protocol,J)}}))},DisabledMediaFixup}();B.DisabledMediaFixup=ae;var se=function(){function RollbackEntitiesFixup(F,B){this.mediaManager=F,this.remote=B}return RollbackEntitiesFixup.prototype.modify=function(F){for(var B=this.mediaManager.getMediaEntities(),G=0;G<B.length;G++){var W=B[G],z=F.media[G];if(W.getExtension("rollback"))if(z&&!this.remote)F.media[G]=null;else if(!z&&this.remote){var K=W.getType()===X.default.MEDIA_TYPE.data?X.default.MEDIA_TYPE.dataChannel:W.getType(),J=K===X.default.MEDIA_TYPE.dataChannel?X.default.PROFILES.udpDtlsSctp:X.default.PROFILES.udpTlsRtpSavpf;F.media.push(disabledMedia(K,void 0,J,void 0))}}F.media=F.media.filter((function(F){return F}))},RollbackEntitiesFixup}();B.RollbackEntitiesFixup=se;var ce=function(){function InsertDisabledXData(F){this.mediaManager=F}return InsertDisabledXData.prototype.modify=function(F){this.mediaManager.getMediaEntities().forEach((function(B,G){var W=F.media[G];B.getModality()!==X.default.MODALITY.data||W&&W.type===X.default.MEDIA_TYPE.dataChannel||F.media.splice(G,0,disabledMedia(X.default.MEDIA_TYPE.data,X.default.MEDIA_LABEL.data,X.default.PROFILES.rtpSavp,void 0))}))},InsertDisabledXData}();B.InsertDisabledXData=ce;var le=function(){function OutgoingDataModalityFixup(F,B){this.context=F,this.direction=B}return OutgoingDataModalityFixup.prototype.modify=function(F){var B=this;F.media.forEach((function(F){F.type===X.default.MEDIA_TYPE.dataChannel&&(F.type=X.default.MEDIA_TYPE.data,F.payloads=X.default.PAYLOAD_TYPE.X_DATA)})),Z.allowDataChannel(this.context)&&getEnabledMedia(F,X.default.MEDIA_TYPE.data).forEach((function(G){G.rtp=G.rtp||[],G.fmtp=G.fmtp||[],G.rtp.push({codec:"x-data",payload:127,rate:9e4}),G.rtp.push({codec:"rtx",payload:126,rate:9e4}),G.fmtp.push({payload:126,config:"apt=127"});var W=B.getNonOverlappingSsrc(F);G.xSsrcRange={ssrcMin:W,ssrcMax:W},G.rtcpMux="rtcp-mux",G.xDataProtocol="sctp",G.direction=B.direction}))},OutgoingDataModalityFixup.prototype.getNonOverlappingSsrc=function(F){var B,G=!0;do{B=Math.floor(4294967293*Math.random())+2,getEnabledMedia(F).forEach((function(F){var W,z;(null===(z=null===(W=null==F?void 0:F.ssrcs)||void 0===W?void 0:W[0])||void 0===z?void 0:z.id)===B&&(G=!1)}))}while(!G);return B},OutgoingDataModalityFixup}();B.OutgoingDataModalityFixup=le;var de=function(){function VideoOrientationExtension(F){this.configProvider=F,this.uri="urn:3gpp:video-orientation",this.value=13}return VideoOrientationExtension.prototype.modify=function(F){var B,G;if(this.configProvider.config.enableVideoOrientationExtension)try{for(var W=K(getEnabledMedia(F,X.default.MEDIA_TYPE.video)),z=W.next();!z.done;z=W.next()){var J=z.value;this.modifyMedia(J)}}catch(F){B={error:F}}finally{try{z&&!z.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}},VideoOrientationExtension}(),ue=function(F){function AddVideoOrientationExtension(){return null!==F&&F.apply(this,arguments)||this}return z(AddVideoOrientationExtension,F),AddVideoOrientationExtension.prototype.modifyMedia=function(F){var B,G=this;null!==(B=F.ext)&&void 0!==B||(F.ext=[]),F.ext.some((function(F){return F.uri===G.uri}))||F.ext.push({value:this.getAvailableValue(F.ext),uri:this.uri})},AddVideoOrientationExtension.prototype.getAvailableValue=function(F){var B=F.map((function(F){return F.value}));return B.includes(this.value)?Math.max.apply(Math,Q([],J(B),!1))+1:this.value},AddVideoOrientationExtension}(de);B.AddVideoOrientationExtension=ue;var pe=function(F){function RemoveVideoOrientationExtension(){return null!==F&&F.apply(this,arguments)||this}return z(RemoveVideoOrientationExtension,F),RemoveVideoOrientationExtension.prototype.modifyMedia=function(F){var B,G=this;F.ext=null===(B=F.ext)||void 0===B?void 0:B.filter((function(F){return F.uri!==G.uri}))},RemoveVideoOrientationExtension}(de);B.RemoveVideoOrientationExtension=pe;var he=function(){function IncomingDataModalityFixup(F){this.context=F}return IncomingDataModalityFixup.prototype.modify=function(F){for(var B=F.media.length-1;B>=0;B--){var G=F.media[B];G.type===X.default.MEDIA_TYPE.data&&(Z.allowDataChannel(this.context)?(G.payloads=X.default.PAYLOAD_TYPE.DATA_CHANNEL,G.type=X.default.MEDIA_TYPE.dataChannel,G.protocol=X.default.PROFILES.udpDtlsSctp,delete G.xDataProtocol,delete G.rtp,delete G.fmtp,delete G.rtcp,delete G.rtcpMux,delete G.ext,delete G.ssrcs,delete G.ssrcGroups,delete G.xSsrcRange):F.media.splice(B,1))}},IncomingDataModalityFixup}();B.IncomingDataModalityFixup=he;var ge=function(){function SendOnlyModalityFixup(F){this.modalities=F}return SendOnlyModalityFixup.prototype.modify=function(F){var B=this;getEnabledMedia(F).forEach((function(F){var G=ee.getModality(F);B.modalities[G]===X.default.MEDIA_STATE.send&&(F.direction&&F.direction.toLowerCase()===X.default.MEDIA_STATE.receive||(F.direction=X.default.MEDIA_STATE.receive))}))},SendOnlyModalityFixup}();B.SendOnlyModalityFixup=ge;var fe=function(){function OutSdpReceiveSsrcFixup(F,B){this.isMultiparty=F,this.cname=B}return OutSdpReceiveSsrcFixup.prototype.modify=function(F){var B=this;this.isMultiparty&&getEnabledMedia(F).forEach((function(F){var G=F.direction;G!==X.default.MEDIA_STATE.receive&&G!==X.default.MEDIA_STATE.inactive||(F.ssrcs&&F.ssrcs[0]?F.ssrcs=[{id:F.ssrcs[0].id,attribute:"cname",value:B.cname}]:F.type===X.default.MEDIA_TYPE.audio?F.ssrcs=[{id:4195875351,attribute:"cname",value:B.cname}]:F.type===X.default.MEDIA_TYPE.video&&(F.ssrcs=[{id:1,attribute:"cname",value:B.cname}]))}))},OutSdpReceiveSsrcFixup}();B.OutSdpReceiveSsrcFixup=fe;var me=function(){function InSdpReceiveSsrcFixup(){}return InSdpReceiveSsrcFixup.prototype.modify=function(F){var B=new Set;getEnabledMedia(F,X.default.MEDIA_TYPE.video).forEach((function(F){F.ssrcs&&F.ssrcs.length>1&&B.add(F.ssrcs[0].id)}));var G=getEnabledMedia(F,X.default.MEDIA_TYPE.video).find((function(F){return F.direction===X.default.MEDIA_STATE.sendReceive||F.direction===X.default.MEDIA_STATE.send}));getEnabledMedia(F,X.default.MEDIA_TYPE.video).forEach((function(F){var W=F.direction;if((W===X.default.MEDIA_STATE.receive||W===X.default.MEDIA_STATE.inactive)&&F.ssrcs&&1===F.ssrcs.length){var z=F.ssrcs[0].id;(1===z||G&&G.ssrcs[0].id===z||!G&&B.has(z))&&(delete F.ssrcs,delete F.ssrcGroups)}}))},InSdpReceiveSsrcFixup}();B.InSdpReceiveSsrcFixup=me;var ve=function(){function AddLabelsModifier(F){this.mediaManager=F}return AddLabelsModifier.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){var W=B.mediaManager.getMediaEntities()[G];F.label=ee.getLabelForModality(W.getModality())}))},AddLabelsModifier}();B.AddLabelsModifier=ve;var ye=function(){function RemoveLabelsModifier(){}return RemoveLabelsModifier.prototype.modify=function(F){F.media.forEach((function(F){delete F.label}))},RemoveLabelsModifier}();B.RemoveLabelsModifier=ye;var Se=function(){function InSdpBandwidthModifier(F,B,G){this.mediaManager=F,this.modalities=B,this.configProvider=G}return InSdpBandwidthModifier.prototype.modify=function(F){var B=this,G=this.configProvider.mediaConfig.maxBandwidthInKbps,W=F.bandwidth&&F.bandwidth.find((function(F){return"CT"===F.type}));W&&(!G||G>W.limit)&&(G=W.limit);var z=this.configProvider.config.audioBandwidthInKbps||0,K=Math.max(G-z,0),J=this.configProvider.config.videoBandwidthAllocation&&Z.hasSendDirectionality(this.modalities.video)&&Z.hasSendDirectionality(this.modalities.sharing);getEnabledMedia(F,X.default.MEDIA_TYPE.video).forEach((function(F){if(delete F.bandwidth,K){var G=K;if(J){var W=B.mediaManager.getMediaEntityByMid(F.mid).getModality()===X.default.MODALITY.video?B.configProvider.config.videoBandwidthAllocation:1-B.configProvider.config.videoBandwidthAllocation;G=Math.round(K*W)}F.bandwidth=[{limit:G,type:"AS"}]}}))},InSdpBandwidthModifier}();B.InSdpBandwidthModifier=Se;var _e=function(){function OutSdpBandwidthModifier(F){this.configProvider=F}return OutSdpBandwidthModifier.prototype.modify=function(F){var B=this.configProvider.mediaConfig.maxBandwidthInKbps;B&&(F.bandwidth=[{limit:B,type:"CT"}])},OutSdpBandwidthModifier}();B.OutSdpBandwidthModifier=_e;var Ce=function(){function IceRestartChecker(F){this.mediaManager=F}return IceRestartChecker.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){var W=B.mediaManager.getMediaEntities()[G],z=W.getExtension("iceUfrag");W.setExtension("iceRestart",!!F.iceUfrag&&!!z&&z!==F.iceUfrag),W.setExtension("iceUfrag",F.iceUfrag)}))},IceRestartChecker}();B.IceRestartChecker=Ce;var Te=function(){function ExtensionsFixup(){}return ExtensionsFixup.prototype.modify=function(F){var B=new Set(["urn:ietf:params:rtp-hdrext:csrc-audio-level","http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"]);getEnabledMedia(F).forEach((function(F){F.ext&&(F.ext=F.ext.filter((function(F){return!B.has(F.uri)})))}))},ExtensionsFixup}();B.ExtensionsFixup=Te;var Ee=function(){function AddExtmapAllowMixed(F){this.configProvider=F}return AddExtmapAllowMixed.prototype.modify=function(F){this.configProvider.config.extmapAllowMixed&&(F.extmapAllowMixed="extmap-allow-mixed")},AddExtmapAllowMixed}();B.AddExtmapAllowMixed=Ee;var be=function(){function RemoveExtmapAllowMixed(F){this.configProvider=F}return RemoveExtmapAllowMixed.prototype.modify=function(F){this.configProvider.config.extmapAllowMixed||delete F.extmapAllowMixed},RemoveExtmapAllowMixed}();B.RemoveExtmapAllowMixed=be;var Ie=function(){function RemoveMsRTCAttributes(){}return RemoveMsRTCAttributes.prototype.modify=function(F){getEnabledMedia(F).forEach((function(F){delete F.signalingFbXMessage}))},RemoveMsRTCAttributes}();B.RemoveMsRTCAttributes=Ie;var Ae=function(){function FilterCodecs(F,B,G){this.mediaManager=F,this.configProvider=B,this.sdpType=G}return FilterCodecs.prototype.modify=function(F){var B=this;this.configProvider.config.filterCodecsInSdp&&"offer"===this.sdpType&&this.mediaManager.getMediaEntities().forEach((function(G,W){var z=F.media[W];if(z){var K=Z.getAllowedCodecs(B.configProvider,z.type);if(K.length){var J=Z.convertToCodecInfo(K);ee.filterCodecs(z,J,!!G.getExtension("unnegotiatedModality"),null)}}}))},FilterCodecs}();B.FilterCodecs=Ae;var Re=function(){function ComfortNoiseFixup(){}return ComfortNoiseFixup.prototype.modify=function(F){var B=F.media.find((function(F){return F.type===X.default.MEDIA_TYPE.audio}));ee.removeCodec(B,{codec:"CN",rate:16e3})},ComfortNoiseFixup}();B.ComfortNoiseFixup=Re;var Pe=function(){function G722Fixup(){}return G722Fixup.prototype.modify=function(F){var B=F.media.find((function(F){return F.type===X.default.MEDIA_TYPE.audio}));ee.removeCodec(B,{codec:"g722",rate:8e3,encoding:2})},G722Fixup}();B.G722Fixup=Pe;var Oe=function(){function InOpusEnforcedFmtp(F){this.configProvider=F}return InOpusEnforcedFmtp.prototype.modify=function(F){var B=this.configProvider.config.enforceOpusFmtp;if(B){var G=F.media.find((function(F){return F.type===X.default.MEDIA_TYPE.audio}));ee.forOneCodec(G,{name:"opus",rate:48e3,encoding:2},(function(F){F.fmtp||(F.fmtp={payload:F.rtp.payload});var G=$.default.build(F.fmtp.config);Object.keys(B).forEach((function(F){G.removeIfPresent(F),G.setIfMissing(F,"".concat(B[F]))})),F.fmtp.config=G.toString()}))}},InOpusEnforcedFmtp}();B.InOpusEnforcedFmtp=Oe;var Me=function(){function NoAudioFixup(){}return NoAudioFixup.prototype.modify=function(F){var B=F.media.find((function(F){return F.type===X.default.MEDIA_TYPE.audio}));if(B&&0===B.port){var G=F.media.find((function(F){return!!F.iceUfrag}));G&&(B.port=9,B.direction="inactive",B.iceUfrag=G.iceUfrag,B.icePwd=G.icePwd,B.rtcpMux="rtcp-mux",G.crypto&&(B.crypto=G.crypto),G.fingerprint&&(B.fingerprint=G.fingerprint,B.setup=G.setup),B.rtp=[{payload:0,codec:"PCMU",rate:8e3}],B.payloads="0")}},NoAudioFixup}();B.NoAudioFixup=Me;var we=function(){function AudioPrimaryCodecsModifier(F){this.otherPartyCodecs=F}return AudioPrimaryCodecsModifier.prototype.modify=function(F){var B=this,G=F.media.find((function(F){return F.type===X.default.MEDIA_TYPE.audio})),W=["cn","telephone-event"],z=G.rtp.filter((function(F){return-1!==B.otherPartyCodecs.indexOf(F.codec.toLowerCase())&&-1===W.indexOf(F.codec.toLowerCase())}));if(0===z.length)throw new Error("there is no matching primary audio codec");G.rtp.filter((function(F){return F!==z[0]&&-1===W.indexOf(F.codec.toLowerCase())})).forEach((function(F){ee.removeCodec(G,F)}))},AudioPrimaryCodecsModifier}();B.AudioPrimaryCodecsModifier=we;var De=function(){function InjectTransportCCAudio(F,B){this.configProvider=F,this.logger=B}return InjectTransportCCAudio.prototype.modify=function(F){var B=this;this.configProvider.config.webrtcInjectTransportCCAudio&&getEnabledMedia(F,X.default.MEDIA_TYPE.audio).forEach((function(F){var G,W,z;if(null===(G=F.ext)||void 0===G?void 0:G.find((function(F){return F.uri===X.default.TRANSPORT_CC.EXT_URI}))){var K=null===(W=F.rtp)||void 0===W?void 0:W.find((function(F){return"opus"===F.codec.toLowerCase()}));if(K){var J=K.payload;(null===(z=F.rtcpFb)||void 0===z?void 0:z.find((function(F){return F.type===X.default.TRANSPORT_CC.ATTRIBUTE&&F.payload===J})))?B.logger.safe.info("opus codec already has transport-cc attribute"):(F.rtcpFb=F.rtcpFb||[],F.rtcpFb.push({payload:J,type:X.default.TRANSPORT_CC.ATTRIBUTE}),B.logger.safe.info("injected transport-cc attribute"))}else B.logger.safe.info("opus codec not found, skipping injecting transport-cc attribute for audio")}else B.logger.safe.info("transport-cc ext not present in sdp, skipping injecting transport-cc attribute for audio")}))},InjectTransportCCAudio}();B.InjectTransportCCAudio=De;var Ne=function(){function InjectH264ParamsModifier(F){this.mediaManager=F}return InjectH264ParamsModifier.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){if(0!==F.port&&F.type===X.default.MEDIA_TYPE.video){var W=B.mediaManager.getMediaEntities()[G];ee.forOneCodec(F,{name:"h264",rate:9e4},(function(F){var B=W.getVideoCapabilities();if(B){F.fmtp||(F.fmtp={payload:F.rtp.payload});var G=$.default.build(F.fmtp.config);G.setIfMissing("profile-level-id","42C02A"),G.setIfMissing("max-fs",B.getMaxFS().toString()),G.setIfMissing("max-mbps",B.getMaxMBPS().toString()),G.setIfMissing("max-fps",B.getMaxFPS().toString()),F.fmtp.config=G.toString()}}))}}))},InjectH264ParamsModifier}();B.InjectH264ParamsModifier=Ne;var Le=function(){function RemoveH264ParamsModifier(F){this.configProvider=F}return RemoveH264ParamsModifier.prototype.modify=function(F){var B=this;getEnabledMedia(F,X.default.MEDIA_TYPE.video).forEach((function(F){ee.forOneCodec(F,{name:"h264",rate:9e4},(function(F){if(F.fmtp){var G=$.default.build(),W=$.default.build(F.fmtp.config);["level-asymmetry-allowed","packetization-mode","profile-level-id"].forEach((function(F){if(W.contains(F)){var z=W.get(F);"profile-level-id"===F&&(z=B.configProvider.config.h264SendProfileOverride||z),G.setIfMissing(F,z)}})),F.fmtp.config=G.toString()}}))}))},RemoveH264ParamsModifier}();B.RemoveH264ParamsModifier=Le;var ke=function(){function InjectH264SpsPpsIdrInKeyframe(F){this.configProvider=F}return InjectH264SpsPpsIdrInKeyframe.prototype.modify=function(F){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&getEnabledMedia(F,X.default.MEDIA_TYPE.video).forEach((function(F){ee.forAllCodecs(F,{name:"h264",rate:9e4},(function(F){if(F.fmtp){var B=$.default.build(F.fmtp.config);B.setIfMissing("sps-pps-idr-in-keyframe","1"),F.fmtp.config=B.toString()}}))}))},InjectH264SpsPpsIdrInKeyframe}();B.InjectH264SpsPpsIdrInKeyframe=ke;var Fe=function(){function RemoveH264SpsPpsIdrInKeyframe(F){this.configProvider=F}return RemoveH264SpsPpsIdrInKeyframe.prototype.modify=function(F){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&getEnabledMedia(F,X.default.MEDIA_TYPE.video).forEach((function(F){ee.forAllCodecs(F,{name:"h264",rate:9e4},(function(F){if(F.fmtp){var B=$.default.build(F.fmtp.config);B.removeIfPresent("sps-pps-idr-in-keyframe"),F.fmtp.config=B.toString()}}))}))},RemoveH264SpsPpsIdrInKeyframe}();B.RemoveH264SpsPpsIdrInKeyframe=Fe;var xe=function(){function BundleGroupModifier(F){this.configProvider=F}return BundleGroupModifier.prototype.modify=function(F){var B=(F.groups||[]).findIndex((function(F){return"BUNDLE"===F.type})),G=F.groups?F.groups[B]:void 0;G&&(this.configProvider.mediaConfig.isTransportUnbundled?(G.mids=this.createBundleFromMedia(getEnabledMedia(F,X.default.MEDIA_TYPE.video)),G.mids||F.groups.splice(B,1)):G.mids=this.createBundleFromMedia(getEnabledMedia(F)))},BundleGroupModifier.prototype.createBundleFromMedia=function(F){return F.map((function(F){var B;return null===(B=F.mid)||void 0===B?void 0:B.toString()})).filter((function(F){return F})).join(" ")},BundleGroupModifier}();B.BundleGroupModifier=xe;var Ue=function(){function BundleOnlyMediaFixup(){}return BundleOnlyMediaFixup.prototype.modify=function(F){F.media.forEach((function(F){0===F.port&&F.bundleOnly&&(F.port=9,delete F.invalid)}))},BundleOnlyMediaFixup}();B.BundleOnlyMediaFixup=Ue;var je=function(){function NoBundleInAnswerFixup(F,B){this.configProvider=F,this.mediaManager=B}return NoBundleInAnswerFixup.prototype.modify=function(F){var B=this;if(!(this.configProvider.mediaConfig.isTransportUnbundled||F.groups&&F.groups.find((function(F){return"BUNDLE"===F.type})))){var G=!1;if(F.media.forEach((function(F,W){var z=B.mediaManager.getMediaEntities()[W];!G&&z.isEnabled()?(F.mid=z.getMid(),G=!0):(z.disable(),F.port=0)})),G){F.groups||(F.groups=[]);var W={type:"BUNDLE"};F.groups.push(W)}}},NoBundleInAnswerFixup}();B.NoBundleInAnswerFixup=je;var Be=function(){function CandidatesFixup(F,B){this.configProvider=F,this.logger=B}return CandidatesFixup.prototype.modify=function(F){var B=this;F.media.forEach((function(F){var G=!!F.candidates;if(F.candidates&&(F.candidates=F.candidates.filter((function(F){var G=!0,W=!0,z=!0;return B.configProvider.config.iceCandidateType&&(G=!!F.type.match(new RegExp(B.configProvider.config.iceCandidateType,"i"))),B.configProvider.config.iceCandidateTransport&&(W=!!F.transport.match(new RegExp(B.configProvider.config.iceCandidateTransport,"i"))),B.configProvider.config.iceCandidateFilterMDns&&((z=!B.isMdns(F.ip))||B.logger.safe.info("Filtering out mDNS candidate ".concat(Y.scrubMriOrOmit(F.ip),":").concat(Y.scrubMriOrOmit(F.port)))),G&&W&&z}))),G&&F.connection&&B.configProvider.config.iceCandidateFilterMDns&&(F.candidates&&0!==F.candidates.length||(F.candidates=[getDummyCandidate(F.port)]),B.isMdns(F.connection.ip)||!B.hasMatchingCandidate(F))){var W=B.getDefaultCandidate(F);F.connection.ip=W.ip,F.port=W.port}}))},CandidatesFixup.prototype.hasMatchingCandidate=function(F){var B=F.connection;return B&&!!F.candidates.find(this.createIpAndPortMatcher(B.ip,F.port))},CandidatesFixup.prototype.getDefaultCandidate=function(F){return F.candidates.slice().sort((function(F,B){return F.type===B.type?0:"host"===F.type||"relay"===B.type?1:"relay"===F.type||"host"===B.type?-1:0}))[0]},CandidatesFixup.prototype.isMdns=function(F){return F.indexOf(".local")>-1||F.indexOf(".encrypted")>-1},CandidatesFixup.prototype.createIpAndPortMatcher=function(F,B){return function(G){return G.ip===F&&G.port===B}},CandidatesFixup}();B.CandidatesFixup=Be;var He=function(){function NoCandidatesFixup(){}return NoCandidatesFixup.prototype.modify=function(F){var B=getEnabledMedia(F)[0];B&&(B.candidates=[getDummyCandidate()])},NoCandidatesFixup}();B.NoCandidatesFixup=He;var Ve=function(){function SimulcastFromMsSDPMediaFixup(F){this.mediaManager=F}return SimulcastFromMsSDPMediaFixup.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){B.fromMsSdp(F,G)}))},SimulcastFromMsSDPMediaFixup.prototype.fromMsSdp=function(F,B){if(!F.rids||!F.simulcast){var G=this.mediaManager.getMediaEntities()[B],W=null==G?void 0:G.getSimulcastContext();(null==W?void 0:W.shouldBeEnabledInRemoteDesc())&&(W.enableInRemoteDesc(),F.simulcast={dir1:"recv",list1:W.ridList.map((function(F){return"".concat(W.activeRids.includes(F)?"":"~").concat(F)})).join(";")},F.rids=W.ridList.map((function(F){return{id:F,direction:"recv"}})))}},SimulcastFromMsSDPMediaFixup}();B.SimulcastFromMsSDPMediaFixup=Ve;var Ge=function(){function SimulcastToMsSDPMediaFixup(F,B){this.mediaManager=F,this.logger=B}return SimulcastToMsSDPMediaFixup.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){B.toMsSdp(F,G)}))},SimulcastToMsSDPMediaFixup.prototype.toMsSdp=function(F,B){var G=this.mediaManager.getMediaEntities()[B],W=null==G?void 0:G.getSimulcastContext();W&&(W.localDescriptionIsApplied(),W.shouldBeEnabledInLocalDesc()&&(W.enableInLocalDesc(),this.removeSimulcastEnvelope(F),this.addStreamSsrc(F,G.getLocalSsrc())))},SimulcastToMsSDPMediaFixup.prototype.removeSimulcastEnvelope=function(F){F.rids&&delete F.rids,F.simulcast&&delete F.simulcast},SimulcastToMsSDPMediaFixup.prototype.addStreamSsrc=function(F,B){if(B)if(F.ssrcs)this.logger.safe.debug("Media mid: ".concat(F.mid," already contains ssrc: ").concat(JSON.stringify(F.ssrcs)));else{var G=B;this.setSsrc(F,G)}},SimulcastToMsSDPMediaFixup.prototype.setSsrc=function(F,B){F.ssrcs=[{id:B,attribute:"fake_attribute",value:"fake_value"}]},SimulcastToMsSDPMediaFixup}();B.SimulcastToMsSDPMediaFixup=Ge;var We=function(){function AddMsidFixup(F){this.mediaManager=F}return AddMsidFixup.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){var W,z=B.mediaManager.getMediaEntities()[G];!F.msid&&(null===(W=null==z?void 0:z.getSimulcastContext())||void 0===W?void 0:W.shouldUseSimulcast())&&z.getLocalTrackId()&&(F.msid="- ".concat(z.getLocalTrackId()))}))},AddMsidFixup}();B.AddMsidFixup=We;var qe=function(){function AddVLAHeaderExtension(F,B){this.mediaManager=F,this.configProvider=B}return AddVLAHeaderExtension.prototype.modify=function(F){var B=this;F.media.forEach((function(F,G){var W,z,K=ee.getModalityForMedia(F);if(B.configProvider.config.enableVla&&("Video"===K||"ScreenShare"===K)&&!(null===(W=F.ext)||void 0===W?void 0:W.find((function(F){return F.uri===X.default.VLA.EXT_URI})))){var J=B.mediaManager.getMediaEntities()[G],Q=null==J?void 0:J.getRtpHeaderExtensions(),Y=Q?null===(z=Q.find((function(F){return"vla"===F.headerType})))||void 0===z?void 0:z.value:getFreeValueForExt(F.ext,B.configProvider.config.extmapAllowMixed,X.default.VLA.DEFAULT_VALUE);Y&&(F.ext=F.ext||[],F.ext.push({value:Y,uri:X.default.VLA.EXT_URI}))}}))},AddVLAHeaderExtension}();B.AddVLAHeaderExtension=qe;var ze=function(){function RemoveVLAHeaderExtension(F){this.configProvider=F}return RemoveVLAHeaderExtension.prototype.modify=function(F){var B=this;F.media.forEach((function(F){var G,W=ee.getModalityForMedia(F);if(!(B.configProvider.config.allowRemoteVla&&("Video"===W||"ScreenShare"===W))){var z=null===(G=F.ext)||void 0===G?void 0:G.findIndex((function(F){return F.uri===X.default.VLA.EXT_URI}));z>-1&&F.ext.splice(z,1)}}))},RemoveVLAHeaderExtension}();B.RemoveVLAHeaderExtension=ze;var Ke=function(){function VLADecoratorExtension(F){this.configProvider=F}return VLADecoratorExtension.prototype.modify=function(F,B,G){var W=this;F.media.forEach((function(F){var z,K,J=ee.getModalityForMedia(F);if(W.configProvider.config.enableNonAdvVla&&("Video"===J||"ScreenShare"===J)&&!(null===(z=F.ext)||void 0===z?void 0:z.find((function(F){return F.uri===G})))){var Q=null===(K=F.ext)||void 0===K?void 0:K.find((function(F){return F.uri===B}));Q&&(Q.uri=G)}}))},VLADecoratorExtension}(),Je=function(F){function AddNonAdvVLADecoratorExtension(B){return F.call(this,B)||this}return z(AddNonAdvVLADecoratorExtension,F),AddNonAdvVLADecoratorExtension.prototype.modify=function(B){F.prototype.modify.call(this,B,X.default.VLA.EXT_URI,X.default.VLA.EXT_URI_NON_ADV)},AddNonAdvVLADecoratorExtension}(Ke);B.AddNonAdvVLADecoratorExtension=Je;var Qe=function(F){function RemoveNonAdvVLADecoratorExtension(B){return F.call(this,B)||this}return z(RemoveNonAdvVLADecoratorExtension,F),RemoveNonAdvVLADecoratorExtension.prototype.modify=function(B){F.prototype.modify.call(this,B,X.default.VLA.EXT_URI_NON_ADV,X.default.VLA.EXT_URI)},RemoveNonAdvVLADecoratorExtension}(Ke);B.RemoveNonAdvVLADecoratorExtension=Qe;var Ye=function(){function ExtUriNormalizer(){}return ExtUriNormalizer.prototype.modify=function(F){var B=this;F.media.forEach((function(F){var G;null===(G=F.ext)||void 0===G||G.forEach((function(F){return F.uri=B.normalizeSlashesInUri(F.uri)}))}))},ExtUriNormalizer.prototype.normalizeSlashesInUri=function(F){return F.replace(/\\/g,"/")},ExtUriNormalizer}();B.ExtUriNormalizer=Ye;var $e=function(){function PartialIceRestartFixup(F){this.configProvider=F}return PartialIceRestartFixup.prototype.modify=function(F){if(this.configProvider.config.fixSdpForPartialIceRestart){var B=J(F.media,1)[0],G=void 0===B?{}:B,W=G.iceUfrag,z=G.icePwd;void 0!==W&&void 0!==z&&F.media.forEach((function(F){F.iceUfrag=W,F.icePwd=z}))}},PartialIceRestartFixup}();function disabledMedia(F,B,G,W){var z={type:F,port:0,label:B,payloads:F===X.default.MEDIA_TYPE.dataChannel||F===X.default.MEDIA_TYPE.data?X.default.PAYLOAD_TYPE.DATA_CHANNEL:"36",protocol:G,connection:{ip:"10.10.10.10",version:4}};return W&&(z.mid=W),z}function getEnabledMedia(F,B){return void 0===B&&(B=null),F.media.filter((function(F){return 0!==F.port&&(!B||F.type===B)}))}function getDummyCandidate(F){return void 0===F&&(F=1234),{component:1,ip:"10.10.10.10",foundation:1755259772,priority:2122197247,port:F!==9?F:1234,transport:"UDP",type:"host"}}function getFreeValueForExt(F,B,G,W){if(void 0===W&&(W=!1),!(null==F?void 0:F.length))return G;var z,K=2,Y=14,$=F.map((function(F){return F.value}));if(W&&!$.includes(G))return G;for(var X=K;X<=Y;X++)if(!$.includes(X)){z=X;break}return!z&&B&&(z=Math.max.apply(Math,Q([],J($),!1))+1),z}B.PartialIceRestartFixup=$e,B.disabledMedia=disabledMedia},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))},K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.NormalizedLossRateCalculator=B.OvershootTracker=B.SelfWeightedHarmonicMeanCalculator=B.SampleDurationTracker=B.HistogramCollector=B.LastSampleDelta=B.ModeCounter=B.ArithmeticAverager=void 0;var J=G(4),Q=G(1),Y=function(){function ArithmeticAverager(){this.total=0,this.duration=0,this.max=0,this.min=Number.MAX_SAFE_INTEGER}return Object.defineProperty(ArithmeticAverager.prototype,"avg",{get:function(){return 0!==this.duration?this.total/this.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(ArithmeticAverager.prototype,"maxSample",{get:function(){return this.max},enumerable:!1,configurable:!0}),Object.defineProperty(ArithmeticAverager.prototype,"minSample",{get:function(){return this.min},enumerable:!1,configurable:!0}),ArithmeticAverager.prototype.captureSample=function(F){(F||0===F)&&(this.total+=F,this.duration++,this.max=Math.max(F,this.max),this.min=Math.min(F,this.min))},ArithmeticAverager}();B.ArithmeticAverager=Y;var $=function(){function ModeCounter(){this.sampleCounts={}}return Object.defineProperty(ModeCounter.prototype,"min",{get:function(){var F=Object.keys(this.sampleCounts).map(Number).filter((function(F){return F>0}));return F.length>0?Math.min.apply(Math,z([],W(F),!1)):0},enumerable:!1,configurable:!0}),Object.defineProperty(ModeCounter.prototype,"max",{get:function(){var F=Object.keys(this.sampleCounts).map(Number);return F.length>0?Math.max.apply(Math,z([],W(F),!1)):0},enumerable:!1,configurable:!0}),Object.defineProperty(ModeCounter.prototype,"mode",{get:function(){var F=this,B=Object.keys(this.sampleCounts).map(Number);return B.length>0?B.reduce((function(B,G){return F.sampleCounts[G]>F.sampleCounts[B]?G:B}),B[0]):0},enumerable:!1,configurable:!0}),ModeCounter.prototype.captureSample=function(F){var B,G;if(F){var W="".concat(F);null!==(B=(G=this.sampleCounts)[W])&&void 0!==B||(G[W]=0),this.sampleCounts[W]++}},ModeCounter}();B.ModeCounter=$;var X=function(){function LastSampleDelta(){}return Object.defineProperty(LastSampleDelta.prototype,"delta",{get:function(){if(void 0!==this.cur&&void 0!==this.last)return this.cur-this.last},enumerable:!1,configurable:!0}),LastSampleDelta.prototype.captureSample=function(F){void 0!==F&&(void 0!==this.cur&&(this.last=this.cur),this.cur=F)},LastSampleDelta}();B.LastSampleDelta=X;var Z=function(){function ActiveHistogramEvent(){this.startTime=Date.now()}return Object.defineProperty(ActiveHistogramEvent.prototype,"elapsed",{get:function(){return Q.round((Date.now()-this.startTime)/1e3,0)},enumerable:!1,configurable:!0}),ActiveHistogramEvent}(),ee=function(){function HistogramCollector(){this.eventCount=0,this.totalActiveDuration=0,this.countBuckets={seconds1to3:0,seconds3to5:0,seconds5to8:0,seconds8to15:0,seconds15to60:0,seconds60toMax:0},this.timestampBuckets={seconds1to3:[],seconds3to5:[],seconds5to8:[],seconds8to15:[],seconds15to60:[],seconds60toMax:[]},this.averager=new Y}return Object.defineProperty(HistogramCollector.prototype,"active",{get:function(){return!!this.current},set:function(F){var B,G;if(!this.current&&F)this.current=new Z;else if(this.current&&!F){var W=this.current.elapsed;this.averager.captureSample(W),this.totalActiveDuration+=W;try{for(var z=K(Object.keys(J.default.HISTOGRAM_BATCH)),Q=z.next();!Q.done;Q=z.next()){var Y=Q.value;if(W<=J.default.HISTOGRAM_BATCH[Y]){this.countBuckets[Y]++,this.timestampBuckets[Y].push(this.current.startTime);break}}}catch(F){B={error:F}}finally{try{Q&&!Q.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}this.eventCount++,this.current=void 0}},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,"ongoingDuration",{get:function(){var F;return(null===(F=this.current)||void 0===F?void 0:F.elapsed)||0},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,"avgDuration",{get:function(){return this.averager.avg},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,"longestDuration",{get:function(){return this.averager.maxSample},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,"numEvents",{get:function(){return this.eventCount},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,"totalDuration",{get:function(){return this.current?this.totalActiveDuration+this.current.elapsed:this.totalActiveDuration},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,"timestamps",{get:function(){return Q.deepClone(this.timestampBuckets)},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,"counts",{get:function(){return Q.deepClone(this.countBuckets)},enumerable:!1,configurable:!0}),HistogramCollector}();B.HistogramCollector=ee;var te=function(){function SampleDurationTracker(){this.sampleChangeCount=0,this.sampleDurations={}}return Object.defineProperty(SampleDurationTracker.prototype,"durations",{get:function(){return Q.deepClone(this.sampleDurations)},enumerable:!1,configurable:!0}),Object.defineProperty(SampleDurationTracker.prototype,"durationRatios",{get:function(){var F={},B=0;for(var G in this.sampleDurations)B+=this.sampleDurations[G];for(var G in this.sampleDurations)F[G]=Q.round(this.sampleDurations[G]/B*100);return F},enumerable:!1,configurable:!0}),Object.defineProperty(SampleDurationTracker.prototype,"changeCount",{get:function(){return this.sampleChangeCount},enumerable:!1,configurable:!0}),SampleDurationTracker.prototype.captureSample=function(F){this.sampleDurations[F]||(this.sampleDurations[F]=0),this.sampleDurations[F]++,F!==this.lastSample&&(this.sampleChangeCount++,this.lastSample=F)},SampleDurationTracker}();B.SampleDurationTracker=te;var ne=function(){function SelfWeightedHarmonicMeanCalculator(){this.numSamples=0,this.invertedSum=0}return Object.defineProperty(SelfWeightedHarmonicMeanCalculator.prototype,"harmonicMean",{get:function(){return this.numSamples>0&&this.invertedSum>0?this.numSamples/this.invertedSum:0},enumerable:!1,configurable:!0}),SelfWeightedHarmonicMeanCalculator.prototype.captureSample=function(F){F>0&&(this.invertedSum+=1/F,this.numSamples++)},SelfWeightedHarmonicMeanCalculator}();B.SelfWeightedHarmonicMeanCalculator=ne;var ie=function(){function OvershootTracker(F){void 0===F&&(F=0),this.allowedOvershoot=F,this.past=[],this.totalOvershootDuration=0,this.lastAllowed=0}return Object.defineProperty(OvershootTracker.prototype,"isOvershooting",{get:function(){return!!this.current},enumerable:!1,configurable:!0}),Object.defineProperty(OvershootTracker.prototype,"events",{get:function(){return this.current?z(z([],W(this.past),!1),[this.current],!1):this.past},enumerable:!1,configurable:!0}),Object.defineProperty(OvershootTracker.prototype,"totalDuration",{get:function(){return this.totalOvershootDuration},enumerable:!1,configurable:!0}),OvershootTracker.prototype.captureSample=function(F,B){var G=Q.round(F-B);G>this.allowedOvershoot&&(0===this.lastAllowed||B===this.lastAllowed||!this.current&&B>this.lastAllowed)?(this.totalOvershootDuration++,this.current?(this.current.min=Math.min(this.current.min,G),this.current.max=Math.max(this.current.max,G)):this.current={timestamp:Date.now(),min:G,max:G}):this.current&&(this.current.duration=Date.now()-this.current.timestamp,this.past.push(this.current),this.current=void 0),this.lastAllowed=B},OvershootTracker}();B.OvershootTracker=ie;var re=function(){function NormalizedLossRateCalculator(F){void 0===F&&(F=100),this.minPackets=F,this.prevLost=0,this.prevReceived=0}return NormalizedLossRateCalculator.prototype.calculate=function(F,B){if(void 0!==F&&void 0!==B){var G=F-this.prevReceived,W=B-this.prevLost;if(!(G+W<this.minPackets))return this.prevReceived=F,this.prevLost=B,W*this.minPackets/(W+G)}},NormalizedLossRateCalculator}();B.NormalizedLossRateCalculator=re},function(F,B,G){G.d(B,"a",(function(){return getDebugExt})),G.d(B,"b",(function(){return getDebugListener}));var W,z=G(11),K=["eventsSent","eventsDiscarded","eventsSendRequest","perfEvent"],J=null;function _listenerProxyFunc(F,B){return function(){var G=arguments,W=getDebugExt(B);if(W){var z=W.listener;z&&z[F]&&z[F].apply(z,G)}}}function _getExtensionNamespace(){var F=Object(z.e)("Microsoft");return F&&(J=F.ApplicationInsights),J}function getDebugExt(F){var B=J;return B||!0===F.disableDbgExt||(B=J||_getExtensionNamespace()),B?B.ChromeDbgExt:null}function getDebugListener(F){if(!W){W={};for(var B=0;B<K.length;B++)W[K[B]]=_listenerProxyFunc(K[B],F)}return W}},function(F,B,G){G.d(B,"b",(function(){return te})),G.d(B,"n",(function(){return ce})),G.d(B,"m",(function(){return isValueAssigned})),G.d(B,"h",(function(){return getTenantId})),G.d(B,"l",(function(){return isUint8ArrayAvailable})),G.d(B,"k",(function(){return isLatency})),G.d(B,"p",(function(){return sanitizeProperty})),G.d(B,"e",(function(){return getCommonSchemaMetaData})),G.d(B,"f",(function(){return getCookie})),G.d(B,"g",(function(){return getCookieValue})),G.d(B,"c",(function(){return createGuid})),G.d(B,"d",(function(){return extend})),G.d(B,"i",(function(){return le})),G.d(B,"q",(function(){return setProcessTelemetryTimings})),G.d(B,"a",(function(){return de})),G.d(B,"j",(function(){return isChromium})),G.d(B,"o",(function(){return openXhr}));var W,z=G(2),K=G(29),J=G(19),Q=G(11),Y=G(0),$=G(24),X=G(36),Z=G(21),ee="3.1.11",te="1DS-Web-JS-"+ee,ne="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",ie="withCredentials",re="timeout",oe=((W={})[0]=J.c.Unspecified,W[2]=J.c.Double,W[1]=J.c.String,W[3]=J.c.Bool,W[4098]=J.c.Double,W[4097]=J.c.String,W[4099]=J.c.Bool,W),ae=null,se=Boolean(Object(Q.d)()),ce=Boolean(Object(Q.k)());function isValueAssigned(F){return!(""===F||Object(Y.r)(F))}function getTenantId(F){if(F){var B=F.indexOf("-");if(B>-1)return F.substring(0,B)}return""}function isUint8ArrayAvailable(){return null===ae&&(ae=!Object(Y.x)(Uint8Array)&&!isSafariOrFirefox()&&!Object(Q.p)()),ae}function isLatency(F){return!!(F&&Object(Y.s)(F)&&F>=J.a.Normal&&F<=J.a.Immediate)}function sanitizeProperty(F,B,G){if(!B&&!isValueAssigned(B)||"string"!=typeof F)return null;var W=typeof B;if("string"===W||"number"===W||"boolean"===W||Object(Y.k)(B))B={value:B};else if("object"!==W||B.hasOwnProperty("value")){if(Object(Y.r)(B.value)||""===B.value||!Object(Y.u)(B.value)&&!Object(Y.s)(B.value)&&!Object(Y.l)(B.value)&&!Object(Y.k)(B.value))return null}else B={value:G?JSON.stringify(B):B};if(Object(Y.k)(B.value)&&!isArrayValid(B.value))return null;if(!Object(Y.r)(B.kind)){if(Object(Y.k)(B.value)||!isValueKind(B.kind))return null;B.value=B.value.toString()}return B}function getCommonSchemaMetaData(F,B,G){var W=-1;if(!Object(Y.x)(F))if(B>0&&(32===B?W=8192:B<=13&&(W=B<<5)),isDataType(G))-1===W&&(W=0),W|=G;else{var z=oe[getFieldValueType(F)]||-1;-1!==W&&-1!==z?W|=z:z===J.c.Double&&(W=z)}return W}function disableCookies(){Object($.d)(null).setEnabled(!1)}function setCookie(F,B,G){Object($.b)(null)&&Object($.d)(null).set(F,B,86400*G,null,"/")}function deleteCookie(F){Object($.b)(null)&&Object($.d)(null).del(F)}function getCookie(F){return Object($.b)(null)?getCookieValue(Object($.d)(null),F):""}function getCookieValue(F,B,G){var W;return void 0===G&&(G=!0),F&&(W=F.get(B),G&&W&&decodeURIComponent&&(W=decodeURIComponent(W))),W||""}function createGuid(F){void 0===F&&(F="D");var B=Object(X.f)();return"B"===F?B="{"+B+"}":"P"===F?B="("+B+")":"N"===F&&(B=B.replace(/-/g,"")),B}function extend(F,B,G,W,K){var J={},Q=!1,$=0,X=arguments.length,Z=arguments;for("[object Boolean]"===Object[z.k].toString.call(Z[0])&&(Q=Z[0],$++);$<X;$++){F=Z[$];Object(Y.z)(F,(function(F,B){Q&&B&&Object(Y.t)(B)?Object(Y.k)(B)?(J[F]=J[F]||[],Object(Y.a)(B,(function(B,G){B&&Object(Y.t)(B)?J[F][G]=extend(!0,J[F][G],B):J[F][G]=B}))):J[F]=extend(!0,J[F],B):J[F]=B}))}return J}var le=X.h;function isValueKind(F){return F===J.e.NotSet||F>J.e.NotSet&&F<=J.e.Pii_IPV4AddressLegacy||F===J.e.CustomerContent_GenericContent}function isDataType(F){return F>=0&&F<=9}function isSafariOrFirefox(){var F=Object(Q.i)();if(!Object(Y.x)(F)&&F.userAgent){var B=F.userAgent.toLowerCase();if((B.indexOf("safari")>=0||B.indexOf("firefox")>=0)&&B.indexOf("chrome")<0)return!0}return!1}function isArrayValid(F){return F.length>0}function setProcessTelemetryTimings(F,B){var G=F;G.timings=G.timings||{},G.timings.processTelemetryStart=G.timings.processTelemetryStart||{},G.timings.processTelemetryStart[B]=le()}function getFieldValueType(F){var B=0;if(null!=F){var G=typeof F;"string"===G?B=1:"number"===G?B=2:"boolean"===G?B=3:G===z.j&&(B=4,Object(Y.k)(F)?(B=4096,F.length>0&&(B|=getFieldValueType(F[0]))):Object(Y.j)(F,"value")&&(B=8192|getFieldValueType(F.value)))}return B}z.l,z.j,z.l,Y.a,Y.b,Y.c,Y.d,Y.B,Y.J,Q.p,Y.u,Y.s,Y.l,Y.o,Y.k,Y.t,Y.H,Q.m,Y.J,Q.r,$.b,$.e,Y.y,X.d,X.a,Y.F,Y.z;var de={_canUseCookies:void 0,isTypeof:Y.w,isUndefined:Y.x,isNullOrUndefined:Y.r,hasOwnProperty:Y.j,isFunction:Y.o,isObject:Y.t,isDate:Y.m,isArray:Y.k,isError:Y.n,isString:Y.u,isNumber:Y.s,isBoolean:Y.l,toISOString:Y.J,arrForEach:Y.a,arrIndexOf:Y.b,arrMap:Y.c,arrReduce:Y.d,strTrim:Y.H,objCreate:K.b,objKeys:Y.B,objDefineAccessors:Y.y,addEventHandler:X.a,dateNow:Y.f,isIE:Q.o,disableCookies:disableCookies,newGuid:X.f,perfNow:X.h,newId:X.g,randomValue:Z.d,random32:Z.c,mwcRandomSeed:Z.b,mwcRandom32:Z.a,generateW3CId:X.e};function isChromium(){return!!Object(Q.e)("chrome")}function openXhr(F,B,G,W,z,K){function _wrapSetXhrProp(F,B,G){try{F[B]=G}catch(F){}}void 0===W&&(W=!1),void 0===z&&(z=!1);var J=new XMLHttpRequest;return W&&_wrapSetXhrProp(J,ne,W),G&&_wrapSetXhrProp(J,ie,G),J.open(F,B,!z),G&&_wrapSetXhrProp(J,ie,G),!z&&K&&_wrapSetXhrProp(J,re,K),J}},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.reason=B.callStartOptions=B.causeId=B.operationId=B.participantOperation=B.callOperation=B.IDEMPOTENCY_LEVEL=B.OPERATION_TYPE=void 0;var K,J=G(41),Q=G(13),Y=G(69);!function(F){F.CHAINED="Chained",F.SYNC="Sync",F.ASYNC="Async"}(K=B.OPERATION_TYPE||(B.OPERATION_TYPE={}));var $,X,Z="_operationIdValue_",ee="_causeIdValue_",te="_callStartOptionsValue_",ne="_clientReasonValue_";function callOperation(F,B){return operationDecorator(X.CALL,F,B)}function participantOperation(F,B){return operationDecorator(X.PARTICIPANT,F,B)}!function(F){F.NO_OP="NoOp",F.ERROR="Error"}($=B.IDEMPOTENCY_LEVEL||(B.IDEMPOTENCY_LEVEL={})),function(F){F[F.CALL=0]="CALL",F[F.PARTICIPANT=1]="PARTICIPANT"}(X||(X={})),B.callOperation=callOperation,B.participantOperation=participantOperation;var operationId=function(F,B,G){if(F[B][Z])throw new Error("can not specify more than one operation id");F[B][Z]=G};B.operationId=operationId;var causeId=function(F,B,G){if(F[B][ee])throw new Error("can not specify more than one cause id");F[B][ee]=G};B.causeId=causeId;var callStartOptions=function(F,B,G){if(F[B][te])throw new Error("can not specify options more than once");F[B][te]=G};B.callStartOptions=callStartOptions;var reason=function(F,B,G){if(F[B][ne])throw new Error("can not specify reason more than once");F[B][ne]=G};B.reason=reason;var operationDecorator=function(F,B,G){return function(X,ie,re){var oe,ae,se,ce,le=re.value,de=null===(oe=X[ie])||void 0===oe?void 0:oe[Z],ue=null===(ae=X[ie])||void 0===ae?void 0:ae[ee],pe=null===(se=X[ie])||void 0===se?void 0:se[te],he=null===(ce=X[ie])||void 0===ce?void 0:ce[ne],ge=(null==G?void 0:G.type)||K.ASYNC;return re.value=function(){for(var X=this,Z=[],ee=0;ee<arguments.length;ee++)Z[ee]=arguments[ee];var te=this,ne=void 0!==de?Z[de]:void 0;if(void 0!==ne)if(Array.isArray(ne))try{var ie=ne.map((function(F){return F.toString()})).sort().concat().toString();ne=getStringHash(ie).toString()}catch(F){return Promise.reject(32)}else if(ne&&"object"==typeof ne)try{var re=JSON.stringify(ne);G&&G.operationIdKey&&ne.hasOwnProperty(G.operationIdKey)&&(re=ne[G.operationIdKey]),ne=re}catch(F){return Promise.reject(32)}var oe,ae=(0,Q.generateCauseId)();void 0!==ue&&(Z[ue]&&(0,Q.validateCauseId)(Z[ue])?ae=Z[ue]:Z[ue]=ae),void 0!==he&&Z[he]&&(oe=Z[he]);var se=getOperationHandler(te,F);if(se.logOperation(ae,B),G&&G.singular&&se.hasPendingOperation(B))return se.logOperation(ae,B,"Not allowed, pending operation exists"),Promise.reject(60);var ce=se.getEcsConfig();if(ce&&ce.enableOperationIdempotency&&G&&G.idempotencyLevel&&se.getRecord(B)>0)switch(se.logOperation(ae,B,"Called multiple times, handling operation according to specified policy: idempotency=".concat(G.idempotencyLevel)),G.idempotencyLevel){case $.NO_OP:return Promise.resolve();case $.ERROR:return Promise.reject(60)}try{void 0!==pe&&Z[pe]&&te.processCallStartOptions(Z[pe],ae)}catch(F){return Promise.reject(32)}var fe=!(!G||!G.convertError),execute=function(){return ge===K.CHAINED?se.executeChained(le.bind.apply(le,z([X],W(Z),!1)),B,ne,ae,fe,oe,G):ge===K.SYNC?se.executeSync(le.bind.apply(le,z([X],W(Z),!1)),B,ne,ae,fe,oe):se.execute(le.bind.apply(le,z([X],W(Z),!1)),B,ne,ae,fe,oe,G)};if(B!==J.CALL_OPERATIONS.START_CALL&&B!==J.CALL_OPERATIONS.JOIN_CALL||se.hasPendingOperation(J.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED)||se.createPendingOperation(J.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED).catch(Y.noop),G&&G.triggerAttach&&(se.hasPendingOperation(J.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY)||se.createPendingOperation(J.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY).catch(Y.noop)),G&&G.type!==K.SYNC){var me=G&&G.waitFor;if(Array.isArray(me))return Promise.all(me.map((function(F){return F&&se.hasPendingOperation(F)&&se.waitForOperation(F,void 0,ae)}))).then(execute,execute);if(me&&se.hasPendingOperation(me))return se.waitForOperation(me,void 0,ae).then(execute,execute)}return execute()},re}},getOperationHandler=function(F,B){if(B===X.CALL)return F._callOperationHandler;if(B===X.PARTICIPANT)return F._participantOperationHandler;throw new Error("Unsupported operation handler type!")};function getStringHash(F){for(var B=0,G=0;G<F.length;G++){B=(B<<5)-B+F.charCodeAt(G),B|=0}return B}},function(F,B,G){function noop(){}Object.defineProperty(B,"__esModule",{value:!0}),B.noop=void 0,B.noop=noop},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},Y=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0});var $=G(17),X=G(178),Z=G(13),ee=G(179),te=G(71),ne=G(14),ie=G(180),re=function(F){function OperationHandler(B,G,W,z,K){var J=F.call(this,B)||this;return J.callTelemetry=G,J._ecsConfig=W,J._publishCallback=z,J._preconditionFunction=K,J._record={},J.logSuccess=function(F,B,G){J._logger.info("".concat(F," execution succeeded, result=").concat(B?J.stringifyForLogging(B):"void",", time=").concat(G.duration()))},J.logFailure=function(F,B,G){J._logger.info("".concat(F," execution failed, reason=").concat(J.stringifyForLogging(B),", time=").concat(G.duration()))},J.logTimeout=function(F,B,G){J._logger.info("".concat(F," execution timed out, reason=").concat(J.stringifyForLogging(B),", time=").concat(G.duration()))},J.stringifyForLogging=function(F){var B;if(F instanceof Error)B=F.toString()||"Unknown Error";else try{B=JSON.stringify(F)}catch(F){B="Unable to stringify data"}return B},J.convertToTransactionEndIfErrorOrString=function(F,B,G){if(J._logger.info("ecsEnableErrorConversion in operationHandler is: ".concat(J._ecsConfig&&J._ecsConfig.enableErrorConversion)),B&&J._ecsConfig&&J._ecsConfig.enableErrorConversion&&("string"==typeof F||F instanceof Error)){var W=(0,te.getRejectTransactionEnd)(F);return J._logger.info("".concat(G," Error converted from ").concat(F," to ").concat((0,ne.getPrintableObject)(W))),W}return F},J._logger=B.createChild("[Operation]"),J._chainedPromise=new ee.default(J._logger.createChild("[Chained]")),J}return z(OperationHandler,F),OperationHandler.prototype.resetOperationChain=function(F){this._chainedPromise.reset(F)},OperationHandler.prototype.executeSync=function(F,B,G,W,z,K){void 0===W&&(W=(0,Z.generateCauseId)());var J=this.getOperationInfoForLogging(W,B,G),Q=ie.build();this._logger.info("".concat(J,"API calledSync"));var Y,$=this.callTelemetry.recordOperation(B,W,G,K);try{this._setRecord(B),Y=F(),$.recordSuccess(Y,W),this.logSuccess(J,Y,Q)}catch(F){var X=this.convertToTransactionEndIfErrorOrString(F,z,J);$.recordFailure(X,W),this.logFailure(J,X,Q)}return Y},OperationHandler.prototype.executeChained=function(F,B,G,W,z,Q,Y){return void 0===W&&(W=(0,Z.generateCauseId)()),K(this,void 0,void 0,(function(){return J(this,(function(K){return[2,this.checkPendingOperationAndExecute(F,!0,B,G,W,z,Q,Y)]}))}))},OperationHandler.prototype.execute=function(F,B,G,W,z,Q,Y){return void 0===W&&(W=(0,Z.generateCauseId)()),K(this,void 0,void 0,(function(){return J(this,(function(K){return[2,this.checkPendingOperationAndExecute(F,!1,B,G,W,z,Q,Y)]}))}))},OperationHandler.prototype.logOperation=function(F,B){for(var G=this,W=[],z=2;z<arguments.length;z++)W[z-2]=arguments[z];var K=W.length&&W.map((function(F){return G.stringifyForLogging($.scrubMriOrOmit(F))}));this._logger.info("[".concat(F,"][").concat(B,"]API called, ").concat(K?"with args=".concat(K):""))},OperationHandler.prototype.rejectPendingOperations=function(B,G,W){var z,K,J,Y,$,X;if(void 0===G&&(G=(0,Z.generateCauseId)()),W){try{for(var ee=Q(Object.keys(this._deferredOperations)),te=ee.next();!te.done;te=ee.next()){var ne=te.value;this.callTelemetry.maybeRecordOperationFailure(ne,W,void 0,G)}}catch(F){z={error:F}}finally{try{te&&!te.done&&(K=ee.return)&&K.call(ee)}finally{if(z)throw z.error}}try{for(var ie=Q(Object.keys(this._deferredOperationsWithOperationId)),re=ie.next();!re.done;re=ie.next()){ne=re.value;try{for(var oe=($=void 0,Q(Object.keys(this._deferredOperationsWithOperationId[ne]))),ae=oe.next();!ae.done;ae=oe.next()){var se=ae.value;this.callTelemetry.maybeRecordOperationFailure(ne,W,se,G)}}catch(F){$={error:F}}finally{try{ae&&!ae.done&&(X=oe.return)&&X.call(oe)}finally{if($)throw $.error}}}}catch(F){J={error:F}}finally{try{re&&!re.done&&(Y=ie.return)&&Y.call(ie)}finally{if(J)throw J.error}}}F.prototype.rejectPendingOperations.call(this,B,G)},OperationHandler.prototype.maybeRejectOperations=function(B,G,W,z,K){var J,Y;if(void 0===z&&(z=(0,Z.generateCauseId)()),K)try{for(var $=Q(B),X=$.next();!X.done;X=$.next()){var ee=X.value;this.callTelemetry.maybeRecordOperationFailure(ee,K,void 0,z)}}catch(F){J={error:F}}finally{try{X&&!X.done&&(Y=$.return)&&Y.call($)}finally{if(J)throw J.error}}F.prototype.maybeRejectOperations.call(this,B,G,W,z)},OperationHandler.prototype.checkPendingOperationAndExecute=function(F,B,G,W,z,K,J,Q){var Y=this;void 0===z&&(z=(0,Z.generateCauseId)());var $=this.getOperationInfoForLogging(z,G,W),X=null,ee=null;return this.hasPendingOperationWithOperationId(G,W)||this.hasPendingOperation(G)?(this._logger.info("".concat($,"already pending, returning existing operation")),X=this.waitForOperation(G,W,z)):ee=this.createPendingOperation(G,W,z,Q),B?(this._logger.info("".concat($,"chained")),this._chainedPromise.chainPromise((function(){return X||Y.executeInternal(ee,z,F,G,W,K,J,Q)}),G,z)):X||this.executeInternal(ee,z,F,G,W,K,J,Q)},OperationHandler.prototype._setRecord=function(F){this._record.hasOwnProperty(F)||(this._record[F]=0),this._record[F]+=1},OperationHandler.prototype.getRecord=function(F){return this._record[F]},OperationHandler.prototype._recordTelemetryTimeoutAndPublish=function(F,B,G,W,z,K,J){var Q=this,Y=F||60;return window.setTimeout((function(){if(Q._publishCallback){if(Q.hasPendingOperationWithOperationId(W,J)||Q.hasPendingOperation(W)){var F=new Error("".concat(z," execution did not complete before telemetry timeout of ").concat(Y,"s."));Q.logTimeout(z,F,K),Q.callTelemetry.maybeRecordOperationTimeout(W,F,J,G),Q._publishCallback(B),Q.callTelemetry.removeRecordedEvent(B)}}else Q._logger.warn("".concat(z," is marked to publish telemetry but no publish callback is defined."))}),1e3*Y)},OperationHandler.prototype._instantTelemetryPublish=function(F,B){this._publishCallback?(this._publishCallback(B),this.callTelemetry.removeRecordedEvent(B)):this._logger.warn("".concat(F," is marked to publish telemetry but no publish callback is defined."))},OperationHandler.prototype.parseInstantTelemetryParameters=function(F){var B,G=!1;return F&&(G=F.enableInstantTelemetry&&!this._ecsConfig.disableInstantTelemetry,B=F.telemetryTimeout),[G,B]},OperationHandler.prototype.executeInternal=function(F,B,G,W,z,Q,$,X){var Z;return K(this,void 0,void 0,(function(){var K,ee,te,ne,re,oe,ae,se,ce,le;return J(this,(function(J){switch(J.label){case 0:K=this.getOperationInfoForLogging(B,W,z),this._logger.info("".concat(K," executing operation...")),ee=ie.build(),te=this.callTelemetry.recordOperation(W,B,z,$),ne=Y(this.parseInstantTelemetryParameters(X),2),re=ne[0],oe=ne[1],J.label=1;case 1:return J.trys.push([1,3,,4]),this._setRecord(W),ae=void 0,re&&(ae=this._recordTelemetryTimeoutAndPublish(oe,te,B,W,K,ee,z)),(null===(Z=null==X?void 0:X.preconditionTags)||void 0===Z?void 0:Z.length)&&this._preconditionFunction&&this._preconditionFunction(W,X.preconditionTags),[4,G()];case 2:return se=J.sent(),ae&&clearTimeout(ae),this.callTelemetry.maybeRecordOperationSuccess(W,se,z),this.logSuccess(K,se,ee),this.maybeResolveOperation(W,se,z,B),[3,4];case 3:return ce=J.sent(),le=this.convertToTransactionEndIfErrorOrString(ce,Q,K),this.callTelemetry.maybeRecordOperationFailure(W,le,z),this.logFailure(K,le,ee),this.maybeRejectOperation(W,le,z,B),[3,4];case 4:return re&&this._instantTelemetryPublish(K,te),[2,F]}}))}))},OperationHandler.prototype.getEcsConfig=function(){return this._ecsConfig},OperationHandler}(X.default);B.default=re},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getSuccessTransactionEnd=B.getRejectTransactionEnd=B.isTransactionEnd=void 0;var W=G(41),z=G(14);function isTransactionEnd(F){return!(!F||!F.code)}function getRejectTransactionEnd(F,B){return isTransactionEnd(F)?F:{code:W.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:void 0!==B?B:W.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:"string"==typeof F?F:(0,z.getPrintableObject)(F)}}function getSuccessTransactionEnd(){return{code:W.TRANSACTION_END_CODE.SUCCESS}}B.isTransactionEnd=isTransactionEnd,B.getRejectTransactionEnd=getRejectTransactionEnd,B.getSuccessTransactionEnd=getSuccessTransactionEnd},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var z=G(8),K=G(3),J=function(){function Participant(F){this.id=F.id,this.displayName=F.displayName||"",this.languageId=F.languageId||null,this.endpointDetails=F.endpointDetails||[],this.acceptedBy=F.acceptedBy,this.role=F.role,this.tenantId=F.tenantId,this.isLobby=F.isLobby,this.meetingRole=F.meetingRole,this.advancedMeetingRole=F.advancedMeetingRole,this.participantId=F.participantId,this.publishedStates=F.publishedStates,this.isIdentityMasked=F.isIdentityMasked,this.nonMaskedId=F.nonMaskedId,this.nonMaskedDisplayName=F.nonMaskedDisplayName,this.nonMaskedObjectId=F.nonMaskedObjectId,this.maskedIdSeqNumber=F.maskedIdSeqNumber}return Participant.isInLobby=function(F,B){var G,z;try{for(var K=W(F),J=K.next();!J.done;J=K.next()){var Q=J.value;if(Q.endpointId===B&&Q.isLobby)return!0}}catch(F){G={error:F}}finally{try{J&&!J.done&&(z=K.return)&&z.call(K)}finally{if(G)throw G.error}}return!1},Participant.isParticipantServerMuted=function(F){var B,G,z,K;try{for(var J=W(F),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;if(Y.mediaStreams&&!Y.mappedTo)try{for(var $=(z=void 0,W(Y.mediaStreams)),X=$.next();!X.done;X=$.next()){var Z=X.value;if("audio"===Z.type&&!0===Z.serverMuted)return!0}}catch(F){z={error:F}}finally{try{X&&!X.done&&(K=$.return)&&K.call($)}finally{if(z)throw z.error}}}}catch(F){B={error:F}}finally{try{Q&&!Q.done&&(G=J.return)&&G.call(J)}finally{if(B)throw B.error}}return!1},Participant.fromWireParticipant=function(F){return K.assertNotNull(F,"invalid wireParticipant"),K.assertNotNullOrEmpty(F.id,"participant must have valid Id"),new Participant({id:F.id,displayName:F.displayName,languageId:F.languageId,acceptedBy:F.acceptedBy})},Participant.getPluginlessStateTypeFromWire=function(F){switch(F){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"attendeeVideoUnrestricted":return"attendeeVideoUnrestricted";case"spotlight":return"spotlight";case"manageBreakoutRooms":return"manageBreakoutRooms";default:throw"Invalid state type when converting PublishType to PublishStateType."}},Participant.findOrCreateTypeState=function(F,B){var G=B.typeStates.findIndex((function(B){return B.type===F}));if(-1===G){var W={participantStates:[],type:F};B.typeStates.push(W),G=B.typeStates.length-1}return G},Participant.processPublishedStates=function(F,B){var G=this,W={typeStates:[]};W.typeStates=[];var K=F;return z.forEach(K,(function(F){var z=G.findOrCreateTypeState(G.getPluginlessStateTypeFromWire(F.stateType),W),K={id:B,publishedState:{content:F.content,stateId:F.stateId,typeRank:F.typeRank}};W.typeStates[z].participantStates.push(K)})),W},Participant.fromRosterEndpoints=function(F){var B=!1,G=!1,W=!1,z=!1,K=!1;return{endpointDetails:Object.keys(F).map((function(J){var Q,Y,$=[],X=!1,Z=0;if(F[J].call&&(B=!0,$=F[J].call.mediaStreams||null,Z=F[J].call.serverMuteVersion||0,Y=F[J].call.appliedInteractivityLevel||"unknown"),F[J].lwj&&(G=!0,Q=F[J].lwj.lwjSessionInformation||null),F[J].lobby&&(X=!0,W=!0,$=F[J].lobby.mediaStreams||null,Q=F[J].lobby.lwjSessionInformation||null),F[J].mappedParticipant&&(z=!0,$=F[J].mappedParticipant.mediaStreams||null),!F[J].capabilities&&F[J].endpointCapabilities){var ee=F[J].endpointCapabilities;F[J].capabilities={implicitCallback:16&ee?"enabled":"disabled",cloudAudioVideoConference:1&ee?"enabled":"disabled",cloudScreenSharing:2&ee?"enabled":"disabled",hostlessConference:4&ee?"enabled":"disabled",autoJoinOnConflict:32&ee?"enabled":"disabled",serverMuteUnmute:64&ee?"enabled":"disabled",supportsCompressedServicePayload:128&ee?"enabled":"disabled",cloudMerge:8&ee?"enabled":"disabled"}}return K=K||!!F[J].streamLobby||!!F[J].stream,{endpointId:J,participantId:F[J].participantId||null,clientVersion:F[J].clientVersion||null,endpointMetadata:F[J].endpointMetadata||null,originalId:F[J].originalId||null,contentSharing:F[J].contentSharing||null,capabilities:F[J].capabilities||null,endpointType:F[J].endpointType||"default",deviceType:F[J].deviceType||void 0,clientEndpointCapabilities:F[J].clientEndpointCapabilities||void 0,mediaStreams:$,serverMuteVersion:Z,lwjSessionInformation:Q,isLobby:X,endpointState:F[J].endpointState||null,publishedStates:F[J].publishedStates||null,callLinks:F[J].callLinks||null,appliedInteractivityLevel:Y||"unknown",mappedTo:F[J].mappedTo||null,meetingGroupDetails:F[J].meetingGroupDetails,streamInformation:F[J].streamInformation,streamLobby:F[J].streamLobby,stream:F[J].stream}})),participantHasCallModality:B,participantHasLightWeightMeetingModality:G,participantIsInLobby:W,participantHasMappedEndpoint:z,participantHasStreamEndpoint:K}},Participant.fromRoster=function(F,B){void 0===B&&(B=!1),K.assertNotNull(F,"invalid rosterParticipant ".concat(JSON.stringify(F))),K.assertNotNullOrEmpty(F.details.id,"participant must have valid Id");var G=F.endpoints||{},W=this.fromRosterEndpoints(G),z=W.endpointDetails,J=W.participantHasCallModality,Q=W.participantHasLightWeightMeetingModality,Y=W.participantHasMappedEndpoint,$=W.participantHasStreamEndpoint,X=W.participantIsInLobby;return J||Q||X||Y||B||$?((J||Q)&&(X=!1),new Participant({id:F.details.id,displayName:F.details.displayName,languageId:F.details.languageId,role:F.role||"",tenantId:F.details.tenantId||"",endpointDetails:z||[],acceptedBy:F.acceptedBy||"",isLobby:X,meetingRole:F.meetingRole,advancedMeetingRole:F.advancedMeetingRole,participantId:F.details.participantId,publishedStates:F.publishedStates||null,isIdentityMasked:F.details.isIdentityMasked,nonMaskedId:F.details.nonMaskedId||"",nonMaskedObjectId:F.details.nonMaskedObjectId||"",nonMaskedDisplayName:F.details.nonMaskedDisplayName||"",maskedIdSeqNumber:F.details.maskedIdSeqNumber||0})):null},Participant.fromRosterSearchResults=function(F){K.assertNotNull(F,"invalid rosterParticipant ".concat(JSON.stringify(F))),K.assertNotNullOrEmpty(F.details.id,"participant must have valid Id");var B=F.endpoints,G=this.fromRosterEndpoints(B),W=G.endpointDetails,z=G.participantHasCallModality,J=G.participantHasLightWeightMeetingModality,Q=G.participantIsInLobby,Y=G.participantHasMappedEndpoint,$=0;z||J?$=3:Q?$=10:Y&&($=3);var X=B[0]?B[0].participantId:"";return{id:F.details.id,state:$,tenantId:F.details.tenantId||"",displayName:F.details.displayName,role:F.role||"",meetingRole:F.meetingRole,advancedMeetingRole:F.advancedMeetingRole,isServerMuted:this.isParticipantServerMuted(W),publishedStates:this.processPublishedStates(F.publishedStates,X),endpoints:W||[],isIdentityMasked:F.details.isIdentityMasked,nonMaskedId:F.details.nonMaskedId||"",nonMaskedDisplayName:F.details.nonMaskedDisplayName||"",nonMaskedObjectId:F.details.nonMaskedObjectId||"",maskedIdSeqNumber:F.details.maskedIdSeqNumber||0}},Participant}();B.default=J},function(F,B,G){F.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.CommandUrlPresence=B.TrouterState=B.DeviceType=void 0,function(F){F[F.Desktop=1]="Desktop",F[F.Mobile=2]="Mobile",F[F.Tablet=8]="Tablet"}(B.DeviceType||(B.DeviceType={})),function(F){F[F.Unknown=0]="Unknown",F[F.Connected=2]="Connected",F[F.Disconnected=3]="Disconnected",F[F.Switching=9]="Switching"}(B.TrouterState||(B.TrouterState={})),function(F){F[F.None=0]="None",F[F.Mute=1]="Mute",F[F.Unmute=2]="Unmute"}(B.CommandUrlPresence||(B.CommandUrlPresence={}))},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.HttpRequestDispatcher=void 0;var K=G(190),J=G(13),Q=G(106),Y=G(14),$=G(26),X=function(){function HttpRequestDispatcher(F){F&&"function"==typeof F.createChild?this.logger=F.createChild("RequestDispatcher"):this.logger=new Q.TsCallingLogger("JS.TsCalling.RequestDispatcher",!1)}return HttpRequestDispatcher.prototype.getRequestOptions=function(F,B,G,W,z){return{headers:B||{},timeout:W,payload:G||null,responseType:z}},HttpRequestDispatcher.prototype.getAsync=function(F,B){return this.sendRequest(F,B,"GET")},HttpRequestDispatcher.prototype.postAsync=function(F,B){return this.sendRequest(F,B,"POST")},HttpRequestDispatcher.prototype.putAsync=function(F,B){return this.sendRequest(F,B,"PUT")},HttpRequestDispatcher.prototype.removeAsync=function(F,B){return this.sendRequest(F,B,"DELETE")},HttpRequestDispatcher.prototype.sendRequest=function(F,B,G){return void 0===B&&(B={headers:{}}),W(this,void 0,void 0,(function(){var W,Q,X,Z,ee,te;return z(this,(function(z){switch(z.label){case 0:(W=this.logger.createChild("[".concat(B.causeId||(0,J.generateCauseId)(),"][Request]"))).info("sending, ".concat(G,"-").concat(F)),Q=Date.now(),B.headers=B.headers||{},B.headers["content-type"]||(B.headers["content-type"]=B.contentType||"application/json"),z.label=1;case 1:return z.trys.push([1,3,,4]),Z=K.default.request({url:F,method:G,headers:B.headers||{},timeout:"number"==typeof B.timeout?B.timeout:45e3,data:B.payload||"",responseType:B.responseType||B.dataType||"json",withCredentials:valueOrDefault(B.withCredentials,!1),cancelToken:new K.default.CancelToken((function(F){X=F}))}),(0,$.isPromiseLike)(B.timeout)&&B.timeout.then((function(){W.info("Aborting pending request"),X()}),(function(){W.info("Timeout promise rejected, ignoring")})),[4,Z];case 2:return ee=z.sent(),W.info("success, status=".concat(ee.status)),[2,{response:ee.data,request:ee.request,duration:Date.now()-Q}];case 3:if(te=z.sent(),W.info("failed"),K.default.isCancel(te))throw W.info("response=".concat((0,Y.safeJsonStringify)(te.response))),{aborted:!0};throw te.response?W.info("response=".concat((0,Y.safeJsonStringify)(te.response))):te.request?W.info("no response, request=".concat((0,Y.safeJsonStringify)(te.request))):W.info("request not made, error=".concat((0,Y.safeJsonStringify)(te))),te||new Error("Request failed");case 4:return[2]}}))}))},HttpRequestDispatcher}();function valueOrDefault(F,B){return void 0!==F?F:B}B.HttpRequestDispatcher=X},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(14),z=function(){function PiiUtils(F){this.piiScrubber=this.getPiiScrubber(F)}return PiiUtils.prototype.scrubParticipantsList=function(F){var B=this,G=[];return Array.isArray(F)&&F.forEach((function(F){return G.push(B.scrubMriOrOmit(F))})),G},PiiUtils.prototype.scrubMriOrOmit=function(F){return"string"==typeof F?this.piiScrubber.mri(F):this.piiScrubber.omit(F)},PiiUtils.scrubDisplayNamesFromResponse=function(F){var B=/"displayName": "[a-z]+"/gi;return(0,W.safeJsonStringify)(F).replace(B,'"displayName": "(redacted)"')},PiiUtils.prototype.getPiiScrubber=function(F){return F&&"function"==typeof F.omit&&"function"==typeof F.mri?F:{omit:function(){return"<pii:omit/>"},mri:function(){return"<pii:mri/>"}}},PiiUtils}();B.default=z},function(F,B,G){function isStreamValid(F){return F&&!!F.url&&(!!F.decryptionToken||!!F.keyDeliveryUrl&&!!F.keyAuthorizationToken)}function assert(F,B){if(!F)throw new Error("Assert failed".concat(void 0!==B?": ".concat(B):""))}Object.defineProperty(B,"__esModule",{value:!0}),B.assert=B.isStreamValid=void 0,B.isStreamValid=isStreamValid,B.assert=assert},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.RawStreamBase=void 0;var Q=G(13),Y=G(15),$=G(1),X=function(F){function RawStreamBase(B,G,W,z){void 0===z&&(z=(0,Q.generateCauseId)());var K=F.call(this,W)||this;return K.getRawStream=B,K.disposeStream=G,K.logger=W,K.causeId=z,K.isClientDisposed=!1,K.clientId=(0,$.uniqueId)(),K}return z(RawStreamBase,F),Object.defineProperty(RawStreamBase.prototype,"isDisposed",{get:function(){return this.isClientDisposed},enumerable:!1,configurable:!0}),RawStreamBase.prototype.notifyStreamChange=function(){this.logger.info("Raw stream changed, causeId=".concat(this.causeId)),this.raiseChanged(),this.event("notifiedOnStreamChanged").raise(this.clientId)},RawStreamBase.prototype.getMediaStream=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){return this.checkDisposed(),this.logger.info("Raw stream requested, causeId=".concat(this.causeId)),this.event("rawStreamRequested").raise(this.clientId),[2,this.getRawStream()]}))}))},RawStreamBase.prototype.dispose=function(){var B;this.checkDisposed(),null===(B=this.disposeStream)||void 0===B||B.call(this),this.isClientDisposed=!0,this.event("clientDisposed").raise(this.clientId),F.prototype.dispose.call(this),this.logger.info("Raw stream client disposed, causeId=".concat(this.causeId))},RawStreamBase.prototype.checkDisposed=function(){if(this.isClientDisposed)throw new Error("Raw stream client is already disposed")},RawStreamBase}(Y.default);B.RawStreamBase=X},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var Q=G(13),Y=G(17),$=G(18),X=G(6),Z=G(1),ee=function(F){function AudioRenderer(B,G){var W=F.call(this,B)||this;return W.logger=B,W.configProvider=G,W.window=$.default.window,W.isMuted=!1,W.isPlayingAllowed=!1,W.audioContext=null,W.sourceNode=null,W.gainNode=null,W.onAudioError=function(F){var B=F&&F.target||W.audio;(null==B?void 0:B.error)?W.logger.safe.error("error with rendering audio code: ".concat(B.error.code,", message: ").concat(B.error.message)):W.logger.safe.error("error with audio rendering")},W.onAudioPaused=function(){return K(W,void 0,void 0,(function(){var F;return J(this,(function(B){switch(B.label){case 0:return this.configProvider.config.audioRendererRestartOnPause&&this.canPlay&&!this.isMuted?(F=(0,Q.generateCauseId)(),this.logger.safe.info("[".concat(F,"] audio playback is paused by OS, resuming it")),[4,this.startStream(F)]):[3,2];case 1:B.sent(),B.label=2;case 2:return[2]}}))}))},W}return z(AudioRenderer,F),Object.defineProperty(AudioRenderer.prototype,"muted",{get:function(){return this.isMuted},enumerable:!1,configurable:!0}),AudioRenderer.prototype.setMuted=function(F,B){return K(this,void 0,void 0,(function(){return J(this,(function(G){return this.isMuted=F,F?[2,this.stopStream(B)]:[2,this.startStream(B)]}))}))},Object.defineProperty(AudioRenderer.prototype,"canPlay",{get:function(){return this.stream&&this.isPlayingAllowed},enumerable:!1,configurable:!0}),AudioRenderer.prototype.getStream=function(){return this.stream},AudioRenderer.prototype.getDeviceId=function(){return this.deviceId},AudioRenderer.prototype.play=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this.stream=F,this.isPlayingAllowed=!0,this.isMuted?[2]:[2,this.startStream()]}))}))},AudioRenderer.prototype.stop=function(){this.stopStream(),this.isPlayingAllowed=!1},AudioRenderer.prototype.setOutputDevice=function(F,B){return void 0===B&&(B=(0,Q.generateCauseId)()),K(this,void 0,void 0,(function(){var G=this;return J(this,(function(W){return this.audio?this.audio.setSinkId?F?(this.logger.safe.info("[".concat(B,"] setting audio output device ID to ").concat(Y.scrubMriOrOmit(F))),this.deviceId=F,[2,Promise.resolve(this.audio.setSinkId(F)).catch((function(F){return G.logger.safe.warn("[".concat(B,"] setSinkId operation was aborted with error ").concat(Z.stringifyObject(F)))}))]):[2]:(this.logger.safe.warn("[".concat(B,"] setting output device is not supported")),[2]):(this.deviceId=F,[2])}))}))},AudioRenderer.prototype.dispose=function(){this.logger.safe.info("dispose"),this.audio&&(this.stop(),this.stream=null,this.audio.removeEventListener("error",this.onAudioError),this.audio.removeEventListener("pause",this.onAudioPaused),this.window.document.body.removeChild(this.audio),this.event("onAudioElementRemoved").raise(this.audio),this.audio=null),this.detachGainNode()},AudioRenderer.prototype.startStream=function(F){var B;return void 0===F&&(F=(0,Q.generateCauseId)()),K(this,void 0,void 0,(function(){var G;return J(this,(function(W){switch(W.label){case 0:if(!this.canPlay)return[2];W.label=1;case 1:return W.trys.push([1,5,,6]),[4,this.assureAudioElement(F)];case 2:return W.sent(),this.logger.safe.info("[".concat(F,"] attaching stream to renderer: ").concat(null===(B=this.stream)||void 0===B?void 0:B.id)),this.configProvider.config.speakerGainLevel&&this.reattachToGainNode(this.stream,this.configProvider.config.speakerGainLevel),[4,this.window.attachMediaStream(this.audio,this.stream)];case 3:return W.sent(),[4,this.audio.play()];case 4:return W.sent(),[3,6];case 5:return G=W.sent(),this.logger.safe.warn("[".concat(F,"] play operation was aborted with error ").concat(Z.stringifyObject(G))),[3,6];case 6:return[2]}}))}))},AudioRenderer.prototype.assureAudioElement=function(F){return void 0===F&&(F=(0,Q.generateCauseId)()),K(this,void 0,void 0,(function(){return J(this,(function(B){return this.audio?[2]:(this.logger.safe.info("[".concat(F,"] creating audio element")),this.audio=this.window.document.createElement("audio"),this.audio.addEventListener("error",this.onAudioError),this.audio.addEventListener("pause",this.onAudioPaused),this.window.document.body.appendChild(this.audio),this.audio.autoplay=!0,this.event("onAudioElementAdded").raise(this.audio),[2,this.setOutputDevice(this.deviceId,F)])}))}))},AudioRenderer.prototype.stopStream=function(F){var B;void 0===F&&(F=(0,Q.generateCauseId)()),this.audio&&this.canPlay&&(this.detachGainNode(),this.logger.safe.info("[".concat(F,"] detaching stream from renderer: ").concat(null===(B=this.stream)||void 0===B?void 0:B.id)),this.configProvider.config.audioRendererUsePauseOnDetach?this.audio.pause():this.window.detachMediaStream(this.audio))},AudioRenderer.prototype.attachToGainNode=function(F,B){this.audioContext=new $.default.window.AudioContext,this.sourceNode=this.audioContext.createMediaStreamSource(F),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=B,this.sourceNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination)},AudioRenderer.prototype.detachGainNode=function(){var F,B,G;null===(F=this.sourceNode)||void 0===F||F.disconnect(),this.sourceNode=null,null===(B=this.gainNode)||void 0===B||B.disconnect(),this.gainNode=null,null===(G=this.audioContext)||void 0===G||G.close(),this.audioContext=null},AudioRenderer.prototype.reattachToGainNode=function(F,B){this.detachGainNode(),this.attachToGainNode(F,B)},AudioRenderer}(X.default);B.default=ee},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ConstraintsObject=void 0;var W=G(1),z=function(){function ConstraintsObject(F,B,G,W,z){void 0===G&&(G=!0),void 0===W&&(W=!1),this.audio=F,this.video=B,this.withTimeout=G,this.withEffect=W,this.withOverridenStream=z}return ConstraintsObject.prototype.clone=function(){var F=W.deepClone(this.video);return new ConstraintsObject(W.deepClone(this.audio),F,this.withTimeout,this.withEffect,this.withOverridenStream)},ConstraintsObject}();B.ConstraintsObject=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getFrameRateForTrack=B.getFrameRateForStream=B.getResolutionForTrack=B.getResolutionForStream=void 0;var W=G(1),z=[30,15,7.5,3.75,1.875];function getResolutionForStream(F,B){return F&&F.getVideoTracks()[0]?getResolutionForTrack(F.getVideoTracks()[0],B):B}function getResolutionForTrack(F,B){if(F&&F.getSettings){var G=F.getSettings();if(G)return{width:G.width,height:G.height}}return B}function getFrameRateForStream(F){return F&&F.getVideoTracks()[0]?getFrameRateForTrack(F.getVideoTracks()[0]):0}function getFrameRateForTrack(F){if(F&&F.getSettings){var B=F.getSettings();if(B)return W.getClosestValue(z,B.frameRate,!0)}return 0}B.getResolutionForStream=getResolutionForStream,B.getResolutionForTrack=getResolutionForTrack,B.getFrameRateForStream=getFrameRateForStream,B.getFrameRateForTrack=getFrameRateForTrack},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.createDefaultDevice=B.createCompositeAudioDevice=B.createDevice=void 0;var K=G(4),J=function(){function Device(F,B,G,W,z){this.deviceId=F,this.label=B,this.kind=G,this.groupId=W,this.capabilities=z,this.type=this.getType(this.kind),this.guid="".concat(this.type,":").concat(this.deviceId),this.isSystemDefault=this.deviceId===K.default.MEDIA_DEVICE.defaultId}return Device.prototype.toDeviceDesc=function(){return{id:this.guid,browserId:this.deviceId,label:this.label,kind:this.type}},Device.prototype.getType=function(F){switch(F){case K.default.MEDIA_DEVICE_KIND.audioInput:return K.default.MEDIA_DEVICE.microphone;case K.default.MEDIA_DEVICE_KIND.audioOutput:return K.default.MEDIA_DEVICE.speaker;case K.default.MEDIA_DEVICE_KIND.videoInput:return K.default.MEDIA_DEVICE.camera;case K.default.MEDIA_DEVICE_KIND.compositeAudio:return K.default.MEDIA_DEVICE.compositeAudio;default:throw new Error("Device kind to recognized: ".concat(F))}},Device}(),Q=function(F){function AudioDevice(B,G,W,z,K){return F.call(this,B,G,W,z,K)||this}return z(AudioDevice,F),AudioDevice.prototype.toDeviceDesc=function(){var B=F.prototype.toDeviceDesc.call(this);return B.isSystemDefault=this.isSystemDefault,B},AudioDevice}(J),Y=function(F){function VideoDevice(B,G,W,z,K){var J=F.call(this,B,G,W,z,K)||this;if(J.position="unknown",K&&K.facingMode&&1===K.facingMode.length)switch(K.facingMode[0]){case"user":J.position="front";break;case"environment":J.position="back"}return J}return z(VideoDevice,F),VideoDevice.prototype.toDeviceDesc=function(){var B=F.prototype.toDeviceDesc.call(this);return B.position=this.position,B},VideoDevice}(J),$=function(F){function CompositeAudioDevice(B,G,W,z,K,J){var Q=F.call(this,null,W,z,"")||this;return Q.micDevice=B,Q.speakerDevice=G,Q.formFactor=K,Q.isPcInternalDevice=J,Q.guid=null,Q.isSystemDefault=!1,Q}return z(CompositeAudioDevice,F),Object.defineProperty(CompositeAudioDevice.prototype,"micDeviceId",{get:function(){return this.micDevice.guid},enumerable:!1,configurable:!0}),Object.defineProperty(CompositeAudioDevice.prototype,"speakerDeviceId",{get:function(){return this.speakerDevice.guid},enumerable:!1,configurable:!0}),CompositeAudioDevice.prototype.toDeviceDesc=function(){var B=F.prototype.toDeviceDesc.call(this);return B.microphoneId=this.micDeviceId,B.speakerId=this.speakerDeviceId,B.formFactor=this.formFactor,B.isPcInternalDevice=this.isPcInternalDevice,B},CompositeAudioDevice}(J);function createDevice(F){var B=F.getCapabilities&&F.getCapabilities();switch(B&&(delete B.groupId,delete B.deviceId),F.kind){case K.default.MEDIA_DEVICE_KIND.audioInput:case K.default.MEDIA_DEVICE_KIND.audioOutput:return new Q(F.deviceId,F.label,F.kind,F.groupId,B);case K.default.MEDIA_DEVICE_KIND.videoInput:return new Y(F.deviceId,F.label,F.kind,F.groupId,B);default:throw new Error("Device kind is not recognized: ".concat(F.kind))}}function createCompositeAudioDevice(F,B,G){return new $(F,B,G,"compositeAudio",0,!1)}function createDefaultDevice(F){var B={deviceId:K.default.MEDIA_DEVICE.defaultId,label:K.default.MEDIA_DEVICE.defaultDeviceLabel,kind:getKind(F),groupId:"",toJSON:function(){return JSON.stringify(B)}};return createDevice(B)}function getKind(F){switch(F){case K.default.MEDIA_DEVICE.microphone:return K.default.MEDIA_DEVICE_KIND.audioInput;case K.default.MEDIA_DEVICE.speaker:return K.default.MEDIA_DEVICE_KIND.audioOutput;case K.default.MEDIA_DEVICE.camera:return K.default.MEDIA_DEVICE_KIND.videoInput;default:throw new Error("Device type to recognized: ".concat(F))}}B.createDevice=createDevice,B.createCompositeAudioDevice=createCompositeAudioDevice,B.createDefaultDevice=createDefaultDevice},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SsrcGenerator=void 0;var W=4294967040,z=function(){function SsrcGenerator(){this.ssrc=Math.floor(Math.random()*(W-1))+1}return SsrcGenerator.prototype.nextAudioStreamSsrc=function(){return this.nextSsrc(0)},SsrcGenerator.prototype.nextVideoStreamSsrc=function(){return this.nextSsrc(99)},SsrcGenerator.prototype.nextSsrc=function(F){var B=this.ssrc;do{B=this.ssrc,this.ssrc=(this.ssrc+F+1)%W,0===this.ssrc&&(this.ssrc=1)}while(B+F>W);return{min:B,max:B+F}},SsrcGenerator}();B.SsrcGenerator=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MediaRollbackModifier=B.BandwidthControlModifier=void 0;var W=G(46),z=G(47),K=G(64),J=function(){function BandwidthControlModifier(F,B,G,W){this.logger=F,this.qualityManager=B,this.resolutionTable=G,this.configProvider=W}return BandwidthControlModifier.prototype.getControlItem=function(){return this.controlItem},BandwidthControlModifier.prototype.setControlItem=function(F){this.controlItem=F},BandwidthControlModifier.prototype.dispose=function(){this.controlItem=null},BandwidthControlModifier.prototype.setVideoControlMessage=function(F){this.controlItem=this.messageToControlItem(F),this.logger.safe.info("BW limit requested to ".concat(this.controlItem.bandwidth))},BandwidthControlModifier.prototype.modifyDescriptor=function(F){if(!this.controlItem)return F;var B=W.parse(F.sdp);if(!B.media[1])return this.logger.unsafe.warn("video modality is disabled, skipping sdp modification, ",F),F;var G=this.getCurrentResolutionBitrate();this.logger.safe.info("Select the BW limit as min of requested ".concat(this.controlItem.bandwidth," and Current Resolution Max BR ").concat(G));var z=this.getSessionBitrate(B),K=Math.min(G,this.controlItem.bandwidth,z);if(B.media[1].bandwidth)B.media[1].bandwidth[0].limit=K;else{var J={limit:K,type:"AS"};B.media[1].bandwidth=[J]}return F.sdp=W.write(B),F},BandwidthControlModifier.prototype.messageToControlItem=function(F){var B=z.default.build(F.controlVideoStreaming.controlInfo[0].fmtParams),G="max-br",W=1.2;if(!B.contains(G))return null;var K=Math.round(+B.get(G)*W);return{sourceId:F.controlVideoStreaming.controlInfo[0].sourceId,streamMsid:F.controlVideoStreaming.controlInfo[0].streamMsid,bandwidth:K}},BandwidthControlModifier.prototype.getCurrentResolutionBitrate=function(){var F=this.qualityManager.getCurrentResolution(),B=this.resolutionTable.getResolutionByFs(F);return F&&B?Math.floor(this.resolutionTable.getBitrateForResolution(B.width,B.height).maxBitrate/1e3):Number.MAX_VALUE},BandwidthControlModifier.prototype.getSessionBitrate=function(F){var B=Number.MAX_SAFE_INTEGER;return this.configProvider.mediaConfig.maxBandwidthInKbps&&(B=this.configProvider.mediaConfig.maxBandwidthInKbps),F.bandwidth&&(B=Math.min(F.bandwidth[0].limit,B)),B-(this.configProvider.config.audioBandwidthInKbps||0)},BandwidthControlModifier}();B.BandwidthControlModifier=J;var Q=function(){function MediaRollbackModifier(F,B,G){this.pc=F,this.configProvider=B,this.logger=G.createChild("MediaRollbackModifier")}return MediaRollbackModifier.prototype.modifyDescriptor=function(F){var B=this,G=W.parse(F.sdp);return W.parse(this.pc.localDescription.sdp).media.forEach((function(F,W){(0!==F.port||F.bundleOnly)&&G.media[W]&&0!==G.media[W].port||(B.logger.safe.info("Adding disabled media ".concat(F.type,", position ").concat(W)),G.media[W]=(0,K.disabledMedia)(F.type,void 0,F.protocol,void 0))})),new K.BundleGroupModifier(this.configProvider).modify(G),F.sdp=W.write(G),F},MediaRollbackModifier}();B.MediaRollbackModifier=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ExtensionBase=void 0;var W=function(){function ExtensionBase(F){this.manager=null,this.extensionType=F}return ExtensionBase.prototype.initialize=function(F){F.manager&&(this.manager=F.manager),F.logger&&(this.logger=F.logger.createChild(this.extensionType))},ExtensionBase.prototype.dispose=function(){this.manager&&(this.manager=null),this.logger&&(this.logger.safe.info("disposed"),this.logger=null)},ExtensionBase.prototype.configure=function(F){this.options=F},ExtensionBase.prototype.getOptions=function(){return this.options},ExtensionBase.prototype.getType=function(){return this.extensionType},ExtensionBase}();B.ExtensionBase=W},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},J=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},Q=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},Y=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},$=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.CallRegistry=void 0;var X=G(8),Z=G(40),ee=G(41),te=G(55),ne=G(13),ie=G(87),re=G(14),oe=G(176),ae=G(15),se=G(68),ce=G(70),le=G(17),de=G(26),ue=G(56),pe=G(88),he=G(90),ge=G(71),fe=new RegExp("/callAgent/","i"),me=function(){function CallNotificationMessageHandler(F,B){this.signalingAgentProvider=F,this.callRegistry=B}return CallNotificationMessageHandler.prototype.handleMessage=function(F){var B;return F.eventId?F.eventId in ue.logUploadEvents?(this.callRegistry.logUploadNotification(F),"number"==typeof(B=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(F))?{isHandled:!0,resultCode:B}:{isHandled:!0,resultCode:B.resultCode,responseBody:B.responseBody,responseHeaders:B.responseHeaders}):{isHandled:!1}:F.url.search(fe)>-1?"number"==typeof(B=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(F))?{isHandled:!0,resultCode:B}:{isHandled:!0,resultCode:B.resultCode,responseBody:B.responseBody,responseHeaders:B.responseHeaders}:{isHandled:!1}},CallNotificationMessageHandler}(),ve=function(){function IncomingCallMessageHandler(F,B){this.callRegistry=F,this.recentInvitations=[],this.logger=B.createChild("IncomingCallMessageHandler")}return IncomingCallMessageHandler.prototype.handleMessage=function(F){var B=this.handleIncomingCall(F);return B?{isHandled:B,resultCode:200}:{isHandled:B}},IncomingCallMessageHandler.prototype.handleIncomingCall=function(F){var B,G=(0,ne.generateCauseId)(),W=this.logger.createFnLogger("handleIncomingCall",G);if(this.isProxiableNotification(F))return this.callRegistry.proxyPushNotification(F),!0;if(!this.isIncomingCallMessage(F))return!1;try{if(F&&F.body&&F.body.gp&&!(0,de.isStringBase64)(F.body.gp))W.info("unencoded payload, skipping decoding."),B=F.body.gp;else{var z=decodeNotificationPayload(F);B=JSON.parse(z)}B.body=F.body}catch(F){return W.logFailure("Error parsing notification payload: ".concat(F)),!1}var K=this.isCallTransferNotification(F)?this.buildTransferCallPayload(B):this.buildNGCCallPayload(B);if(!K)return!1;if(this.callRegistry.calls.some((function(F){return F.callId===K.convoCallId&&F.participantId===K.participantId})))return W.logFailure("Duplicate call filtered because it was in the call registry, callId = ".concat(K.convoCallId,", participantId = ").concat(K.participantId)),!1;var J=this.isCallReplacementNotification(F);if(W.log("replacementCall=".concat(J)),!J&&this.recentInvitations.some((function(F){return F.convoCallId===K.convoCallId&&F.participantId===K.participantId})))return W.logFailure("Duplicate call filtered because it was in the recent calls list, callId = ".concat(K.convoCallId,", participantId = ").concat(K.participantId)),!1;5===this.recentInvitations.length&&this.recentInvitations.shift(),this.recentInvitations.push({convoCallId:K.convoCallId,participantId:K.participantId});var Q=X.find(this.callRegistry.calls,(function(F){return F.callId===K.convoCallId&&8===F.state}));return Q||(Q=K.groupId?this.callRegistry.createCallWithGroupId(K.groupId,K.convoCallId,K.participantId,G):this.callRegistry.createCall(K.conversationId,K.convoCallId,K.participantId,void 0,G)),Q.init({threadId:K.conversationId,messageId:K.messageId,mediaPeerType:2}),this.callRegistry.testEndpointMetadata?Q.acknowledge(K,this.callRegistry.testEndpointMetadata,G):Q.acknowledge(K,void 0,G),!0},IncomingCallMessageHandler.prototype.isIncomingCallMessage=function(F){return Object.keys(ue.incomingCallEvents).some((function(B){return ue.incomingCallEvents[B]===F.eventId}))||this.isCallTransferNotification(F)},IncomingCallMessageHandler.prototype.isCallTransferNotification=function(F){return F.callNotification&&("transfer"===F.callNotification.callType||"replaces"===F.callNotification.callType)},IncomingCallMessageHandler.prototype.isCallReplacementNotification=function(F){return F.callNotification&&"replaces"===F.callNotification.callType},IncomingCallMessageHandler.prototype.isProxiableNotification=function(F){return Object.keys(ue.proxiedEvents).some((function(B){return ue.proxiedEvents[B]===F.eventId}))},IncomingCallMessageHandler.prototype.buildTransferCallPayload=function(F){var B={body:F.body,callerId:F.callNotification.from.id,groupId:null,conversationId:null,convoCallId:F.debugContent.callId,isMultiParty:F.conversationInvitation&&F.conversationInvitation.isMultiParty,fromMixer:F.callNotification.fromMixer,ngcCall:!0,participantId:F.callNotification.to.participantId,transferorId:F.callNotification.transferor&&F.callNotification.transferor.details&&F.callNotification.transferor.details.id,transferorType:F.callNotification.transferor&&F.callNotification.transferor.transferorType,transferorDisplayName:F.callNotification.transferor&&F.callNotification.transferor.details&&F.callNotification.transferor.details.displayName,callType:F.callNotification.callType,consultativeCallId:F.callNotification.consultativeCallId,messageId:null,callQueueInfo:F.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.info("Incoming transfer paylod",B),B},IncomingCallMessageHandler.prototype.buildNGCCallPayload=function(F){if(!F.callNotification)return this.logger.error("Missing callNotification in parsed incoming NGC call payload"),null;var B={groupId:F.groupContext&&F.groupContext.id,conversationId:F.groupChat&&F.groupChat.threadId,messageId:F.groupChat&&F.groupChat.messageId,callerId:F.callNotification.from.id,isMultiParty:F.conversationInvitation.isMultiParty,fromMixer:F.callNotification.fromMixer,convoCallId:F.debugContent.callId,participantId:F.debugContent.participantId,ngcCall:!0,body:F.body,transferorId:F.callNotification.transferor&&F.callNotification.transferor.details&&F.callNotification.transferor.details.id,transferorType:F.callNotification.transferor&&F.callNotification.transferor.transferorType,transferorDisplayName:F.callNotification.transferor&&F.callNotification.transferor.details&&F.callNotification.transferor.details.displayName,callType:F.callNotification.callType,callQueueInfo:F.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.info("Incoming NGC payload",B),B},IncomingCallMessageHandler}(),ye=function(F){function CallRegistry(B,G,W,z,K,J,Q,Y,$,X){void 0===J&&(J={}),void 0===Q&&(Q=null);var ee=F.call(this)||this;if(ee.trouterService=B,ee.signalingAgentProvider=G,ee.mediaAgent=W,ee.callingLogger=z,ee.telemetryLoggers=K,ee.callSettings=J,ee.ecsProvider=Q,ee.imageRendererProvider=Y,ee.skypeIdentity=$,ee.oneDsTelemetryLoggers=X,ee.calls=[],ee.isDisposing=!1,ee._disposedPromise=Z.defer(),ee.testEndpointMetadata=null,ee.addCallSubscriptionToMap=function(F,B){ee.callSubscriptionsMap.set(F,(ee.callSubscriptionsMap.get(F)||[]).concat(B))},ee.clearCallSubscription=function(){ee.callSubscriptionsMap.forEach((function(F){F.forEach((function(F){F.dispose()}))})),ee.callSubscriptionsMap.clear()},ee.skypeIdentity&&(ee.identity=ee.skypeIdentity.id),ee.callSubscriptionsMap=new Map,ee.logger=new ie.default(ee.callingLogger).createChild("CallRegistry/".concat((0,ne.generateCauseId)())),ee.registryTelemetry=new te.CallRegistryTelemetry(ee.logger,(new Date).getTime()),!ee._callOperationHandler){var re=ee.ecsProvider&&ee.ecsProvider.getEcsConfig("SkypeCalling","disableInstantTelemetry");ee._callOperationHandler=new ce.default(ee.logger,ee.registryTelemetry,{disableInstantTelemetry:re},(function(F){ee._publishTelemetry(F)}))}var oe=ee.mediaAgent.getConfig().disconnectOnPageHide;return ee._windowUninitEvent=oe?"pagehide":"beforeunload",ee.signalingAgentProvider.getSignalingAgent().setTokenRequiredCallBack(ee.onTokenRequired.bind(ee)),ee}return z(CallRegistry,F),CallRegistry.prototype.init=function(F,B,G){return void 0===G&&(G=(0,ne.generateCauseId)()),this.logger.createFnLogger("init",G).info("init"),this.login(F)},CallRegistry.prototype.uninit=function(){return this.logout()},CallRegistry.prototype.login=function(F,B){return void 0===B&&(B=(0,ne.generateCauseId)()),this.logger.createFnLogger("login",B).info("login"),this.skypeIdentity=F,this.identity=this.skypeIdentity.id,this.initialize(B)},CallRegistry.prototype.initialize=function(F,B){var G=this;void 0===F&&(F=(0,ne.generateCauseId)());var W=this.logger.createFnLogger("initialize",F),z=B&&B.applicationType?B.applicationType:"null";W.info("initialize with applicationType: ".concat(z)),this.accountConfiguration=B,this.signalingAgentProvider.getSignalingAgent().update(B),this.incomingCallMessageHandler=new ve(this,this.logger),this.trouterService.registerMessageHandler(new me(this.signalingAgentProvider,this)),this.trouterService.registerMessageHandler(this.incomingCallMessageHandler),W.info("Call registry init, endpointMetadata",this.testEndpointMetadata);try{this.windowUninitListener=function(){G._disregardWindowUninitEvents||G.stopCallsWithBeacon()},window.addEventListener(this._windowUninitEvent,this.windowUninitListener)}catch(F){W.logFailure("Not adding beforeunload listener: ".concat(F))}return Promise.resolve(void 0)},CallRegistry.prototype.logout=function(F){void 0===F&&(F=(0,ne.generateCauseId)());var B=this.logger.createFnLogger("logout",F);B.info("logout");try{this.trouterService.clearMessageHandlers(),window.removeEventListener(this._windowUninitEvent,this.windowUninitListener)}catch(F){B.info("Not removing beforeunload listener: ".concat(F))}return Promise.resolve(void 0)},CallRegistry.prototype._publishTelemetry=function(F){if(this.telemetryLoggers&&this.telemetryLoggers.signaling){this.registryTelemetry.setSkypeId(this.identity);try{var B=this.signalingAgentProvider.getSignalingAgent();this.registryTelemetry.setEndpointId(B.endpointId)}catch(F){this.logger.warn("Could not get end point ID from signaling agent for call registry telemetry.")}this.accountConfiguration&&(this.registryTelemetry.setAcsResourceId(this.accountConfiguration.acsResourceId),this.registryTelemetry.setApplicationType(this.accountConfiguration.applicationType),this.registryTelemetry.setPartition(this.accountConfiguration.partition),this.registryTelemetry.setRegion(this.accountConfiguration.region),this.registryTelemetry.setRing(this.accountConfiguration.ring),this.registryTelemetry.setTenantId(this.accountConfiguration.tenantId),this.registryTelemetry.setUserHexCID(this.accountConfiguration.userHexCID));var G=ee.TELEMETRY_EVENT_NAMES.REGISTRY_WEB;this.telemetryLoggers.signaling.sendEvent({eventName:G,props:this.registryTelemetry.getEvent(null,F)})}},CallRegistry.prototype.dispose=function(B){return void 0===B&&(B=(0,ne.generateCauseId)()),Q(this,void 0,void 0,(function(){var G,W,z,K,J=this;return Y(this,(function(Q){return(G=this.logger.createFnLogger("dispose",B)).info("dispose"),this.isDisposing?(G.warn("call registry is already in disposing stage!"),[2,this._disposedPromise.promise]):(this.isDisposing=!0,W=function(){J.calls=[],J.event("disposed").raise(),F.prototype.dispose.call(J),J._disposedPromise.resolve()},z=this.calls.map((function(F){return F.stop()})),K=function(){return J.logout()},this.clearCallSubscription(),this.signalingAgentProvider.getSignalingAgent().resetAuthTokenManager(),Promise.all(z).then(K,K).then(W,W),[2,this._disposedPromise.promise])}))}))},Object.defineProperty(CallRegistry.prototype,"disposePromise",{get:function(){return this._disposedPromise.promise},enumerable:!1,configurable:!0}),CallRegistry.prototype.createCallWithMeetingData=function(F,B,G,W){var z=this,K=this.logger.createFnLogger("createCallWithMeetingData",W);if(K.info("meetingData:".concat((0,re.safeJsonStringify)(F),", callId:").concat(B,", localParticipantId: ").concat(le.scrubMriOrOmit(G))),!F)return K.info("meetingData cannot be null"),null;var J=this.mediaAgent&&this.mediaAgent.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers,Q=this.getCallUsingMeetingData(F,B,G,void 0,void 0,W);if(Q)return K.info("Call Registry has an entry for this call's meeting data"),Q;if(Q=this.getCall(B,G,W))return K.info("Call Registry has an entry for this callId, participantId"),Q;Q=new pe.default(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,new ie.default(this.callingLogger),J,this.skypeIdentity,this.callSettings,null,null,B,G,this.ecsProvider,this.trouterService,this.imageRendererProvider,this.accountConfiguration,void 0,this.locationInfoContent,this.networkInfoContent,F,this.areaContent),this.calls.push(Q),this.event("callAdded").raise(Q),this.raiseChanged(),K.info("creating new call, ".concat(Q.callId,", ").concat((0,re.safeJsonStringify)(F),", ").concat((0,re.safeJsonStringify)(Q.meetingData)));var Y=Q.on("replacementRequested",(function(F){z.incomingCallMessageHandler.handleMessage(F)}));return this.addCallSubscriptionToMap(Q,Y),Q},CallRegistry.prototype.createCall=function(F,B,G,W,z){return void 0===z&&(z=(0,ne.generateCauseId)()),this._createCall(F,B,G,W,z)},CallRegistry.prototype.createCallWithGroupId=function(F,B,G,W){return this._createCall("",B,G,void 0,W,F)},CallRegistry.prototype._createCall=function(F,B,G,W,z,K){var J=this;void 0===z&&(z=(0,ne.generateCauseId)()),this.logger.createFnLogger("createCall",z).info("threadId:".concat(le.getLoggableThreadId(F),", callId:").concat(B,", localParticipantId: ").concat(le.scrubMriOrOmit(G),", messageId:").concat(W,", groupId:").concat(le.scrubMriOrOmit(K)));var Q=this.mediaAgent&&this.mediaAgent.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers,Y=null;if(Y=this.getCall(B,G,z))return Y;if(Y=this.getCallUsingThreadIdMessageId(F,B,W,z))return Y;if(K&&(Y=X.find(this.calls,(function(F){return F.groupId===K}))))return Y;Y=new pe.default(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,new ie.default(this.callingLogger),Q,this.skypeIdentity,this.callSettings,K,F,B,G,this.ecsProvider,this.trouterService,this.imageRendererProvider,this.accountConfiguration,W,this.locationInfoContent,this.networkInfoContent,null,this.areaContent),this.calls.push(Y),this.event("callAdded").raise(Y),this.raiseChanged();var $=Y.on("replacementRequested",(function(F){J.incomingCallMessageHandler.handleMessage(F)}));return this.addCallSubscriptionToMap(Y,$),Y},CallRegistry.prototype.getCall=function(F,B,G){void 0===G&&(G=(0,ne.generateCauseId)());var W=this.logger.createFnLogger("getCall[callId=".concat(F,"][participantId=").concat(le.scrubMriOrOmit(B),"]"),G);if(!F)return W.logFailure("callId is undefined"),null;var z=this.calls.find((function(B){return B.callId===F}));return z&&W.info("Call Registry already has an entry for this call"),z},CallRegistry.prototype.deleteCall=function(F){var B=this.calls.indexOf(F);return-1!==B&&(this.callSubscriptionsMap.get(F).forEach((function(F){F.dispose()})),this.callSubscriptionsMap.delete(F),this.calls.splice(B,1),this.event("callRemoved").raise(F),this.raiseChanged(),!0)},CallRegistry.prototype.setConfiguration=function(F){return Q(this,void 0,void 0,(function(){return Y(this,(function(B){return this.accountConfiguration=F,this.signalingAgentProvider.getSignalingAgent().update(F),[2]}))}))},CallRegistry.prototype.updateDisplayName=function(F){return this.skypeIdentity.displayName=F,this.calls.forEach((function(B){B.updateDisplayName(F)})),Promise.resolve()},CallRegistry.prototype.fireIntent=function(F,B){return Promise.resolve()},CallRegistry.prototype.getCallState=function(F,B){return Promise.reject("Not implemented")},CallRegistry.prototype.getSetup=function(){},CallRegistry.prototype.updateSkypeToken=function(F){this.logger.debug("CallRegistry.updateSkypeToken() called but not supported in the current set up.")},CallRegistry.prototype.updateToken=function(F,B,G,W,z){this.logger.info("[updateToken], causeId = ".concat(W," tokenType = ").concat(B.tokenType,", ")+"factorsJson = ".concat(F,", tokenExpiredTime = ").concat(z));try{return this.signalingAgentProvider.getSignalingAgent().updateToken(F,B,G,W,z),Promise.resolve((0,ge.getSuccessTransactionEnd)())}catch(B){return this.logger.info("Failed to update token with ".concat(F,", error is ").concat(B)),Promise.reject((0,ge.getRejectTransactionEnd)("Failed to update token with ".concat(F,", error is ").concat(B)))}},CallRegistry.prototype.onTokenRequired=function(F){var B=F.requestMetadataJson,G=F.factorsJson,W=F.tokenType,z=F.invalidToken;this.logger.info("[onTokenRequired], tokenType ".concat(W,", factorsJson ").concat(G,", ")+"requestMetadataJson ".concat(JSON.stringify(B))),this.event("tokenRequired").raise(G,W,B,z)},CallRegistry.prototype.debugInformation=function(F){var B=F?"CallInformation\n * CallId=".concat(F.callId):void 0;return Promise.resolve(B)},CallRegistry.prototype.setLocationInfo=function(F,B,G){if(void 0===G&&(G=(0,ne.generateCauseId)()),this.logger.info("setLocationInfo, ".concat(G,", infoType:").concat(F,", contentJson ").concat(B?"is set":"is undefined")),B)try{JSON.parse(B)}catch(F){return Promise.reject("invalid contentJson: ".concat(F))}return this.locationInfoType=F,1===this.locationInfoType&&(this.locationInfoContent=B,this.logger.info("locationInfoContent set to ".concat(this.locationInfoContent))),2===this.locationInfoType&&(this.networkInfoContent=B,this.logger.info("networkInfoContent set to ".concat(this.networkInfoContent))),3===this.locationInfoType&&(this.areaContent=B,this.logger.info("areaContent set to ".concat(this.areaContent))),Promise.resolve()},CallRegistry.prototype.proxyPushNotification=function(F){this.logger.info("Proxying push notification with event ID ".concat(F.eventId));try{var B={eventId:F.eventId,payload:decodeNotificationPayload(F)};this.event("proxiedPushNotification").raise(B)}catch(F){this.logger.error("Error proxying push notification: ".concat(F))}},CallRegistry.prototype.logUploadNotification=function(F){this.logger.info("Log upload notification with event ID ".concat(F.eventId));try{var B={eventId:F.eventId,payload:decodeNotificationPayload(F)};this.event("logUploadNotification").raise(B)}catch(F){this.logger.error("Error raising log upload notification: ".concat(F))}},CallRegistry.prototype.sendPush=function(F,B,G,W){var z={id:F},K=[];return B.forEach((function(F){K.push({id:F})})),this.signalingAgentProvider.getSignalingAgent().sendPushAsync(z,K,G,W)},CallRegistry.prototype.enableWindowUninitEventHandler=function(){this._disregardWindowUninitEvents=!1},CallRegistry.prototype.disableWindowUninitEventHandler=function(){this._disregardWindowUninitEvents=!0},CallRegistry.prototype.getCallUsingThreadIdMessageId=function(F,B,G,W){this.logger.info("[getCallUsingThreadIdMessageId][".concat(W,"] threadID: ").concat(le.getLoggableThreadId(F)," callId: ").concat(B," messageId: ").concat(G));var z=null;return F&&(z=X.find(this.calls,(function(W){return W.threadId===F&&(B&&W.callId===B||G&&W.messageId===G)})))?(this.logger.logFailure("[getCallUsingThreadIdMessageId][".concat(W,"]Call Registry already has an entry for threadId: ").concat(le.getLoggableThreadId(z.threadId),", callId: ").concat(z.callId,", messageId: ").concat(z.messageId)),z):z},CallRegistry.prototype.getCallUsingMeetingData=function(F,B,G,W,z,K){var J,Q;void 0===K&&(K=(0,ne.generateCauseId)());var Y,X=this.logger.createFnLogger("getCallUsingMeetingData",K);if(X.info("[callId=".concat(B,"][participantId=").concat(le.scrubMriOrOmit(G),"] meetingData: ").concat((0,re.safeJsonStringify)(F)," threadId: ").concat(le.getLoggableThreadId(W)," messageId: ").concat(z)),!B)return X.logFailure("callId is undefined"),null;try{for(var Z=$(this.calls),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value;if(te.callId===B){Y=te;break}if((0,oe.compareMeetingData)(te.meetingData,F,K,this.logger)){Y=te;break}}}catch(F){J={error:F}}finally{try{ee&&!ee.done&&(Q=Z.return)&&Q.call(Z)}finally{if(J)throw J.error}}return Y},CallRegistry.prototype.stopCallsWithBeacon=function(){var F,B;try{for(var G=$(this.calls),W=G.next();!W.done;W=G.next()){W.value.stopWithBeacon()}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}},K([(0,se.callOperation)(ee.CALL_REGISTRY_OPERATIONS.INITIALIZE,{enableInstantTelemetry:!0}),J("design:type",Function),J("design:paramtypes",[Object,Object]),J("design:returntype",Promise)],CallRegistry.prototype,"initialize",null),K([(0,se.callOperation)(ee.CALL_REGISTRY_OPERATIONS.LOGOUT,{enableInstantTelemetry:!0}),J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],CallRegistry.prototype,"logout",null),CallRegistry}(ae.default);function decodeNotificationPayload(F){if(F&&F.body){if(F.body.gp)return atob(F.body.gp);if(F.body.cp)return he.inflate(atob(F.body.cp),{to:"string"})}return"{}"}B.CallRegistry=ye},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var K=G(14),J=function(){function InternalLogger(F){var B=this;this._callingLogger=F,this._maybeLog=function(F){for(var G,J=[],Q=1;Q<arguments.length;Q++)J[Q-1]=arguments[Q];try{(G=B._callingLogger)[F].apply(G,z([],W(J),!1))}catch(F){B._callingLogger.info("[failed to log]",(0,K.getPrintableObject)(F))}}}return InternalLogger.prototype.getPrefix=function(F,B){var G="";return B&&(G+="[".concat(B,"]")),F&&(G+="[".concat(F,"]")),G},InternalLogger.prototype.createChild=function(F,B){return new InternalLogger(this._callingLogger.createChild(F,B))},InternalLogger.prototype.createFnLogger=function(F,B){for(var G=[],W=2;W<arguments.length;W++)G[W-2]=arguments[W];return new InternalLogger(this._callingLogger.createChild(this.getPrefix(F,B)+G.join(""),!1))},InternalLogger.prototype.logSuccess=function(F){this._maybeLog("info","success=".concat(F,"}"))},InternalLogger.prototype.logFailure=function(F){var B=(0,K.getPrintableObject)(F);this._maybeLog("info","failed=".concat(B,"}"))},InternalLogger.prototype.log=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B];this._maybeLog.apply(this,z(["log"],W(F),!1))},InternalLogger.prototype.debug=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B];this._maybeLog.apply(this,z(["debug"],W(F),!1))},InternalLogger.prototype.info=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B];this._maybeLog.apply(this,z(["info"],W(F),!1))},InternalLogger.prototype.warn=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B];this._maybeLog.apply(this,z(["warn"],W(F),!1))},InternalLogger.prototype.error=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B];this._maybeLog.apply(this,z(["error"],W(F),!1))},InternalLogger}();B.default=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)},J=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},Q=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},Y=this&&this.__param||function(F,B){return function(G,W){B(G,W,F)}},$=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},X=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},ee=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},te=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.LocalMediaStream=B.DEFAULT_PARTICIPANT_ID=B.DEFAULT_ENDPOINT_ID=void 0;var ne=G(8),ie=G(89),re=G(40),oe=G(41),ae=G(55),se=G(13),ce=G(58),le=G(71),de=G(69),ue=G(57),pe=G(14),he=G(59),ge=G(291),fe=G(15),me=G(68),ve=G(70),ye=G(45),Se=G(292),_e=G(17),Ce=G(110),Te=G(60),Ee=G(111),be=G(56),Ie=G(293),Ae=G(112),Re=G(113),Pe=G(294),Oe=G(114),Me=G(116),we=G(308),De=G(309),Ne=G(310),Le=G(320),ke=G(62),Fe=G(321),xe=G(322),Ue=G(122),je=G(115),Be=[1,2,9,10,11,12,30,27,28];B.DEFAULT_ENDPOINT_ID="remote",B.DEFAULT_PARTICIPANT_ID="remote";var He,Ve,Ge=function(F){function LocalMediaStream(B,G){var W=F.call(this)||this;return W.isStreaming=B,W.mediaType=G,W}return z(LocalMediaStream,F),LocalMediaStream}(fe.default);B.LocalMediaStream=Ge,function(F){F.Specified="specified",F.All="all"}(He||(He={})),function(F){F[F.None=0]="None",F[F.Self=1]="Self",F[F.Other=2]="Other"}(Ve||(Ve={}));var We=function(F){function PluginlessCall(B,G,W,z,K,J,Q,Y,$,X,ee,te,ce,le,de,ue,he,ge,fe){var me=F.call(this,W)||this;me.signalingAgent=B,me.mediaAgent=G,me.logger=W,me.telemetryLoggers=z,me.currentUserSkypeIdentity=K,me.callSettings=J,me.groupId=Q,me.threadId=Y,me.ecsProvider=ee,me.trouterService=te,me.accountConfiguration=le,me.participants=[],me.isServerMuted=!1,me.isSpeakerMuted=!1,me.isVideoOn=!1,me.isScreenSharingOn=!1,me.callStartedAt=null,me.callHeldAt=null,me.callType=-1,me.failureType=2,me.isEmergency=!1,me.contentSharingSessions=[],me.endpoints={endpointDetails:[]},me.isPreheatEnabled=!1,me.localMediaStreams=[],me.enableRealtimeTelemetry=!1,me.isSharedLineAppearanceV2Activated=!1,me.requestedHoldState=!1,me.mediaStateConfigurationHelper=new Ee.MediaStateConfigHelper({mediaStates:[Ee.getMediaState(0,4)]}),me.canToggleAudio=!0,me.canToggleVideo=!0,me.connectCallPromise=Promise.resolve(),me.canToggleScreenSharing=!0,me.callUsesMixer=!1,me.isEscalationInProgress=!1,me.retryOutgoingRenegotiation={retry:!1,causeId:""},me.isHoldInProgress=!1,me.isMuteOnHold=!1,me.callSetupFailed=!1,me.isSomeoneSharing=!1,me.isSomeoneStreamingVideo=!1,me.activeTalkersHistory=[],me.callGotConnected=!1,me.lwjFallbackInProgress=!1,me.mediaRelayWhiteListingIssue=!1,me.signalingSessionCallOptions=null,me.tsCallingTelemetryReported=!1,me.isCallSetupTelemetrySent=!1,me._isAudioStreamConnected=!1,me._wasAudioStreamConnected=!1,me._callInLobby=!1,me._callIsSetupComplete=!1,me._transferState=0,me._parkState=0,me._muteState=be.ParticipantMuteState.Unmuted,me._callCreationTime=(new Date).getTime(),me._commandUrlPresence=ie.CommandUrlPresence.None,me._capabilities={canMuteOthers:!1,canUnmuteSelf:!1},me._spamRiskLevel=null,me._spamStirAttestation=null,me._disableIsMultipartyDependenceOnThreadId=!1,me._enableAddParticipantPromiseOptimization=!1,me._enableStaging=!1,me._callMode=0,me._enableMergeParticipantLegsBatchSupport=!1,me._enablePluginlessCallParticipantRaiseChangeDeferred=!1,me._shouldShareSystemSound=!1,me._enableRemoveRosterNegotiations=!1,me._enableAutoPromotion=!1,me.pipManager=null,me._enableGlobalDeferHandler=!1,me._publishedStatesModified=Ve.None,me._participantPublishedStatesMap={},me._endpointPublishedStatesMap={},me._participantChangedEventSkipConfig={skipParticipantsUpdatesOnCall:!0},me._dominantSpeakerChangedEventSkipConfig={skipDominantSpeakerUpdatesOnCall:!0},me.receiveOnlyAudioOnCallStart=!1,me.startVM=function(F,B,G,W,z){return me.signalingSession.startOutgoingCall(G,W,{voicemailResourcePath:B.callVoicemailStartOptions.voicemailResourcePath,voicemailItemId:B.callVoicemailStartOptions.voicemailItemId,callToVoicemail:!0},Date.now()-z,F)},me.getSignalingSessionCallOptions=function(F){var B,G,W={suppressDialout:!F.callStartOptions.ringOthers,isPreheatOnly:1==(1&F.callStartOptions.preheatFlags),onBehalfOf:me.onBehalfOfMri,muted:1==(1&F.callStartOptions.muteFlags),invitationType:F.invitationType,participantsToNudge:F.participantsToNudge,routingFlags:F.callStartOptions&&F.callStartOptions.routingFlags,parkContext:F.parkContext,pickupCode:F.pickupCode,isLwj:me.callSettings.useLwjForAllCalls,scenario:F.callStartOptions&&F.callStartOptions.scenario,callUsesMixer:me.callUsesMixer,clientEndpointCapabilities:F.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:F.callStartOptions.clientEndpointDebugContent,isEmergency:me.isEmergency,meetingData:me.meetingData,meetingPreferences:F.meetingPreferences,alternateId:F.callStartOptions?F.callStartOptions.alternateId:null,meetingRegistrationId:F.callStartOptions?F.callStartOptions.meetingRegistrationId:"",additionalEndpointProperties:(null===(B=F.callStartOptions)||void 0===B?void 0:B.additionalEndpointProperties)||null},z=null===(G=F.callStartOptions)||void 0===G?void 0:G.invitationDataJson;if(z)try{W.invitationData=JSON.parse(z)}catch(F){throw new Error("Invalid JSON in invitationData: ".concat(z))}return W},me.startOutgoingCall=function(F,B,G,W,z){return me.signalingSession.startOutgoingCall(G,W,me.getSignalingSessionCallOptions(B),Date.now()-z,F)},me.joinGivenConversation=function(F,B,G,W,z,K){var J,Q,Y=1==(1&B.callStartOptions.muteFlags),$=1==(1&B.callStartOptions.preheatFlags),X=me.callSettings.useLwjForAllCalls,Z=null===(J=B.callStartOptions)||void 0===J?void 0:J.sharedLineCallInvitationContentJson;me.logger.info("[".concat(F,"][joinGivenConversation] muted=").concat(Y,", isLwj=").concat(X,", isPreheatOnly=").concat($,", sharedLineCallInvitationContentJson=").concat(Z));var ee={muted:Y,isLwj:X,isPreheatOnly:$,clientEndpointCapabilities:B.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:B.callStartOptions.clientEndpointDebugContent,isEmergency:me.isEmergency,meetingData:me.meetingData,meetingPreferences:B.meetingPreferences,meetingRegistrationId:B.callStartOptions?B.callStartOptions.meetingRegistrationId:"",additionalEndpointProperties:null===(Q=null==B?void 0:B.callStartOptions)||void 0===Q?void 0:Q.additionalEndpointProperties,applyServerMute:null==B?void 0:B.applyServerMute};if(Z)try{ee.sharedLineCallInvitationContent=JSON.parse(Z)}catch(F){throw new Error("Invalid JSON in sharedLineCallInvitationContent: ".concat(Z))}return me.signalingSession.joinGivenConversation(K,me.callId,G,W,Date.now()-z,ee,F)},me.executeCallTransfer=function(F,B,G,W){me._setTransferState(1);var z=me._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,B,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]});return 0===G?me.signalingSession.transferCallAsync(F,"TransferTypeStandard",void 0,W,B):2===G&&me.signalingSession.transferCallAsync(F,"TransferTypeVoicemail",void 0,W,B),z},me.executeConsultCallTransfer=function(F,B,G,W,z){me._setTransferState(1);var K=me._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,W,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]});return me.signalingSession.consultTransferCallAsync(F,B,G,W,z),K},me._getCallEndOperation=function(){return me._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.STOP_CALL)?me._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.STOP_CALL):me._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.REJECT)?me._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.REJECT):me._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.CALL_REDIRECT)?me._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.CALL_REDIRECT):Promise.resolve()},me._onAcknowledgeError=function(F,B,G,W){G.logFailure(F);var z,K={code:2,success:!1,fatal:!0},J=7;throw(0,Se.isPhaseError)(be.CallAckSignalingPhase.SendAttach,F)&&(z={code:be.jsCallEndCodes.InternalServerError,subCode:be.jsCallEndSubCodes.AttachFailed,phrase:be.jsCallEndPhrase.AttachFailed}),(0,Se.isPhaseError)(be.CallAckSignalingPhase.ProcessIncomingCallRequest,F)&&(z={code:be.jsCallEndCodes.NotAcceptable,subCode:be.jsCallEndSubCodes.AttachActionFailed,phrase:be.jsCallEndPhrase.BadNotificationPayload},K={code:0,success:!1,fatal:!0}),(0,Se.isOneOfPhaseErrors)(be.CallAckMediaPhase,F)&&(J=47),F&&F.error&&F.error.type===me.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer&&(z={code:be.jsCallEndCodes.MediaError,subCode:be.jsCallEndSubCodes.MediaOfferProcessingError,phrase:be.jsCallEndPhrase.IncompatibleOffer}),me.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.ACKNOWLEDGE,{phases:W,error:(0,pe.getPIISafeObject)(F)},B),me._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS.ACKNOWLEDGE,K,void 0,B),me.stopInternal({rejectReason:z,causeId:B,terminatedReason:J}),K},me._onAcknowledgeSuccess=function(F,B,G){return F.logSuccess("success"),me.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.ACKNOWLEDGE,{phases:B},G),{code:1,success:!0}},me._processOfferedModalities=function(F,B){me.handleOfferedModalities(F,B);var G=me.callUsesMixer?void 0:{modalityOverride:F};return me.updateMediaModalities(G,B)},me._handleOfferProcessingError=function(F,B,G){return G.logFailure("handleOfferProcessingError=".concat(F)),F&&F.error&&F.error.type===me.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer?(me.callTelemetry.recordEvent(oe.MEDIA_EVENT.INCOMPATIBLE_OFFER,void 0,B),me.signalingSession.supportsNewOfferRequest()?(me.newOfferRequestDeferred=re.defer(),me.attachToCallAndGetOffer.promise.then((function(){return me.mediaSession.rejectNegotiationAsync(F.error,B)})).then((function(){return me.signalingSession.requestNewOffer(me.mediaSession.getAcceptedTypes(),B)})).then((function(){return me.newOfferRequestDeferred.promise})).then((function(F){return me.mediaSession.processOfferAsync(F,B)})).catch((function(F){return me.callTelemetry.recordEvent(oe.MEDIA_EVENT.NEW_OFFER_FAILED,(0,pe.getPrintableObject)(F),B),Promise.reject(F)}))):Promise.reject(F)):Promise.reject(F)},me._trySendProvisionalMediaAnswer=function(F){return Promise.resolve(void 0).then((function(){return me.mediaSession.createAnswerAsync(!0,F)})).then((function(F){return F.blob?(me.mediaAcknowledgmentOperation=me._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,void 0,(0,se.generateCauseId)(),{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),me.signalingSession.setProvisionalAnswerAsync(F).then((function(){return me.mediaAcknowledgmentOperation}))):Promise.resolve(void 0)}))},me.checkForCallIdUpdate=function(F,B){if(me.callId!==F){me.logger.info("[".concat(B,"][checkForCallIdUpdate] old=").concat(me.callId,", new=").concat(F)),me.setCallId(F);try{me.event("callIdChanged").raise(me.callId)}catch(F){me.logger.error("Error raising call ID change: ".concat(F))}me.raiseChanged()}},me.handleRemoteParticipantStateInOneToOneCall=function(F){if(!me.callUsesMixer&&3===me.state){var B=me.participants[0];B&&B.setState(3,void 0,F)}},me.handleRemoteParticipantJoinedInOneToOneCall=function(F,B){if(!me.callUsesMixer&&3===me.state){var G=me.participants.filter((function(B){return B.id===F.id}))[0];G?G.setState(3,void 0,B):me.logger.logFailure("[".concat(B,"][handleRemoteParticipantJoinedInOneToOneCall]unable to find particpant ").concat(_e.scrubMriOrOmit(F.id)))}},me.handleRemoteParticipantStateInObservingCall=function(F,B,G){var W=B.isLobby;if(8===me.state){var z=W?7:3;F.setState(z,void 0,G)}},me.getTelemetryFromPhaseExecution=function(F){var B={phase:F.phase,phases:F.phases,code:F.error&&F.error.code,subCode:F.error&&F.error.subCode,message:F.error&&F.error.message,error:F.error};return(B.code||B.message)&&delete B.error,B},me._setTransferState=function(F){me.transferState!==F&&(me.logger.info("Transfer: state set: ".concat(F)),me._transferState=F,me.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_TRANSFER_STATE,{state:F}),me.raiseChanged())},me._setParkState=function(F){me.parkState!==F&&(me.logger.info("Parking: state set: ".concat(F)),me._parkState=F,me.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_PARK_STATE,{state:F}),me.raiseChanged())},me.prepareNegotiationResultForTelemtry=function(F){return{isComplete:F.isComplete,activeModalities:F.activeModalities,configuredModalities:F.configuredModalities,initiator:_e.scrubMriOrOmit(F.initiator),attemptedModalities:F.attemptedModalities,offeredModalities:F.offeredModalities}},me.prepareTelemetryForOfferAnswer=function(F){return F&&F.mediaContent&&{isRenegotiation:!!F.renegotiation,isEscalation:!!F.mediaContent.isTwoPartyToMultiPartyEscalation,mediaTypes:F.mediaTypes,newOffer:F.mediaContent.newOffer}},me.updateLocalParticipantEndpoints=function(F){var B=[];ne.each(F,(function(F){var G=Ee.convertSignalingEndpointDetails(F,me.getSelfClientEndpointCapabilities());B.push(G)})),me.endpoints.endpointDetails=B;var G=ne.find(B,(function(F){return me.participantId===F.participantId})),W=G&&G.lwjSessionInformation;W!==me.lwjInfo&&(me.lwjInfo=W,me.event("lwjChanged").raise(W),me.logger.info("lwjChanged: ".concat(JSON.stringify(me.lwjInfo))),W&&me.lwjFallbackInProgress&&(me.logger.info("LWJ fallback success"),me.callTelemetry.recordOperationSuccess(oe.CALL_OPERATIONS.LWJ_FALLBACK),me.lwjFallbackInProgress=!1));var z=me.getDataChannelSourceId();-1!==z&&me.dataChannel&&me.dataChannel.setDataChannelSourceId(z)},me.handleParticipantsMutedUpdated=function(F){var B,G;if(void 0!==F&&void 0!==F.muteUnmuteResponse){me.logger.info("handleParticipantsMutedUpdated: number of infos: ".concat(F.muteUnmuteResponse.length));try{for(var W=Z(Object.keys(F.muteUnmuteResponse)),z=W.next();!z.done;z=W.next()){var K=z.value,J=me.getParticipant(K);J&&J.handleServerMutedInfoUpdate(F.muteUnmuteResponse[K])}}catch(F){B={error:F}}finally{try{z&&!z.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}}},me.handleSelfUnmuteUpdatedInfo=function(F,B){var G,W;if(void 0!==F&&void 0!==F.muteUnmuteResponse){me.logger.info("handleSelfUnmuteUpdatedInfo");var _loop_1=function(G){var W=F.muteUnmuteResponse[G];if(G===me.localSignalingParticipant.id){var z=ne.find(W,(function(F){return F.participantId===me.localSignalingParticipant.participantId}));if(void 0===z)return"continue";var K=ne.find(me.localSignalingParticipant.endpointDetails,(function(F){return F.participantId===z.participantId}));Re.handleMuteUnmuteParticipantInfo(me.logger,K,z,!1)&&me.handleSelfServerMutedState(B)}};try{for(var z=Z(Object.keys(F.muteUnmuteResponse)),K=z.next();!K.done;K=z.next()){_loop_1(K.value)}}catch(F){G={error:F}}finally{try{K&&!K.done&&(W=z.return)&&W.call(z)}finally{if(G)throw G.error}}}},me.state=0,me.terminatedReason=0,me.callStats=new Te.CallTelemetryBuilder,me.callTelemetry=new ae.CallTelemetry(me.logger,me._callCreationTime),me.collectMediaStatsDeferred=re.defer(),me.setCallId($),me.setGroupId(Q),me.setThreadId(Y),me.setMessageId(de),me.setSkypeId(me.currentUserSkypeIdentity.id),me.setParticipantId(X),me.setCallOrigin(0),me.logger=me.logger.createChild((function(){var F=(me.endpointId||"").substr(0,8),B=(me.participantId||"").substr(0,8);return"Web[".concat(me.callId,"][").concat(F,"][").concat(B,"][").concat(me.state,"]")})),me.initializeSignalingSession(X),me.initializeImageRenderingSession(ce),me.signalingSession.setLocationInfo(ue,he,fe),me.streamManager=new Me.PluginlessCallStreamManager(me.participantId,null,me.callStats.localStats,me.logger,me.imageRenderingSession,me.mediaAgent.getConfigProvider()),me.mediaAgent&&(me.dataChannel=new De.PluginlessDataChannel(me.logger,me.mediaAgent.getConfigProvider()),me.dataChannel.on("remoteUserEventsReceived",(function(F,B){return me.event("remoteUserEventsReceived").raise(F,B)})),me.dataChannel.on("onDataChannelStateUpdated",(function(F){"Failed"===F&&(me.logger.error("onDataChannelStateUpdated: datachannel creation failed, will remove data modality"),me.mediaStateConfigurationHelper.removeModality(3),me.updateMediaModalities())})),me.screenSharingControl=new Ne.PluginlessScreenSharingControl(me.logger,me.dataChannel,me,me.telemetryLoggers),me.initializeMediaControlPlane(),me._enablePictureInPicture=me.mediaAgent.getConfigProvider().config.enablePictureInPicture);var ye={enableErrorConversion:me.ecsProvider.getEcsConfig("SkypeCalling","enableErrorConversion"),enableOperationIdempotency:me.ecsProvider.getEcsConfig("SkypeCalling","enableOperationIdempotency")};return me.logger.info("operationHandlerEcsConfig: ".concat(JSON.stringify(ye))),me._enableStaging=me.ecsProvider.getEcsConfig("SkypeCalling","enableStaging"),me.logger.info("enableStaging is: ".concat(me._enableStaging)),me._disableIsMultipartyDependenceOnThreadId=me.ecsProvider.getEcsConfig("SkypeCalling","disableIsMultipartyDependenceOnThreadId"),me._preferredMpLocation=me.ecsProvider.getEcsConfig("SkypeCalling","preferredMpLocation"),me._enablePluginlessCallParticipantRaiseChangeDeferred=me.ecsProvider.getEcsConfig("SkypeCalling","enablePluginlessCallParticipantRaiseChangeDeferred"),me._enableRemoveRosterNegotiations=me.ecsProvider.getEcsConfig("SkypeCalling","enableRemoveRosterNegotiations"),me._enableGlobalDeferHandler=me.ecsProvider.getEcsConfig("SkypeCalling","enableGlobalDeferHandler"),me._enableAutoPromotion=me.ecsProvider.getEcsConfig("SkypeCalling","enableAutoPromotion"),me.logger.info("disableIsMultipartyDependenceOnThreadId is: ".concat(me._disableIsMultipartyDependenceOnThreadId)),me._callOperationHandler=new ve.default(me.logger,me.callTelemetry,ye,void 0,(function(F,B){me.preconditions(F,B)})),me._participantOperationHandler=new ve.default(me.logger,me.callTelemetry,ye),me.setMeetingData(ge),me._enableAddParticipantPromiseOptimization=me.ecsProvider.getEcsConfig("SkypeCalling","enableAddParticipantPromiseOptimization"),me.logger.info("enableAddParticipantPromiseOptimization is: ".concat(me._enableAddParticipantPromiseOptimization)),me._enableMergeParticipantLegsBatchSupport=me.ecsProvider.getEcsConfig("SkypeCalling","enableMergeParticipantLegsBatchSupport"),me._enablePictureInPicture&&(me.pipManager=new Ue.PictureInPicture(me.mediaAgent.getConfigProvider(),me.logger.createChild("PictureInPicture"),me)),me}return z(PluginlessCall,F),Object.defineProperty(PluginlessCall.prototype,"callMode",{get:function(){return this._callMode},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"callId",{get:function(){return this._callId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"endpointId",{get:function(){return this._endpointId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"isHostless",{get:function(){return this.signalingSession.isHostLessCall},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"transferState",{get:function(){return this._transferState},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"parkState",{get:function(){return this._parkState},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"publishedStates",{get:function(){return this._publishedStates},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"dataChannelAdapter",{get:function(){return this.dataChannel},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"participantId",{get:function(){try{var F=this.signalingSession&&this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&this.signalingSession.participantManager.localParticipant.participantId;this._participantId=F||this._participantId}catch(F){this.logger.error("Error updating participantId")}return this._participantId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"role",{get:function(){return this.localSignalingParticipant.role},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"meetingRole",{get:function(){return this.localSignalingParticipant.meetingRole},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"advancedMeetingRole",{get:function(){return this.localSignalingParticipant.advancedMeetingRole},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"isMuted",{get:function(){return this._muteState===be.ParticipantMuteState.Muted||this._muteState===be.ParticipantMuteState.AttemptingUnmute},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"tenantId",{get:function(){return this.localSignalingParticipant.tenantId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"mediaLegId",{get:function(){return this._mediaLegId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"isIncomingOneOnOneVideoCall",{get:function(){return this.isOneToOneCall()&&this.isSomeoneStreamingVideo},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"mediaStreams",{get:function(){return this.streamManager.streams},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"isAudioStreamConnected",{get:function(){return this._isAudioStreamConnected},set:function(F){this._isAudioStreamConnected!==F&&(this._isAudioStreamConnected=F,this._wasAudioStreamConnected=this._wasAudioStreamConnected||F,this.raiseChanged())},enumerable:!1,configurable:!0}),PluginlessCall.prototype.setMeetingRole=function(F){F!==this.localSignalingParticipant.meetingRole&&(this.logger.info("changing self role to [".concat(F,"]")),this.localSignalingParticipant.meetingRole=F,this.event("meetingRoleUpdated").raise(F))},PluginlessCall.prototype.setAdvancedMeetingRole=function(F){F!==this.localSignalingParticipant.advancedMeetingRole&&(this.logger.info("changing self advanced meeting role to [".concat(F,"]")),this.localSignalingParticipant.advancedMeetingRole=F,this.event("advancedMeetingRoleUpdated").raise(F))},Object.defineProperty(PluginlessCall.prototype,"spamRiskLevel",{get:function(){return this._spamRiskLevel},set:function(F){F&&(this._spamRiskLevel=F)},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"spamStirAttestation",{get:function(){return this._spamStirAttestation},set:function(F){F&&(this._spamStirAttestation=F)},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"pictureInPicture",{get:function(){return this.pipManager},enumerable:!1,configurable:!0}),PluginlessCall.prototype.requestPictureInPicture=function(){var F;return $(this,void 0,void 0,(function(){return X(this,(function(B){try{return[2,null===(F=this.pipManager)||void 0===F?void 0:F.start()]}catch(F){this.logger.debug("PictureInPicture error: ".concat(JSON.stringify(F)))}return[2]}))}))},PluginlessCall.prototype.exitPictureInPicture=function(){var F;return $(this,void 0,void 0,(function(){return X(this,(function(B){try{return[2,null===(F=this.pipManager)||void 0===F?void 0:F.stop()]}catch(F){this.logger.debug("PictureInPicture error: ".concat(JSON.stringify(F)))}return[2]}))}))},PluginlessCall.prototype.getScreenHandle=function(){if(!this.sharedScreenHandle){var F=!!this.mediaSession&&this.mediaSession.getSessionConfig().mediaConfig.simulcastSessionEnabled,B=!this.mediaSession||!this.mediaSession.getSessionConfig().config.requireUserActionForAudioSharing||this._shouldShareSystemSound,G=!!this.mediaSession&&this.mediaSession.getSessionConfig().config.enableAudioSharing&&B,W=this.mediaStateConfigurationHelper.isSending(0)&&G&&F;this.sharedScreenHandle=this.mediaAgent.getDeviceManager().createDevicesHandle({audio:W,sharing:!0},"pluginlessCall:getScreenHandle()"),this.subscribeOnSharedScreenHandleEvents(this.sharedScreenHandle)}return this.sharedScreenHandle},PluginlessCall.prototype.setCallOrigin=function(F){this.logger.info("Set call origin to ".concat(F)),this._origin=F,this.callTelemetry.setCallOrigin(F),this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_CALL_ORIGIN,{origin:F})},PluginlessCall.prototype.setMediaLegId=function(F){this._mediaLegId=F,this.callStats.setMediaLegId(F)},PluginlessCall.prototype.setCallId=function(F){this.callTelemetry.setCallId(F),this.callStats.setCallId(F),this._callId=F},PluginlessCall.prototype.setEndpointId=function(F){this._endpointId=F,this.logger.info("[endpointId=".concat((0,pe.truncate)(this._endpointId,8),"]")),this.callTelemetry.setEndpointId(F),this.callStats.setEndpointId(F)},PluginlessCall.prototype.setFailureType=function(F){this.callTelemetry.setFailureType(F),this.failureType=F},PluginlessCall.prototype.setParticipantId=function(F){this._participantId=F,this.logger.info("[participantId=".concat(this._participantId,"]")),this.callTelemetry.setParticipantId(this.participantId)},PluginlessCall.prototype.setCallerMri=function(F){this.callerMri=F,this.logger.info("[callerMri=".concat(_e.scrubMriOrOmit(this.callerMri),"]"))},PluginlessCall.prototype.setTransferorMri=function(F){var B=(0,ge.stripMriAliases)(F);B!==this.transferorMri&&(this.transferorMri=B,this.logger.info("transferorMri: ".concat(_e.scrubMriOrOmit(this.transferorMri))),this.raiseChanged())},PluginlessCall.prototype.setGroupId=function(F,B){void 0===B&&(B=(0,se.generateCauseId)()),this.logger.info("[".concat(B,"][setGroupId] groupId=").concat(_e.scrubMriOrOmit(F))),this.groupId!==F&&(this.groupId=F,this.callTelemetry.setGroupId(F),this.event("groupIdChanged").raise(F))},PluginlessCall.prototype.setMeetingData=function(F){if(F){if(F.meetingCode&&(!this.meetingData||this.meetingData&&F.meetingCode!==this.meetingData.meetingCode)){var B=F.meetingCode;this.logger.info("[setMeetingData] meetingCode=".concat(B)),this.callTelemetry.setMeetingCode(B),this.signalingSession.setMeetingCode(B)}if(F.meetingUrl&&(!this.meetingData||this.meetingData&&F.meetingUrl!==this.meetingData.meetingUrl)){var G=F.meetingUrl.split("?")[0];this.logger.info("[setMeetingData] meetingUrl=".concat(F.meetingUrl)),this.callTelemetry.setMeetingUrl(G),this.signalingSession.setMeetingUrl(G)}}this.meetingData=F},PluginlessCall.prototype.setThreadId=function(F,B){void 0===B&&(B=(0,se.generateCauseId)()),this.threadId!==F&&(this.logger.info("[".concat(B,"][setThreadId] threadId=").concat(_e.getLoggableThreadId(F))),this.threadId=F,this.callTelemetry.setThreadId(F))},PluginlessCall.prototype.setMessageId=function(F,B){void 0===B&&(B=(0,se.generateCauseId)()),this.messageId!==F&&(this.logger.info("[".concat(B,"][setMessageId] messageId=").concat(_e.scrubMriOrOmit(F))),this.messageId=F,this.callTelemetry.setMesageId(F))},PluginlessCall.prototype.setSkypeId=function(F,B){void 0===B&&(B=(0,se.generateCauseId)()),this.skypeId!==F&&(this.logger.info("[".concat(B,"][setSkypeId]")),this.skypeId=F,this.callTelemetry.setSkypeId(F))},PluginlessCall.prototype.setCallType=function(F,B){var G=this.logger.createFnLogger("setCallType",B);G.info("current=".concat(this.callType,", newValue: ").concat(F)),2!==this.callType||1!==F?F!==this.callType&&(this.callType=F,this.callTelemetry.setCallType(F),2===F&&this.callStats.localStats.call.event(Te.CallEvent.MultiPartyModeSet),this.raiseChanged()):G.logFailure("De-escalating to P2P should not happen!")},PluginlessCall.prototype.setConversationType=function(F,B){this.logger.createFnLogger("setConversationType",B).info("current=".concat(this.conversationType,", newValue=").concat(F)),F!==this.conversationType&&(this.conversationType=F,this.callTelemetry.setConversationType(F),this.raiseChanged())},PluginlessCall.prototype.setCallUsesMixer=function(F,B){this.callUsesMixer!==!!F&&(this.logger.info("[".concat(B,"][setCallUsesMixer] new value=").concat(F)),this.callUsesMixer=F,this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.CALL_USES_MIXER,{newValue:F},B),this.dataChannel.setMultiparty(F)),F&&this.mediaControlPlane.start()},PluginlessCall.prototype.setIsEscalationInProgress=function(F,B){this.logger.info("[".concat(B,"][setIsEscalationInProgress] currentValue=").concat(this.isEscalationInProgress,", newValue=").concat(F)),this.isEscalationInProgress=F,this.allowScreenSharingControl()&&this.screenSharingControl.setIsEscalationInProgress(F),this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.ESCALATION_IN_PROGRESS,void 0,B)},PluginlessCall.prototype.processCallStartOptions=function(F,B){var G=this.logger.createFnLogger(oe.CALL_OPERATIONS_INTERNAL.PROCESS_CALL_START_OPTIONS,B);try{1&F.preheatFlags&&(this.isPreheatEnabled=!0)}catch(F){G.logFailure(F)}},PluginlessCall.prototype.getlocalScreenShareStream=function(){return ne.find(this.localMediaStreams,(function(F){return 2===F.mediaType}))},PluginlessCall.prototype.updateDisplayName=function(F){this.logger.info("updating displayName"),this.localSignalingParticipant.displayName=F,this.signalingSession.participantManager.localParticipant.displayName=F},PluginlessCall.prototype.init=function(F){if(this.logger.info("init callInitOptions:".concat((0,pe.safeJsonStringify)((0,pe.getPIISafeCallInitOptions)(F)))),this.signalingSessionCallOptions={teamsMessageId:F.messageId,enableGroupCallMeetupGeneration:F.enableGroupCallMeetupGeneration,meetingInfo:F.meetingInfo,emergencyContent:F.emergencyContent?JSON.parse(F.emergencyContent):void 0,broadcastContext:F.broadcastContext,endpointMetadata:F.endpointMetadata},this.setMessageId(F.messageId),this.onBehalfOfMri=F.onBehalfOf,F.threadId&&(this.setThreadId(F.threadId),this.signalingSession.setThreadId(F.threadId)),this.groupId&&this.signalingSession.setGroupId(this.groupId),this.signalingSession.setCallOptions(this.signalingSessionCallOptions),F.transferContext){switch(this.logger.info("Transfer: Call.init, set transferContext",Pe.scrubITransferContext(F.transferContext)),this.signalingSession.setTransferContext(F.transferContext.context),F.transferContext.transferType){case 1:this.setCallOrigin(2);break;case 0:this.setCallOrigin(1);break;case 2:this.setCallOrigin(3);break;default:throw new Error("TransferType: ".concat(F.transferContext.transferType," doesn't have a switch option"))}F.transferContext.context.callAcceptanceCallback?this._transferredCallAcceptanceCallback=F.transferContext.context.callAcceptanceCallback:this.logger.info("[failed]Transfer: Missing transferred call acceptance callback"),F.transferContext.transferorMri&&this.setTransferorMri(F.transferContext.transferorMri)}this.setIsEmergency(!!F.isEmergency),this.raiseChanged()},PluginlessCall.prototype.getIncomingRawAudioStream=function(){if(!this.mediaSession)throw this.logger.error("can not execute getIncomingRawAudioStream as there is no mediaSession"),new Error("NoMediaSession");return this.mediaSession.getIncomingRawAudioStream()},PluginlessCall.prototype.setDeviceManager=function(F){},PluginlessCall.prototype.startVideo=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(F){return[2,this.startStopVideo(!0,B)]}))}))},PluginlessCall.prototype.stopVideo=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(F){return[2,this.startStopVideo(!1,B)]}))}))},PluginlessCall.prototype.dumpVideoSourceImages=function(){return $(this,void 0,void 0,(function(){return X(this,(function(F){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.hold=function(F,B,G,W){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var z;return X(this,(function(K){return(z=this.logger.createFnLogger(oe.CALL_OPERATIONS.HOLD,B)).info("[".concat(oe.CALL_OPERATIONS.HOLD,"][").concat(B,"] negotiationTag ").concat(F," hold options: ").concat((0,pe.safeJsonStringify)(G))),this.isJoinedLightweight()?(z.logFailure("Can not put lightweight call on hold"),[2,Promise.reject(60)]):4===this.state?(z.logFailure("Trying to put a call on hold which is already held state, early resolving the promise"),[2,Promise.resolve(void 0)]):[2,G&&G.isLocal?this.localHold(B,G,W):this.holdWithRenegotiate(B,G)]}))}))},PluginlessCall.prototype.holdWithRenegotiate=function(F,B){return $(this,void 0,void 0,(function(){return X(this,(function(G){return this.isValidHoldResumeCallState(this.state)?[2,this.setHold(!0,F,B)]:(this.logger.logFailure("[".concat(oe.CALL_OPERATIONS.HOLD,"][").concat(F,"] Trying to hold a call in an invalid state: ").concat(this.state)),[2,Promise.reject("Trying to hold a call in an invalid state: ".concat(this.state))])}))}))},PluginlessCall.prototype.localHold=function(F,B,G){return $(this,void 0,void 0,(function(){return X(this,(function(W){return this.isValidHoldResumeCallState(this.state)?[2,this.setHold(!0,F,B,G)]:(this.logger.logFailure("[".concat(oe.CALL_OPERATIONS.LOCAL_HOLD,"][").concat(F,"] Trying to hold a call in an invalid state: ").concat(this.state)),[2,Promise.reject("Trying to hold a call in an invalid state: ".concat(this.state))])}))}))},PluginlessCall.prototype.unhold=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var F;return X(this,(function(G){return F=this.logger.createFnLogger(oe.CALL_OPERATIONS.UNHOLD,B),3===this.state?(F.logFailure("Trying to resume a call which is already in connected state, early resolving the promise"),[2,Promise.resolve(void 0)]):4===this.state?(F.info("current hold state ".concat(this.requestedHoldState)),[2,this.setHold(!1,B)]):(F.logFailure("Trying to resume a call in an invalid state: ".concat(this.state)),[2,Promise.reject("Trying to resume a call in an invalid state: ".concat(this.state))])}))}))},PluginlessCall.prototype.canMerge=function(F,B){var G=F.isOneToOneCall(),W=3===this.state,z=4===F.state,K=G&&W&&z;return this.logger.info("[".concat(B,"][canMerge] Call ").concat(F.callId," isOneToOne ").concat(G)+" isCallConnected ".concat(W," call.state ").concat(this.state)+" isMergeOnHold ".concat(z," mergeCall.state ").concat(F.state," CanMerge result: ").concat(K)),K},PluginlessCall.prototype.updateEndpointMetadata=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(G){return[2,this.signalingSession.updateEndpointMetadata(F,B)]}))}))},PluginlessCall.prototype.sendDtmfTone=function(F){return $(this,void 0,void 0,(function(){var B;return X(this,(function(G){return this.mediaSession?(B=this.toneToString(F))?(this.logger.info("[".concat(me.causeId,"][sendDtmfTone]DtmfTone: <omitted>")),[2,Promise.resolve(this.mediaSession.sendDtmf(B))]):[2,Promise.reject(new Error("Unsupported DtmfTone"))]:[2,Promise.reject(new Error("no mediaSession"))]}))}))},PluginlessCall.prototype.setAudioUsageMode=function(F){return $(this,void 0,void 0,(function(){return X(this,(function(F){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.setAudioMidcallConfig=function(F,B){return $(this,void 0,void 0,(function(){return X(this,(function(F){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.setAudioMidcallConfigJson=function(F){return $(this,void 0,void 0,(function(){var B,G;return X(this,(function(W){if(!F||!F.noiseSuppressionMode)return[2,Promise.reject(60)];switch(B=0,String(F.noiseSuppressionMode)){case"Auto":"Off"!==(G=this.mediaSession.getSessionConfig().config.wasmdns.noiseSuppressionMode)&&(B="High"===G?3:2);break;case"High":B=3;break;case"Low":B=2}return[2,this.mediaAgent.getDeviceManager().audioEffectManager.setEffectAsync(B)]}))}))},PluginlessCall.prototype.setInitialTelemetry=function(F,B,G,W){var z,K,J,Q=!1;switch(F){case oe.CALL_OPERATIONS.SUBSCRIBE:case oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA:this.callTelemetry.setDirection(ae.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(ae.SELF_PARTICIPANT_ROLE.SUBSCRIBE),G||this.callTelemetry.setOperationVariant(F,oe.OPERATION_VARIANTS.CCWM),this.signalingSession.setInitialTelemetry(F,{correlationId:this.callId,causeId:W,conversationServiceUrl:G});break;case oe.CALL_OPERATIONS.ACKNOWLEDGE:0!==this.state&&8!==this.state&&this.callTelemetry.maybeRecordOperationSuccess(F,{code:4}),this.callTelemetry.setDirection(ae.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(ae.SELF_PARTICIPANT_ROLE.CALLEE),this.signalingSession.setInitialTelemetry(F,{causeId:W});break;case oe.CALL_OPERATIONS.JOIN_CALL:case oe.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA:this.callTelemetry.setDirection(ae.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(ae.SELF_PARTICIPANT_ROLE.JOIN),this.callSettings.useLwjForAllCalls?this.callTelemetry.setOperationVariant(F,oe.OPERATION_VARIANTS.LWJ):1&B.callStartOptions.preheatFlags&&this.callTelemetry.setOperationVariant(F,oe.OPERATION_VARIANTS.PREHEAT),(z=this.telemetryDataFromCallStartOptions(B.callStartOptions))&&this.callTelemetry.updateOperationData(F,z,W),K={muted:1==(1&B.callStartOptions.muteFlags),isPreheatOnly:1==(1&B.callStartOptions.preheatFlags),isLwj:Q=this.callSettings.useLwjForAllCalls},this.signalingSession.setInitialTelemetry(F,{correlationId:this.callId,causeId:W,conversationServiceUrl:G,joinCallOptions:K,offerGenerationTime:Date.now()-B.callStartTime});break;case oe.CALL_OPERATIONS.START_CALL:case oe.CALL_OPERATIONS.START_WITH_MEETING_DATA:this.callTelemetry.setDirection(ae.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(ae.SELF_PARTICIPANT_ROLE.CALLER),this.callSettings.useLwjForAllCalls||this.lwjFallbackInProgress?(Q=!0,this.callTelemetry.setOperationVariant(F,oe.OPERATION_VARIANTS.LWJ)):1&B.callStartOptions.preheatFlags&&this.callTelemetry.setOperationVariant(F,oe.OPERATION_VARIANTS.PREHEAT),(z=this.telemetryDataFromCallStartOptions(B.callStartOptions))&&this.callTelemetry.updateOperationData(F,z,W),(J=B.callStartOptions).isLwj=Q,this.signalingSession.setInitialTelemetry(F,{correlationId:this.callId,causeId:W,conversationServiceUrl:G,callStartOptions:J,offerGenerationTime:Date.now()-B.callStartTime});break;case oe.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL:case oe.CALL_OPERATIONS.START_CALL_WITH_NUDGE:case oe.CALL_OPERATIONS.START_CALL_AND_UNPARK:this.callTelemetry.setDirection(ae.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(ae.SELF_PARTICIPANT_ROLE.CALLER),this.signalingSession.setInitialTelemetry(F,{correlationId:this.callId,causeId:W,conversationServiceUrl:G,startCallOptions:B.callStartOptions,offerGenerationTime:Date.now()-B.callStartTime})}},PluginlessCall.prototype.setHold=function(F,B,G,W){var z;return $(this,void 0,void 0,(function(){var K,J,Q,Y,$,Z,ee,te,ne,ie=this;return X(this,(function(X){switch(X.label){case 0:if(K=this.logger.createFnLogger("setHold",B,"hold=".concat(F)),!this.canToggleAudio||this.callHoldResumeDeferred)return[2,Promise.reject(new Error("can not set hold as it is already in progress"))];this.callHoldResumeDeferred=re.defer(),this.isHoldInProgress=F,this.canToggleAudio=!1,this.canToggleVideo=!1,this.canToggleScreenSharing=!1,this.requestedHoldState=F,J=function(){ie.canToggleAudio=!0,ie.canToggleScreenSharing=!0,ie.canToggleVideo=!0},K.info("start, holdOptions: ".concat(JSON.stringify(G))),Q=this.callHoldResumeDeferred.promise,Y=F?oe.CALL_OPERATIONS.HOLD:oe.CALL_OPERATIONS.UNHOLD,$=this.convertClientScenario(W),Z={debugContent:{clientScenario:$}},X.label=1;case 1:return X.trys.push([1,4,,5]),F?this.isMuteOnHold=G&&G.isLocal&&5!==this.state:this.prepareModalitiesForResume(B),this.isMuteOnHold?[3,3]:[4,this.updateMediaModalities(void 0,B)];case 2:ee=X.sent(),this.updateMediaState(ee,B),this.updateScreenSharingState(ee,B),X.label=3;case 3:return F&&(this.prepareModalitiesForHold(B),5===this.state&&this.finishCallHoldResume(),this.setCallState(4,B)),this.isMuteOnHold&&this.setMuteOnHold(F,B),J(),te={code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""},this.callTelemetry.recordOperationSuccess(Y,te,null,B,Z),[3,5];case 4:return ne=X.sent(),this.callTelemetry.recordOperationFailure(Y,{error:(0,pe.getPIISafeObject)(ne)},null,B,Z),K.logFailure(ne),J(),null===(z=this.callHoldResumeDeferred)||void 0===z||z.reject(new Error("Failed setting hold state to ".concat(F))),this.callHoldResumeDeferred=null,[3,5];case 5:return[2,Q]}}))}))},PluginlessCall.prototype.transferCall=function(F){return this.logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(F)},PluginlessCall.prototype.callBlindTransfer=function(F,B,G){return void 0===B&&(B=(0,se.generateCauseId)()),this.executeCallTransfer(F,B,0,G)},PluginlessCall.prototype.callSafeTransfer=function(F,B,G){return void 0===B&&(B=(0,se.generateCauseId)()),this.executeCallTransfer(F,B,0,G)},PluginlessCall.prototype.transferCallToVoicemail=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),this.executeCallTransfer(F.transferTargetMri,B,2,void 0)},PluginlessCall.prototype.callConsultativeTransfer=function(F,B,G,W){void 0===B&&(B=(0,se.generateCauseId)());var z=this.logger.createFnLogger(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,B),K=F.participants[0],J=K&&K.acceptedBy||K&&K.id;return z.info("transferTargetParticipantLegId: ".concat(G," targetMri: ").concat(_e.scrubMriOrOmit(J))),this.executeConsultCallTransfer(F.callId,J,G,B,W)},PluginlessCall.prototype.consultativeTransferWithPickupCode=function(F,B){return $(this,void 0,void 0,(function(){var G,W,z,K,J;return X(this,(function(Q){return(G=this.logger.createFnLogger(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,B)).info("pickup code: ".concat(F)),!F||isNaN(Number(F))?(G.info("pickup code cannot be empty"),[2,Promise.reject((0,le.getRejectTransactionEnd)(oe.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]):(W=this._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,B,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),z="4:".concat(oe.UNPARK_CODE.SERVER_HOLD),K={unparkContent:{pickupCode:Number(F)}},J={disableForwardingAndUnanswered:!1},this.signalingSession.transferCallAsync(z,"TransferTypeStandard",K,J,B),[2,W])}))}))},PluginlessCall.prototype.callRedirect=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),this.logger.createFnLogger(oe.CALL_OPERATIONS.CALL_REDIRECT,B).info("redirectOptions: ".concat(JSON.stringify(F))),this.stopInternal({terminatedReason:75,redirectOptions:F,causeId:B}).then((function(){return{code:be.jsCallEndCodes.CallRedirected,subCode:be.jsCallEndSubCodes.CallRedirectedSuccess,phrase:be.jsCallEndPhrase.CallEndReasonRedirected,resultCategories:[be.ResultCategory.Success]}}))},PluginlessCall.prototype.convertParkContext=function(F){switch(F){case 1:return"sharedLinePark";case 4:return"sharedLineParkV2";case 0:return"teamPark";case 3:return"serverHoldV2";default:return"serverHold"}},PluginlessCall.prototype.convertClientScenario=function(F){switch(F){case 0:return"breakoutRoom";case 1:return"musicOnHoldV2";case 2:return"sharedLineAppearanceV2";default:return}},PluginlessCall.prototype.park=function(F,B){var G=this;void 0===B&&(B=(0,se.generateCauseId)());var W=this.convertParkContext(F);return this.logger.info("[".concat(B,"] [").concat(oe.CALL_OPERATIONS.PARK_CALL,"] start -  context ").concat(F," parkType ").concat(W)),this._pendingParkPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.PARK_CALL),"serverHoldV2"!==W&&this._setParkState(1),this.signalingSession.parkCallAsync(W,B).catch((function(F){G.logger.info("[".concat(B,"] [").concat(oe.CALL_OPERATIONS.PARK_CALL,"] error in parkCallAsync (synchronous error) : ").concat((0,pe.getPIISafeObject)(F),". Hold promise will be rejected by signaling callback")),G.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.PARK_CALL,{error:(0,pe.getPIISafeObject)(F)},B)})),this._pendingParkPromise},PluginlessCall.prototype.unpark=function(F,B){return $(this,void 0,void 0,(function(){var G,W=this;return X(this,(function(z){return G=this.convertParkContext(F),this.logger.info("[".concat(B,"] [").concat(oe.CALL_OPERATIONS.UNPARK_CALL,"] start -  context ").concat(F," parkType ").concat(G)),this._pendingUnparkPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.UNPARK_CALL),this.signalingSession.unparkAsync(G,B).catch((function(F){W.logger.info("[".concat(B,"] [").concat(oe.CALL_OPERATIONS.UNPARK_CALL,"] error in unparkAsync (synchronous error) : ").concat((0,pe.getPIISafeObject)(F),". Unhold promise will be rejected by signaling callback")),W.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.UNPARK_CALL,{error:(0,pe.getPIISafeObject)(F)},B)})),[2,this._pendingUnparkPromise]}))}))},PluginlessCall.prototype.getServerHoldLocation=function(){var F=this;return this._pendingParkPromise.then((function(){return F.logger.info("getServerHoldLocation ".concat(F.serverHoldLocation)),F.serverHoldLocation}))},PluginlessCall.prototype.getJoinBlob=function(){return Promise.resolve(JSON.stringify({conversationUrl:this.signalingSession.getConversationUrl(),conversationId:this.callId}))},PluginlessCall.prototype.getTechnicalInformationJson=function(){return Promise.resolve(JSON.stringify(this.mediaSession.getCallTechnicalInfo()))},PluginlessCall.prototype.isOneToOneCall=function(){return 1===this.callType&&1===this.participants.length},PluginlessCall.prototype.setMuteOnHold=function(F,B){this.mediaSession.muteHold(F,B),F||(this.computeCallState(B),this.isMuteOnHold=!1),this.finishCallHoldResume()},PluginlessCall.prototype.finishCallHoldResume=function(F){var B,G;F?null===(B=this.callHoldResumeDeferred)||void 0===B||B.reject(F):null===(G=this.callHoldResumeDeferred)||void 0===G||G.resolve(),this.isHoldInProgress=!1,this.callHoldResumeDeferred=null},PluginlessCall.prototype.computeCallState=function(F){var B=3;this._callInLobby?B=10:this.signalingSession.participantManager.localParticipant.isStaging&&this._enableStaging&&(B=13),this.logger.info("[".concat(F,"][computeCallState] the call state will be set to ").concat(B)),this.setCallState(B,F)},PluginlessCall.prototype.prepareModalitiesForResume=function(F){return $(this,void 0,void 0,(function(){return X(this,(function(B){switch(B.label){case 0:return this.mediaStateConfigurationHelper.isSending(1)?[4,this.turnOnLocalVideoPreview(F)]:[3,2];case 1:B.sent(),B.label=2;case 2:return[2]}}))}))},PluginlessCall.prototype.prepareModalitiesForHold=function(F){return $(this,void 0,void 0,(function(){return X(this,(function(B){switch(B.label){case 0:return[4,this.turnOffLocalVideoPreview(F)];case 1:return B.sent(),[2]}}))}))},PluginlessCall.prototype.updateMediaState=function(F,B){this.setVideoOn(F.video===this.mediaAgent.constants.MEDIA_STATE.sendReceive||F.video===this.mediaAgent.constants.MEDIA_STATE.send,B),this.setAudioOn(F.audio===this.mediaAgent.constants.MEDIA_STATE.sendReceive||F.audio===this.mediaAgent.constants.MEDIA_STATE.send,B)},PluginlessCall.prototype.updateScreenSharingState=function(F,B){this.setScreenSharingOn(F.sharing===this.mediaAgent.constants.MEDIA_STATE.send,B)},PluginlessCall.prototype.subscribeOnSharedScreenHandleEvents=function(F){var B=this;this.sharedHandleSubs=F.on("onStreamStateChanged",(function(F,G){return B.onSharingStreamStateChanged(F)}))},PluginlessCall.prototype.unsubscribeFromSharedScreenHandleEvents=function(){this.sharedHandleSubs.dispose(),this.sharedHandleSubs=null},PluginlessCall.prototype.onSharingStreamStateChanged=function(F){var B=(0,se.generateCauseId)();this.logger.info("[".concat(B,"] Sharing stream state moved to ").concat(F));var G={mediaType:2,mediaDirection:1,mediaStreamState:PluginlessCall.streamingStatetoMediaStreamState(F)};this.event("mediaStreamStateChanged").raise(G),this.callStats.localStats.screenShare.streamStateChanged(F),"stopped"===F&&(this.canToggleScreenSharing=!0,this.stopScreenSharing(),"screenSharingCall"!==this.conversationType||this.participants.some((function(F){return 3===F.state}))||this.stop(!0,B))},PluginlessCall.prototype.startScreenSharing=function(F,B,G,W){return void 0===W&&(W=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var F,B,z=this;return X(this,(function(K){return this.allowScreenSharingControl()&&(this.screenSharingControl.shutdownControlForViewer(),this.screenSharingControl.initControlForSharer(G)),F=this.logger.createFnLogger(oe.CALL_OPERATIONS.START_SCREEN_SHARING,W),this.isJoinedLightweight()?(F.logFailure("Can not start screen sharing in lightweight call"),[2,Promise.reject(60)]):this.canToggleScreenSharing?this.isScreenSharingOn?(F.logSuccess("Resolving early because screen sharing is already on"),[2,Promise.resolve()]):(this.screenSharingRenegotiationDeferred&&(F.logFailure("called before the renegotiation deferred for the previous one has been closed"),this.screenSharingRenegotiationDeferred.resolve()),this.screenSharingRenegotiationDeferred=re.defer(),this.callStats.localStats.newSession(2),this.callStats.localStats.screenShare.start(),this.mediaStateConfigurationHelper.isDisabled(2)&&F.info("sharing modality was skipped till now. Adding it now"),this.canToggleScreenSharing=!1,B=function(){z.canToggleScreenSharing=!0},this.callStats.localStats.screenShare.event(Te.MediaSenderEvent.SelectSource),[2,this.getScreenHandle().acquire().then((function(){return F.logSuccess("sharing stream acquired"),z.mediaStateConfigurationHelper.enableModality(2),z.updateMediaModalities(void 0,W)})).then((function(){return F.logSuccess("updateMediaModalities done"),z.callStats.localStats.screenShare.negotiationStateChanged("started"),z.setScreenSharingOn(!0,W),B(),z.screenSharingRenegotiationDeferred.promise})).then((function(){z.enableControlInjector(),z.callStats.localStats.screenShare.negotiationStateChanged("completed")})).catch((function(G){z.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.START_SCREEN_SHARING,{error:(0,pe.getPIISafeObject)(G)},W),z.setScreenSharingOn(!1,W),z.mediaStateConfigurationHelper.removeModality(2),B(),z.disposeSharingScreenHandle();var K=G.error;throw K&&K.code===be.jsCallEndCodes.GlareError?(z.callStats.localStats.screenShare.negotiationStateChanged("rejected","glare"),F.logFailure("starting screen sharing failure with reason glare")):"ScreenSharingStopped"===G.reason?(z.callStats.localStats.screenShare.negotiationStateChanged("rejected","sharingStopped"),F.logFailure("expectedstarting screen sharing failure with reason stopped")):(z.callStats.localStats.screenShare.negotiationStateChanged("rejected","other"),F.logFailure(G)),G}))]):[2,Promise.reject(new Error("cannot start screen sharing"))]}))}))},PluginlessCall.prototype.stopScreenSharing=function(F,B,G){return void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var F,B,W=this;return X(this,(function(z){return F=this.logger.createFnLogger(oe.CALL_OPERATIONS.STOP_SCREEN_SHARING,G),this.isJoinedLightweight()?(F.logFailure("Can not stop screen sharing in lightweight call"),[2,Promise.reject(60)]):this.canToggleScreenSharing?this.isScreenSharingOn||this._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.START_SCREEN_SHARING)?(this.screenSharingRenegotiationDeferred&&(this.screenSharingRenegotiationDeferred.reject({reason:"ScreenSharingStopped"}),this.screenSharingRenegotiationDeferred=null),this.mediaStateConfigurationHelper.removeModality(2),this.canToggleScreenSharing=!1,B=function(){W.canToggleScreenSharing=!0,W._shouldShareSystemSound=!1,W.callStats.localStats.screenShare.stop(),W.disposeSharingScreenHandle()},this.allowScreenSharingControl()&&this.screenSharingControl.shutdownControlForSharer(),[2,this.updateMediaModalities(void 0,G).then((function(){return W.setScreenSharingOn(!1,G)})).then(B,(function(z){throw F.logFailure(z),W.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.STOP_SCREEN_SHARING,{error:(0,pe.getPIISafeObject)(z)},G),B(),z}))]):(F.logFailure("screensharing is not on, ignore this operation"),[2,Promise.resolve()]):(F.logFailure("cannot stop screen sharing"),[2,Promise.reject(new Error("cannot stop screen sharing"))])}))}))},PluginlessCall.prototype.startDataChannel=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(F){switch(F.label){case 0:if(!this.allowDataChannel())throw new Error("startDataChannel is disabled since ECS flag prohibits it");return this.mediaStateConfigurationHelper.enableModality(3),[4,this.updateMediaModalities({},B)];case 1:return F.sent(),[2]}}))}))},PluginlessCall.prototype.stopDataChannel=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(F){switch(F.label){case 0:if(!this.allowDataChannel())throw new Error("stopDataChannel is disabled since ECS flag prohibits it");return this.mediaStateConfigurationHelper.removeModality(3),[4,this.updateMediaModalities({},B)];case 1:return F.sent(),[2]}}))}))},PluginlessCall.prototype.allowDataChannel=function(){return this.mediaSession?!!this.mediaSession.getSessionConfig().mediaConfig.simulcastSessionEnabled&&(this.isOneToOnePSTNCall()?this.mediaSession.getSessionConfig().config.enableDataChannelPstn:this.mediaSession.getSessionConfig().config.enableDataChannel):(this.logger.warn("datachannel not allowed as there is no mediaSession"),!1)},PluginlessCall.prototype.isGiveControlEnabled=function(){var F,B,G=null===(B=null===(F=this.mediaSession)||void 0===F?void 0:F.getSessionConfig())||void 0===B?void 0:B.config;return G?G.enableGiveControl:(this.logger.warn("Give take control is not enabled as there is no mediaSession, sessionConfig or sessionConfig.config"),!1)},PluginlessCall.prototype.isInitialSignalingDSHSubscriptionEnabled=function(){var F,B,G=null===(B=null===(F=this.mediaSession)||void 0===F?void 0:F.getSessionConfig())||void 0===B?void 0:B.config;return G?G.enableInitialSignalingDSHSubscription:(this.logger.warn("Initial signaling dsh subscription is enabled as there is no mediaSession, sessionConfig or sessionConfig.config"),!0)},PluginlessCall.prototype.allowScreenSharingControl=function(){return this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.allowDataChannel()},PluginlessCall.prototype.sendUserEvents=function(F,B){return $(this,void 0,void 0,(function(){return X(this,(function(G){return[2,this.dataChannel.sendUserEvents(F,B)]}))}))},PluginlessCall.prototype.shareSystemSound=function(F){return $(this,void 0,void 0,(function(){return X(this,(function(B){return!!this.mediaSession&&this.mediaSession.getSessionConfig().mediaConfig.simulcastSessionEnabled&&this.mediaSession.getSessionConfig().config.enableAudioSharing&&this.mediaSession.getSessionConfig().config.requireUserActionForAudioSharing?(this.logger.debug("ShareSystemSound: ".concat(F)),this._shouldShareSystemSound=F,[2,Promise.resolve()]):[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.mute=function(F){return void 0===F&&(F=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(B){return this.isMuted?[2,Promise.reject((0,le.getRejectTransactionEnd)(oe.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]:[2,this.muteUnmute(!0,F)]}))}))},PluginlessCall.prototype.unmute=function(F){return void 0===F&&(F=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(B){return[2,this.muteUnmute(!1,F)]}))}))},PluginlessCall.prototype.muteSpeaker=function(F){return void 0===F&&(F=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(B){return[2,this.muteUnmuteSpeaker(!0,F)]}))}))},PluginlessCall.prototype.unmuteSpeaker=function(F){return void 0===F&&(F=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(B){return[2,this.muteUnmuteSpeaker(!1,F)]}))}))},PluginlessCall.prototype.muteParticipants=function(F,B,G){return void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W,z,K,J=this;return X(this,(function(Q){return(W=this.logger.createFnLogger(oe.CALL_OPERATIONS.MUTE_PARTICIPANTS,G,"muteScope=".concat(F))).info("callParticipants count=".concat(B.length)),void 0===(z=PluginlessCall.convertMuteScope(F))?(W.logFailure("Unrecognized ".concat(F)),[2,Promise.reject(new Error("Unrecognized muteScope"))]):Ce.callStateIsAnyOf(this.state,[11,12])?(W.logFailure("Can not mute/unmute during preheat call"),[2,Promise.reject(60)]):(K=[],B.forEach((function(F){K.push(F.id)})),[2,this.signalingSession.muteAsync(z,K,G).then((function(F){return J.handleParticipantsMutedUpdated(F)})).catch((function(F){return J.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.MUTE_PARTICIPANTS,{error:(0,pe.getPIISafeObject)(F)},G),W.logFailure(F),F&&F.endCode?Promise.reject(F.endCode):Promise.reject(F)}))])}))}))},PluginlessCall.prototype.startAudio=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var F,G,W;return X(this,(function(z){switch(z.label){case 0:if(F=this.logger.createFnLogger(oe.CALL_OPERATIONS.START_AUDIO,B),this.receiveOnlyAudioOnCallStart=!1,3!==this.state)return F.logFailure("Cannot startAudio when call is not connected"),[2,Promise.reject(60)];if(this.isJoinedLightweight())return F.logFailure("Can not startAudio in lightweight call"),[2,Promise.reject(60)];if(this.mediaStateConfigurationHelper.enableModality(0),this.callUsesMixer&&this.mediaStateConfigurationHelper.removeModality(1),!this.mediaStateConfigurationHelper.isSending(1))return[3,4];z.label=1;case 1:return z.trys.push([1,3,,4]),[4,this.turnOnLocalVideoPreview(B)];case 2:return z.sent(),[3,4];case 3:return G=z.sent(),F.logFailure(G),[2,Promise.reject(25)];case 4:return[4,this.startStopAudio(!0,B)];case 5:return W=z.sent(),[4,this.signalingSession.recordTelemetryForStartAudio(W)];case 6:return z.sent(),[2,W]}}))}))},PluginlessCall.prototype.stopAudio=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var F,G;return X(this,(function(W){switch(W.label){case 0:return F=this.logger.createFnLogger(oe.CALL_OPERATIONS.STOP_AUDIO,B),3!==this.state?(F.logFailure("Cannot stopAudio when call is not connected"),[2,Promise.reject(60)]):this.isJoinedLightweight()?(F.logFailure("Can not stopAudio in lightweight call"),[2,Promise.reject(60)]):(this.mediaStateConfigurationHelper.removeModality(0),[4,this.startStopAudio(!1,B)]);case 1:return G=W.sent(),[4,this.turnOffLocalVideoPreview(B)];case 2:return W.sent(),[4,this.signalingSession.recordTelemetryForStopAudio(G)];case 3:return W.sent(),[2,G]}}))}))},PluginlessCall.prototype.assimilate=function(F,B,G,W){return void 0===W&&(W=(0,se.generateCauseId)()),Promise.reject(new Error("Not implemented"))},PluginlessCall.prototype.merge=function(F,B,G){return void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W,z,K,J=this;return X(this,(function(Q){switch(Q.label){case 0:return(W=this.logger.createFnLogger(oe.CALL_OPERATIONS.MERGE_CALL,G)).error("merge callId ".concat(F.callId," callMergeOptions ").concat(JSON.stringify(B))),(z=this.canMerge(F,G))?(K=[],F.participants.forEach((function(F){K.push(J._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS.MERGE_CALL,F.id,G))})),[4,this.mergeCallByAddParticipantWithReplaces(B,F.participants,F,1,oe.CALL_OPERATIONS.MERGE_CALL,G,K,void 0)]):(W.info("Error. ".concat((0,pe.getPrintableObject)(z))),[2,Promise.reject((0,le.getRejectTransactionEnd)(oe.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]);case 1:return[2,Q.sent()[0]]}}))}))},PluginlessCall.prototype.mergeParticipants=function(F,B,G,W,z){return $(this,void 0,void 0,(function(){var K,J,Q,Y,$,ee,te,ne,ie,re,ae;return X(this,(function(X){if(K=[],!F)return[2,Promise.reject((0,le.getRejectTransactionEnd)("Invalid callToMerge"))];if(0===B.length)return[2,Promise.reject((0,le.getRejectTransactionEnd)("Invalid participantIds"))];J=[];try{for(Q=Z(B),Y=Q.next();!Y.done;Y=Q.next())$=Y.value,(ee=(0,ye.findParticipantUsingParticipantLegId)(F,$))?(te=this._enableMergeParticipantLegsBatchSupport?(0,ue.default)():$,ne={id:ee.id,participantId:te,replacementParticipantId:$},K.push(ne),J.push(this._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS.MERGE_PARTICIPANT,te,W))):(ie={code:oe.TRANSACTION_END_CODE.INVALID_PARTICIPANT,subCode:oe.TRANSACTION_END_SUBCODE.INVITE_FAILURE,phrase:"participantId ".concat($," is invalid!")},J.push(Promise.reject((0,le.getRejectTransactionEnd)(ie))))}catch(F){re={error:F}}finally{try{Y&&!Y.done&&(ae=Q.return)&&ae.call(Q)}finally{if(re)throw re.error}}return[2,this.mergeCallByAddParticipantWithReplaces(G,K,F,3,oe.CALL_OPERATIONS.MERGE_PARTICIPANT,W,J,z)]}))}))},PluginlessCall.prototype.mergeWithPickupCode=function(F,B,G,W){return void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var z,K,J,Q,Y=this;return X(this,(function($){return(z=this.logger.createFnLogger(oe.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,G)).info("mergeWithPickupCode: pickup code: ".concat(F,", groupId: ").concat(_e.scrubMriOrOmit(B.groupId),", threadId: ").concat(_e.getLoggableThreadId(B.threadId)," messageId: ").concat(B.messageId)),!F||isNaN(Number(F))?(z.info("mergeWithPickupCode: pickup code cannot be empty"),[2,Promise.reject((0,le.getRejectTransactionEnd)("mergeWithPickupCode: pickup code cannot be empty"))]):(K=this.convertClientScenario(W),J={additionalData:B.additionalData,groupId:B.groupId,threadId:B.threadId,messageId:B.messageId,replacementType:2,pickupCode:Number(F),clientScenario:K},Q={id:"4:".concat(oe.UNPARK_CODE.SERVER_HOLD)},[2,Promise.resolve().then((function(){return Promise.all(Y.signalingSession.addParticipantsAsync([Q],J,G))})).then((function(B){B.length>0&&Y.signalingNotifications.onParticipantJoined(B[0],G);var W={debugContent:{clientScenario:K}};return Y.callTelemetry.recordOperationSuccess(oe.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,null,F,G,W),Promise.resolve({code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:oe.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE})})).catch((function(F){z.logFailure("Participant was not added to call, error=".concat((0,pe.getPrintableObject)(F)));var B=Y._handleParticipantOperationFailure(oe.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,F,G,null,!0,K).reason;return Promise.reject(F?F.endCode:B||0)}))])}))}))},PluginlessCall.prototype.setMaxVideoChannels=function(F){return $(this,void 0,void 0,(function(){return X(this,(function(F){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.stop=function(F,B,G,W){return void 0===F&&(F=!1),void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var z,J,Q,Y;return X(this,(function($){return z=this.logger.createFnLogger(oe.CALL_OPERATIONS.STOP_AUDIO,B),6===this.state?(z.logFailure("Trying to stop a call which is already Disconnecting"),[2,Promise.reject(new Error("cannot stop call in Disconnecting state"))]):7===this.state?(z.logFailure("Trying to stop a call which is already Disconnected"),[2,Promise.reject(new Error("cannot stop call in Disconnected state"))]):this.disposedPromise?[2,Promise.reject("Call already ended")]:(J=0,1===this.state&&(J=10),Q=W?{clientReasonSubCode:W.clientSubCode,clientReasonPhrase:W.clientPhrase}:{},Y=K(K({terminatedReason:J,forEveryone:F,causeId:B},G),{rejectReason:Q}),[2,this.stopInternal(Y)])}))}))},PluginlessCall.prototype.publishState=function(F,B){var G=this.getPluginlessStateType(F.type),W=this.getPluginlessPublishLevel(F.level),z=F.participantIds&&F.participantIds.length>0?He.Specified:void 0;return this.callTelemetry.setOperationVariant(oe.CALL_OPERATIONS.PUBLISH_STATE,z===He.Specified?"".concat(G).concat(oe.OPERATION_VARIANTS.SPECIFIED):"".concat(G).concat(oe.OPERATION_VARIANTS.NONE),B),this.signalingSession.publishStateAsync(G,W,B,F.content,z,F.participantIds)},PluginlessCall.prototype.publishStatesForEveryone=function(F,B){var G=this.getPluginlessStateType(F.type),W=this.getPluginlessPublishLevel(F.level),z=He.All;return this.callTelemetry.setOperationVariant(oe.CALL_OPERATIONS.PUBLISH_STATE,"".concat(G).concat(oe.OPERATION_VARIANTS.ALL)),this.signalingSession.publishStateAsync(G,W,B,F.content,z)},PluginlessCall.prototype.removeState=function(F,B){return this.signalingSession.removeStateAsync(B,He.Specified,void 0,F.stateIds).then((function(F){return Promise.resolve()}))},PluginlessCall.prototype.removeStatesForEveryone=function(F,B){var G=this.getPluginlessStateType(F.type);return this.signalingSession.removeStateAsync(B,He.All,G,void 0).then((function(F){return Promise.resolve()}))},PluginlessCall.prototype.updateMeetingSettings=function(F,B){return this.signalingSession.updateMeetingSettingsAsync({allowRaiseHands:F.allowRaiseHands,attendeeRestrictions:F.attendeeRestrictions,lockMeeting:F.lockMeeting,breakoutRoomsEnabled:F.breakoutRoomsEnabled,allowPresentersToManageBreakoutRooms:F.allowPresentersToManageBreakoutRooms,disableMdpClientAudioRecording:F.disableMdpClientAudioRecording,refreshSettings:F.refreshSettings},B)},PluginlessCall.prototype.updateMeetingGroups=function(F,B){var G=this;this.logger.info("[".concat(oe.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,"][").concat(F,"] options ").concat((0,pe.safeJsonStringify)(B)));var W=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,F),z={fromGroup:B.fromGroup,toGroup:B.toGroup,scope:(0,Le.mapParticipantScope)(B.scope)};return B.participants&&(z.participants=(0,Le.createParticipantListFromMriMap)(B.participants)),this.signalingSession.updateMeetingsGroupsAsync(F,z).catch((function(B){G.logger.info("[".concat(F,"] [").concat(oe.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,"] error in updateMeetingGroups (synchronous error) : ").concat((0,pe.getPIISafeObject)(B),". updateMeetingGroupsPromise will be rejected by signaling callback")),G.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,{error:(0,pe.getPIISafeObject)(B)},F)})),W},PluginlessCall.prototype.updateMeetingLiveState=function(F,B){var G=this;return this.logger.info("[".concat(oe.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,"][").concat(F,"] options ").concat((0,pe.safeJsonStringify)(B))),this.signalingSession.updateMeetingLiveStateAsync(F,B).catch((function(B){G.logger.info("[".concat(F,"] [").concat(oe.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,"] error in updateMeetingLiveState (synchronous error) : ").concat((0,pe.getPIISafeObject)(B),". promise will be rejected by signaling callback")),G.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,{error:(0,pe.getPIISafeObject)(B)},F)})),this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,F)},PluginlessCall.prototype.updateParticipantInterpretationState=function(F,B){return $(this,void 0,void 0,(function(){var G,W,z,K,J=this;return X(this,(function(Q){if(this.logger.info("[".concat(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,"][").concat(F,"] options ").concat((0,pe.safeJsonStringify)(B))),0===B.length)return[2,Promise.reject((0,le.getRejectTransactionEnd)("Invalid UpdateParticipantInterpretationState options"))];for(G=this.signalingSession.updateParticipantInterpretationStateAsync(F,B),W=[],B.forEach((function(B){W.push(J._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,B.id,F))})),z=function(W){var z=G[W],K=B[W];z.then((function(){J.logger.logSuccess("updateParticipantInterpretationState succeeded for [id=".concat(_e.scrubMriOrOmit(K.id),"]"));var B={code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""};J.callTelemetry.recordOperationSuccess(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,B,K.id,F),J._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,B,K.id,F)})).catch((function(B){J.logger.error("[".concat(F,"] [").concat(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,"] error in updateParticipantInterpretationState (synchronous error) : ").concat((0,pe.getPIISafeObject)(B),". updateParticipantInterpretationStatePromise will be rejected by signaling callback")),J.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{error:(0,pe.getPIISafeObject)(B)},F);var G=J._handleParticipantOperationFailure(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,B,F,K.id).reason,W=(null==B?void 0:B.endCode)||G||0;J._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,W,K.id,F)}))},K=0;K<G.length;K++)z(K);return[2,Promise.resolve(W)]}))}))},PluginlessCall.prototype.joinMeetingGroup=function(F,B){var G=this;this.logger.info("[".concat(oe.CALL_OPERATIONS.JOIN_MEETING_GROUP,"][").concat(F,"] options ").concat((0,pe.safeJsonStringify)(B)));var W=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.JOIN_MEETING_GROUP,F),z=K({meetingGroupId:B.meetingGroupId},B.groupPreferences&&{groupPreferences:B.groupPreferences});return this.signalingSession.joinMeetingGroupAsync(F,z).catch((function(B){var W=(0,pe.getPIISafeObject)(B);G.logger.info("[".concat(F,"] [").concat(oe.CALL_OPERATIONS.JOIN_MEETING_GROUP,"] error in joinMeetingGroup (synchronous error) : ").concat(W,". joinMeetingGroupPromise will be rejected by signaling callback")),G.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.JOIN_MEETING_GROUP,{error:W},F)})),W},PluginlessCall.prototype.leaveMeetingGroup=function(F,B){var G=this;this.logger.info("[".concat(oe.CALL_OPERATIONS.LEAVE_MEETING_GROUP,"][").concat(F,"] options ").concat((0,pe.safeJsonStringify)(B)));var W=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.LEAVE_MEETING_GROUP,F),z={meetingGroupId:B.meetingGroupId};return this.signalingSession.leaveMeetingGroupAsync(F,z).catch((function(B){var W=(0,pe.getPIISafeObject)(B);G.logger.info("[".concat(F,"] [").concat(oe.CALL_OPERATIONS.LEAVE_MEETING_GROUP,"] error in leaveMeetingGroup (synchronous error) : ").concat(W,". leaveMeetingGroupPromise will be rejected by signaling callback")),G.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.LEAVE_MEETING_GROUP,{error:W},F)})),W},PluginlessCall.prototype.sendMessages=function(F,B){throw new Error("Not yet implemented")},PluginlessCall.prototype.updateMeetingRoles=function(F,B,G){return void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(W){return 3===this.state&&this.signalingSession.hasOwnProperty("updateMeetingRolesAsync")?[2,this.signalingSession.updateMeetingRolesAsync(F,B,G)]:[2,Promise.reject({code:ce.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:ce.CONSTANTS.SUB_CODE.ACTION_NOT_ALLOWED,phrase:"ActionNotAllowed"})]}))}))},PluginlessCall.prototype.stopInternal=function(F){var B=this,G=this.logger.createFnLogger("stopInternal",F.causeId),W=F.terminatedReason||0,z=F.rejectReason&&(F.rejectReason.code||F.rejectReason.subCode)?F.rejectReason:this.getRejectionInfoFromTerminatedReason(W);if(F.rejectReason&&(z||(z={}),z.clientReasonSubCode=F.rejectReason.clientReasonSubCode,z.clientReasonPhrase=F.rejectReason.clientReasonPhrase),G.info("started, terminatedReason=".concat(W,", rejectReason=").concat((0,pe.safeJsonStringify)(z))),6===this.state)return G.logFailure("Trying to stop a call which is already Disconnecting"),this.disconnectingPromise;if(7===this.state)return G.logFailure("Trying to stop a call which is already Disconnected"),this.disconnectingPromise;this.setCallState(6,F.causeId,W);var K={causeId:F.causeId,forEveryone:F.forEveryone,scope:this.mapEndpointScope(F.scope),redirectOptions:F.redirectOptions&&Ee.convertRedirectOptions(F.redirectOptions)};return 1===F.scope&&(z.code=ce.CONSTANTS.CODE.SUCCESS,z.subCode=ce.CONSTANTS.SUB_CODE.ENDED_BY_REMOTE_ENDPOINT,z.phrase=be.jsCallEndPhrase.EndedByRemoteEndpoint),this.disconnectingPromise=Promise.all([this.cleanUpMedia(F.causeId,z).catch((function(F){throw G.logFailure("cleanUpMedia failed with reason=".concat((0,pe.getPrintableObject)(F))),F})),this.signalingSession.endAsync(z,K).catch((function(F){throw G.logFailure("endAsync failed with reason=".concat((0,pe.getPrintableObject)(F))),F}))]).catch((function(W){throw G.logFailure(W),B.cleanUp(F.causeId,z),W})).then((function(){return B.cleanUp(F.causeId,z)})).catch((function(G){throw B.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.STOP_CALL,{error:(0,pe.getPIISafeObject)(G)},F.causeId),B.setCallState(7,F.causeId,W),G})),this.disconnectingPromise},PluginlessCall.prototype.cleanUp=function(F,B){return $(this,void 0,void 0,(function(){var G=this;return X(this,(function(W){return this.logger.info("[".concat(F,"][cleanup]start")),this.disposedPromise||(this.disposedPromise=this.cleanUpFinalize(F,B),this._getCallEndOperation().catch(de.noop).then((function(){var B={code:ce.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:ce.CONSTANTS.SUB_CODE.ABANDONED};G._callOperationHandler.rejectPendingOperations(61,F,B),G._participantOperationHandler.rejectPendingOperations(47,F,B)}))),[2,this.disposedPromise]}))}))},PluginlessCall.prototype.cleanUpMedia=function(F,B){return $(this,void 0,void 0,(function(){var G=this;return X(this,(function(W){return this.mediaDisposedPromise||(this.mediaDisposedPromise=$(G,void 0,void 0,(function(){var G,W,z,K,J,Q,Y;return X(this,(function($){switch($.label){case 0:if(this.turnOffLocalVideoPreview(F),this.localVideoContainer=null,null===(z=this.pipManager)||void 0===z||z.dispose(),this.disposeContentSharingSessions(),this.disposeSharingScreenHandle(),G=this.mediaSession,this.reportMediaStats=!!G,!G)return[2];this.mediaControlPlane.dispose(),this.dataChannel.dispose(),this.screenSharingControl.dispose(F),this.mediaSession=null,this.streamManager.setMediaSession(null,F),null===(K=this.participants)||void 0===K||K.forEach((function(B){B.setMediaSession(null,F)})),W=G.terminate(F,B),this.isVideoOn=!1,this.setMediaStream(this.isVideoOn,!1,1),this.setMediaStream(!1,!1,2),this.setMediaStream(!1,!1,0),this.isScreenSharingOn=!1,null===(J=this.screenSharingRenegotiationDeferred)||void 0===J||J.reject(B),this.screenSharingRenegotiationDeferred=null,this.mediaStateConfigurationHelper.removeModality(1),this.mediaStateConfigurationHelper.removeModality(0),this.mediaStateConfigurationHelper.removeModality(3),this.mediaStateConfigurationHelper.removeModality(2),(null===(Y=null===(Q=null==G?void 0:G.getSessionConfig())||void 0===Q?void 0:Q.config)||void 0===Y?void 0:Y.useOneDsLogger)&&G.getSessionConfig().config.addTelemetryReportingCallback&&window.removeEventListener("beforeunload",this.beforeUnloadTelemetrySender),$.label=1;case 1:return $.trys.push([1,,3,5]),[4,W];case 2:return $.sent(),[3,5];case 3:return[4,this.collectCallStats(G)];case 4:return $.sent(),[7];case 5:return[2]}}))}))),[2,this.mediaDisposedPromise]}))}))},PluginlessCall.prototype.cleanUpFinalize=function(F,B){return $(this,void 0,void 0,(function(){var G,W;return X(this,(function(z){switch(z.label){case 0:return z.trys.push([0,2,,3]),[4,this.cleanUpMedia(F,B)];case 1:return z.sent(),[3,3];case 2:return G=z.sent(),this.logger.info("[".concat(F,"][cleanUpMedia] failure: ").concat((0,pe.getPrintableObject)(G))),[3,3];case 3:return W=this.reportCallEndStats(this.reportMediaStats),this.mediaSession&&this.mediaSession.getSessionConfig().config.waitReportStatsAtCallStop?[4,W]:[3,5];case 4:z.sent(),z.label=5;case 5:return[2]}}))}))},PluginlessCall.prototype.shouldFallbackToLwj=function(F,B){B.info("Checking whether to fallback to LWJ");var G=this.signalingSession.getMeetingInfo();if(!G)return B.info("Not falling back to LWJ because call isn't a scheduled meeting (meetingInfo = ".concat(JSON.stringify(G),")")),!1;var W=this.callSettings.automaticLwjFallback&&this.callSettings.automaticLwjFallback.codeSubcodePairs;if(!(W&&W.some((function(B){return B[0]===F[0]&&B[1]===F[1]}))))return B.info("Not falling back to LWJ because [code, subcode] is ".concat(JSON.stringify(F)," but eligible reasons are ").concat(JSON.stringify(W))),!1;var z=this.meetingDetails&&this.meetingDetails.capabilities&&this.meetingDetails.capabilities.allowDialinConferencing;return z?(B.info("Falling back to LWJ (terminatedReason ".concat(F,", allowDialinConferencing ").concat(z,")")),!0):(B.info("Not falling back to LWJ because allowDialinConferencing is ".concat(z)),!1)},PluginlessCall.prototype.createContentSharingSession=function(F,B,G,W,z){return void 0===z&&(z=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var z,K,J=this;return X(this,(function(Q){return"attendee"===(this.advancedMeetingRole||this.meetingRole)?(z={terminatedReason:8,terminatedReasonCode:403,terminatedReasonSubCode:0,errorMessage:"Failed due to insufficient permissions"},[2,Promise.reject(z)]):(K=new we.default(this.callTelemetry,this.logger,this.signalingSession,F,B,W,G),this.contentSharingSessions.push(K),K.changed((function(){return J.removeContentSessionIfEnded(K)})),this.event("contentSharingChanged").raise(),[2,Promise.resolve(K)])}))}))},PluginlessCall.prototype.stopWithBeacon=function(F){return void 0===F&&(F=(0,se.generateCauseId)()),6===this.state||7===this.state||this.signalingSession.endWithBeacon(F)},PluginlessCall.prototype.disposeContentSharingSessions=function(){var F=this;this.contentSharingSessions.forEach((function(B){B.dispose(),F.removeContentSessionIfEnded(B)})),this.event("contentSharingChanged").raise()},PluginlessCall.prototype.isPreheatedOnly=function(){return!!(12===this.state||2===this.state&&this._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL)||9===this.state&&this._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL))},PluginlessCall.prototype.removeContentSessionIfEnded=function(F){7!==F.contentSharingStatus&&8!==F.contentSharingStatus||(this.logger.info("stopping the content sharing session."),ne.remove(this.contentSharingSessions,(function(B){return B.contentSharingGuid===F.contentSharingGuid})).length&&this.event("contentSharingChanged").raise())},PluginlessCall.prototype.getRejectionInfoFromTerminatedReason=function(F){switch(F){case 53:return{code:be.jsCallEndCodes.MediaError,subCode:be.jsCallEndSubCodes.MediaWhiteListingIssue,phrase:be.jsCallEndPhrase.MediaWhiteListingIssue};case 4:return{code:be.jsCallEndCodes.MediaError,subCode:this._wasAudioStreamConnected?be.jsCallEndSubCodes.MediaDropAfterConnect:be.jsCallEndSubCodes.MediaDropDuringConnect,phrase:this._wasAudioStreamConnected?be.jsCallEndPhrase.MediaDropAfterConnect:be.jsCallEndPhrase.MediaDropDuringConnect};case 47:return{code:be.jsCallEndCodes.MediaError,subCode:be.jsCallEndSubCodes.MediaOfferProcessingError,phrase:be.jsCallEndPhrase.MediaOfferProcessingError};case 38:return{code:be.jsCallEndCodes.MediaError,subCode:be.jsCallEndSubCodes.MediaRenegotiationError,phrase:be.jsCallEndPhrase.RetargetNotSupported};case 10:return{code:be.jsCallEndCodes.Reject,subCode:be.jsCallEndSubCodes.Success,phrase:be.jsCallEndPhrase.CallEndReasonLocalUserInitiated};case 25:return{code:be.jsCallEndCodes.UnknownError,subCode:be.jsCallEndSubCodes.MediaUnknownError,phrase:be.jsCallEndPhrase.MediaError};case 58:return{code:be.jsCallEndCodes.MediaError,subCode:be.jsCallEndSubCodes.MediaPermissionError,phrase:be.jsCallEndPhrase.MediaPermissionError};case 7:return{code:be.jsCallEndCodes.UnknownError,subCode:be.jsCallEndSubCodes.Success,phrase:be.jsCallEndPhrase.Unknown};case 0:case 1:return{code:be.jsCallEndCodes.Success,subCode:be.jsCallEndSubCodes.Success,phrase:be.jsCallEndPhrase.CallEndReasonLocalUserInitiated};case 75:return{code:be.jsCallEndCodes.CallRedirected,subCode:be.jsCallEndSubCodes.CallRedirectedSuccess,phrase:be.jsCallEndPhrase.CallEndReasonRedirected,resultCategories:[be.ResultCategory.Success]}}return null},PluginlessCall.prototype.acknowledge=function(F,B,G){return void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W,z,K,J,Q,Y,Z=this;return X(this,(function(ee){switch(ee.label){case 0:if(W=this.logger.createFnLogger(oe.CALL_OPERATIONS.ACKNOWLEDGE,G),z=Date.now(),this.setInitialTelemetry(oe.CALL_OPERATIONS.ACKNOWLEDGE,{callStartTime:z},"",G),0!==this.state&&8!==this.state)throw new Error("Trying to acknowledge a call that has already been acted on ".concat(this.state));W.info("isMultiParty=".concat(F.isMultiParty)),W.info("fromMixer=".concat(F.fromMixer)),W.info("participantId=".concat(F.participantId)),W.info("callType=".concat(F.callType)),this.attachToCallAndGetOffer=re.defer(),this.setCallType(F.isMultiParty?2:1,G),this.setCallUsesMixer(!!F.fromMixer,G),this.setCallerMri((0,ge.stripMriAliases)(F.callerId)),this.setTransferorMri(F.transferorId),this.transferorType=F.transferorType,this.transferorDisplayName=F.transferorDisplayName,this.incomingCallType=F.callType,this.consultativeCallId=F.consultativeCallId,this.callQueueInfo=F.callQueueInfo,this.callStats.localStats.startCall(),K=(0,Se.default)(W),ee.label=1;case 1:return ee.trys.push([1,3,,4]),K.executeSync(be.CallAckSignalingPhase.ProcessIncomingCallRequest,(function(){return Z.signalingSession.processIncomingCallRequest(F,B,G)})),this.setParticipantId(this.participantId),K.executeSync(be.CallAckSignalingPhase.ResolvePotentialConflict,(function(){return Z.signalingAgent.resolvePotentialCallConflict(Z.signalingSession)}))===this.signalingSession?[2,Promise.reject({code:7,success:!1})]:(J=function(){return $(Z,void 0,void 0,(function(){var F,B,z,J,Q=this;return X(this,(function(Y){switch(Y.label){case 0:return K.executeSync(be.CallAckMediaPhase.InitializeMediaSession,(function(){return Q.initializeMediaSession(G)})),this.signalingSession.updateDominantSpeakerHistoryMessageSubscription(this.isInitialSignalingDSHSubscriptionEnabled(),!1),F=this.signalingSession.getInitialMediaOfferFromIncomingCallPayload(),this.callStats.setParticipantId(this.participantId),this.onBehalfOfMri=this.signalingSession.onBehalfOf,[4,K.execute(be.CallAckSignalingPhase.WaitForMediaOffer,(function(){return F?Promise.resolve(F):Q.attachToCallAndGetOffer.promise}))];case 1:B=Y.sent(),Y.label=2;case 2:return Y.trys.push([2,4,,6]),[4,K.execute(be.CallAckMediaPhase.ProcessOffer,(function(){return Q.mediaSession.processOfferAsync(B,G)}))];case 3:return z=Y.sent(),[3,6];case 4:return J=Y.sent(),[4,this._handleOfferProcessingError(J,G,W)];case 5:return z=Y.sent(),[3,6];case 6:return[4,K.execute(be.CallAckMediaPhase.ProcessOfferedModalities,(function(){return Q._processOfferedModalities(z,G)}))];case 7:return Y.sent(),[4,K.execute(be.CallAckMediaPhase.TrySendingProvisionalAnswer,(function(){return Q._trySendProvisionalMediaAnswer(G)}))];case 8:return Y.sent(),[2]}}))}))},Q=function(){return K.execute(be.CallAckSignalingPhase.SendAttach,(function(){return Z.signalingSession.sendAttachToCall(G)})).then((function(){return Z.setCallState(1,G)}))}(),[4,Promise.all([Q,J()]).catch((function(F){return $(Z,void 0,void 0,(function(){return X(this,(function(B){switch(B.label){case 0:return[4,Q];case 1:throw B.sent(),F}}))}))}))]);case 2:return ee.sent(),[2,K.executeSync(be.CallAckSignalingPhase.OnAcknowledgeSuccess,(function(){return Z._onAcknowledgeSuccess(W,K.getTelemetryData(),G)}))];case 3:return Y=ee.sent(),[2,this._onAcknowledgeError(Y,G,W,K.getTelemetryData())];case 4:return[2]}}))}))},PluginlessCall.prototype.accept=function(F,B){var G;return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W,z,K,J,Q,Y,$,Z,ee=this;return X(this,(function(X){switch(X.label){case 0:if((W=this.logger.createFnLogger(oe.CALL_OPERATIONS.ACCEPT,B)).info("accept, answerMediaType: ".concat(F.answerMediaType,",\n                            withVideo: ").concat(F.withVideo,",\n                            muted: ").concat(F.muted,",\n                            getSendMediaModalities: ").concat(JSON.stringify(F.sendMediaModalities),",\n                            clientEndpointCapabilities: ").concat(F.clientEndpointCapabilities)),1!==this.state)throw new Error("Only calls in Notified state can be accepted");this.setCallOptions({callStartOptions:F,callStartTime:Date.now()}),z=this._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,B),this.callStats.localStats.audio.start(),K=(0,Se.default)(W),this.mediaSession.createAudioElement(B),this.setCallState(2,B),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.ACCEPT),X.label=1;case 1:return X.trys.push([1,10,,11]),F.forceAudioSendModalityWithNullStream&&this.mediaSession.useNullAudioStreamClient(),this.mediaStateConfigurationHelper.setCallAcceptOptions(F),this.mediaSession.getSessionConfig().config.alwaysNegotiateDataChannel&&this.mediaStateConfigurationHelper.enableModality(3),this.mediaStateConfigurationHelper.isSending(1)?[4,K.execute(be.CallSetupMediaPhase.StartVideoSafe,(function(){return ee.startVideoSafe(B)}))]:[3,3];case 2:X.sent(),X.label=3;case 3:return this.mediaStateConfigurationHelper.isSending(0)&&this.setAudioOn(!0,B),[4,K.execute(be.CallSetupMediaPhase.UpdateMediaModalities,(function(){return ee.updateMediaModalities(void 0,B)}))];case 4:return J=X.sent(),Q=K.executeSync(be.CallSetupSignalingPhase.GetSignalingMediaTypes,(function(){return ee.getSignalingMediaTypes(J)})),[4,K.execute(be.CallSetupMediaPhase.handleEndpointStatesForAccept,(function(){return ee.handleEndpointStatesForAccept(F.muted,null==F?void 0:F.additionalEndpointProperties,B)}))];case 5:return X.sent(),[4,K.execute(be.CallSetupMediaPhase.CreateAnswer,(function(){return ee.mediaSession.createAnswerAsync(!1,B)}))];case 6:return Y=X.sent(),[4,K.execute(be.CallSetupSignalingPhase.Accept,(function(){return ee.signalingSession.acceptAsync(Y,Q,F.clientEndpointCapabilities,B)}))];case 7:return X.sent(),[4,K.execute(be.CallSetupSignalingPhase.WaitForConnect,(function(){return z}))];case 8:return X.sent(),this.handleRemoteParticipantStateInOneToOneCall(B),[4,K.execute(be.CallSetupMediaPhase.CompleteNegotiation,(function(){return ee.completeNegotiationAsync(B)}))];case 9:return X.sent(),this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.ACCEPT,{phases:K.getTelemetryData()},B),[3,11];case 10:throw $=X.sent(),Z=$,this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.ACCEPT,this.getTelemetryFromPhaseExecution($),B),W.logFailure($),(0,Se.isOneOfPhaseErrors)(be.CallSetupSignalingPhase,$)&&(Z=7),(0,Se.isOneOfPhaseErrors)(be.CallSetupMediaPhase,$)&&(Z=47),(null===(G=this.mediaSession)||void 0===G?void 0:G.getSessionConfig().config.stopCallOnAcceptFailure)&&this.stopInternal({terminatedReason:Z,causeId:B}),Z;case 11:return[2]}}))}))},PluginlessCall.prototype.reject=function(F,B){return void 0===F&&(F=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var G;return X(this,(function(W){return G=B?{clientReasonSubCode:B.clientSubCode,clientReasonPhrase:B.clientPhrase}:{},[2,1!==this.state?Promise.reject(60):this.stopInternal({terminatedReason:10,causeId:F,rejectReason:G})]}))}))},PluginlessCall.prototype.join=function(F,B,G){return void 0===B&&(B={}),void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W;return X(this,(function(z){return W=Date.now(),this.setInitialTelemetry(oe.CALL_OPERATIONS.JOIN_CALL,{callStartOptions:B,callStartTime:W},F.conversationUrl,G),this.setCallerMri((0,ge.stripMriAliases)(F.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.JOIN_CALL),[2,this.joinOrStartCall({callStartOptions:Ee.getCallStartOptions(B),callStartTime:W},this.joinGivenConversation,G,F.conversationUrl)]}))}))},PluginlessCall.prototype.joinPreheatedCall=function(F,B){return $(this,void 0,void 0,(function(){var G,W,z,K,J,Q,Y,$,Z=this;return X(this,(function(X){switch(X.label){case 0:G=this.logger.createFnLogger(oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL,B),W=this.isServerMuted||1==(1&F.muteFlags),z=2==(2&F.muteFlags),K=(0,Se.default)(G),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL),X.label=1;case 1:return X.trys.push([1,8,,9]),J={endpointProperties:{preheatProperties:0}},this.setCallState(2,B),this.isCallModeStreaming()?[3,6]:W?[3,3]:[4,K.execute(be.CallSetupMediaPhase.UnmuteInput,(function(){return Z.mediaSession.unmuteInputAsync(B)}))];case 2:return X.sent(),this.setMuted(be.ParticipantMuteState.Unmuted,B),[3,4];case 3:J.state={isMuted:!0},X.label=4;case 4:return z?[3,6]:[4,K.execute(be.CallSetupMediaPhase.UnmuteOutput,(function(){return Z.mediaSession.unmuteOutputAsync(B)}))];case 5:X.sent(),this.setSpeakerMuted(!1,B),X.label=6;case 6:return[4,this.signalingSession.updateEndpointState(J,B)];case 7:return X.sent(),this.computeCallState(B),[3,9];case 8:return Q=X.sent(),Y=7,$=void 0,G.logFailure(" error: ".concat(Y," ").concat((0,pe.getPrintableObject)(Q))),(0,le.isTransactionEnd)(Q)?$=Q:(0,Se.isPhaseError)(be.CallSetupMediaPhase.UnmuteInput,Q)?$={code:be.jsCallEndCodes.LocalError,subCode:be.jsCallEndSubCodes.MediaUnmuteMicrophoneError,phrase:(0,pe.getPrintableObject)(Q),causeId:B}:(0,Se.isPhaseError)(be.CallSetupMediaPhase.UnmuteOutput,Q)&&($={code:be.jsCallEndCodes.LocalError,subCode:be.jsCallEndSubCodes.MediaUnmuteSpeakerError,phrase:(0,pe.getPrintableObject)(Q),causeId:B}),this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{phases:K.getTelemetryData(),error:(0,pe.getPIISafeObject)(Q)},B),this.stopInternal({causeId:B,terminatedReason:Y,rejectReason:$}),[2,Promise.reject($)];case 9:return[2]}}))}))},PluginlessCall.prototype.start=function(F,B){return void 0===F&&(F={}),void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var G;return X(this,(function(W){return G=Date.now(),this.setCallerMri(ge.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(oe.CALL_OPERATIONS.START_CALL,{callStartOptions:F,callStartTime:G},"",B),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.START_CALL),[2,this.joinOrStartCall({callStartOptions:Ee.getCallStartOptions(F),callStartTime:G},this.startOutgoingCall,B)]}))}))},PluginlessCall.prototype.startCallToVoicemail=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var G;return X(this,(function(W){return G=Date.now(),this.setCallerMri(ge.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(oe.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{callVoicemailStartOptions:F,callStartTime:G},"",B),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL),[2,this.joinOrStartCall({callVoicemailStartOptions:F,callStartTime:G},this.startVM,B)]}))}))},PluginlessCall.prototype.joinCallWithoutCallModality=function(F,B,G){return void 0===B&&(B={}),void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W,z,K=this;return X(this,(function(J){return W=Date.now(),this.setCallerMri(F.groupCallInitiator),this.setCallType(2,G),z={callStartOptions:Ee.getCallStartOptions(B),callStartTime:W},this.setInitialTelemetry(oe.CALL_OPERATIONS.SUBSCRIBE,z,F.conversationUrl,G),0!==this.state?(this.logger.info("[".concat(G,"][joinCallWithoutCallModality]Trying to subscribe to a call that has already been acted on")),[2,Promise.reject(60)]):(this.setCallOptions(z),this.setCallState(8,G),this.signalingSession.subscribeToCall(F.conversationUrl,this.callId,B.clientEndpointCapabilities,{meetingRegistrationId:B.meetingRegistrationId,clientEndpointDebugContent:B.clientEndpointDebugContent,additionalEndpointProperties:B.additionalEndpointProperties},G).catch((function(F){return(0,le.isTransactionEnd)(F)?(K.logger.info("[".concat(G,"][joinCallWithoutCallModality] ").concat((0,pe.getPrintableObject)(F))),Promise.reject(F)):Promise.reject(Ee.convertReason(F))})),[2,this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.SUBSCRIBE,void 0,G)])}))}))},PluginlessCall.prototype.startWithMeetingData=function(F,B){var G=Date.now();return this.setCallerMri(ge.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(oe.CALL_OPERATIONS.START_WITH_MEETING_DATA,{callStartOptions:B,callStartTime:G},"",F),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.START_WITH_MEETING_DATA),this.joinOrStartCall({callStartOptions:Ee.getCallStartOptions(B),callStartTime:G,meetingPreferences:{shouldResurrect:B.shouldResurrect}},this.startOutgoingCall,F)},PluginlessCall.prototype.joinWithMeetingData=function(F,B,G){var W=Date.now();return this.setInitialTelemetry(oe.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{callStartOptions:G,callStartTime:W},B.conversationUrl,F),this.setCallerMri((0,ge.stripMriAliases)(B.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA),this.joinOrStartCall({callStartOptions:Ee.getCallStartOptions(G),callStartTime:W,meetingPreferences:{shouldResurrect:G.shouldResurrect}},this.joinGivenConversation,F,B.conversationUrl)},PluginlessCall.prototype.subscribeWithMeetingData=function(F,B,G){var W=this,z=Date.now();this.setCallerMri(B.groupCallInitiator),this.setCallType(2,F);var K={callStartOptions:Ee.getCallStartOptions(G),callStartTime:z};return this.setInitialTelemetry(oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,K,B.conversationUrl,F),0!==this.state?(this.logger.info("[".concat(F,"][subscribeWithMeetingData]Trying to subscribe to a call that has already been acted on")),Promise.reject(60)):(this.setCallOptions(K),this.setCallState(8,F),this.signalingSession.subscribeToCall(B.conversationUrl,this.callId,G.clientEndpointCapabilities,{meetingPreferences:{shouldResurrect:G.shouldResurrect},meetingData:this.meetingData,meetingRegistrationId:G.meetingRegistrationId,additionalEndpointProperties:G.additionalEndpointProperties},F).catch((function(B){return(0,le.isTransactionEnd)(B)?(W.logger.info("[".concat(F,"][subscribeWithMeetingData] ").concat((0,pe.getPrintableObject)(B))),Promise.reject(B)):Promise.reject(Ee.convertReason(B))})),this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,void 0,F))},PluginlessCall.prototype.startCallWithNudge=function(F,B,G){return void 0===B&&(B={}),void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W,z;return X(this,(function(K){return this.setCallerMri(ge.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.START_CALL_WITH_NUDGE),W=Date.now(),this.logger.info("[".concat(G,"][startCallWithNudge]startCallWithNudge for participants: ").concat(_e.scrubMriOrOmitList(F))),this.participants.length?[2,Promise.reject(48)]:((z={}).callStartOptions=Ee.getCallStartOptions(B),z.invitationType=ie.CA_CONSTANTS.INVITATION_TYPE.NUDGE,z.participantsToNudge=F,z.callStartTime=W,this.setInitialTelemetry(oe.CALL_OPERATIONS.START_CALL_WITH_NUDGE,z,"",G),[2,this.joinOrStartCall(z,this.startOutgoingCall,G)])}))}))},PluginlessCall.prototype.startAndUnpark=function(F,B,G,W){return void 0===G&&(G={}),void 0===W&&(W=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var z,K,J;return X(this,(function(Q){return this.setCallerMri(ge.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),z=this.logger.createFnLogger(oe.CALL_OPERATIONS.START_CALL_AND_UNPARK,W),K=Date.now(),this.setInitialTelemetry(oe.CALL_OPERATIONS.START_CALL_AND_UNPARK,{callStartTime:K},"",W),z.info("startAndUnpark for context: ".concat(F,", pickupCode :").concat(B)),this.connectCallPromise=this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.START_CALL_AND_UNPARK),(J={}).callStartOptions=Ee.getCallStartOptions(G),J.parkContext=0===F?oe.UNPARK_CODE.PARK:1===F?oe.UNPARK_CODE.SHARED_LINE:oe.UNPARK_CODE.SERVER_HOLD,J.pickupCode=B,this.addParticipant("4:".concat(J.parkContext)).catch((function(F){return z.logFailure("Failed to add participant to unparked call")})),[2,this.joinOrStartCall(J,this.startOutgoingCall,W)]}))}))},PluginlessCall.prototype.admitParticipant=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var G,W,z,K,J;return X(this,(function(Q){return G=(0,ge.generateAliasedMri)(F),W=this.getParticipant(G),z=this._getParticipantLegId(W),K=z?{participantLegId:z}:{},W&&7!==W.state?(J={code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:oe.TRANSACTION_END_SUBCODE.NOT_IN_LOBBY,phrase:oe.TRANSACTION_END_PHRASE.NOT_IN_LOBBY},this.callTelemetry.maybeRecordOperationSuccess(oe.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,J,F,B,K),[2,Promise.reject(J)]):[2,this.admitParticipantToCall(G,B,z)]}))}))},PluginlessCall.prototype.admit=function(F,B){return this.signalingSession.admitAsync(B)},PluginlessCall.prototype.callMeBack=function(F,B,G){return void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var W;return X(this,(function(z){return W=(0,ge.generateAliasedMri)("".concat(ge.MRI_SKYPE_PREFIX).concat(this.currentUserSkypeIdentity.id),this.currentUserSkypeIdentity.sipUri),[2,this.addCallMeBackParticipant(F,B||W,G)]}))}))},PluginlessCall.prototype.addParticipant=function(F,B,G){return void 0===B&&(B={}),void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(W){switch(W.label){case 0:return[4,this.addParticipantsImpl([F],B,G,"addParticipant")];case 1:return[2,W.sent()[0]]}}))}))},PluginlessCall.prototype.addParticipants=function(F,B,G){return void 0===B&&(B={}),void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(W){return[2,this.addParticipantsImpl(F,B,G,"addParticipants")]}))}))},PluginlessCall.prototype.addParticipantsImpl=function(F,B,G,W){return void 0===B&&(B={}),void 0===G&&(G=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var z,K,J,Q,Y=this;return X(this,(function(Z){if(this.logger.info("[".concat(G,"][").concat(W,"] start")),this.isEmergency&&0===this.state&&(0!==this.participants.length||1!==F.length))return[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))];if(B.participantInvitationData)try{JSON.stringify(B.participantInvitationData)}catch(F){throw this.logger.info("[".concat(G,"][").concat(W,"] ").concat(F)),F}return z=[],K=[],F.forEach((function(F){var B=Y.getOrCreateParticipant(F,G);0===B.state||4===B.state?(K.push(B),z.push(Y._participantOperationHandler.createPendingOperation(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,B.id,G))):3===B.state?z.push(Promise.resolve(B)):Y._participantOperationHandler.hasPendingOperationWithOperationId(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,B.id)&&z.push(Y._participantOperationHandler.waitForOperation(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,B.id))})),0===K.length||(J=!!B.disableUnmute,Q=this.addParticipantsToCall(K,G,B.participantInvitationData,B.groupId,B.threadId,B.messageId,J,B.alternateId),ne.zip(Q,K).forEach((function(F){var B=ee(F,2),W=B[0],z=B[1];return $(Y,void 0,void 0,(function(){var F,B,K;return X(this,(function(J){switch(J.label){case 0:return J.trys.push([0,2,,3]),[4,W];case 1:return J.sent(),F=this._getParticipantLegId(this.getParticipant(z.id)),B=F?{participantLegId:F}:{},this.callTelemetry.recordOperationSuccess(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""},z.id,G,B),this._participantOperationHandler.maybeResolveOperation(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,z,z.id,G),[3,3];case 2:return K=J.sent(),this._participantOperationHandler.maybeRejectOperation(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,K,z.id,G),[3,3];case 3:return[2]}}))}))})),this.raiseChanged(this._participantChangedEventSkipConfig)),[2,Promise.resolve(z)]}))}))},PluginlessCall.prototype.nudgeParticipants=function(F,B,G,W){return void 0===G&&(G={}),void 0===W&&(W=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(F){return 2!==this.state&&3!==this.state?[2,Promise.reject(48)]:[2,this.signalingSession.nudgeParticipantsAsync({participantsIds:B,causeId:W,invitationData:G.participantInvitationData,newGroupId:G.groupId,newThreadId:G.threadId,newMessageId:G.messageId})]}))}))},PluginlessCall.prototype.mapEndpointScope=function(F){var B="none";switch(F){case 0:B="specified";break;case 1:case 1:B="all";break;default:B="none"}return B},PluginlessCall.prototype.removeParticipant=function(F,B,G,W){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var z,K,J=this;return X(this,(function(Q){return(z=this.logger.createFnLogger("removeParticipant",B)).info("start"),K=this.mapEndpointScope(W),[2,this.signalingSession.removeParticipantAsync({id:F,endpointId:G},B,K).catch((function(G){z.logFailure("Participant was not removed from call, error=".concat(G));var W=J._handleParticipantOperationFailure(oe.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,G,B,F).reason;return Promise.reject(W||38)}))]}))}))},PluginlessCall.prototype.searchParticipants=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(G){return[2,this.signalingSession.searchParticipantsAsync(F.searchQueryOptions,B)]}))}))},PluginlessCall.prototype.getAllParticipants=function(F,B){return void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){return X(this,(function(G){return[2,this.signalingSession.getAllParticipantsAsync(F.scope,B)]}))}))},Object.defineProperty(PluginlessCall.prototype,"dominantSpeakerInfo",{get:function(){var F;return this.internalDominantSpeakerInfo?this.internalDominantSpeakerInfo:(null===(F=this.mediaSession)||void 0===F?void 0:F.getSessionConfig().config.emptyInitialDSH)?{speakerList:[],timestamp:null,noCurrentDominantSpeaker:!1}:{speakerList:this.participants.filter((function(F){return 3===F.state})).map((function(F){return F.id})),timestamp:null,noCurrentDominantSpeaker:!1}},set:function(F){this.internalDominantSpeakerInfo=F},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,"slowedDownActiveTalkerInfo",{get:function(){return this.internalSlowedDownActiveTalkerInfo},set:function(F){var B;ne.isEqual(null===(B=this.internalSlowedDownActiveTalkerInfo)||void 0===B?void 0:B.speakerList,F.speakerList)||(this.internalSlowedDownActiveTalkerInfo=F,this.raiseChanged())},enumerable:!1,configurable:!0}),PluginlessCall.prototype.startVideoSafe=function(F){var B=this;return this.startVideo(F).catch((function(G){B.logger.info(G,"startVideoSafe",F)}))},PluginlessCall.prototype.joinOrStartCall=function(F,B,G,W){return $(this,void 0,void 0,(function(){var z,K,J,Q,Y,$,Z,ee;return X(this,(function(X){switch(X.label){case 0:return z=this.logger.createFnLogger("joinOrStartCall",G),0===this.state||8===this.state||F.isPromotingToRealtime?this.signalingAgent.resolvePotentialCallConflict(this.signalingSession)===this.signalingSession?[2,Promise.reject(57)]:(this.callStats.localStats.startCall(),J=!this._disableIsMultipartyDependenceOnThreadId&&!!this.threadId,Q=8===this.state||1!==this.participants.length||J,z.info("isMultiparty=".concat(Q,", reason: threadId set = ").concat(!!this.threadId,", participants.length=").concat(this.participants.length,", disableIsMultipartyDependenceOnThreadId = ").concat(!!this._disableIsMultipartyDependenceOnThreadId)),this.setCallType(Q?2:1,G),this.setCallUsesMixer(Q,G),this.setCallOptions(F),1==(1&(Y=F.callStartOptions||{}).preheatFlags)?(this.setMuted(be.ParticipantMuteState.Muted,G),this.setSpeakerMuted(!0,G),this.setCallState(11,G)):($=!!Y&&(Y.muted||1==(1&Y.muteFlags)),this.setMuted($?be.ParticipantMuteState.Muted:this.isServerMuted?be.ParticipantMuteState.ServerMuted:be.ParticipantMuteState.Unmuted,G),this.setCallState(2,G)),Z=(0,ae.calculateJoinedFromForTelemetry)(this.meetingData,this.threadId,this.messageId,this.groupId,!!W),this.callTelemetry.setJoinedFrom(Z),this.signalingSession.setJoinedFrom(Z),(ee=this._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,"",G)).catch(de.noop),this.callSettings.useLwjForAllCalls?[4,this.joinOrStartLwj(F,B,F.callStartTime,ee,G,W)]:[3,2]):(K="Trying to start a call that has already been acted on",z.logFailure(K),[2,Promise.reject(60)]);case 1:return X.sent(),[3,4];case 2:return[4,this.joinOrStartWithMedia(F,B,F.callStartTime,ee,G,W)];case 3:X.sent(),X.label=4;case 4:return[2,ee]}}))}))},PluginlessCall.prototype.joinOrStartLwj=function(F,B,G,W,z,K){return $(this,void 0,void 0,(function(){var J;return X(this,(function(Q){switch(Q.label){case 0:return Q.trys.push([0,2,,3]),B(z,F,null,null,G,K),[4,W];case 1:return Q.sent(),[3,3];case 2:return J=Q.sent(),this.catchJoinOrStartCallError(J,z,this.logger.createFnLogger("joinOrStartLwj",z)),[3,3];case 3:return[2]}}))}))},PluginlessCall.prototype.joinOrStartWithMedia=function(F,B,G,W,z,J){return $(this,void 0,void 0,(function(){var Q,Y,$,Z,ee,te,ne,ie,re,ae,se,ce,le=this;return X(this,(function(X){switch(X.label){case 0:Q=this.logger.createFnLogger("joinOrStartWithMedia",z),this.callStats.localStats.audio.start(),Y=F.callStartOptions,$=Y&&1&Y.preheatFlags,Z=(0,Se.default)(Q),F.callStartOptions&&F.callStartOptions.sendMediaModalities&&(this.mediaStateConfigurationHelper=new Ee.MediaStateConfigHelper(F.callStartOptions.sendMediaModalities)),this._preferredMpLocation&&(F.callStartOptions=F.callStartOptions||{},ee=F.callStartOptions.clientEndpointDebugContent?JSON.parse(F.callStartOptions.clientEndpointDebugContent):{},F.callStartOptions.clientEndpointDebugContent=JSON.stringify(K({preferredMpLocation:this._preferredMpLocation},ee))),X.label=1;case 1:return X.trys.push([1,22,,23]),!Y||$?[3,3]:this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)&&this.mediaStateConfigurationHelper.isSending(2)?(this.setCallUsesMixer(!0,z),[4,this.getScreenHandle().acquire()]):[3,3];case 2:X.sent(),X.label=3;case 3:return this.mediaStateConfigurationHelper.isSending(0)&&this.setAudioOn(!0,z),this.callUsesMixer||this.mediaStateConfigurationHelper.disableModality(2),Q.info("skipSharingModality=".concat(!this.callUsesMixer)),Z.executeSync(be.CallSetupMediaPhase.InitializeMediaSession,(function(){return le.initializeMediaSession(z)})),this.signalingSession.updateDominantSpeakerHistoryMessageSubscription(this.isInitialSignalingDSHSubscriptionEnabled(),!1),this.mediaSession.getSessionConfig().config.alwaysNegotiateDataChannel&&this.mediaStateConfigurationHelper.enableModality(3),this.mediaSession.createAudioElement(z),this.callUsesMixer||J||this.isOneToOnePSTNCall()||F.callVoicemailStartOptions||(this.isSomeoneStreamingVideo=!0),(te=this._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,"",z,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]})).catch(de.noop),ne=!1,F.isPromotingToRealtime?(this.isSpeakerMuted=!0,ne=!0,[4,Z.execute(be.CallSetupMediaPhase.MuteInput,(function(){return le.mediaSession.muteInputAsync(z)}))]):[3,6];case 4:return X.sent(),[4,Z.execute(be.CallSetupMediaPhase.MuteOutput,(function(){return le.mediaSession.muteOutputAsync(z)}))];case 5:return X.sent(),[3,11];case 6:return Y?$?(ne=!0,[4,Z.execute(be.CallSetupMediaPhase.MuteInput,(function(){return le.mediaSession.muteInputAsync(z)}))]):[3,9]:[3,11];case 7:return X.sent(),[4,Z.execute(be.CallSetupMediaPhase.MuteOutput,(function(){return le.mediaSession.muteOutputAsync(z)}))];case 8:return X.sent(),this.setMuted(be.ParticipantMuteState.Muted,z),this.setCallUsesMixer(!0,z),[3,11];case 9:return this.mediaStateConfigurationHelper.isSending(1)?[4,Z.execute(be.CallSetupMediaPhase.StartVideoSafe,(function(){return le.startVideoSafe(z)}))]:[3,11];case 10:X.sent(),X.label=11;case 11:return(null==Y?void 0:Y.forceAudioSendModalityWithNullStream)&&this.mediaSession.useNullAudioStreamClient(),[4,Z.execute(be.CallSetupMediaPhase.UpdateMediaModalities,(function(){return le.updateMediaModalities(void 0,z)}))];case 12:return ie=X.sent(),[4,Z.execute(be.CallSetupMediaPhase.CreateOffer,(function(){return le.mediaSession.createOfferAsync(z)}))];case 13:return re=X.sent(),ae=Z.executeSync(be.CallSetupSignalingPhase.GetSignalingMediaTypes,(function(){return le.getSignalingMediaTypes(le.calculateModalityDirections({},z))})),this.mediaStateConfigurationHelper.isSending(2)&&this.updateScreenSharingState(ie,z),ne?[3,16]:[4,Z.execute(be.CallSetupMediaPhase.MuteUnmute,(function(){return le.muteUnmute(le._muteState===be.ParticipantMuteState.Muted,z)}))];case 14:return X.sent(),[4,Z.execute(be.CallSetupMediaPhase.MuteUnmuteSpeakers,(function(){return le.muteUnmuteSpeaker(le.isSpeakerMuted,z)}))];case 15:X.sent(),X.label=16;case 16:return Z.executeSync(be.CallSetupSignalingPhase.CallStart,(function(){return B(z,F,re,ae,G,J)})),[4,Z.execute(be.CallSetupSignalingPhase.WaitForConnect,(function(){return W}))];case 17:return X.sent(),this.isCallModeStreaming()&&!F.isPromotingToRealtime?[3,21]:[4,Z.execute(be.CallSetupSignalingPhase.WaitForAnswer,(function(){return te}))];case 18:return se=X.sent(),[4,Z.execute(be.CallSetupMediaPhase.ProcessAnswer,(function(){return le.mediaSession.processAnswerAsync(se,z,!1)}))];case 19:return X.sent(),[4,Z.execute(be.CallSetupMediaPhase.CompleteNegotiation,(function(){return le.completeNegotiationAsync(z)}))];case 20:X.sent(),X.label=21;case 21:return this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,{phases:Z.getTelemetryData()},z),2!==(null==Y?void 0:Y.screenshareDirection)&&4!==(null==Y?void 0:Y.screenshareDirection)||(this.screenSharingControl.initControlForSharer(""),this.enableControlInjector()),[3,23];case 22:return ce=X.sent(),this.catchJoinOrStartCallError(ce,z,Q,Z.getTelemetryData()),[3,23];case 23:return[2]}}))}))},PluginlessCall.prototype.catchJoinOrStartCallError=function(F,B,G,W){var z,K=this,J=0;if(G.logFailure((0,pe.getPrintableObject)(F)),(0,Se.isPhaseError)(be.CallSetupMediaPhase.MuteInput,F))J=7,z={code:be.jsCallEndCodes.LocalError,subCode:be.jsCallEndSubCodes.MediaMuteMicrophoneError,phrase:(0,pe.getPrintableObject)(F),causeId:B};else if((0,Se.isPhaseError)(be.CallSetupMediaPhase.MuteOutput,F))J=7,z={code:be.jsCallEndCodes.LocalError,subCode:be.jsCallEndSubCodes.MediaMuteSpeakerError,phrase:(0,pe.getPrintableObject)(F),causeId:B};else if(F&&(F.type===this.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer||F.type===this.mediaAgent.constants.MEDIA_ERROR.permissionDeniedError||(0,Se.isOneOfPhaseErrors)(be.CallSetupMediaPhase,F))){if(J=47,this.lwjFallbackInProgress)return void G.info("Ignoring media setup error because LWJ fallback is in progress")}else(0,Se.isPhaseError)(be.CallSetupSignalingPhase.WaitForAnswer,F)||(0,Se.isPhaseError)(be.CallSetupSignalingPhase.WaitForConnect,F)?J=F.error:(0,Se.isOneOfPhaseErrors)(be.CallSetupSignalingPhase,F)&&(J=7);throw this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,this.getTelemetryFromPhaseExecution(F),B),this.callSetupFailed=!0,G.logFailure(F),Promise.all([this._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,J,"",B),this._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,J,"",B)]).then((function(){K.isPromotingToRealtime()||K.stopInternal({causeId:B,terminatedReason:J,rejectReason:z})})).catch(de.noop),J},PluginlessCall.prototype.reconnectAsLwj=function(F,B){return $(this,void 0,void 0,(function(){var G,W,z,K,J,Q;return X(this,(function(Y){switch(Y.label){case 0:if((G=this.logger.createFnLogger("reconnectAsLwj",B)).info("Attempting to reconnect as LWJ, terminatedReason = ".concat(F)),6===this.state||7===this.state)return G.info("Not reconnecting as LWJ because call state is ".concat(this.state)),[2];W=Date.now(),this._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS.START_CALL),this._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS.JOIN_CALL),this.callTelemetry.maybeRecordOperationSuccess(oe.CALL_OPERATIONS.START_CALL),this.callTelemetry.maybeRecordOperationSuccess(oe.CALL_OPERATIONS.JOIN_CALL),z=Date.now()-this._mediaSessionCreationTime,this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.LWJ_FALLBACK,{timeToBeginFallback:z},B),this.event("lwjFallbackStarted").raise(),this.lwjFallbackInProgress=!0,K=this.getRejectionInfoFromTerminatedReason(F),this.cleanUpMedia(B,K),Y.label=1;case 1:return Y.trys.push([1,5,,6]),[4,this.signalingSession.endAsync(K,{preventAllCallbacks:!0,causeId:B})];case 2:return Y.sent(),this.signalingSession=null,this.mediaRelayWhiteListingIssue=!1,this.initializeSignalingSession(this._participantId),this.signalingSession.setGroupId(this.groupId),this.signalingSession.setThreadId(this.threadId),this.signalingSession.setCallOptions(this.signalingSessionCallOptions),[4,this.signalingSession.ensureMessageChannelReady(B)];case 3:return Y.sent(),J={suppressDialout:!0,onBehalfOf:this.onBehalfOfMri,isLwj:!0},this.setCallOptions({callStartTime:W,callStartOptions:{}}),this.setInitialTelemetry(oe.CALL_OPERATIONS.START_CALL,this.callOptions,"",B),[4,this.signalingSession.startOutgoingCall(null,null,J,null,B)];case 4:return Y.sent(),[3,6];case 5:return Q=Y.sent(),G.logFailure(Q),this.stopInternal({causeId:B}),[3,6];case 6:return[2]}}))}))},PluginlessCall.prototype.addCallMeBackParticipant=function(F,B,G){var W=this,z=this._participantOperationHandler.waitForOperation(oe.PARTICIPANT_OPERATIONS.CALL_ME_BACK,F),J=this.logger.createFnLogger(oe.PARTICIPANT_OPERATIONS.CALL_ME_BACK,G),Q={id:F,assertedId:B};return this.signalingSession.callMeBackAsync(Q).then((function(){J.logSuccess("successfully executed call me back, participantId = ".concat(_e.scrubMriOrOmit(F))),W._participantOperationHandler.resolveOperation(oe.PARTICIPANT_OPERATIONS.CALL_ME_BACK,0,F)})).catch((function(z){J.logFailure("Call me back failed, participantId = ".concat(_e.scrubMriOrOmit(F),", error = ").concat(z)),W._handleParticipantOperationFailure(oe.PARTICIPANT_OPERATIONS.CALL_ME_BACK,z,G,B,!1);var Q=W._processError(z),Y={};Q&&(Y=K({},Q)),Y.failureReason=Q.reason?Q.reason:11,W._participantOperationHandler.rejectOperation(oe.PARTICIPANT_OPERATIONS.CALL_ME_BACK,Y,F)})),z},PluginlessCall.prototype.addParticipantsToCall=function(F,B,G,W,z,K,J,Q){var Y=this,Z=this.logger.createFnLogger("addParticipantsToCall",B);F.forEach((function(F){F.setState(1,void 0,B)}));var te=F.map((function(F){return{id:F.mri}}));Z.info("participantIds=".concat(F.map((function(F){return _e.scrubMriOrOmit(F.id)})),", disableUnmute=").concat(J));var ie={additionalData:G,groupId:W,threadId:z,messageId:K,disableUnmute:J,alternateId:Q};try{var re=this.signalingSession.addParticipantsAsync(te,ie,B);return ne.zip(re,te).map((function(F){var G=ee(F,2),W=G[0],z=G[1];return $(Y,void 0,void 0,(function(){var F,G,K,J,Q,Y;return X(this,(function($){switch($.label){case 0:return $.trys.push([0,2,,3]),[4,W];case 1:return F=$.sent(),this.signalingNotifications.onParticipantJoined(F,B),G=this._getParticipantLegId(this.getParticipant(z.id)),K=G?{participantLegId:G}:{},this.callTelemetry.recordOperationSuccess(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""},F.id,B,K),[3,3];case 2:throw J=$.sent(),Q=this._handleParticipantOperationFailure(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,J,B,z.id),Y=Q.reason,this._removeParticipant(z,B,Y),Y;case 3:return[2]}}))}))}))}catch(F){return Z.logFailure("Participants was not added to call, error=".concat(F)),ne.range(te.length).map((function(){return Promise.reject(1)}))}},PluginlessCall.prototype.mergeCallByAddParticipantWithReplaces=function(F,B,G,W,z,K,J,Q){return $(this,void 0,void 0,(function(){var Y,$,Z,ee,te,ne,ie,re,ae,se,ce;return X(this,(function(X){switch(X.label){case 0:return Y=this.logger.createFnLogger("mergeCallByAddParticipantWithReplaces",K),$=this.convertClientScenario(Q),Z={additionalData:F.additionalData,groupId:F.groupId,threadId:F.threadId,messageId:F.messageId,callIdToReplace:G.callId,replacementType:W,clientScenario:$},[4,this.signalingSession.addParticipantsAsync(B,Z,K)];case 1:ee=X.sent(),te=0,X.label=2;case 2:if(!(te<ee.length))return[3,7];ne=3===W?B[te].participantId:B[te].id,X.label=3;case 3:return X.trys.push([3,5,,6]),[4,ee[te]];case 4:return X.sent(),Y.logSuccess(" [participantInfos id =".concat(_e.scrubMriOrOmit(B[te].id),"]")),ie={debugContent:{replacementParticipantLegId:B[te].replacementParticipantId||void 0,clientScenario:$},participantLegId:B[te].participantId},ce={code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""},this.callTelemetry.recordOperationSuccess(z,ce,ne,K,ie),this._callOperationHandler.maybeResolveOperation(z,ce,ne,K),[3,6];case 5:return re=X.sent(),Y.logFailure("Participant was not added to call, error=".concat((0,pe.safeJsonStringify)(re))),ae=this._handleParticipantOperationFailure(z,re,K,ne,!0,$),se=ae.reason,this._removeParticipant(B[te],K,se),ce=re?re.endCode:se||0,this._callOperationHandler.maybeRejectOperation(z,ce,ne,K),[3,6];case 6:return te++,[3,2];case 7:return[2,Promise.resolve(J)]}}))}))},PluginlessCall.prototype.admitParticipantToCall=function(F,B,G){var W=this,z=this.logger.createFnLogger("admitParticipantToCall",B),K={id:F};return z.info("start"),this.signalingSession.admitParticipantAsync(K,B).then((function(K){z.info("successfully admitted participant to call, participantId = ".concat(_e.scrubMriOrOmit(F)));var J=G?{participantLegId:G}:{},Q={code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:""};W.callTelemetry.recordOperationSuccess(oe.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,Q,F,B,J)})).catch((function(G){z.logFailure("Participant was not admitted to call, error=".concat(G));var K=W._handleParticipantOperationFailure(oe.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,G,B,F);return Promise.reject(K)}))},PluginlessCall.prototype._processError=function(F){var B,G={reason:B};if(F&&F.endCode){var W=Ee.getTerminationCode(F.endCode.code,F.endCode.subCode);B=PluginlessCall.getParticipantReasonFromTerminatedReason(W),G.reason=B,G.code=F.endCode.code,G.subCode=F.endCode.subCode,G.resultCategories=F.endCode.resultCategories,G.phrase=F.endCode.phrase}else G.phrase="".concat(F);return this.logger.info("_processError error=".concat(F," telemetryData=").concat(JSON.stringify(G))),G},PluginlessCall.prototype._handleParticipantOperationFailure=function(F,B,G,W,z,K){void 0===z&&(z=!0),this.callTelemetry.updateOperationData(F,{error:(0,pe.getPIISafeObject)(B)},G,W);var J=this._processError(B),Q=this.getParticipant(W);J.code&&Q&&(Q.callEndDiagnosticsInfo={callControllerCode:J.code,callControllerSubCode:J.subCode,phrase:J.phrase,resultCategories:J.resultCategories});try{if(z){var Y={debugContent:{clientScenario:K},participantLegId:this._getParticipantLegId(Q)||void 0};this.callTelemetry.recordOperationFailure(F,J,W,G,Y)}}catch(F){this.logger.info("_handleParticipantOperationFailure errow during recordOperationFailure ".concat(F))}return J},PluginlessCall.prototype._getParticipantLegId=function(F){return ne.has(F,"endpoints.endpointDetails")&&F.endpoints.endpointDetails.length&&F.endpoints.endpointDetails[0].participantId?F.endpoints.endpointDetails[0].participantId:null},PluginlessCall.prototype.isOneToOnePSTNCall=function(){var F=this.signalingSession.isIncomingCall?this.callerMri:this.participants.length>0?this.participants[0].id:"";return this.isOneToOneCall()&&ne.startsWith(F,ge.PSTN_MRI_PREFIX)&&(!this.incomingCallType||!this.callUsesMixer)},PluginlessCall.prototype.isParkedCall=function(){var F;return this.isOneToOnePSTNCall()&&!!(null===(F=this.callOptions)||void 0===F?void 0:F.parkContext)},PluginlessCall.prototype.updateMediaModalities=function(F,B){return void 0===F&&(F={}),void 0===B&&(B=(0,se.generateCauseId)()),$(this,void 0,void 0,(function(){var G,W;return X(this,(function(z){switch(z.label){case 0:return(W=this.logger.createFnLogger("updateMediaModalities",B)).info("callUsesMixer=".concat(this.callUsesMixer,",isSomeoneSharing=").concat(this.isSomeoneSharing,",isSomeoneStreamingVideo=").concat(this.isSomeoneStreamingVideo)),W.info("options=".concat((0,pe.safeJsonStringify)(F),",requestHoldState=").concat(this.requestedHoldState,",requestedScreenSharingState=").concat(this.mediaStateConfigurationHelper.isSending(2))),G=F.modalityOverride?F.modalityOverride:this.requestedHoldState&&!this.isMuteOnHold?this.getMediaModalitiesForHold(B):this.calculateModalityDirections(F&&F.offered,B),W.info("modalities=".concat((0,pe.safeJsonStringify)(G))),[4,this.mediaSession.configureModalitiesAsync(G,B)];case 1:return z.sent(),[2,G]}}))}))},PluginlessCall.prototype.calculateModalityDirections=function(F,B){void 0===F&&(F={});var G=this.logger.createFnLogger("calculateModalityDirections",B);G.info("callUsesMixer=".concat(this.callUsesMixer));var W={audio:this.calculateAudioDirection(F.audio,G),video:this.calculateVideoDirection(F.video,G),sharing:this.calculateSharingDirection(F.sharing,G),data:this.calculateDataDirection(F.data,G)};return G.info("done, modalities=".concat((0,pe.safeJsonStringify)(W))),this.deleteExtraneousModalities(W,B),W},PluginlessCall.prototype.calculateAudioDirection=function(F,B){return B.info("calculateAudioDirection, offer=".concat(F,", requestedAudioState=").concat(this.mediaStateConfigurationHelper.isSending(0))),this.receiveOnlyAudioOnCallStart?(B.info("calculateAudioDirection, direction=recvonly, receiveOnlyAudioOnCallStart=true"),"recvonly"):this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)||"inactive"===F?"inactive":this.mediaSession.getAllowedModalities().audio.some((function(F){return F===ke.streamDirections.send||F===ke.streamDirections.sendReceive}))?"sendrecv":"recvonly"},PluginlessCall.prototype.calculateVideoDirection=function(F,B){var G=this.mediaStateConfigurationHelper.isSending(1);if(B.info("calculateVideoDirection, offer=".concat(F,", requestedVideoState=").concat(G,", isSomeoneStreamingVideo=").concat(this.isSomeoneStreamingVideo)),this.mediaStateConfigurationHelper.isInactiveOrDisabled(0))return"inactive";var W=G,z=this.isSomeoneStreamingVideo||this.callUsesMixer;return F&&(W=W&&("sendrecv"===F||"sendonly"===F),z=z&&("sendrecv"===F||"recvonly"===F)),W?"sendrecv":z?"recvonly":"inactive"},PluginlessCall.prototype.calculateSharingDirection=function(F,B){return B.info("calculateSharingDirection, offer=".concat(F,", requestedScreenSharingState=").concat(this.mediaStateConfigurationHelper.isSending(2),", isSomeoneSharing=").concat(this.isSomeoneSharing)),"inactive"===F?"inactive":this.mediaStateConfigurationHelper.isSending(2)?"sendonly":this.isSomeoneSharing||this.callUsesMixer?"recvonly":void 0},PluginlessCall.prototype.calculateDataDirection=function(F,B){var G=this.mediaStateConfigurationHelper.isSending(3),W=this.mediaStateConfigurationHelper.isDisabled(3);if(B.info("calculateDataDirection, offer=".concat(F,", dataEnabled=").concat(G,", disabled=").concat(W)),this.allowDataChannel())return W||!G?void 0:"inactive"===F?"inactive":"sendrecv";B.info("calculateDataDirection, disabling data since ECS flag prohibits it")},PluginlessCall.prototype.getMediaModalitiesForHold=function(F){this.logger.info("[".concat(F,"][getMediaModalitiesForHold]"));var B="inactive",G={audio:B,video:B,data:this.allowDataChannel()?B:void 0,sharing:B};return this.deleteExtraneousModalities(G,F),G},PluginlessCall.prototype.deleteExtraneousModalities=function(F,B){!(0,Fe.hasSendDirectionality)(F.video)&&this.mediaStateConfigurationHelper.isDisabled(1)&&(this.logger.info("[".concat(B,"][deleteExtraneousModalities] skipping videoModality")),delete F.video),!(0,Fe.hasSendDirectionality)(F.sharing)&&this.mediaStateConfigurationHelper.isDisabled(2)&&(this.logger.info("[".concat(B,"][deleteExtraneousModalities] skipping sharingModality")),delete F.sharing)},PluginlessCall.prototype.getSignalingMediaTypes=function(F){var B=this,isSendActive=function(F){return F===B.mediaAgent.constants.MEDIA_STATE.send||F===B.mediaAgent.constants.MEDIA_STATE.sendReceive},G=[];return F.audio&&F.audio!==this.mediaAgent.constants.MEDIA_STATE.inactive&&G.push("Audio"),isSendActive(F.video)&&G.push("Video"),F.sharing===this.mediaAgent.constants.MEDIA_STATE.send?G.push("ScreenSharer"):F.sharing===this.mediaAgent.constants.MEDIA_STATE.receive&&G.push("ScreenViewer"),G},PluginlessCall.prototype.enableControlInjector=function(){var F,B;if(this.allowScreenSharingControl())if(this.getlocalScreenShareStream()){var G=null!==(B=null===(F=this.mediaSession)||void 0===F?void 0:F.getLocalMediaTrackId("ScreenShare"))&&void 0!==B?B:"";this.screenSharingControl.enableControlInjector(G)}else this.logger.warn("enableControlInjector: no local screenshare stream found")},PluginlessCall.prototype.initializeSignalingSession=function(F){var B=this;if(this.signalingSession)this.logger.info("Session already exists!");else{var G=ie.CA_CONSTANTS.CALL_STATUS;if(this.localSignalingParticipant={id:(0,ge.generateAliasedMri)("".concat(ge.MRI_SKYPE_PREFIX).concat(this.currentUserSkypeIdentity.id),this.currentUserSkypeIdentity.sipUri),displayName:this.currentUserSkypeIdentity.displayName,endpointDetails:[],languageId:null,participantId:F,endpointId:null},this.accountConfiguration&&(this.localSignalingParticipant.applicationType=this.accountConfiguration.applicationType,this.callTelemetry.setApplicationType(this.accountConfiguration.applicationType),this.localSignalingParticipant.ring=this.accountConfiguration.ring,this.callTelemetry.setRing(this.accountConfiguration.ring),this.localSignalingParticipant.region=this.accountConfiguration.region,this.callTelemetry.setRegion(this.accountConfiguration.region),this.localSignalingParticipant.userHexCID=this.accountConfiguration.userHexCID,this.callTelemetry.setUserHexCID(this.accountConfiguration.userHexCID),this.localSignalingParticipant.partition=this.accountConfiguration.partition,this.callTelemetry.setPartition(this.accountConfiguration.partition),this.localSignalingParticipant.acsResourceId=this.accountConfiguration.acsResourceId,this.callTelemetry.setAcsResourceId(this.accountConfiguration.acsResourceId),this.callStats.setAcsResourceId(this.accountConfiguration.acsResourceId),this.accountConfiguration.serviceUrls)){var W=this.accountConfiguration.serviceUrls.calling_conversationServiceUrl,z=this.accountConfiguration.serviceUrls.calling_uploadLogRequestUrl;this.signalingAgent.updateUrls(W,z,this.accountConfiguration.enforceUrls)}this.callStats.localStats.setLocalUserId(this.localSignalingParticipant.id),this._callOperationHandler&&this._callOperationHandler.resetOperationChain(),this.signalingNotifications={onPromotionCompleted:function(F,G,W){if(B.logger.info("[".concat(W,"][onPromotionCompleted] isFailed=").concat(F," reason=").concat((0,pe.safeJsonStringify)(G))),F){var z=Ee.convertReason(G);B._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,z,"",W),B._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,z,"",W),B._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,z,"",W)}else B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,W),B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,W)},onCallStatusChanged:function(F,W,z){void 0===z&&(z=(0,se.generateCauseId)());var J=B.logger.createFnLogger("onCallStatusChanged",z),Q="[status=".concat(F,"]");if(W&&(Q+="[reason=".concat((0,pe.safeJsonStringify)(W),"]"),void 0!==W.code&&(B.callEndDiagnosticsInfo={callControllerCode:W.code,callControllerSubCode:W.subCode,phrase:W.phrase,resultCategories:W.resultCategories},(W.overflowJoinInformation||W.registrationInformation)&&(B.callEndDiagnosticsInfo.additionalDiagnostics={overflowInformation:W.overflowJoinInformation,registrationInformation:W.registrationInformation}))),J.info(Q),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SIGNALING_STATE_CHANGED,{status:F,reason:W},z),F===G.CONNECTING)B._transferredCallAcceptanceCallback&&(J.info("[Transfer] Invoke call acceptance callback for original call"),B._transferredCallAcceptanceCallback()),B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,z);else if(F===G.RINGING)2===B.audioStreamState?(B.setCallState(9,z),B.participants.forEach((function(F){return F.setState(6,void 0,z)}))):B.participants.forEach((function(F){return F.setState(2,void 0,z)})),B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,z);else if(F===G.CONNECTED_FOR_ROSTER_ONLY)B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,z),B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,void 0,void 0,z);else if(F===G.CONNECTED){B._callIsSetupComplete=!0;var Y=B.getLocalSignalingEndpointDetails();((null==Y?void 0:Y.isLobby)||(null==Y?void 0:Y.streamLobby))&&(B._callInLobby=!0,B.updateCapabilities(z,!0));var $=B._enableStaging&&B.signalingSession.participantManager.localParticipant.isStaging;if(11===B.state)B.setCallState(12,z);else if(B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL))J.info("wait for joinPreheatedCall to resolved");else if(B._callInLobby)J.info("[inLobby] Override Connected state from signaling agent"),B.setCallState(10,z);else if($)B.setCallState(13,z);else{if(3===B.state)return;B.setCallState(3,z),B.handleRemoteParticipantStateInOneToOneCall(z)}B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,z),B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,z),B.reportTsCallingTelemetry(!0)}else if(F===G.LOCAL_TERMINATED||F===G.REMOTE_TERMINATED){var X=B.callSetupFailed?7:Ee.convertReason(W);if(8===B.state&&B._callOperationHandler.hasAtleastOneOfPendingOperation([oe.CALL_OPERATIONS.START_CALL,oe.CALL_OPERATIONS.JOIN_CALL,oe.CALL_OPERATIONS.START_WITH_MEETING_DATA,oe.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA]))return B.signalingSession.resetState(),B._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS.SUBSCRIBE,X,void 0,z),B._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,X,void 0,z),void J.info("Subscribe failed, there is pending start/join operation, ignore call end message");if((2===B.state||6===B.state||8===B.state)&&B._callOperationHandler.hasAtleastOneOfPendingOperation([oe.CALL_OPERATIONS.START_CALL,oe.CALL_OPERATIONS.JOIN_CALL,oe.CALL_OPERATIONS.START_WITH_MEETING_DATA,oe.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,oe.CALL_OPERATIONS.SUBSCRIBE,oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA])){var Z={code:B.callEndDiagnosticsInfo.callControllerCode,subCode:B.callEndDiagnosticsInfo.callControllerSubCode,phrase:B.callEndDiagnosticsInfo.phrase,reason:X};B._callOperationHandler.maybeRejectOperations([oe.CALL_OPERATIONS.ACCEPT,oe.CALL_OPERATIONS.JOIN_CALL,oe.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL,oe.CALL_OPERATIONS.START_CALL,oe.CALL_OPERATIONS.START_CALL_AND_UNPARK,oe.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,oe.CALL_OPERATIONS.START_CALL_WITH_NUDGE,oe.CALL_OPERATIONS.START_WITH_MEETING_DATA,oe.CALL_OPERATIONS.SUBSCRIBE,oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],X,void 0,z,Z)}if(B.signalingSession.acceptedElsewhereBy&&(B.acceptedElsewhereBy={id:B.signalingSession.acceptedElsewhereBy.id,displayName:B.signalingSession.acceptedElsewhereBy.displayName}),1!==X&&(B.mediaRelayWhiteListingIssue&&(X=53),J.info("[terminated][reason=".concat((0,pe.safeJsonStringify)(W),"]"))),B.lwjFallbackInProgress&&B.callTelemetry.recordOperationFailure(oe.CALL_OPERATIONS.LWJ_FALLBACK,X),B._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,X,"",z),B._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,X,"",z),B.setCallState(7,z,X),B.participants.forEach((function(F){return F.setState(4,void 0,z)})),!B.disconnectingPromise){var ee=K(K({},W),{remoteTerminated:F===G.REMOTE_TERMINATED});B.disconnectingPromise=B.cleanUp(z,ee).catch((function(F){J.logFailure("Error when cleaning up the call, callId = ".concat(B.callId,", error = ").concat(F))}))}}},onOffer:function(F,G){void 0===G&&(G=(0,se.generateCauseId)());var W=B.logger.createFnLogger("onOffer",G);W.info("".concat((0,pe.safeJsonStringify)(ne.omit(F,"mediaContent","remoteParticipantId")))),B.setMediaLegId(F.mediaContent.mediaLegId),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.WEB_ON_OFFER,B.prepareTelemetryForOfferAnswer(F),G),F.transferor&&F.transferor.details&&F.transferor.details.id&&B.setTransferorMri(F.transferor.details.id),F.transferor&&F.transferor.transferorType&&(B.transferorType=F.transferor.transferorType),F.transferor&&F.transferor.details&&F.transferor.details.displayName&&(B.transferorDisplayName=F.transferor.details.displayName),B.clientTransferContext=F.clientTransferContext,B.invitationData=F.invitationData,B.spamRiskLevel=F.riskLevel,B.spamStirAttestation=F.stirAttestation,F.mediaContent.isTwoPartyToMultiPartyEscalation&&B.setIsEscalationInProgress(!0,G),F.renegotiation?B.requestedHoldState&&B._pendingParkPromise?B.renegotiateIncoming(F.mediaContent,G):B._callOperationHandler.executeChained((function(){return B.renegotiateIncoming(F.mediaContent,G)}),oe.CALL_OPERATIONS_INTERNAL.RENEGOTIATE_INCOMING,G,G,void 0,void 0,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}):(W.info("resolving attach / offer promise"),B.attachToCallAndGetOffer.resolve(F.mediaContent))},onNewOffer:function(F,G){void 0===G&&(G=(0,se.generateCauseId)());var W=B.logger.createFnLogger("onNewOffer",G);B.newOfferRequestDeferred?(W.info("onNewOffer"),B.newOfferRequestDeferred.resolve(F.mediaContent)):W.info("callback received but new offer was not requested")},onAnswer:function(F,G){void 0===G&&(G=(0,se.generateCauseId)());var W=B.logger.createFnLogger("onAnswer",G);W.info("".concat((0,pe.safeJsonStringify)(ne.omit(F,"mediaContent","remoteParticipantId")))),B.setMediaLegId(F.mediaContent.mediaLegId),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.WEB_ON_ANSWER,B.prepareTelemetryForOfferAnswer(F),G),F.renegotiation?(W.info("resolving previous renegotiation promise"),B.renegotiationAnswerDeferred.resolve(F.mediaContent)):(W.info("resolving final answer promise"),F.provisional?B.mediaSession.processAnswerAsync(F.mediaContent,G,!0,F.remoteEndpointId):(B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,F.mediaContent,void 0,G),B.handleRemoteParticipantStateInOneToOneCall(G))),F.provisional||!F.mediaContent.fromMixer||B.callUsesMixer||B._callOperationHandler.executeChained((function(){return B.setCallUsesMixer(!0,G),B.mediaSession.reconnectAsync(G,!0)}),oe.CALL_OPERATIONS_INTERNAL.CALL_ESCALATED_TO_CONFERENCE,G,G,void 0,void 0,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]})},onMediaAcknowledgementSuccess:function(F,G){void 0===G&&(G=(0,se.generateCauseId)()),B.logger.info("isRenegotiation: ".concat(F),"onMediaAcknowledgementSuccess",G),B._callOperationHandler.resolveOperation(oe.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,void 0,void 0,G)},onMediaAcknowledgementFailure:function(F,G,W){void 0===W&&(W=(0,se.generateCauseId)()),B.logger.createFnLogger("onMediaAcknowledgementFailure",W).logFailure((0,pe.safeJsonStringify)(G)),B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,G,W)},onMediaRenegotiationRejection:function(F,G){void 0===G&&(G=(0,se.generateCauseId)()),B.logger.createFnLogger("onMediaRenegotiationRejection",G).logFailure((0,pe.safeJsonStringify)(F)),B.renegotiationAnswerDeferred.reject(F)},onRosterHandlingComplete:function(){B.logger.info("[onRosterHandlingComplete] ".concat(B._publishedStatesModified)),B._publishedStatesModified!==Ve.None&&(B.processPublishedStates(),B._publishedStatesModified=Ve.None)},onMeetingGroupDetailsUpdated:function(F,G){void 0===G&&(G=(0,se.generateCauseId)()),B.meetingGroupDetails!==F&&(B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.UPDATE_MEETING_GROUPS_DETAILS,F,G),B.logger.info("[".concat(G,"][onMeetingGroupDetailsUpdated] update meetingGroupDetails from ").concat(JSON.stringify(B.meetingGroupDetails)," to ").concat(JSON.stringify(F))),B.meetingGroupDetails=F,B.raiseChanged())},onSelfParticipantUpdated:function(F,G){void 0===G&&(G=(0,se.generateCauseId)()),B.logger.info("[".concat(G,"][onSelfParticipantUpdated]")),B.updateLocalParticipant(F,G),B.canPromoteToRealTime(1)&&B.promoteToRealtime(1,G).catch(de.noop),B.raiseChanged()},onParticipantMriUpdated:function(F,G,W){void 0===W&&(W=(0,se.generateCauseId)()),B.logger.info("[".concat(W,"][onParticipantMriUpdated]"));var z=B.getParticipant(F);z&&(z.id=G,B.raiseChangedDeferred())},onParticipantUpdated:function(F,G){void 0===G&&(G=(0,se.generateCauseId)()),B.logger.info("[".concat(G,"][onParticipantUpdated]: ").concat(Pe.scrubSignalingParticipant(F)));var W=B.getOrCreateParticipant(F.id,G);W.displayName=F.displayName;var z=PluginlessCall.getStreamsFromEndpoints(F.endpointDetails),K=ne.some(F.endpointDetails,(function(F){return null==F?void 0:F.streamInformation}));B.callUsesMixer||z.length>0||K?(B.updateParticipantStreams(W,F,z,G),B.updateCallParticipantFromSignalingParticipant(W,F,G)):W.setState(3,void 0,G),W.processParticipantDetails(F,B.getSelfClientEndpointCapabilities()),B.updatePublishedStates(F),B._enableRemoveRosterNegotiations?B.calculateIsSomeoneStreaming(G):B.updateMediaStatus(G),B.raiseChangedDeferred()},onParticipantRemoved:function(F,G,W){if(void 0===G&&(G=(0,se.generateCauseId)()),void 0===W&&(W=!1),B.logger.info("[".concat(G,"][onParticipantRemoved]")),W&&B._enableAddParticipantPromiseOptimization){var z=B.getOrCreateParticipant(F.id,G);B.callTelemetry.recordOperationSuccess(oe.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,null,z.id,G,{participantJoinedButReplaced:"Participant joined with original MRI and replaced with participant of RNL MRI"})}else B.callTelemetry.recordOperationSuccess(oe.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,null,F.id,G),B._participantOperationHandler.maybeRejectOperation(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,1,F.id,G);B._removeParticipant(F,G),B.removePublishedStatesByParticipant(F.id),B._enableRemoveRosterNegotiations?B.calculateIsSomeoneStreaming(G):B.updateMediaStatus(G)},onParticipantJoined:function(F,G){void 0===G&&(G=(0,se.generateCauseId)()),B.logger.info("[".concat(G,"][onParticipantJoined]"));var W=B.getOrCreateParticipant(F.id,G);W.displayName=F.displayName,0===W.state&&W.setState(1,void 0,G);var z=PluginlessCall.filterVirtualEndpoints(F.endpointDetails),K=z&&[z[0]],J=PluginlessCall.getStreamsFromEndpoints(K),Q=ne.some(F.endpointDetails,(function(F){return null==F?void 0:F.streamInformation}));B.callUsesMixer||J.length>0||Q?(B.updateParticipantStreams(W,F,J,G),B.updateCallParticipantFromSignalingParticipant(W,F,G),B._enableRemoveRosterNegotiations?B.calculateIsSomeoneStreaming(G):B.updateMediaStatus(G)):(B.handleRemoteParticipantJoinedInOneToOneCall(F,G),B.handleRemoteParticipantStateInObservingCall(W,F,G),F.acceptedBy&&F.acceptedBy!==F.id&&(W.acceptedBy=F.acceptedBy)),B.callTelemetry.recordOperationSuccess(oe.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,(0,ae.getEndpointInformationForTelemetry)(F.endpointDetails),W.id,G),W.processParticipantDetails(F,B.getSelfClientEndpointCapabilities()),B.updatePublishedStates(F),B.raiseChangedDeferred()},onCallModeChanged:function(F,G){B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.CALL_MODE_CHANGED,{newCallMode:F,oldCallMode:B._callMode},G),B.logger.info("onCallModeChanged[".concat(G,"]: new=").concat(F," old=").concat(B._callMode," ")),F&&B._callMode!==F&&(B._callMode=F,B.isCallModeStreaming()&&B.cleanUpDueToStreaming(G),B.updateCapabilities(G),B.raiseChanged())},getRemoteParticipantCollection:function(){return B.participants.map((function(F){return F.toCafeParticipant()}))},onReTargetCompletedSuccess:function(F){var G=B.logger.createFnLogger("onReTargetCompletedSuccess",F);G.info("started, isEscalationInProgress=".concat(B.isEscalationInProgress)),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.WEB_ON_RETARGET_SUCCESS,void 0,F),B.callStats.localStats.call.event(Te.CallEvent.MediaRetargetSucceeded);var W=B.isEscalationInProgress;B.screenSharingControl&&B.screenSharingControl.shutdownControlForViewer(),B.signalingSession.updateDominantSpeakerHistoryMessageSubscription(B.isInitialSignalingDSHSubscriptionEnabled(),!0),B.mediaSession.completeEscalationAsync(F).then((function(){G.logSuccess("completeEscalationAsync"),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.WEB_ON_ESCALATION_SUCCESS,void 0,F),B.handleCallEscalation(W,F)})).catch((function(W){G.logFailure("completeEscalationAsync, error=".concat((0,pe.getPrintableObject)(W))),B.setIsEscalationInProgress(!1,F),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.WEB_ON_ESCALATION_FAILURE,(0,pe.getPIISafeObject)(W),F),B.stopInternal({causeId:F,terminatedReason:47})}))},onReTargetCompletedFailure:function(F,G){B.logger.createFnLogger("onReTargetCompletedFailure",G).logFailure("reason=".concat((0,pe.getPrintableObject)(F),", isEscalationInProgress=").concat(B.isEscalationInProgress)),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.WEB_ON_RETARGET_FAILURE,(0,pe.getPIISafeObject)(F),G),B.isEscalationInProgress&&(B.setIsEscalationInProgress(!1,G),B.setCallUsesMixer(!1,G)),B.callStats.localStats.call.event(Te.CallEvent.MediaRetargetFailed),B.mediaSession.rejectEscalationAsync(F,G)},onChatModalitySetupFailed:function(F){B.logger.debug("onChatModalitySetupFailed: ".concat(F))},onConversationUpdated:function(F,G){B.logger.info("onConversationUpdated[".concat(G,"]: ").concat((0,pe.safeJsonStringify)(F))),B.setConversationType(F.conversationType,G),B.setMessageId(F.teamsMessageId,G),B.setGroupId(F.groupId,G),B.setThreadId(F.threadId,G),B.setCallType(F.isMultiParty?2:1,G),B._commandUrlPresence=F.commandUrlPresence,B.updateCapabilities(G),B.region=F.region,B.setMeetingData(F.meetingData),B.meetingInfo=F.meetingInfo,B.callLimits=F.callLimits,B.raiseChanged()},onMeetingDetailsUpdated:function(F){B.meetingDetails=F,!B.enableRealtimeTelemetry&&B.meetingDetails.capabilities&&B.meetingDetails.capabilities.enableRealtimeTelemetry&&(B.mediaSession.enableRealTimeTelemetry(),B.enableRealtimeTelemetry=!0),B.raiseChanged()},onParticipantCountsUpdated:function(F){ne.isEqual(F,B.participantCounts)||(B.participantCounts=K(K({},oe.EMPTY_COUNTS),F),B.event("participantCountsUpdated").raise(B.participantCounts))},updateIsSharedLineAppearanceV2Activated:function(F){B.isSharedLineAppearanceV2Activated!==F&&(B.logger.info("_updateIsSharedLineAppearanceV2Activated: new value is ".concat(F)),B.isSharedLineAppearanceV2Activated=F,B.event("sharedLineAppearanceV2ActivatedChanged").raise(B.isSharedLineAppearanceV2Activated))},onBroadcastMeetingUpdated:function(F){F&&(B.broadcastMeeting&&B.broadcastMeeting.metadataChanged(JSON.stringify(F)),B.broadcastMetadata=F,B.raiseChanged())},onBroadcastMeetingConnected:function(F,G){B.logger.info("[".concat(G,"][onBroadcastMeetingConnected]")),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)&&(F.code===oe.TRANSACTION_END_CODE.SUCCESS?B._callOperationHandler.resolveOperation(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,F,G):B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,F,G))},onBroadcastMeetingEnded:function(F,G){B.logger.info("[".concat(G,"][onBroadcastMeetingEnded]")),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)&&B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,F,G),B.signalingSession.endBroadcastMeeting(G)},onTransferRequested:function(F,G){var W=B.logger.createFnLogger("onTransferRequested",G);W.info("Transfer: onTransferRequested, target participant",Pe.scrubSignalingParticipant(F.target));var z="",K="",J=0;"voicemail"===F.target.endpointType&&(J=2);try{z=F.target.id,K=F.transferor.details.id,F&&F.parkType&&"none"!==F.parkType&&(J=1)}catch(F){return W.logFailure(F),B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.ON_TRANSFER_REQUESTED_INVALID),void B.signalingSession.signalTransferCompletedAsync({code:Ee.getCSAEndCode(7)})}var Q=B.convertToTransferType(J,F.parkType),Y={transferContext:{transferorMri:K,targetMri:z,transferType:J,context:{target:F.target,transferor:F.transferor,transferContext:F.transferContext,newCallModalities:F.newCallModalities,links:F.links,replacementDetails:F.replacementDetails,isConsultative:F.isConsultative,callAcceptanceCallback:function(){W.logSuccess("Transfer: callAcceptanceCallback called"),B.signalingSession.signalTransferAcceptedAsync(Q)}}},onCompleted:function(F){W.logSuccess("Transfer: onCompleted called"),B.signalingSession.signalTransferCompletedAsync({code:Ee.getCSAEndCode(F)})}};B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.ON_TRANSFER_REQUESTED,{transferType:J}),B.event("transferRequested").raise(Y)},onTransferAccepted:function(F){B.logger.info("Transfer: onTransferAccepted"),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&B._setTransferState(2),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.BLIND_TRANSFER)&&B._callOperationHandler.maybeResolveOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,void 0,F),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.PARK_CALL)&&B._setParkState(2)},onTransferCompleted:function(F,G){var W=B.logger.createFnLogger("onTransferCompleted",G);W.info("Transfer: onTransferCompleted");var z=F.transferCompletion,K=Ee.convertReason(z);if(z&&(W.info("Transfer: Call Transfer Code: ".concat(z.code)),0===z.code)){if(B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(B._callOperationHandler.resolveOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,void 0,G),B._setTransferState(3)),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)){var J={code:oe.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:oe.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE};B._callOperationHandler.resolveOperation(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,J,void 0,G),B._setTransferState(3)}B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.PARK_CALL)&&(F.unparkContent&&F.unparkContent.CallParkAdditionalContext&&F.unparkContent.CallParkAdditionalContext.ConversationControllerLocation&&(B.serverHoldLocation=F.unparkContent.CallParkAdditionalContext.ConversationControllerLocation),F.unparkContent&&void 0!==F.unparkContent.pickupCode?(B._callOperationHandler.resolveOperation(oe.CALL_OPERATIONS.PARK_CALL,F.unparkContent.pickupCode,void 0,G),W.logSuccess("pickupCode=".concat(F.unparkContent.pickupCode)),B._setParkState(3)):(B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS.PARK_CALL,32,G),W.logFailure("terminatedReason=".concat(K)),B._setParkState(4)))}else{if(B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,K,void 0,G),W.logFailure("terminatedReason=".concat(K)),B.transferDiagnosticsInfo={callControllerCode:z.code,callControllerSubCode:z.subCode,phrase:z.phrase,resultCategories:z.resultCategories},B._setTransferState(4)),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)){var Q={code:z.code,subCode:z.subCode,resultCategories:z.resultCategories};B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,Q,void 0,G)}B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.PARK_CALL)&&(B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS.PARK_CALL,K,void 0,G),W.logFailure("terminatedReason=".concat(K)),B.transferDiagnosticsInfo={callControllerCode:z.code,callControllerSubCode:z.subCode,phrase:z.phrase,resultCategories:z.resultCategories},B._setParkState(4))}},onParkCompleted:function(F,G){B.logger.createFnLogger("onParkCompleted",G).info("transactionEnd ".concat((0,pe.getPrintableObject)(F))),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.PARK_CALL)&&(0===F.code?(B._callOperationHandler.resolveOperation(oe.CALL_OPERATIONS.PARK_CALL,"",void 0,G),B._setParkState(3)):(B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS.PARK_CALL,F,G),B._setParkState(4)))},onUnparkCompleted:function(F,G){B.logger.createFnLogger("onUnparkCompleted",G).info("transactionEnd ".concat((0,pe.getPrintableObject)(F))),B._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS.UNPARK_CALL)&&(0===F.code?B._callOperationHandler.resolveOperation(oe.CALL_OPERATIONS.UNPARK_CALL,F,void 0,G):B._callOperationHandler.rejectOperation(oe.CALL_OPERATIONS.UNPARK_CALL,F,G))},onIncomingCallReplacement:function(F,G){var W=B.logger.createFnLogger("onIncomingCallReplacement",G);B.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.ON_INCOMING_CALL_REPLACEMENT,{},G),F.callNotification.callType="replaces",F.callNotification.consultativeCallId=B.callId,W.info("consultativeCallId=".concat(B.callId)),F.body={gp:F,evt:be.incomingCallEvents.INCOMING_SKYPE_NGC_CALL,nsp:void 0},B.event("replacementRequested").raise(F)},onLwjUpdated:function(F,G){var W,z;B.logger.info("[".concat(G,"][onLwjUpdated]")),B.lwjUris=F,B.streamManager.useLightweightStreams(B.lwjUris&&B.lwjUris.frameUris,G);try{for(var K=Z(B.participants),J=K.next();!J.done;J=K.next()){J.value.useLightweightStreams(B.lwjUris&&B.lwjUris.frameUris,G)}}catch(F){W={error:F}}finally{try{J&&!J.done&&(z=K.return)&&z.call(K)}finally{if(W)throw W.error}}},onContentSharingStopped:function(F){var G,W;B.logger.debug("ScreenSharing: onContentSharingStopped");try{for(var z=Z(B.contentSharingSessions),K=z.next();!K.done;K=z.next()){var J=K.value;J.contentSharingGuid===F.correlationId&&(J.contentSharingStatus=7)}}catch(F){G={error:F}}finally{try{K&&!K.done&&(W=z.return)&&W.call(z)}finally{if(G)throw G.error}}},onContentSharingStarted:function(F){B.logger.debug("ScreenSharing: onContentSharingStarted");var G=new we.default(B.callTelemetry,B.logger.createChild("ContentSharingSession"),B.signalingSession,F.correlationId||(0,ue.default)(),F.contentIdentifier,F.sessionState,F.subject,F.sessionId);G.contentSharingStatus=2,B.contentSharingSessions.push(G),G.changed((function(){return B.removeContentSessionIfEnded(G)})),B.event("contentSharingChanged").raise()},onContentSharingUpdated:function(F){B.logger.debug("ScreenSharing: onContentSharingUpdated");var G=ne.find(B.contentSharingSessions,(function(B){return B.contentSharingGuid===F.correlationId}));G?(F.presenter&&(G.presenterId=F.presenter),F.subject&&G.subject!==F.subject&&(G.subject=F.subject),F.sessionState&&G.contentSharingState!==F.sessionState&&(G.contentSharingState=F.sessionState),3===G.contentSharingStatus&&B.localSignalingParticipant.id!==F.presenter?G.contentSharingStatus=5:5===G.contentSharingStatus&&B.localSignalingParticipant.id===F.presenter&&(G.contentSharingStatus=3)):B.logger.warn("onContentSharingUpdated: session not found")},onWebRtcMediaNotification:function(F,G){var W=B.mediaSession&&B.mediaSession.getExtensionsManager?B.mediaSession.getExtensionsManager():null;W&&W.processNotification(F,G)},onCorrelationIdUpdated:function(F,G){return B.checkForCallIdUpdate(F,G)},onUnmuteRequested:function(F){},onCallForwarded:function(F){F&&F.destinationType!==B.forwardingDestinationType&&(B.forwardingDestinationType=F.destinationType,B.raiseChanged())},onPSTNBalanceUpdate:function(F){},isOneToOnePstnCall:function(){return B.isOneToOnePSTNCall()},onUpdateMeetingLiveStateCompleted:function(F,G,W){B.logger.info("[onUpdateMeetingLiveStateCompleted] [".concat(G,"] transactionEnd ").concat((0,pe.getPrintableObject)(F))),B.onOperationCompleteCommonHandler(F,G,oe.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,W)},onUpdateMeetingGroupsCompleted:function(F,G,W){B.logger.info("[onUpdateMeetingGroupsCompleted] [".concat(G,"] transactionEnd ").concat((0,pe.getPrintableObject)(F))),B.onOperationCompleteCommonHandler(F,G,oe.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,W)},onSetMeetingLayoutCompleted:function(F,G,W){B.logger.info("[onSetMeetingLayoutCompleted] [".concat(G,"] transactionEnd ").concat((0,pe.getPrintableObject)(F))),B.onOperationCompleteCommonHandler(F,G,oe.CALL_OPERATIONS.SET_MEETING_LAYOUT,W)},onJoinMeetingGroupCompleted:function(F,G,W){B.logger.info("[onJoinMeetingGroupCompleted] [".concat(G,"] transactionEnd ").concat((0,pe.getPrintableObject)(F))),B.onOperationCompleteCommonHandler(F,G,oe.CALL_OPERATIONS.JOIN_MEETING_GROUP,W)},onLeaveMeetingGroupCompleted:function(F,G,W){B.logger.info("[onJoinMeetingGroupCompleted] [".concat(G,"] transactionEnd ").concat((0,pe.getPrintableObject)(F))),B.onOperationCompleteCommonHandler(F,G,oe.CALL_OPERATIONS.LEAVE_MEETING_GROUP,W)},onBreakoutDetailsUpdated:function(F,G){B.logger.info("[onBreakoutDetailsUpdated] [".concat(G,"]")),B.breakoutDetails=F,B.raiseChanged()},onIncomingProxiedMessages:function(F,G,W){B.logger.info("[onIncomingProxiedMessages] [".concat(G,"] [").concat(W,"] payload ").concat((0,pe.getPrintableObject)(F,!0))),B.event("incomingProxiedMessages").raise(F)}};var J=Object.create(this.localSignalingParticipant);this.signalingSession=this.signalingAgent.getNewSignalingSession(J,this.signalingNotifications,this.callId,this._callCreationTime),this.accountConfiguration&&this.accountConfiguration.deviceType&&this.signalingSession.setDeviceType(this.accountConfiguration.deviceType),this.setCallId(this.callId||this.signalingSession.correlationId),this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&(this.setEndpointId(this.signalingSession.participantManager.localParticipant.endpointId),this.setParticipantId(this.signalingSession.participantManager.localParticipant.participantId),this.callStats.setParticipantId(this.participantId))}},PluginlessCall.prototype.updateParticipantStreams=function(F,B,G,W){this.isCallModeStreaming()&&!this.isPromotingToRealtime()||F.updateStreams(G,W);var z=this.getStreamInformationMap(B);this.logger.info("[updateParticipantStreams]: streaming mode with new streamInfoMap: ".concat((0,pe.safeJsonStringify)(z)));var K=this.telemetryLoggers?this.telemetryLoggers.media:null;F.useMiddleLaneStream(z,K,W)},PluginlessCall.prototype.cleanUpDueToStreaming=function(F){var B,G,W=this;this.logger.info("cleanUpDueToStreaming[".concat(F,"]: cleaning streams and media and canceling cc operations")),this.cancelAllCallingOperationsDueToStreaming(F);var z={code:be.jsCallEndCodes.Success,subCode:be.jsCallEndSubCodes.DowngradeToStreamingClient,phrase:be.jsCallEndPhrase.DowngradeToStreamingClient};this.participants.forEach((function(B){return B.updateStreams([],F)})),this.cleanUpMedia(F,z).finally((function(){W.mediaDisposedPromise=null})),this.finishCallHoldResume(z),null===(B=this.renegotiationAnswerDeferred)||void 0===B||B.reject(z),null===(G=this.newOfferRequestDeferred)||void 0===G||G.reject(z),this._parkState=0,this._transferState=0,this.isServerMuted||(this._muteState=be.ParticipantMuteState.Unmuted),this.isSpeakerMuted=!1,this.requestedHoldState=!1,this.isMuteOnHold=!1},PluginlessCall.prototype.cancelAllCallingOperationsDueToStreaming=function(F){this._callOperationHandler.maybeRejectPendingOperationsWithPredicate(74,F,(function(F,B){return ne.some(null==B?void 0:B.preconditionTags,(function(F){return F===oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE}))}))},PluginlessCall.prototype.onOperationCompleteCommonHandler=function(F,B,G,W){0===F.code?this._callOperationHandler.maybeResolveOperation(G,F,W,B):this._callOperationHandler.maybeRejectOperation(G,F,W,B)},PluginlessCall.prototype.convertToTransferType=function(F,B){var G="none";return 1===F&&B&&"none"!==B?"teamPark"===B?G="TransferTypeTeamPark":"sharedLinePark"===B?G="TransferTypeSharedLinePark":"serverHold"===B&&(G="TransferTypeServerHold"):0===F?G="TransferTypeStandard":2===F?G="TransferTypeVoicemail":this.logger.info("Irrelevant combination of transferTye: ".concat(F," and parkType: ").concat(B)),G},PluginlessCall.prototype.initializeImageRenderingSession=function(F){var B=this;F&&(this.imageRenderingSession={imageRendererProvider:F,callParams:{callId:this.callId,imageRenderingEventCallbacks:{onImageRenderingQualityChanged:function(F){B.event("callQualityChanged").raise(F)}}}})},PluginlessCall.prototype.raiseChangedDeferred=function(F){var B=this;(!this.raiseChangedDefer||this.raiseChangedDefer.isSkippable&&!F)&&(this._enableGlobalDeferHandler?je.GlobalDeferHandler.instance.runDeferredWithoutDedup((function(){delete B.raiseChangedDefer,B.raiseChanged(F)})):ne.defer((function(F){delete B.raiseChangedDefer,B.raiseChanged(F)}),F),this.raiseChangedDefer={isSkippable:!!F})},PluginlessCall.getStreamsFromEndpoints=function(F){if(!F)return[];var B=PluginlessCall.filterVirtualEndpoints(F);return B.forEach((function(F){return ne.forEach(F.mediaStreams,(function(B){B.participantId=F.participantId,B.endpointId=F.endpointId}))})),ne.flatMap(B,(function(F){return F&&F.mediaStreams||[]}))},PluginlessCall.prototype.preconditions=function(F,B){this.logger.info("check call mode currentMode is ".concat(this.callMode," operationName is ").concat(F)),ne.some(B,(function(F){return F===oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE}))&&this.isCallModeStreaming(!0)},PluginlessCall.prototype.promoteToRealtime=function(F,B){return $(this,void 0,void 0,(function(){var G,W;return X(this,(function(z){switch(z.label){case 0:G=this.getPromoteToRealtimeCallOptions(F,this.callOptions),this.logger.info("[".concat(B,"][promoteToRealtime] started with intent=").concat(F)),this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS_INTERNAL.PROMOTION_TO_REALTIME,{intent:F},B),z.label=1;case 1:return z.trys.push([1,3,,4]),[4,this.joinOrStartCall(G,this.joinGivenConversation,B,void 0)];case 2:return z.sent(),[3,4];case 3:throw W=z.sent(),this.logger.logFailure("[".concat(B,"][promoteToRealtime] failed with reason=").concat((0,pe.getPrintableObject)(W))),this.cleanUpDueToStreaming(B),this.signalingSession.cleanUpDueToStreaming(B),W;case 4:return[2]}}))}))},PluginlessCall.prototype.promoteToRealtimeAndUnmute=function(F){var B;return $(this,void 0,void 0,(function(){var G=this;return X(this,(function(W){switch(W.label){case 0:return this.logger.info("[".concat(F,"][promoteToRealtimeAndUnmute]")),this.isPromotingToRealtime()?[2,this._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS_INTERNAL.PROMOTION_TO_REALTIME).then((function(){return G.muteUnmute(!1,F)}))]:this.canPromoteToRealTime(2)?(this.unmutePendingPromise=re.defer(),this.unmutePendingPromise.promise.finally((function(){G.unmutePendingPromise=null})),[4,this.promoteToRealtime(2,F)]):[2,Promise.reject("manual promotion with audio is not allowed")];case 1:return W.sent(),setTimeout((function(){var F;null===(F=G.unmutePendingPromise)||void 0===F||F.reject("promoteToRealtime unmute timed out")}),1e3*this.signalingSession.signalingAgentConfig.csaTimeoutConfiguration.promotionUnmuteTimeoutSec),[2,null===(B=this.unmutePendingPromise)||void 0===B?void 0:B.promise]}}))}))},PluginlessCall.prototype.isPromotingToRealtime=function(){return this._callOperationHandler.hasPendingOperation(oe.CALL_OPERATIONS_INTERNAL.PROMOTION_TO_REALTIME)},PluginlessCall.prototype.getPromoteToRealtimeCallOptions=function(F,B){var G,W=1;1===F?G={value:!0,mediaTypes:["audio"]}:3===F?(G={value:!0,mediaTypes:["audio"]},W=4):2===F&&(G={value:!1});var z=Ee.getCallStartOptions(K(K({},B.callStartOptions),{preheatFlags:0,videoDirection:W}));return K(K({},B),{callStartOptions:z,applyServerMute:G,isPromotingToRealtime:!0,callStartTime:Date.now()})},PluginlessCall.prototype.canPromoteToRealTime=function(F){var B;if(this.isCallModeStreaming()&&!this.isPromotingToRealtime()){if(1===F){var G=null===(B=this.getLocalSignalingEndpointDetails())||void 0===B?void 0:B.publishedStates;return(null==G?void 0:G.some((function(F){return"attendeeModalitiesUnrestricted"===F.stateType})))&&this._enableAutoPromotion}if(2===F)return!0;if(3===F)return!1}return!1},PluginlessCall.prototype.isCallModeStreaming=function(F){if(void 0===F&&(F=!1),2===this.callMode){if(!F)return!0;throw this.logger.info("reject check callmode"),{code:oe.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:oe.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE,phrase:oe.TRANSACTION_END_PHRASE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE}}return!1},PluginlessCall.prototype.setCallOptions=function(F){var B;this.receiveOnlyAudioOnCallStart=!!(null===(B=F.callStartOptions)||void 0===B?void 0:B.receiveOnlyAudioOnCallStart),this.callOptions=F,this.logger.info("callOptions: ".concat((0,pe.safeJsonStringify)(Ee.scrubCallOptions(F))))},PluginlessCall.prototype.getSelfClientEndpointCapabilities=function(){var F,B;return null===(B=null===(F=this.callOptions)||void 0===F?void 0:F.callStartOptions)||void 0===B?void 0:B.clientEndpointCapabilities},PluginlessCall.prototype.getLocalSignalingEndpointDetails=function(){var F=this;return ne.find(this.localSignalingParticipant.endpointDetails,(function(B){return(null==B?void 0:B.endpointId)===F._endpointId}))},PluginlessCall.prototype.getStreamInformationMap=function(F){var B,G=this,W={};return F&&(null===(B=this.accountConfiguration)||void 0===B?void 0:B.clientSupportsMiddleLane)&&ne.forEach(F.endpointDetails,(function(F){(null==F?void 0:F.streamInformation)&&F.participantId&&F.participantId!==G._participantId&&(W[F.participantId]=F.streamInformation)})),W},PluginlessCall.prototype.updateSATInfo=function(F){var B;void 0===F&&(F=[]);var G=null===(B=this.mediaSession)||void 0===B?void 0:B.getSessionConfig().config.slowedDownTalkerInfoAggregationTime;if(G&&!(G<0)){var W=Date.now(),z=W-1e3*G;this.activeTalkersHistory=this.activeTalkersHistory.filter((function(F){return F.timestamp>z})).concat({speakers:F.map((function(F){return F.id})),timestamp:W});var K=Object.entries(this.activeTalkersHistory.reduce((function(F,B){var G,W,z,K=B.speakers;try{for(var J=Z(K),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;null!==(z=F[Y])&&void 0!==z||(F[Y]=0),F[Y]++}}catch(F){G={error:F}}finally{try{Q&&!Q.done&&(W=J.return)&&W.call(J)}finally{if(G)throw G.error}}return F}),{})).sort((function(F,B){var G=ee(F,2)[1];return ee(B,2)[1]-G})).map((function(F){return ee(F,1)[0]}));this.slowedDownActiveTalkerInfo={speakerList:K,timestamp:new Date(W)}}},PluginlessCall.prototype.initializeMediaSession=function(F){var B,G,W=this;if(!this.mediaSession){var wrapCallBacks=function(F,B){var G={};return Object.keys(B).forEach((function(W){G[W]=function(){for(var G=[],z=0;z<arguments.length;z++)G[z]=arguments[z];return B[W]&&F()&&B[W].apply(B,te([],ee(G),!1))}})),G},z=wrapCallBacks((function(){return!W.isCallModeStreaming()||W.isPromotingToRealtime()}),{onSessionErrorOccurred:function(F,B){void 0===B&&(B=(0,se.generateCauseId)()),W.logger.error("[".concat(B,"][onSessionErrorOccurred]: ").concat((0,pe.safeJsonStringify)(F)));var G=[W.mediaAgent.constants.MEDIA_ERROR.iceConnectionError,W.mediaAgent.constants.MEDIA_ERROR.internalError];ne.includes(G,F.type)&&W.event("mediaConnectionFailed").raise(),W.callTelemetry.recordEvent(oe.MEDIA_EVENT.SESSION_ERROR,{type:F.type},B)},onNegotiationRequired:function(F){if(void 0===F&&(F=(0,se.generateCauseId)()),W.isCallModeStreaming())W.logger.info("[".concat(F,"][onNegotiationRequired] ignored due to being in streaming"));else{var B=(0,se.generateCauseId)();3===W.state||4===W.state||5===W.state||10===W.state||W.isPreheatedOnly()?(W.logger.info("[".concat(F,"][onNegotiationRequired] Negotiation started, state: ").concat(W.state)),W._callOperationHandler.executeChained((function(){return W.renegotiateOutgoing(F)}),oe.CALL_OPERATIONS_INTERNAL.RENEGOTIATE_OUTGOING,B,F,void 0,void 0,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]})):W.logger.info("[".concat(F,"][onNegotiationRequired] Negotiation not started, state: ").concat(W.state)),W.callTelemetry.recordEvent(oe.MEDIA_EVENT.NEGOTIATION_REQUIRED,"",F)}},onContributingSourcesChanged:function(F){var B,G,z=[],_loop_3=function(B){var G=F.some((function(F){return B.hasAudioSource(F)})),W=G?1:0;B.updateVoiceLevel(W),G&&z.push(B)};try{for(var K=Z(W.participants),J=K.next();!J.done;J=K.next()){_loop_3(J.value)}}catch(F){B={error:F}}finally{try{J&&!J.done&&(G=K.return)&&G.call(K)}finally{if(B)throw B.error}}W.updateSATInfo(z)},onDominantSpeakerChanged:function(F,B){var G=(0,se.generateCauseId)(),z=[],K=[];F.forEach((function(F){var B=ne.find(W.participants,(function(B){return B.hasAudioSource(F)}));B?(z.push(B.id),K.push(_e.scrubMriOrOmit(B.id))):K.push(W.streamManager.audio.id===F?"<self>":"<unknown>")})),W.logger.info("[".concat(G,"][onDominantSpeakerChanged], msidList = ").concat(F," => speakerList = ").concat(K,", timestamp = ").concat(B)),W.dominantSpeakerInfo={speakerList:z,timestamp:B,noCurrentDominantSpeaker:!1},W.event("dominantSpeakerChanged").raise(),W.raiseChanged(W._dominantSpeakerChangedEventSkipConfig)},onAudioStateChanged:function(F,B){var G=(0,se.generateCauseId)(),z=W.logger.createFnLogger("onAudioStateChanged",G);z.info((0,pe.safeJsonStringify)(F)),W.callStats.localStats.audio.streamStateChanged(F.stream,F.direction);var K=PluginlessCall.streamingStatetoMediaStreamState(F.stream);if(W.audioStreamState=K,K){W.callTelemetry.recordEvent(oe.MEDIA_EVENT.AUDIO_STATE_CHANGED,{state:F,reason:B},G),2===K&&2===W.state&&(W.setCallState(9,G),W.participants.forEach((function(F){return F.setState(6,void 0,G)})));var J={mediaType:0,mediaDirection:PluginlessCall.streamingDirectionToMediaDirectionMapping(F.direction),mediaStreamState:K};if(W.event("mediaStreamStateChanged").raise(J),!W.isCallSetupTelemetrySent&&W.mediaSession&&W.mediaSession.getSessionConfig().config.sendCallStartupTelemetry&&W.sendCallSetupTelemetry(),0===J.mediaDirection&&(W.isAudioStreamConnected=ne.includes([2,1],J.mediaStreamState)),ne.includes([3,4],J.mediaStreamState))if(z.logFailure("audio stream state changed to ".concat(F.stream," with reason ").concat(B)),!B||["timeout","connection-dropped","connectivity-check-failure"].indexOf(B)>=0){W.event("mediaConnectionFailed").raise();var Q=W.mediaRelayWhiteListingIssue?53:4;W.mediaRelayWhiteListingIssue&&W.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.MEDIA_WHITELISTING_ISSUE_DETECTED);var Y=W.getRejectionInfoFromTerminatedReason(Q);W.shouldFallbackToLwj([Y.code,Y.subCode],z)?W.reconnectAsLwj(Q,G):W.stopInternal({causeId:G,terminatedReason:Q})}}},onQualityChanged:function(F){var B={type:PluginlessCall.convertQualityEventType(F.type),value:PluginlessCall.convertQualityLevel(F.value),isLocalSource:F.isLocalSource,mediaType:PluginlessCall.convertMediaType(F.mediaType)};W.muteUnmuteWorkaround(B),32===B.type&&(W.mediaRelayWhiteListingIssue=3===B.value,W.mediaRelayWhiteListingIssue&&W.event("mediaConnectionWhitelistingWarning").raise()),5===B.type&&3===B.value&&W.trouterService.checkConnection(!0),W.callTelemetry.recordEvent(oe.MEDIA_EVENT.AUDIO_QUALITY_CHANGED,B),W.event("callQualityChanged").raise(B)},onOptimalVideoReceiversCountChanged:function(F){W.logger.debug("onOptimalVideoReceiversCountChanged: ".concat(F)),W.optimalVideoCount!==F&&(W.optimalVideoCount=F,W.raiseChanged())},onDataChannelUpdated:function(F){var B=(0,se.generateCauseId)();W.logger.debug("[".concat(B,"] onDataChannelUpdated")),W.dataChannel.registerSessionDataChannel(F,B)},onUpdateMediaDescriptions:function(F,B){W.logger.debug("[".concat(B,"] onUpdateMediaDescriptions ").concat(JSON.stringify(F)))},onRealtimeTelemetryReport:function(){W.reportTelemetryEvents([{eventName:"realtimetelemetry",props:{user_object_id:{value:ge.MRI_SKYPE_PREFIX+W.currentUserSkypeIdentity.id,piiKind:10},call_context_id:{value:W.signalingSession.correlationId,piiKind:0},participant_id:{value:W.participantId,piiKind:0},media_leg_id:{value:W.mediaLegId,piiKind:0},DiagnosticLevel:{value:255,piiKind:0},eventpdclevel:{value:2,piiKind:0},eventpriority:{value:5,piiKind:0},call_technical_info:{value:JSON.stringify(W.mediaSession.getCallTechnicalInfo()),piiKind:0}}}],"realtimeMedia","mdsc")}});this._mediaSessionCreationTime=Date.now(),this.callTelemetry.recordEvent(oe.MEDIA_EVENT.CREATING_CONFERENCE,"",F),this.mediaSession=new Ae.default(this.mediaAgent.createSession(z,this.signalingSession.correlationId,{isConference:this.callUsesMixer,isPstnCall:this.isOneToOnePSTNCall(),isParkedCall:this.isParkedCall()}),this.signalingSession,this.mediaAgent.constants),this.callTelemetry.recordEvent(oe.MEDIA_EVENT.CREATED_CONFERENCE,"",F),this.streamManager.setMediaSession(this.mediaSession,F),this.participants.forEach((function(B){B.setMediaSession(W.mediaSession,F)}));var K=null===(G=null===(B=this.mediaSession)||void 0===B?void 0:B.getSessionConfig())||void 0===G?void 0:G.config;(null==K?void 0:K.useOneDsLogger)&&(null==K?void 0:K.addTelemetryReportingCallback)&&(this.beforeUnloadTelemetrySender=function(){W.sendLastKnownStats()},window.addEventListener("beforeunload",this.beforeUnloadTelemetrySender)),this.screenSharingControl&&this.allowDataChannel()&&(this.screenSharingControl.setGiveControlEnabled(this.isGiveControlEnabled()),this.screenSharingControl.setupDataHandlers())}},PluginlessCall.prototype.muteUnmuteWorkaround=function(F){var B;return $(this,void 0,void 0,(function(){var G;return X(this,(function(W){switch(W.label){case 0:return(null===(B=this.mediaSession)||void 0===B?void 0:B.getSessionConfig().config.enableMuteSpeakerUnmuteSpeakerWorkaround)?this.isSpeakerMuted?[2]:25!==F.type||3!==F.value||0!==F.mediaType?[3,3]:(this.logger.log("Performing muteSpeaker->unmuteSpeaker workaround"),G=(0,se.generateCauseId)(),[4,this.muteSpeaker(G)]):[2];case 1:return W.sent(),[4,this.unmuteSpeaker(G)];case 2:W.sent(),W.label=3;case 3:return[2]}}))}))},PluginlessCall.prototype.sendLastKnownStats=function(){if(!this.tsCallingTelemetryReported){this.reportTelemetryEvents(this.callStats.buildFromLocalStats(),"signaling","skypecosi_concore_web"),this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo);var F="in_call_session";this.reportTelemetryEvents([{eventName:F,props:this.callTelemetry.getEvent(!0)}],"signaling","skypecosi_concore_web_ts_calling"),this.reportTelemetryEvents(this.callStats.buildFromMediaStats(),"media","mdsc_beacon");var B=this.mediaSession.getLastKnownStats(!0);B.data.TerminationReason={code:"".concat(ce.CONSTANTS.CODE.SUCCESS),subCode:"".concat(ce.CONSTANTS.SUB_CODE.BEACON)},this.callStats.setMediaStats(B),this.appendInfoToCallStats(),this.reportTelemetryEvents(this.callStats.buildFromMediaStats(),"media","mdsc")}},PluginlessCall.prototype.invertDirectionality=function(F){switch(F){case this.mediaAgent.constants.MEDIA_STATE.sendReceive:return ke.streamDirections.sendReceive;case this.mediaAgent.constants.MEDIA_STATE.send:return ke.streamDirections.receive;case this.mediaAgent.constants.MEDIA_STATE.receive:return ke.streamDirections.send;default:return null}},PluginlessCall.prototype.completeNegotiationAsync=function(F){var G=this,W=this.logger.createFnLogger("completeNegotiationAsync",F),z=this.mediaSession.completeNegotiationAsync(F).then((function(z){W.info("activeModalities=".concat(z&&Object.keys(z.activeModalities)));var K=G.participants[0],J=K&&K.endpoints&&K.endpoints.endpointDetails.length&&K.endpoints.endpointDetails[0].mediaStreams&&K.endpoints.endpointDetails[0].mediaStreams.length,Q=G.mediaSession.getSessionConfig().config.avoidFakeStreamsDuringEscalation&&G.isEscalationInProgress;if(K&&!G.callUsesMixer&&!Q&&!J){var prepareStreamData=function(F,W,z){return{participantId:B.DEFAULT_PARTICIPANT_ID,endpointId:B.DEFAULT_ENDPOINT_ID,type:F,direction:G.invertDirectionality(W),sourceId:z,serverMuted:!1}},Y=[];Y.push(prepareStreamData(ke.ngcStreamTypes.audio,z.activeModalities.audio,Me.AUDIO_STREAM_DEFAULT_ID)),z.activeModalities.video&&Y.push(prepareStreamData(ke.ngcStreamTypes.video,z.activeModalities.video,Me.VIDEO_STREAM_DEFAULT_ID)),z.activeModalities.sharing&&Y.push(prepareStreamData(ke.ngcStreamTypes.sharing,z.activeModalities.sharing,Me.SHARING_STREAM_DEFAULT_ID)),K.updateStreams(Y,F)}return W.logSuccess((0,pe.safeJsonStringify)(z)),z}));return z.catch((function(B){W.logFailure(B),G.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.COMPLETE_NEGOTIATION_FAILED,{e:B},F)})),z},PluginlessCall.prototype.renegotiateOutgoing=function(F){return $(this,void 0,void 0,(function(){var B,G,W,z,K,J,Q,Y,$,Z,ee,te,ne,ie=this;return X(this,(function(X){switch(X.label){case 0:this.renegotiationAnswerDeferred=re.defer(),(G=this.logger.createFnLogger("renegotiateOutgoing",F)).info("start"),W=(0,Se.default)(G),X.label=1;case 1:X.trys.push([1,11,,12]),X.label=2;case 2:return X.trys.push([2,8,,10]),B=this.inLocalHold()?this.getMediaModalitiesForHold(F):this.calculateModalityDirections({},F),[4,W.execute(be.RenegotiationPhase.MediaCreateOffer,(function(){return ie.mediaSession.createOfferAsync(F)}))];case 3:return z=X.sent(),K=this.getSignalingMediaTypes(B),[4,W.execute(be.RenegotiationPhase.SignalingStartNegotiation,(function(){return ie.signalingSession.startRenegotiationAsync(z,K,F)}))];case 4:return X.sent(),[4,W.execute(be.RenegotiationPhase.SignalingRenegotiationAnswer,(function(){return ie.renegotiationAnswerDeferred.promise}))];case 5:return J=X.sent(),[4,W.execute(be.RenegotiationPhase.MediaProcessAnswer,(function(){return ie.mediaSession.processAnswerAsync(J,F,!1)}))];case 6:return X.sent(),[4,W.execute(be.RenegotiationPhase.CompleteNegotiation,(function(){return ie.completeNegotiationAsync(F)}))];case 7:return Q=X.sent(),this.onNegotiationCompletion(Q,!0,B,F,W.getTelemetryData()),[3,10];case 8:if(Y=X.sent(),G.logFailure(Y),!Y.phase)throw this.callTelemetry.recordEvent(oe.MEDIA_EVENT.OUTGOING_NEGOTIATION_FAILURE,Y,F),Y;if($="unknown",Z=this.mediaAgent.constants.RENEGOTIATION_ERROR,$=Z.local,Y.phase===be.RenegotiationPhase.SignalingRenegotiationAnswer||Y.phase===be.RenegotiationPhase.SignalingStartNegotiation?(ee=415,$=Y.error.code===be.jsCallEndCodes.GlareError?Z.glare:Y.error.code===ee?Z.media:Z.signaling):Y.phase===be.RenegotiationPhase.MediaCreateOffer&&Y.error.type===this.mediaAgent.constants.MEDIA_ERROR.noNetworkError&&($=Z.media),this.callTelemetry.recordEvent(oe.MEDIA_EVENT.OUTGOING_NEGOTIATION_FAILURE,this.getTelemetryFromPhaseExecution(Y),F),Y.error.message&&Y.error.message.includes("The requested call does not exist"))throw new Error("Call drop due to remote replying with call not found");return G.logFailure($),te={type:$,detail:Y.error},[4,this.mediaSession.rejectNegotiationAsync(te,F)];case 9:return X.sent(),this.onNegotiationFailure(Y,$,F,B),[3,10];case 10:return[3,12];case 11:return ne=X.sent(),G.logFailure(ne),this.callTelemetry.recordEvent(oe.MEDIA_EVENT.NEGOTIATION_FATAL_ERROR,(0,pe.getPIISafeObject)(ne),F),this.stopInternal({causeId:F,terminatedReason:47}),[3,12];case 12:return[2]}}))}))},PluginlessCall.prototype.renegotiateIncoming=function(F,B){return $(this,void 0,void 0,(function(){var G,W,z,K,J,Q,Y,$,Z,ee,te,ne=this;return X(this,(function(X){switch(X.label){case 0:if(this.mediaAcknowledgmentOperation=this._callOperationHandler.createPendingOperation(oe.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,null,B,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),this.mediaAcknowledgmentOperation.catch(de.noop),(G=this.logger.createFnLogger("renegotiateIncoming",B)).info("start"),F.newOffer&&!this.mediaAgent.getCapabilities().retargeting)return G.logFailure("Retarget offer received, but pluginless has no support for retarget"),this.stopInternal({causeId:B,terminatedReason:38}),[2];W=(0,Se.default)(G),X.label=1;case 1:return X.trys.push([1,12,,20]),[4,W.execute(be.RenegotiationPhase.MediaProcessOffer,(function(){return ne.mediaSession.processOfferAsync(F,B)}))];case 2:return z=X.sent(),this.handleOfferedModalities(z,B),this.getRenegotiationOfferType(z)!==be.RenegotiationOfferType.Resume?[3,4]:[4,this.prepareModalitiesForResume(B)];case 3:X.sent(),X.label=4;case 4:return[4,this.updateMediaModalities({offered:z},B)];case 5:return K=X.sent(),this.getRenegotiationOfferType(z)!==be.RenegotiationOfferType.Hold?[3,7]:[4,this.prepareModalitiesForHold(B)];case 6:X.sent(),X.label=7;case 7:return this.updateMediaState(K,B),this.isRenegotiationHoldOrResume(K)&&this.updateScreenSharingState(K,B),[4,W.execute(be.RenegotiationPhase.MediaCreateAnswer,(function(){return ne.mediaSession.createAnswerAsync(!1,B)}))];case 8:return J=X.sent(),Q=this.getSignalingMediaTypes(K),[4,W.execute(be.RenegotiationPhase.SignalingAcceptRenegotiation,(function(){return ne.signalingSession.acceptRenegotiationAsync(J,Q,B)}))];case 9:return X.sent(),[4,W.execute(be.RenegotiationPhase.SignalingMediaAcknowledgement,(function(){return ne.mediaAcknowledgmentOperation}))];case 10:return X.sent(),[4,W.execute(be.RenegotiationPhase.CompleteNegotiation,(function(){return ne.completeNegotiationAsync(B)}))];case 11:return Y=X.sent(),this.onNegotiationCompletion(Y,!1,z,B,W.getTelemetryData()),[3,20];case 12:$=X.sent(),X.label=13;case 13:if(X.trys.push([13,18,,19]),!$.phase||$.phase===be.RenegotiationPhase.CompleteNegotiation)throw this.callTelemetry.recordEvent(oe.MEDIA_EVENT.INCOMING_NEGOTIATION_FAILURE,$,B),$;return Z=$,this.callTelemetry.recordEvent(oe.MEDIA_EVENT.INCOMING_NEGOTIATION_FAILURE,this.getTelemetryFromPhaseExecution($),B),ee={type:this.mediaAgent.constants.RENEGOTIATION_ERROR.local,detail:$.error},Z.phase!==be.RenegotiationPhase.SignalingAcceptRenegotiation&&Z.phase!==be.RenegotiationPhase.SignalingMediaAcknowledgement?[3,15]:(G.logFailure("Error in renegotiateIncoming() -> rejecting media negotiation"),ee.type=this.mediaAgent.constants.RENEGOTIATION_ERROR.signaling,this._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,ee,void 0,B),[4,this.mediaSession.rejectNegotiationAsync(ee,B)]);case 14:return X.sent(),[2];case 15:return this._callOperationHandler.maybeRejectOperation(oe.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,ee,void 0,B),[4,this.mediaSession.rejectNegotiationAsync(ee,B)];case 16:return X.sent(),[4,this.signalingSession.rejectRenegotiationAsync(void 0,B)];case 17:return X.sent(),[3,19];case 18:return te=X.sent(),G.logFailure(te),this.callTelemetry.recordEvent(oe.MEDIA_EVENT.NEGOTIATION_FATAL_ERROR,(0,pe.getPIISafeObject)(te),B),this.stopInternal({causeId:B,terminatedReason:47}),[3,19];case 19:return[3,20];case 20:return[2]}}))}))},PluginlessCall.prototype.handleCallEscalation=function(F,G){var W=this.logger.createFnLogger("handleCallEscalation",G);if(W.info("current callType=".concat(this.callType,", escalationInProgress=").concat(F,", isEscalationInProgress=").concat(this.isEscalationInProgress)),F){var z=this.participants[0];z&&z.audio.participantId===B.DEFAULT_PARTICIPANT_ID?z.updateStreams([{type:ke.ngcStreamTypes.audio,direction:"inactive",sourceId:null,serverMuted:!1},{type:ke.ngcStreamTypes.video,direction:"inactive",sourceId:null,serverMuted:!1},{type:ke.ngcStreamTypes.sharing,direction:"inactive",sourceId:null,serverMuted:!1}],G):W.info("no 1-1 participant found, stream update ignored"),this.setCallType(2,G),this.setCallUsesMixer(!0,G),this.setIsEscalationInProgress(!1,G),this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.ESCALATION_COMPLETED,void 0,G),this.raiseChanged()}},PluginlessCall.prototype.reportTsCallingTelemetry=function(F){return $(this,void 0,void 0,(function(){var B;return X(this,(function(G){switch(G.label){case 0:return this.tsCallingTelemetryReported?[2]:[4,this.connectCallPromise.catch(de.noop)];case 1:return G.sent(),B=F?"call_setup_session":"in_call_session",this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this.reportTelemetryEvents([{eventName:B,props:this.callTelemetry.getEvent(F)}],"signaling","skypecosi_concore_web_ts_calling"),F?this.callTelemetry.switchToInCallTelemetry():this.tsCallingTelemetryReported=!0,[2]}}))}))},PluginlessCall.prototype.sendCallSetupTelemetry=function(){this.mediaSession&&(this.collectCallStats(this.mediaSession),this.reportCallSetupStats(),this.isCallSetupTelemetrySent=!0)},PluginlessCall.prototype.collectCallStats=function(F){var B=this,always=function(){return B.collectMediaStatsDeferred.resolve()};return F.getStatsAsync(!1).then((function(F){return B.callStats.setMediaStats(F)})).then(always,always)},PluginlessCall.prototype.reportCallSetupStats=function(){var F=this;this.collectMediaStatsDeferred.promise.then((function(){F.reportTelemetryEvents(F.callStats.buildFromCallSetupStats(),"media","mdsc"),F.event("statsReported").raise(),F.collectMediaStatsDeferred=re.defer()}))},PluginlessCall.prototype.reportCallEndStats=function(F){return $(this,void 0,void 0,(function(){return X(this,(function(B){switch(B.label){case 0:return this.callTelemetry.setTerminationState(this.state),this.callTelemetry.setTerminationReason(this.terminatedReason),this.callStats.localStats.endCall(this.terminatedReason),this.reportTelemetryEvents(this.callStats.buildFromLocalStats(),"signaling","skypecosi_concore_web"),this.reportTsCallingTelemetry(!this._callIsSetupComplete),F?[4,this.collectMediaStatsDeferred.promise]:[3,2];case 1:B.sent(),this.callStats.appendTerminationInfo(this.terminatedReason,this.state),this.appendInfoToCallStats(),this.reportTelemetryEvents(this.callStats.buildFromMediaStats(),"media","mdsc"),B.label=2;case 2:return this.event("statsReported").raise(),this.collectMediaStatsDeferred=re.defer(),[2]}}))}))},PluginlessCall.prototype.reportTelemetryEvents=function(F,B,G){var W=this.telemetryLoggers?this.telemetryLoggers[B]:null;W?F.forEach((function(F){return W.sendEvent({eventName:"".concat(G?"".concat(G,"_"):"").concat(F.eventName),props:F.props})})):this.logger.debug("reportTelemetryEvents no logger for tenant ".concat(B))},PluginlessCall.prototype.onLocalPreviewSizeChanged=function(F,B){this.logger.debug("onLocalPreviewSizeChanged: ".concat(F,"x").concat(B))},PluginlessCall.prototype.onLocalPreviewStateChanged=function(F){this.logger.debug("onLocalPreviewStateChanged: ".concat(F)),this.callStats.localStats.video.streamStateChanged(F.stream)},PluginlessCall.prototype.configureVideoModalitiesAsync=function(F,B){return $(this,void 0,void 0,(function(){return X(this,(function(G){switch(G.label){case 0:return this.mediaSession?[4,this.updateMediaModalities(void 0,B)]:(this.logger.warn("Tried to configure modalities after call end"),[2,Promise.resolve()]);case 1:return G.sent(),F||this.turnOffLocalVideoPreview(B),this.setVideoOn(F,B),[2]}}))}))},PluginlessCall.prototype.turnOffLocalVideoPreview=function(F){return this.localVideoRenderer&&(this.localVideoRenderer.dispose(),this.localVideoRenderer=null),Promise.resolve(void 0)},PluginlessCall.prototype.turnOnLocalVideoPreview=function(F){var B=this,G=this.logger.createFnLogger(oe.CALL_OPERATIONS_INTERNAL.START_PREVIEW_VIDEO,F),W=this.mediaStateConfigurationHelper.isSending(1);if(!W||!this.localVideoContainer)return Promise.reject("could not start video preview: requestedVideoState=".concat(W,", localVideoContainer=").concat(this.localVideoContainer));this.turnOffLocalVideoPreview(F);var z=re.asap((function(){B.localVideoRenderer=B.mediaAgent.getDeviceManager().createPreviewRenderer(B.localVideoContainer),B.localVideoRenderer.on("onVideoSizeChanged",(function(F,G){return B.onLocalPreviewSizeChanged(F,G)})),B.localVideoRenderer.on("onVideoStateChanged",(function(F){return B.onLocalPreviewStateChanged(F)}))})).then((function(){return B.localVideoRenderer.startVideoAsync(F)}));return z.catch((function(F){return G.logFailure(F)})),z},PluginlessCall.prototype.startStopVideo=function(F,B){var G,W=this,z=this.logger.createFnLogger(F?"startVideo":"stopVideo",B);if(z.info("start"),this.isJoinedLightweight())return z.logFailure("Can not start/stop video in lightweight call]"),Promise.reject(60);if(!this.canToggleVideo)return F===this.mediaStateConfigurationHelper.isSending(1)?this.videoTogglePromise.then((function(){W.turnOnLocalVideoPreview(B)})):(z.logFailure("video switching is in progress ".concat(F,"]")),Promise.reject({reason:1}));F?(this.callStats.localStats.newSession(1),this.callStats.localStats.video.start()):this.callStats.localStats.video.stop(),F&&this.mediaStateConfigurationHelper.isDisabled(1)&&z.info("Video modality was skipped till now. Adding it now."),F?this.mediaStateConfigurationHelper.enableModality(1):this.mediaStateConfigurationHelper.removeModality(1),this.canToggleVideo=!1;var always=function(){W.canToggleVideo=!0};this.videoTogglePromise=Promise.resolve().then((function(){return!!F&&(W.localVideoContainer||(W.localVideoContainer=document.createElement("div")),W.turnOnLocalVideoPreview(B).then((function(){return!0})))})).then((function(F){return W.configureVideoModalitiesAsync(F,B)})).catch((function(F){return z.logFailure(F),W.mediaStateConfigurationHelper.removeModality(1),W.configureVideoModalitiesAsync(!1,B).then((function(){throw F}))})).then(always,(function(F){throw z.logFailure(F),always(),F}));try{null===(G=this.pipManager)||void 0===G||G.updateActionHandlerStatus()}catch(F){this.logger.warn("Error updating action handlers for PictureInPicture: ".concat(JSON.stringify(F)))}return this.videoTogglePromise},PluginlessCall.prototype.startStopAudio=function(F,B){return $(this,void 0,void 0,(function(){var G,W,z;return X(this,(function(K){switch(K.label){case 0:G=this.logger.createFnLogger(F?"startAudio":"stopAudio",B),K.label=1;case 1:return K.trys.push([1,3,,4]),[4,this.updateMediaModalities(void 0,B)];case 2:return W=K.sent(),this.updateMediaState(W,B),[3,4];case 3:return z=K.sent(),G.logFailure(z),[2,9];case 4:return[2,0]}}))}))},PluginlessCall.prototype.updateEndpointStateForMute=function(F,B){try{this.signalingSession.updateEndpointState({state:{isMuted:F}},B)}catch(F){this.logger.logFailure("updateEndpointStateForMute failure: ".concat(F))}},PluginlessCall.prototype.handleServerMutedState=function(F){var B,G;return $(this,void 0,void 0,(function(){var W,z,K,J;return X(this,(function(Q){switch(Q.label){case 0:if(W=this.logger.createFnLogger("handleServerMutedState, isServerMuted=".concat(!!this.isServerMuted),F),this.isServerMuted)return[3,4];if(z=this._muteState===be.ParticipantMuteState.AttemptingUnmute,this._muteState!==be.ParticipantMuteState.ServerMuted&&!z)return[3,4];Q.label=1;case 1:return Q.trys.push([1,3,,4]),W.info("is unmuting, as we are no longer server muted"),[4,this.handleMuteUnmuteOnMediaSession(!1,F)];case 2:return Q.sent(),this.setMuted(be.ParticipantMuteState.Unmuted,F),null===(B=this.unmutePendingPromise)||void 0===B||B.resolve(),z&&this.updateEndpointStateForMute(!1,F),[3,4];case 3:throw K=Q.sent(),W.logFailure(K),K;case 4:if(!this.isServerMuted||this._muteState!==be.ParticipantMuteState.Unmuted)return[3,8];W.info("is muting, as we are unmuted"),Q.label=5;case 5:return Q.trys.push([5,7,,8]),[4,this.handleMuteUnmuteOnMediaSession(!0,F)];case 6:return Q.sent(),this.setMuted(be.ParticipantMuteState.ServerMuted,F),[3,8];case 7:throw J=Q.sent(),W.logFailure(J),J;case 8:try{null===(G=this.pipManager)||void 0===G||G.updateActionHandlerStatus()}catch(F){this.logger.warn("Error updating action handlers for PictureInPicture: ".concat(JSON.stringify(F)))}return[2]}}))}))},PluginlessCall.prototype.handleMuteUnmuteOnMediaSession=function(F,B){return $(this,void 0,void 0,(function(){var G,W,z;return X(this,(function(K){switch(K.label){case 0:return G=this.logger.createFnLogger("handleMuteUnmuteOnMediaSession, value=".concat(!!F),B),this.mediaSession&&this.mediaSession.getAllowedModalities&&!this.isServerMuted?(W=this.isMuted||this.isServerMuted,z=this.mediaSession.getAllowedModalities().audio.some((function(F){return F===ke.streamDirections.send||F===ke.streamDirections.sendReceive})),W&&z||!W&&!z?(G.info("updating audio modalities: Muted ".concat(W," -> ").concat(F,"; audioAllowed = ").concat(z)),[4,this.updateMediaModalities(void 0,B)]):[3,2]):[3,2];case 1:K.sent(),K.label=2;case 2:return F?(G.info("mediaSession.muteInputAsync"),[4,this.mediaSession.muteInputAsync(B)]):[3,4];case 3:return K.sent(),[3,6];case 4:return F?[3,6]:(G.info("mediaSession.unmuteInputAsync"),[4,this.mediaSession.unmuteInputAsync(B)]);case 5:K.sent(),K.label=6;case 6:return[2,Promise.resolve()]}}))}))},PluginlessCall.prototype.updateCapabilities=function(F,B){void 0===B&&(B=!1);var G=!1,W=!1;if(!Ce.callStateIsAnyOf(this.state,[11,12])){var z="attendee"===(this.advancedMeetingRole||this.meetingRole);this.isJoinedLightweight()||(this.isServerMuted&&!this._callInLobby?this._commandUrlPresence&ie.CommandUrlPresence.Unmute&&(G=!0):this.isMuted&&(G=!0)),W=!!(this._commandUrlPresence&ie.CommandUrlPresence.Mute)&&!z}this._capabilities.canUnmuteSelf===G&&this._capabilities.canMuteOthers===W||(this._capabilities.canUnmuteSelf=G,this._capabilities.canMuteOthers=W,this.logger.info("[".concat(F,"][updateCapabilities] Computed self capabilities: ").concat(JSON.stringify(this._capabilities))),B&&this.raiseChanged())},PluginlessCall.prototype.handleEndpointStatesForAccept=function(F,B,G){return $(this,void 0,void 0,(function(){var W,z,K,J,Q;return X(this,(function(Y){switch(Y.label){case 0:W=this.logger.createFnLogger("handleEndpointStatesForAccept, muteValue=".concat(!!F),G),Y.label=1;case 1:return Y.trys.push([1,6,,7]),z=!1,K={},(J=F?be.ParticipantMuteState.Muted:be.ParticipantMuteState.Unmuted)===this._muteState?[3,3]:[4,this.handleMuteUnmuteOnMediaSession(F,G)];case 2:Y.sent(),this.setMuted(J,G),Object.assign(K,{state:{muteValue:F}}),W.info("is updating endpointState for mute"),z=!0,Y.label=3;case 3:return B&&(Object.assign(K,{endpointProperties:{additionalEndpointProperties:B}}),W.info("is updating endpointState for additionalEndpointProperties"),z=!0),z?[4,this.signalingSession.updateEndpointState(K,G)]:[3,5];case 4:Y.sent(),Y.label=5;case 5:return[3,7];case 6:throw Q=Y.sent(),W.logFailure(Q),(0,le.getRejectTransactionEnd)(Q);case 7:return[2]}}))}))},PluginlessCall.prototype.muteUnmute=function(F,B){var G;return $(this,void 0,void 0,(function(){var W,z,K,J=this;return X(this,(function(Q){switch(Q.label){case 0:if(W=this.logger.createFnLogger("muteUnmute, value=".concat(!!F," isServerMuted=").concat(this.isServerMuted," inLobby=").concat(this._callInLobby),B),this.isJoinedLightweight())return W.logFailure("Can not mute/unmute lightweight call"),[2,Promise.reject((0,le.getRejectTransactionEnd)(oe.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))];if(Ce.callStateIsAnyOf(this.state,[11,12]))return W.logFailure("Can not mute/unmute during preheat call"),[2,Promise.reject((0,le.getRejectTransactionEnd)(oe.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))];z=!F&&(!this.isServerMuted||this._callInLobby),Q.label=1;case 1:return Q.trys.push([1,4,,5]),F||z?[4,this.handleMuteUnmuteOnMediaSession(F,B)]:[3,3];case 2:Q.sent(),Q.label=3;case 3:if(F)this.setMuted(be.ParticipantMuteState.Muted,B),W.info("is updating endpointState for mute"),this.updateEndpointStateForMute(!0,B);else{if(!z)return W.info("is unmuting on server"),this._muteState===be.ParticipantMuteState.Muted&&this.setMuted(be.ParticipantMuteState.AttemptingUnmute,B),this.isCallModeStreaming()?[2,this.promoteToRealtimeAndUnmute(B)]:[2,this.signalingSession.unmuteAsync().then((function(F){J.handleSelfUnmuteUpdatedInfo(F,B)}))];W.info("is updating endpointState for unmute"),this.setMuted(be.ParticipantMuteState.Unmuted,B),this.updateEndpointStateForMute(!1,B)}return[3,5];case 4:throw K=Q.sent(),W.logFailure(K),(0,le.getRejectTransactionEnd)(K);case 5:try{null===(G=this.pipManager)||void 0===G||G.updateActionHandlerStatus()}catch(F){this.logger.warn("Error updating action handlers for PictureInPicture: ".concat(JSON.stringify(F)))}return[2]}}))}))},PluginlessCall.prototype.muteUnmuteSpeaker=function(F,B){return $(this,void 0,void 0,(function(){var G;return X(this,(function(W){switch(W.label){case 0:return G=this.logger.createFnLogger("muteUnmuteSpeaker, isSpeakerMuted=".concat(!!this.isSpeakerMuted),B),this.isJoinedLightweight()?(G.logFailure("Can not mute/unmute speaker in lightweight call"),[2,Promise.reject(60)]):(this.setSpeakerMuted(F,B),this.mediaSession?F?[4,this.mediaSession.muteOutputAsync(B)]:[3,2]:[3,4]);case 1:return W.sent(),[3,4];case 2:return[4,this.mediaSession.unmuteOutputAsync(B)];case 3:W.sent(),W.label=4;case 4:return[2]}}))}))},PluginlessCall.prototype.getParticipant=function(F){return this.participants.filter((function(B){return B.isSameParticipantsMri(F)}))[0]},PluginlessCall.prototype.getOrCreateParticipant=function(F,B){var G=this,W=this.getParticipant(F);return W||((W=new Oe.PluginlessCallParticipant(F,this.mediaSession,this.logger,this.callStats.localStats,this.callTelemetry,this.mediaAgent.getConfigProvider(),this.imageRenderingSession,B,this._enablePluginlessCallParticipantRaiseChangeDeferred,this._enableGlobalDeferHandler)).changed((function(){return G.onParticipantChanged(W)})),this.lwjUris&&this.lwjUris.frameUris&&W.useLightweightStreams(this.lwjUris.frameUris,B),this.participants.push(W),this.event("participantAdded").raise(W),this.monitorCallStart(),W)},PluginlessCall.prototype.onParticipantChanged=function(F){this.event("participantUpdated").raise(F),this.raiseChangedDeferred(this._participantChangedEventSkipConfig)},PluginlessCall.prototype.setCallState=function(F,B,G){if(void 0===G&&(G=0),this.state!==F){var W=this.logger.createFnLogger("setCallState",B);if(W.info("currentState=".concat(this.state,", newState=").concat(F,", terminatedReason=").concat(this.terminatedReason)),Ce.validStateTransitions[this.state].indexOf(F)>=0||(W.logFailure("invalid state transition"),7===F)){if(this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{state:F,reason:G},B),this.state=F,this.callStats.localStats.call.callStateChanged(F),7===F&&(this.terminatedReason=G,!ne.includes(Be,G))){var z=44===this.terminatedReason,K=55===this.terminatedReason,J=56===this.terminatedReason;this.setFailureType(!this.callGotConnected||!this._wasAudioStreamConnected||z||K||J?0:1)}3===F&&(this.callGotConnected=!0,this.callHeldAt=null),this.callIsHeld()&&!this.callHeldAt&&(this.callHeldAt=new Date),W.logSuccess("changed to ".concat(F,", terminatedReason: ").concat(this.terminatedReason,", failureType=").concat(this.failureType)),this.screenSharingControl.callStateChanged(this.state),this.monitorCallStart(),this.event("callStateChanged").raise(),this.updateCapabilities(B),this.raiseChanged()}}},PluginlessCall.prototype.setMediaStream=function(F,B,G){if(F){if(!ne.find(this.localMediaStreams,(function(F){return F.mediaType===G}))){var W=new Ge(B,G);this.logger.info("setMediaStream ".concat(JSON.stringify(W))),this.localMediaStreams.push(W)}}else this.logger.info("setMediaStream removing ".concat(G)),ne.remove(this.localMediaStreams,(function(F){return F.mediaType===G}))},PluginlessCall.prototype.setVideoOn=function(F,B){this.logger.info("[".concat(B,"]videoOn=").concat(F)),this.isVideoOn=F,this.setMediaStream(this.isVideoOn,!0,1),this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_LOCAL_VIDEO,{value:F},B),this.raiseChanged()},PluginlessCall.prototype.setAudioOn=function(F,B){this.logger.info("[".concat(B,"]audioOn=").concat(F)),this.setMediaStream(F,!0,0),this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_LOCAL_AUDIO,{value:F},B)},PluginlessCall.prototype.setScreenSharingOn=function(F,B){this.logger.info("[".concat(B,"]screenSharingOn=").concat(F)),this.isScreenSharingOn=F,this.setMediaStream(this.isScreenSharingOn,this.isScreenSharingOn,2),this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_SCREEN_SHARING,{screenSharingOn:F},B),this.event("userActivityChanged").raise(),this.raiseChanged()},PluginlessCall.prototype.disposeSharingScreenHandle=function(){this.sharedScreenHandle&&(this.unsubscribeFromSharedScreenHandleEvents(),this.sharedScreenHandle.dispose(),this.sharedScreenHandle=null)},PluginlessCall.prototype.setMuted=function(F,B){this._muteState!==F&&(this._muteState=F,this.callTelemetry.recordEvent(oe.CALL_OPERATIONS_INTERNAL.SET_MUTED,{isMuted:F},B),this.logger.info("[".concat(B,"]participantMuteState:").concat(F,", isMuted: ").concat(this.isMuted)),this.updateCapabilities(B),this.raiseChanged())},PluginlessCall.prototype.setSpeakerMuted=function(F,B){this.logger.info("[".concat(B,"]speakerMute=").concat(F,"]")),this.isSpeakerMuted=F,this.raiseChanged()},PluginlessCall.prototype.monitorCallStart=function(){3===this.state&&this.participants.length&&!this.callStartedAt&&(this.callStartedAt=new Date)},PluginlessCall.prototype._removeParticipant=function(F,B,G){void 0===G&&(G=0);var W=this.logger.createFnLogger("removeParticipant",B);W.info("mri=".concat(Pe.scrubSignalingParticipant(F)));var z=ne.remove(this.participants,(function(B){return B.isSameParticipantsMri(F.id)}))[0];z?(z.setState(4,G,B),this.event("participantRemoved").raise(z)):W.logFailure("unable to remove participant ".concat(_e.scrubMriOrOmit(F.id))),this.raiseChanged(this._participantChangedEventSkipConfig)},PluginlessCall.prototype.setIsSomeoneSharing=function(F){var B=this;if(this.isSomeoneSharing===F||this.screenSharingRenegotiationDeferred&&this.callUsesMixer||(this.isSomeoneSharing=F,this.isSomeoneSharing&&this.isScreenSharingOn&&(this.stopScreenSharing(),this.logger.info("sharingStolen: Cleaning up local screenshare because remote screenshare is running"),this.event("sharingStolen").raise())),this.allowScreenSharingControl()){var G=this.localSignalingParticipant.endpointDetails.find((function(F){return B._endpointId===F.endpointId})),W=this.participants.find((function(F){return F.streams[1].some((function(F){return F.isAvailable}))}));this.screenSharingControl.startOrStopControlForViewer(this.isSomeoneSharing,W,G)}},PluginlessCall.prototype.handleOfferedModalities=function(F,B){var G=this.mediaAgent.constants.MEDIA_STATE,W=this.logger.createFnLogger("handleOfferedModalities",B);try{W.info("offeredModalities=".concat((0,pe.safeJsonStringify)(F)))}catch(F){W.logFailure(F)}F.hasOwnProperty("video")||this.mediaStateConfigurationHelper.isSending(1)?F.hasOwnProperty("video")&&!this.mediaStateConfigurationHelper.isSending(1)&&this.mediaStateConfigurationHelper.removeModality(1):this.mediaStateConfigurationHelper.disableModality(1),F.hasOwnProperty("sharing")||this.mediaStateConfigurationHelper.isSending(2)||this.mediaStateConfigurationHelper.disableModality(2),F.sharing!==G.receive||this.mediaStateConfigurationHelper.isSending(2)||this.mediaStateConfigurationHelper.removeModality(2),this.setIsSomeoneSharing(F.sharing===G.receive),this.isSomeoneStreamingVideo=F.video===G.receive||F.video===G.sendReceive},PluginlessCall.prototype.getRenegotiationOfferType=function(F){if(F)if(5===this.state){if("sendrecv"===F.audio)return be.RenegotiationOfferType.Resume}else if(this.modalitiesAreHold(F))return be.RenegotiationOfferType.Hold;return be.RenegotiationOfferType.Undefined},PluginlessCall.prototype.isRenegotiationHoldOrResume=function(F){return this.getRenegotiationOfferType(F)===be.RenegotiationOfferType.Hold||this.getRenegotiationOfferType(F)===be.RenegotiationOfferType.Resume},PluginlessCall.prototype.isValidHoldResumeCallState=function(F){return[3,5,10,13].includes(F)},PluginlessCall.prototype.onNegotiationCompletion=function(F,B,G,W,z){var J=this;void 0===G&&(G={});var Q=this.logger.createFnLogger("onNegotiationCompletion",W);Q.info("byLocal=".concat(B,", result=").concat((0,pe.safeJsonStringify)(F))),this.callTelemetry.recordEvent(oe.MEDIA_EVENT.NEGOTIATION_COMPLETION,K({phaseTelemetryBag:z},this.prepareNegotiationResultForTelemtry(F)),W);var Y=this.isOneToOneCall();if(Y){var $=this.modalitiesAreHold(F.activeModalities)?5:3;this.participants[0].setState($,void 0,W),Q.info("isOneToOneCall: participant[0] state set to ".concat($))}var X,Z=this.modalitiesAreHold(F.configuredModalities),ee=this.modalitiesAreHold(F.activeModalities),te=this._enableStaging&&this.signalingSession.participantManager.localParticipant.isStaging;Q.info("isStaging= ".concat(te)),this.requestedHoldState?(Z&&ee||Q.info("Not expected modalities when processing local hold: ".concat(Z," ").concat(ee)),4!==this.state&&Q.info("Not expected state when processing local hold: ".concat(this.state,", switching back to LocalHold"))):B||this.callHoldResumeDeferred?!Z&&ee?X=5:Z||ee||this._callInLobby||this.isPreheatedOnly()||(X=te?13:3):4===this.state||this._callInLobby||this.isPreheatedOnly()||(X=Y&&5===this.participants[0].state?5:te?13:3),X&&this.setCallState(X,W),this.callHoldResumeDeferred&&(Q.info("isHoldInProgress=".concat(this.isHoldInProgress,", state=").concat(this.state)),this.isHoldInProgress?this.finishCallHoldResume():this.inLocalHold()||this.finishCallHoldResume(this.isValidHoldResumeCallState(X)?void 0:new Error("Call state changed to ".concat(X," instead of Connected, Lobby, Staging or RemoteHold")))),this.requestedHoldState||(this.setIsSomeoneSharing(ne.some(this.participants,(function(F){return ne.some(F.streams[1],(function(F){return F.isAvailable}))}))),this.isSomeoneStreamingVideo=ne.some(this.participants,(function(F){return ne.some(F.streams[0],(function(F){return F.isAvailable}))})));var ie=G&&G.sharing===this.mediaAgent.constants.MEDIA_STATE.send,re=F&&F.activeModalities&&F.activeModalities.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(this.screenSharingRenegotiationDeferred&&ie&&re&&(this.screenSharingRenegotiationDeferred.resolve(),this.screenSharingRenegotiationDeferred=null),this.retryOutgoingRenegotiation.retry){var ae=this.retryOutgoingRenegotiation.causeId;this._callOperationHandler.executeChained((function(){return J.updateMediaModalities(void 0,ae)}),oe.CALL_OPERATIONS_INTERNAL.RENEGOTIATE,ae,ae,void 0,void 0,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),this.retryOutgoingRenegotiation.retry=!1}},PluginlessCall.prototype.updateMediaStatus=function(F){return $(this,void 0,void 0,(function(){var B;return X(this,(function(G){switch(G.label){case 0:return this.calculateIsSomeoneStreaming(F),this.mediaSession?[4,this.updateMediaModalities(void 0,F)]:[3,2];case 1:B=G.sent(),this.callTelemetry.updateOperationData(oe.CALL_OPERATIONS_INTERNAL.UPDATE_LOCAL_MEDIA_STATUS,B,F),G.label=2;case 2:return[2]}}))}))},PluginlessCall.prototype.calculateIsSomeoneStreaming=function(F){return $(this,void 0,void 0,(function(){var F,B,G,W,z,K,J;return X(this,(function(Q){F=!1,B=!1;try{for(G=Z(this.participants),W=G.next();!W.done&&(z=W.value,F||(F=ne.some(z.streams[1],(function(F){return F.isAvailable}))),B||(B=ne.some(z.streams[0],(function(F){return F.isAvailable}))),!F||!B);W=G.next());}catch(F){K={error:F}}finally{try{W&&!W.done&&(J=G.return)&&J.call(G)}finally{if(K)throw K.error}}return this.setIsSomeoneSharing(F),this.isSomeoneStreamingVideo=B,[2]}))}))},PluginlessCall.prototype.onNegotiationFailure=function(F,B,G,W){var z=W&&W.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(B===this.mediaAgent.constants.RENEGOTIATION_ERROR.glare)return this.screenSharingRenegotiationDeferred&&z&&this.callStats.localStats.screenShare.negotiationStateChanged("rejected","glare"),void(this.retryOutgoingRenegotiation={retry:!0,causeId:G});var K=new Error("Error in renegotiateOutgoing() -> rejecting hold for callId = ".concat(this.callId,", reason=").concat(B));K.innerError=F,this.finishCallHoldResume(K),this.screenSharingRenegotiationDeferred&&z&&(this.screenSharingRenegotiationDeferred.reject(F),this.screenSharingRenegotiationDeferred=null)},PluginlessCall.getParticipantReasonFromTerminatedReason=function(F){switch(F){case 1:return 0;case 9:return 2;case 10:return 3;case 2:return 4;case 24:return 8;case 3:return 9;case 4:return 10;case 14:return 12;case 0:default:return 11;case 15:return 13;case 16:return 14;case 17:return 15;case 18:return 16;case 19:return 17;case 20:return 18;case 11:return 19;case 21:return 20;case 22:return 21;case 23:return 22;case 33:return 25;case 36:return 26;case 37:return 27;case 41:return 30;case 39:return 28;case 42:return 31;case 40:return 29;case 43:return 32;case 44:return 33;case 45:return 34;case 46:return 35;case 47:return 36;case 48:return 37;case 49:return 38;case 50:return 39;case 51:return 40;case 52:return 41;case 54:return 42;case 55:return 44;case 56:return 45;case 12:return 23;case 59:return 46;case 73:return 59;case 61:return 47;case 60:return 48;case 62:return 49;case 63:return 50;case 64:return 5;case 65:return 51;case 8:return 52}},PluginlessCall.prototype.isRemoteParticipantInStaging=function(F){var B,G;if(!F.endpointDetails)return!1;try{for(var W=Z(F.endpointDetails),z=W.next();!z.done;z=W.next()){var K=z.value;if(!(0,ye.hasStagingGroup)(K))return!1}}catch(F){B={error:F}}finally{try{z&&!z.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}return!0},PluginlessCall.prototype.updateCallParticipantFromSignalingParticipant=function(F,B,G){if(ne.every(B.endpointDetails,(function(F){return(null==F?void 0:F.isLobby)||(null==F?void 0:F.streamLobby)})))F.setState(7,void 0,G);else{var W=ne.some(B.endpointDetails,(function(F){return null==F?void 0:F.streamInformation})),z=B.endpointDetails&&ne.some(B.endpointDetails,(function(F){return F.mappedTo})),K=PluginlessCall.filterVirtualEndpoints(B.endpointDetails),J=K&&K[0].mediaStreams,Q=B.endpointDetails&&B.endpointDetails[0].lwjSessionInformation,Y=this._enableStaging&&this.isRemoteParticipantInStaging(B);if(J&&J.length>0){var $=J.every((function(F){return"inactive"===F.direction})),X=$?5:Y?8:3;1!==this.state||$||this.callUsesMixer||(X=2),this.logger.info("[updateCallParticipantFromSignalingParticipant]: with mediaStreams is not empty, ParticipantState is set to ".concat(X)),F.setState(X,void 0,G)}else if(J||Q||z||W){X=Y?8:3;this.logger.info("[updateCallParticipantFromSignalingParticipant]: ParticipantState is set to ".concat(X,", mediaStreams=").concat(!!J,", lwj=").concat(!!Q,", hasMappedEndpoints=").concat(z,", hasPlayerStreams=").concat(W)),F.setState(X,void 0,G)}}},PluginlessCall.prototype.handleSelfServerMutedState=function(F){var B,G=this,W=PluginlessCall.filterVirtualEndpoints(this.localSignalingParticipant.endpointDetails),z=ne.find(W,(function(F){return G._endpointId===F.endpointId})),K=z&&z.mediaStreams,J=K&&K.filter((function(F){return"audio"===F.type||"audio-teleconferencing"===F.type})),Q=z&&(z.stream||z.streamLobby);if(Q){var Y=null!==(B=Q.serverMuted)&&void 0!==B&&B;z.serverMuteVersion=0,Y!==this.isServerMuted&&(this.isServerMuted=Y,this.callTelemetry.recordEvent(oe.PARTICIPANT_OPERATIONS_INTERNAL.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted}),this.logger.info("updateLocalParticipant: server muted set to ".concat(Y)),this.event("serverMutedChanged").raise(Y),this.updateCapabilities(F,!0),this.isServerMuted&&this.setMuted(be.ParticipantMuteState.ServerMuted,F))}else if(J&&J.length>0){var $=J.some((function(F){return F.serverMuted}));$!==this.isServerMuted&&(this.isServerMuted=$,this.callTelemetry.recordEvent(oe.PARTICIPANT_OPERATIONS_INTERNAL.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted}),this.logger.info("updateLocalParticipant: server muted set to ".concat($)),this.event("serverMutedChanged").raise($),this.updateCapabilities(F,!0),this.handleServerMutedState(F))}},PluginlessCall.prototype.checkIfIncomingServerMutedIsUpdated=function(F){var B=this,G=ne.find(this.localSignalingParticipant.endpointDetails,(function(F){return F.participantId===B.localSignalingParticipant.participantId}));if(void 0!==G){var W=ne.find(F.endpointDetails,(function(F){return F.participantId===B.localSignalingParticipant.participantId}));Re.handleServerMutedVersion(this.logger,G,W)}},PluginlessCall.prototype.convertWiredPublishedState=function(F){if(F){var B=this.getPluginlessStateTypeFromWire(F.stateType);return{content:F.content,stateType:B,typeRank:F.typeRank,stateId:F.stateId}}},PluginlessCall.prototype.updatePublishedStateModified=function(F,B){F!==this.currentUserSkypeIdentity.id||B&&B!==this.participantId?this._publishedStatesModified=this._publishedStatesModified|Ve.Other:this._publishedStatesModified=this._publishedStatesModified|Ve.Self},PluginlessCall.prototype.updatePublishedStates=function(F){var B=this;try{var G=[];ne.forEach(F.publishedStates,(function(F){G.push(B.convertWiredPublishedState(F))})),ne.isEqual(this._participantPublishedStatesMap[F.id],G)||(0!==G.length||void 0!==this._participantPublishedStatesMap[F.id]&&null!==this._participantPublishedStatesMap[F.id])&&(this._participantPublishedStatesMap[F.id]=G,this.updatePublishedStateModified(F.id));var W=[];ne.forEach(F.endpointDetails,(function(z){W.push(z.participantId),G=[],ne.forEach(z.publishedStates,(function(W){var K=B.convertWiredPublishedState(W);B._endpointPublishedStatesMap[F.id]||(B._endpointPublishedStatesMap[F.id]={},B._endpointPublishedStatesMap[F.id][z.participantId]=[]),G.push(K)})),B._endpointPublishedStatesMap[F.id]&&!ne.isEqual(B._endpointPublishedStatesMap[F.id][z.participantId],G)&&(0!==G.length||null!==B._endpointPublishedStatesMap[F.id][z.participantId]&&void 0!==B._endpointPublishedStatesMap[F.id][z.participantId])&&(B._endpointPublishedStatesMap[F.id][z.participantId]=G,B.updatePublishedStateModified(F.id,z.participantId))})),this._endpointPublishedStatesMap[F.id]&&Object.keys(this._endpointPublishedStatesMap[F.id]).forEach((function(G){W.some((function(F){return F===G}))||(delete B._endpointPublishedStatesMap[F.id][G],B.updatePublishedStateModified(F.id,G))}))}catch(F){this.logger.error("updatePublishedStates ".concat(JSON.stringify(F)))}this.logger.info("updatePublishedStates ".concat(JSON.stringify(this._participantPublishedStatesMap))),this.logger.info("updatePublishedStates ".concat(JSON.stringify(this._endpointPublishedStatesMap)))},PluginlessCall.prototype.removePublishedStatesByParticipant=function(F){this._endpointPublishedStatesMap[F]&&delete this._endpointPublishedStatesMap[F],this._participantPublishedStatesMap[F]&&delete this._participantPublishedStatesMap[F],this.updatePublishedStateModified(F)},PluginlessCall.prototype.findOrCreateTypeState=function(F){var B=this._publishedStates.typeStates.findIndex((function(B){return B.type===F}));if(-1===B){var G={participantStates:[],type:F};this._publishedStates.typeStates.push(G),B=this._publishedStates.typeStates.length-1}return B},PluginlessCall.prototype.processPublishedStates=function(){var F,B,G,W,z=this;this.logger.info("processPublishedStates ".concat(JSON.stringify(this._participantPublishedStatesMap))),this.logger.info("processPublishedStates ".concat(JSON.stringify(this._endpointPublishedStatesMap)));try{this._publishedStates||(this._publishedStates={typeStates:[]}),this._publishedStates.typeStates=[];var _loop_4=function(F){var B=K._participantPublishedStatesMap[F];ne.forEach(B,(function(B){var G=z.findOrCreateTypeState(B.stateType),W={id:F,publishedState:{content:B.content,stateId:B.stateId,typeRank:B.typeRank}};z._publishedStates.typeStates[G].participantStates.push(W)}))},K=this;try{for(var J=Z(Object.keys(this._participantPublishedStatesMap)),Q=J.next();!Q.done;Q=J.next()){_loop_4(Q.value)}}catch(B){F={error:B}}finally{try{Q&&!Q.done&&(B=J.return)&&B.call(J)}finally{if(F)throw F.error}}var _loop_5=function(F){var B,G,_loop_6=function(B){Y._endpointPublishedStatesMap[F][B].forEach((function(G){var W=z.findOrCreateTypeState(G.stateType),K={id:B,publishedState:{content:G.content,stateId:G.stateId,typeRank:G.typeRank}},J={id:F,endpoints:[K]},Q=z._publishedStates.typeStates[W].participantStates.filter((function(B){return B.id===F}));Q&&Q.length>0?(Q[0].endpoints||(Q[0].endpoints=[]),Q[0].endpoints.push(K)):z._publishedStates.typeStates[W].participantStates.push(J)}))};try{for(var W=(B=void 0,Z(Object.keys(Y._endpointPublishedStatesMap[F]))),K=W.next();!K.done;K=W.next()){_loop_6(K.value)}}catch(F){B={error:F}}finally{try{K&&!K.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}},Y=this;try{for(var $=Z(Object.keys(this._endpointPublishedStatesMap)),X=$.next();!X.done;X=$.next()){_loop_5(X.value)}}catch(F){G={error:F}}finally{try{X&&!X.done&&(W=$.return)&&W.call($)}finally{if(G)throw G.error}}this.event("publishedStatesChanged").raise(this._publishedStates),this.raiseChanged()}catch(F){this.logger.error("processPublishedStates ".concat(F,"}"))}},PluginlessCall.prototype.updateLocalParticipant=function(F,B){var G=this,W=this.logger.createFnLogger("updateLocalParticipant",B);this.checkIfIncomingServerMutedIsUpdated(F),this.localSignalingParticipant.endpointDetails=F.endpointDetails,this.localSignalingParticipant.role=F.role,this.setMeetingRole(F.meetingRole),this.setAdvancedMeetingRole(F.advancedMeetingRole),this.localSignalingParticipant.tenantId=F.tenantId,this.localSignalingParticipant.isLobby=F.isLobby,this.callTelemetry.setTenantId(F.tenantId),this.callStats.setTenantId(F.tenantId);var z=this.localSignalingParticipant.isLobby;F.endpointDetails&&this.updateLocalParticipantEndpoints(F.endpointDetails),this.updatePublishedStates(F),this.handleSelfServerMutedState(B);var K=this.getLocalSignalingEndpointDetails();this._callInLobby=z||!!(null==K?void 0:K.streamLobby),this.signalingSession.participantManager.localParticipant.isStaging=F.isStaging;var J=this._enableStaging&&this.signalingSession.participantManager.localParticipant.isStaging;W.info("callInLobby = ".concat(z,", callSetupComplete = ").concat(this._callIsSetupComplete,", callIsHeld = ").concat(this.callIsHeld(),", isStaging = ").concat(J)),!this._callIsSetupComplete||this.callIsHeld()||Ce.callStateIsAnyOf(this.state,[11,12])||(z?this.setCallState(10,B):J&&Ce.callStateIsAnyOf(this.state,[3,13,10,9,2])?this.setCallState(13,B):this.setCallState(3,B));var Q=PluginlessCall.getStreamsFromEndpoints(F.endpointDetails);if(this.callTelemetry.recordEvent(oe.PARTICIPANT_OPERATIONS_INTERNAL.UPDATE_LOCAL_PARTICIPANT_STREAM,(0,xe.getStreamInformation)(Q),B),this.streamManager.updateStreams(Q,B),this.updateCapabilities(B,!0),this.allowScreenSharingControl()){var Y=F.endpointDetails.find((function(F){return G._endpointId===F.endpointId})),$=this.participants.find((function(F){return F.streams[1].some((function(F){return F.isAvailable}))}));this.screenSharingControl.startOrStopControlForViewer(this.isSomeoneSharing,$,Y)}},PluginlessCall.prototype.modalitiesAreHold=function(F){return!(F.audio&&"inactive"!==F.audio||F.video&&"inactive"!==F.video||F.sharing&&"inactive"!==F.sharing)},PluginlessCall.prototype.toneToString=function(F){switch(F){case 0:return"0";case 1:return"1";case 2:return"2";case 3:return"3";case 4:return"4";case 5:return"5";case 6:return"6";case 7:return"7";case 8:return"8";case 9:return"9";case 10:return"*";case 11:return"#";default:return null}},PluginlessCall.streamingStatetoMediaStreamState=function(F){switch(F){case"started":return 0;case"active":return 2;case"inactive":return 1;case"stopped":return 3;default:return 4}},PluginlessCall.streamingDirectionToMediaDirectionMapping=function(F){switch(F){case"send":return 1;case"receive":return 0;default:return}},PluginlessCall.convertMuteScope=function(F){switch(F){case 0:return"EveryoneElse";case 1:return"SpecifiedParticipants";default:return}},PluginlessCall.prototype.callIsHeld=function(){return 4===this.state||5===this.state},PluginlessCall.prototype.inLocalHold=function(){return this.isHoldInProgress||4===this.state},PluginlessCall.prototype.isJoinedLightweight=function(){var F=this,B=ne.find(this.endpoints.endpointDetails,(function(B){return F.participantId===B.participantId})),G=B&&B.lwjSessionInformation;return!!this.lwjUris||!!G},PluginlessCall.prototype.telemetryDataFromCallStartOptions=function(F){var B={};return F.muteFlags&&(B.muteMicrophone=!!(1&F.muteFlags),B.muteSpeaker=!!(2&F.muteFlags)),Object.keys(B).length?B:void 0},PluginlessCall.prototype.reconnect=function(){var F=(0,se.generateCauseId)();return this.mediaSession.reconnectAsync(F)},PluginlessCall.prototype.provideCallQualityFeedback=function(F,B,G,W){return $(this,void 0,void 0,(function(){return X(this,(function(F){return[2]}))}))},PluginlessCall.prototype.showCQFInfo=function(F,B){return $(this,void 0,void 0,(function(){return X(this,(function(F){throw new Error("Not implemented")}))}))},PluginlessCall.prototype.isCqfRendered=function(F){return $(this,void 0,void 0,(function(){return X(this,(function(F){return[2]}))}))},PluginlessCall.prototype.provideCallQualityFeedbackEx=function(F,B,G,W,z,K){return $(this,void 0,void 0,(function(){return X(this,(function(F){return[2]}))}))},PluginlessCall.prototype.testTriggerMediaRelayWhiteListingIssue=function(){this.logger.info("Simulating media relay whitelisting issue for test purposes");var F=this.mediaSession.mediaSession.callback,B={type:"NetworkRelaysNotReachable",value:"Bad",isLocalSource:!0,mediaType:"Audio"};F.onQualityChanged(B);var G={direction:"send",stream:"failed",content:"audio"};F.onAudioStateChanged(G)},PluginlessCall.prototype.getMediaTelemetry=function(F){return void 0===F&&(F=!1),$(this,void 0,void 0,(function(){var B,G;return X(this,(function(W){switch(W.label){case 0:return this.mediaSession?(G=(B=this.callStats).setMediaStats,[4,this.mediaSession.getStatsAsync(F)]):[3,2];case 1:G.apply(B,[W.sent()]),this.appendInfoToCallStats(),W.label=2;case 2:return[2,this.callStats.buildMediaTelemetry()]}}))}))},PluginlessCall.prototype.getMediaSessionStats=function(){var F;return null===(F=this.mediaSession)||void 0===F?void 0:F.getMediaStatsReport()},PluginlessCall.prototype.appendInfoToCallStats=function(){var F,B;this.callStats.appendDataChannelInfo(this.dataChannel.getTelemetry()),this.callStats.appendSharingControlInfo(null===(F=this.screenSharingControl)||void 0===F?void 0:F.isScreenSharingControlEnabled()),this.callStats.appendMediaControlPaneInfo(JSON.stringify(this.mediaControlPlane.getTelemetryReport())),this.callStats.appendPictureInPictureInfo(null===(B=this.pipManager)||void 0===B?void 0:B.getReport())},PluginlessCall.prototype.getMediaLogs=function(){return this.mediaAgent.getMediaLogs()},PluginlessCall.prototype.testSetCallState=function(F){this.logger.info("Overwriting call state for test purposes: ".concat(this.state," -> ").concat(F," ")),this.state=F},PluginlessCall.prototype.testSetCallType=function(F){this.logger.info("Overwriting call state for test purposes: ".concat(this.callType," -> ").concat(F," ")),this.callType=F},PluginlessCall.prototype.addGroupModality=function(F,B){void 0===B&&(B=(0,se.generateCauseId)());var G,W=this.logger.createFnLogger(oe.CALL_OPERATIONS.ADD_GROUP_MODALITY,B);if(!F.threadId&&!F.groupId)return Promise.reject((0,le.getRejectTransactionEnd)("No threadId/groupId was provided."));if(6===this.state||7===this.state)return W.info("Not adding modality because CallState is ".concat(this.state," groupId=").concat(_e.scrubMriOrOmit(F.groupId),", threadId = ").concat(_e.getLoggableThreadId(F.threadId)," messageId = ").concat(F.messageId)),Promise.reject((0,le.getRejectTransactionEnd)(oe.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED));if(F.additionalData)try{G=JSON.stringify(F.additionalData)}catch(B){W.logFailure("additionalData: ".concat(F.additionalData," is not valid Json, error: ").concat(B));var z={code:be.jsCallEndCodes.BadRequest,subCode:0,phrase:"additionalData is not valid Json, error: ".concat(B)};return Promise.reject(z)}W.info("groupId=".concat(_e.scrubMriOrOmit(F.groupId),", threadId = ").concat(_e.getLoggableThreadId(F.threadId)," messageId = ").concat(F.messageId," additionalData = ").concat(_e.scrubMriOrOmit(G)));var K={groupId:F.groupId,threadId:F.threadId,messageId:F.messageId,additionalData:G};return this.signalingSession.addGroupModalityAsync(K,B).catch((function(F){return W.logFailure((0,pe.getPrintableObject)(F)),Promise.reject(F)}))},PluginlessCall.prototype.addBroadcastModality=function(F,B){var G=this,W=this.logger.createFnLogger(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,B);return Promise.resolve().then((function(){G.signalingSession.addBroadcastModalityAsync(F,B)})).catch((function(F){return W.logFailure((0,pe.getPrintableObject)(F)),Promise.reject((0,le.getRejectTransactionEnd)(F))})).then((function(){return G._callOperationHandler.waitForOperation(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)})).catch((function(F){throw G.callTelemetry.updateOperationData(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,{error:(0,pe.getPIISafeObject)(F)},B),W.logFailure(F),F}))},PluginlessCall.convertQualityEventType=function(F){switch(F){case"NetworkSendQuality":return 1;case"NetworkRecvQuality":return 2;case"NetworkDelay":return 3;case"NetworkBandwidthLow":return 4;case"NetworkReconnect":return 5;case"NetworkPacketLoss":return 6;case"NetworkJitter":return 7;case"NetworkRateMatching":return 8;case"DeviceCaptureNotFunctioning":return 9;case"DeviceRenderNotFunctioning":return 10;case"DeviceRenderGlitches":return 11;case"DeviceLowSNR":return 12;case"DeviceLowSpeechLevel":return 13;case"DeviceClipping":return 14;case"DeviceEcho":return 15;case"DeviceNearEndToEchoRatio":return 16;case"DeviceHalfDuplexAec":return 17;case"DeviceMultipleEndpoints":return 18;case"DeviceHowling":return 19;case"DeviceRenderZeroVolume":return 20;case"DeviceRenderMute":return 21;case"NetworkSendCatastrophic":return 22;case"NetworkRecvCatastrophic":return 23;case"CpuInsufficient":return 24;case"DeviceCaptureMute":return 25;case"DeviceCaptureNotMuteButSilent":return 26;case"DeviceSpeakWhileMuted":return 27;case"VideoVbssRendered":return 28;case"NetworkEthernetInterfaceUsed":return 29;case"NetworkWlanInterfaceUsed":return 30;case"NetworkWwanInterfaceUsed":return 31;case"NetworkRelaysNotReachable":return 32;case"VideoCapturerDeviceStartFailed":return 33;case"VideoCapturerDeviceStartTimedOut":return 34;case"VideoCapturerDeviceStartFailureLackSystemRes":return 35;case"VideoCapturerDeviceStartFailureMFResConflict":return 36;case"NoNetwork":return 37;case"NetworkNotWorking":return 38;case"DeviceCaptureNotFunctioningDeviceInUse":return 39;case"DeviceRenderNotFunctioningDeviceInUse":return 40;case"VideoCaptureDeviceFreeze":return 45;case"ZeroCaptureDevicesEnumerated":return 43;case"ZeroRenderDevicesEnumerated":return 44;case"VideoCapturePermissionDenied":return 47;case"ScreenshareRecordingDisabled":return 55;case"AudioCapturePermissionDenied":return 46;case"VideoCaptureFreezeRecovered":return 48;case"DeviceRenderHowling":return 49;case"PresentationAudioLoopbackDeviceState":return 53;case"RemoteNetworkConnectivityIssue":return 52;case"AudioCaptureUltrasoundDetected":return 54;case"MusicModeNotAvailable":return 57;case"CameraLighting":return 61;case"ImageRenderingQuality":return 51;case"AudioLoopbackDeviceReady":return 63;case"NoRequiredVideoCodecs":return 64;default:return}},PluginlessCall.convertQualityLevel=function(F){switch(F){case"Unknown":return 0;case"Good":return 1;case"Poor":return 2;case"Bad":return 3;default:return}},PluginlessCall.convertMediaType=function(F){switch(F){case"Audio":return 0;case"Video":return 1;case"ScreenShare":return 2;case"Data":return 3;default:return}},PluginlessCall.prototype.getPluginlessPublishLevel=function(F){switch(F){case"user":return"user";case"endpoint":return"endpoint";default:throw"Invalid level type."}},PluginlessCall.prototype.getPluginlessStateType=function(F){switch(F){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"attendeeVideoUnrestricted":return"attendeeVideoUnrestricted";case"spotlight":return"spotlight";case"weatherPerson":return"weatherPerson";case"sharingLayoutType":return"sharingLayoutType";case"manageBreakoutRooms":return"manageBreakoutRooms";case"togetherMode":return"togetherMode";default:throw"Invalid state type when converting PublishStateType to PublishType."}},PluginlessCall.prototype.getPluginlessStateTypeFromWire=function(F){switch(F){case"raiseHands":return"raiseHands";case"ufd":return"ufd";case"attendeeModalitiesUnrestricted":return"attendeeModalitiesUnrestricted";case"attendeeAudioRestricted":return"attendeeAudioRestricted";case"attendeeVideoRestricted":return"attendeeVideoRestricted";case"attendeeVideoUnrestricted":return"attendeeVideoUnrestricted";case"spotlight":return"spotlight";case"weatherPerson":return"weatherPerson";case"sharingLayoutType":return"sharingLayoutType";case"manageBreakoutRooms":return"manageBreakoutRooms";case"togetherMode":return"togetherMode";default:throw"Invalid state type when converting PublishType to PublishStateType."}},PluginlessCall.prototype.setIsEmergency=function(F){this.logger.info("Set isEmergency:".concat(F)),this.isEmergency=F,this.callTelemetry.setIsEmergency(F)},PluginlessCall.filterVirtualEndpoints=function(F){return F&&ne.filter(F,(function(F){return!F.mappedTo}))},PluginlessCall.prototype.mapDataChannelSourceIdToParticipant=function(F){var B=null;return(B=1===this.callType?this.participants[0]:ne.find(this.participants,(function(B){return B.hasSourceId(3,F)})))&&B.id?this.logger.info("ParticipantId: ".concat(_e.scrubMriOrOmit(B.id)," to SourceId: ").concat(F)):this.logger.warn("No Participant found for SourceId: ".concat(F)),B},PluginlessCall.prototype.getDataChannelSourceId=function(){var F=this,B=ne.find(this.endpoints.endpointDetails,(function(B){return null!==B&&B.participantId===F._participantId}));if(!B)return this.logger.warn("No participantLeg found for participantId: ".concat(this._participantId)),-1;if(!B.mediaStreams)return this.logger.warn("ParticipantLeg ".concat(this._participantId," does not have valid mediaStreams")),-1;var G=ne.find(B.mediaStreams,(function(F){return 3===he.mapMediaTypeStringToMediaType(F.type)}));return G?G.sourceId:(this.logger.warn("participantLeg ".concat(this._participantId," has no data channel")),-1)},PluginlessCall.prototype.initializeMediaControlPlane=function(){var F=this;this.mediaControlPlane=new Ie.MediaControlPlane(this.dataChannel,this.logger.createChild("MCP"),this.mediaAgent.getConfigProvider().config.mediaControlPlaneConfig),this.mediaControlPlane.on("mpSendBandwidthChanged",(function(B){var G,W=null===(G=F.mediaSession)||void 0===G?void 0:G.getExtensionsManager();null==W||W.processNotification("BandwithNotification",{bw:B})})),this.mediaControlPlane.on("mpDshStatusChanged",(function(B){F.signalingSession.updateDominantSpeakerHistoryMessageSubscription(!B,!0)}))},J([(0,me.callOperation)(oe.CALL_OPERATIONS.INITIALIZE,{type:me.OPERATION_TYPE.SYNC,convertError:!0,idempotencyLevel:me.IDEMPOTENCY_LEVEL.NO_OP}),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",void 0)],PluginlessCall.prototype,"init",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_VIDEO,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startVideo",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.STOP_VIDEO,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"stopVideo",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],PluginlessCall.prototype,"dumpVideoSourceImages",null),J([Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object,Object,Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"hold",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.HOLD,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"holdWithRenegotiate",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.LOCAL_HOLD,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object,Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"localHold",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UNHOLD,{waitFor:[oe.CALL_OPERATIONS.HOLD,oe.CALL_OPERATIONS.LOCAL_HOLD],preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"unhold",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"updateEndpointMetadata",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SEND_DTMF_TONE,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Q("design:type",Function),Q("design:paramtypes",[Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"sendDtmfTone",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SET_AUDIO_USAGE),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"setAudioUsageMode",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG),Q("design:type",Function),Q("design:paramtypes",[String,Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"setAudioMidcallConfig",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG_JSON,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"setAudioMidcallConfigJson",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0,type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"callBlindTransfer",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0,type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"callSafeTransfer",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.TRANSFER_TO_VOICEMAIL,{singular:!0,type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"transferCallToVoicemail",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0,type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object,String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"callConsultativeTransfer",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,{singular:!0,type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Q("design:type",Function),Q("design:paramtypes",[String,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"consultativeTransferWithPickupCode",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.CALL_REDIRECT,{singular:!0,type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"callRedirect",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.PARK_CALL,{type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Number,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"park",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UNPARK_CALL,{type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Number,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"unpark",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.GET_TECHNICAL_INFORMATION_JSON,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],PluginlessCall.prototype,"getTechnicalInformationJson",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_SCREEN_SHARING,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(3,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object,String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startScreenSharing",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.STOP_SCREEN_SHARING,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Boolean,String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"stopScreenSharing",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_DATA_CHANNEL,{type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startDataChannel",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.STOP_DATA_CHANNEL,{type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"stopDataChannel",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Q("design:type",Function),Q("design:paramtypes",[Boolean]),Q("design:returntype",Promise)],PluginlessCall.prototype,"shareSystemSound",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.MUTE,{waitFor:oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"mute",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UNMUTE,{waitFor:[oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL,oe.CALL_OPERATIONS_INTERNAL.PROMOTION_TO_REALTIME]}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"unmute",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.MUTE_SPEAKER,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"muteSpeaker",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UNMUTE_SPEAKER,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"unmuteSpeaker",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.MUTE_PARTICIPANTS),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Number,Array,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"muteParticipants",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_AUDIO,{type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startAudio",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.STOP_AUDIO,{type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"stopAudio",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.ASSIMILATE),Y(3,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,String,String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"assimilate",null),J([Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"merge",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.MERGE_PARTICIPANTS),Y(1,me.operationId),Y(3,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Array,Object,String,Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"mergeParticipants",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE),Y(0,me.operationId),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object,Object,Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"mergeWithPickupCode",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS),Q("design:type",Function),Q("design:paramtypes",[Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"setMaxVideoChannels",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.STOP_CALL),Y(1,me.causeId),Y(3,me.reason),Q("design:type",Function),Q("design:paramtypes",[Object,Object,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"stop",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.PUBLISH_STATE),Y(1,me.operationId),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"publishState",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.PUBLISH_STATE),Y(1,me.operationId),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"publishStatesForEveryone",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.REMOVE_STATE),Y(1,me.operationId),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"removeState",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.REMOVE_STATE),Y(1,me.operationId),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"removeStatesForEveryone",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS),Y(1,me.operationId),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"updateMeetingSettings",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UPDATE_MEETING_GROUPS),Y(0,me.operationId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"updateMeetingGroups",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE),Y(0,me.operationId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"updateMeetingLiveState",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE),Y(0,me.operationId),Q("design:type",Function),Q("design:paramtypes",[String,Array]),Q("design:returntype",Promise)],PluginlessCall.prototype,"updateParticipantInterpretationState",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.JOIN_MEETING_GROUP),Y(0,me.operationId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"joinMeetingGroup",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.LEAVE_MEETING_GROUP),Y(0,me.operationId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"leaveMeetingGroup",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SEND_MESSAGES),Y(0,me.operationId),Q("design:type",Function),Q("design:paramtypes",[String,Array]),Q("design:returntype",Promise)],PluginlessCall.prototype,"sendMessages",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.UPDATE_MEETING_ROLE),Q("design:type",Function),Q("design:paramtypes",[Array,String,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"updateMeetingRoles",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.CREATE_CONTENT_SHARING_SESSION),Y(4,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,String,String,String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"createContentSharingSession",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.STOP_CALL_WITH_BEACON,{type:me.OPERATION_TYPE.SYNC}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Boolean)],PluginlessCall.prototype,"stopWithBeacon",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.ACKNOWLEDGE,{type:me.OPERATION_TYPE.CHAINED,convertError:!0,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"acknowledge",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.ACCEPT,{type:me.OPERATION_TYPE.CHAINED,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"accept",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.REJECT,{preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(0,me.causeId),Y(1,me.reason),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"reject",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.JOIN_CALL,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Y(1,me.callStartOptions),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"join",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{waitFor:oe.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED}),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"joinPreheatedCall",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_CALL,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Y(0,me.callStartOptions),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"start",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startCallToVoicemail",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SUBSCRIBE,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"joinCallWithoutCallModality",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_WITH_MEETING_DATA,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startWithMeetingData",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Q("design:type",Function),Q("design:paramtypes",[String,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"joinWithMeetingData",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Q("design:type",Function),Q("design:paramtypes",[String,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"subscribeWithMeetingData",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR}),Y(1,me.callStartOptions),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Array,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startCallWithNudge",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:me.OPERATION_TYPE.CHAINED,idempotencyLevel:me.IDEMPOTENCY_LEVEL.ERROR,preconditionTags:[oe.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),Y(2,me.callStartOptions),Y(3,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Number,String,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"startAndUnpark",null),J([(0,me.participantOperation)(oe.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),Y(0,me.operationId),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"admitParticipant",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.ADMIT),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"admit",null),J([(0,me.participantOperation)(oe.PARTICIPANT_OPERATIONS.CALL_ME_BACK),Y(0,me.operationId),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,String,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"callMeBack",null),J([Y(0,me.operationId),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"addParticipant",null),J([(0,me.participantOperation)(oe.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS),Y(0,me.operationId),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Array,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"addParticipants",null),J([Y(0,me.operationId),Y(2,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Array,Object,Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"addParticipantsImpl",null),J([(0,me.participantOperation)(oe.CALL_OPERATIONS.NUDGE_PARTICIPANTS),Y(0,me.operationId),Y(3,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Array,Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"nudgeParticipants",null),J([(0,me.participantOperation)(oe.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),Y(0,me.operationId),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String,Object,String,Number]),Q("design:returntype",Promise)],PluginlessCall.prototype,"removeParticipant",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.SEARCH_PARTICIPANTS),Y(1,me.operationId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"searchParticipants",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.GET_ALL_PARTICIPANTS),Y(1,me.operationId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"getAllParticipants",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.LWJ_FALLBACK),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Number,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"reconnectAsLwj",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS_INTERNAL.PROMOTION_TO_REALTIME),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Number,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"promoteToRealtime",null),J([Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"turnOffLocalVideoPreview",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS_INTERNAL.START_PREVIEW_VIDEO),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"turnOnLocalVideoPreview",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS_INTERNAL.UPDATE_LOCAL_MEDIA_STATUS,{type:me.OPERATION_TYPE.CHAINED}),Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"updateMediaStatus",null),J([Y(0,me.causeId),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"calculateIsSomeoneStreaming",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS_INTERNAL.RECONNECT),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],PluginlessCall.prototype,"reconnect",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.ADD_GROUP_MODALITY),Y(1,me.causeId),Q("design:type",Function),Q("design:paramtypes",[Object,Object]),Q("design:returntype",Promise)],PluginlessCall.prototype,"addGroupModality",null),J([(0,me.callOperation)(oe.CALL_OPERATIONS.ADD_BROADCAST_MODALITY),Q("design:type",Function),Q("design:paramtypes",[Object,String]),Q("design:returntype",Promise)],PluginlessCall.prototype,"addBroadcastModality",null),PluginlessCall}(fe.default);B.default=We},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.createParticipant=B.SkypeConCoreTelemetryManager=B.SignalingAgent=B.setDefaultsForSignalingConfig=B.IncomingNotificationMessageHandler=B.TM_CONSTANTS=B.CA_CONSTANTS=B.TrouterState=B.DeviceType=B.CommandUrlPresence=void 0;var W=G(72),z=G(74);Object.defineProperty(B,"CommandUrlPresence",{enumerable:!0,get:function(){return z.CommandUrlPresence}}),Object.defineProperty(B,"DeviceType",{enumerable:!0,get:function(){return z.DeviceType}}),Object.defineProperty(B,"TrouterState",{enumerable:!0,get:function(){return z.TrouterState}});var K=G(5);Object.defineProperty(B,"CA_CONSTANTS",{enumerable:!0,get:function(){return K.default}});var J=G(25);Object.defineProperty(B,"TM_CONSTANTS",{enumerable:!0,get:function(){return J.default}});var Q=G(189);Object.defineProperty(B,"IncomingNotificationMessageHandler",{enumerable:!0,get:function(){return Q.default}});var Y=G(96);Object.defineProperty(B,"setDefaultsForSignalingConfig",{enumerable:!0,get:function(){return Y.default}});var $=G(208);Object.defineProperty(B,"SignalingAgent",{enumerable:!0,get:function(){return $.default}});var X=G(290);function createParticipant(F){return new W.default(F)}Object.defineProperty(B,"SkypeConCoreTelemetryManager",{enumerable:!0,get:function(){return X.default}}),B.createParticipant=createParticipant},function(F,B,G){var W={};(0,G(37).assign)(W,G(181),G(184),G(95)),F.exports=W},function(F,B,G){function adler32(F,B,G,W){for(var z=65535&F|0,K=F>>>16&65535|0,J=0;0!==G;){G-=J=G>2e3?2e3:G;do{K=K+(z=z+B[W++]|0)|0}while(--J);z%=65521,K%=65521}return z|K<<16|0}F.exports=adler32},function(F,B,G){function makeTable(){for(var F,B=[],G=0;G<256;G++){F=G;for(var W=0;W<8;W++)F=1&F?3988292384^F>>>1:F>>>1;B[G]=F}return B}var W=makeTable();function crc32(F,B,G,z){var K=W,J=z+G;F^=-1;for(var Q=z;Q<J;Q++)F=F>>>8^K[255&(F^B[Q])];return-1^F}F.exports=crc32},function(F,B,G){var W=G(37),z=!0,K=!0;try{String.fromCharCode.apply(null,[0])}catch(F){z=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(F){K=!1}for(var J=new W.Buf8(256),Q=0;Q<256;Q++)J[Q]=Q>=252?6:Q>=248?5:Q>=240?4:Q>=224?3:Q>=192?2:1;function buf2binstring(F,B){if(B<65534&&(F.subarray&&K||!F.subarray&&z))return String.fromCharCode.apply(null,W.shrinkBuf(F,B));for(var G="",J=0;J<B;J++)G+=String.fromCharCode(F[J]);return G}J[254]=J[254]=1,B.string2buf=function(F){var B,G,z,K,J,Q=F.length,Y=0;for(K=0;K<Q;K++)55296==(64512&(G=F.charCodeAt(K)))&&K+1<Q&&56320==(64512&(z=F.charCodeAt(K+1)))&&(G=65536+(G-55296<<10)+(z-56320),K++),Y+=G<128?1:G<2048?2:G<65536?3:4;for(B=new W.Buf8(Y),J=0,K=0;J<Y;K++)55296==(64512&(G=F.charCodeAt(K)))&&K+1<Q&&56320==(64512&(z=F.charCodeAt(K+1)))&&(G=65536+(G-55296<<10)+(z-56320),K++),G<128?B[J++]=G:G<2048?(B[J++]=192|G>>>6,B[J++]=128|63&G):G<65536?(B[J++]=224|G>>>12,B[J++]=128|G>>>6&63,B[J++]=128|63&G):(B[J++]=240|G>>>18,B[J++]=128|G>>>12&63,B[J++]=128|G>>>6&63,B[J++]=128|63&G);return B},B.buf2binstring=function(F){return buf2binstring(F,F.length)},B.binstring2buf=function(F){for(var B=new W.Buf8(F.length),G=0,z=B.length;G<z;G++)B[G]=F.charCodeAt(G);return B},B.buf2string=function(F,B){var G,W,z,K,Q=B||F.length,Y=new Array(2*Q);for(W=0,G=0;G<Q;)if((z=F[G++])<128)Y[W++]=z;else if((K=J[z])>4)Y[W++]=65533,G+=K-1;else{for(z&=2===K?31:3===K?15:7;K>1&&G<Q;)z=z<<6|63&F[G++],K--;K>1?Y[W++]=65533:z<65536?Y[W++]=z:(z-=65536,Y[W++]=55296|z>>10&1023,Y[W++]=56320|1023&z)}return buf2binstring(Y,W)},B.utf8border=function(F,B){var G;for((B=B||F.length)>F.length&&(B=F.length),G=B-1;G>=0&&128==(192&F[G]);)G--;return G<0||0===G?B:G+J[F[G]]>B?G:B}},function(F,B,G){function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}F.exports=ZStream},function(F,B,G){F.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0});var z=G(75);function setDefaultsForSignalingConfig(F){var B=!0,G="enabled",W=!1,K=!1,J=!0,Q=!0,Y=!0,$=!1,X=!1,Z=!0,ee=!0,te=!0,ne=!0,ie=!0,re=!1,oe=!0,ae=!1,se=!1,ce=!1,le=!1,de=!0,ue=!1,pe=!0,he=!0,ge=3,fe=3e3,me=!1,ve=!0,ye=!0,Se=!1,_e=!0,Ce=!1,Te=!1,Ee=!1,be=!1,Ie=!1,Ae=!1,Re={conversationKeepAliveTimeoutSec:2700,promotionUnmuteTimeoutSec:1e4},Pe=!1,Oe=3600,Me=300,we=30,De=!1;F.cloudScreenSharingFlag="disabled"===F.cloudScreenSharingFlag?F.cloudScreenSharingFlag:G,F.isWebRtcEnabled="undefined"==typeof RTCIceGatherer,F.shouldServiceSendNGCUpgradeMessages=setDefault(F.shouldServiceSendNGCUpgradeMessages,J),F.isGVCOutgoingEnabled=setDefault(F.isGVCOutgoingEnabled,B),F.handleRosterFromCreateAndJoin=setDefault(F.handleRosterFromCreateAndJoin,oe),F.supportsCompressedServicePayload=setDefault(F.supportsCompressedServicePayload,Q),F.supportsSynchronousTrouterResponse=setDefault(F.supportsSynchronousTrouterResponse,Y),F.supportsHostlessGroupCalls=setDefault(F.supportsHostlessGroupCalls,Z),F.doHostlessCalling=setDefault(F.doHostlessCalling,W),F.brokerExclusively=setDefault(F.brokerExclusively,re),F.brokerEnabledOutgoing=setDefault(F.brokerEnabledOutgoing,te),F.brokerEnabledIncoming=setDefault(F.brokerEnabledIncoming,ne),F.brokerRequestBatching=setDefault(F.brokerRequestBatching,ie),F.handleMediaOfferFromPushNotification=setDefault(F.handleMediaOfferFromPushNotification,de),F.handleNewOfferRequest=setDefault(F.handleNewOfferRequest,ae),F.autoJoinOnConflict=setDefault(F.autoJoinOnConflict,ee),F.endConflictedCall=setDefault(F.endConflictedCall,$),F.autoResolveConflictedCall=setDefault(F.autoResolveConflictedCall,X),F.shouldServiceSendCallEventMessages=setDefault(F.shouldServiceSendCallEventMessages,K),F.handleUnmuteMuteFromResponse=setDefault(F.handleUnmuteMuteFromResponse,ue),F.forceTrouterReconnectOnNetworkOnline=setDefault(F.forceTrouterReconnectOnNetworkOnline,pe),F.attemptHttpRequestWithCachedSkypetoken=setDefault(F.attemptHttpRequestWithCachedSkypetoken,he),F.useInternalHttpDispatcher=setDefault(F.useInternalHttpDispatcher,se),F.enableTokenCache=setDefault(F.enableTokenCache,ce),F.enableTokenPrefetch=setDefault(F.enableTokenPrefetch,le),F.hedgeDelayMs=setDefault(F.hedgeDelayMs,fe),F.hedgeMaxParallelAttempts=setDefault(F.hedgeMaxParallelAttempts,ge),F.useInternalHttpDispatcher&&(F.httpRequestDispatcher=new z.HttpRequestDispatcher(F.logger)),F.overrideDisplayName=setDefault(F.overrideDisplayName,me),F.enableDeltaRosterWeb=setDefault(F.enableDeltaRosterWeb,ve),F.processSelfDataFromSubscribeResponse=setDefault(F.processSelfDataFromSubscribeResponse,ye),F.enableMusicOnHoldV2=setDefault(F.enableMusicOnHoldV2,Se),F.enablePstnMasking=setDefault(F.enablePstnMasking,_e),F.enableQuickSendAcceptanceAck=setDefault(F.enableQuickSendAcceptanceAck,Ce),F.supportMediaRetargetWhileIncomingRenegotiation=setDefault(F.supportMediaRetargetWhileIncomingRenegotiation,Te),F.enableStaging=setDefault(F.enableStaging,Ee),F.callingServiceSupportsAADTokens=setDefault(F.callingServiceSupportsAADTokens,Pe),F.aadTokenExpirationTimeInSeconds=setDefault(F.aadTokenExpirationTimeInSeconds,Oe),F.popTokenExpirationTimeInSeconds=setDefault(F.popTokenExpirationTimeInSeconds,Me),F.refreshTimeBeforeTokenTimeoutInSeconds=setDefault(F.refreshTimeBeforeTokenTimeoutInSeconds,we),F.enableErrorCodeImprovementsForNetworkFailures=setDefault(F.enableErrorCodeImprovementsForNetworkFailures,be),F.enableMergeParticipantLegsBatchSupport=setDefault(F.enableMergeParticipantLegsBatchSupport,Ie),F.enableCallEstablishmentTimeoutsForStartJoinCall=setDefault(F.enableCallEstablishmentTimeoutsForStartJoinCall,Ae),F.csaTimeoutConfiguration=mergeObjects(F.csaTimeoutConfiguration,Re),F.reportPreviousErrorsForTimeout=setDefault(F.reportPreviousErrorsForTimeout,De)}function setDefault(F,B){return null==F?B:F}function mergeObjects(F,B){return(B||F)&&W(W({},B),F)}B.default=setDefaultsForSignalingConfig},function(F,B,G){F.exports=function bind(F,B){return function wrap(){for(var G=new Array(arguments.length),W=0;W<G.length;W++)G[W]=arguments[W];return F.apply(B,G)}}},function(F,B,G){var W=G(22);function encode(F){return encodeURIComponent(F).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}F.exports=function buildURL(F,B,G){if(!B)return F;var z;if(G)z=G(B);else if(W.isURLSearchParams(B))z=B.toString();else{var K=[];W.forEach(B,(function serialize(F,B){null!=F&&(W.isArray(F)?B+="[]":F=[F],W.forEach(F,(function parseValue(F){W.isDate(F)?F=F.toISOString():W.isObject(F)&&(F=JSON.stringify(F)),K.push(encode(B)+"="+encode(F))})))})),z=K.join("&")}if(z){var J=F.indexOf("#");-1!==J&&(F=F.slice(0,J)),F+=(-1===F.indexOf("?")?"?":"&")+z}return F}},function(F,B,G){F.exports=function isCancel(F){return!(!F||!F.__CANCEL__)}},function(F,B,G){(function(B){var W=G(22),z=G(196),K={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(F,B){!W.isUndefined(F)&&W.isUndefined(F["Content-Type"])&&(F["Content-Type"]=B)}function getDefaultAdapter(){var F;return("undefined"!=typeof XMLHttpRequest||void 0!==B&&"[object process]"===Object.prototype.toString.call(B))&&(F=G(102)),F}var J={adapter:getDefaultAdapter(),transformRequest:[function transformRequest(F,B){return z(B,"Accept"),z(B,"Content-Type"),W.isFormData(F)||W.isArrayBuffer(F)||W.isBuffer(F)||W.isStream(F)||W.isFile(F)||W.isBlob(F)?F:W.isArrayBufferView(F)?F.buffer:W.isURLSearchParams(F)?(setContentTypeIfUnset(B,"application/x-www-form-urlencoded;charset=utf-8"),F.toString()):W.isObject(F)?(setContentTypeIfUnset(B,"application/json;charset=utf-8"),JSON.stringify(F)):F}],transformResponse:[function transformResponse(F){if("string"==typeof F)try{F=JSON.parse(F)}catch(F){}return F}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function validateStatus(F){return F>=200&&F<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};W.forEach(["delete","get","head"],(function forEachMethodNoData(F){J.headers[F]={}})),W.forEach(["post","put","patch"],(function forEachMethodWithData(F){J.headers[F]=W.merge(K)})),F.exports=J}).call(this,G(101))},function(F,B){var G,W,z=F.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(F){if(G===setTimeout)return setTimeout(F,0);if((G===defaultSetTimout||!G)&&setTimeout)return G=setTimeout,setTimeout(F,0);try{return G(F,0)}catch(B){try{return G.call(null,F,0)}catch(B){return G.call(this,F,0)}}}function runClearTimeout(F){if(W===clearTimeout)return clearTimeout(F);if((W===defaultClearTimeout||!W)&&clearTimeout)return W=clearTimeout,clearTimeout(F);try{return W(F)}catch(B){try{return W.call(null,F)}catch(B){return W.call(this,F)}}}!function(){try{G="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(F){G=defaultSetTimout}try{W="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(F){W=defaultClearTimeout}}();var K,J=[],Q=!1,Y=-1;function cleanUpNextTick(){Q&&K&&(Q=!1,K.length?J=K.concat(J):Y=-1,J.length&&drainQueue())}function drainQueue(){if(!Q){var F=runTimeout(cleanUpNextTick);Q=!0;for(var B=J.length;B;){for(K=J,J=[];++Y<B;)K&&K[Y].run();Y=-1,B=J.length}K=null,Q=!1,runClearTimeout(F)}}function Item(F,B){this.fun=F,this.array=B}function noop(){}z.nextTick=function(F){var B=new Array(arguments.length-1);if(arguments.length>1)for(var G=1;G<arguments.length;G++)B[G-1]=arguments[G];J.push(new Item(F,B)),1!==J.length||Q||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},z.title="browser",z.browser=!0,z.env={},z.argv=[],z.version="",z.versions={},z.on=noop,z.addListener=noop,z.once=noop,z.off=noop,z.removeListener=noop,z.removeAllListeners=noop,z.emit=noop,z.prependListener=noop,z.prependOnceListener=noop,z.listeners=function(F){return[]},z.binding=function(F){throw new Error("process.binding is not supported")},z.cwd=function(){return"/"},z.chdir=function(F){throw new Error("process.chdir is not supported")},z.umask=function(){return 0}},function(F,B,G){var W=G(22),z=G(197),K=G(98),J=G(199),Q=G(202),Y=G(203),$=G(103);F.exports=function xhrAdapter(F){return new Promise((function dispatchXhrRequest(B,X){var Z=F.data,ee=F.headers;W.isFormData(Z)&&delete ee["Content-Type"];var te=new XMLHttpRequest;if(F.auth){var ne=F.auth.username||"",ie=F.auth.password||"";ee.Authorization="Basic "+btoa(ne+":"+ie)}var re=J(F.baseURL,F.url);if(te.open(F.method.toUpperCase(),K(re,F.params,F.paramsSerializer),!0),te.timeout=F.timeout,te.onreadystatechange=function handleLoad(){if(te&&4===te.readyState&&(0!==te.status||te.responseURL&&0===te.responseURL.indexOf("file:"))){var G="getAllResponseHeaders"in te?Q(te.getAllResponseHeaders()):null,W={data:F.responseType&&"text"!==F.responseType?te.response:te.responseText,status:te.status,statusText:te.statusText,headers:G,config:F,request:te};z(B,X,W),te=null}},te.onabort=function handleAbort(){te&&(X($("Request aborted",F,"ECONNABORTED",te)),te=null)},te.onerror=function handleError(){X($("Network Error",F,null,te)),te=null},te.ontimeout=function handleTimeout(){var B="timeout of "+F.timeout+"ms exceeded";F.timeoutErrorMessage&&(B=F.timeoutErrorMessage),X($(B,F,"ECONNABORTED",te)),te=null},W.isStandardBrowserEnv()){var oe=G(205),ae=(F.withCredentials||Y(re))&&F.xsrfCookieName?oe.read(F.xsrfCookieName):void 0;ae&&(ee[F.xsrfHeaderName]=ae)}if("setRequestHeader"in te&&W.forEach(ee,(function setRequestHeader(F,B){void 0===Z&&"content-type"===B.toLowerCase()?delete ee[B]:te.setRequestHeader(B,F)})),W.isUndefined(F.withCredentials)||(te.withCredentials=!!F.withCredentials),F.responseType)try{te.responseType=F.responseType}catch(B){if("json"!==F.responseType)throw B}"function"==typeof F.onDownloadProgress&&te.addEventListener("progress",F.onDownloadProgress),"function"==typeof F.onUploadProgress&&te.upload&&te.upload.addEventListener("progress",F.onUploadProgress),F.cancelToken&&F.cancelToken.promise.then((function onCanceled(F){te&&(te.abort(),X(F),te=null)})),void 0===Z&&(Z=null),te.send(Z)}))}},function(F,B,G){var W=G(198);F.exports=function createError(F,B,G,z,K){var J=new Error(F);return W(J,B,G,z,K)}},function(F,B,G){var W=G(22);F.exports=function mergeConfig(F,B){B=B||{};var G={},z=["url","method","params","data"],K=["headers","auth","proxy"],J=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];W.forEach(z,(function valueFromConfig2(F){void 0!==B[F]&&(G[F]=B[F])})),W.forEach(K,(function mergeDeepProperties(z){W.isObject(B[z])?G[z]=W.deepMerge(F[z],B[z]):void 0!==B[z]?G[z]=B[z]:W.isObject(F[z])?G[z]=W.deepMerge(F[z]):void 0!==F[z]&&(G[z]=F[z])})),W.forEach(J,(function defaultToConfig2(W){void 0!==B[W]?G[W]=B[W]:void 0!==F[W]&&(G[W]=F[W])}));var Q=z.concat(K).concat(J),Y=Object.keys(B).filter((function filterAxiosKeys(F){return-1===Q.indexOf(F)}));return W.forEach(Y,(function otherKeysDefaultToConfig2(W){void 0!==B[W]?G[W]=B[W]:void 0!==F[W]&&(G[W]=F[W])})),G}},function(F,B,G){function Cancel(F){this.message=F}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,F.exports=Cancel},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.TsCallingLogger=void 0;var W=G(31),z=G(8),K=function(){function TsCallingLogger(F,B,G){void 0===G&&(G=""),this.ulLogComponent=F,this.ulSafeComponent=B,this._getPrefix=(0,z.isFunction)(G)?G:function(){return G},this.logComponent=W.LogFactory.instance().component(this.ulLogComponent),W.LogFactory.instance().declareComponentSafe(this.ulLogComponent,B)}return TsCallingLogger.prototype.createChild=function(F){var B=this,G=(0,z.isFunction)(F)?F:function(){return F};return new TsCallingLogger(this.ulLogComponent,this.ulSafeComponent,(function(){return B._getPrefix()?"".concat(B._getPrefix(),"/").concat(G()):G()}))},TsCallingLogger.prototype.log=function(){for(var F=this,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._apply((function(B){return F.logComponent.debug2(null,B)}),B)},TsCallingLogger.prototype.debug=function(){for(var F=this,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._apply((function(B){return F.logComponent.debug4(null,B)}),B)},TsCallingLogger.prototype.info=function(){for(var F=this,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._apply((function(B){return F.logComponent.debug1(null,B)}),B)},TsCallingLogger.prototype.warn=function(){for(var F=this,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._apply((function(B){return F.logComponent.warn(null,B)}),B)},TsCallingLogger.prototype.error=function(){for(var F=this,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];this._apply((function(B){return F.logComponent.error(null,B)}),B)},TsCallingLogger.prototype._apply=function(F,B){void 0===B&&(B=[]),this._addPrefix(B),F(B.map((function(F){return F instanceof DOMException?F.toString():F})).map((function(F){return(0,z.isObject)(F)?JSON.stringify(F):F})).join(", "))},TsCallingLogger.prototype._addPrefix=function(F){if(F&&F[0]){var B="".concat(this._getPrefix()," ").concat(F[0]);F[0]=B}},TsCallingLogger}();B.TsCallingLogger=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});function asap(F){return new Promise((function(B){B(F())}))}Object.defineProperty(B,"__esModule",{value:!0}),B.timedDefer=B.defer=B.Timer=B.TimerFactory=B.TimeoutError=B.asap=void 0,B.asap=asap;var K=function(F){function TimeoutError(){return null!==F&&F.apply(this,arguments)||this}return z(TimeoutError,F),TimeoutError}(Error);B.TimeoutError=K;var J=function(){function TimerFactory(){}return TimerFactory.build=function(F,B){return new Q(F,B)},TimerFactory}();B.TimerFactory=J;var Q=function(){function Timer(F,B){this.ontimeout=F,this.name=B}return Timer.prototype.start=function(F){var B=this;if(void 0!==this.timeoutId)throw new Error("Timer ".concat(this.name," already started"));return this.timeoutId=window.setTimeout((function(){return B.ontimeout()}),F),this},Timer.prototype.stop=function(){if(void 0===this.timeoutId)throw new Error("Timer ".concat(this.name," is not defined"));clearTimeout(this.timeoutId),this.timeoutId=void 0},Timer}();function defer(){var F,B;return{promise:new Promise((function(G,W){F=G,B=W})),resolve:F,reject:B}}function timedDefer(F,B){var G,W;void 0===B&&(B="deferred timed out after ".concat(F,"ms"));var z={promise:new Promise((function(F,B){G=function(B){J.stop(),F(B)},W=function(F){J.stop(),B(F)}})),resolve:G,reject:W},J=new Q((function(){return z.reject(new K(B))}),"timedDefer");return J.start(F),z}B.Timer=Q,B.defer=defer,B.timedDefer=timedDefer},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G,J){K.assertNotNull(F,"signalingSession cannot be null");var Q=G.groupId?{id:G.groupId}:null,Y=G.threadId?{threadId:G.threadId,messageId:G.messageId||null}:null,$=[],X={};B&&B.length>0?($=B.map((function(B){return{id:B.id,assertedId:B.assertedId,displayName:B.displayName,participantId:B.participantId,replacementDetails:3===G.replacementType?F.getReplacementDetailsByParticipantLegOfCall(G.callIdToReplace,B.id,B.replacementParticipantId):void 0}})),X={addParticipantSuccess:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}):X={addModalitySuccess:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_FAILURE)};var Z={payload:{disableUnmute:G&&G.disableUnmute,participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},to:$},participantInvitationData:G.additionalData,replacementDetails:3===G.replacementType?void 0:J,groupContext:Q,groupChat:Y,links:X}};return G&&G.alternateId&&(Z.payload.participants.from.alternateId=G.alternateId),(null==G?void 0:G.clientScenario)&&(Z.payload.debugContent={clientScenario:G.clientScenario}),Z}B.getPayload=getPayload},function(F,B){var G=F.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\S*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(F){return F.encoding?"rtpmap:%d %s/%s/%s":F.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(F){return null!=F.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbXMessage",reg:/^rtcp-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(F){return"rtcp-fb:"+("*"===F.payload?"%s":"%d")+" x-message %s"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(F){return null!=F.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(F){return"extmap:%d"+(F.direction?"/%s":"%v")+(F["encrypt-uri"]?" %s":"%v")+" %s"+(F.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"cryptoscale",reg:/^cryptoscale:(\d*) (client|server) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","flavor","suite","config","sessionConfig"],format:function(F){return null!=F.sessionConfig?"cryptoscale:%d %s %s %s %s":"cryptoscale:%d %s %s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(F){return null!=F.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(F){var B="candidate:%s %d %s %d %s %d typ %s";return B+=null!=F.raddr?" raddr %s rport %d":"%v%v",B+=null!=F.tcptype?" tcptype %s":"%v",null!=F.generation&&(B+=" generation %d"),B+=null!=F["network-id"]?" network-id %d":"%v",B+=null!=F["network-cost"]?" network-cost %d":"%v"}},{push:"xCandidatesIpv6",reg:/^x-candidate-ipv6:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(F){var B="candidate:%s %d %s %d %s %d typ %s";return B+=null!=F.raddr?" raddr %s rport %d":"%v%v",B+=null!=F.tcptype?" tcptype %s":"%v",null!=F.generation&&(B+=" generation %d"),B}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(F){var B="ssrc:%d";return null!=F.attribute&&(B+=" %s",null!=F.value&&(B+=":%s")),B}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(F){return null!=F.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(F){return F.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(F){return"imageattr:%s %s %s"+(F.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(F){return"simulcast:%s %s"+(F.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(F){return"ts-refclk:%s"+(null!=F.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(F){var B="mediaclk:";return B+=null!=F.id?"id=%s %s":"%v%s",B+=null!=F.mediaClockValue?"=%s":"",B+=null!=F.rateNumerator?" rate=%s":"",B+=null!=F.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{name:"xMediaBw",reg:/^x-mediabw:(\S*) send=(\d*);recv=(\d*)/,names:["label","sendBw","receiveBw"],format:"x-mediabw:%s send=%d;recv=%d"},{name:"xSsrcRange",reg:/^x-ssrc-range:(\d*)-(\d*)/,names:["ssrcMin","ssrcMax"],format:"x-ssrc-range:%d-%d"},{name:"xSource",reg:/^x-source:(\S*)/,format:"x-source:%s"},{name:"xSourceStreamId",reg:/^x-source-streamid:(\S*)/,format:"x-source-streamid:%s"},{name:"xCaps",reg:/^x-caps:(\d*) (\S*)/,names:["payloadType","value"],format:"x-caps:%d %s"},{name:"signalingFbXMessage",reg:/^x-signaling-fb:(\*|\d*) x-message ([\S| ]*)/,names:["payload","param"],format:function(F){return"x-signaling-fb:"+("*"===F.payload?"%s":"%d")+" x-message %s"}},{push:"xMediaSettings",reg:/^x-mediasettings:([\S| ]*)/,names:["settings"],format:"x-mediasettings:%s"},{name:"xDataProtocol",reg:/^x-data-protocol:\s?(.*)/,format:"x-data-protocol:%s"},{push:"invalid",names:["value"]}]};Object.keys(G).forEach((function(F){G[F].forEach((function(F){F.reg||(F.reg=/(.*)/),F.format||(F.format="%s")}))}))},function(F,B,G){var W;function callStateIsAnyOf(F,B){return-1!==B.indexOf(F)}Object.defineProperty(B,"__esModule",{value:!0}),B.validStateTransitions=B.callStateIsAnyOf=void 0,B.callStateIsAnyOf=callStateIsAnyOf,B.validStateTransitions=((W={})[0]=[1,2,8,6,10,11,9],W[1]=[2,6,7,10,13],W[2]=[1,3,6,7,9,10,13,14],W[3]=[6,7,4,5,10,13],W[8]=[1,11,10,2,9,6,7],W[4]=[6,7,3,5,10,13],W[5]=[6,7,3,4,10,13],W[9]=[3,6,7,10,13],W[10]=[3,6,7,9,4,5,13,15],W[13]=[3,6,7,4,5],W[14]=[3,6,7,10,13],W[15]=[3,6,7,4,5,13],W[11]=[12,1,2,6,7],W[12]=[2,6,7],W[6]=[7],W[7]=[],W)},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.scrubCallOptions=B.MediaStateConfigHelper=B.convertRedirectOptions=B.getCallStartOptions=B.getMediaState=B.getCSAEndCode=B.getTerminationCode=B.convertSignalingEndpointDetails=B.convertReason=void 0;var z=G(8),K=G(59),J=G(17),Q=G(56);function convertReason(F){return F?getTerminationCode(F.code,F.subCode):0}function convertSignalingEndpointDetails(F,B){var G={clientVersion:F.clientVersion,participantId:F.participantId,endpointId:F.endpointId,endpointType:F.endpointType,endpointMetadata:F.endpointMetadata,originalId:F.originalId,capabilities:F.capabilities,clientEndpointCapabilities:F.clientEndpointCapabilities,mappedTo:F.mappedTo,meetingGroupDetails:F.meetingGroupDetails};return F.mediaStreams&&(G.mediaStreams=F.mediaStreams),F.lwjSessionInformation&&(G.lwjSessionInformation=F.lwjSessionInformation),F.appliedInteractivityLevel&&(G.appliedInteractivityLevel=F.appliedInteractivityLevel),F.deviceType&&(G.deviceType=F.deviceType),F.streamInformation&&32&B&&(G.streamInformation=F.streamInformation),G}function getTerminationCode(F,B){if(void 0===B&&(B=null),F===Q.jsCallEndCodes.Success)switch(B){case Q.jsCallEndSubCodes.RemovedFromConversation:case Q.jsCallEndSubCodes.RemovedFromCall:return 44;case Q.jsCallEndSubCodes.DeniedInLobby:return 55;case Q.jsCallEndSubCodes.TimedOutInLobby:return 56;default:return 1}if(null!==B&&B>=Q.PstnTerminationCode.CallTerminationSubCodeSipGWMin&&B<=Q.PstnTerminationCode.CallTerminationSubCodeSipGWMax){var G=B-Q.PstnTerminationCode.CallTerminationSubCodeSipGWMin;return Q.pstnConsumerResponseCodeMap[G]?Q.pstnConsumerResponseCodeMap[G]:0}return null!==B&&B>=Q.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMin&&B<=Q.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMax?Q.pstnEnterpriseResponseCodeMap[F]?Q.pstnEnterpriseResponseCodeMap[F]:43:F===Q.jsCallEndCodes.Forbidden?B===Q.jsCallEndSubCodes.UserBlocked?64:B===Q.jsCallEndSubCodes.PolicyRestriction?62:B===Q.jsCallEndSubCodes.AnonymousJoinDisabledByPolicy?66:B===Q.jsCallEndSubCodes.NoLobbyForBroadcastJoin?67:B===Q.jsCallEndSubCodes.NotAllowedDueToInformationBarrier?68:B===Q.jsCallEndSubCodes.TeamParkPolicyDisabled?70:B===Q.jsCallEndSubCodes.B2bJoinDisabledByPolicy?71:B===Q.jsCallEndCodes.Success?8:7:F===Q.jsCallEndCodes.PreconditionFailed&&B===Q.jsCallEndSubCodes.InsufficientCapabilities?63:F===Q.jsCallEndCodes.ServiceUnavailable?B===Q.jsCallEndSubCodes.BroadcastLimitReached?69:48:F===Q.jsCallEndCodes.InternalServerError?7:F===Q.jsCallEndCodes.ConfParticipantCountLimitReached?B===Q.jsCallEndSubCodes.MaxLobbyParticipantLimitReached?73:59:Q.responseCodeMap[F]?Q.responseCodeMap[F]:F}function getCSAEndCode(F){var B,G;if(1===F)return Q.jsCallEndCodes.Success;var z=Object.keys(Q.responseCodeMap).filter((function(B){return Q.responseCodeMap[B]===F}));if(z.length>=1)try{for(var K=W(z),J=K.next();!J.done;J=K.next()){var Y=J.value,$=parseInt(Y);if($&&Q.responseCodeMap[$]===F)return $}}catch(F){B={error:F}}finally{try{J&&!J.done&&(G=K.return)&&G.call(K)}finally{if(B)throw B.error}}return Q.jsCallEndCodes.UnknownError}function getMediaState(F,B){if(void 0!==B&&3!==B&&1!==B)return{mediaType:F,isDisabled:0===B,label:K.getMediaLabel(F)}}function getCallStartOptions(F){if(F.sendMediaModalities)return F;var B={mediaStates:[]},G=getMediaState(0,F.audioDirection?F.audioDirection:4);return G&&B.mediaStates.push(G),(G=getMediaState(1,F.withVideo?F.withVideo?4:1:F.videoDirection))&&B.mediaStates.push(G),(G=getMediaState(2,F.screenshareDirection?F.screenshareDirection:1))&&B.mediaStates.push(G),F.sendMediaModalities=B,F}function convertRedirectOptions(F){var B=convertRedirectionTargetIdType(F.type),G=convertRedirectionEndpointType(F.endpointType);return{type:B,id:F.id,endpointType:G}}function convertRedirectionTargetIdType(F){if("mri"===F)return"mri";throw"Unknown RedirectionTargetIdType"}function convertRedirectionEndpointType(F){switch(F){case"voicemail":return"voicemail";case"default":return"default";default:throw"Unknown RedirectionEndpointType"}}B.convertReason=convertReason,B.convertSignalingEndpointDetails=convertSignalingEndpointDetails,B.getTerminationCode=getTerminationCode,B.getCSAEndCode=getCSAEndCode,B.getMediaState=getMediaState,B.getCallStartOptions=getCallStartOptions,B.convertRedirectOptions=convertRedirectOptions;var Y=function(){function MediaStateConfigHelper(F){this.mediaStateConfiguration=F}return MediaStateConfigHelper.prototype.isDisabled=function(F){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var B=z.find(this.mediaStateConfiguration.mediaStates,(function(B){return B.mediaType===F}));return!!B&&!!B.isDisabled}return!1},MediaStateConfigHelper.prototype.isInactiveOrDisabled=function(F){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var B=z.find(this.mediaStateConfiguration.mediaStates,(function(B){return B.mediaType===F}));return!B||!!B.isDisabled}return!1},MediaStateConfigHelper.prototype.isSending=function(F){return!(!this.mediaStateConfiguration||!this.mediaStateConfiguration.mediaStates)&&!!z.find(this.mediaStateConfiguration.mediaStates,(function(B){return B.mediaType===F&&!B.isDisabled}))},MediaStateConfigHelper.prototype.setModality=function(F,B){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var G=z.find(this.mediaStateConfiguration.mediaStates,(function(B){return B.mediaType===F}));G?G.isDisabled=B:this.mediaStateConfiguration.mediaStates.push({mediaType:F,isDisabled:B,label:K.getMediaLabel(F)})}},MediaStateConfigHelper.prototype.disableModality=function(F){this.setModality(F,!0)},MediaStateConfigHelper.prototype.enableModality=function(F){this.setModality(F,!1)},MediaStateConfigHelper.prototype.removeModality=function(F){this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates&&z.remove(this.mediaStateConfiguration.mediaStates,(function(B){return B.mediaType===F}))},MediaStateConfigHelper.prototype.setCallAcceptOptions=function(F){var B=this.isDisabled(1),G=this.isDisabled(2);if(F.sendMediaModalities)this.mediaStateConfiguration=F.sendMediaModalities;else{void 0===F.answerMediaType&&(F.answerMediaType=F.withVideo?1:0);var W={mediaStates:[]};switch(F.answerMediaType){case 0:W.mediaStates.push(getMediaState(0,4));break;case 1:W.mediaStates.push(getMediaState(0,4)),W.mediaStates.push(getMediaState(1,4));break;case 2:W.mediaStates.push(getMediaState(1,0))}this.mediaStateConfiguration=W}B&&this.setModality(1,!0),G&&this.setModality(2,!0),F.sendMediaModalities=this.mediaStateConfiguration},MediaStateConfigHelper}();function hasValue(F){return F||!1===F||""===F||0===F}function scrubCallOptions(F){var B={};hasValue(F.callStartTime)&&(B.callStartTime=F.callStartTime),hasValue(F.callVoicemailStartOptions)&&(B.callVoicemailStartOptions=F.callVoicemailStartOptions),hasValue(F.invitationType)&&(B.invitationType=F.invitationType),hasValue(F.meetingPreferences)&&(B.meetingPreferences=F.meetingPreferences),hasValue(F.parkContext)&&(B.parkContext=F.parkContext),hasValue(F.pickupCode)&&(B.pickupCode=F.pickupCode),hasValue(F.participantsToNudge)&&(B.participantsToNudgeSize=F.participantsToNudge.length);var G=F.callStartOptions;if(G){var W={};hasValue(G.additionalEndpointProperties)&&(W.additionalEndpointProperties=G.additionalEndpointProperties),hasValue(G.clientEndpointCapabilities)&&(W.clientEndpointCapabilities=G.clientEndpointCapabilities),hasValue(G.connectionType)&&(W.connectionType=G.connectionType),hasValue(G.invitationDataJson)&&(W.invitationDataJson=G.invitationDataJson),hasValue(G.isCast)&&(W.isCast=G.isCast),hasValue(G.label)&&(W.label=G.label),hasValue(G.maxVideoChannels)&&(W.maxVideoChannels=G.maxVideoChannels),hasValue(G.mediaConfiguration)&&(W.mediaConfiguration=G.mediaConfiguration),hasValue(G.muteFlags)&&(W.muteFlags=G.muteFlags),hasValue(G.muted)&&(W.muted=G.muted),hasValue(G.negotiationTag)&&(W.negotiationTag=G.negotiationTag),hasValue(G.preheatFlags)&&(W.preheatFlags=G.preheatFlags),hasValue(G.ringOthers)&&(W.ringOthers=G.ringOthers),hasValue(G.routingFlags)&&(W.routingFlags=G.routingFlags),hasValue(G.scenario)&&(W.scenario=G.scenario),hasValue(G.screenshareDirection)&&(W.screenshareDirection=G.screenshareDirection),hasValue(G.sendMediaModalities)&&(W.sendMediaModalities=G.sendMediaModalities),hasValue(G.sharedLineCallInvitationContentJson)&&(W.sharedLineCallInvitationContentJson=G.sharedLineCallInvitationContentJson),hasValue(G.clientEndpointDebugContent)&&(W.clientEndpointDebugContentSize=G.clientEndpointDebugContent.length),hasValue(G.alternateId)&&(W.alternateId=(0,J.scrubMriOrOmit)(G.alternateId)),hasValue(G.callKey)&&(W.callKeySize=G.callKey.length),hasValue(G.encryptedKey)&&(W.encryptedKeySize=G.encryptedKey.length),B.callStartOptions=W}return B}B.MediaStateConfigHelper=Y,B.scrubCallOptions=scrubCallOptions},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W={NEGOTIATION_COMPLETED:"NegotiationCompleted",INITIAL:{OFFER_GENERATION_STARTED:"InitialOfferGenerationStarted",OFFER_GENERATION_ENDED:"InitialOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"InitialAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"InitialAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"InitialOfferProcessingStarted",OFFER_PROCESSING_ENDED:"InitialOfferProcessingEnded",ANSWER_GENERATION_STARTED:"InitialAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"InitialAnswerGenerationEnded"},RENEGOTIATION:{OFFER_GENERATION_STARTED:"RenegotiationOfferGenerationStarted",OFFER_GENERATION_ENDED:"RenegotiationOfferGenerationEnded",ANSWER_PROCESSING_STARTED:"RenegotiationAnswerProcessingStarted",ANSWER_PROCESSING_ENDED:"RenegotiationAnswerProcessingEnded",OFFER_PROCESSING_STARTED:"RenegotiationOfferProcessingStarted",OFFER_PROCESSING_ENDED:"RenegotiationOfferProcessingEnded",ANSWER_GENERATION_STARTED:"RenegotiationAnswerGenerationStarted",ANSWER_GENERATION_ENDED:"RenegotiationAnswerGenerationEnded"}},z=function(){function MediaSessionWrapper(F,B,G){var z=this;this.mediaSession=F,this.signalingSession=B,this.mediaConstants=G,this.operationNames=W.INITIAL,this.configureModalitiesAsync=this.mediaSession.configureModalitiesAsync.bind(this.mediaSession),this.getAllowedModalities=this.mediaSession.getAllowedModalities.bind(this.mediaSession),this.rejectNegotiationAsync=this.mediaSession.rejectNegotiationAsync.bind(this.mediaSession),this.createRemoteRenderer=this.mediaSession.createRemoteRenderer.bind(this.mediaSession),this.getStatsAsync=this.mediaSession.getStatsAsync.bind(this.mediaSession),this.getLastKnownStats=this.mediaSession.getLastKnownStats.bind(this.mediaSession),this.getCallTechnicalInfo=this.mediaSession.getCallTechnicalInfo.bind(this.mediaSession),this.muteHold=this.mediaSession.muteHold.bind(this.mediaSession),this.muteInputAsync=this.mediaSession.muteInputAsync.bind(this.mediaSession),this.unmuteInputAsync=this.mediaSession.unmuteInputAsync.bind(this.mediaSession),this.muteOutputAsync=this.mediaSession.muteOutputAsync.bind(this.mediaSession),this.unmuteOutputAsync=this.mediaSession.unmuteOutputAsync.bind(this.mediaSession),this.terminate=this.mediaSession.terminate.bind(this.mediaSession),this.createAudioElement=this.mediaSession.createAudioElement.bind(this.mediaSession),this.getSessionConfig=this.mediaSession.getSessionConfig.bind(this.mediaSession),this.getIncomingRawAudioStream=this.mediaSession.getIncomingRawAudioStream.bind(this.mediaSession),this.useNullAudioStreamClient=this.mediaSession.useNullAudioStreamClient.bind(this.mediaSession),this.getSubscriptionManager=this.mediaSession.getSubscriptionManager.bind(this.mediaSession);var K=this.getExtensionsManager();K&&K.configureExtension(this.mediaConstants.EXTENSION_TYPE.videoStreamControl,{sender:{send:function(F,B){return z.signalingSession?z.signalingSession.sendWebRtcMediaNotificationAsync(F,B):Promise.reject(new Error("no signaling session"))}}})}return MediaSessionWrapper.prototype.enableRealTimeTelemetry=function(){this.mediaSession.enableRealTimeTelemetry()},MediaSessionWrapper.prototype.getMediaStatsReport=function(){return this.mediaSession.getMediaStatsReport()},MediaSessionWrapper.prototype.processOfferAsync=function(F,B){var G=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_PROCESSING_STARTED),this.mediaSession.processOfferAsync(F,B).then((function(F){return G.signalingSession.setOfferAnswerGenerationTimestamps(G.operationNames.OFFER_PROCESSING_ENDED),F}))},MediaSessionWrapper.prototype.createAnswerAsync=function(F,B){var G=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_GENERATION_STARTED),this.mediaSession.createAnswerAsync(F,B).then((function(B){return G.signalingSession.setOfferAnswerGenerationTimestamps(G.operationNames.ANSWER_GENERATION_ENDED),F||(G.operationNames=W.RENEGOTIATION),B}))},MediaSessionWrapper.prototype.createOfferAsync=function(F){var B=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_GENERATION_STARTED),this.mediaSession.createOfferAsync(F).then((function(F){return B.signalingSession.setOfferAnswerGenerationTimestamps(B.operationNames.OFFER_GENERATION_ENDED),F}))},MediaSessionWrapper.prototype.processAnswerAsync=function(F,B,G,z){var K=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_PROCESSING_STARTED),this.mediaSession.processAnswerAsync(F,B,G,z).then((function(){K.signalingSession.setOfferAnswerGenerationTimestamps(K.operationNames.ANSWER_PROCESSING_ENDED),K.operationNames=W.RENEGOTIATION}))},MediaSessionWrapper.prototype.completeNegotiationAsync=function(F){var B=this;return this.mediaSession.completeNegotiationAsync(F).then((function(F){return B.signalingSession.setOfferAnswerGenerationTimestamps(W.NEGOTIATION_COMPLETED),F}))},MediaSessionWrapper.prototype.sendDtmf=function(F){return this.mediaSession.sendDtmf?this.mediaSession.sendDtmf(F):Promise.reject("Not Implemented")},MediaSessionWrapper.prototype.getExtensionsManager=function(){return this.mediaSession.getExtensionsManager?this.mediaSession.getExtensionsManager():null},MediaSessionWrapper.prototype.reconnectAsync=function(F,B){return void 0===B&&(B=!1),this.mediaSession.reconnectAsync(F,B)},MediaSessionWrapper.prototype.completeEscalationAsync=function(F){return this.mediaSession.completeEscalationAsync(F)},MediaSessionWrapper.prototype.rejectEscalationAsync=function(F,B){return this.mediaSession.rejectEscalationAsync(F,B)},MediaSessionWrapper.prototype.getAcceptedTypes=function(){return this.mediaSession.getAcceptedTypes()},MediaSessionWrapper.prototype.getLocalMediaTrackId=function(F){return this.mediaSession.getLocalMediaTrackId?this.mediaSession.getLocalMediaTrackId(F):null},MediaSessionWrapper}();B.default=z},function(F,B,G){function handleServerMutedVersion(F,B,G){if(!(void 0===B||void 0===B.serverMuteVersion||void 0===G||void 0===G.serverMuteVersion||G.serverMuteVersion>=B.serverMuteVersion)){var W=G&&G.mediaStreams,z=W&&W.filter((function(F){return"audio"===F.type||"audio-teleconferencing"===F.type})),K=B&&B.mediaStreams,J=K&&K.filter((function(F){return"audio"===F.type||"audio-teleconferencing"===F.type}));z&&z.length&&(G.serverMuteVersion=B.serverMuteVersion,z[0].serverMuted=J[0].serverMuted,F.info("handleServerMutedVersion: patching server muted state in audio streams updated:".concat(JSON.stringify(z[0])," as we encountered stale muteServerVersion. Updated to ").concat(B.serverMuteVersion)))}}function handleMuteUnmuteParticipantInfo(F,B,G,W){if("success"!==G.reason||void 0===B||G.serverMuteVersion<=B.serverMuteVersion)return F.info("handleMuteUnmuteParticipantInfo: ignoring updating since we encountered invalid state: ".concat(G.reason," serverMuteVersion: ").concat(G.serverMuteVersion)),!1;var z=B&&B.mediaStreams,K=z&&z.filter((function(F){return"audio"===F.type||"audio-teleconferencing"===F.type}));return!!K&&(K[0].serverMuted=W,B.serverMuteVersion=G.serverMuteVersion,F.info("handleMuteUnmuteParticipantInfo: updating since we encountered valid state serverMuteVersion: ".concat(G.serverMuteVersion," to: ").concat(W," streams: ").concat(K[0])),!0)}Object.defineProperty(B,"__esModule",{value:!0}),B.handleMuteUnmuteParticipantInfo=B.handleServerMutedVersion=void 0,B.handleServerMutedVersion=handleServerMutedVersion,B.handleMuteUnmuteParticipantInfo=handleMuteUnmuteParticipantInfo},function(F,B,G){var W,z,K,J=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),Q=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.PluginlessCallParticipant=void 0;var Y=G(8),$=G(41),X=G(55),Z=G(13),ee=G(14),te=G(15),ne=G(45),ie=G(115),re=G(17),oe=G(111),ae=G(113),se=G(116),ce=G(62),le=((z={})[0]=[1],z[1]=[2,6,3,4,5,7,8],z[2]=[6,3,4,8],z[3]=[1,4,5,8],z[7]=[3,4,8],z[4]=[],z[5]=[3,4,8],z[6]=[3,4],z[8]=[3,5,4],z),de=((K={})[0]="Disconnected",K[1]="Connecting",K[2]="Ringing",K[3]="Connected",K[5]="Connected",K[4]="Disconnected",K[7]="Connecting",K),ue=function(F){function PluginlessCallParticipant(B,G,W,z,K,J,Y,ee,te,ne){void 0===ee&&(ee=(0,Z.generateCauseId)()),void 0===te&&(te=!1),void 0===ne&&(ne=!1);var oe=F.call(this,W)||this;return oe.mri=B,oe.callTelemetry=K,oe.configProvider=J,oe.enablePluginlessCallParticipantRaiseChangeDeferred=te,oe.enableGlobalDeferHandler=ne,oe.state=0,oe.voiceLevel=0,oe.isServerMuted=!1,oe.endpointType="default",oe.balanceUpdates={},oe._raiseChangeDeferRunner=ie.GlobalDeferHandler.instance.createDeferRunner(),oe.filteredParticipantEndpointDetails={},oe.recordTelemetryForStateChange=function(F,B,G,W){var z,K;if(W){var J=$.PARTICIPANT_OPERATIONS_INTERNAL.SET_PARTICIPANT_STATE_INVALID,Q={state:B,reason:G,endpoints:[]};(null===(K=null===(z=oe.endpoints)||void 0===z?void 0:z.endpointDetails)||void 0===K?void 0:K.length)&&(Q.endpoints=(0,X.getEndpointInformationForTelemetry)(oe.endpoints.endpointDetails)),oe.callTelemetry.recordEvent(J,Q,F)}},oe.checkIfIncomingServerMutedIsUpdated=function(F){oe.filteredParticipantEndpointDetails!=={}&&F.endpointDetails.forEach((function(F){var B=oe.filteredParticipantEndpointDetails[F.participantId];void 0!==B&&ae.handleServerMutedVersion(oe.logger,B,F)}))},oe.handleServerMutedInfoUpdate=function(F){var B,G,W=!1;try{for(var z=Q(F),K=z.next();!K.done;K=z.next()){var J=K.value,Y=oe.filteredParticipantEndpointDetails[J.participantId];ae.handleMuteUnmuteParticipantInfo(oe.logger,Y,J,!0)&&(W=!0)}}catch(F){B={error:F}}finally{try{K&&!K.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}W&&oe.updateIsServerMuted()},oe.id=oe.mri,oe.logger=W.createChild((function(){return"ICallParticipant[".concat(re.scrubMriOrOmit(oe.id),"][").concat(oe.state,"]")})),oe.logger.info("[".concat(ee,"]created")),oe.streamManager=new se.PluginlessCallStreamManager(oe.id,G,z,oe.logger,Y,oe.configProvider),oe}return J(PluginlessCallParticipant,F),Object.defineProperty(PluginlessCallParticipant.prototype,"audio",{get:function(){return this.streamManager.audio},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCallParticipant.prototype,"streams",{get:function(){return this.streamManager.streams},enumerable:!1,configurable:!0}),PluginlessCallParticipant.prototype.getDiagnosticData=function(){return JSON.stringify({id:re.scrubMriOrOmit(this.id),state:this.state,isServerMuted:this.isServerMuted})},PluginlessCallParticipant.prototype.isSameParticipantsMri=function(F){return this.id===F},PluginlessCallParticipant.prototype.setMediaSession=function(F,B){void 0===B&&(B=(0,Z.generateCauseId)()),this.streamManager.setMediaSession(F,B)},PluginlessCallParticipant.prototype.updateStreams=function(F,B){void 0===B&&(B=(0,Z.generateCauseId)());var G=this.logger.createFnLogger("updateStreams",B);this.streamManager.updateStreams(F,B),G.info("mediaStreams=".concat((0,ee.safeJsonStringify)(F))),this.enablePluginlessCallParticipantRaiseChangeDeferred?this.raiseChangedDeferred():this.raiseChanged()},PluginlessCallParticipant.prototype.hasAudioSource=function(F){return this.streamManager.hasAudioSource(F)},PluginlessCallParticipant.prototype.raiseChangedDeferred=function(){var F=this;this.enableGlobalDeferHandler?this._raiseChangeDeferRunner((function(){return F.raiseChanged()})):this.raiseChangedDefer||(this.raiseChangedDefer=Y.defer((function(){delete F.raiseChangedDefer,F.raiseChanged()})))},PluginlessCallParticipant.prototype.updateIsServerMuted=function(){if(Object.values(this.filteredParticipantEndpointDetails).length){var F=!1;Object.values(this.filteredParticipantEndpointDetails).forEach((function(B){var G,W,z;if(!B.lwjSessionInformation){var filterAndSortStreams=function(F){var G;return null===(G=B.mediaStreams)||void 0===G?void 0:G.filter((function(B){return B.type===F})).sort(se.PluginlessCallStreamManager.compareStreams)},K=null===(G=filterAndSortStreams(ce.ngcStreamTypes.audio))||void 0===G?void 0:G[0];K||(K=null===(W=filterAndSortStreams(ce.ngcStreamTypes.audioteleconference))||void 0===W?void 0:W[0]);var J=!!(null==K?void 0:K.serverMuted),Q=null===(z=B.endpointState)||void 0===z?void 0:z.state,Y=!!(null==Q?void 0:Q.isMuted);!1!==J||!1!==Y||(F=!0)}}));var B=!F;this._updateIsServerMuted(B)}else this._updateIsServerMuted(!1)},PluginlessCallParticipant.prototype._updateIsServerMuted=function(F){F!==this.isServerMuted&&(this.isServerMuted=F,this.logger.info("_updateIsServerMuted updating to: ".concat(this.isServerMuted)),this.raiseChanged())},PluginlessCallParticipant.prototype.updateVoiceLevel=function(F){this.voiceLevel!==F&&(this.voiceLevel=F,this.raiseChanged())},PluginlessCallParticipant.prototype.setState=function(F,B,G){if(this.state!==F){var W=this.logger.createFnLogger("setState",G);if(3!==this.state||6!==F){var z=le[this.state].indexOf(F)>=0;this.recordTelemetryForStateChange(G,F,B,!z),z?(W.info("state=".concat(this.state,"->").concat(F," reason=").concat(this.stateReason,"->").concat(B)),this.state=F,this.stateReason=B,this.enablePluginlessCallParticipantRaiseChangeDeferred?this.raiseChangedDeferred():this.raiseChanged()):W.logFailure("Invalid state transition ".concat(this.state,"->").concat(F," attempted"))}else W.info("Ignore Connected->EarlyMedia transition, it is a race between media and signaling")}},PluginlessCallParticipant.prototype.processParticipantDetails=function(F,B){var G,W=this,z=this.logger.createFnLogger("processParticipantDetails","");this.role=F.role,this.meetingRole=F.meetingRole,this.advancedMeetingRole=F.advancedMeetingRole,this.tenantId=F.tenantId,this.isIdentityMasked=!!F.isIdentityMasked,this.nonMaskedId=F.nonMaskedId,this.nonMaskedDisplayName=F.nonMaskedDisplayName,this.nonMaskedObjectId=F.nonMaskedObjectId,this.maskedIdSeqNumber=F.maskedIdSeqNumber,(null===(G=F.endpointDetails)||void 0===G?void 0:G.length)&&(this.endpoints={endpointDetails:[]},this.participantCapabilities={canConference:!1,canShareScreen:!1,canMerge:!0},this.checkIfIncomingServerMutedIsUpdated(F),this.filteredParticipantEndpointDetails={},F.endpointDetails.forEach((function(F){var G=oe.convertSignalingEndpointDetails(F,B);if(W.endpoints.endpointDetails.push(G),!G.mappedTo&&(W.filteredParticipantEndpointDetails[F.participantId]={endpointId:F.endpointId,serverMuteVersion:F.serverMuteVersion,endpointState:F.endpointState,mediaStreams:F.mediaStreams,lwjSessionInformation:F.lwjSessionInformation},F.capabilities&&(W.participantCapabilities.canConference||"enabled"!==F.capabilities.cloudAudioVideoConference||(W.participantCapabilities.canConference=!0),W.participantCapabilities.canShareScreen||"enabled"!==F.capabilities.cloudScreenSharing||(W.participantCapabilities.canShareScreen=!0),W.participantCapabilities.canMerge||"enabled"!==F.capabilities.cloudMerge||(W.participantCapabilities.canMerge=!0)),W.contentSharingRole=0,F.contentSharing&&F.contentSharing.sessionInformation)){var z=F.contentSharing.sessionInformation;"attendee"===z.role?W.contentSharingRole=1:"presenter"===z.role&&(W.contentSharingRole=2)}})),this.updateIsServerMuted(),z.info("endpointDetails=".concat(JSON.stringify(this.endpoints))),this.enablePluginlessCallParticipantRaiseChangeDeferred?this.raiseChangedDeferred():this.raiseChanged())},PluginlessCallParticipant.prototype.toCafeParticipant=function(){return{audioState:de[this.state],mri:this.mri}},PluginlessCallParticipant.prototype.getSourceIdForMediaType=function(F){var B=ne.getSourceIdForMediaType(this,F);return-1===B&&this.logger.warn("getSourceIdForMediaType failed"),B},PluginlessCallParticipant.prototype.useLightweightStreams=function(F,B){this.streamManager.useLightweightStreams(F,B)},PluginlessCallParticipant.prototype.useMiddleLaneStream=function(F,B,G){this.streamManager.useMiddleLaneStream(F,B,G),this.enablePluginlessCallParticipantRaiseChangeDeferred?this.raiseChangedDeferred():this.raiseChanged()},PluginlessCallParticipant.prototype.hasSourceId=function(F,B){return void 0!==ne.getParticipantIdForSourceId(this,F,B)},PluginlessCallParticipant}(te.default);B.PluginlessCallParticipant=ue},function(F,B,G){(function(F){Object.defineProperty(B,"__esModule",{value:!0}),B.GlobalDeferHandler=B.DeferHandler=void 0;var W=G(8),z=function(){function DeferHandler(){this.deferredOperations=new Map,this.isRunning=!1}return DeferHandler.prototype.createDeferRunner=function(){var F=this,B={};return function(G){return F.runDeferred(B,G)}},DeferHandler.prototype.runDeferredWithoutDedup=function(F){var B={};this.runDeferred(B,F)},DeferHandler.prototype.runDeferred=function(F,B){var G=this;this.deferredOperations.has(F)||(this.deferredOperations.set(F,B),this.isRunning||(this.isRunning=!0,DeferHandler.defer((function(){G.deferredOperations.forEach((function(F){DeferHandler.runWithTryCatch(F)})),G.deferredOperations.clear(),G.isRunning=!1}))))},DeferHandler.runWithTryCatch=function(F){try{F&&F()}catch(F){}},DeferHandler.defer=F.setImmediate?function(B){F.setImmediate(B)}:function(F){(0,W.defer)(F)},DeferHandler}();B.DeferHandler=z;var K=function(){function GlobalDeferHandler(){}return GlobalDeferHandler.instance=new z,GlobalDeferHandler}();B.GlobalDeferHandler=K}).call(this,G(49))},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.PluginlessCallStreamManager=B.SHARING_STREAM_DEFAULT_ID=B.VIDEO_STREAM_DEFAULT_ID=B.AUDIO_STREAM_DEFAULT_ID=void 0;var W=G(8),z=G(295),K=G(296),J=G(297),Q=G(305),Y=G(62),$=G(118);B.AUDIO_STREAM_DEFAULT_ID=1,B.VIDEO_STREAM_DEFAULT_ID=2,B.SHARING_STREAM_DEFAULT_ID=3;var X=function(){function PluginlessCallStreamManager(F,G,W,K,J,Y){this.participantId=F,this.mediaSession=G,this.localStats=W,this.imageRenderingSession=J,this.configProvider=Y,this.audioSourceIds=[],this.streams={},this.lightweightFrameUris=null,this.cachedSharingStreams=[],this.lastMiddleLaneStreamId=1;var X=W.receive(1,F),Z=W.receive(2,F);this.audio=new z.default(G,K,B.AUDIO_STREAM_DEFAULT_ID);var ee=new $.default(G,X,K,B.VIDEO_STREAM_DEFAULT_ID,this.configProvider),te=new Q.default(G,Z,K,B.SHARING_STREAM_DEFAULT_ID,this.configProvider);this.streams[0]=[ee],this.streams[1]=[te],this.streams[2]=[],this.logger=K.createChild("PluginlessCallStreamManager")}return PluginlessCallStreamManager.prototype.setMediaSession=function(F,B){this.logger.info("[".concat(B,"][setMediaSession]")),this.mediaSession=F,[[this.audio],this.streams[0],this.streams[1]].forEach((function(G){return G.forEach((function(G){return G.setMediaSession(F,B)}))}))},PluginlessCallStreamManager.prototype.updateStreams=function(F,B){this.logger.info("[".concat(B,"][updateStreams]"));var filterAndSortStreams=function(B){return F.filter((function(F){return F.type===B})).sort(PluginlessCallStreamManager.compareStreams)},G=filterAndSortStreams(Y.ngcStreamTypes.audio);0===G.length&&(G=filterAndSortStreams(Y.ngcStreamTypes.audioteleconference)),G.length>0&&(this.audioSourceIds=G.map((function(F){return F.sourceId})));var W=G[0];W&&this.audio.update(W,B),this.updateMediaStreams(filterAndSortStreams(Y.ngcStreamTypes.video),0,B),this.updateMediaStreams(filterAndSortStreams(Y.ngcStreamTypes.sharing),1,B)},PluginlessCallStreamManager.prototype.hasAudioSource=function(F){return this.audioSourceIds.some((function(B){return B===F}))||this.audio.id===F},PluginlessCallStreamManager.prototype.useLightweightStreams=function(F,B){this.lightweightFrameUris=F,this.streams[1].length&&(this.logger.info("[".concat(B,"][useLightweightStreams] frameUris updated, recreating sharing streams")),this.streams[1]=[],this.updateMediaStreams(this.cachedSharingStreams,1,B))},PluginlessCallStreamManager.prototype.useMiddleLaneStream=function(F,B,G){var z=this;this.logger.info("[".concat(G,"][useMiddleLaneStream] Updating middle-lane streams"));var K=this.getMiddleLaneInformation(F),Q=this.streams[2],Y=Q.filter((function(F){return!K.some((function(B){return PluginlessCallStreamManager.compareMiddleLaneStreams(F,B)}))}));Y.forEach((function(F){return W.remove(Q,F)})),Y.length&&this.logger.info("[".concat(G,"][useMiddleLaneStream] Removing ").concat(Y.length," middle-lane streams")),K.forEach((function(F){var K=W.find(Q,(function(B){return PluginlessCallStreamManager.compareMiddleLaneStreams(B,F)}));K||(K=new J.default(z.logger.createChild("MiddleLaneStream"),z.lastMiddleLaneStreamId++,F,B),z.logger.info("[".concat(G,"][useMiddleLaneStream] Adding middle-lane stream with metadata: ").concat(JSON.stringify(F))),Q.push(K))}))},PluginlessCallStreamManager.prototype.getMiddleLaneStreamInformation=function(F,B){var G,W,z=null,K=null;if(z=F.find((function(F){return"Middle Lane ULL Network"===F.deliveryPipelineType&&B===F.isPrimary}))){var J=z.urls;if(J&&J.length>0){var Q=z.identifier;Q||this.logger.warn("[getMiddleLaneStreamInformation]: no middle-lane stream identifier found, isPrimary: ".concat(B));var Y=null===(G=z.decryptionKey)||void 0===G?void 0:G.id,$=null===(W=z.decryptionKey)||void 0===W?void 0:W.value;Y&&$||this.logger.warn("[getMiddleLaneStreamInformation]: no valid middle-lane stream decryption key found, isPrimary: ".concat(B)),K={identifier:Q||"",streamingUrl:J[0],decryptionKey:Y&&$?{id:Y,value:$}:null}}else this.logger.info("[getMiddleLaneStreamInformation]: no middle-lane URLs found, isPrimary: ".concat(B))}else this.logger.info("[getMiddleLaneStreamInformation]: no middle-lane stream information found, isPrimary: ".concat(B));return K},PluginlessCallStreamManager.prototype.getMiddleLaneInformation=function(F){var B=[],G=null,W=null;for(var z in F){var K=F[z].streams;if(K){if(G)this.logger.info("[getMiddleLaneInformation]: primary middle-lane stream already found, skipping finding primary stream for participant: ".concat(z));else{var J=this.getMiddleLaneStreamInformation(K,!0);J?G=J:this.logger.info("[getMiddleLaneInformation]: no primary middle-lane stream found for participant: ".concat(z))}if(W)this.logger.info("[getMiddleLaneInformation]: alternate middle-lane stream already found, skipping finding alternate stream for participant: ".concat(z));else{var Q=this.getMiddleLaneStreamInformation(K,!1);Q?W=Q:this.logger.info("[getMiddleLaneInformation]: no alternate middle-lane stream found for participant: ".concat(z))}}else this.logger.warn("[getMiddleLaneInformation]: no stream information found for participant: ".concat(z))}return(G||W)&&B.push({primaryStreamInfo:G,altStreamInfo:W}),B},PluginlessCallStreamManager.compareStreams=function(F,B){var G="sendonly"===F.direction||"sendrecv"===F.direction,W="sendonly"===B.direction||"sendrecv"===B.direction;return G&&!W?-1:W&&!G?1:B.sourceId-F.sourceId},PluginlessCallStreamManager.compareMiddleLaneStreams=function(F,B){var G=F.getStreamMetadata();return G.sessionId===B.sessionId&&PluginlessCallStreamManager.compareMiddleLaneStreamInfo(G.primaryStreamInfo,B.primaryStreamInfo)&&PluginlessCallStreamManager.compareMiddleLaneStreamInfo(G.altStreamInfo,B.altStreamInfo)},PluginlessCallStreamManager.compareMiddleLaneStreamInfo=function(F,B){return!F&&!B||!(!F&&B||F&&!B)&&(F.identifier===B.identifier&&F.decryptionKey.id===B.decryptionKey.id&&F.decryptionKey.value===B.decryptionKey.value&&F.streamingUrl===B.streamingUrl)},PluginlessCallStreamManager.prototype.updateMediaStreams=function(F,B,G){var z=this,J=this.streams[B];1===B&&(this.cachedSharingStreams=F);var Y=J.filter((function(B){return!F.some((function(F){return F.sourceId===B.id}))}));Y.forEach((function(F){return W.remove(J,F)})),Y.length&&this.logger.info("[".concat(G,"][updateMediaStreams] Removing ").concat(Y.length," streams of type ").concat(B)),F.forEach((function(Y,X){var Z=W.find(J,(function(F){return F.id===Y.sourceId}));Z||(0===B?Z=new $.default(z.mediaSession,z.localStats.receive(1,z.participantId),z.logger,Y.sourceId,z.configProvider):1===B&&(Z=z.lightweightFrameUris?new K.default(z.logger,Y.sourceId,z.lightweightFrameUris,z.imageRenderingSession):new Q.default(z.mediaSession,z.localStats.receive(2,z.participantId),z.logger,Y.sourceId,z.configProvider)),z.logger.info("[".concat(G,"][updateMediaStreams] Adding stream ").concat(Y.sourceId," of type ").concat(B)),J.push(Z)),Z.update(Y,G),Z.rank=F.length-X}))},PluginlessCallStreamManager}();B.PluginlessCallStreamManager=X},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.LiveStreamStatistic=void 0;var z=G(32),K=G(77),J=function(){function PlayerScenario(F,B){this.name=F,this.start(B)}return PlayerScenario.prototype.complete=function(){K.assert(this.startTime,"not started"),K.assert(void 0===this.duration,"already completed"),this.duration=Date.now()-this.startTime},PlayerScenario.prototype.fail=function(F){this.failReason=F,this.complete()},PlayerScenario.prototype.getTelemetryEvent=function(){K.assert(this.startTime,"not started"),K.assert(void 0!==this.duration,"not completed");var F={name:this.name,startTime:this.startTime,duration:this.duration};return this.failReason&&(F.failReason=this.failReason),this.details&&(F.details=this.details),F},PlayerScenario.prototype.start=function(F){K.assert(!this.startTime,"already started"),this.startTime=Date.now(),this.details=F},PlayerScenario}(),Q=function(){function LiveStreamStatistic(F,B,G){this.config=F,this.logger=B,this.playerDiagnosticsLog=G,this.currentScenarioMap=new Map,this.playerEvents=[],this.playbackEvents=[],this.clientNetworkType=void 0,this.maxPlayerPlaybackEventCount=F.maxPlayerPlaybackEventCount||5,this.maxPlayerDiagnosticsCount=F.maxPlayerDiagnosticsCount||5,this.maxPlayerMemoryTraceLogCount=F.maxPlayerMemoryTraceLogCount||100,this.config.debug&&(this.playerDiagnosticsLog.memoryLog=[]),this.addNetworkTypeEventListener()}return LiveStreamStatistic.prototype.getPlayerDiagnosticSnapshot=function(){return this.currentPlayerDiagnosticSnapshot},LiveStreamStatistic.prototype.registerStatsUpdated=function(F){var B=this;this.currentPlayerDiagnosticSnapshot=F,Object.keys(this.playerDiagnosticsLog).forEach((function(G){var W=G,z=B.playerDiagnosticsLog[G];if(Array.isArray(z)){z.push(F[W]);var K="memoryLog"===W&&z.length>B.maxPlayerMemoryTraceLogCount,J="memoryLog"!==W&&z.length>B.maxPlayerDiagnosticsCount;(K||J)&&z.splice(0,1)}else B.playerDiagnosticsLog[G]=F[W]}))},LiveStreamStatistic.prototype.registerPlayerLoadAttempt=function(){this.registerScenario("Load")},LiveStreamStatistic.prototype.registerPlayerLoadSucceeded=function(){this.completeScenario("Load")},LiveStreamStatistic.prototype.registerPlayerLoadFailed=function(F){this.completeScenario("Load",F)},LiveStreamStatistic.prototype.registerPlayerSetupAttempt=function(){this.registerScenario("Setup")},LiveStreamStatistic.prototype.registerPlayerSetupSucceeded=function(){this.completeScenario("Setup")},LiveStreamStatistic.prototype.registerPlayerSetupFailed=function(F){this.completeScenario("Setup",F)},LiveStreamStatistic.prototype.registerSetSourceAttempt=function(F){this.registerScenario("SetSource",F)},LiveStreamStatistic.prototype.registerSetSourceSucceeded=function(){this.completeScenario("SetSource")},LiveStreamStatistic.prototype.registerSetSourcedFailed=function(F){this.completeScenario("SetSource",F)},LiveStreamStatistic.prototype.registerSdnPluginLoad=function(F,B){this.registerScenario("SdnPluginLoad",F);var G=B?void 0:"script load failed";this.completeScenario("SdnPluginLoad",G)},LiveStreamStatistic.prototype.registerPlayerDestroyed=function(){this.registerScenario("Destroyed"),this.completeScenario("Destroyed")},LiveStreamStatistic.prototype.registerPlaybackStateChanged=function(F){this.registerPlaybackEvent("StateChanged",F)},LiveStreamStatistic.prototype.registerPlaybackError=function(F,B){this.registerPlaybackEvent("Error",{errorType:F,details:B})},LiveStreamStatistic.prototype.registerDownloadBitratechanged=function(F){this.registerPlaybackEvent("BitrateChangedDownload",F)},LiveStreamStatistic.prototype.registerPlaybackBitratechanged=function(F){this.registerPlaybackEvent("BitrateChangedPlayback",F)},LiveStreamStatistic.prototype.registerPotentialMediaFreeze=function(F){this.registerPlaybackEvent("PotentialMediaFreeze",F)},LiveStreamStatistic.prototype.registerCaptionToggle=function(F,B,G){var W={isEnabled:F,culture:B,playerTime:G};this.registerPlaybackEvent("CaptionsToggled",W)},LiveStreamStatistic.prototype.registerFullScreenChange=function(F){this.registerPlaybackEvent("FullscreenChanged",F)},LiveStreamStatistic.prototype.registerMute=function(F){this.registerPlaybackEvent("Mute",F)},LiveStreamStatistic.prototype.registerVolumeChange=function(F){this.registerPlaybackEvent("Volume",F)},LiveStreamStatistic.prototype.getReport=function(F){var B,G,K;void 0===F&&(F={});var J=this.playerEvents.map((function(F){return F.getTelemetryEvent()})),Q=this.playbackEvents;return W(W(W(W(W(W(W({isFullReport:!0,configIds:F.configIds||"",correlationId:F.correlationId||"",eTag:F.eTag||"",isFinal:null!==(B=F.isFinal)&&void 0!==B&&B,isIframe:1===this.config.loadType,isOverflow:null!==(G=F.overflow)&&void 0!==G&&G,isFullscreenButtonDisabled:null!==(K=F.disableFullscreenButton)&&void 0!==K&&K,threadId:F.threadId||"",telemetryTickMs:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.statsInterval?this.currentPlayerDiagnosticSnapshot.statsInterval:-1,tsCallingVersion:(0,z.getTsCallingVersion)()||""},this.getInitializationReport(J,Q)),this.getPlaybackReport(Q)),this.getBitrateReport(Q)),this.getSdnReport(J)),this.getSetSourceReport(J)),{networkType:this.getClientNetworkType()}),this.getPlayerDiagnosticLog())},LiveStreamStatistic.prototype.registerPlaybackEvent=function(F,B){var G={eventType:F,timestamp:Date.now(),currentPlayPosition:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.currentPlayPosition?this.currentPlayerDiagnosticSnapshot.currentPlayPosition:-1};void 0!==B&&(G.payload=this.prepareForTelemetry(B)),this.playbackEvents.push(G),this.playbackEvents.length>this.maxPlayerPlaybackEventCount&&this.playbackEvents.splice(0,1),this.logTelemetryEvent(G)},LiveStreamStatistic.prototype.getPlayerDiagnosticLog=function(){var F=this;if(!this.currentPlayerDiagnosticSnapshot)return{};var B=this.currentPlayerDiagnosticSnapshot,G=this.playerDiagnosticsLog,z=W(W({},B),G),K={};return Object.keys(z).forEach((function(B){K["player_".concat(B)]=F.prepareForTelemetry(z[B])})),K},LiveStreamStatistic.prototype.getPlayerDiagnosticSnapshotTelemetry=function(){var F=this;if(!this.currentPlayerDiagnosticSnapshot)return{};var B={};return Object.keys(this.currentPlayerDiagnosticSnapshot).forEach((function(G){B["player_".concat(G)]=F.prepareForTelemetry(F.currentPlayerDiagnosticSnapshot[G])})),W({isFullReport:!1,telemetryTickMs:this.currentPlayerDiagnosticSnapshot&&this.currentPlayerDiagnosticSnapshot.statsInterval?this.currentPlayerDiagnosticSnapshot.statsInterval:-1},B)},LiveStreamStatistic.prototype.getInitializationReport=function(F,B){var G=F.find((function(F){return"Load"===F.name})),W=B.find((function(F){return"StateChanged"===F.eventType&&"Ready"===F.payload}));return{init_timeLoadToReady:(G&&W?W.timestamp-G.startTime:-1)||-1,init_allEvents:this.prepareForTelemetry(F)}},LiveStreamStatistic.prototype.getPlaybackReport=function(F){var B=F.filter((function(F){return"StateChanged"===F.eventType})),G=B.find((function(F){return"Ready"===F.payload})),W=B.find((function(F){return"Play"===F.payload})),z=B.find((function(F){return"Start"===F.payload})),K=B.find((function(F){return"Playing"===F.payload})),J=G&&W?W.timestamp-G.timestamp:-1,Q=W&&z?z.timestamp-W.timestamp:-1,Y=z&&K?K.timestamp-z.timestamp:-1,$=B.filter((function(F){return"Seeked"===F.payload})),X=B.filter((function(F){return"Seeking"===F.payload})),Z=B.filter((function(F){return"Paused"===F.payload})),ee=B.filter((function(F){return"Resume"===F.payload})),te=B.filter((function(F){return"Buffering"===F.payload})),ne=["BitrateChangedDownload","BitrateChangedPlayback","Error","Mute","StateChanged","Volume"],ie=F.filter((function(F){return"Error"===F.eventType})),re=F.filter((function(F){return"Volume"===F.eventType||"Mute"===F.eventType})),oe=F.filter((function(F){return!ne.includes(F.eventType)}));return{playback_timeReadyToPlay:J,playback_timePlayToStart:Q,playback_timeStartToPlaying:Y,playback_bufferingEvents:this.prepareForTelemetry(te),playback_errorEvents:this.prepareForTelemetry(ie),playback_pauseEvents:this.prepareForTelemetry(Z),playback_resumeEvents:this.prepareForTelemetry(ee),playback_otherEvents:this.prepareForTelemetry(oe),playback_seekedEvents:this.prepareForTelemetry($),playback_seekingEvents:this.prepareForTelemetry(X),playback_stateChangeEvents:this.prepareForTelemetry(B),playback_volumeEvents:this.prepareForTelemetry(re)}},LiveStreamStatistic.prototype.getBitrateReport=function(F){var B=F.filter((function(F){return"BitrateChangedDownload"===F.eventType})),G=B.sort((function(F){return Number(F.payload)})),z=B.length?{bitrate_downloadChanges:this.prepareForTelemetry(B),bitrate_downloadChangeCount:B.length||-1,bitrate_downloadMin:G[0].payload||-1,bitrate_downloadMax:G[G.length-1].payload||-1}:{},K=F.filter((function(F){return"BitrateChangedPlayback"===F.eventType})),J=K.sort((function(F){return Number(F.payload)})),Q=K.length?{bitrate_playbackChanges:this.prepareForTelemetry(K),bitrate_playbackChangeCount:K.length||-1,bitrate_playbackMin:J[0].payload||-1,bitrate_playbackMax:J[J.length-1].payload||-1}:{};return W(W({},z),Q)},LiveStreamStatistic.prototype.addNetworkTypeEventListener=function(){var F,B,G,W,z=this;(null===(B=null===(F=window.navigator)||void 0===F?void 0:F.connection)||void 0===B?void 0:B.type)&&(null===(W=null===(G=window.navigator)||void 0===G?void 0:G.connection)||void 0===W||W.addEventListener("change",(function(){return z.updateClientNetworkType()})))},LiveStreamStatistic.prototype.updateClientNetworkType=function(){this.clientNetworkType=void 0,this.getClientNetworkType()},LiveStreamStatistic.prototype.getClientNetworkType=function(){var F,B,G,W;if(void 0===this.clientNetworkType){var z="Unknown";if(null===(B=null===(F=window.navigator)||void 0===F?void 0:F.connection)||void 0===B?void 0:B.type){var K=null===(W=null===(G=window.navigator)||void 0===G?void 0:G.connection)||void 0===W?void 0:W.type;if(K)switch(K){case"cellular":z="WWAN";break;case"ethernet":z="Wired";break;case"wifi":z="Wireless";break;default:z="Unknown"}}this.clientNetworkType=z}return this.clientNetworkType},LiveStreamStatistic.prototype.getSdnReport=function(F){var B=F.filter((function(F){return"SdnPluginLoad"===F.name})),G=B.length?B[B.length-1]:void 0;return{sdn_loaded:!(!G||void 0!==G.failReason),sdn_details:G&&G.details||"",sdn_error:G&&G.failReason||"",sdn_events:this.prepareForTelemetry(B)}},LiveStreamStatistic.prototype.getSetSourceReport=function(F){var B=F.filter((function(F){return"SetSource"===F.name})),G=B.length?B[B.length-1]:void 0;return{stream_url:G&&G.details||"",stream_id:G&&G.details&&this.getStreamIdFromStreamUrl(G.details)||"",set_source_events:this.prepareForTelemetry(B)}},LiveStreamStatistic.prototype.registerScenario=function(F,B){K.assert(!this.currentScenarioMap.has(F),"previous scenario is not completed");var G=new J(F,B);this.currentScenarioMap.set(F,G),this.playerEvents.push(G)},LiveStreamStatistic.prototype.completeScenario=function(F,B){var G=this.currentScenarioMap.get(F);K.assert(G,"no scenario to complete"),B?G.fail(B):G.complete(),this.currentScenarioMap.delete(F)},LiveStreamStatistic.prototype.logTelemetryEvent=function(F){this.config.debug&&(this.logger.debug("PlayerTelemetryEvent: ".concat(JSON.stringify(F))),this.logger.debug("PlayerDiagnosticData: ".concat(JSON.stringify(this.currentPlayerDiagnosticSnapshot))))},LiveStreamStatistic.prototype.prepareForTelemetry=function(F){return"boolean"==typeof F?F:"string"==typeof F||void 0===F?F||"":"number"==typeof F?null!=F?F:-1:JSON.stringify(F)},LiveStreamStatistic.prototype.getStreamIdFromStreamUrl=function(F){var B=new URL(F).pathname;if(B){var G=B.split("/");if((null==G?void 0:G.length)>1)return G[1]}return""},LiveStreamStatistic}();B.LiveStreamStatistic=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(60),J=G(63),Q=G(61),Y=G(119),$=function(F){function VideoStream(B,G,W,z,K){var J=F.call(this,B,W,z)||this;return J.rendererStats=G,J.configProvider=K,J.rawIncomingVideoStreamManager=new Y.RawIncomingVideoStreamManager(J.logger.createChild("rawVideoStream")),J.type=0,J}return z(VideoStream,F),Object.defineProperty(VideoStream.prototype,"mediaSourceId",{get:function(){return this.id},enumerable:!1,configurable:!0}),VideoStream.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,msi:this.mediaSourceId,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},VideoStream.prototype.stop=function(){return this.mediaSessionInitPromise.reject(new Error("Video stream stopped")),Promise.resolve(void 0)},VideoStream.prototype.getRawStream=function(F){return this.rawIncomingVideoStreamManager.createIRawStreamClient(this,this.mediaSession.getSubscriptionManager())},VideoStream.prototype.start=function(F,B){var G=this;return this.logger.info("video start: target=".concat(F,", options=").concat(JSON.stringify(B))),this.mediaSessionInitPromise.promise.then((function(){return new J.RemoteVideoRenderer(F,G.mediaSession,G.rendererStats,G.configProvider)})).then((function(F){return B&&F.setScalingMode(B.scalingMode),G.logger.info("subscribeVideoAsync: videoRenderer=".concat(F,", id=").concat(G.id)),F.subscribeVideoAsync(G).catch((function(B){throw F.dispose(),B})).then((function(){return G.configProvider.config.isStreamingMatchIsRendering||(G.isStreaming=!0),F}))}))},VideoStream.prototype.update=function(B,G){this.logger.info("[".concat(G,"][update] stream=").concat(JSON.stringify(B)));var W=this.isAvailable;F.prototype.update.call(this,B,G),this.isAvailable&&this.isAvailable!==W&&this.rendererStats.event(K.MediaReceiverEvent.Available)},VideoStream}(Q.default);B.default=$},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.RawIncomingVideoStreamManager=B.RawIncomingAudioStreamManager=void 0;var K,J=G(306),Q=G(307);!function(F){F[F.Audio=0]="Audio",F[F.Video=1]="Video"}(K||(K={}));var Y=function(){function RawIncomingStreamBase(){this.handlerMap=new Map}return RawIncomingStreamBase.prototype.dispose=function(){this.handlerMap.forEach((function(F){return F.client().dispose()})),this.handlerMap.clear()},RawIncomingStreamBase.prototype.handlerAdded=function(F){var B=this,G=F.client();G.on("clientDisposed",(function(){return B.deleteRawStreamManagerById(G.clientId)})),this.handlerMap.set(G.clientId,F)},RawIncomingStreamBase.prototype.deleteRawStreamManagerById=function(F){this.handlerMap.delete(F)},RawIncomingStreamBase}(),$=function(F){function RawIncomingAudioStreamManager(B){var G=F.call(this)||this;return G.logger=B,G}return z(RawIncomingAudioStreamManager,F),RawIncomingAudioStreamManager.prototype.streamChanged=function(F){this.handlerMap.forEach((function(B){return B.updateAndNotifyClient(F)}))},RawIncomingAudioStreamManager.prototype.createIRawStreamClient=function(B){var G=new J.RawIncomingAudioStreamClientHandler(B,this.logger);return F.prototype.handlerAdded.call(this,G),G.client()},RawIncomingAudioStreamManager}(Y);B.RawIncomingAudioStreamManager=$;var X=function(F){function RawIncomingVideoStreamManager(B){var G=F.call(this)||this;return G.logger=B,G}return z(RawIncomingVideoStreamManager,F),RawIncomingVideoStreamManager.prototype.createIRawStreamClient=function(B,G){var W=new Q.RawIncomingVideoStreamClientHandler(B,G,this.logger);return F.prototype.handlerAdded.call(this,W),W.client()},RawIncomingVideoStreamManager}(Y);B.RawIncomingVideoStreamManager=X},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ScreenSharingControlProtocol=void 0,function(F){var B=7,G=3;function encodeMouseEvent(F){if(!F)return new Uint8Array(0);F.buttonType||(F.buttonType=0),F.xPos||(F.xPos=0),F.yPos||(F.yPos=0),F.wheelRotation||(F.wheelRotation=0);var G=new ArrayBuffer(B),W=new DataView(G),z=(3&F.type)<<0,K=(7&F.buttonType)<<2,J=(F.buttonDown?1:0)<<5,Q=(F.wheelButtonDown?1:0)<<6,Y=0;return W.setUint8(0,1),W.setUint8(1,z|K|J|Q|Y),W.setUint16(2,F.xPos,!0),W.setUint16(4,F.yPos,!0),W.setUint8(6,F.wheelRotation),new Uint8Array(G)}function encodeKeyboardEvent(F){var B=new ArrayBuffer(G),W=new DataView(B),z=(3&F.codeType)<<0,K=0,J=(F.keyUp?1:0)<<4,Q=(F.repeat?1:0)<<5,Y=0,$=0;return W.setUint8(0,0),W.setUint8(1,z|K|J|Q|Y|$),W.setUint8(2,F.code),new Uint8Array(B)}function decodeEventType(F){return F[0]}function decodeMouseEvent(F){if(1!==F[0]||F.length!==B)return null;var G=new DataView(F.buffer),W=G.getUint8(1);return{type:3&W,buttonType:W>>2&7,buttonDown:!!(W>>5&1),wheelButtonDown:!!(W>>6&1),xPos:G.getUint16(2,!0),yPos:G.getUint16(4,!0),wheelRotation:G.getUint8(6)}}function decodeKeyboardEvent(F){if(0!==F[0]||F.length!==G)return null;var B=new DataView(F.buffer),W=B.getUint8(1);return{codeType:3&W,code:B.getUint8(2),repeat:!!(W>>5&1),keyUp:!!(W>>4&1)}}F.encodeMouseEvent=encodeMouseEvent,F.encodeKeyboardEvent=encodeKeyboardEvent,F.decodeEventType=decodeEventType,F.decodeMouseEvent=decodeMouseEvent,F.decodeKeyboardEvent=decodeKeyboardEvent}(B.ScreenSharingControlProtocol||(B.ScreenSharingControlProtocol={}))},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.sendIsVirtualInputSupportedMessage=B.EdgeControlInjectorApi=void 0;var K=G(315),J="ncbjelpjchkpbikbpkcchkhkblodoama",Q=function(){function EdgeControlInjectorApi(F){this.logger=F}return EdgeControlInjectorApi.prototype.sendInjectInputEventMessage=function(F,B){return W(this,void 0,void 0,(function(){var G=this;return z(this,(function(W){return this.logger.info("EdgeControlInjectorApi - sendInjectInputEventMessage"),[2,new Promise((function(W,z){window.top.chrome.runtime.sendMessage(J,{api:F,deviceId:G.virtualInputDeviceId,event:B},(function(F){F.error?z(F.error.message):W(0)}))}))]}))}))},EdgeControlInjectorApi.prototype.createInputDeviceId=function(F,B,G){return W(this,void 0,void 0,(function(){var W,K;return z(this,(function(z){switch(z.label){case 0:this.virtualInputDeviceId&&this.logger.warn("EdgeControlInjectorApi - createInputDeviceId virtual input already exists."),z.label=1;case 1:return z.trys.push([1,3,,4]),W=this,[4,this.sendCreateInputDeviceMessage(F,G)];case 2:return W.virtualInputDeviceId=z.sent(),[3,4];case 3:return K=z.sent(),this.logger.error("EdgeControlInjectorApi - createInputDevice failed, error: ".concat(JSON.stringify(K))),B(),[3,4];case 4:return[2]}}))}))},EdgeControlInjectorApi.prototype.sendSetLocalUserAvatarMessage=function(F){return W(this,void 0,void 0,(function(){var B;return z(this,(function(G){switch(G.label){case 0:return[4,this.generateAvatarBitmap(F)];case 1:return B=G.sent(),[2,new Promise((function(F,G){var W=window.top;B&&W.chrome.runtime.sendMessage(J,{api:"setLocalUserAvatar",avatarBitmap:B},(function(B){B.error?G(B.error.message):F()}))}))]}}))}))},EdgeControlInjectorApi.prototype.sendCloseVirtualInputDeviceMessage=function(){return W(this,void 0,void 0,(function(){var F,B=this;return z(this,(function(G){return(F=this.virtualInputDeviceId)?(this.logger.info("EdgeControlInjectorApi - sendCloseVirtualInputDeviceMessage called"),[2,new Promise((function(G,W){var z=window.top;z.chrome.runtime.sendMessage(J,{api:"closeInputDevice",deviceId:F},(function(F){F?F.error?W(F.error.message):(B.virtualInputDeviceId=null,G(F.deviceId)):W(z.chrome.runtime.lastError.message)}))}))]):(this.logger.info("EdgeControlInjectorApi - VirtualInputDevice does not exists, nothing to close."),[2,Promise.resolve()])}))}))},EdgeControlInjectorApi.prototype.sendCreateInputDeviceMessage=function(F,B){return W(this,void 0,void 0,(function(){var G;return z(this,(function(W){switch(W.label){case 0:return this.logger.info("EdgeControlInjectorApi - sendCreateInputDeviceMessage called"),[4,this.generateAvatarBitmap(B)];case 1:return G=W.sent(),[2,new Promise((function(B,W){var z=window.top,messageCallback=function(F){F?F.deviceId?B(F.deviceId):F.error?W(F.error.message):W("Error: Unexpected response from API"):W(z.chrome.runtime.lastError.message)};G?z.chrome.runtime.sendMessage(J,{api:"createInputDevice",mediaStreamTrackId:F,avatarBitmap:G},messageCallback):z.chrome.runtime.sendMessage(J,{api:"createInputDevice",mediaStreamTrackId:F},messageCallback)}))]}}))}))},EdgeControlInjectorApi.prototype.generateAvatarBitmap=function(F){return W(this,void 0,void 0,(function(){var B,G,W;return z(this,(function(z){switch(z.label){case 0:if(!F)return[2,null];z.label=1;case 1:return z.trys.push([1,3,,4]),B=32,[4,(0,K.pngBase64ToBitmap)(F,B,B)];case 2:return G=z.sent(),[2,{width:B,height:B,data:G}];case 3:return W=z.sent(),this.logger.error("EdgeControlInjectorApi - generateAvatarBitmap error: ".concat(JSON.stringify(W),", continue without avatar.")),[2,null];case 4:return[2]}}))}))},EdgeControlInjectorApi}();function sendIsVirtualInputSupportedMessage(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){return[2,new Promise((function(B,G){F.info("EdgeControlInjectorApi - sendIsVirtualInputSupportedMessage");var W=window.top;W.chrome.runtime.sendMessage(J,{api:"isVirtualInputSupported"},(function(F){F?F.error?B(F.error.message):B(F):G(W.chrome.runtime.lastError.message)}))}))]}))}))}B.EdgeControlInjectorApi=Q,B.sendIsVirtualInputSupportedMessage=sendIsVirtualInputSupportedMessage},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)},J=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},Q=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.streamTypeToString=B.PictureInPicture=void 0;var Y=G(6),$=G(110),X=G(323),Z=G(324),ee=G(325),te=G(123),ne=G(1),ie=G(8),re=16/9,oe=function(F){function PictureInPicture(B,G,W){var z=F.call(this,G)||this;z.configProvider=B,z.logger=G,z.call=W,z.enablePictureInPicture=!1,z.isInitialized=!1,z.isStarting=!1,z.pictureInPictureWindow=null,z.streamProvider=null,z.streamPipelines=new Map,z.activeStream=null,z.overlayTransformer=new ee.OverlayTransformer,z.fallbackStreamProvider=null,z.pipSubs=[],z.statistics=new te.PictureInPictureStatistics(z.configProvider.config.pictureInPictureStatisticsBufferSize),z.enablePictureInPicture=z.configProvider.config.enablePictureInPicture,z.streamPipelines.set(1,new ee.PictureInPictureStreamPipeline(z.configProvider,new ee.LetterboxToAspectRatioTransformer(re),z.overlayTransformer)),z.streamPipelines.set(0,new ee.PictureInPictureStreamPipeline(z.configProvider,new ee.CropToAspectRatioTransformer(re),z.overlayTransformer)),z.streamPipelines.set("default",new ee.PictureInPictureStreamPipeline(z.configProvider,z.overlayTransformer));var K=null===window||void 0===window?void 0:window.webMA;return K&&(K.requestPictureInPicture=function(){console.log("Starting in call PiP from webMA.."),z.start()},K.leavePictureInPicture=function(){console.log("Stopping in call PiP from webMA.."),z.stop()}),z}return z(PictureInPicture,F),Object.defineProperty(PictureInPicture.prototype,"isActive",{get:function(){var F;return!!(null===(F=this.pictureInPictureWindow)||void 0===F?void 0:F.isActive)},enumerable:!1,configurable:!0}),Object.defineProperty(PictureInPicture.prototype,"pictureInPictureSupported",{get:function(){return this.enablePictureInPicture},enumerable:!1,configurable:!0}),PictureInPicture.prototype.dispose=function(){var F,B,G;return J(this,void 0,void 0,(function(){return Q(this,(function(W){switch(W.label){case 0:return this.isInitialized=!1,this.isActive?[4,this.pictureInPictureWindow.stop()]:[3,2];case 1:W.sent(),W.label=2;case 2:return this.detachActionhandlers(),[4,null===(F=this.pictureInPictureWindow)||void 0===F?void 0:F.dispose()];case 3:return W.sent(),this.pictureInPictureWindow=null,null===(B=this.streamProvider)||void 0===B||B.dispose(),this.streamProvider=null,null===(G=this.activeStream)||void 0===G||G.dispose(),this.activeStream=null,this.pipSubs.forEach((function(F){null==F||F.dispose()})),this.logger.debug((0,ne.stringifyObject)(this.getStats())),[2]}}))}))},PictureInPicture.prototype.start=function(){return J(this,void 0,void 0,(function(){var F,B;return Q(this,(function(G){switch(G.label){case 0:if(!this.pictureInPictureSupported)return[2];if(this.isInitialized||this.init(),this.isActive||this.isStarting)return this.logger.info("Picture-in-picture is currently active, skipping start"),[2];G.label=1;case 1:return G.trys.push([1,3,4,5]),this.isStarting=!0,[4,Promise.all([this.pictureInPictureWindow.start(),this.streamProvider.start()])];case 2:return G.sent(),this.statistics.pictureInPictureStarted(),[3,5];case 3:return F=G.sent(),B=(0,ne.stringifyObject)(F),this.logger.error("Error starting PiP: ".concat(B)),this.statistics.addError("FailedToStart",B),this.streamProvider.stop(),[3,5];case 4:return this.isStarting=!1,[7];case 5:return[2]}}))}))},PictureInPicture.prototype.stop=function(){return J(this,void 0,void 0,(function(){return Q(this,(function(F){switch(F.label){case 0:return this.isActive?[4,this.pictureInPictureWindow.stop()]:[3,2];case 1:F.sent(),F.label=2;case 2:return[2]}}))}))},PictureInPicture.prototype.updateActionHandlerStatus=function(){if(this.isActive){var F=navigator.mediaSession;F.setMicrophoneActive(!(this.call.isMuted||this.call.isServerMuted)),F.setCameraActive(this.call.isVideoOn)}},PictureInPicture.prototype.getStats=function(){var F=this.statistics.getReport(),B={};return this.streamPipelines.forEach((function(F,G){var W="default"===G?G:streamTypeToString(G);B[W]=F.getStats()})),K(K({},F),{pipelines:B})},PictureInPicture.prototype.getReport=function(){return(0,ie.mapValues)(this.getStats(),ne.stringifyObject)},PictureInPicture.prototype.setFallbackStreamProvider=function(F){var B;this.fallbackStreamProvider=F,null===(B=this.streamProvider)||void 0===B||B.setFallbackStreamProvider(F)},PictureInPicture.prototype.setOverlayProvider=function(F){this.overlayTransformer.setOverlayProvider(F)},PictureInPicture.prototype.onWindowStopped=function(){return J(this,void 0,void 0,(function(){var F;return Q(this,(function(B){return this.streamProvider.stop(),this.statistics.pictureInPictureStopped(),F=this.activeStream,this.activeStream=null,null==F||F.dispose(),[2]}))}))},PictureInPicture.prototype.init=function(){var F=this;if(!this.pictureInPictureSupported)return this.logger.error("PictureInPicture is not supported."),this.statistics.addError("PiPIsNotSupported"),void this.dispose();this.pictureInPictureWindow=new X.PictureInPictureWindowContainer(this.logger),this.streamProvider=new Z.PictureInPictureStreamProvider(this.logger,this.call),this.streamProvider.setFallbackStreamProvider(this.fallbackStreamProvider),this.attachActionHandlers(),this.pipSubs.push(this.call.on("callStateChanged",(function(){return F.onCallStateChanged()})),this.pictureInPictureWindow.on("onActiveStateChanged",(function(B){return J(F,void 0,void 0,(function(){return Q(this,(function(F){switch(F.label){case 0:return this.event("activeStateChanged").raise(B),B?[3,2]:[4,this.onWindowStopped()];case 1:F.sent(),F.label=2;case 2:return[2]}}))}))})),this.pictureInPictureWindow.on("onResize",(function(B){return F.onResize(B)})),this.streamProvider.on("onCurrentActiveStreamChanged",(function(B){return J(F,void 0,void 0,(function(){return Q(this,(function(F){switch(F.label){case 0:return[4,this.attachStream(B)];case 1:return F.sent(),[2]}}))}))}))),this.isInitialized=!0},PictureInPicture.prototype.onResize=function(F){var B,G,W=F.height,z=W*re;G=Math.abs(z-F.width)<1?F:{width:Math.round(z),height:W},this.overlayTransformer.setWindowSize(G),null===(B=this.streamProvider)||void 0===B||B.setFallbackStreamSize(G)},PictureInPicture.prototype.onCallStateChanged=function(){return J(this,void 0,void 0,(function(){return Q(this,(function(F){switch(F.label){case 0:return(0,$.callStateIsAnyOf)(this.call.state,[7,6,4])?[4,this.dispose()]:[3,2];case 1:F.sent(),F.label=2;case 2:return[2]}}))}))},PictureInPicture.prototype.attachStream=function(F){var B,G;return J(this,void 0,void 0,(function(){var W,z,K;return Q(this,(function(J){switch(J.label){case 0:return W=null!==(B=this.streamPipelines.get(F.streamType))&&void 0!==B?B:this.streamPipelines.get("default"),z=W.getTransformedStream(F),this.overlayTransformer.setStreamInfo(F.participant,F.streamType),this.pictureInPictureWindow.setVideoSource(z.mediaStream),this.statistics.streamAttached(null===(G=F.participant)||void 0===G?void 0:G.mri,F.streamType),K=this.activeStream,this.activeStream=z,[4,null==K?void 0:K.dispose()];case 1:return J.sent(),[2]}}))}))},PictureInPicture.prototype.attachActionHandlers=function(){var F=this;try{var B=navigator.mediaSession;B.setMicrophoneActive(!this.call.isMuted),B.setCameraActive(this.call.isVideoOn),B.setActionHandler("togglemicrophone",(function(){return J(F,void 0,void 0,(function(){return Q(this,(function(F){switch(F.label){case 0:return this.call.isMuted?[4,this.call.unmute()]:[3,2];case 1:return F.sent(),[3,4];case 2:return[4,this.call.mute()];case 3:F.sent(),F.label=4;case 4:return B.setMicrophoneActive(!(this.call.isMuted||this.call.isServerMuted)),[2]}}))}))})),B.setActionHandler("togglecamera",(function(){return J(F,void 0,void 0,(function(){return Q(this,(function(F){switch(F.label){case 0:return this.call.isVideoOn?[4,this.call.stopVideo()]:[3,2];case 1:return F.sent(),[3,4];case 2:return[4,this.call.startVideo()];case 3:F.sent(),F.label=4;case 4:return B.setCameraActive(this.call.isVideoOn),[2]}}))}))})),B.setActionHandler("hangup",(function(){return J(F,void 0,void 0,(function(){var F;return Q(this,(function(B){switch(B.label){case 0:return B.trys.push([0,2,,3]),[4,this.call.stop()];case 1:return B.sent(),[3,3];case 2:return F=B.sent(),this.logger.error("Error trying to stop call from PiP: ".concat((0,ne.stringifyObject)(F))),[3,3];case 3:return[4,this.stop()];case 4:return B.sent(),[2]}}))}))}))}catch(F){var G="Error attaching action handlers: ".concat((0,ne.stringifyObject)(F));this.logger.error(G),this.statistics.addError("ActionHandlersError",G)}},PictureInPicture.prototype.detachActionhandlers=function(){try{navigator.mediaSession.setActionHandler("togglemicrophone",null),navigator.mediaSession.setActionHandler("togglecamera",null),navigator.mediaSession.setActionHandler("hangup",null)}catch(B){var F="Error detaching action handlers: ".concat((0,ne.stringifyObject)(B));this.logger.error(F),this.statistics.addError("ActionHandlersError",F)}},PictureInPicture}(Y.default);function streamTypeToString(F){switch(F){case 0:return"video";case 1:return"screensharing";case 2:return"middlelane";default:return"fallback"}}B.PictureInPicture=oe,B.streamTypeToString=streamTypeToString},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.PipelineStatistics=B.TransformerStatistics=B.PictureInPictureStatistics=void 0;var W=G(48),z=G(50),K=G(122),J=function(){function PictureInPictureStatistics(F){this.timesStarted=0,this.totalDuration=0,this.lastStartedTimestamp=null,this.errors=new z.UntilFullStatsBuffer(F),this.events=new z.SlidingWindow(F)}return PictureInPictureStatistics.prototype.pictureInPictureStarted=function(){this.timesStarted+=1,this.lastStartedTimestamp=Date.now(),this.addEvent("PiPStarted")},PictureInPictureStatistics.prototype.pictureInPictureStopped=function(){if(null!==this.lastStartedTimestamp){var F=Date.now()-this.lastStartedTimestamp;this.totalDuration+=F,this.lastStartedTimestamp=null}this.addEvent("PiPStopped")},PictureInPictureStatistics.prototype.streamAttached=function(F,B){this.addEvent("StreamAttached",{mri:F,streamType:(0,K.streamTypeToString)(B)})},PictureInPictureStatistics.prototype.addError=function(F,B){this.errors.add({type:F,message:B,timestamp:Date.now()})},PictureInPictureStatistics.prototype.clearErrors=function(){this.errors.clear()},PictureInPictureStatistics.prototype.addEvent=function(F,B){this.events.add({type:F,data:B,timestamp:Date.now()})},PictureInPictureStatistics.prototype.clearEvents=function(){this.events.clear()},PictureInPictureStatistics.prototype.getReport=function(){var F=0;return this.lastStartedTimestamp&&(F=Date.now()-this.lastStartedTimestamp),{timesStarted:this.timesStarted,totalDuration:this.totalDuration+F,errors:this.errors.items,events:this.events.items}},PictureInPictureStatistics}();B.PictureInPictureStatistics=J;var Q=function(){function TransformerStatistics(F){this.transformerName=F,this.frameCount=0,this.stopwatch=new W.Stopwatch,this.stopwatch.pause()}return Object.defineProperty(TransformerStatistics.prototype,"totalTime",{get:function(){return this.stopwatch.duration()},enumerable:!1,configurable:!0}),TransformerStatistics.prototype.start=function(){this.stopwatch.isPaused&&(this.frameCount++,this.stopwatch.resume())},TransformerStatistics.prototype.stop=function(){this.stopwatch.isPaused||this.stopwatch.pause()},TransformerStatistics.prototype.getStats=function(){return{name:this.transformerName,totalTime:this.totalTime}},TransformerStatistics}();B.TransformerStatistics=Q;var Y=function(){function PipelineStatistics(F,B){this.transformerStats=[],this.errors=new z.UntilFullStatsBuffer(F),this.transformerStats=B.map((function(F){return new Q(F.constructor.name)}))}return PipelineStatistics.prototype.addError=function(F,B){this.errors.add({transformerIndex:F,message:B,timestamp:Date.now()})},PipelineStatistics.prototype.clearErrors=function(){this.errors.clear()},PipelineStatistics.prototype.getReport=function(){return{frameCount:this.transformerStats[0].frameCount,transformerStats:this.transformerStats.map((function(F){return F.getStats()})),errors:this.errors.items}},PipelineStatistics}();B.PipelineStatistics=Y},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.MediaAgentError=void 0;var Q=G(27),Y=G(326),$=G(327),X=G(328),Z=G(329),ee=G(331),te=G(454),ne=G(455),ie=G(467),re=G(34),oe=function(){function MediaAgentProvider(F,B,G){var W,z,K=this;null!==(W=F.logger)&&void 0!==W||(F.logger=new Y.default),null!==(z=F.domOverrides)&&void 0!==z||(F.domOverrides={}),this.config=F;var J=F.mediaSettings;this.logger=new ie.default(F.safeLogger&&F.safeLogger.createChild("MA",J.debug),F.logger.createChild("MA",J.debug)),this.configProvider=new Z.default(this.logger.createChild("configProvider"),G,J);var Q=new te.DeviceManagerDiagnostics(this.configProvider);this.mediaAgentDiagnostics=new ne.MediaAgentDiagnostics(this.configProvider,Q),this.ufdManager=new X.UFDManager(this.logger.createChild("UFD"),this.configProvider),this.deviceManager=new ee.default(this.logger.createChild("DeviceManager"),this.configProvider,Q,F.domOverrides,this.ufdManager,F.webcvProvider,F.wasmdnsProvider,F.wasmaecProvider),this.capabilities=new $.default(this.configProvider),B.on("OnECSChanged",(function(){var F=B.getEcsConfig("SkypeWebMedia","mediaAgent");F?K.configProvider.updateConfig(F,B.ETag,B.getEcsConfig("ConfigIDs","SkypeWebMedia")):K.logger.warn("No SkypeWebMedia.mediaAgent config.")}))}return MediaAgentProvider.prototype.getDeviceManager=function(){return this.deviceManager},MediaAgentProvider.prototype.buildAgent=function(F,B){return K(this,void 0,void 0,(function(){var G,W,z,K=this;return J(this,(function(J){switch(J.label){case 0:if(!Q.UserAgentConfig.hasMediaApi())throw[new ae("".concat(F," not supported by media agent provider"),"not_supported")];return(G=this.config&&this.config.detectH264Support)?[4,Q.UserAgentConfig.hasH264CodecSupport(this.config.logger)]:[3,2];case 1:G=!J.sent(),J.label=2;case 2:if(G)throw[new ae("H264 is not supported","not_supported")];return(W={getRelayManager:function(){return B},getWebCVProvider:function(){return K.config.webcvProvider},getWasmDnsProvider:function(){return K.config.wasmdnsProvider},getWasmAecProvider:function(){return K.config.wasmaecProvider},domOverrides:this.config.domOverrides,configProvider:this.configProvider}).getRelayManager().initialize(),(z=re.MediaAgent.build(this.logger,W,this.configProvider,this.mediaAgentDiagnostics,this.ufdManager,this.deviceManager,this.capabilities)).constants=re.MediaAgent.constants,[2,z]}}))}))},MediaAgentProvider}();B.default=oe;var ae=function(F){function MediaAgentError(B,G){void 0===G&&(G="failure");var W=F.call(this,B)||this;return W.reason=G,W}return z(MediaAgentError,F),MediaAgentError}(Error);B.MediaAgentError=ae},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.createRemoteRendererStatsOverlay=B.createLocalRendererStatsOverlay=void 0;var z=G(1),K=function(){function RendererStatsOverlay(F){var B=this;this.container=F,this.elements={},this.createTableCell=function(F,G){B.elements[F]=document.createElement("td"),B.addElementStyle(F),B.elements[G].appendChild(B.elements[F])},this.topElement=F.ownerDocument.createElement("div"),this.topElement.classList.add("vdi-occlusion"),this.topElement.style.position="absolute",this.topElement.style.top="0px",this.topElement.style.left="0px",this.topElement.style.zIndex="100",this.topElement.style.transform="inherit",this.topElement.style.backgroundColor="rgba(0, 0, 0, 0.2)",this.container.appendChild(this.topElement),this.table=document.createElement("table"),this.table.style.borderCollapse="collapse",this.table.style.fontSize="smaller",this.topElement.appendChild(this.table)}return RendererStatsOverlay.prototype.dispose=function(){this.topElement.removeChild(this.table),this.container.removeChild(this.topElement),this.table=null,this.topElement=null,this.container=null},RendererStatsOverlay.prototype.createTableColumn=function(F,B){var G,z;try{for(var K=W(Object.keys(F)),J=K.next();!J.done;J=K.next()){var Q=J.value;this.createTableRow(Q,F[Q],B)}}catch(F){G={error:F}}finally{try{J&&!J.done&&(z=K.return)&&z.call(K)}finally{if(G)throw G.error}}},RendererStatsOverlay.prototype.createTableRow=function(F,B,G){var W;this.elements[F]||(this.elements[F]=document.createElement("tr"),this.table.appendChild(this.elements[F]));var z="".concat(F,"-title");this.elements[z]||(this.createTableCell(z,F),this.elements[z].innerText=B.text?B.text:F);var K="".concat(F,"-").concat(G);this.elements[K]||this.createTableCell(K,F),this.elements[K].innerText=null===(W=B.value)||void 0===W?void 0:W.toString()},RendererStatsOverlay.prototype.addElementStyle=function(F){this.elements[F].title=F,this.elements[F].style.color="yellow",this.elements[F].style.maxWidth="fit-content",this.elements[F].style.whiteSpace="nowrap",this.elements[F].style.fontSize="smaller",this.elements[F].style.lineHeight="1",this.elements[F].style.padding="0px"},RendererStatsOverlay}(),J=function(){function RemoteRendererStatsOverlay(F,B){this.container=F,this.renderer=B,this.subs=[]}return RemoteRendererStatsOverlay.prototype.initialize=function(){var F=this;this.overlay||(this.overlay=new K(this.container),this.overlay.createTableRow("streamSize",{value:"0x0"},"streamSize"),this.subs.push(this.renderer.on("onVideoSizeChanged",(function(B,G){var W;return null===(W=F.overlay)||void 0===W?void 0:W.createTableRow("streamSize",{value:"".concat(B,"x").concat(G)},"streamSize")}))),this.overlay.createTableRow("rendererSize",{value:"0x0"},"rendererSize"),this.subs.push(this.renderer.on("onRendererSizeChanged",(function(B,G){var W;return null===(W=F.overlay)||void 0===W?void 0:W.createTableRow("rendererSize",{value:"".concat(G.width,"x").concat(G.height)},"rendererSize")}))))},RemoteRendererStatsOverlay.prototype.clear=function(){var F;this.subs.forEach((function(F){return F.dispose()})),this.subs=[],null===(F=this.overlay)||void 0===F||F.dispose(),this.overlay=null},RemoteRendererStatsOverlay.prototype.setStats=function(F){var B,G;if(this.overlay){var W={ssrc:{value:F.ssrc},msid:{text:"sourceId/msid",value:"".concat(null===(B=this.renderer)||void 0===B?void 0:B.getMsi(),"/").concat(null===(G=this.renderer)||void 0===G?void 0:G.getLocalMsi())},fps:{text:"FPS(r/d)",value:"".concat(F.googFrameRateReceived,"/").concat(F.googFrameRateDecoded)},bitrate:{value:F.bytesReceivedDiff&&calcBitrate(F.bytesReceivedDiff)},decodeTime:{value:F.decodeTime&&F.googFrameRateDecoded&&z.round(F.decodeTime/F.googFrameRateDecoded,2)},keyFramesDecoded:{text:"KFs",value:F.keyFramesDecoded},nacksFirsPlisSent:{text:"N/F/P",value:"".concat(F.googNacksSent,"/").concat(F.googFirsSent,"/").concat(F.googPlisSent)}};this.overlay.createTableColumn(W,F.id)}},RemoteRendererStatsOverlay.prototype.dispose=function(){this.clear(),this.container=null,this.renderer=null},RemoteRendererStatsOverlay}(),Q=function(){function LocalRendererStatsOverlay(F){this.container=F}return LocalRendererStatsOverlay.prototype.initialize=function(){var F;null!==(F=this.overlay)&&void 0!==F||(this.overlay=new K(this.container))},LocalRendererStatsOverlay.prototype.clear=function(){var F;null===(F=this.overlay)||void 0===F||F.dispose(),this.overlay=null},LocalRendererStatsOverlay.prototype.setStats=function(F){var B=this;if(this.overlay){var getStatsValues=function(F){var G={rid:{value:F.rid},inputSize:{value:F.googFrameWidthInput&&"".concat(F.googFrameWidthInput,"x").concat(F.googFrameHeightInput)},sentSize:{value:F.googFrameWidthSent&&"".concat(F.googFrameWidthSent,"x").concat(F.googFrameHeightSent)},ssrc:{value:F.ssrc},fps:{text:"FPS(i/e/s)",value:"".concat(F.googFrameRateInput,"/").concat(F.googFrameRateEncoded,"/").concat(F.googFrameRateSent)},bitrate:{value:F.bytesSentDiff&&calcBitrate(F.bytesSentDiff)},encodeTime:{value:F.encodeTime&&F.googFrameRateEncoded&&z.round(F.encodeTime/F.googFrameRateEncoded,2)},qp:{value:F.qp&&F.googFrameRateEncoded&&z.round(F.qp/F.googFrameRateEncoded,2)}};F.hasOwnProperty("rid")||delete G.rid,B.overlay.createTableColumn(G,F.id)};F.forEach((function(F){return getStatsValues(F)}))}},LocalRendererStatsOverlay.prototype.dispose=function(){this.clear(),this.container=null},LocalRendererStatsOverlay}();function createLocalRendererStatsOverlay(F,B){return new Y(new Q(B),F)}function createRemoteRendererStatsOverlay(F,B,G){return new Y(new J(B,G),F)}B.createLocalRendererStatsOverlay=createLocalRendererStatsOverlay,B.createRemoteRendererStatsOverlay=createRemoteRendererStatsOverlay;var Y=function(){function RendererStatsOverlayHandler(F,B){var G;this.overlay=F;var W=null===window||void 0===window?void 0:window.webMA;W&&(null!==(G=W.stats)&&void 0!==G||(W.stats={show:B})),B&&this.overlay.initialize()}return RendererStatsOverlayHandler.prototype.setStats=function(F){this.initOrClear(),this.overlay.setStats(F)},RendererStatsOverlayHandler.prototype.dispose=function(){this.overlay.dispose()},RendererStatsOverlayHandler.prototype.initOrClear=function(){var F,B=null===window||void 0===window?void 0:window.webMA;(null===(F=null==B?void 0:B.stats)||void 0===F?void 0:F.show)?this.overlay.initialize():B&&!B.stats.show&&this.overlay.clear()},RendererStatsOverlayHandler}();function calcBitrate(F){var B=1e3,G=8*F;return G>=B?"".concat(Math.round(G/B)," kbps"):"".concat(G," bps")}},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.VideoRendererBase=void 0;var Q=G(6),Y=G(18);function getObjectFitValue(F){switch(F){case"crop":return"cover";case"stretch":return"fill";default:return"contain"}}var $=function(F){function VideoRendererBase(B,G){var W=this,z=G.createChild("".concat(VideoRendererBase.rendererId++));return(W=F.call(this,z)||this).container=B,W.window=Y.default.window,W.video=W.container.ownerDocument.createElement("video"),W.lastNotifiedVideoWidth=0,W.lastNotifiedVideoHeight=0,W.isVideoAttached=!1,W.startTimeTTFF=0,W.timeToFirstFrame=-1,W.isTimeToFirstFrameReported=!1,W.onVideoDataUpdated=function(){var F,B=W.video.videoWidth,G=W.video.videoHeight;if((B<32||G<32)&&(B=G=0),(W.lastNotifiedVideoWidth!==B||W.lastNotifiedVideoHeight!==G)&&(W.lastNotifiedVideoWidth=B,W.lastNotifiedVideoHeight=G,W.event("onVideoSizeChanged").raise(B,G),!W.isTimeToFirstFrameReported)){if(-1===W.timeToFirstFrame){var z=Date.now();W.timeToFirstFrame=z-W.startTimeTTFF}var K=W.getTrackId();K&&(W.event("onVideoStarted").raise(W.timeToFirstFrame,K),W.isTimeToFirstFrameReported=!0)}(null===(F=W.video)||void 0===F?void 0:F.paused)&&W.video.play()},W.onVideoError=function(){W.event("onError").raise(W.video.error||"no video")},W.onVideoPaused=function(){W.video.play()},W.onContextMenu=function(F){F.preventDefault()},W.logger=z,W.video.style.width="100%",W.video.style.height="100%",W.video.setAttribute("playsinline","true"),W.video.autoplay=!0,W.video.muted=!0,W.attachEventListeners(),W.logger.safe.info("created"),W}return z(VideoRendererBase,F),VideoRendererBase.prototype.getVideoElement=function(){return this.video},VideoRendererBase.prototype.getTimeToFirstFrame=function(){return this.timeToFirstFrame},VideoRendererBase.prototype.resetTimeToFirstFrameFlag=function(){this.isTimeToFirstFrameReported=!1},VideoRendererBase.prototype.dispose=function(){this.isVideoAttached&&(this.container.removeChild(this.video),this.isVideoAttached=!1),this.detachEventListeners(),this.video=null,this.stream=null,this.canvas=null,this.context=null},VideoRendererBase.prototype.reattachEventListeners=function(){this.detachEventListeners(),this.attachEventListeners()},VideoRendererBase.prototype.attachMediaStream=function(F){this.stream!==F&&(this.stream&&this.window.detachMediaStream(this.video),F&&(this.video.hidden=0===F.getVideoTracks().length,this.window.attachMediaStream(this.video,F),this.isVideoAttached||(this.container.appendChild(this.video),this.isVideoAttached=!0,this.startTimeTTFF=Date.now())),this.stream=F)},VideoRendererBase.prototype.setScalingMode=function(F){this.video.style.objectFit=getObjectFitValue(F)},VideoRendererBase.prototype.getMediaStream=function(){return this.stream},VideoRendererBase.prototype.getTrackId=function(){var F,B,G;return null!==(G=null===(B=null===(F=this.stream)||void 0===F?void 0:F.getTracks()[0])||void 0===B?void 0:B.id)&&void 0!==G?G:void 0},VideoRendererBase.prototype.captureFrame=function(){var F,B,G;return K(this,void 0,void 0,(function(){var W,z,K,Q,Y;return J(this,(function(J){if(!(W=this.stream))throw this.logger.safe.error("Mediastream not found"),new Error("Mediastream not found");if(z=null===(G=null===(B=null===(F=W.getVideoTracks)||void 0===F?void 0:F.call(W))||void 0===B?void 0:B[0])||void 0===G?void 0:G.getSettings(),K=null==z?void 0:z.width,Q=null==z?void 0:z.height,!K||!Q)throw this.logger.safe.error("Failed to get video track width/height"),new Error("Failed to get video track width/height");return Y=this.getImageData(K,Q),[2,{getSize:function(){return{width:K,height:Q}},isMirrored:function(){return!1},getImageData:function(){return Y}}]}))}))},VideoRendererBase.prototype.getImageData=function(F,B){var G,W;if(null!==(G=this.canvas)&&void 0!==G||(this.canvas=this.container.ownerDocument.createElement("canvas")),null!==(W=this.context)&&void 0!==W||(this.context=this.canvas.getContext("2d")),!this.context)throw this.logger.safe.error("Failed to get canvas 2d context"),new Error("Failed to get canvas 2d context");return this.canvas.width=F,this.canvas.height=B,this.context.drawImage(this.video,0,0,F,B),this.context.getImageData(0,0,F,B)},VideoRendererBase.prototype.attachEventListeners=function(){this.video.addEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.addEventListener("timeupdate",this.onVideoDataUpdated),this.video.addEventListener("error",this.onVideoError),this.video.addEventListener("pause",this.onVideoPaused),this.video.addEventListener("contextmenu",this.onContextMenu)},VideoRendererBase.prototype.detachEventListeners=function(){this.video.removeEventListener("loadedmetadata",this.onVideoDataUpdated),this.video.removeEventListener("timeupdate",this.onVideoDataUpdated),this.video.removeEventListener("error",this.onVideoError),this.video.removeEventListener("pause",this.onVideoPaused),this.video.removeEventListener("contextmenu",this.onContextMenu),this.attachMediaStream(null)},VideoRendererBase.rendererId=0,VideoRendererBase}(Q.default);B.VideoRendererBase=$},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ConstraintsProviderFactory=void 0;var W=G(23),z=G(18),K=G(336),J=G(338),Q=function(){function ConstraintsProviderFactory(){}return ConstraintsProviderFactory.getProvider=function(F,B,G){if("ScreenShare"===F){var Q=G.createChild("SharingCP");return"Safari"===(0,W.getBrowserInfo)().name?new K.SafariSharingConstraintsProvider(Q,z.default.window):new K.SharingConstraintsProvider(Q)}return new J.BasicConstraintsProvider(B,G.createChild("VideoCP"))},ConstraintsProviderFactory}();B.ConstraintsProviderFactory=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.adjustResolitionToAspectRatio=void 0;var W=G(8);function adjustResolitionToAspectRatio(F,B){var G=F.width/F.height,z=W.clone(F);return G>B?z.width=Math.floor(F.height*B):G<B&&(z.height=Math.floor(F.width/B)),z}B.adjustResolitionToAspectRatio=adjustResolitionToAspectRatio},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ConstraintsProviderBase=void 0;var W=G(10),z=G(1),K=function(){function ConstraintsProviderBase(F){this.logger=F}return ConstraintsProviderBase.prototype.dispose=function(){},ConstraintsProviderBase.prototype.updateVideoConstraints=function(F,B,G){var W=this.calculateConstraints(B,G);this.logger.safe.info("Calculated constraints: ".concat(JSON.stringify(W)," from capabilities: ").concat(JSON.stringify(B)));var K=W.resolution,J=W.fps,Q=K&&(!z.isInRange(K.width,F.video.minWidth,F.video.maxWidth)||!z.isInRange(K.height,F.video.minHeight,F.video.maxHeight)),Y=F.video.fps!==J;if(!Q&&!Y)return F;var $=F.clone();return Q&&this.setResolution($,K),Y&&($.video.fps=J),$},ConstraintsProviderBase.prototype.updateResolution=function(F,B){var G=F.clone();return this.setResolution(G,B),G},ConstraintsProviderBase.prototype.setResolution=function(F,B){F.video.maxWidth=B.width,F.video.minWidth=B.width,F.video.maxHeight=B.height,F.video.minHeight=B.height},ConstraintsProviderBase.prototype.getKey=function(F){return F.video?z.isEmpty(F.video)?"video":F.video.deviceId&&F.video.minWidth&&F.video.minHeight?"".concat(F.video.deviceId,"x").concat(F.video.minWidth,"x").concat(F.video.minHeight):F.video.minWidth&&F.video.minHeight?"".concat(F.video.minWidth,"x").concat(F.video.minHeight):F.video.deviceId?"".concat(F.video.deviceId):(this.logger.safe.error("Cannot create key for constraints: ".concat((0,W.scrubConstraints)(F))),""):"audio"},ConstraintsProviderBase.prototype.convertConstraints=function(F,B){if(void 0===B&&(B={}),!F)return null;var G=z.deepClone(B);return(null==F?void 0:F.deviceId)&&(G.deviceId=F.deviceId),G},ConstraintsProviderBase}();B.ConstraintsProviderBase=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.VideoCapabilitiesValidator=void 0;var W=G(1),z=function(){function VideoCapabilitiesValidator(F,B){this.logger=F,this.maxCapabilities=B}return VideoCapabilitiesValidator.prototype.ensureValidity=function(F){this.throwIfMissing(F);var B=this.calculateMissing(F);return this.maxCapabilities&&this.applyMaxCapabilities(B),this.logger.safe.info("Validating capabilities ".concat(JSON.stringify(B))),B},VideoCapabilitiesValidator.prototype.throwIfMissing=function(F){if(!F.maxFs&&!F.maxMbps&&!F.maxFps||F.maxFs&&!F.maxMbps&&!F.maxFps||!F.maxFs&&F.maxMbps&&!F.maxFps||!F.maxFs&&!F.maxMbps&&F.maxFps)throw new Error("Missing video capabilities ".concat(JSON.stringify(F)))},VideoCapabilitiesValidator.prototype.calculateMissing=function(F){var B=W.shallowClone(F);return!F.maxFs&&F.maxMbps&&F.maxFps&&(B.maxFs=F.maxMbps/F.maxFps),F.maxFs&&!F.maxMbps&&F.maxFps&&(B.maxMbps=F.maxFs*F.maxFps),F.maxFs&&F.maxMbps&&!F.maxFps&&(B.maxFps=F.maxMbps/F.maxFs),B},VideoCapabilitiesValidator.prototype.applyMaxCapabilities=function(F){this.maxCapabilities.maxFs&&(F.maxFs=Math.min(F.maxFs,this.maxCapabilities.maxFs)),this.maxCapabilities.maxMbps&&(F.maxMbps=Math.min(F.maxMbps,this.maxCapabilities.maxMbps)),this.maxCapabilities.maxFps&&(F.maxFps=Math.min(F.maxFps,this.maxCapabilities.maxFps))},VideoCapabilitiesValidator}();B.VideoCapabilitiesValidator=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.RequestPolicyGenerator=void 0;var W=G(28),z=G(80),K=function(){function RequestPolicyGenerator(F){this.resTable=new W.default(F.config.resolutionTableOverride)}return RequestPolicyGenerator.prototype.getPolicies=function(F){var B=this;if(F.audio&&!F.video&&this.hasAudioProcessingConstraints(F))return[F,new z.ConstraintsObject({deviceId:F.audio.deviceId},null)];if(!F.video)return[F];var G=this.getSuitableResolutions(F).map((function(G){return B.getConstraintsForResolution(F,G)})),W=F.audio,K={deviceId:F.video.deviceId},J=new z.ConstraintsObject(W,K,F.withTimeout);return G.push(J),G},RequestPolicyGenerator.prototype.getSuitableResolutions=function(F){return this.resTable.getResolutions().filter((function(B){return B.width<=F.video.maxWidth&&B.height<=F.video.maxHeight})).reverse()},RequestPolicyGenerator.prototype.getConstraintsForResolution=function(F,B){var G=F.clone();return G.video.minWidth=B.width,G.video.minHeight=B.height,G},RequestPolicyGenerator.prototype.hasAudioProcessingConstraints=function(F){var B=F&&F.audio;return B&&(void 0!==B.echoCancellation||void 0!==B.autoGainControl||void 0!==B.noiseSuppression)},RequestPolicyGenerator}();B.RequestPolicyGenerator=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.GumStreamProviderFactory=void 0;var W=G(339),z=function(){function GumStreamProviderFactory(){}return GumStreamProviderFactory.getStreamProvider=function(F,B,G){return"ScreenShare"===F?W.WebRTCDisplayStreamProvider.isSupported()?new W.WebRTCDisplayStreamProvider(G):(G.error("GUM stream provider cannot be created for display stream"),new W.UnsupportedStreamProvider("Sharing not supported")):new W.WebRTCMediaStreamProvider(B,G)},GumStreamProviderFactory}();B.GumStreamProviderFactory=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MediaStreamErrorDecorator=void 0;var W=G(4),z=G(10),K=G(1),J=function(){function MediaStreamErrorDecorator(F,B){this.error=F,this.constraints=B}return MediaStreamErrorDecorator.prototype.getMediaError=function(){var F;switch(this.error.name){case"SourceUnavailableError":case"TrackStartError":case"NotReadableError":F={type:W.default.MEDIA_ERROR.sourceUnavailableError,detail:"media device is already used by another process: ".concat(K.stringifyObject(this.error))};break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":F={type:W.default.MEDIA_ERROR.constraintNotSatisfiedError,detail:"could not obtain constrained media stream: ".concat(K.stringifyObject(this.error))};break;case"DevicesNotFoundError":case"NotFoundError":F={type:W.default.MEDIA_ERROR.devicesNotFoundError,detail:"specified device not found: ".concat(K.stringifyObject(this.error))};break;case"NotAllowedError":F="Permission denied by system"===this.error.message?{type:W.default.MEDIA_ERROR.permissionDeniedBySystemError,detail:"no system permissions: ".concat(K.stringifyObject(this.error))}:{type:W.default.MEDIA_ERROR.permissionDeniedError,detail:"permission to use media device was denied: ".concat(K.stringifyObject(this.error))};break;case"PermissionDeniedError":case"PermissionDismissedError":F={type:W.default.MEDIA_ERROR.permissionDeniedError,detail:"permission to use media device was denied: ".concat(K.stringifyObject(this.error))};break;case W.default.MEDIA_ERROR.extensionNotFoundError:F={type:W.default.MEDIA_ERROR.extensionNotFoundError,detail:"extension is not found: ".concat(K.stringifyObject(this.error))};break;case W.default.MEDIA_ERROR.chromeRuntimeNotDefinedError:F={type:W.default.MEDIA_ERROR.chromeRuntimeNotDefinedError,detail:"chrome runtime is not defined: ".concat(K.stringifyObject(this.error))};break;case W.default.MEDIA_ERROR.sharingCancelledError:F=this.getSharingCancelledError(this.error);break;case W.default.MEDIA_ERROR.mediaStreamRequestTimedOut:F={type:W.default.MEDIA_ERROR.mediaStreamRequestTimedOut,detail:"Media Stream request timed out."};break;default:F=this.error.message===W.default.MEDIA_ERROR.sharingCancelledError?this.getSharingCancelledError(this.error):{type:W.default.MEDIA_ERROR.mediaStreamRequestError,detail:"media stream request error: ".concat(K.stringifyObject(this.error))}}return F.isAudio=!!this.constraints.audio,F.detail+=" constraints: ".concat(K.stringifyObject((0,z.scrubConstraints)(this.constraints))),F.message=F.detail,F},MediaStreamErrorDecorator.prototype.getSharingCancelledError=function(F){return{type:W.default.MEDIA_ERROR.sharingCancelledError,detail:"screen sharing cancelled: ".concat(K.stringifyObject(F))}},MediaStreamErrorDecorator}();B.MediaStreamErrorDecorator=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},J=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.ComposedDeviceList=B.EmptyDeviceDebugStrings=void 0;var Q=G(6),Y=G(4),$=G(1),X=G(17),Z=G(351),ee=G(352);B.EmptyDeviceDebugStrings={microphone:"",camera:"",speaker:"",compositeAudio:""};var te=function(F){function ComposedDeviceList(G,W){var z=F.call(this,W)||this;return z.configProvider=G,z.logger=W,z.debugInfo=B.EmptyDeviceDebugStrings,z.lists=new Map,z.lists.set(Y.default.MEDIA_DEVICE.microphone,[]),z.lists.set(Y.default.MEDIA_DEVICE.camera,[]),z.configProvider.userAgentConfig.isAudioOutputSelectionSupported&&(z.lists.set(Y.default.MEDIA_DEVICE.speaker,[]),z.lists.set(Y.default.MEDIA_DEVICE.compositeAudio,[])),G.userAgentConfig.on("isAudioOutputSelectionSupportedChanged",(function(){return z.onConfigUpdated()})),z.logger.safe.info("Initialized"),z}return z(ComposedDeviceList,F),Object.defineProperty(ComposedDeviceList.prototype,"devices",{get:function(){var F=[];return this.lists.forEach((function(B){return F.push.apply(F,J([],K(B),!1))})),F},enumerable:!1,configurable:!0}),ComposedDeviceList.prototype.getDevicesByType=function(F){var B;return null!==(B=this.lists.get(F))&&void 0!==B?B:[]},ComposedDeviceList.prototype.updateDevices=function(F,B){if(void 0===B&&(B=!1),!$.deepEqual(this.latestRawList,F)){this.latestRawList=F;var G=this.devices;this.debugInfo.microphone="microphone",this.debugInfo.camera="camera",this.debugInfo.speaker="speaker",this.debugInfo.compositeAudio="compositeAudio",this.updatePrimitiveDeviceList(Y.default.MEDIA_DEVICE.microphone,F.filter((function(F){return F.type===Y.default.MEDIA_DEVICE.microphone}))),this.updatePrimitiveDeviceList(Y.default.MEDIA_DEVICE.camera,F.filter((function(F){return F.type===Y.default.MEDIA_DEVICE.camera}))),this.lists.get(Y.default.MEDIA_DEVICE.speaker)&&(this.updatePrimitiveDeviceList(Y.default.MEDIA_DEVICE.speaker,F.filter((function(F){return F.type===Y.default.MEDIA_DEVICE.speaker}))),this.lists.get(Y.default.MEDIA_DEVICE.compositeAudio)&&this.updateCompositeAudioDeviceList(this.lists.get(Y.default.MEDIA_DEVICE.microphone),this.lists.get(Y.default.MEDIA_DEVICE.speaker)));var W=this.lists.get(Y.default.MEDIA_DEVICE.compositeAudio)||[];this.lists.set(Y.default.MEDIA_DEVICE.microphone,this.orderDeviceList(this.lists.get(Y.default.MEDIA_DEVICE.microphone),W)),this.lists.get(Y.default.MEDIA_DEVICE.speaker)&&this.lists.set(Y.default.MEDIA_DEVICE.speaker,this.orderDeviceList(this.lists.get(Y.default.MEDIA_DEVICE.speaker),W));var z=this.lists.get(Y.default.MEDIA_DEVICE.microphone);this.setTopItemToDefault(z);var K=this.lists.get(Y.default.MEDIA_DEVICE.speaker);this.setTopItemToDefault(K),$.deepEqual(G,this.devices)||(this.logger.safe.info("Device lists updated and changed"),this.logger.safe.info(this.debugInfo.microphone),this.logger.safe.info(this.debugInfo.camera),this.logger.safe.info(this.debugInfo.speaker),this.logger.safe.info(this.debugInfo.compositeAudio),this.event("onDevicesChanged").raise(this.devices,B))}},ComposedDeviceList.prototype.updateActiveMicrophone=function(F){if(F&&F.deviceId!==Y.default.MEDIA_DEVICE.defaultId){var B=this.lists.get(Y.default.MEDIA_DEVICE.microphone),G=B.findIndex((function(F){return F.isSystemDefault}));-1!==G&&B[G]!==F?(this.logger.safe.info("Removing synthetic default microphone"),F.isSystemDefault=!0,B.splice(G,1),this.lists.set(Y.default.MEDIA_DEVICE.microphone,B),this.event("onDevicesChanged").raise(this.devices,!1)):F.isSystemDefault=!0}},ComposedDeviceList.prototype.updatePrimitiveDeviceList=function(F,B){var G={str:this.debugInfo[F]};this.lists.set(F,(0,Z.compilePrimitiveDeviceList)(F,B,this.lists.get(F)||[],this.configProvider,G)),this.debugInfo[F]=G.str},ComposedDeviceList.prototype.updateCompositeAudioDeviceList=function(F,B){var G={str:this.debugInfo.compositeAudio};this.lists.set(Y.default.MEDIA_DEVICE.compositeAudio,(0,ee.compileAudioDeviceList)(F,B,this.configProvider.config.devices.compositeLabelMatchingThreshold,G)),this.debugInfo.compositeAudio=G.str},ComposedDeviceList.prototype.orderDeviceList=function(F,B){var G=this;return F.sort((function(F,W){return G.getDevicePriority(W,G.getCompositeAudioDeviceCounterpart(W,B))-G.getDevicePriority(F,G.getCompositeAudioDeviceCounterpart(F,B))}))},ComposedDeviceList.prototype.getCompositeAudioDeviceCounterpart=function(F,B){var G=B.find((function(B){return B.micDeviceId===F.guid||B.speakerDeviceId===F.guid}));return G?G[F.type===Y.default.MEDIA_DEVICE.speaker?"micDevice":"speakerDevice"]:null},ComposedDeviceList.prototype.getDevicePriority=function(F,B){var G=0;return this.configProvider.config.devices.overrideDefault&&B&&(!F.isSystemDefault&&B.isSystemDefault?(this.debugInfo[F.type]+="|overrideDefault(".concat(X.scrubMriOrOmit(F.guid),")"),G+=10):F.isSystemDefault&&!B.isSystemDefault&&"microphone"===F.type&&(G+=15)),F.isSystemDefault&&(G+=5),B&&(G+=1,B.isSystemDefault&&(G+=2)),G},ComposedDeviceList.prototype.setTopItemToDefault=function(F){(null==F?void 0:F.length)&&(F.forEach((function(F){return F.isSystemDefault=!1})),F[0].isSystemDefault=!0)},ComposedDeviceList.prototype.onConfigUpdated=function(){var F=!1;this.configProvider.userAgentConfig.isAudioOutputSelectionSupported?this.lists.has(Y.default.MEDIA_DEVICE.speaker)||(this.lists.set(Y.default.MEDIA_DEVICE.speaker,[]),this.lists.set(Y.default.MEDIA_DEVICE.compositeAudio,[]),F=!0):(this.lists.has(Y.default.MEDIA_DEVICE.speaker)&&(this.lists.delete(Y.default.MEDIA_DEVICE.speaker),F=!0),this.lists.has(Y.default.MEDIA_DEVICE.compositeAudio)&&(this.lists.delete(Y.default.MEDIA_DEVICE.compositeAudio),F=!0)),F&&(this.logger.safe.info("Updating device list due to config update"),this.updateDevices(this.latestRawList||[]))},ComposedDeviceList}(Q.default);B.ComposedDeviceList=te},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ActiveSpeakerManager=void 0;var W=function(){function ActiveSpeakerManager(F,B,G){this.onActiveSpeakersChanged=F,this.onDominantSpeakersChanged=B,this.logger=G}return ActiveSpeakerManager.prototype.setStrategy=function(F){var B;this.disposeStrategy(),this.dshStrategy=F,null===(B=this.dshStrategy)||void 0===B||B.setOnDominantSpeakerChanged(this.onDominantSpeakerHistoryChanged.bind(this))},ActiveSpeakerManager.prototype.onContributingSourcesChanged=function(F){var B;this.onActiveSpeakersChanged(F),null===(B=this.dshStrategy)||void 0===B||B.setSources(F)},ActiveSpeakerManager.prototype.onDominantSpeakerHistoryChanged=function(F,B){void 0===B&&(B=!1),this.onDominantSpeakersChanged(F),B&&this.dshStrategy&&(this.logger.safe.info("Disposing client DSH strategy and switching to MP provided DSH"),this.disposeStrategy())},ActiveSpeakerManager.prototype.dispose=function(){this.disposeStrategy(),this.onActiveSpeakersChanged=null,this.onDominantSpeakersChanged=null},ActiveSpeakerManager.prototype.disposeStrategy=function(){var F;null===(F=this.dshStrategy)||void 0===F||F.dispose(),this.dshStrategy=null},ActiveSpeakerManager}();B.ActiveSpeakerManager=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(1),z=function(){function ReceiveStreamCollection(F){this.listener=F,this.streams=[]}return ReceiveStreamCollection.prototype.add=function(F){this.streams.some((function(B){return B.getId()===F.getId()}))||(this.streams.push(F),this.listener.streamAdded(F))},ReceiveStreamCollection.prototype.remove=function(F){var B;W.remove(this.streams,(function(G){return G.getId()===F&&(B=G,!0)}))&&this.listener.streamRemoved(B)},ReceiveStreamCollection.prototype.getStreams=function(){return this.streams},ReceiveStreamCollection.prototype.clear=function(){this.streams.forEach((function(F){return F.dispose()})),this.streams=[]},ReceiveStreamCollection}();B.default=z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},J=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.SubscriptionManager=void 0;var Q=G(13),Y=G(138),$=G(6),X=G(1),Z=G(52),ee=function(){function SubscriptionClient(F){this.subscription=F}return Object.defineProperty(SubscriptionClient.prototype,"subscribedStream",{get:function(){var F;return null===(F=this.subscription.stream)||void 0===F?void 0:F.getMediaStream()},enumerable:!1,configurable:!0}),Object.defineProperty(SubscriptionClient.prototype,"msi",{get:function(){return this.checkDisposed(),this.subscription.msi},enumerable:!1,configurable:!0}),Object.defineProperty(SubscriptionClient.prototype,"modality",{get:function(){return this.checkDisposed(),this.subscription.modality},enumerable:!1,configurable:!0}),Object.defineProperty(SubscriptionClient.prototype,"localMsi",{get:function(){return this.checkDisposed(),this.subscription.localMsi},enumerable:!1,configurable:!0}),SubscriptionClient.prototype.setOnMediaStreamChangedHandler=function(F){this.checkDisposed(),this.mediaStreamChanged=F,this.subscription.isStreamReady&&this.notifyMediaStreamChanged()},SubscriptionClient.prototype.setOnErrorHandler=function(F){this.checkDisposed(),this.error=F},SubscriptionClient.prototype.dispose=function(){this.subscription&&(this.subscription.dispose((0,Q.generateCauseId)(),this),this.subscription=null)},SubscriptionClient.prototype.unsubscribe=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)},SubscriptionClient.prototype.notifyMediaStreamChanged=function(){if(this.mediaStreamChanged){var F=this.subscription.stream,B=this.subscription.isStreamReady;this.mediaStreamChanged(F&&B?F.getMediaStream():null)}},SubscriptionClient.prototype.notifyError=function(F){this.error&&this.error(F)},SubscriptionClient.prototype.checkDisposed=function(){if(!this.subscription)throw new Error("subscription disposed")},SubscriptionClient}(),te=function(F){function Subscription(B,G,W){var z=F.call(this)||this;return z.modality=B,z.msi=G,z.disposeDelay=W,z.clients=[],z.streamReady=!1,z}return z(Subscription,F),Subscription.prototype.createClient=function(){var F=new ee(this);return this.clients.push(F),F},Object.defineProperty(Subscription.prototype,"isStreamReady",{get:function(){return this.streamReady},enumerable:!1,configurable:!0}),Object.defineProperty(Subscription.prototype,"localMsi",{get:function(){var F;return null===(F=this.subStream)||void 0===F?void 0:F.getSourceStreamId()},enumerable:!1,configurable:!0}),Object.defineProperty(Subscription.prototype,"isInactive",{get:function(){return!this.clients.length},enumerable:!1,configurable:!0}),Object.defineProperty(Subscription.prototype,"stream",{get:function(){return this.subStream},set:function(F){var B=this;try{if(F===this.subStream)return;this.subStream&&(this.unsubscribe(!1),this.notifyStreamChanged()),this.subStream=F,F&&(this.streamReady=!1,F.requestSource(this.msi).then((function(){B.streamReady=!0,B.notifyStreamChanged()})).catch((function(F){B.notifyError(F)})))}catch(F){this.event("onFailed").raise(this,F)}},enumerable:!1,configurable:!0}),Subscription.prototype.notifyError=function(F){this.clients.forEach((function(B){B.notifyError(F)})),this.event("onFailed").raise(this,F)},Subscription.prototype.dispose=function(F,B){var G=this;B?(X.remove(this.clients,(function(F){return F===B})),this.isInactive&&(this.disposeTimeout=setTimeout((function(){G.disposeTimeout=null,G.unsubscribeIfInactive()}),this.disposeDelay))):(this.clients=[],this.unsubscribe())},Subscription.prototype.unsubscribeIfInactive=function(){this.isInactive&&(this.disposeTimeout&&clearTimeout(this.disposeTimeout),this.unsubscribe())},Subscription.prototype.unsubscribe=function(F){void 0===F&&(F=!0),this.subStream&&(this.subStream.requestSource(Z.MediaSourceIdentifiers.SourceNone).catch((function(){})),this.streamReady=!1,this.subStream=null),F&&this.event("onDisposed").raise(this)},Subscription.prototype.notifyStreamChanged=function(){this.clients.forEach((function(F){return F.notifyMediaStreamChanged()})),this.event("onStreamChanged").raise()},Subscription}($.default),ne=function(F){function SubscriptionManager(B,G,W,z){var K,J=this;return(J=F.call(this,B)||this).logger=B,J.configProvider=G,J.diagnostics=z,J.videoSubscriptions=[],J.subscriptionEvents=new Map,null!==(K=J.diagnostics)&&void 0!==K||(J.diagnostics=new Y.SubscriptionManagerDiagnostics(J.configProvider,(function(){}))),J.setStreamProvider(W),J.logger.safe.info("created"),J}return z(SubscriptionManager,F),SubscriptionManager.prototype.setStreamProvider=function(F){var B=this;this.streamProvider=F,this.streamProvider.setOnStreamsChangedHandler((function(){return B.streamsChanged()}))},SubscriptionManager.prototype.subscribeVideo=function(F,B){var G=this;void 0===B&&(B=Z.MediaSourceIdentifiers.SourceAny);var W=this.videoSubscriptions.find((function(G){return G.msi===B&&G.modality===F}));if(!W){var z=Date.now();this.disposeInactiveSubscriptionIfNeeded(F);var K=this.getAvailableStream(F),J=null==K?void 0:K.getSourceStreamId();this.logger.safe.info("creating new subscription #".concat(B," for modality ").concat(F)),this.event("onSubscriptionChanged").raise(1,F,B,J,null),this.diagnostics.addSubscribe(F,B,J),W=new te(F,B,this.configProvider.config.webrtcVideoSubscriptionDisposeTimeout);var Q=[];Q.push(W.on("onDisposed",(function(F){return G.onSubscriptionDisposed(F)}))),Q.push(W.on("onStreamChanged",(function(){var K,J=null===(K=W.stream)||void 0===K?void 0:K.getId(),Q=W.localMsi;if(G.updateTrackIds(),W.isStreamReady){var Y=Date.now();G.event("onSubscriptionChanged").raise(2,F,B,Q,Y-z,J),G.diagnostics.addSubscribed(F,B,Q,Y-z)}}))),Q.push(W.on("onFailed",(function(F,B){return G.onSubscriptionFailed(F,B)}))),this.subscriptionEvents.set(W,Q),this.videoSubscriptions.push(W),K&&this.assignStream(W,K)}return W.createClient()},SubscriptionManager.prototype.dispose=function(){var B=(0,Q.generateCauseId)();this.videoSubscriptions.concat().forEach((function(F){return F.dispose(B)})),this.streamProvider.setOnStreamsChangedHandler(null),F.prototype.dispose.call(this),this.logger.safe.info("disposed")},SubscriptionManager.prototype.reriseSubscribeEvents=function(){var F=this;this.logger.safe.debug("rerising subscription events: ".concat(this.videoSubscriptions.length));var B=[];this.videoSubscriptions.forEach((function(G){var W=G.modality,z=G.msi,Q=G.localMsi;F.event("onSubscriptionChanged").raise(1,W,z,Q),F.diagnostics.addSubscribe(W,z,Q),B.push.apply(B,J([],K(F.getSubscriptionVideoTrackIds(G)),!1))})),this.diagnostics.subscribedTrackIds=B},SubscriptionManager.prototype.setDiagnostics=function(F){this.diagnostics=F},SubscriptionManager.prototype.disposeInactiveSubscriptionIfNeeded=function(F){var B;this.getAvailableStream(F)||null===(B=this.videoSubscriptions.find((function(B){return B.modality===F&&B.isInactive})))||void 0===B||B.unsubscribeIfInactive()},SubscriptionManager.prototype.streamsChanged=function(){var F=this;this.logger.safe.info("streams changed, subscriptions active: ".concat(this.videoSubscriptions.length)),this.videoSubscriptions.forEach((function(B){var G=!B.stream||F.isStreamRemoved(B.stream);if(F.logger.safe.info("Subscription for ".concat(B.modality," ").concat(B.msi," needs new stream: ").concat(G)),G){var W=F.getAvailableStream(B.modality);W?F.assignStream(B,W):F.resignStream(B)}}))},SubscriptionManager.prototype.getAvailableStream=function(F){return this.streamProvider.getStreams().find((function(B){return F===B.getModality()&&B.getMsi()===Z.MediaSourceIdentifiers.SourceNone}))},SubscriptionManager.prototype.isStreamRemoved=function(F){return!this.streamProvider.getStreams().some((function(B){return B===F}))},SubscriptionManager.prototype.assignStream=function(F,B){this.logger.safe.info("assigning stream #".concat(B.getId()," to subscription #").concat(F.msi)),F.stream=B},SubscriptionManager.prototype.resignStream=function(F){F.stream&&(this.logger.safe.info("removing stream from subscription #".concat(F.msi)),F.stream=null)},SubscriptionManager.prototype.onSubscriptionDisposed=function(F){var B=(0,Q.generateCauseId)(),G=F.modality,W=F.msi,z=F.localMsi;this.event("onSubscriptionChanged").raise(3,G,W,z),this.diagnostics.addUnsubscribe(G,W,z),this.logger.safe.info("disposing subscription for ".concat(G," #").concat(W)),X.remove(this.videoSubscriptions,(function(B){return B===F})),this.streamsChanged(),this.updateTrackIds(),this.subscriptionEvents.has(F)&&(this.subscriptionEvents.get(F).forEach((function(F){return F.dispose(B)})),this.subscriptionEvents.delete(F))},SubscriptionManager.prototype.updateTrackIds=function(){var F=this,B=[],G=[];this.videoSubscriptions.forEach((function(W){var z;if(W.isStreamReady){var Q=null===(z=W.stream)||void 0===z?void 0:z.getId().split("-")[1];G.push(Q),B.push.apply(B,J([],K(F.getSubscriptionVideoTrackIds(W)),!1))}})),this.event("onTrackIdsChanged").raise(B),this.diagnostics.subscribedTrackIds=B,this.configProvider.config.subscribeToSsrcForVideo&&this.event("onTrackSsrcChanged").raise(G)},SubscriptionManager.prototype.getSubscriptionVideoTrackIds=function(F){var B,G;return null!==(G=null===(B=null==F?void 0:F.stream)||void 0===B?void 0:B.getMediaStream().getVideoTracks().map((function(F){return F.id})))&&void 0!==G?G:[]},SubscriptionManager.prototype.onSubscriptionFailed=function(F,B){this.event("onSubscriptionFailed").raise(-1,F.modality,F.msi,F.localMsi,B),this.diagnostics.addFailed(F.modality,F.msi,F.localMsi,X.stringifyObject(B))},SubscriptionManager}($.default);B.SubscriptionManager=ne},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SubscriptionManagerDiagnostics=void 0;var W=G(4),z=G(1),K=function(){function SubscriptionManagerDiagnostics(F,B){this.configProvider=F,this.addStatsError=B,this.data={events:{video:[],sharing:[]},subscribedTrackIds:[]}}return Object.defineProperty(SubscriptionManagerDiagnostics.prototype,"subscribedTrackIds",{set:function(F){this.data.subscribedTrackIds=F},enumerable:!1,configurable:!0}),SubscriptionManagerDiagnostics.prototype.addSubscribe=function(F,B,G){this.pushToEventBag(F,{evt:1,msi:B,localMsi:G,ts:Date.now()})},SubscriptionManagerDiagnostics.prototype.addSubscribed=function(F,B,G,W){this.pushToEventBag(F,{evt:2,msi:B,localMsi:G,ts:Date.now(),duration:W})},SubscriptionManagerDiagnostics.prototype.addUnsubscribe=function(F,B,G){this.pushToEventBag(F,{evt:3,msi:B,localMsi:G,ts:Date.now()})},SubscriptionManagerDiagnostics.prototype.addFailed=function(F,B,G,W){this.pushToEventBag(F,{evt:-1,msi:B,localMsi:G,ts:Date.now(),error:W})},SubscriptionManagerDiagnostics.prototype.getObjectRef=function(){return this.data},SubscriptionManagerDiagnostics.prototype.pushToEventBag=function(F,B){switch(F){case W.default.MEDIA_TYPE.video:z.arrayPushFixedSize(this.data.events.video,B,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents);break;case W.default.MEDIA_TYPE.sharing:z.arrayPushFixedSize(this.data.events.sharing,B,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents);break;default:return void this.addStatsError("Unsupported modality ".concat(F))}},SubscriptionManagerDiagnostics}();B.SubscriptionManagerDiagnostics=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(6),J=G(374),Q=function(F){function ExtensionsManager(B){var G=F.call(this,B)||this;return G.logger=B,G.extensions=[],G}return z(ExtensionsManager,F),ExtensionsManager.prototype.dispose=function(){this.extensions.map((function(F){return F.dispose()})),this.extensions=[],F.prototype.dispose.call(this)},ExtensionsManager.prototype.addExtension=function(F,B){B.manager||(B.manager=this);var G=J.default.getExtension(F);G.initialize(B),this.extensions.push(G)},ExtensionsManager.prototype.getExtension=function(F){return this.extensions.find((function(B){return B.getType()===F}))},ExtensionsManager.prototype.configureExtension=function(F,B){var G;null===(G=this.getExtension(F))||void 0===G||G.configure(B)},ExtensionsManager.prototype.processNotification=function(F,B){switch(F){case"ControlVideoStreaming":this.event("onMediaStreamControlMessage").raise(B);break;case"DominantSpeakerInfo":this.event("onDominantHistoryMessage").raise(B);break;case"BandwithNotification":this.event("onBandwidthMessage").raise(B);break;default:this.logger.safe.error("Notification message handler not found for type: ".concat(F))}},ExtensionsManager}(K.default);B.default=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.StatisticsPoller=void 0;var Q=G(6),Y=G(18),$=G(1),X=G(381),Z=G(141),ee=function(F){function StatisticsPoller(B,G,W,z,K){var J=F.call(this)||this;return J.logger=B,J.configProvider=G,J.diagnostics=W,J.mediaManager=z,J.window=Y.default.window,J.useNewStatsApi=J.configProvider.config.webrtcUseNewStatsApi&&J.configProvider.mediaConfig.simulcastSessionEnabled,J.gathererV1=new Z.StatisticsGatherer(J.logger.createChild("V1"),J.configProvider,J.mediaManager,K),J.gathererV1.on("onStatisticsChanged",(function(F){return J.event("onStatisticsChanged").raise(F)})),J.gathererV1.on("onRawStatisticsChanged",(function(F){return J.event("onRawStatisticsChanged").raise(F)})),J.useNewStatsApi&&G.config.diagnostics.sideBySide&&(J.gathererV2=new X.StatisticsGathererV2(J.logger.createChild("V2"),J.configProvider,J.diagnostics,J.mediaManager)),J}return z(StatisticsPoller,F),StatisticsPoller.prototype.initialize=function(F){var B,G=this;this.pc=F,this.gathererV1.initialize(F),null!==(B=this.interval)&&void 0!==B||(this.interval=this.window.setInterval((function(){return G.processStats()}),this.configProvider.config.webrtcStatPollInterval))},StatisticsPoller.prototype.dispose=function(){F.prototype.dispose.call(this),this.interval&&(this.window.clearInterval(this.interval),this.interval=void 0),this.gathererV1.dispose(),this.pc=void 0},Object.defineProperty(StatisticsPoller.prototype,"isDisposed",{get:function(){return!this.pc&&void 0===this.interval},enumerable:!1,configurable:!0}),StatisticsPoller.prototype.processStats=function(){var F;return K(this,void 0,void 0,(function(){var B,G,W,z,K,Q,Y=this;return J(this,(function(J){switch(J.label){case 0:return this.pc&&"closed"!==this.pc.iceConnectionState?this.useNewStatsApi?(B=$.hptime(),G=void 0===this.loopTimer?-1:B-this.loopTimer,this.loopTimer=B,W={},[4,this.pc.getStats()]):[3,2]:[2];case 1:return J.sent().forEach((function(F){var B=F.type;delete F.type,W[B]=W[B]||{},W[B][F.id]=F})),z=$.hptime()-B,K=null===(F=this.gathererV2)||void 0===F?void 0:F.processRawReport(W),Q=$.hptime(),this.gathererV1.processRawReport(W),Q=$.hptime()-Q,(null==K?void 0:K.perfCounters)&&(K.perfCounters.loopTime=G,K.perfCounters.fetchTime=z,K.perfCounters.legacyProcessingTime=Q),[3,3];case 2:this.pc.getStats((function(F){F.result&&Y.gathererV1.processLegacyReport(F)})),J.label=3;case 3:return[2]}}))}))},Object.defineProperty(StatisticsPoller.prototype,"sessionInfo",{get:function(){return this.gathererV1.sessionInfo},enumerable:!1,configurable:!0}),StatisticsPoller.prototype.setReportedSendBandwidth=function(F){this.gathererV1.setReportedSendBandwidth(F)},StatisticsPoller.prototype.onMaxCapabilitiesApplied=function(F){this.gathererV1.onMaxCapabilitiesApplied(F)},StatisticsPoller.prototype.clearIceCandidateErrors=function(){this.gathererV1.clearIceCandidateErrors()},StatisticsPoller.prototype.setSsrcTrackPair=function(F,B){var G;this.gathererV1.setSsrcTrackPair(F,B),null===(G=this.gathererV2)||void 0===G||G.setSsrcTrackPair(F,B)},StatisticsPoller.prototype.addSubscriptionEvent=function(F,B,G,W,z,K,J){this.gathererV1.addSubscriptionEvent(F,B,G,W,z,K,J)},StatisticsPoller.prototype.setSubscribedTrackSsrc=function(F){this.gathererV1.setSubscribedTrackSsrc(F)},StatisticsPoller.prototype.addIceCandidateError=function(F){this.gathererV1.addIceCandidateError(F)},StatisticsPoller.prototype.setH264AvailableProfiles=function(F){this.gathererV1.setH264AvailableProfiles(F)},StatisticsPoller.prototype.setTerminated=function(){this.gathererV1.setTerminated()},StatisticsPoller.prototype.onDeviceEvent=function(F){this.gathererV1.onDeviceEvent(F)},StatisticsPoller.prototype.getLastKnownReport=function(F,B){return void 0===B&&(B=!1),this.gathererV1.getLastKnownReport(F,B)},StatisticsPoller.prototype.getReport=function(F){return this.gathererV1.getReport(F)},StatisticsPoller.prototype.startWaitingForStreamStart=function(F){this.gathererV1.startWaitingForStreamStart(F)},StatisticsPoller.prototype.getLastStatistics=function(){return this.gathererV1.getLastStatistics()},StatisticsPoller.prototype.updateSendStream=function(F,B){this.gathererV1.updateSendStream(F,B)},StatisticsPoller.prototype.setSubscribedTrackIds=function(F){this.gathererV1.setSubscribedTrackIds(F)},StatisticsPoller.prototype.setMaxSessionBandwidth=function(F){this.gathererV1.setMaxSessionBandwidth(F)},StatisticsPoller.prototype.updateStatsWithLocalSsrcTrackInfo=function(){this.gathererV1.updateStatsWithLocalSsrcTrackInfo()},StatisticsPoller.prototype.onSendersChanged=function(F,B){this.gathererV1.onSendersChanged(F,B)},StatisticsPoller.prototype.setPreferredResolution=function(F,B,G){this.gathererV1.setPreferredResolution(F,B,G)},StatisticsPoller.prototype.setIsRendering=function(F,B,G){this.gathererV1.setIsRendering(F,B,G)},StatisticsPoller.prototype.setTimeToFirstFrame=function(F,B){this.gathererV1.setTimeToFirstFrame(F,B)},StatisticsPoller.prototype.setFreezeDuration=function(F,B){this.gathererV1.setFreezeDuration(F,B)},StatisticsPoller.prototype.addVideoControlMessage=function(F){this.gathererV1.addVideoControlMessage(F)},StatisticsPoller.prototype.setSessionDataChannelState=function(F){this.gathererV1.setSessionDataChannelState(F)},StatisticsPoller.prototype.recordDataChannelCreationFailure=function(F){this.gathererV1.recordDataChannelCreationFailure(F)},StatisticsPoller.prototype.onMaxCapabilitiesRequested=function(F){this.gathererV1.onMaxCapabilitiesRequested(F)},StatisticsPoller.prototype.recordDataChannelProtocolEvent=function(F){this.gathererV1.recordDataChannelProtocolEvent(F)},StatisticsPoller.prototype.addReportedReceiveBandwidth=function(F){this.gathererV1.addReportedReceiveBandwidth(F)},StatisticsPoller.prototype.addOptimalVideoCountReport=function(F){this.gathererV1.addOptimalVideoCountReport(F)},StatisticsPoller}(Q.default);B.StatisticsPoller=ee},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.StatisticsGatherer=B.unwrapResults=B.TRACK_ID=B.VIDEO_FRAME_RATE_RECEIVED=B.VIDEO_FRAME_RATE_DECODED=void 0;var J=G(6),Q=G(18),Y=G(1),$=G(10),X=G(386),Z=G(387),ee=G(388),te="VideoBwe",ne="bweforvideo",ie="googAvailableReceiveBandwidth",re="googAvailableSendBandwidth",oe="mediaType",ae="framesDecoded";B.VIDEO_FRAME_RATE_DECODED="googFrameRateDecoded",B.VIDEO_FRAME_RATE_RECEIVED="googFrameRateReceived";var se="googFrameRateInput";function unwrapResults(F){var B={};return F.result().forEach((function(F){F.names().forEach((function(G){B[F.type]=B[F.type]||{},B[F.type][F.id]=B[F.type][F.id]||{},B[F.type][F.id][G]=F.stat(G)})),B[F.type][F.id].id=F.id})),B}B.TRACK_ID="googTrackId",B.unwrapResults=unwrapResults;var ce=function(F){function StatisticsGatherer(B,G,W,z){var K=F.call(this)||this;return K.logger=B,K.configProvider=G,K.mediaManager=W,K.window=Q.default.window,K._sessionInfo=new Z.default,K.statisticsMapper=new X.default,K.useNewStatsApi=K.configProvider.config.webrtcUseNewStatsApi&&K.configProvider.mediaConfig.simulcastSessionEnabled,K.webRtcStatistics=new ee.default(K.logger.createChild("WebrtcStatistics"),K._sessionInfo,K.configProvider,W,z,K.useNewStatsApi),K}return z(StatisticsGatherer,F),Object.defineProperty(StatisticsGatherer.prototype,"sessionInfo",{get:function(){return this._sessionInfo},enumerable:!1,configurable:!0}),Object.defineProperty(StatisticsGatherer.prototype,"isDisposed",{get:function(){return null===this.pc&&0===this.interval},enumerable:!1,configurable:!0}),StatisticsGatherer.prototype.initialize=function(F){this.pc=F},StatisticsGatherer.prototype.startWaitingForStreamStart=function(F,B){void 0===B&&(B=!1),this.webRtcStatistics.startWaitingForStreamStart(F,B)},StatisticsGatherer.prototype.onDeviceEvent=function(F){this.webRtcStatistics.onDeviceEvent(F)},StatisticsGatherer.prototype.onMaxCapabilitiesRequested=function(F){this.webRtcStatistics.onMaxCapabilitiesRequested(F)},StatisticsGatherer.prototype.onMaxCapabilitiesApplied=function(F){this.webRtcStatistics.onMaxCapabilitiesApplied(F)},StatisticsGatherer.prototype.onSendersChanged=function(F,B){this.webRtcStatistics.setStreamSenderStarted(F,B)},StatisticsGatherer.prototype.addSubscriptionEvent=function(F,B,G,W,z,K,J){this.webRtcStatistics.addSubscriptionEvent(F,B,G,W,z,K,J)},StatisticsGatherer.prototype.setSubscribedTrackIds=function(F){this.webRtcStatistics.setSubscribedTrackIds(F)},StatisticsGatherer.prototype.setSubscribedTrackSsrc=function(F){this.webRtcStatistics.setSubscribedTrackSsrc(F)},StatisticsGatherer.prototype.setPreferredResolution=function(F,B,G){this.webRtcStatistics.setPreferredResolution(F,B,G)},StatisticsGatherer.prototype.setIsRendering=function(F,B,G){this.webRtcStatistics.setIsRendering(F,B,G)},StatisticsGatherer.prototype.setReportedSendBandwidth=function(F){this.webRtcStatistics.setReportedSendBandwidth(F)},StatisticsGatherer.prototype.setMaxSessionBandwidth=function(F){this.webRtcStatistics.setMaxSessionBandwidth(F)},StatisticsGatherer.prototype.setTerminated=function(){this.webRtcStatistics.setTerminated()},StatisticsGatherer.prototype.addIceCandidateError=function(F){this.webRtcStatistics.addIceCandidateError(F)},StatisticsGatherer.prototype.clearIceCandidateErrors=function(){this.webRtcStatistics.clearIceCandidateErrors()},StatisticsGatherer.prototype.recordDataChannelProtocolEvent=function(F){this.webRtcStatistics.recordDataChannelProtocolEvent(F)},StatisticsGatherer.prototype.setSessionDataChannelState=function(F){this.webRtcStatistics.setSessionDataChannelState(F)},StatisticsGatherer.prototype.recordDataChannelCreationFailure=function(F){this.webRtcStatistics.recordDataChannelCreationFailure(F)},StatisticsGatherer.prototype.updateSendStream=function(F,B){this.webRtcStatistics.updateSendStream(F,B)},StatisticsGatherer.prototype.setH264AvailableProfiles=function(F){if(F&&F.codecs){var B=[];F.codecs.forEach((function(F){if("h264"===F.mimeType&&F.sdpFmtpLine){var G=/profile-level-id=(.{6})/.exec(F.sdpFmtpLine);G&&G[1]&&(B=B.concat(G[1]))}})),this.webRtcStatistics.addH264AvailableProfiles(B)}},StatisticsGatherer.prototype.processRawReport=function(F){this.processStatsDict(this.statisticsMapper.build(F))},StatisticsGatherer.prototype.processLegacyReport=function(F){this.processStatsDict(unwrapResults(F))},StatisticsGatherer.prototype.getReport=function(F){var B=this;return this.processStatistics().then((function(){return B.getLastKnownReport(F)}))},StatisticsGatherer.prototype.getLastKnownReport=function(F,B){void 0===B&&(B=!1);var G=this.webRtcStatistics.getReport(F,B);return this.addStreamInfoForE2ETests(G),G},StatisticsGatherer.prototype.dispose=function(){this.interval&&(this.window.clearInterval(this.interval),this.interval=0),this.pc=null},StatisticsGatherer.prototype.getLastStatistics=function(){return this.statistics},StatisticsGatherer.prototype.setTimeToFirstFrame=function(F,B){this.webRtcStatistics.setTimeToFirstFrame(F,B)},StatisticsGatherer.prototype.setFreezeDuration=function(F,B){this.webRtcStatistics.setFreezeDuration(F,B)},StatisticsGatherer.prototype.addVideoControlMessage=function(F){void 0===F&&(F=!1),this.webRtcStatistics.addVideoControlMessage(F)},StatisticsGatherer.prototype.setSsrcTrackPair=function(F,B){this.statisticsMapper.setSsrcTrackPair(F,B)},StatisticsGatherer.prototype.updateStatsWithLocalSsrcTrackInfo=function(){var F,B;try{for(var G=K(this.mediaManager.getMediaEntities()),W=G.next();!W.done;W=G.next()){var z=W.value,J=z.getLocalSsrc();J&&this.statisticsMapper.setSsrcTrackPair(J,z.getLocalTrackId())}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}},StatisticsGatherer.prototype.addReportedReceiveBandwidth=function(F){this.webRtcStatistics.addReportedReceiveBandwidth(F)},StatisticsGatherer.prototype.addOptimalVideoCountReport=function(F){this.webRtcStatistics.addOptimalVideoCountReport(F)},StatisticsGatherer.prototype.addStreamInfoForE2ETests=function(F){var B=this._sessionInfo.negotiatedModalities;if(B)try{F.localStreams=this.getSendersReport(this.pc.getSenders(),{audio:$.hasSendDirectionality(B.audio),video:$.hasSendDirectionality(B.video)}),F.remoteStreams=this.getReceiversReport(this.pc.getReceivers(),{audio:$.hasReceiveDirectionality(B.audio),video:$.hasReceiveDirectionality(B.video)})}catch(F){this.logger.safe.warn("addStreamInfoForE2ETests failed: ".concat(Y.stringifyObject(F)))}},StatisticsGatherer.prototype.getReceiversReport=function(F,B){var G=[];return F.forEach((function(F){var W={tracks:[]};G.push(W),F.track&&("audio"===F.track.kind&&B.audio||"video"===F.track.kind&&B.video)&&W.tracks.push({stream:void 0,track:F.track})})),G},StatisticsGatherer.prototype.getSendersReport=function(F,B){var G=[],W={tracks:[]};return G.push(W),F.forEach((function(F){F.track&&("audio"===F.track.kind&&B.audio||"video"===F.track.kind&&B.video)&&W.tracks.push({stream:void 0,track:F.track})})),G},StatisticsGatherer.prototype.processStatistics=function(){var F=this;return new Promise((function(B){F.pc&&"closed"!==F.pc.iceConnectionState?F.useNewStatsApi?F.pc.getStats().then((function(G){G.size<1||F.processStatsDict(F.unwrapNewApiResults(G)),B()})).catch((function(G){F.logger.safe.warn("getStats failed: ".concat(Y.stringifyObject(G))),B()})):F.pc.getStats((function(G){G.result?(F.processStatsDict(unwrapResults(G)),B()):B()})):B()}))},StatisticsGatherer.prototype.unwrapNewApiResults=function(F){var B={};return F.forEach((function(F){B[F.type]=B[F.type]||{},B[F.type][F.id]=F})),this.statisticsMapper.build(B)},StatisticsGatherer.prototype.processStatsDict=function(F){var G=this;this.webRtcStatistics.processStatsDict(F);var W=0,z=0,K=F[te]?F[te][ne]:null;K&&(W=Number(K[ie]),z=Number(K[re]));var J=1e3*((this.configProvider.mediaConfig.maxBandwidthInKbps||Math.floor(Number.MAX_SAFE_INTEGER/1e3))-(this.configProvider.config.audioBandwidthInKbps||0)),Q=isNaN(W)?0:W,$=isNaN(z)?0:z,X={estimatedReceiveBandwidth:Math.min(Q,J),estimatedSendBandwidth:Math.min($,J),remoteVideoStreams:{},localVideoStreams:{},isSpeaking:this.webRtcStatistics.getSpeakingState(),audioHwSilent:this.webRtcStatistics.getAudioHwSilent(),networkSendLevel:this.webRtcStatistics.getNetworkSendLevel(),networkRecvLevel:this.webRtcStatistics.getNetworkRecvLevel()};Y.forOwn(F.ssrc,(function(F){if("video"===F[oe]){var W=F[B.TRACK_ID],z=F.id;-1!==z.indexOf("_recv")?(X.remoteVideoStreams[W]={trackId:W,frameRateReceived:Number(F[B.VIDEO_FRAME_RATE_RECEIVED]),frameRateDecoded:Number(F[B.VIDEO_FRAME_RATE_DECODED]),framesDecoded:Number(F[ae])},G.configProvider.config.isRenderingBasedOnRawStatistics||(X.remoteVideoStreams[W].isRendering=G.webRtcStatistics.getIsRendering(z))):W&&-1!==z.indexOf("_send")&&(X.localVideoStreams[W]={trackId:W,ssrc:Number(F.ssrc),frameRateInput:Number(F[se])})}})),this.notifyRawStatisticsChanged(F),Y.deepEqual(this.statistics,X)||(this.statistics=X,this.notifyStatisticsChanged())},StatisticsGatherer.prototype.notifyRawStatisticsChanged=function(F){this.event("onRawStatisticsChanged").raise(F)},StatisticsGatherer.prototype.notifyStatisticsChanged=function(){this.event("onStatisticsChanged").raise(this.statistics)},StatisticsGatherer}(J.default);B.StatisticsGatherer=ce},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.AudioStreamAnalyzer=void 0;var W=G(18),z=G(1),K=function(){function AudioStreamAnalyzer(F){this.audioContext=new W.default.window.AudioContext,this.sourceNode=this.audioContext.createMediaStreamSource(F),this.analyzerNode=this.createAnalyserNode(this.sourceNode)}return AudioStreamAnalyzer.prototype.dispose=function(){this.sourceNode.disconnect(),this.audioContext.close(),this.analyzerNode=void 0},AudioStreamAnalyzer.prototype.getInputLevel=function(){if(!this.analyzerNode)return 0;var F=new Uint8Array(this.analyzerNode.frequencyBinCount);return this.analyzerNode.getByteFrequencyData(F),Math.floor(65535*(0,z.getAverage)(F)/255)},AudioStreamAnalyzer.prototype.createAnalyserNode=function(F){var B=this.audioContext.createAnalyser();return B.fftSize=1024,B.smoothingTimeConstant=.1,F.connect(B),B},AudioStreamAnalyzer}();B.AudioStreamAnalyzer=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(1),z=G(4),K=function(){function WebrtcAudioPacketLossRate(F){void 0===F&&(F=100),this.minPacketsReceivedToCalculatePacketLossRate=F,this.prevPacketLost=0,this.prevPacketReceived=0,this.packetLostRateMax=0,this.totalPacketsLost=0,this.packetsLostDuration=0,this.prevPacketLostForAvgCalculations=0}return WebrtcAudioPacketLossRate.prototype.capturePacketsLostAndPacketsReceived=function(F,B){this.packetsLostDuration+=z.default.TIME_INTERVAL.SEC_1,this.setTotalPacketsLost(F);var G=B-this.prevPacketReceived;if(!(G<this.minPacketsReceivedToCalculatePacketLossRate)){this.prevPacketReceived=B;var K=F-this.prevPacketLost;this.prevPacketLost=F,this.packetLostRateMax=Math.max((0,W.round)(100*K/(K+G),2),this.packetLostRateMax)}},WebrtcAudioPacketLossRate.prototype.getPacketsLostRateMax=function(){return this.packetLostRateMax},WebrtcAudioPacketLossRate.prototype.getAvgPacketsLost=function(){return this.totalPacketsLost?(0,W.round)(this.totalPacketsLost/this.packetsLostDuration,2):0},WebrtcAudioPacketLossRate.prototype.setTotalPacketsLost=function(F){var B=F-this.prevPacketLostForAvgCalculations;B>0&&(this.totalPacketsLost+=B),this.prevPacketLostForAvgCalculations=F},WebrtcAudioPacketLossRate}();B.default=K},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.WebRTCDataTelemetry=B.DataChannelProtocolEventState=void 0;var z,K=G(1);!function(F){F[F.PARSE_SUCCESS=0]="PARSE_SUCCESS",F[F.PARSE_FAIL=1]="PARSE_FAIL",F[F.OUT_OF_ORDER=2]="OUT_OF_ORDER",F[F.FRAGMENTED=3]="FRAGMENTED",F[F.DISMISSED=4]="DISMISSED"}(z=B.DataChannelProtocolEventState||(B.DataChannelProtocolEventState={}));var J=function(){function WebRTCDataTelemetry(){this.messageCounters=new Map}return WebRTCDataTelemetry.prototype.recordDataChannelProtocolEvent=function(F){this.messageCounters.has(F.dataId)||this.messageCounters.set(F.dataId,{});var B=this.messageCounters.get(F.dataId);switch(B[F.direction]||(B[F.direction]={successful:0,failed:0,fragmented:0,outOfOrder:0,dismissed:0}),F.state){case z.PARSE_SUCCESS:B[F.direction].successful++;break;case z.PARSE_FAIL:B[F.direction].failed++;break;case z.FRAGMENTED:B[F.direction].fragmented++;break;case z.OUT_OF_ORDER:B[F.direction].outOfOrder++;break;case z.DISMISSED:B[F.direction].dismissed++}},WebRTCDataTelemetry.prototype.setSessionDataChannelState=function(F){this.sessionState=F.toString()},WebRTCDataTelemetry.prototype.recordDataChannelCreationFailure=function(F){this.createChannelFailReason=K.stringifyObject(F)},Object.defineProperty(WebRTCDataTelemetry.prototype,"protocolCounters",{get:function(){var F,B;if(this.messageCounters.size){var G={};try{for(var z=W(this.messageCounters.keys()),K=z.next();!K.done;K=z.next()){var J=K.value;G[J]=this.messageCounters.get(J)}}catch(B){F={error:B}}finally{try{K&&!K.done&&(B=z.return)&&B.call(z)}finally{if(F)throw F.error}}return G}},enumerable:!1,configurable:!0}),WebRTCDataTelemetry.prototype.getReport=function(F){var B={};return B[F+"ProtocolCounters"]=JSON.stringify(this.protocolCounters),B[F+"SessionState"]=this.sessionState,B[F+"CreateChannelFailReason"]=this.createChannelFailReason,B},WebRTCDataTelemetry}();B.WebRTCDataTelemetry=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(1),z=G(4),K=G(395),J=G(396),Q=G(397),Y=G(398),$=G(399),X=G(400),Z=G(401),ee=G(402),te=G(403),ne=G(404),ie=G(405),re=G(406),oe=G(143),ae=G(1),se=function(){function WebRTCVideoTelemetry(F,B,G,W){void 0===W&&(W="Video"),this.startTime=F,this.configProvider=B,this.logger=G,this.mediaType=W,this.subscriptionCounter=0,this.videoFreezeTelemetry=new $.default(this.configProvider,this.startTime),this.videoDelayTelemetry=new Y.default,this.videoSubscriptionEvents=new re.default(this.configProvider),this.videoQPEvents=new te.default,this.videoResolutionTelemetry=new ne.default,this.videoGeneralTelemetry=new X.default,this.videoStreamsCounters=new ie.default,this.videoBitrate=new J.default,this.videoMaxCapabilities=new Q.default(this.configProvider,this.logger),this.videoOvershoot=new ee.default(this.logger),this.keyFrameStats=new Z.WebRTCVideoKeyFrameMonitor(this.configProvider,this.logger),this.videoQualityLimitations=new K.WebRTCQualityLimitationTelemetry(this.configProvider),this.videoPacketLostRate=new oe.default(this.configProvider.config.minPacketsReceivedToCalculatePacketLossRate),this.timeToFirstFrame=-1,this.currentTrackId="",this.recvTotalFreezeDurationMs=0,this.isRenderingEvents=[]}return Object.defineProperty(WebRTCVideoTelemetry.prototype,"trackId",{get:function(){return this.currentTrackId},set:function(F){this.currentTrackId=F},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoTelemetry.prototype,"isRecvDataGatheringEnabled",{get:function(){return this.subscriptionCounter>0},enumerable:!1,configurable:!0}),WebRTCVideoTelemetry.prototype.startStopRecvDataGathering=function(F){this.logger.safe.info("Receive data gathering is ".concat(F?"enabled":"disabled")),F?this.subscriptionCounter++:this.subscriptionCounter--,this.subscriptionCounter<0&&this.logger.safe.error("Subscription counter should not be less than 0. Actual value is ".concat(this.subscriptionCounter)),0===this.subscriptionCounter&&this.stopRecvGathering()},WebRTCVideoTelemetry.prototype.stopDataGathering=function(){this.stopRecvGathering(),this.stopSendGathering()},WebRTCVideoTelemetry.prototype.stopRecvGathering=function(){this.videoFreezeTelemetry.stopRecvDataGathering(),this.videoGeneralTelemetry.stopRecvDataGathering(),this.videoBitrate.stopCapture(z.default.MEDIA_DIRECTION.RECV)},WebRTCVideoTelemetry.prototype.isSendGathering=function(){return this.videoGeneralTelemetry.isGatheringSendData()},WebRTCVideoTelemetry.prototype.stopSendGathering=function(){this.videoGeneralTelemetry.stopSendDataGathering(),this.videoBitrate.stopCapture(z.default.MEDIA_DIRECTION.SEND),this.videoOvershoot.flush(),this.keyFrameStats.flush()},WebRTCVideoTelemetry.prototype.gatherRecvFreezeData=function(F,B,G){this.videoFreezeTelemetry.gatherFreezeData({frameRateDecoded:F,frameRateRecv:B,bytesReceived:G,mediaType:this.mediaType})},WebRTCVideoTelemetry.prototype.detectCaptureFreeze=function(F){this.videoFreezeTelemetry.detectCaptureFreeze(F)},WebRTCVideoTelemetry.prototype.getRecvFreezeDurationCounts=function(){return this.videoFreezeTelemetry.getRecvFreezeDurationCounts()},WebRTCVideoTelemetry.prototype.getRecvFreezeDurationTimestamps=function(){return this.videoFreezeTelemetry.getRecvFreezeDurationTimestamps(this.configProvider.config.maxVideoFreezeTimestampsInBucket)},WebRTCVideoTelemetry.prototype.getRecvTotalFreezeDuration=function(){return this.videoFreezeTelemetry.getRecvTotalFreezeDuration()},WebRTCVideoTelemetry.prototype.setRecvTotalFreezeDurationMs=function(F){this.recvTotalFreezeDurationMs=void 0!==F?this.recvTotalFreezeDurationMs+=F:void 0},WebRTCVideoTelemetry.prototype.analyzeDelay=function(F,B){this.videoDelayTelemetry.analyzeDelay(F,B)},WebRTCVideoTelemetry.prototype.getDelayCur=function(){return this.videoDelayTelemetry.getDelayCur()},WebRTCVideoTelemetry.prototype.getDelayAvg=function(){return this.videoDelayTelemetry.getDelayAvg()},WebRTCVideoTelemetry.prototype.addSubscriptionEvent=function(F){this.videoSubscriptionEvents.addSubscriptionEvent(F)},WebRTCVideoTelemetry.prototype.getSubscriptionEvents=function(){return this.videoSubscriptionEvents.getSubscriptionEvents()},WebRTCVideoTelemetry.prototype.captureQpData=function(F,B,G){this.videoQPEvents.captureQpData(F,B,G)},WebRTCVideoTelemetry.prototype.getQpAverage=function(F){return this.videoQPEvents.getQpAverage(F)},WebRTCVideoTelemetry.prototype.captureMediaData=function(F,B,G){this.videoGeneralTelemetry.captureMediaData(F,B,G)},WebRTCVideoTelemetry.prototype.getIsRendering=function(){var F=this.configProvider.config.notRenderingTimeInterval["Video"===this.mediaType?"video":"sharing"];return this.videoFreezeTelemetry.getIsRendering(F)},WebRTCVideoTelemetry.prototype.captureFrameRate=function(F){this.videoGeneralTelemetry.captureFrameRate(F)},WebRTCVideoTelemetry.prototype.getTotalDuration=function(F){return this.videoGeneralTelemetry.getTotalDuration(F)},WebRTCVideoTelemetry.prototype.captureResolutionSample=function(F){this.videoResolutionTelemetry.captureSample(F)},WebRTCVideoTelemetry.prototype.countRecvStreams=function(F){this.videoStreamsCounters.countRecvStreams(F)},WebRTCVideoTelemetry.prototype.captureBitrateSample=function(F,B){this.videoBitrate.captureSample(F,B)},WebRTCVideoTelemetry.prototype.captureAllocateBandwidth=function(F){this.videoBitrate.captureAllocateBandwidth(F)},WebRTCVideoTelemetry.prototype.capturePreferredResolution=function(F,B){this.videoResolutionTelemetry.capturePreferredResolution(F,B)},WebRTCVideoTelemetry.prototype.setMaxCapabilitesRequested=function(F,B){var G;void 0===B&&(B=!1),this.videoMaxCapabilities.setMaxCapabilitesRequested(F),B||1===F.capabilities.length&&!(null===(G=F.capabilities[0])||void 0===G?void 0:G.ssrc)||this.setMaxCapabilitiesOvershoot(F.capabilities)},WebRTCVideoTelemetry.prototype.setMaxCapabilitesApplied=function(F,B){var G;void 0===B&&(B=!1),this.videoMaxCapabilities.setMaxCapabilitesApplied(F),B||1===F.capabilities.length&&!(null===(G=F.capabilities[0])||void 0===G?void 0:G.ssrc)||this.setMaxCapabilitiesOvershoot(F.capabilities)},WebRTCVideoTelemetry.prototype.getMaxCapabilitiesEvents=function(){var F=this.videoMaxCapabilities.getEvents();return JSON.stringify(F)},WebRTCVideoTelemetry.prototype.setCurrentParameters=function(F,B,G){this.videoOvershoot.setCurrentParams(F,B.height/16*(B.width/16),G)},WebRTCVideoTelemetry.prototype.setMaxCapabilitiesOvershoot=function(F){this.videoOvershoot.setMaxCapabilities(F)},WebRTCVideoTelemetry.prototype.getOvershootEvents=function(){var F=this,B=this.videoOvershoot.getEvents();return(B=B.slice(Math.max(0,B.length-(this.configProvider.config.maxReportedOvershootingEvents+1)),B.length)).forEach((function(B){return B.timestamp=B.timestamp-F.startTime})),JSON.stringify(B)},WebRTCVideoTelemetry.prototype.getOvershootTotalDurations=function(){var F=this,B=this.videoOvershoot.getEvents();return B.forEach((function(B){return B.timestamp=B.timestamp-F.startTime})),JSON.stringify({fs:B.reduce((function(F,B){return"fs"===B.overshootType?F+B.duration:F}),0),fps:B.reduce((function(F,B){return"fps"===B.overshootType?F+B.duration:F}),0)})},WebRTCVideoTelemetry.prototype.setQualityLimitationReason=function(F){this.videoQualityLimitations.setQualityLimitationReason(F)},WebRTCVideoTelemetry.prototype.getQualityLimitationReasonEvents=function(){return this.videoQualityLimitations.getQualityLimitationReasonEvents()},WebRTCVideoTelemetry.prototype.setKeyFrameRequested=function(F){F&&this.keyFrameStats.setKeyFrameRequested("FMTP")},WebRTCVideoTelemetry.prototype.setKeyFrameData=function(F){this.keyFrameStats.setKeyFrameData(F)},WebRTCVideoTelemetry.prototype.getKeyFrameStats=function(){var F=this.keyFrameStats.getStats();return JSON.stringify(F)},WebRTCVideoTelemetry.prototype.captureTimeToFirstFrame=function(F){-1!==F&&(this.timeToFirstFrame=F)},WebRTCVideoTelemetry.prototype.getTimeToFirstFrame=function(){return this.timeToFirstFrame},WebRTCVideoTelemetry.prototype.setIsRendering=function(F){(0,ae.arrayPushFixedSize)(this.isRenderingEvents,{isRendering:F,ts:Date.now()},this.configProvider.config.diagnostics.telemetryLimits.numIsRenderingEvents)},WebRTCVideoTelemetry.prototype.capturePacketsLostAndPacketsReceved=function(F,B){this.videoPacketLostRate.capturePacketsLostAndPacketsReceived(F,B)},WebRTCVideoTelemetry.prototype.setMsi=function(F){this.msi=F},WebRTCVideoTelemetry.prototype.setLocalMsi=function(F){this.localMsi=F},WebRTCVideoTelemetry.prototype.getReport=function(F,B,G,K){void 0===K&&(K=!1);var J={};if(J[B+"DurationSeconds"]=this.getTotalDuration(F),J[B+"QpAvg"]=this.getQpAverage(F),J[B+"frameRateAvg"]=this.videoGeneralTelemetry.getAvgFrameRate(F),J[B+"bitrateAvg"]=this.videoBitrate.getAvg(F),J[B+"bitrateMax"]=this.videoBitrate.getMax(F),F===z.default.MEDIA_DIRECTION.SEND)J[B+"DelayCur"]=this.getDelayCur(),J[B+"DelayAvg"]=this.getDelayAvg(),J[B+"TimeSinceLastEncodeStart"]=this.videoGeneralTelemetry.getTimeSinceLastDecode(F),J[B+"AllocateBWAvg"]=this.videoBitrate.getAllocateBandwidthAvg(),J[B+"CaptureFramerateAvg"]=this.videoGeneralTelemetry.getSendCameraFramerate(),J[B+"FreezeIntervals"]=this.videoFreezeTelemetry.getSendCameraFreezeIntervals(),J[B+"MaxCapabilities"]=K?"":this.getMaxCapabilitiesEvents(),J[B+"OvershootEvents"]=this.getOvershootEvents(),J[B+"OvershootDurations"]=this.getOvershootTotalDurations(),J[B+"qualityLimitationReasonEvents"]=JSON.stringify(this.getQualityLimitationReasonEvents()),G||(J[B+"KeyFrameStats"]=this.getKeyFrameStats(),J[B+"KeyFrameLongestDelay"]=this.keyFrameStats.getKeyFrameLongestDelay());else if(F===z.default.MEDIA_DIRECTION.RECV){J[B+"TimeSinceLastDecodeStart"]=this.videoGeneralTelemetry.getTimeSinceLastDecode(F),J[B+"FreezeHistogram"]=this.getRecvFreezeDurationCounts(),J[B+"FreezeTimestamps"]=this.getRecvFreezeDurationTimestamps(),J[B+"LongestFreezeDuration"]=this.videoFreezeTelemetry.getLongestRecvFreezeDuration(),J[B+"RecvAvgFreezeDuration"]=this.videoFreezeTelemetry.getRecvAvgFreezeDuration(),J[B+"TotalFreezeDuration"]=this.getRecvTotalFreezeDuration(),J[B+"TotalFreezeDurationMs"]=this.recvTotalFreezeDurationMs,J[B+"OngoingFreeze"]=this.videoFreezeTelemetry.getRecvFreezeIsOngoing(this.configProvider.config.webrtcEndOfCallFreezeThreshold),J[B+"NumResolutionSwitches"]=this.videoResolutionTelemetry.resolutionSwitchCount,J[B+"PreferredResolution"]=this.videoResolutionTelemetry.preferredResolution,J[B+"PreferredResolutionDurations"]=JSON.stringify(this.videoResolutionTelemetry.preferredResolutionDurationRatios),J[B+"packetsLostRateMax"]=this.videoPacketLostRate.getPacketsLostRateMax(),J[B+"ResolutionDurations"]=JSON.stringify(this.videoResolutionTelemetry.resolutionDurationRatios);var Q=this.videoStreamsCounters.getStreamCounts();J[B+"StreamsMin"]=Q.min,J[B+"StreamsMax"]=Q.max,J[B+"StreamsMode"]=Q.mode,J[B+"TimeToFirstFrame"]=this.timeToFirstFrame,J[B+"FpsHarmonicAverage"]=(0,W.round)(this.videoGeneralTelemetry.getRecvFpsHarmonicAverage(),2),J[B+"LocalMsi"]=this.localMsi,J[B+"Msi"]=this.msi,J[B+"isRenderingEvents"]=JSON.stringify(this.isRenderingEvents)}return J},WebRTCVideoTelemetry}();B.default=se},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(23),z=G(18),K=G(408),J=G(412);function UnsupportedAdapter(){function throwUnsupported(){throw new Error("unsupported platform")}this.SdpTransform=throwUnsupported,this.RTCPeerConnection=throwUnsupported,this.RTCSessionDescription=throwUnsupported,this.RTCRtpReceiver=throwUnsupported}function isWebkitRtc(){return void 0!==z.default.window.webkitRTCPeerConnection}function isMozillaRtc(){return void 0!==z.default.window.mozRTCPeerConnection}function isRtc(){return void 0!==z.default.window.RTCPeerConnection}function isSafariRtc(){return isRtc()&&"Safari"===(0,W.getBrowserInfo)().name}B.default={build:function(F){return isWebkitRtc()?F.unifiedPlanEnabled?new K.default(F):new J.WebkitAdapter(F):isMozillaRtc()||isSafariRtc()?new K.default(F):new UnsupportedAdapter}}},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var K=G(46),J=G(51),Q=G(18),Y=G(27),$=function(){function RTCRtpReceiverCababilities(){}return RTCRtpReceiverCababilities.prototype.getCapabilities=function(F){var B=RTCRtpReceiver.getCapabilities(F);return B.codecs.forEach((function(F){var B=F.mimeType.toLowerCase().split("/");F.mimeType=B[1]||B[0]})),Promise.resolve(B)},RTCRtpReceiverCababilities}(),X=function(){function SdpCababilties(F){this.selfGlobal=F.global.capabilityGatherer=F.global.capabilityGatherer||{},this.getCapabilities("video")}return SdpCababilties.prototype.getCapabilities=function(F){return W(this,void 0,void 0,(function(){var B,G,W,Y,$,X,Z;return z(this,(function(z){switch(z.label){case 0:if("video"!==F&&"audio"!==F)return[2,Promise.reject(new Error("capabilities for ".concat(F," are not supported")))];if(this.selfGlobal.gatherTask)return[3,4];B=J.defer(),this.selfGlobal.gatherTask=B.promise,G=void 0!==Q.default.window.webkitRTCPeerConnection,W=G?new Q.default.window.webkitRTCPeerConnection(null):new Q.default.window.RTCPeerConnection(null),Y=function(F){return G?new Promise((function(B,G){W.createOffer(B,G,F)})):W.createOffer(F)},z.label=1;case 1:return z.trys.push([1,3,,4]),[4,Y({offerToReceiveVideo:1,offerToReceiveAudio:1})];case 2:return $=z.sent(),X={},K.parse($.sdp).media.forEach((function(F){X[F.type]=F.rtp.map((function(B){var G,W={mimeType:B.codec.toLowerCase()};if("video"===F.type){var z=null===(G=F.fmtp)||void 0===G?void 0:G.find((function(F){return F.payload===B.payload}));W.sdpFmtpLine=null==z?void 0:z.config}return W}))})),W.close(),B.resolve(X),[3,4];case 3:return Z=z.sent(),this.selfGlobal.gatherTask=null,W.close(),B.reject(Z),[3,4];case 4:return[2,this.selfGlobal.gatherTask.then((function(B){return{codecs:B[F]}}))]}}))}))},SdpCababilties}();B.default={build:function(F,B){return!B&&Y.UserAgentConfig.hasCapabilitiesApi()?new $:new X(F)}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(18),z="rollback";function SessionDescription(){var F=[].slice.apply(arguments),B=F[0]&&isRollback(F[0].type);F.splice(0,B?1:0,null);var G=new(Function.prototype.bind.apply(W.default.window.RTCSessionDescription,F)),K=Object.getOwnPropertyDescriptor(W.default.window.RTCSessionDescription.prototype,"type");return Object.defineProperty(G,"type",{get:function(){return B?z:K.get.call(G)},set:function(F){(B=isRollback(F))||K.set.call(G,F)}}),G}function isRollback(F){return z===F}B.default={build:function(){return SessionDescription}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ContributingSourcesHandler=B.ContributingSourcesHandlerState=void 0;var W,z=G(18);!function(F){F[F.Stopped=0]="Stopped",F[F.Started=1]="Started",F[F.Unsupported=2]="Unsupported"}(W=B.ContributingSourcesHandlerState||(B.ContributingSourcesHandlerState={}));var K=function(){function ContributingSourcesHandler(F){this.context=F,this._state=W.Stopped,this._lastSources=[],this._window=z.default.window,this._logger=F.logger.createChild("contributingSources")}return ContributingSourcesHandler.prototype.startPolling=function(){this._state===W.Stopped&&(this._state=W.Started,this._logger.safe.info("polling started"),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval))},ContributingSourcesHandler.prototype.stopPolling=function(){this._state===W.Started&&(this._timer&&(this._window.clearTimeout(this._timer),this._timer=void 0),this._state=W.Stopped,this._logger.safe.info("polling stopped"))},Object.defineProperty(ContributingSourcesHandler.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),ContributingSourcesHandler.prototype.poll=function(){var F=this;if(this._state===W.Started){var B=this.context.provider();B?(this.context.activeSpeakerManager.onContributingSourcesChanged(B.filter((function(B){var G=F._lastSources.filter((function(F){return F.source===B.source}))[0];return!G||G.timestamp!==B.timestamp})).map((function(F){return F.source}))),this.updateLastSources(B),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval)):(this._logger.safe.info("contributing sources are not supported on this client"),this._state=W.Unsupported,this.stopPolling())}},ContributingSourcesHandler.prototype.updateLastSources=function(F){var B=this;this._lastSources=[],F.forEach((function(F){B._lastSources.push({source:F.source,timestamp:F.timestamp})}))},ContributingSourcesHandler}();B.ContributingSourcesHandler=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(83),z=G(4),K=G(151),J=G(39),Q=function(){function MediaManager(F){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.localSsrcs=new Map,this.ssrcGenerator=new W.SsrcGenerator,this.logger=F.logger.createChild("MM"),this.configProvider=F.configProvider,this.numVideoChannels=F.numVideoChannels}return MediaManager.prototype.fromOffer=function(F,B){var G=this;F.media.forEach((function(F){if(F.type===z.default.MEDIA_TYPE.audio)z.default.MODALITY.audio in B&&G.addMediaEntity(z.default.MODALITY.audio);else if(F.type===z.default.MEDIA_TYPE.video){if(z.default.MODALITY.video in B)for(var W=0;W<G.numVideoChannels;W++)G.addMediaEntity(z.default.MODALITY.video);z.default.MODALITY.sharing in B&&G.addMediaEntity(z.default.MODALITY.sharing)}else F.type===z.default.MEDIA_TYPE.data&&z.default.MODALITY.data in B&&G.addMediaEntity(z.default.MODALITY.data)}))},MediaManager.prototype.fromRemote=function(F,B){var G=this;F.media.forEach((function(F,W){var z=(0,J.getModality)(F);if(0!==F.port&&z in B){if(G.mediaEntities[W]?G.mediaEntities[W].update(z,F.mid||G.generateMid(W)):G.addMediaEntity(z,F.mid||G.generateMid(W)),F.msid)G.mediaEntities[W].setRemoteStreamId(F.msid.split(" ")[0]),G.mediaEntities[W].setRemoteTrackId(F.msid.split(" ")[1]);else if(F.ssrcs){var K=F.ssrcs.find((function(F){return"msid"===F.attribute}));K?(G.mediaEntities[W].setRemoteStreamId(K.value.split(" ")[0]),G.mediaEntities[W].setRemoteTrackId(K.value.split(" ")[1])):G.logger.safe.warn("No ssrc msid for media of type ".concat(F.type," with mid ").concat(F.mid))}var Q=F.xSourceStreamId||G.generateSourceStreamId(W);G.mediaEntities[W].setXSourceStreamId(Q)}else G.mediaEntities[W]?G.mediaEntities[W].disable():G.addDisabledMediaEntity(z),G.mediaEntities[W].setRemoteStreamId(null),G.mediaEntities[W].setRemoteTrackId(null)}))},MediaManager.prototype.isEmpty=function(){return 0===this.mediaEntities.length},MediaManager.prototype.addMediaEntity=function(F,B){this.createMediaEntity(F,B||this.generateMid(this.mediaEntities.length))},MediaManager.prototype.addDisabledMediaEntity=function(F){this.createMediaEntity(F)},MediaManager.prototype.getMediaEntities=function(){return this.mediaEntities},MediaManager.prototype.createMediaEntity=function(F,B){var G=K.default.create(this.configProvider,F,B);return this.mediaEntities.push(G),G},MediaManager.prototype.getMediaEntity=function(F){return this.mediaEntities[F]},MediaManager.prototype.getMediaEntityByMid=function(F){return this.mediaEntities.find((function(B){return B.getMid()===F}))},MediaManager.prototype.getMediaEntitiesByModality=function(F){return this.mediaEntities.filter((function(B){return B.getModality()===F}))},MediaManager.prototype.getMediaEntityByRemoteStreamId=function(F){return this.mediaEntities.find((function(B){return B.getRemoteStreamId()===F}))},MediaManager.prototype.getMediaEntityByLocalTrackId=function(F){return this.mediaEntities.find((function(B){return B.getLocalTrackId()===F}))},MediaManager.prototype.getMediaEntityByXSourceStreamId=function(F){return this.mediaEntities.find((function(B){return B.getXSourceStreamId()===F}))},MediaManager.prototype.reset=function(){this.mediaEntities=[]},MediaManager.prototype.syncModalities=function(F,B,G){this.disableModalities(B),G||(this.enableModalities(B),this.addModalities(B))},MediaManager.prototype.enableModalities=function(F){var B=this;this.mediaEntities.forEach((function(G,W){G.getModality()in F&&G.isDisabled()&&G.update(G.getModality(),B.generateMid(W))}))},MediaManager.prototype.disableModalities=function(F){this.mediaEntities.forEach((function(B){B.getModality()in F||B.disable()}))},MediaManager.prototype.addModalities=function(F){var B={};for(var G in this.mediaEntities.map((function(F){return F.getModality()})).forEach((function(F){B[F]=!0})),F)G in B||this.addMediaEntity(G)},MediaManager.prototype.setLocalTracksInfo=function(F){this.mediaTracks=F,this.updateLocalSsrc(this.mediaTracks)},MediaManager.prototype.getLocalTracksInfo=function(){return this.mediaTracks},MediaManager.prototype.getLocalSsrcs=function(){return this.localSsrcs},MediaManager.prototype.updateMediaEntitiesWithLocalTracks=function(){var F=this;this.mediaTracks&&(this.mediaEntities.forEach((function(F){return F.setLocalTrackId(null)})),this.mediaTracks.forEach((function(B){var G=F.getMediaEntitiesByModality(B.modality)[0];G?G.setLocalTrackId(B.trackId):F.logger.safe.error("Media entity is not found for modality: ".concat(JSON.stringify(B.modality)))})))},MediaManager.prototype.updateMediaEntitiesWithActivityState=function(F,B){},MediaManager.prototype.backup=function(){var F=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach((function(B){F.mediaEntitiesBackup.push(B.clone())}))},MediaManager.prototype.commit=function(){this.mediaEntitiesBackup=[]},MediaManager.prototype.rollback=function(){this.mediaEntities=this.mediaEntitiesBackup},MediaManager.prototype.generateSourceStreamId=function(F){return F+10},MediaManager.prototype.generateMid=function(F){return"media_".concat(F)},MediaManager.prototype.updateLocalSsrc=function(F){var B=this;F.forEach((function(F){if(!B.localSsrcs.get(F.modality)){var G=B.ssrcGenerator.nextVideoStreamSsrc().min;B.logger.safe.debug("Ssrc updated for modality: ".concat(F.modality,": ").concat(G)),B.localSsrcs.set(F.modality,G)}}))},MediaManager}();B.default=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(8),z=G(1),K=G(415),J=G(4),Q=G(39),Y=function(){function MediaEntity(F,B,G,W){this.entity=F,this.configProvider=B,this.videoCapabilities=G,this.simulcastContext=W}return MediaEntity.getVideoCababilities=function(F,B,G){if(F===J.default.MEDIA_TYPE.video){var W=void 0,z=void 0;return B===J.default.MODALITY.sharing?(W=G.config.webrtcScreensharingCapabilityMaxFS,z=G.config.webrtcScreensharingCapabilityMaxFPS):(W=G.config.webrtcVideoCapabilityMaxFS,z=G.config.webrtcVideoCapabilityMaxFPS),new K.default(W,z,G.config.h264SubscribeProfile)}return null},MediaEntity.create=function(F,B,G){var W=(0,Q.getTypeFromModality)(B);return new MediaEntity({modality:B,mid:G,mtype:W,extensions:{}},F,MediaEntity.getVideoCababilities(W,B,F),null)},MediaEntity.prototype.clone=function(){return new MediaEntity((0,W.cloneDeep)(this.entity),this.configProvider,this.videoCapabilities,this.simulcastContext)},MediaEntity.prototype.getModality=function(){return this.entity.modality},MediaEntity.prototype.getType=function(){return this.entity.mtype},MediaEntity.prototype.getMid=function(){return this.entity.mid},MediaEntity.prototype.disable=function(){this.entity.mid=null},MediaEntity.prototype.update=function(F,B){this.entity.modality!==F&&(this.videoCapabilities=MediaEntity.getVideoCababilities(this.entity.mtype,F,this.configProvider)),this.entity.modality=F,this.entity.mid=B,this.isEnabled()&&this.setExtension("rollback",!1)},MediaEntity.prototype.isDisabled=function(){return!this.entity.mid},MediaEntity.prototype.isEnabled=function(){return!!this.entity.mid},MediaEntity.prototype.getVideoCapabilities=function(){return this.videoCapabilities},MediaEntity.prototype.getRemoteStreamId=function(){return this.entity.remoteStreamId},MediaEntity.prototype.setRemoteStreamId=function(F){this.entity.remoteStreamId=F},MediaEntity.prototype.setRemoteSsrc=function(F){this.entity.remoteSsrc=F},MediaEntity.prototype.getRemoteSsrc=function(){return this.entity.remoteSsrc},MediaEntity.prototype.setLocalSsrc=function(F){this.entity.localSsrc=F},MediaEntity.prototype.getLocalSsrc=function(){return this.entity.localSsrc},MediaEntity.prototype.getRemoteTrackId=function(){return this.entity.remoteTrackId},MediaEntity.prototype.setRemoteTrackId=function(F){this.entity.remoteTrackId=F},MediaEntity.prototype.getXSourceStreamId=function(){return this.entity.xSourceStreamId},MediaEntity.prototype.setXSourceStreamId=function(F){this.entity.xSourceStreamId=F},MediaEntity.prototype.setLocalTrackId=function(F){this.entity.localTrackId=F},MediaEntity.prototype.getLocalTrackId=function(){return this.entity.localTrackId},MediaEntity.prototype.getExtension=function(F){return this.entity.extensions[F]},MediaEntity.prototype.setExtension=function(F,B){this.entity.extensions[F]=B},MediaEntity.prototype.getRtpHeaderExtensions=function(){return this.entity.rtpExt},MediaEntity.prototype.setRtpHeaderExtensions=function(F){this.entity.rtpExt=F},MediaEntity.prototype.setSimulcastContext=function(F){this.simulcastContext=F},MediaEntity.prototype.getSimulcastContext=function(){return this.simulcastContext},MediaEntity.prototype.serialize=function(){return(0,z.deepClone)(this.entity)},MediaEntity}();B.default=Y},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(46),z=function(){function NegotiationEmulator(F,B,G,W,z){this.logger=F,this.webRtcAdapter=B,this.sessionDescription=G,this.negotiationQueue=W,this.mediaManager=z}return NegotiationEmulator.prototype.dispose=function(){this.peerConnection=null},NegotiationEmulator.prototype.configure=function(F){this.peerConnection=F},NegotiationEmulator.prototype.renegotiateNow=function(){return this.renegotiate(null,!0)},NegotiationEmulator.prototype.renegotiate=function(F,B){if(void 0===B&&(B=!1),!this.peerConnection)throw new Error("trying to renegotiate during empty peerConnection");var G=this.createNegotiationTask(F);return B?(this.logger.safe.info("forced local renegotiation starting"),Promise.resolve(G())):this.negotiationQueue.add(G)},NegotiationEmulator.prototype.normalizeSDESAnswer=function(F,B){var G=W.parse(B),z=W.parse(F);if(G.media[0].crypto)z.media.forEach((function(F){delete F.fingerprint,delete F.setup,F.crypto=F.crypto.filter((function(F){return G.media[0].crypto.some((function(B){return B.id===F.id}))})).slice(0,1)})),z.fingerprint&&delete z.fingerprint;else{var K=this.mediaManager.getMediaEntities().find((function(F){return void 0!==F.getExtension("setup")}));z.media.forEach((function(F){var B=K&&K.getExtension("setup")||"actpass";"actpass"===F.setup&&(F.setup="active"===B?"passive":"active")}))}return W.write(z)},NegotiationEmulator.prototype.normalizeExtensionsAnswer=function(F,B){var G=W.parse(B),z=W.parse(F);return z.media.forEach((function(F,B){var W,z,K=new Set((null===(W=G.media[B].ext)||void 0===W?void 0:W.map((function(F){return F.value})))||[]);F.ext=null===(z=F.ext)||void 0===z?void 0:z.filter((function(F){return K.has(F.value)}))})),W.write(z)},NegotiationEmulator.prototype.createNegotiationTask=function(F){var B=this,throwIfNoPeerConnection=function(){if(!B.peerConnection)throw B.logger.safe.warn("no peer connection present"),new Error("trying to renegotiate during empty peerConnection")};return function(){B.logger.safe.debug("Local renegotiation starting...");var G=B.peerConnection.remoteDescription.sdp;G=B.normalizeSDESAnswer(G,B.peerConnection.localDescription.sdp),G=B.normalizeExtensionsAnswer(G,B.peerConnection.localDescription.sdp);var W=new B.webRtcAdapter.RTCSessionDescription({sdp:G,type:"answer"});return F&&F.forEach((function(F){W=F.modifyDescriptor(W)})),Promise.resolve().then((function(){return B.logger.safe.debug("creating offer"),throwIfNoPeerConnection(),B.peerConnection.createOffer()})).then((function(F){throwIfNoPeerConnection();var G=B.sessionDescription.createLocalOffer(F.sdp),W=new B.webRtcAdapter.RTCSessionDescription({sdp:G.toLocal(),type:"offer"});return B.logger.safe.debug("setting local description"),B.logger.unsafe.debug("local description, sdp: ".concat(W.sdp)),B.peerConnection.setLocalDescription(W)})).then((function(){return throwIfNoPeerConnection(),B.logger.safe.debug("setting remote description"),B.logger.unsafe.debug("remote description, sdp: ".concat(W.sdp)),B.peerConnection.setRemoteDescription(W)})).then((function(F){return B.logger.safe.debug("local renegotiation done"),F})).catch((function(F){throw B.logger.safe.error("local renegotiation failed: ",F.toString()),F}))}},NegotiationEmulator}();B.default=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(1),z=G(4),K=G(416),J=G(418),Q=G(154),Y=function(){function QualityManager(F,B,G,W,z,K){this.logger=F,this.settings=B,this.listener=G,this.statsGatherer=W,this.diagnostics=z,this.configProvider=K,this.mediaSourceModels=[]}return QualityManager.prototype.dispose=function(){this.mediaSourceModels.forEach((function(F){F.handler&&(F.handler.dispose(),F.handler=null)})),this.mediaSourceModels=null,this.sendBandwidthCalculator&&this.disableSendBandwidthCalculator()},QualityManager.prototype.updateRegisteredSources=function(F){this.logger.safe.info("Local media params updated: ".concat(JSON.stringify(F)));var B=[];this.mediaSourceModels.forEach((function(F){return B.push(F.sourceId)}));var G=F.map((function(F){return F.sourceId})),z=W.subtractFrom(B,G);this.removeSourcesWithIds(z);var K=W.subtractFrom(G,B);this.addSourcesWithIds(K,F),this.settings.sendBandwidthNotificationsEnabled&&this.updateSendBandwidthCalculator()},QualityManager.prototype.setMaxCapabilities=function(F){var B=this;return Promise.all(F.map((function(F){if(F.capabilities.length)if(F.sourceId){if(B.isRegistered(F.sourceId)){B.logger.safe.info("Capabilities handler found for sourceId: ".concat(F.sourceId));var G=B.getModelWithSourceId(F.sourceId);if(!G)return void B.logger.safe.info("Model is not registered for sourceId: ".concat(F.sourceId));var W=B.getOrCreateHandlerForModel(G,F.isSimulcast);return W?W.setMaxCapabilities(F.causeId,F.capabilities):void B.logger.safe.info("Handler is not found for sourceId: ".concat(F.sourceId))}B.logger.safe.info("Source ".concat(F.sourceId," is not registered for receive capabilities"))}else B.logger.safe.info("SourceId is not defined to apply recv capabilities: ".concat(JSON.stringify(F)))}))).then((function(){B.logger.safe.debug("Max capabilities application completed")})).catch((function(F){B.logger.error("Max capabilities application error: ".concat(JSON.stringify(F)))}))},QualityManager.prototype.resetCurrentResolution=function(){var F=this.mediaSourceModels.find((function(F){return F.modality===z.default.MODALITY.video}));F&&F.handler&&F.handler.resetCurrentResolution()},QualityManager.prototype.getCurrentResolution=function(){var F=this.mediaSourceModels.find((function(F){return F.modality===z.default.MODALITY.video}));return F&&F.handler?F.handler.getCurrentResolution():this.currentResolution&&this.currentResolution.fs},QualityManager.prototype.setCurrentResolution=function(F){var B=this.mediaSourceModels.find((function(F){return F.modality===z.default.MODALITY.video}));B&&B.handler?B.handler.setCurrentResolution(F):this.currentResolution=F},QualityManager.prototype.getOrCreateHandlerForModel=function(F,B){return F.handler||(F.handler=this.getCapabilitiesHandler(F.modality,B)),F.handler},QualityManager.prototype.addSourcesWithIds=function(F,B){var G=this;F.forEach((function(F){var W=B.find((function(B){return B.sourceId===F}));G.registerSource(F,W.modality)}))},QualityManager.prototype.removeSourcesWithIds=function(F){var B=this;F.forEach((function(F){return B.unregisterSource(F)}))},QualityManager.prototype.registerSource=function(F,B){this.logger.safe.info("SourceId ".concat(F," registered with mediaType: ").concat(B)),this.mediaSourceModels.push({modality:B,sourceId:F})},QualityManager.prototype.unregisterSource=function(F){var B=this.mediaSourceModels.find((function(B){return B.sourceId===F}));B?(B.handler&&B.handler.dispose(),this.mediaSourceModels.splice(this.mediaSourceModels.indexOf(B),1),this.logger.safe.info("SourceId ".concat(F," unregistered"))):this.logger.safe.info("Model doesn't exist with sourceId ".concat(F))},QualityManager.prototype.updateSendBandwidthCalculator=function(){this.mediaSourceModels.some((function(F){return[z.default.MODALITY.video,z.default.MODALITY.sharing].indexOf(F.modality)>-1}))?this.enableSendBandwidthCalculator():this.disableSendBandwidthCalculator()},QualityManager.prototype.enableSendBandwidthCalculator=function(){var F=this;this.sendBandwidthCalculator||(this.sendBandwidthCalculator=new Q.SendBandwidthCalculator(this.configProvider,this.statsGatherer,this.logger.createChild("SendBwCalc")),this.sendBandwidthCalculatorSubscription=this.sendBandwidthCalculator.on("onSendBandwidthChanged",(function(B){return F.onSendBandwidthChanged(B)})))},QualityManager.prototype.disableSendBandwidthCalculator=function(){this.sendBandwidthCalculatorSubscription&&(this.sendBandwidthCalculatorSubscription.dispose(),this.sendBandwidthCalculatorSubscription=null),this.sendBandwidthCalculator&&(this.sendBandwidthCalculator.dispose(),this.sendBandwidthCalculator=null)},QualityManager.prototype.getModelWithSourceId=function(F){return this.mediaSourceModels.find((function(B){return B.sourceId===F}))},QualityManager.prototype.isRegistered=function(F){return!!this.getModelWithSourceId(F)},QualityManager.prototype.getCapabilitiesHandler=function(F,B){if(F===z.default.MODALITY.audio)return null;if(F===z.default.MODALITY.video&&!B&&this.settings.customBwEstimationEnabled){var G=new K.AdaptiveCapablitiesHandler(this.listener,this.statsGatherer,this.diagnostics,this.logger.createChild("ach"),this.configProvider,this.settings,B);return this.currentResolution&&G.setCurrentResolution(this.currentResolution),G}return new J.DirectCapabilitiesHandler(F,this.listener,this.statsGatherer,this.diagnostics,B)},QualityManager.prototype.onSendBandwidthChanged=function(F){var B=this;return this.listener.onSendBandwidthChanged(F).catch((function(F){B.logger.safe.error("Error while reporting send bandwidth change",F),B.sendBandwidthCalculator.forceUpdate()}))},QualityManager}();B.default=Y},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.SendBandwidthCalculator=void 0;var K=function(F){function SendBandwidthCalculator(B,G,W){var z=F.call(this,W)||this;return z.configProvider=B,z.statsGatherer=G,z.logger=W,z.lastReportedAgo=1/0,z._forceUpdate=!1,z.subs=z.statsGatherer.on("onStatisticsChanged",(function(F){return z.onStatisticsChanged(F)})),z}return z(SendBandwidthCalculator,F),SendBandwidthCalculator.prototype.forceUpdate=function(){this._forceUpdate=!0},SendBandwidthCalculator.prototype.dispose=function(){this.subs.dispose(),this.subs=null},SendBandwidthCalculator.prototype.onStatisticsChanged=function(F){this._forceUpdate?this.updateBandwidth(F.estimatedSendBandwidth,"forceUpdate"):this.processEstimatedBandwidth(F.estimatedSendBandwidth)},SendBandwidthCalculator.prototype.processEstimatedBandwidth=function(F){if(this.lastReportedAgo++,F&&this.bandwidth!==F){var B=this.configProvider.config.webrtcSendBandwidthIgnoredUpdateLimit,G=this.configProvider.config.webrtcSendBandwidthThreshold,W=this.lastReportedAgo===1/0,z=!B&&!G,K=B&&this.lastReportedAgo>=B,J=G&&Math.abs((F-this.bandwidth)/this.bandwidth)>=G;if(W||z||K||J){var Q=+W|+z<<1|+K<<2|+J<<3,Y=this.getUpdateReason(Q);this.updateBandwidth(F,Y)}}},SendBandwidthCalculator.prototype.updateBandwidth=function(F,B){this.bandwidth=F,this.logger.safe.debug("Updating send bandwidth: ".concat(this.bandwidth,", reason: ").concat(B)),this.notifySendBandwidthChanged()},SendBandwidthCalculator.prototype.notifySendBandwidthChanged=function(){this._forceUpdate=!1,this.event("onSendBandwidthChanged").raise(this.bandwidth),this.lastReportedAgo=0},SendBandwidthCalculator.prototype.getUpdateReason=function(F){return 1&F?"firstReport":2&F?"throttlingDisabled":4&F?"noReportsForTooLong":8&F?"bigMovement":"none"},SendBandwidthCalculator}(G(6).default);B.SendBandwidthCalculator=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.RemoteVideoResolutionManager=void 0;var K=function(F){function RemoteVideoResolutionManager(B,G,W,z,K){var J=F.call(this,B)||this;return J.logger=B,J.multiParty=G,J.resolutionTable=W,J.configProvider=z,J.mediaManager=K,J}return z(RemoteVideoResolutionManager,F),RemoteVideoResolutionManager.prototype.rendererSizeChanged=function(F,B){var G=this,W=F.getMediaStream();if(W){var z=this.mediaManager.getMediaEntityByRemoteStreamId(W.id);if(!z||!z.getVideoCapabilities())return void this.logger.safe.warn("no capabilities for provided modality: ".concat(F.getModality()));var K=B.limited?this.getMaxFSForHeight(B.height):this.getMaxFS(B.width,B.height),J=z.getVideoCapabilities();J.setMaxFS(K,(function(){if(G.logger.safe.info("updated max-fs video capability to ".concat(K)),G.multiParty&&G.configProvider.config.webrtcMultiPartyRecvVideoSignaling){var B=F.getMsi(),W=Number(z.getXSourceStreamId()),Q=J.buildFmtp();G.event("onSourceRequestRequired").raise(z.getModality(),W,B,Q)}else G.event("onNegotiationRequired").raise()}))}else this.logger.safe.warn("renderer has no stream attached")},RemoteVideoResolutionManager.prototype.getMaxFSForHeight=function(F){return this.limitMaxFS(this.resolutionTable.getResolutionForHeight(F).fs)},RemoteVideoResolutionManager.prototype.getMaxFS=function(F,B){return this.limitMaxFS(this.resolutionTable.getMaxFS(F,B))},RemoteVideoResolutionManager.prototype.limitMaxFS=function(F){return this.multiParty?Math.min(F,this.configProvider.config.webrtcMultiPartyRecvVideoMaxFS):Math.min(F,this.configProvider.config.webrtcRecvVideoMaxFS)},RemoteVideoResolutionManager}(G(6).default);B.RemoteVideoResolutionManager=K},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.RemoteVideoManager=void 0;var z=G(419),K=G(1),J=G(141),Q=function(){function RemoteVideoManager(F,B,G,W,z,K){this.logger=F,this.configProvider=B,this.statsGatherer=G,this.diagnostics=W,this.remoteVideoResolutionManager=z,this.domOverrides=K,this.remoteRendererSubscriptions=new Map,this.lastPreferredResolutions=new Map,this.statSubs=[],this.hasPendingLimitResolutionUpdate=!1,this.subscribeToStatisticsChanged()}return Object.defineProperty(RemoteVideoManager.prototype,"renderers",{get:function(){return Array.from(this.remoteRendererSubscriptions,(function(F){return W(F,1)[0]}))},enumerable:!1,configurable:!0}),RemoteVideoManager.prototype.createRenderer=function(F,B,G){var W,K=new z.RemoteVideoRenderer((null!=G?G:this.logger).createChild("videorenderer"),this.configProvider,null===(W=this.diagnostics)||void 0===W?void 0:W.newRendererDiagnostics(),B,F);return this.domOverrides.onMediaElementAdded&&this.domOverrides.onMediaElementAdded(K.getVideoElement()),this.addRenderer(K),K},RemoteVideoManager.prototype.moveRenderers=function(F){var B=this;this.renderers.forEach((function(G){G.resetTimeToFirstFrameFlag(),F.addRenderer(G),B.removeRenderer(G)}))},RemoteVideoManager.prototype.getMaxAllowedVideoFS=function(){var F=this.configProvider.config.multiviewResolutionLimits["".concat(this.remoteRendererSubscriptions.size)]||this.configProvider.config.multiviewResolutionLimits.more;return this.remoteVideoResolutionManager.getMaxFSForHeight(F)},RemoteVideoManager.prototype.dispose=function(){var F=this;this.renderers.forEach((function(F){return F.resetTimeToFirstFrameFlag()})),this.renderers.forEach((function(B){var G=B.getTrackId(),W=B.getEndOfTheFreeze();F.statsGatherer.setFreezeDuration(W,G)})),this.remoteRendererSubscriptions.forEach((function(F,B){B.dispose(),F.forEach((function(F){return F.dispose()}))})),this.remoteRendererSubscriptions.clear(),this.lastPreferredResolutions.clear(),this.statSubs.forEach((function(F){return F.dispose()}))},RemoteVideoManager.prototype.addRenderer=function(F){this.remoteRendererSubscriptions.set(F,this.subscribeOnEvents(F)),this.logger.safe.info("Added renderer to manager"),this.updateLimitedResolutions()},RemoteVideoManager.prototype.subscribeToStatisticsChanged=function(){var F=this;this.configProvider.config.isRenderingBasedOnRawStatistics||this.statSubs.push(this.statsGatherer.on("onStatisticsChanged",(function(B){return F.processStats(B)}))),this.statSubs.push(this.statsGatherer.on("onRawStatisticsChanged",(function(B){return F.processRawStats(B)})))},RemoteVideoManager.prototype.processStats=function(F){this.renderers.forEach((function(B){var G=B.getTrackId();if(F.remoteVideoStreams[G]){var W=F.remoteVideoStreams[G].isRendering;void 0!==W&&B.setIsRendering(W)}}))},RemoteVideoManager.prototype.processRawStats=function(F){var B=new Map;K.forOwn(F.ssrc,(function(F){B.set(F[J.TRACK_ID],F)})),this.renderers.forEach((function(F){var G=F.getTrackId();B.has(G)&&F.captureRawStatistics(B.get(G))}))},RemoteVideoManager.prototype.subscribeOnEvents=function(F){var B=this;return[F.on("onRendererSizeChanged",(function(F,G){return B.onRendererSizeChanged(F,B.limitRendererResolution(G))})),F.on("onRendererDisposed",(function(F){return B.onRendererDisposed(F)})),F.on("onVideoStarted",(function(F,G){return B.onVideoStarted(F,G)})),F.on("onFreezeEnded",(function(G){var W=F.getTrackId();B.statsGatherer.setFreezeDuration(G,W)})),F.on("onIsRenderingChanged",(function(F,G,W){return B.statsGatherer.setIsRendering(F,G,W)}))]},RemoteVideoManager.prototype.onRendererDisposed=function(F){this.logger.safe.debug("Renderer removed from manager"),this.removeRenderer(F),this.updateLimitedResolutions(),this.domOverrides.onMediaElementRemoved&&this.domOverrides.onMediaElementRemoved(F.getVideoElement())},RemoteVideoManager.prototype.removeRenderer=function(F){this.remoteRendererSubscriptions.get(F).forEach((function(F){return F.dispose()})),this.remoteRendererSubscriptions.delete(F),this.lastPreferredResolutions.delete(F)},RemoteVideoManager.prototype.onVideoStarted=function(F,B){this.statsGatherer.setTimeToFirstFrame(F,B)},RemoteVideoManager.prototype.findMaxResolution=function(F,B){var G=this,W=B,z=F.getMsi();return this.renderers.forEach((function(F){var B=F.getMsi();if(z===B){var K=G.limitRendererResolution(F.getCurrentResolution());K.width>W.width&&K.height>W.height&&(W=K)}})),W},RemoteVideoManager.prototype.onRendererSizeChanged=function(F,B){var G=this.findMaxResolution(F,B);this.remoteVideoResolutionManager.rendererSizeChanged(F,G),this.lastPreferredResolutions.set(F,G);var W=F.getMediaStream()&&F.getMediaStream().getVideoTracks();W&&W[0]&&this.statsGatherer.setPreferredResolution(W[0].id,G,F.getModality())},RemoteVideoManager.prototype.updateLimitedResolutions=function(){var F=this;this.hasPendingLimitResolutionUpdate||(this.hasPendingLimitResolutionUpdate=!0,window.setTimeout((function(){F.hasPendingLimitResolutionUpdate=!1,F.logger.safe.info("Updating resolution limits of renderers, count ".concat(F.remoteRendererSubscriptions.size)),F.lastPreferredResolutions.forEach((function(B,G){var W=F.limitRendererResolution(G.getCurrentResolution());(B.height!==W.height||B.width!==W.width)&&B.height>0&&F.onRendererSizeChanged(G,W)}))}),this.configProvider.config.multiviewResolutionLimitUpdateThrottleDelay))},RemoteVideoManager.prototype.limitRendererResolution=function(F){var B=this.configProvider.config.multiviewResolutionLimits["".concat(this.remoteRendererSubscriptions.size)]||this.configProvider.config.multiviewResolutionLimits.more;if(B){if(F.height>F.width&&F.width>B){var G=B/F.width;return{height:Math.ceil(F.height*G),width:B,limited:!0}}if(F.width>F.height&&F.height>B){G=B/F.height;return{height:B,width:Math.ceil(F.width*G),limited:!0}}}return F},RemoteVideoManager}();B.RemoteVideoManager=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.LocalVideoStreamWatcher=void 0;var K=function(F){function LocalVideoStreamWatcher(B,G,W){var z=F.call(this)||this;return z.statisticsGatherer=B,z.configProvider=W,z.statisticsGathererSubscription=null,z.lastFramerateInput=-1,z.trackInfo=[],z.timeoutId=null,z.logger=G.createChild("localStreamWatcher"),z}return z(LocalVideoStreamWatcher,F),LocalVideoStreamWatcher.prototype.startWatching=function(F){var B=this;this.trackInfo=F,!this.statisticsGathererSubscription&&this.configProvider.config.videoCaptureFreezeTimeout&&(this.statisticsGathererSubscription=this.statisticsGatherer.on("onStatisticsChanged",(function(F){return B.onStatisticsChanged(F)})))},LocalVideoStreamWatcher.prototype.stopWatching=function(){this.trackInfo=[],this.statisticsGathererSubscription&&(this.statisticsGathererSubscription.dispose(),this.statisticsGathererSubscription=null),0!==this.lastFramerateInput||this.timeoutId||this.event("onVideoCaptureFreeze").raise(!1),this.disposeTimer(),this.lastFramerateInput=-1},LocalVideoStreamWatcher.prototype.onStatisticsChanged=function(F){var B,G=this;this.trackInfo.length&&(Object.keys(F.localVideoStreams).forEach((function(W){var z=F.localVideoStreams[W];G.trackInfo.some((function(F){return F.trackId===z.trackId}))&&(!B||B.frameRateInput<z.frameRateInput)&&(B=z)})),B?B.frameRateInput!==this.lastFramerateInput&&(0===B.frameRateInput?this.scheduleCaptureFreezeStart(B.trackId):0===this.lastFramerateInput&&(this.timeoutId?this.disposeTimer():(this.logger.info("onVideoCaptureFreeze end for trackId: ".concat(B.trackId)),this.event("onVideoCaptureFreeze").raise(!1))),this.lastFramerateInput=B.frameRateInput):this.logger.safe.warn("WebRTC Stats for send video not found"))},LocalVideoStreamWatcher.prototype.scheduleCaptureFreezeStart=function(F){var B=this;this.timeoutId=window.setTimeout((function(){B.timeoutId=null,B.logger.info("onVideoCaptureFreeze start for trackId: ".concat(F)),B.event("onVideoCaptureFreeze").raise(!0)}),this.configProvider.config.videoCaptureFreezeTimeout)},LocalVideoStreamWatcher.prototype.disposeTimer=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)},LocalVideoStreamWatcher}(G(6).default);B.LocalVideoStreamWatcher=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(52),z=function(){function WebRtcReceiveStream(F,B,G,z,K,J,Q){this.mediaStream=F,this.receiver=B,this.modality=G,this.sourceStreamId=z,this.controller=K,this.videoCapabilties=J,this.getMaxAllowedVideoFS=Q,this.msi=W.MediaSourceIdentifiers.SourceNone,this.operations=Promise.resolve()}return WebRtcReceiveStream.prototype.dispose=function(){},WebRtcReceiveStream.prototype.getId=function(){return this.mediaStream.id},WebRtcReceiveStream.prototype.getModality=function(){return this.modality},WebRtcReceiveStream.prototype.getMsi=function(){return this.msi},WebRtcReceiveStream.prototype.getMediaStream=function(){return this.mediaStream},WebRtcReceiveStream.prototype.getReceiver=function(){return this.receiver},WebRtcReceiveStream.prototype.getSourceStreamId=function(){return this.sourceStreamId},WebRtcReceiveStream.prototype.requestSource=function(F){var B=this;this.msi=F;var G=this.operations.then((function(){var G;return B.videoCapabilties&&(B.videoCapabilties.resetToInitial(),B.getMaxAllowedVideoFS&&B.videoCapabilties.setMaxFS(Math.min(B.getMaxAllowedVideoFS(),B.videoCapabilties.getMaxFS())),G=B.videoCapabilties.buildFmtp(),B.videoCapabilties.resetToInitial()),B.controller.requestSource(B.modality,B.sourceStreamId,F,G)}));return this.operations=G.catch((function(){})),G},WebRtcReceiveStream}();B.default=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.WebRtcDTMFSender=void 0;var W=G(423),z=function(){function WebRtcDTMFSender(F){this.webRtcSender=null,this.configProvider=F.configProvider,this.queue=new W.DTMFQueue(F.logger)}return WebRtcDTMFSender.prototype.sendDtmf=function(F,B){return F&&F.getSenders?(this.syncSender(F),this.webRtcSender?(this.webRtcSender.ontonechange=this.onToneChange.bind(this),this.webRtcSender.insertDTMF(this.webRtcSender.toneBuffer+B,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(B)):Promise.reject(new Error("not available"))):Promise.reject(new Error("bad peerConnection"))},WebRtcDTMFSender.prototype.canSendDtmf=function(F){return!(!F||!F.getSenders)&&(this.syncSender(F),!!this.webRtcSender&&this.webRtcSender.canInsertDTMF)},WebRtcDTMFSender.prototype.dispose=function(){this.queue.cleanup()},WebRtcDTMFSender.prototype.syncSender=function(F){var B=F.getSenders().filter((function(F){return F.track&&"audio"===F.track.kind})).filter((function(F){return F.dtmf&&F.dtmf.canInsertDTMF}))[0];this.webRtcSender&&B&&B.dtmf!==this.webRtcSender&&(this.webRtcSender.ontonechange=null,this.queue.cleanup()),this.webRtcSender=B?B.dtmf:null},WebRtcDTMFSender.prototype.onToneChange=function(F){F.tone&&this.queue.toneSent(F.tone)},WebRtcDTMFSender}();B.WebRtcDTMFSender=z,B.default={build:function(F){return new z(F)}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SessionDescriptionFactory=B.WebRtcSessionDescription=B.SessionDescription=void 0;var W=G(8),z=G(46),K=G(47),J=G(4),Q=G(10),Y=G(39),$=G(64),X=function(){function SessionDescription(F,B,G,K){this.context=F,this.sessionType=B,this.sdp=G,this.remote=K,this.mediaManager=this.context.mediaManager,this.sdpTransform=this.context.sdpTransform,this.logger=this.context.logger.createChild("SessionDescr"),this.sdpModel=z.parse(this.sdp),this.sdpModel.media.forEach((function(F){W.isUndefined(F.mid)||(F.mid=F.mid.toString())})),this.remote&&!this.context.configProvider.config.disableMsSdp&&new $.MsSdpRemoteModifier(F,this.mediaManager,B).modify(this.sdpModel)}return SessionDescription.prototype.clone=function(){return new SessionDescription(this.context,this.sessionType,this.sdp,this.remote)},SessionDescription.prototype.getModalities=function(){return this.modalities||Y.getModalities(this.sdpModel)},SessionDescription.prototype.updateModalities=function(F){this.modalities=F},SessionDescription.prototype.getSrtpInfo=function(){return Q.getSrtpInfo(this.sdpModel)},SessionDescription.prototype.getVideoCodecs=function(){var F={};return this.sdpModel.media.forEach((function(B){"video"===B.type&&B.rtp.map((function(F){return F.codec.toLowerCase()})).forEach((function(B){return F[B]=!0}))})),Object.keys(F)},SessionDescription.prototype.usePrimaryAudioCodecOnly=function(F){new $.AudioPrimaryCodecsModifier(F).modify(this.sdpModel)},SessionDescription.prototype.isCodecSwitchSupported=function(){var F=this;return!this.sdpModel.media.some((function(B){return B.type===J.default.MEDIA_TYPE.audio&&B.xMediaSettings&&F.containsMediaSetting(B.xMediaSettings,"codecswitchunsupported")}))},SessionDescription.prototype.toLocal=function(){return this.sdpModel=this.sdpTransform.toLocal(this.sdpModel,this.mediaManager,this.sessionType),z.write(this.sdpModel)},SessionDescription.prototype.toOffer=function(){return this.toOfferAnswer()},SessionDescription.prototype.toAnswer=function(){return this.toOfferAnswer()},SessionDescription.prototype.toOfferAnswer=function(){var F="offer"===this.sessionType;return new $.CandidatesFixup(this.context.configProvider,this.logger).modify(this.sdpModel),(new $.BundleOnlyMediaFixup).modify(this.sdpModel),F&&this.mediaManager.isEmpty()&&this.mediaManager.fromOffer(this.sdpModel,this.modalities),this.mediaManager.syncModalities(this.sdpModel,this.modalities,!F),this.sdpModel=F?this.sdpTransform.toOffer(this.sdpModel,this.mediaManager,this.modalities):this.sdpTransform.toAnswer(this.sdpModel,this.mediaManager,this.modalities),this.context.configProvider.config.disableMsSdp||new $.MsSdpLocalModifier(this.context,this.mediaManager,this.sessionType).modify(this.sdpModel),new $.InjectH264ParamsModifier(this.mediaManager).modify(this.sdpModel),this.modalities=Y.getModalities(this.sdpModel),z.write(this.sdpModel)},SessionDescription.prototype.toRemote=function(F){return this.modalities=F,this.mediaManager.fromRemote(this.sdpModel,this.modalities),this.sdpModel=this.sdpTransform.toRemote(this.sdpModel,this.mediaManager,this.modalities,this.sessionType),z.write(this.sdpModel)},SessionDescription.prototype.getVideoRecvCapabilities=function(){var F=this.getMediaByLabel(J.default.MEDIA_LABEL.video);return this.getRecvCapabilitiesForMedia(F)},SessionDescription.prototype.getSharingRecvCapabilities=function(){var F=this.getMediaByLabel(J.default.MEDIA_LABEL.sharing);return this.getRecvCapabilitiesForMedia(F)},SessionDescription.prototype.getRecvCapabilities=function(){var F=this,B=[];return this.sdpModel.media.forEach((function(G){if(G.mid){var W=F.mediaManager.getMediaEntityByMid(G.mid);if(W){var z={sourceId:W.getXSourceStreamId(),capabilities:[F.getRecvCapabilitiesForMedia(G)]};B.push(z)}else F.logger.safe.info("No media entity for mid: ".concat(JSON.stringify(G.mid),", existing: ").concat(JSON.stringify(F.mediaManager.getMediaEntities().map((function(F){return F.getMid()})))))}else F.logger.safe.info("Modality disabled, no receive caps to handle: ".concat(JSON.stringify(G)))})),B},SessionDescription.prototype.getMediaByType=function(F){return this.sdpModel.media.find((function(B){return B.type===F}))},SessionDescription.prototype.isUnbundled=function(){var F,B=null===(F=this.sdpModel.groups)||void 0===F?void 0:F.find((function(F){return"BUNDLE"===F.type})),G=this.sdpModel.media.find((function(F){return F.type===J.default.MEDIA_TYPE.audio})),W=this.sdpModel.media.find((function(F){return F.type===J.default.MEDIA_TYPE.video}));return B?!B.mids.toString().split(" ").find((function(F){return F===G.mid})):!!W},SessionDescription.prototype.couldBeUnbundled=function(){return!this.sdpModel.groups||!this.sdpModel.groups.find((function(F){return"BUNDLE"===F.type}))||this.hasUnbundledIceCandidates()},SessionDescription.prototype.containsMediaSetting=function(F,B){return F.some((function(F){return-1!==F.settings.indexOf(B)}))},SessionDescription.prototype.getRecvCapabilitiesForMedia=function(F){var B,G=this;return F&&Y.forOneCodec(F,{name:"h264",rate:9e4},(function(F){F.fmtp&&F.fmtp.config&&(B=G.parseVideoCapabilitiesFromFmtpConfig(F.fmtp.config))})),B},SessionDescription.prototype.getMediaByLabel=function(F){return this.sdpModel.media.find((function(B){return B.label===F}))},SessionDescription.prototype.parseVideoCapabilitiesFromFmtpConfig=function(F){var B=K.default.build(F);return{maxFs:+B.get(J.default.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+B.get(J.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:+B.get(J.default.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*+B.get(J.default.VIDEO_CAPABILITIES.MAX_BR_PATH)}},SessionDescription.prototype.hasIceCandidatesForMediaType=function(F,B){void 0===B&&(B="");var G=this.sdpModel.media?this.sdpModel.media.filter((function(B){return B.type===F&&!!B.candidates&&0!==B.candidates.length})):[];return B?G.some((function(F){return!!F.candidates&&F.candidates.some((function(F){return F.type===B}))})):!!G.length},SessionDescription.prototype.hasIceCandidates=function(){return this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.audio)||this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.video)},SessionDescription.prototype.hasRelayIceCandidates=function(){return this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.audio,"relay")||this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.video,"relay")},SessionDescription.prototype.hasUnbundledIceCandidates=function(){var F=this.sdpModel.media.filter((function(F){return F.type===J.default.MEDIA_TYPE.video&&0!==F.port}));return this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.audio)&&(!F.length||this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.video))},SessionDescription.prototype.hasUnbundledRelayIceCandidates=function(){var F=this.sdpModel.media.filter((function(F){return F.type===J.default.MEDIA_TYPE.video&&0!==F.port}));return this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.audio,"relay")&&(!F.length||this.hasIceCandidatesForMediaType(J.default.MEDIA_TYPE.video,"relay"))},SessionDescription.prototype.isIceRestart=function(){return this.mediaManager.getMediaEntities().some((function(F){return F.getExtension("iceRestart")}))},SessionDescription.prototype.isMSRTC=function(){return!!this.sdpModel.xMediaBw},SessionDescription.prototype.insertFakeCandidateIfNeeded=function(F,B){this.hasIceCandidates()||(F.setFakeIceCandidate(!0),B&&(B.fakeIceCandidate=!0),(new $.NoCandidatesFixup).modify(this.sdpModel))},SessionDescription.prototype.getBweType=function(){var F=this.sdpModel.media.find((function(F){return 0!==F.port&&F.type===J.default.MEDIA_TYPE.video}));return F?F.ext&&F.ext.find((function(F){return F.uri===J.default.TRANSPORT_CC.EXT_URI||F.uri===J.default.TRANSPORT_CC.MSSDP_ENCODED_URI}))?"SSBWE":"REMB":"Unknown"},SessionDescription.prototype.fixDataModality=function(){new $.InsertDisabledXData(this.mediaManager).modify(this.sdpModel)},SessionDescription}();B.SessionDescription=X;var Z=function(){function WebRtcSessionDescription(F){this.context=F}return WebRtcSessionDescription.prototype.createLocalOffer=function(F){return new X(this.context,"offer",F)},WebRtcSessionDescription.prototype.createRemoteOffer=function(F){return new X(this.context,"offer",F,!0)},WebRtcSessionDescription.prototype.createLocalAnswer=function(F){return new X(this.context,"answer",F)},WebRtcSessionDescription.prototype.createRemoteAnswer=function(F){return new X(this.context,"answer",F,!0)},WebRtcSessionDescription}();B.WebRtcSessionDescription=Z;var ee=function(){function SessionDescriptionFactory(){}return SessionDescriptionFactory.build=function(F){return new Z(F=F||{})},SessionDescriptionFactory}();B.SessionDescriptionFactory=ee},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.createIceServers=void 0;var createIceServers=function(F,B){return F.reduce((function(F,G){var W=[],z=G.addresses&&G.addresses[0],K=G.fqdns&&G.fqdns.length>0,J=B.iceUdpAddressType,Q=B.iceTcpAddressType,Y=B.iceServerTransport;if(!z&&!K)return F;if(Y.includes("udp")&&G.udpPort){var $=!K||"fqdn"!==J&&z?z:G.fqdns[0];W.push("turn:".concat($,":").concat(G.udpPort,"?transport=udp"))}if(Y.includes("tcp")&&G.tcpPort){$=!K||"fqdn"!==Q&&z?z:G.fqdns[0];W.push("turn:".concat($,":").concat(G.tcpPort,"?transport=tcp"))}return Y.includes("tls")&&G.tlsPort&&K&&W.push("turns:".concat(G.fqdns[0],":").concat(G.tlsPort)),F.concat({urls:W,credential:G.password,username:G.username})}),[])};B.createIceServers=createIceServers},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.AudioMuteTransform=B.VideoStreamAnalyzer=void 0;var W=7,z=31,K=function(){function VideoStreamAnalyzer(F){this.logger=F}return VideoStreamAnalyzer.prototype.transform=function(F){return this.processChunk(F),F},VideoStreamAnalyzer.prototype.getStartCodeSize=function(F){var B=F.getUint32(0);return 1===B?4:256==(4294967040&B)?3:0},VideoStreamAnalyzer.prototype.processChunk=function(F){if("key"===F.type){var B=this.isH264KeyFrame(F.data)?"".concat(this.getH264Profile(F.data),"(H264)"):"unknown";this.logger.safe.info("keyframe metadata: ".concat(JSON.stringify(F.getMetadata()),", profile=").concat(B))}},VideoStreamAnalyzer.prototype.isH264KeyFrame=function(F){if(F.byteLength<7)return!1;var B=new DataView(F),G=this.getStartCodeSize(B);return!!G&&(B.getUint8(G)&z)===W},VideoStreamAnalyzer.prototype.getH264Profile=function(F){var B=new DataView(F),G=this.getStartCodeSize(B);return(16777215&B.getUint32(G)).toString(16)},VideoStreamAnalyzer}();B.VideoStreamAnalyzer=K;var J=function(){function AudioMuteTransform(F){this.logger=F,this.muted=!1}return AudioMuteTransform.prototype.transform=function(F){return this.muted?null:F},AudioMuteTransform.prototype.mute=function(F){this.muted=F,this.logger.safe.info("Dropping audio chunks: ".concat(F))},AudioMuteTransform}();B.AudioMuteTransform=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.NullStreamClient=void 0;var K=function(F){function NullStreamClient(B,G){var W=F.call(this,G)||this;return W.logger=G,W.id=-1,W.parentId=-1,W.rawStream=null,W.rawTrack=null,W.deviceId=null,W.mediaType=B,W}return z(NullStreamClient,F),NullStreamClient.prototype.start=function(){return this.logger.safe.debug("start"),Promise.resolve()},NullStreamClient.prototype.clone=function(){return this.logger.safe.debug("clone"),this},NullStreamClient.prototype.setMuted=function(F,B){this.logger.safe.debug("setMuted")},NullStreamClient.prototype.setHold=function(F){this.logger.safe.debug("setHold")},NullStreamClient.prototype.getResolution=function(){return this.logger.safe.debug("getResolution"),{width:240,height:180}},NullStreamClient.prototype.getFrameRate=function(){return this.logger.safe.debug("getFrameRate"),1},NullStreamClient.prototype.hasAudio=function(){return this.logger.safe.debug("hasAudio"),!1},NullStreamClient.prototype.hasVideo=function(){return this.logger.safe.debug("hasVideo"),!1},NullStreamClient.prototype.isSameStream=function(F){return this.logger.safe.debug("isSameStream"),F===this},NullStreamClient.prototype.applyCapabilities=function(F){return this.logger.safe.debug("applyCapabilities"),Promise.resolve(!1)},NullStreamClient.prototype.onApplyConstraints=function(F){this.logger.safe.debug("onApplyConstraints")},NullStreamClient.prototype.update=function(F){this.logger.safe.debug("update")},NullStreamClient.prototype.isActive=function(){return!1},NullStreamClient}(G(6).default);B.NullStreamClient=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.EffectStatistics=void 0;var W=G(50),z=function(){function EffectStatistics(F){this.error=new W.UntilFullStatsBuffer(F)}return EffectStatistics.prototype.startLoadTimer=function(){this.loadStartTimestamp=Date.now()},EffectStatistics.prototype.stopLoadTimer=function(){this.loadDuration=Date.now()-this.loadStartTimestamp},EffectStatistics.prototype.clearErrors=function(){this.error.clear()},EffectStatistics.prototype.setError=function(F,B){this.error.add({type:F,message:B})},EffectStatistics.prototype.getReport=function(){return{loadDuration:this.loadDuration,error:this.error.items}},EffectStatistics}();B.EffectStatistics=z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var Q=G(8),Y=G(15),$=G(63),X="default_output_device",Z=function(F){function DeviceManagerAdapter(B){var G=F.call(this)||this;return G._deviceManager=B,B.on("onDevicesChanged",(function(F){var B=G._deviceManager.getDeviceDescriptions(F),W=G._mapDevices(B);G._raiseDevicesChanged(W)})),B.on("onSelectedDevicesChanged",(function(F){return G._raiseDevicesChanged()})),B.on("onPermissionStateChanged",(function(){return G.event("onPermissionStateChanged").raise()})),B.on("onVideoEffectsEvent",(function(F,B){return G.event("videoEffectsEvent").raise(F,B)})),B.on("onVideoEffectApplied",(function(){return G.event("videoEffectApplied").raise()})),G}return z(DeviceManagerAdapter,F),Object.defineProperty(DeviceManagerAdapter.prototype,"isAudioOutputSelectionSupported",{get:function(){return this._deviceManager.isAudioOutputSelectionSupported},enumerable:!1,configurable:!0}),DeviceManagerAdapter.prototype.getPermissionState=function(F){return"camera"===F?this.getPermissionStateHelper(this._deviceManager.getPermissionState("camera")):"microphone"===F?this.getPermissionStateHelper(this._deviceManager.getPermissionState("microphone")):"unknown"},DeviceManagerAdapter.prototype.askDevicePermission=function(F){return this._deviceManager.askDevicePermission?this._deviceManager.askDevicePermission(F):Promise.resolve({audio:!0,video:!0})},DeviceManagerAdapter.prototype.enumerateDevicesAsync=function(){var F=this;return this._deviceManager.enumerateDevicesAsync().then((function(B){return F._mapDevices(B)}))},DeviceManagerAdapter.prototype.getPreferredCamera=function(){throw new Error("Not implemented")},DeviceManagerAdapter.prototype.selectDevices=function(F){var B=Q.assign({},this._deviceManager.getSelectedDevices(),F);this._deviceManager.selectDevices(B)},DeviceManagerAdapter.prototype.getSelectedDevices=function(){return this._deviceManager.getSelectedDevices()},DeviceManagerAdapter.prototype.getDeviceNameAsync=function(F){return this._deviceManager.getDeviceNameAsync(F)},DeviceManagerAdapter.prototype.getSpeakerDeviceDomIdAsync=function(F,B){return this._deviceManager.getSpeakerDeviceDomIdAsync(F)},DeviceManagerAdapter.prototype.setDeviceEffectsAsync=function(F,B){return this._deviceManager.setVideoEffects(B)},DeviceManagerAdapter.prototype.getDeviceEffectsCapabilityAsync=function(F,B){return this._deviceManager.videoEffectManager.getEffectsCapability()},DeviceManagerAdapter.prototype.setBackgroundImageAsync=function(F,B,G){return this._deviceManager.videoEffectManager.configure({imagePath:B,headers:G})},DeviceManagerAdapter.prototype.getImagePropertyAsync=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.getMicrophoneGeometryArrayInfoAsync=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.transformImageAsync=function(F,B,G,W){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.setAudioProcessingFlags=function(F){return this._deviceManager.setAudioProcessingFlags(F)},DeviceManagerAdapter.prototype.sendMessageDeviceVideoEffectsAsync=function(F,B){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.sendMessageDeviceVideoExtensibilityAsync=function(F,B){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.setVideoCaptureConfigAsync=function(F,B){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.getSpeakerVolume=function(){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.getSpeakerSystemVolume=function(){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.setSpeakerVolume=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.setSpeakerSystemVolume=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.unmuteMicrophone=function(){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.unmuteSpeaker=function(){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.getNrgLevelsForDeviceTuner=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.getAudioFeatureCapability=function(F){return this._deviceManager.audioEffectManager.getEffectsCapability()},DeviceManagerAdapter.prototype.getMicrophoneVolume=function(){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.setMicrophoneVolume=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.setDeviceTelemetryData=function(F,B,G){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.getSourceFormats=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.enableShellSharing=function(){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype.disableShellSharing=function(){return Promise.reject(new Error("Not implemeted"))},DeviceManagerAdapter.prototype.enableParticipantCameras=function(){return Promise.reject(new Error("Not implemeted"))},DeviceManagerAdapter.prototype.createPreview=function(F,B,G){return"camera"===B.kind&&Q.isUndefined(B.device)?this.createPreviewRenderer(F,G):Promise.reject(new Error("Not yet supported"))},DeviceManagerAdapter.prototype.createPreviewRenderer=function(F,B){return K(this,void 0,void 0,(function(){var G,W;return J(this,(function(z){switch(z.label){case 0:G=new $.LocalVideoRenderer(F,this._deviceManager),z.label=1;case 1:return z.trys.push([1,3,,4]),[4,G.startVideoAsync()];case 2:return z.sent(),B&&(G.setScalingMode(B.scalingMode),G.setVideoMirroring(!B.ignoreMirroring)),[3,4];case 3:throw W=z.sent(),G.dispose(),W;case 4:return[2,G]}}))}))},DeviceManagerAdapter.prototype.createScreenSharingPreviewRenderer=function(F,B){return Promise.reject(new Error("Not yet supported"))},DeviceManagerAdapter.prototype.getRawDeviceMediaStream=function(F){return this._deviceManager.getRawDeviceMediaStream(this.getAgentMediaType(F))},DeviceManagerAdapter.prototype.setRawMediaStream=function(F,B){return this._deviceManager.setRawMediaStream(F,this.getAgentMediaType(B))},DeviceManagerAdapter.prototype.unsetRawMediaStream=function(F){return this._deviceManager.unsetRawMediaStream(this.getAgentMediaType(F))},DeviceManagerAdapter.prototype.createAudioRenderer=function(){return this._deviceManager.createAudioRenderer()},DeviceManagerAdapter.prototype.startAudioLoopbackDevice=function(F){return Promise.reject(new Error("Not implemented"))},DeviceManagerAdapter.prototype._raiseDevicesChanged=function(F){var B=this;(F?Promise.resolve(F):this.enumerateDevicesAsync()).then((function(F){B.raiseChanged(),B.event("devicesChanged").raise(F)}))},DeviceManagerAdapter.prototype.getPermissionStateHelper=function(F){switch(F){case"granted":return"granted";case"denied":return"denied";case"prompt":return"prompt";default:return"unknown"}},DeviceManagerAdapter.prototype._mapDevices=function(F){var B=this;return Q.map(F,(function(F){return B._mapDeviceDesc(F)}))},DeviceManagerAdapter.prototype._mapDeviceDesc=function(F){var B=DeviceManagerAdapter._mapDeviceType(F.kind);return 1===B?{id:F.id,browserId:F.browserId,label:F.label,kind:B,position:DeviceManagerAdapter._mapCameraPosition(F.position)}:4===B?{id:null,browserId:null,label:F.label,kind:B,formFactor:F.formFactor,isPcInternalDevice:F.isPcInternalDevice,microphoneId:F.microphoneId,speakerId:F.speakerId}:{id:F.id,browserId:F.browserId===X?"default":F.browserId,label:F.label,kind:B,isSystemDefault:!!F.isSystemDefault}},DeviceManagerAdapter._mapDeviceType=function(F){switch(F){case"camera":return 1;case"microphone":return 2;case"speaker":return 3;case"compositeAudio":return 4;default:throw new Error("Invalid device type '".concat(F,"'"))}},DeviceManagerAdapter._mapCameraPosition=function(F){switch(F){case"front":return 1;case"back":return 2;case"external":return 3;default:return 0}},DeviceManagerAdapter.prototype.getAgentMediaType=function(F){switch(F){case 0:return"Audio";case 1:return"Video";case 2:return"ScreenShare"}return"Audio"},DeviceManagerAdapter}(Y.default);B.default=Z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(8),J=G(15),Q=function(){function SharingSourceAdapter(F){this._sharingSource=F}return SharingSourceAdapter.prototype.getId=function(){return this._sharingSource.getId()},SharingSourceAdapter.prototype.getDeviceId=function(){return String(this._sharingSource.getId())},SharingSourceAdapter.prototype.getType=function(){return this.mapSharingSourceType(this._sharingSource.getType())},SharingSourceAdapter.prototype.getPreview=function(F,B,G){return Promise.reject("not implemented")},SharingSourceAdapter.prototype.getPreviewAsync=function(F,B){return this._sharingSource.getPreviewAsync(F,B)},SharingSourceAdapter.prototype.getDescription=function(){return this._sharingSource.getDescription()},SharingSourceAdapter.prototype.getIcon=function(F,B){return this._sharingSource.getIcon(F,B)},SharingSourceAdapter.prototype.getBounds=function(){},SharingSourceAdapter.prototype.mapSharingSourceType=function(F){switch(F){case 1:return 1;case 2:return 2;default:throw new Error("Invalid sharing source type")}},SharingSourceAdapter}(),Y=function(F){function ScreenSharingManagerAdapter(B){var G=F.call(this)||this;return G._screenSharingManager=B,G._screenSharingManager.onScreensChanged((function(){G.event("screensChanged").raise()})),G}return z(ScreenSharingManagerAdapter,F),ScreenSharingManagerAdapter.prototype.enumerateScreensAsync=function(){return this._screenSharingManager.enumerateScreensAsync().then((function(F){return K.map(F,(function(F){return new Q(F)}))}))},ScreenSharingManagerAdapter.prototype.enumerateWindowsAsync=function(){return this._screenSharingManager.enumerateWindowsAsync().then((function(F){return K.map(F,(function(F){return new Q(F)}))}))},ScreenSharingManagerAdapter.prototype.enumerateCamerasAsync=function(){return this._screenSharingManager.enumerateCamerasAsync().then((function(F){return K.map(F,(function(F){return new Q(F)}))}))},ScreenSharingManagerAdapter}(J.default);B.default=Y},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.pluginlessStackFactory=B.PluginlessStack=B.createTelemetryLoggersFromConfig=void 0;var Q=G(8),Y=G(468),$=G(469),X=G(13),Z=G(75),ee=G(87),te=G(470),ne=G(478),ie=G(15),re=G(17),oe=G(32),ae=G(479),se=G(86),ce=G(165),le=G(480),de=G(124),ue=G(486),pe=G(487),he=G(166),ge=G(488),fe=G(490),me=G(171),ve=function(F){function PluginlessStackError(B,G){void 0===G&&(G=1);var W=F.call(this,B)||this;return W.callSupport=G,W}return z(PluginlessStackError,F),PluginlessStackError}(Error);function createTelemetryLoggersFromConfig(F){var B,G={};return F.telemetryLoggers?G=F.telemetryLoggers:(null===(B=F.telemetryService)||void 0===B?void 0:B.getGenericTelemetryLogger)&&F.telemetryTenants?Q.forEach(Object.keys(F.telemetryTenants),(function(B){return G[B]=F.telemetryService.getGenericTelemetryLogger(F.telemetryTenants[B])})):F.telemetryService&&(F.telemetryService.sendEvents||F.telemetryService.getCallingAdapter)&&(F.telemetryService.sendEvents&&(G.media={sendEvent:function(B){B.eventName&&(B.eventName=B.eventName.replace(/^(mdsc_)/,"")),F.telemetryService.sendEvents([B])}},G.tlePlayer={sendEvent:function(B){B.eventName&&(B.eventName=B.eventName.replace(/^(mdsc_)/,"")),F.telemetryService.sendEvents([B])}}),F.telemetryService.getCallingAdapter&&(G.signaling={sendEvent:function(B){F.telemetryService.getCallingAdapter().sendEvent(B.eventName,B.props)}})),G}function createTelemetryLoggersForOneDs(F){var B={},G=new fe.OneDsTelemetryTransportLogger(F);B.signaling=G.createLogger("signaling"),B.media=G.createLogger("media"),B.tlePlayer=G.createLogger("tlePlayer");var W=new fe.OneDsTelemetryTransportLogger(F,{"UserInfo.Ring":"Ring","UserInfo.TenantId":"TenantId","AppInfo.ClientType":"client_type","UserInfo.ETag":"AppInfo.EcsEtag"},me.EventLatency.RealTime);return B.realtimeMedia=W.createLogger("realtimeMedia"),B}B.createTelemetryLoggersFromConfig=createTelemetryLoggersFromConfig;var ye=function(F){function PluginlessStack(B,G){var W=F.call(this)||this;return W._config=B,W._ecsProvider=G,W.callRegistries=[],W._logger=new ee.default(W._config.logger).createChild("PluginlessStack"),W._platformManager=new ue.default,W.platformCallConstraintsProvider=new Y.PlatformCallConstraintsProvider(W._logger.createChild("PlatformConstraintsProvider")),W}return z(PluginlessStack,F),PluginlessStack.prototype.initializeMediaAgent=function(F){var B,G;return K(this,void 0,void 0,(function(){var W,z,K,Q,Y,$,X,Z;return J(this,(function(J){switch(J.label){case 0:if(W=!1,K=null,!this._mediaAgentProvider)throw new ve("PluginlessStack initialize MediaAgent error, Media Stack not initialized",K);J.label=1;case 1:return J.trys.push([1,3,,4]),Q=F.relayManager||this.buildRelayManager(F.httpRequestDispatcher,F.tokenProvider,F.configProvider,F.appStateProvider,F.trapTokenCredentialsProvider),[4,this._mediaAgentProvider.buildAgent(this._config.platformType,Q)];case 2:return z=J.sent(),[3,4];case 3:return Y=J.sent(),W=1===($=Y).length&&"not_supported"===$[0].reason,X=$.some((function(F){return"incompatible_version"===F.reason})),K=X?2:1,[3,4];case 4:if(!this._config.usePlatformSupportApi)if(K){if(!W||!(null===(B=this._config.callSettings)||void 0===B?void 0:B.useLwjForAllCalls))throw new ve("PluginlessStack initialization failed",K)}else if(1!==(Z=(new ue.default).getPlatformSupportLevel(!0))&&2!==Z&&(K=1,!(null===(G=this._config.callSettings)||void 0===G?void 0:G.useLwjForAllCalls)))throw new ve("PluginlessStack initialization failed",K);return z?(this._screenSharingManager=new he.default(z.getScreenSharingManager()),this._oneDsTelemetryLoggers=createTelemetryLoggersForOneDs(this.createTelemetryConfig(z,F.clientInformation)),this._mediaAgent=z):this._deviceManager=new ne.default,[2]}}))}))},PluginlessStack.prototype.initializeSignalingAgentProvider=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this._trouterService=F.trouterService,this._signalingAgentProvider=ge.signalingAgentProviderFactory.build(F.signalingAgentConfig,this._ecsProvider,this._config.logger),[2]}))}))},PluginlessStack.prototype.initializeImageRendererProvider=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this._imageRendererProvider=new $.ImageRendererProvider(F),[2,this._imageRendererProvider]}))}))},PluginlessStack.build=function(F,B){return K(this,void 0,void 0,(function(){var G,W;return J(this,(function(z){switch(z.label){case 0:return z.trys.push([0,2,,3]),(G=new PluginlessStack({detectH264Support:F.mediaAgentFactoryConfig.detectH264Support,domOverrides:F.mediaAgentFactoryConfig.domOverrides,mediaSettings:F.mediaAgentFactoryConfig.settings,logger:F.logger,telemetryLoggers:F.telemetryLoggers,telemetryService:F.telemetryService,telemetryTenants:F.telemetryTenants,telemetryContextProvider:F.telemetryContextProvider,platformType:F.platformType,callSettings:F.callSettings,usePlatformSupportApi:F.usePlatformSupportApi,clientInformation:F.signalingAgentConfig.clientInformation},B)).initializeMediaProvider({detectH264Support:F.mediaAgentFactoryConfig.detectH264Support,domOverrides:F.mediaAgentFactoryConfig.domOverrides,mediaSettings:F.mediaAgentFactoryConfig.settings,logger:F.mediaAgentFactoryConfig.logger,safeLogger:F.mediaAgentFactoryConfig.safeLogger,webcvProvider:F.mediaAgentFactoryConfig.webcvProvider,wasmdnsProvider:F.mediaAgentFactoryConfig.wasmdnsProvider,wasmaecProvider:F.mediaAgentFactoryConfig.wasmaecProvider}),[4,G.initializeMediaAgent({httpRequestDispatcher:F.mediaAgentFactoryConfig.httpRequestDispatcher,tokenProvider:F.mediaAgentFactoryConfig.tokenProvider,configProvider:F.mediaAgentFactoryConfig.configProvider,appStateProvider:F.mediaAgentFactoryConfig.appStateProvider,clientInformation:F.signalingAgentConfig.clientInformation,trapTokenCredentialsProvider:F.mediaAgentFactoryConfig.trapTokenCredentialsProvider,relayManager:F.mediaAgentFactoryConfig.relayManager})];case 1:return z.sent(),G.initializeSignalingAgentProvider({signalingAgentConfig:F.signalingAgentConfig,trouterService:F.trouterService}),F.imageRendererConfig&&G.initializeImageRendererProvider(F.imageRendererConfig),[2,G];case 2:throw(W=z.sent())instanceof ve?W:new ve("".concat(W));case 3:return[2]}}))}))},PluginlessStack.buildBaseStack=function(F,B){return K(this,void 0,void 0,(function(){var G;return J(this,(function(W){return(G=new PluginlessStack(F,B)).initializeMediaProvider({detectH264Support:F.detectH264Support,domOverrides:F.domOverrides,mediaSettings:F.mediaSettings,logger:F.logger,safeLogger:F.safeLogger}),[2,G]}))}))},PluginlessStack.prototype.init=function(){return Promise.resolve()},PluginlessStack.prototype.dispose=function(B){return void 0===B&&(B=(0,X.generateCauseId)()),K(this,void 0,void 0,(function(){var G,W,z,K,Q=this;return J(this,(function(J){switch(J.label){case 0:return(G=this._logger.createFnLogger("dispose",B)).info("Dispose"),this._ecsProvider.dispose(),W=function(){Q.callRegistries=[],G.info("call registries are disposed"),Q._screenSharingManager&&(Q._screenSharingManager.dispose(B),Q._screenSharingManager=void 0,G.info("screensharing manager is disposed")),Q._deviceManager=void 0,G.info("device manager is disposed"),F.prototype.dispose.call(Q)},z=function(F){G.warn("Failed:",F)},K=this.callRegistries.map((function(F){return F.dispose(B).catch(z)})),[4,Promise.all(K)];case 1:return J.sent(),[4,this._mediaAgent.dispose(B).catch(z)];case 2:return J.sent(),[2,W()]}}))}))},PluginlessStack.prototype.getCallRegistry=function(){return this._logger.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this._createCallRegistry()},PluginlessStack.prototype.createCallRegistry=function(F,B){return void 0===B&&(B=(0,X.generateCauseId)()),K(this,void 0,void 0,(function(){var G,W,z;return J(this,(function(K){switch(K.label){case 0:return G=F?re.mriOrId(F.id):void 0,W=this._logger.createFnLogger("createCallRegistry[identity=".concat(G,"]"),B),(z=this.callRegistries.find((function(B){return B.identity===F.id})))&&!z.isDisposing?(W.info("callRegistry already exists for ".concat(re.mriOrId(F.id))),[2,Promise.resolve(z)]):(null==z?void 0:z.isDisposing)?[4,z.disposePromise]:[3,2];case 1:K.sent(),K.label=2;case 2:return[2,this._createCallRegistry(F)]}}))}))},PluginlessStack.prototype._createCallRegistry=function(F){var B=this;if(!this._trouterService)throw new ve("Unable to create call registry, trouter service undefined");if(!this._mediaAgent)throw new ve("Unable to create call registry, media agent undefined");if(!this._signalingAgentProvider)throw new ve("Unable to create call registry, signaling agent undefined");var G=new se.CallRegistry(this._trouterService,this._signalingAgentProvider,this._mediaAgent,this._logger,createTelemetryLoggersFromConfig(this._config),this._config.callSettings,this._ecsProvider,this._imageRendererProvider,F,this._oneDsTelemetryLoggers);return G.on("disposed",(function(){B.callRegistries.splice(B.callRegistries.indexOf(G),1)})),this.callRegistries.push(G),G},PluginlessStack.prototype.initializeMediaProvider=function(F){var B=Q.assign({},F);this._mediaAgentProvider=new de.default(B,this._ecsProvider,this.platformCallConstraintsProvider),this._deviceManager=new ce.default(this._mediaAgentProvider.getDeviceManager())},PluginlessStack.prototype.createTelemetryConfig=function(F,B){return{configProvider:F.getConfigProvider(),logger:this._logger.createChild("OneDsLogger"),clientInfo:B,contextProvider:this._config.telemetryContextProvider}},PluginlessStack.prototype.buildRelayManager=function(F,B,G,W,z){var K=F||new Z.HttpRequestDispatcher(this._logger);return ae.build({logger:this._logger,tokenProvider:B,trapTokenCredentialsProvider:z,configProvider:function(){return G.getRelayConfig()},request:{get:function(F,B){return K.getAsync(F,K.getRequestOptions("GET",null==B?void 0:B.headers,null,null==B?void 0:B.timeout))},isOnline:W.isOnline}})},PluginlessStack.prototype.getDeviceManager=function(){return this._deviceManager},PluginlessStack.prototype.createDeviceManager=function(F){return this._deviceManager},PluginlessStack.prototype.getScreenSharingManager=function(){return this._screenSharingManager},PluginlessStack.prototype.getSetup=function(){},PluginlessStack.prototype.getEcsProvider=function(){return this._ecsProvider},PluginlessStack.prototype.getCallFeedback=function(){return null},PluginlessStack.prototype.getAiMdp=function(){return null},PluginlessStack.prototype.fireIntent=function(F,B){},PluginlessStack.prototype.getVersion=function(){return{build:(0,oe.getTsCallingVersion)(),ovb:(0,oe.getOvb)()}},PluginlessStack.prototype.getMediaStatus=function(){return null},PluginlessStack.prototype.getVideoCapabilityLimits=function(){return null},PluginlessStack.prototype.setMediaConfig=function(F){return this._mediaAgent?(this._mediaAgent.setMediaConfig(F),Promise.resolve()):Promise.reject("not supported in LWJ")},PluginlessStack.prototype.setPlatformCallConstraints=function(F){this.platformCallConstraintsProvider.setConstraints(F)},PluginlessStack.prototype.getPlatformSupportLevel=function(){return this._platformManager.getPlatformSupportLevel(!!this._mediaAgent)},PluginlessStack.prototype.getLiveStreamClient=function(){var F=this,getTelemetryLogger=function(){var B,G=createTelemetryLoggersFromConfig(F._config),W=F._oneDsTelemetryLoggers;return((null===(B=F._mediaAgent)||void 0===B?void 0:B.getConfig().useOneDsLogger)?W:G).tlePlayer};return new te.LiveStreamClient(this._ecsProvider.createEcsConfiguration(),this._logger.createChild("LiveStreamClient"),getTelemetryLogger)},PluginlessStack.prototype.createVoipCallCoordinator=function(){},PluginlessStack.prototype.setLogFileName=function(F,B,G){},PluginlessStack}(ie.default);B.PluginlessStack=ye,B.pluginlessStackFactory={build:function(F){var B=new pe.PluginlessEcsProvider;return(0,le.initLogger)(F,B),ye.build(F,B)},buildBaseStack:function(F){var B=new pe.PluginlessEcsProvider;return ye.buildBaseStack(F,B)},getVersion:function(){return{build:(0,oe.getTsCallingVersion)(),ovb:(0,oe.getOvb)()}}}},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},Y=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.PlayerWrapper=void 0;var $=G(40),X=G(15),Z=G(473),ee=function(F){function PlayerWrapper(B){var G=F.call(this,B)||this;return G.logger=B,G.resultsMap=new Map,G.on("log",(function(F,B){G.logger[F](B)})),G}return z(PlayerWrapper,F),PlayerWrapper.prototype.initialize=function(F,B,G,W){return K(this,void 0,void 0,(function(){var z,K,Q;return J(this,(function(J){switch(J.label){case 0:return z={config:G.config,playerConfig:G.playerConfig},K=this,0!==W?[3,2]:[4,(0,Z.setupAmpAndBuildPipe)(F,G.config.loadType,G.playerConfig.nonce)];case 1:return Q=J.sent(),[3,4];case 2:return[4,(0,Z.setupHlsAndBuildPipe)(F,G.config.loadType,G.playerConfig.nonce)];case 3:Q=J.sent(),J.label=4;case 4:return K.pipe=Q,this.pipe.registerObserver(this),[4,this.message("configure").send(B,z)];case 5:return J.sent(),[2]}}))}))},PlayerWrapper.prototype.message=function(F){var B=this;return{send:this.fromMessage((function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];return B.sendMessageImpl.apply(B,Y([F],Q(G),!1))}))}},PlayerWrapper.prototype.dispose=function(){F.prototype.dispose.call(this),this.pipe.sendMsg(this.buildMsg("dispose")),this.pipe.dispose()},PlayerWrapper.prototype.processMessage=function(F){var B,G;switch(F.msgType){case"CommandResult":(B=this.resultsMap.get(F.cmd.toString()))&&(F.error?B.reject(F.error):B.resolve(),F.error&&this.logger.warn("remote command failed: ".concat(F.cmd,", ").concat(F.error)),this.resultsMap.delete(F.toString()));break;case"PlayerNotification":(G=this.event(F.name)).raise.apply(G,F.args);break;default:this.logger.warn("unexpected message received: ".concat(JSON.stringify(F)))}},PlayerWrapper.prototype.fromMessage=function(F){return F},PlayerWrapper.prototype.sendMessageImpl=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];return this.pipe.sendMsg(this.buildMsg(F,B)),this.waitForCompletion(F.toString())},PlayerWrapper.prototype.buildMsg=function(F,B){return{msgType:"Command",cmd:F,args:B}},PlayerWrapper.prototype.waitForCompletion=function(F){var B=this.resultsMap.get(F);B&&B.reject(new Error("function ".concat(F," is invoked again, before previos call is completed")));var G=$.defer();return this.resultsMap.set(F,G),G.promise},PlayerWrapper}(X.default);B.PlayerWrapper=ee},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.LiveStreamRenderer=void 0;var J=function(F){function LiveStreamRenderer(B,G){var W=F.call(this)||this;return W.player=B,W.logger=G,W.playerSubs=[],W.subscribeForPlayerEvents(),W}return z(LiveStreamRenderer,F),Object.defineProperty(LiveStreamRenderer.prototype,"isRendering",{get:function(){return!!this.player&&this.player.isRendering()},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamRenderer.prototype,"streamSize",{get:function(){return this.player?this.player.getStreamSize():{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamRenderer.prototype,"rendererType",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamRenderer.prototype,"frameType",{get:function(){return-1},enumerable:!1,configurable:!0}),LiveStreamRenderer.prototype.dispose=function(){this.stopPlayer(),F.prototype.dispose.call(this)},LiveStreamRenderer.prototype.captions=function(){return this.player.getCaptionsControl()},LiveStreamRenderer.prototype.getStats=function(){throw new Error("Method not implemented.")},LiveStreamRenderer.prototype.setScalingMode=function(F,B){throw new Error("Method not implemented.")},LiveStreamRenderer.prototype.captureFrame=function(F,B){throw new Error("Method not implemented.")},LiveStreamRenderer.prototype.stopPlayer=function(){var F=this.player;this.player=null,F&&(this.logger.info("stopPlayer"),this.unsubscribeFromPlayerEvents(),F.stop())},LiveStreamRenderer.prototype.subscribeForPlayerEvents=function(){var F=this;this.playerSubs.push(this.player.on("fullscreenToggled",(function(B){return F.onFullScreenToggled(B)}))),this.playerSubs.push(this.player.on("captionsToggled",(function(B,G,W){return F.onCaptionsToggled(B,G,W)})))},LiveStreamRenderer.prototype.unsubscribeFromPlayerEvents=function(){var F,B;try{for(var G=K(this.playerSubs),W=G.next();!W.done;W=G.next()){W.value.dispose()}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}this.playerSubs=[]},LiveStreamRenderer.prototype.onFullScreenToggled=function(F){this.event("fullScreenToggled").raise(F)},LiveStreamRenderer.prototype.onCaptionsToggled=function(F,B,G){this.logger.info("Turned captions ".concat(F?"ON":"OFF"," for culture [").concat(B,"] at player time [").concat(G,"]")),this.event("captionsToggled").raise(F,B,G)},LiveStreamRenderer}(G(15).default);B.LiveStreamRenderer=J},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.CaptionsControl=void 0;var K=function(){function CaptionsControl(F,B){var G=this;this.player=F,this.availableCultures=B,this.selectedCulture="",this.disposable=this.player.on("captionsToggled",(function(F,B,W){G.selectedCulture=F?B:""}))}return CaptionsControl.prototype.addCues=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){switch(B.label){case 0:return[4,this.player.message("addCues").send(F)];case 1:return B.sent(),[2]}}))}))},CaptionsControl.prototype.clearCues=function(){return W(this,void 0,void 0,(function(){return z(this,(function(F){switch(F.label){case 0:return[4,this.player.message("clearCues").send()];case 1:return F.sent(),[2]}}))}))},CaptionsControl.prototype.showCaptions=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){switch(B.label){case 0:return[4,this.player.message("showCaptions").send(F)];case 1:return B.sent(),[2]}}))}))},CaptionsControl.prototype.getSelectedCulture=function(){return this.selectedCulture},CaptionsControl.prototype.getAvailableCultures=function(){return this.availableCultures},CaptionsControl.prototype.dispose=function(){this.disposable.dispose(),this.player=null},CaptionsControl}();B.CaptionsControl=K},function(F,B,G){G.r(B),G.d(B,"ApplicationInsightsManager",(function(){return Jn})),G.d(B,"ApplicationInsights",(function(){return Qn})),G.d(B,"OverridePropertiesPlugin",(function(){return zn})),G.d(B,"PostChannel",(function(){return Dn})),G.d(B,"BE_PROFILE",(function(){return _t})),G.d(B,"NRT_PROFILE",(function(){return St})),G.d(B,"RT_PROFILE",(function(){return yt})),G.d(B,"PropertiesPlugin",(function(){return vt})),G.d(B,"Extensions",(function(){return st})),G.d(B,"AppExtensionKeys",(function(){return Qe})),G.d(B,"WebExtensionKeys",(function(){return Ye})),G.d(B,"UserExtensionKeys",(function(){return $e})),G.d(B,"OSExtKeys",(function(){return Xe})),G.d(B,"DeviceExtKeys",(function(){return rt})),G.d(B,"OperatingSystem",(function(){return Be})),G.d(B,"Application",(function(){return be})),G.d(B,"Device",(function(){return ze})),G.d(B,"Session",(function(){return Ke})),G.d(B,"defaultFlightIdNameSpaces",(function(){return Ee})),G.d(B,"TelemetryContext",(function(){return ft})),G.d(B,"Cloud",(function(){return Ie})),G.d(B,"Loc",(function(){return qe})),G.d(B,"AppInsightsCore",(function(){return Te})),G.d(B,"InternalAppInsightsCore",(function(){return ve})),G.d(B,"ValueKind",(function(){return Y.e})),G.d(B,"EventLatency",(function(){return Y.a})),G.d(B,"EventPersistence",(function(){return Y.b})),G.d(B,"TraceLevel",(function(){return Y.d})),G.d(B,"MinChannelPriorty",(function(){return Yn})),G.d(B,"NotificationManager",(function(){return J})),G.d(B,"EventsDiscardedReason",(function(){return me})),G.d(B,"CoreUtils",(function(){return ye.a})),G.d(B,"DiagnosticLogger",(function(){return $.a})),G.d(B,"isValueAssigned",(function(){return ye.m})),G.d(B,"isArray",(function(){return z.k})),G.d(B,"isBeaconsSupported",(function(){return Z.m})),G.d(B,"isBoolean",(function(){return z.l})),G.d(B,"isLatency",(function(){return ye.k})),G.d(B,"isNumber",(function(){return z.s})),G.d(B,"isReactNative",(function(){return Z.p})),G.d(B,"isString",(function(){return z.u})),G.d(B,"isUint8ArrayAvailable",(function(){return ye.l})),G.d(B,"getISOString",(function(){return z.J})),G.d(B,"cookieAvailable",(function(){return de.b})),G.d(B,"BaseTelemetryPlugin",(function(){return te.a})),G.d(B,"LoggingSeverity",(function(){return Q.a})),G.d(B,"_InternalLogMessage",(function(){return $.b})),G.d(B,"_InternalMessageId",(function(){return Q.b}));var W=G(173),z=G(0),K=G(7),J=function(){function NotificationManager(F){this.listeners=[];var B=!!(F||{}).perfEvtsSendAll;Object(K.a)(NotificationManager,this,(function(F){F.addNotificationListener=function(B){F.listeners.push(B)},F.removeNotificationListener=function(B){for(var G=Object(z.b)(F.listeners,B);G>-1;)F.listeners.splice(G,1),G=Object(z.b)(F.listeners,B)},F.eventsSent=function(B){Object(z.a)(F.listeners,(function(F){F&&F.eventsSent&&setTimeout((function(){return F.eventsSent(B)}),0)}))},F.eventsDiscarded=function(B,G){Object(z.a)(F.listeners,(function(F){F&&F.eventsDiscarded&&setTimeout((function(){return F.eventsDiscarded(B,G)}),0)}))},F.eventsSendRequest=function(B,G){Object(z.a)(F.listeners,(function(F){if(F&&F.eventsSendRequest)if(G)setTimeout((function(){return F.eventsSendRequest(B,G)}),0);else try{F.eventsSendRequest(B,G)}catch(F){}}))},F.perfEvent=function(G){G&&(!B&&G.isChildEvt()||Object(z.a)(F.listeners,(function(F){if(F&&F.perfEvent)if(G.isAsync)setTimeout((function(){return F.perfEvent(G)}),0);else try{F.perfEvent(G)}catch(F){}})))}}))}return NotificationManager}(),Q=G(20),Y=G(19),$=G(43),X=G(42),Z=G(11),ee=G(29),te=G(172),ne=G(35),ie="processTelemetry",re="priority",oe="setNextPlugin",ae="isInitialized";function initializePlugins(F,B){for(var G=[],W=null,K=F.getNext();K;){var J=K.getPlugin();J&&(W&&Object(z.o)(W[oe])&&Object(z.o)(J[ie])&&W[oe](J),Object(z.o)(J[ae])&&J[ae]()||G.push(J),W=J,K=K.getNext())}Object(z.a)(G,(function(G){G.initialize(F.getCfg(),F.core(),B,F.getNext())}))}function sortPlugins(F){return F.sort((function(F,B){var G=0,W=Object(z.o)(B[ie]);return Object(z.o)(F[ie])?G=W?F[re]-B[re]:1:W&&(G=-1),G}))}var se=500,ce="Channel has invalid priority",le=function(F){function ChannelController(){var B,G=F.call(this)||this;function _checkQueuePriority(F){Object(z.a)(F,(function(F){F.priority<se&&Object(z.I)(ce+F.identifier)}))}function _addChannelQueue(F){F&&F.length>0&&(_checkQueuePriority(F=F.sort((function(F,B){return F.priority-B.priority}))),B.push(F))}function _createChannelQueues(F,G){if(B=[],F&&Object(z.a)(F,(function(F){return _addChannelQueue(F)})),G){var W=[];Object(z.a)(G,(function(F){F.priority>se&&W.push(F)})),_addChannelQueue(W)}}return G.identifier="ChannelControllerPlugin",G.priority=se,Object(K.a)(ChannelController,G,(function(F,W){F.setNextPlugin=function(F){},F.processTelemetry=function(F,W){B&&Object(z.a)(B,(function(B){B.length>0&&G._getTelCtx(W).createNew(B).processNext(F)}))},F.getChannelControls=function(){return B},F.initialize=function(G,K,J){F.isInitialized()||(W.initialize(G,K,J),_createChannelQueues((G||{}).channels,J),Object(z.a)(B,(function(F){return initializePlugins(new ne.a(F,G,K),J)})))}})),G}var B;return Object(W.b)(ChannelController,F),ChannelController._staticInit=(B=ChannelController.prototype,Object(z.y)(B,"ChannelControls",B.getChannelControls),void Object(z.y)(B,"channelQueue",B.getChannelControls)),ChannelController}(te.a),de=G(24),ue=G(54),pe=G(66),he="Extensions must provide callback to initialize",ge="_notificationManager";function _createPerfManager(F,B){return new X.a(B)}var fe=function(){function BaseCore(){var F,B,G,J,Y,Z=!1;Object(K.a)(BaseCore,this,(function(K){K._extensions=new Array,B=new le,K.logger=new $.a({loggingLevelConsole:Q.a.CRITICAL}),F=[],K.isInitialized=function(){return Z},K.initialize=function(F,J,Q,Y){K.isInitialized()&&Object(z.I)("Core should not be initialized more than once"),F&&!Object(z.r)(F.instrumentationKey)||Object(z.I)("Please provide instrumentation key"),G=Y,K[ge]=Y,K.config=F||{},Y&&!0!==K.config.disableDbgExt&&Y.addNotificationListener(Object(pe.b)(F)),K.config.enablePerfMgr&&Object(z.D)(K.config,"createPerfMgr",_createPerfManager),F.extensions=Object(z.r)(F.extensions)?[]:F.extensions,Object(z.i)(F,ue.a).NotificationManager=Y,Q&&(K.logger=Q);var $=[];$.push.apply($,Object(W.c)(Object(W.c)([],J,!1),F.extensions,!1)),$=sortPlugins($);var X=[],ee={};Object(z.a)($,(function(F){(Object(z.r)(F)||Object(z.r)(F.initialize))&&Object(z.I)(he);var G=F.priority,W=F.identifier;F&&G&&(Object(z.r)(ee[G])?ee[G]=W:Q.warnToConsole("Two extensions have same priority #"+G+" - "+ee[G]+", "+W)),(!G||G<B.priority)&&X.push(F)})),$.push(B),X.push(B),$=sortPlugins($),K._extensions=$,initializePlugins(new ne.a([B],F,K),$),initializePlugins(new ne.a(X,F,K),$),K._extensions=X,0===K.getTransmissionControls().length&&Object(z.I)("No channels available"),Z=!0,K.releaseQueue()},K.getTransmissionControls=function(){return B.getChannelControls()},K.track=function(B){Object(z.D)(B,ue.b,K.config.instrumentationKey,null,z.q),Object(z.D)(B,"time",Object(z.J)(new Date),null,z.q),Object(z.D)(B,"ver","4.0",null,z.r),K.isInitialized()?K.getProcessTelContext().processNext(B):F.push(B)},K.getProcessTelContext=function(){var F=K._extensions,G=F;return F&&0!==F.length||(G=[B]),new ne.a(G,K.config,K)},K.getNotifyMgr=function(){return G||(G=Object(ee.b)({addNotificationListener:function(F){},removeNotificationListener:function(F){},eventsSent:function(F){},eventsDiscarded:function(F,B){},eventsSendRequest:function(F,B){}}),K[ge]=G),G},K.getCookieMgr=function(){return Y||(Y=Object(de.c)(K.config,K.logger)),Y},K.setCookieMgr=function(F){Y=F},K.getPerfMgr=function(){return J||K.config&&K.config.enablePerfMgr&&Object(z.o)(K.config.createPerfMgr)&&(J=K.config.createPerfMgr(K,K.getNotifyMgr())),J||Object(X.c)()},K.setPerfMgr=function(F){J=F},K.eventCnt=function(){return F.length},K.releaseQueue=function(){F.length>0&&(Object(z.a)(F,(function(F){K.getProcessTelContext().processNext(F)})),F=[])}}))}return BaseCore}(),me={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},ve=function(F){function AppInsightsCore(){var B=F.call(this)||this,G=0;return Object(K.a)(AppInsightsCore,B,(function(F,B){function _validateTelemetryItem(F){if(Object(z.r)(F.name))throw _notifyInvalidEvent(F),Error("telemetry name required")}function _notifyInvalidEvent(B){var G=F.getNotifyMgr();G&&G.eventsDiscarded([B],me.InvalidEvent)}F.initialize=function(F,G,W,z){B.initialize(F,G,W||new $.a(F),z||new J(F))},F.track=function(G){Object(X.b)(F.getPerfMgr(),(function(){return"AppInsightsCore:track"}),(function(){null===G&&(_notifyInvalidEvent(G),Object(z.I)("Invalid telemetry item")),_validateTelemetryItem(G),B.track(G)}),(function(){return{item:G}}),!G.sync)},F.addNotificationListener=function(B){var G=F.getNotifyMgr();G&&G.addNotificationListener(B)},F.removeNotificationListener=function(B){var G=F.getNotifyMgr();G&&G.removeNotificationListener(B)},F.pollInternalLogs=function(B){var W=F.config.diagnosticLogInterval;return W&&W>0||(W=1e4),G&&F.stopPollingInternalLogs(),G=setInterval((function(){var G=F.logger?F.logger.queue:[];Object(z.a)(G,(function(G){var W={name:B||"InternalMessageId: "+G.messageId,iKey:F.config.instrumentationKey,time:Object(z.J)(new Date),baseType:$.b.dataType,baseData:{message:G.message}};F.track(W)})),G.length=0}),W)},F.stopPollingInternalLogs=function(){G&&(clearInterval(G),G=0)}})),B}return Object(W.b)(AppInsightsCore,F),AppInsightsCore}(fe),ye=G(67),Se="version",_e="properties",Ce=function(F){function AppInsightsCore(){var B=F.call(this)||this;return B.pluginVersionStringArr=[],B.pluginVersionString="",Object(K.a)(AppInsightsCore,B,(function(F,B){F.logger&&F.logger.queue||(F.logger=new $.a({loggingLevelConsole:Q.a.CRITICAL})),F.initialize=function(G,W,K,J){Object(X.b)(F,(function(){return"AppInsightsCore.initialize"}),(function(){if(G){G.endpointUrl||(G.endpointUrl="https://browser.events.data.microsoft.com/OneCollector/1.0/");var $=G.propertyStorageOverride;if($&&(!$.getProperty||!$.setProperty))throw new Error("Invalid property storage override passed.");G.channels&&Object(z.a)(G.channels,(function(B){B&&Object(z.a)(B,(function(B){if(B.identifier&&B.version){var G=B.identifier+"="+B.version;F.pluginVersionStringArr.push(G)}}))}))}F.getWParam=function(){return"undefined"!=typeof document?0:-1},W&&Object(z.a)(W,(function(B){if(B&&B.identifier&&B.version){var G=B.identifier+"="+B.version;F.pluginVersionStringArr.push(G)}})),F.pluginVersionString=F.pluginVersionStringArr.join(";");try{B.initialize(G,W,K,J),F.pollInternalLogs("InternalLog")}catch(B){var X=F.logger,ee=Object(Z.a)(B);-1!==ee.indexOf("channels")&&(ee+="\n - Channels must be provided through config.channels only!"),X.throwInternal(Q.a.CRITICAL,Y.f.FailedToInitializeSDK,"SDK Initialization Failed - no telemetry will be sent: "+ee)}}),(function(){return{config:G,extensions:W,logger:K,notificationManager:J}}))},F.track=function(G){Object(X.b)(F,(function(){return"AppInsightsCore.track"}),(function(){var W=G;if(W){W.timings=W.timings||{},W.timings.trackStart=Object(ye.i)(),Object(ye.k)(W.latency)||(W.latency=Y.a.Normal);var z=W.ext=W.ext||{};z.sdk=z.sdk||{},z.sdk.ver=ye.b;var K=W.baseData=W.baseData||{};K[_e]||(K[_e]={});var J=K[_e];J[Se]||(J[Se]=""),""!==F.pluginVersionString&&(J[Se]=F.pluginVersionString)}B.track(W)}),(function(){return{item:G}}),!G.sync)}})),B}return Object(W.b)(AppInsightsCore,F),AppInsightsCore}(ve),Te=Ce,Ee=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function _validateAppExpId(F,B){void 0===B&&(B=Ee);var G=null;if(F)for(var W=F.split(","),z=0;z<W.length;z++)_isValidAppFlightId(W[z],B)&&(G?G+=","+W[z]:G=W[z]);return G}function _isValidAppFlightId(F,B){if(void 0===B&&(B=Ee),!F||F.length<4)return!1;for(var G=!1,W=256,z=F.substring(0,3).toString().toUpperCase(),K=0;K<B.length;K++)if(B[K]+":"===z&&F.length<=W){G=!0;break}return G}var be=function(){function Application(F,B){this.core=B,this.appExpId=null,this.flightIdNameSpaces=Ee.slice(0),this.expIdCookieName="Treatments",this._cookieMgr=Object(de.d)(B),this._propertiesConfig=F;var G=Object(Z.d)();if(G){var W=G.documentElement;G&&(this.locale=W.lang)}this.env=F.env?F.env:this._getMetaDataFromDOM("awa-").env}return Application.prototype.getExpId=function(){return this._propertiesConfig.expId?this._readExpIdFromCoreData(this._propertiesConfig.expId):this._readExpIdFromCookie()},Application.prototype._getMetaDataFromDOM=function(F){var B,G={},W=Object(Z.d)();if(W){B=W&&W.querySelectorAll("meta");for(var z=0;z<B.length;z++){var K=B[z];if(K.name)if(0===K.name.toLowerCase().indexOf(F))G[K.name.replace(F,"")]=K.content}}return G},Application.prototype._setAppExpId=function(F){F!==this.appExpId&&(this.appExpId=_validateAppExpId(F,this.flightIdNameSpaces))},Application.prototype._getAppExpId=function(){return this.appExpId},Application.prototype._readExpIdFromCookie=function(){var F=Object(ye.g)(this._cookieMgr,this.expIdCookieName);return this._setAppExpId(F),this._getAppExpId()},Application.prototype._readExpIdFromCoreData=function(F){return this._setAppExpId(F),this._getAppExpId()},Application.validateAppExpId=_validateAppExpId,Application._staticInit=void Object(z.y)(Application.prototype,"expId",Application.prototype.getExpId),Application}(),Ie=function(){function Cloud(){}return Cloud}(),Ae=G(36),Re=function(){function User(F,B,G){this.core=G,this._propertiesConfig=B;var W=this._cookieMgr=Object(de.d)(G,F);if(W&&W.isEnabled()){if(!this._propertiesConfig.hashIdentifiers&&!this._propertiesConfig.dropIdentifiers){var K=Object(ye.g)(W,"MUID");K&&this.setLocalId("t:"+K)}if(this._propertiesConfig.enableApplicationInsightsUser){var J=Object(ye.g)(W,User.userCookieName);if(J){var Q=J.split(User.cookieSeparator);Q.length>0&&(this.id=Q[0])}if(!this.id){this.id=Object(Ae.g)(F&&!Object(z.x)(F.idLength)?F.idLength:22);var Y=new Date,$=Object(z.J)(Y);this.accountAcquisitionDate=$;var X=[this.id,$],Z=this._propertiesConfig.cookieDomain?this._propertiesConfig.cookieDomain:void 0;W.set(User.userCookieName,X.join(User.cookieSeparator),31536e3,Z)}}}if("undefined"!=typeof navigator){var ee=navigator;this.locale=ee.userLanguage||ee.language}}return User.prototype.getLocalId=function(){if(this._customLocalId)return this._customLocalId;if(!this._propertiesConfig.hashIdentifiers&&!this._propertiesConfig.dropIdentifiers){var F=Object(ye.g)(this._cookieMgr,"MUID");F&&this.setLocalId("t:"+F)}},User.prototype.setLocalId=function(F){this._customLocalId=F},User.cookieSeparator="|",User.userCookieName="ai_user",User._staticInit=void Object(z.y)(User.prototype,"localId",User.prototype.getLocalId,User.prototype.setLocalId),User}(),Pe="([\\d,.]+)",Oe="Unknown",Me="Edg/",we=[{ua:"OPR/",b:"Opera"},{ua:"PhantomJS",b:"PhantomJS"},{ua:"Edge",b:"Edge"},{ua:Me,b:"Edge"},{ua:"Electron",b:"Electron"},{ua:"Chrome",b:"Chrome"},{ua:"Trident",b:"MSIE"},{ua:"MSIE ",b:"MSIE"},{ua:"Firefox",b:"Firefox"},{ua:"Safari",b:"Safari"},{ua:"SkypeShell",b:"SkypeShell"}],De=[{br:"Microsoft Edge",b:"Edge"},{br:"Google Chrome",b:"Chrome"},{br:"Opera",b:"Opera"}];
/**
	* Cloud.ts
	* @author Hector Hernandez (hectorh)
	* @copyright Microsoft 2020
	*/function _userAgentContainsString(F,B){return B.indexOf(F)>-1}function _getBrandVersion(F,B){for(var G=0;G<B.length;G++)if(F==B[G].brand)return B[G].version;return null}function _getBrowserName(F){if(F)for(var B=0;B<we.length;B++){if(_userAgentContainsString(we[B].ua,F))return we[B].b}return Oe}function _getBrowserVersion(F,B){return"MSIE"===B?_getIeVersion(F):_getOtherVersion(B,F)}function _getIeVersion(F){var B=F.match(new RegExp("MSIE "+Pe));if(B)return B[1];var G=F.match(new RegExp("rv:"+Pe));return G?G[1]:void 0}function _getOtherVersion(F,B){"Safari"===F?F="Version":"Edge"===F&&_userAgentContainsString(Me,B)&&(F="Edg");var G=B.match(new RegExp(F+"/"+Pe));return G||"Opera"===F&&(G=B.match(new RegExp("OPR/"+Pe)))?G[1]:Oe}function _getScreenResolution(){var F={h:0,w:0},B=Object(Z.k)();return B&&B.screen&&(F.h=screen.height,F.w=screen.width),F}var Ne=function(){function Web(F,B){var G=Object(de.d)(B),W=F||{};Object(K.a)(Web,this,(function(F){var B=Object(Z.g)();if(B){var K=B.hostname;K&&(F.domain="file:"===B.protocol?"local":K)}if(W.populateBrowserInfo){var J=W.userAgent,Q=(W.userAgentData||{}).brands,Y=Object(Z.i)();Y&&(J=J||Y.userAgent||"",Q=Q||(Y.userAgentData||{}).brands),_parseUserAgent(J,Q);var $=_getScreenResolution();F.screenRes=$.w+"X"+$.h}function _parseUserAgent(B,G){if(Object(z.k)(G))try{for(var W=0;W<De.length;W++){var K=_getBrandVersion(De[W].br,G);if(K)return F.browser=De[W].b,void(F.browserVer=K)}}catch(F){}if(B){var J=_getBrowserName(B);F.browser=J,F.browserVer=_getBrowserVersion(B,J)}}F.getUserConsent=function(){return W.userConsented||!!Object(ye.g)(G,W.userConsentCookieName||"MSCC")},F.getUserConsentDetails=function(){try{var F=W.callback;if(F&&F.userConsentDetails){var B=F.userConsentDetails();if(B)return JSON.stringify({Required:B.Required||!1,Analytics:B.Analytics||!1,SocialMedia:B.SocialMedia||!1,Advertising:B.Advertising||!1})}}catch(F){}return null},Object(z.y)(F,"userConsent",F.getUserConsent)}))}return Web._staticInit=void Object(z.y)(Web.prototype,"userConsent",Web.prototype.getUserConsent),Web}(),Le={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},ke={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},Fe="([\\d,.]+)",xe="([\\d,_,.]+)",Ue="Unknown",je=[{r:Le.WINPHONE,os:"Windows Phone"},{r:Le.WINRT,os:"Windows RT"},{r:Le.WIN,os:"Windows"},{r:Le.IOS,os:"iOS"},{r:Le.ANDROID,os:"Android"},{r:Le.LINUX,os:"Linux"},{r:Le.CROS,os:"Chrome OS"},{s:"x11",os:"Unix"},{s:"blackberry",os:"BlackBerry"},{s:"symbian",os:"Symbian"},{s:"nokia",os:"Nokia"},{r:Le.OSX,os:"Mac OS X"}];
/**
	* OperatingSystem.ts
	* @author Hector Hernandez (hectorh)
	* @copyright Microsoft 2019
	*/function _getOsName(F){for(var B=0;B<je.length;B++){var G=je[B];if(G.r&&F.match(G.r))return G.os;if(G.s&&-1!==F.indexOf(G.s))return G.os}return Ue}function _getOsVersion(F,B){return"Windows"===B?_getGenericOsVersion(F,"Windows NT"):"Android"===B?_getGenericOsVersion(F,B):"Mac OS X"===B?_getMacOsxVersion(F):"iOS"===B?_getIosVersion(F):Ue}function _getGenericOsVersion(F,B){var G=F.match(new RegExp(B+" "+Fe));return G?ke[G[1]]?ke[G[1]]:G[1]:Ue}function _getMacOsxVersion(F){var B=F.match(new RegExp("Mac OS X "+xe));if(B){var G=B[1].replace(/_/g,".");if(G){var W=_getDelimiter(G);return W?G.split(W)[0]:G}}return Ue}function _getIosVersion(F){var B=F.match(new RegExp("OS "+xe));if(B){var G=B[1].replace(/_/g,".");if(G){var W=_getDelimiter(G);return W?G.split(W)[0]:G}}return Ue}function _getDelimiter(F){return F.indexOf(".")>-1?".":F.indexOf("_")>-1?"_":null}var Be=function(){function OperatingSystem(F){if(F.populateOperatingSystemInfo){var B=Object(Z.i)()||{},G=F.userAgent||B.userAgent||"",W=F.userAgentData||B.userAgentData||{};if(G){var K=_getOsName(G.toLowerCase());this.name=K,this.ver=_getOsVersion(G,K)}this.name&&this.name!==Ue||!Object(z.u)(W.platform)||(this.name=W.platform)}}return OperatingSystem}(),He=function(){function IntWeb(F,B){this.core=B,F.serviceName&&(this.serviceName=F.serviceName),this._cookieMgr=Object(de.d)(B)}return IntWeb.prototype.getMsfpc=function(){return Object(ye.g)(this._cookieMgr,"MSFPC")},IntWeb.prototype.getAnid=function(){return Object(ye.g)(this._cookieMgr,"ANON").slice(0,34)},IntWeb._staticInit=(Object(z.y)(IntWeb.prototype,"msfpc",IntWeb.prototype.getMsfpc),void Object(z.y)(IntWeb.prototype,"anid",IntWeb.prototype.getAnid)),IntWeb}(),Ve=1048576,Ge=2097152,We=function(){function Utc(F){this.popSample=100,this.eventFlags=0,F.hashIdentifiers&&(this.eventFlags=this.eventFlags|Ve),F.dropIdentifiers&&(this.eventFlags=this.eventFlags|Ge)}return Utc}(),qe=function(){function Loc(){var F=(new Date).getTimezoneOffset(),B=F%60,G=(F-B)/60,W="+";G>0&&(W="-"),G=Math.abs(G),B=Math.abs(B),this.tz=W+(G<10?"0"+G:G.toString())+":"+(B<10?"0"+B:B.toString())}return Loc}(),ze=function(){function Device(){}return Device}(),Ke=function(){function Session(){}return Session.prototype.setId=function(F){this.customId=F},Session.prototype.getId=function(){return Object(z.u)(this.customId)?this.customId:this.automaticId},Session._staticInit=void Object(z.y)(Session.prototype,"id",Session.prototype.getId,Session.prototype.setId),Session}(),Je=function(){function Trace(F,B,G,W){if(F.enableApplicationInsightsTrace){this.traceId=B||Object(Ae.e)(),this.parentId=G,this.name=W;var z=Object(Z.g)();z&&z.pathname&&(this.name=z.pathname)}}return Trace}(),Qe=Object(z.A)({id:"id",ver:"ver",appName:"name",locale:"locale",expId:"expId",env:"env"}),Ye=Object(z.A)({domain:"domain",browser:"browser",browserVer:"browserVer",screenRes:"screenRes",userConsent:"userConsent",consentDetails:"consentDetails"}),$e=Object(z.A)({locale:"locale",localId:"localId",id:"id"}),Xe=Object(z.A)({osName:"name",ver:"ver"}),Ze=Object(z.A)({ver:"ver",seq:"seq",installId:"installId",epoch:"epoch"}),et=Object(z.A)({msfpc:"msfpc",anid:"anid",serviceName:"serviceName"}),tt=Object(z.A)({popSample:"popSample",eventFlags:"eventFlags"}),nt=Object(z.A)({tz:"tz"}),it=Object(z.A)({sessionId:"sesId"}),rt=Object(z.A)({localId:"localId",deviceClass:"deviceClass",make:"make",model:"model"}),ot=Object(z.A)({role:"role",roleInstance:"roleInstance",roleVer:"roleVer"}),at=Object(z.A)({traceId:"traceID",traceName:"name",parentId:"parentID"}),st=Object(z.A)({UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SdkExt:"sdk",IntWebExt:"intweb",UtcExt:"utc",LocExt:"loc",CloudExt:"cloud"}),ct=G(21),lt="MicrosoftApplicationsTelemetryDeviceId";
/**
	* IntWeb.ts
	* @author Hector Hernandez (hectorh)
	* @copyright Microsoft 2019
	*/function _saveData(F,B,G,W){B?B.setProperty(G,W):F.set(G,W,31536e3)}function _getData(F,B,G){return B?B.getProperty(G)||"":Object(ye.g)(F,G)}var dt,ut,pt=function(){function Sdk(F,B){this._sequenceId=0;var G=F.propertyStorageOverride;this.seq=this._sequenceId,this.epoch=Object(ct.c)(!1).toString();var W=Object(de.d)(B,F);if(W.isEnabled()||G){var z=_getData(W,G,lt);z||(z=Object(Ae.f)()),_saveData(W,G,lt,z),this.installId=z}else W.purge(lt)}return Sdk.prototype.getSequenceId=function(){return++this._sequenceId},Sdk}();
/**
	* Utils.ts
	* @author  Abhilash Panwar (abpanwar) Hector Hernandez (hectorh)
	* @copyright Microsoft 2018
	* File containing utility functions.
	*/function canUseLocalStorage(){return void 0===dt&&(dt=!!_getVerifiedStorageObject(ut.LocalStorage)),dt}function _getLocalStorageObject(){return canUseLocalStorage()?_getVerifiedStorageObject(ut.LocalStorage):null}function _getVerifiedStorageObject(F){var B,G,W=null;try{var K=Object(ee.a)();if(!K)return null;G=new Date,(W=F===ut.LocalStorage?K.localStorage:K.sessionStorage)&&Object(z.o)(W.setItem)&&(W.setItem(G,G),B=W.getItem(G)!==G,W.removeItem(G),B&&(W=null))}catch(F){W=null}return W}function setStorage(F,B,G){var W=_getLocalStorageObject();if(null!==W)try{return W.setItem(B,G),!0}catch(B){dt=!1,F.throwInternal(Q.a.CRITICAL,Y.f.BrowserCannotWriteLocalStorage,"Browser failed write to local storage. "+B)}return!1}function getStorage(F,B){var G=_getLocalStorageObject();if(null!==G)try{return G.getItem(B)}catch(B){dt=!1,F.throwInternal(Q.a.CRITICAL,Y.f.BrowserCannotReadLocalStorage,"Browser failed read of local storage. "+B)}return null}
/**
	* SessionManager.ts
	* @author Hector Hernandez (hectorh)
	* @copyright Microsoft 2019
	*/!function(F){F[F.LocalStorage=0]="LocalStorage",F[F.SessionStorage=1]="SessionStorage"}(ut||(ut={}));var ht=function(){function SessionManager(F,B){var G,W,J=Object($.c)(F),X=Object(de.d)(F);Object(K.a)(SessionManager,this,(function(F){var K=getDefaultConfig(B);function getDefaultConfig(F){return{sessionRenewalMs:F.sessionRenewalMs&&function(){return F.sessionRenewalMs},sessionExpirationMs:F.sessionExpirationMs&&function(){return F.sessionExpirationMs},cookieDomain:F.cookieDomain&&function(){return F.cookieDomain},namePrefix:F.namePrefix&&function(){return F.namePrefix},sessionAsGuid:function(){return F.sessionAsGuid},idLength:function(){return F.idLength?F.idLength:22}}}function _initializeAutomaticSession(){var B=Object(ye.f)(W());if(B&&Object(z.o)(B.split))_initializeAutomaticSessionWithData(B);else{var G=getStorage(J,W());G&&_initializeAutomaticSessionWithData(G)}F.automaticSession.getId()||_renew()}function _initializeAutomaticSessionWithData(B){var G=F.automaticSession,W=B.split("|");W.length>0&&G.setId(W[0]);try{if(W.length>1){var z=+W[1];G.acquisitionDate=+new Date(z),G.acquisitionDate=G.acquisitionDate>0?G.acquisitionDate:0}if(W.length>2){var K=+W[2];G.renewalDate=+new Date(K),G.renewalDate=G.renewalDate>0?G.renewalDate:0}}catch(F){J.throwInternal(Q.a.CRITICAL,Y.f.ErrorParsingAISessionCookie,"Error parsing ai_session cookie, session will be reset: "+F)}0===G.renewalDate&&J.throwInternal(Q.a.WARNING,Y.f.SessionRenewalDateIsZero,"AI session renewal date is 0, session will be reset.")}function _renew(){var B=F.automaticSession,G=(new Date).getTime(),W=F.config.sessionAsGuid();!Object(z.x)(W)&&W?Object(z.l)(W)?B.setId(Object(ye.c)()):B.setId(Object(ye.c)(W)):B.setId(Object(Ae.g)(K&&K.idLength?K.idLength():22)),B.acquisitionDate=G,B.renewalDate=G,_setCookie(B.getId(),B.acquisitionDate,B.renewalDate),canUseLocalStorage()||J.throwInternal(Q.a.WARNING,Y.f.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")}function _setCookie(B,z,K){var J=z+F.config.sessionExpirationMs(),Q=K+F.config.sessionRenewalMs(),Y=new Date,$=[B,z,K];J<Q?Y.setTime(J):Y.setTime(Q);var Z=F.config.cookieDomain?F.config.cookieDomain():null;X.set(W(),$.join("|")+";expires="+Y.toUTCString(),null,Z),G=(new Date).getTime()}function _setStorage(F,B,G){setStorage(J,W(),[F,B,G].join("|"))}Object(z.o)(B.sessionExpirationMs)||(K.sessionExpirationMs=function(){return SessionManager.acquisitionSpan}),Object(z.o)(B.sessionRenewalMs)||(K.sessionRenewalMs=function(){return SessionManager.renewalSpan}),F.config=K,W=function(){return F.config.namePrefix&&F.config.namePrefix()?SessionManager.cookieNameConst+F.config.namePrefix():SessionManager.cookieNameConst},F.automaticSession=new Ke,F.update=function(){F.automaticSession.getId()||_initializeAutomaticSession();var B=F.automaticSession,W=F.config,z=(new Date).getTime(),K=z-B.acquisitionDate>W.sessionExpirationMs(),J=z-B.renewalDate>W.sessionRenewalMs();if(K||J)_renew();else{(!G||z-G>SessionManager.cookieUpdateInterval)&&(B.renewalDate=z,_setCookie(B.getId(),B.acquisitionDate,B.renewalDate))}},F.backup=function(){var B=F.automaticSession;_setStorage(B.getId(),B.acquisitionDate,B.renewalDate)}}))}return SessionManager.acquisitionSpan=864e5,SessionManager.renewalSpan=18e5,SessionManager.cookieUpdateInterval=6e4,SessionManager.cookieNameConst="ai_session",SessionManager}(),gt=z.u,ft=function(){function TelemetryContext(F,B,G){var W=this;W.app=new be(B,G),W.cloud=new Ie,W.user=new Re(F,B,G),W.os=new Be(B),W.web=new Ne(B,G),W.sdk=new pt(F,G),W.intWeb=new He(B,G),W.utc=new We(B),W.loc=new qe,W.device=new ze,W.telemetryTrace=new Je(B),W.sessionManager=new ht(G,B),W.session=new Ke}return TelemetryContext.prototype.getSessionId=function(){var F=this.session;if(F&&gt(F.customId))return F.customId;var B=this.sessionManager;B.update();var G=B.automaticSession;if(G){var W=G.getId();W&&gt(W)&&(F.automaticId=W)}return F.automaticId},TelemetryContext.prototype.applyApplicationContext=function(F){var B=this.app,G=F.ext[st.AppExt];Object(z.D)(G,Qe.id,B.id,gt),Object(z.D)(G,Qe.ver,B.ver,gt),Object(z.D)(G,Qe.appName,B.name,gt),Object(z.D)(G,Qe.locale,B.locale,gt),Object(z.D)(G,Qe.expId,B.getExpId(),gt),Object(z.D)(G,Qe.env,B.env,gt)},TelemetryContext.prototype.applyUserContext=function(F){var B=this.user,G=F.ext[st.UserExt];Object(z.D)(G,$e.localId,B.getLocalId(),gt),Object(z.D)(G,$e.locale,B.locale,gt),Object(z.D)(G,$e.id,B.id,gt)},TelemetryContext.prototype.applyWebContext=function(F){var B=this.web,G=F.ext[st.WebExt];Object(z.D)(G,Ye.domain,B.domain,gt),Object(z.D)(G,Ye.browser,B.browser,gt),Object(z.D)(G,Ye.browserVer,B.browserVer,gt),Object(z.D)(G,Ye.screenRes,B.screenRes,gt),G[Ye.userConsent]=B.getUserConsent(),G[Ye.consentDetails]=B.getUserConsentDetails()},TelemetryContext.prototype.applyOsContext=function(F){var B=this.os,G=F.ext[st.OSExt];Object(z.D)(G,Xe.osName,B.name,gt),Object(z.D)(G,Xe.ver,B.ver,gt)},TelemetryContext.prototype.applySdkContext=function(F){var B=this.sdk,G=F.ext[st.SdkExt];G[Ze.seq]=B.getSequenceId(),G[Ze.epoch]=B.epoch,Object(z.D)(G,Ze.installId,B.installId,gt)},TelemetryContext.prototype.applyIntWebContext=function(F){var B=this.intWeb,G=F.ext[st.IntWebExt];Object(z.D)(G,et.msfpc,B.getMsfpc(),gt),Object(z.D)(G,et.anid,B.getAnid(),gt),Object(z.D)(G,et.serviceName,B.serviceName,gt)},TelemetryContext.prototype.applyUtcContext=function(F){var B=this.utc,G=F.ext[st.UtcExt];G[tt.popSample]=B.popSample,B.eventFlags>0&&(G[tt.eventFlags]=B.eventFlags)},TelemetryContext.prototype.applyLocContext=function(F){F.ext[st.LocExt][nt.tz]=this.loc.tz},TelemetryContext.prototype.applySessionContext=function(F){F.ext[st.AppExt][it.sessionId]=this.getSessionId()},TelemetryContext.prototype.applyDeviceContext=function(F){var B=this.device,G=F.ext[st.DeviceExt];Object(z.D)(G,rt.localId,B.localId,gt),Object(z.D)(G,rt.make,B.make,gt),Object(z.D)(G,rt.model,B.model,gt),Object(z.D)(G,rt.deviceClass,B.deviceClass,gt)},TelemetryContext.prototype.applyCloudContext=function(F){var B=this.cloud,G=F.ext[st.CloudExt];Object(z.D)(G,ot.role,B.role,gt),Object(z.D)(G,ot.roleInstance,B.roleInstance,gt),Object(z.D)(G,ot.roleVer,B.roleVer,gt)},TelemetryContext.prototype.applyAITraceContext=function(F){var B=this.telemetryTrace,G=F.ext[st.TraceExt];Object(z.D)(G,at.traceId,B.traceId,gt),Object(z.D)(G,at.traceName,B.name,gt),Object(z.D)(G,at.parentId,B.parentId,gt)},TelemetryContext}(),mt=function(F){function PropertiesPlugin(){var B,G=F.call(this)||this;G.identifier="SystemPropertiesCollector",G.priority=3,G.version="3.1.11";var W={};return Object(K.a)(PropertiesPlugin,G,(function(K,J){function _addPropertiesIfAbsent(F,B){F&&Object(z.z)(F,(function(F,G){B[F]||(B[F]=G)}))}K.initialize=function(W,z,J){F.prototype.initialize.call(G,W,z,J),B=new ft(W,K._getTelCtx().getExtCfg(K.identifier),z)},K.processTelemetry=function(F,G){Object(ye.q)(F,K.identifier),G=K._getTelCtx(G);var J=F.ext=F.ext?F.ext:{};F.data=F.data?F.data:{},J[st.AppExt]=J[st.AppExt]||{},J[st.UserExt]=J[st.UserExt]||{},J[st.WebExt]=J[st.WebExt]||{},J[st.OSExt]=J[st.OSExt]||{},J[st.SdkExt]=J[st.SdkExt]||{},J[st.IntWebExt]=J[st.IntWebExt]||{},J[st.UtcExt]=J[st.UtcExt]||{},J[st.LocExt]=J[st.LocExt]||{},J[st.DeviceExt]=J[st.DeviceExt]||{},J[st.TraceExt]=J[st.TraceExt]||{},J[st.CloudExt]=J[st.CloudExt]||{},B.applyApplicationContext(F),B.applyUserContext(F),B.applyWebContext(F),B.applyOsContext(F),B.applySdkContext(F),B.applyIntWebContext(F),B.applyUtcContext(F),B.applyLocContext(F),B.applySessionContext(F),B.applyDeviceContext(F),B.applyAITraceContext(F),B.applyCloudContext(F),Object(z.a)(Object(z.B)(J),(function(F){0===Object(z.B)(J[F]).length&&delete J[F]})),_addPropertiesIfAbsent(W,F.data),K.processNext(F,G)},K.getPropertiesContext=function(){return B},K.setProperty=function(F,B){W[F]=B}})),G}return Object(W.b)(PropertiesPlugin,F),PropertiesPlugin}(te.a),vt=mt,yt="REAL_TIME",St="NEAR_REAL_TIME",_t="BEST_EFFORT",Ct="POST",Tt="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",Et="drop",bt="send",It="requeue",At="rspFail",Rt="oth",Pt="no-cache, no-store",Ot="application/x-json-stream",Mt="cache-control",wt="content-type",Dt="kill-tokens",Nt="kill-duration",Lt="kill-duration-seconds",kt="time-delta-millis",Ft="client-version",xt="client-id",Ut="time-delta-to-apply-millis",jt="upload-time",Bt="apikey",Ht="AuthMsaDeviceTicket",Vt="NoResponseBody",Gt="msfpc";
/**
	* TelemetryContext.ts
	* @author Hector Hernandez (hectorh)
	* @copyright Microsoft 2019
	*/function _getEventMsfpc(F){var B=(F.ext||{}).intweb;return B&&Object(ye.m)(B[Gt])?B[Gt]:null}function EventBatch_getMsfpc(F){for(var B=null,G=0;null===B&&G<F.length;G++)B=_getEventMsfpc(F[G]);return B}var Wt=function(){function EventBatch(F,B){var G=B?[].concat(B):[],W=this,K=EventBatch_getMsfpc(G);W.iKey=function(){return F},W.Msfpc=function(){return K||""},W.count=function(){return G.length},W.events=function(){return G},W.addEvent=function(F){return!!F&&(G.push(F),K||(K=_getEventMsfpc(F)),!0)},W.split=function(B,W){var J;if(B<G.length){var Q=G.length-B;Object(z.r)(W)||(Q=W<Q?W:Q),J=G.splice(B,Q),K=EventBatch_getMsfpc(G)}return new EventBatch(F,J)}}return EventBatch.create=function(F,B){return new EventBatch(F,B)},EventBatch}(),qt=G(2),zt=20,Kt=3984588,Jt=65e3,Qt=2e6,Yt=Math.min(Qt,Jt),$t="metadata",Xt="f",Zt=/\./,en=function(){function Serializer(F,B,G,W){var J="data",Q="baseData",Y="ext",$=!!W,Z=!0,ee=B,te={};Object(K.a)(Serializer,this,(function(B){function _isReservedField(F,B){var G=te[F];return void 0===G&&(F.length>=7&&(G=Object(z.G)(F,"ext.metadata")||Object(z.G)(F,"ext.web")),te[F]=G),G}function _processPathKeys(F,B,W,K,J,Q,Y){Object(z.z)(F,(function(F,X){var Z=null;if(X||Object(ye.m)(X)){var te=W,ne=F,ie=J,re=B;if($&&!K&&Zt.test(F)){var oe=F.split("."),ae=oe.length;if(ae>1){ie&&(ie=ie.slice());for(var se=0;se<ae-1;se++){var ce=oe[se];re=re[ce]=re[ce]||{},te+="."+ce,ie&&ie.push(ce)}ne=oe[ae-1]}}if(Z=!(K&&_isReservedField(te))&&ee&&ee.handleField(te,ne)?ee.value(te,ne,X,G):Object(ye.p)(ne,X,G)){var le=Z.value;if(re[ne]=le,Q&&Q(ie,ne,Z),Y&&"object"==typeof le&&!Object(z.k)(le)){var de=ie;de&&(de=de.slice()).push(ne),_processPathKeys(X,le,te+"."+ne,K,de,Q,Y)}}}}))}B.createPayload=function(F,B,G,W,z,K){return{apiKeys:[],payloadBlob:"",overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:F,isTeardown:B,isSync:G,isBeacon:W,sendType:K,sendReason:z}},B.appendPayload=function(G,W,K){var J=G&&W&&!G.overflow;return J&&Object(X.b)(F,(function(){return"Serializer:appendPayload"}),(function(){for(var F=W.events(),J=G.payloadBlob,Q=G.numEvents,Y=!1,$=[],X=[],Z=G.isBeacon,ee=Z?Jt:Kt,te=Z?Yt:Qt,ne=0,ie=0;ne<F.length;){var re=F[ne];if(re){if(Q>=K){G.overflow=W.split(ne);break}var oe=B.getEventBlob(re);if(oe&&oe.length<=te){var ae=oe.length;if(J.length+ae>ee){G.overflow=W.split(ne);break}J&&(J+="\n"),J+=oe,++ie>zt&&(J.substr(0,1),ie=0),Y=!0,Q++}else oe?$.push(re):X.push(re),F.splice(ne,1),ne--}ne++}if($&&$.length>0&&G.sizeExceed.push(Wt.create(W.iKey(),$)),X&&X.length>0&&G.failedEvts.push(Wt.create(W.iKey(),X)),Y){G.batches.push(W),G.payloadBlob=J,G.numEvents=Q;var se=W.iKey();-1===Object(z.b)(G.apiKeys,se)&&G.apiKeys.push(se)}}),(function(){return{payload:G,theBatch:{iKey:W.iKey(),evts:W.events()},max:K}})),J},B.getEventBlob=function(B){try{return Object(X.b)(F,(function(){return"Serializer.getEventBlob"}),(function(){var F={};F.name=B.name,F.time=B.time,F.ver=B.ver,F.iKey="o:"+Object(ye.h)(B.iKey);var G={},W=B[Y];W&&(F[Y]=G,Object(z.z)(W,(function(F,B){_processPathKeys(B,G[F]={},"ext."+F,!0,null,null,!0)})));var K=F[J]={};K.baseType=B.baseType;var $=K[Q]={};return _processPathKeys(B.baseData,$,Q,!1,[Q],(function(F,B,W){_addJSONPropertyMetaData(G,F,B,W)}),Z),_processPathKeys(B.data,K,J,!1,[],(function(F,B,W){_addJSONPropertyMetaData(G,F,B,W)}),Z),JSON.stringify(F)}),(function(){return{item:B}}))}catch(F){return null}}}))}return Serializer}();function _addJSONPropertyMetaData(F,B,G,W){if(W&&F){var K=Object(ye.e)(W.value,W.kind,W.propertyType);if(K>-1){var J=F[$t];J||(J=F[$t]={f:{}});var Q=J[Xt];if(Q||(Q=J[Xt]={}),B)for(var Y=0;Y<B.length;Y++){var $=B[Y];Q[$]||(Q[$]={f:{}});var X=Q[$][Xt];X||(X=Q[$][Xt]={}),Q=X}Q=Q[G]={},Object(z.k)(W.value)?Q.a={t:K}:Q.t=K}}}
/**
	* RetryPolicy.ts
	* @author Abhilash Panwar (abpanwar)
	* @copyright Microsoft 2018
	*/var tn,nn=.8,rn=1.2,on=3e3,an=6e5,sn=function(){function RetryPolicy(){}return RetryPolicy.shouldRetryForStatus=function(F){return!(F>=300&&F<500&&408!=F&&429!=F||501==F||505==F)},RetryPolicy.getMillisToBackoffForRetry=function(F){var B=0,G=on*nn,W=on*rn,z=Math.floor(Math.random()*(W-G))+G;return B=Math.pow(2,F)*z,Math.min(B,an)},RetryPolicy}(),cn=1e3,ln=function(){function KillSwitch(){var F={};function _normalizeTenants(F){var B=[];return F&&Object(z.a)(F,(function(F){B.push(Object(z.H)(F))})),B}Object(K.a)(KillSwitch,this,(function(B){B.setKillSwitchTenants=function(B,G){if(B&&G)try{var W=_normalizeTenants(B.split(","));if("this-request-only"===G)return W;for(var K=parseInt(G,10)*cn,J=0;J<W.length;++J)F[W[J]]=Object(z.f)()+K}catch(F){return[]}return[]},B.isTenantKilled=function(B){var G=F,W=Object(z.H)(B);return void 0!==G[W]&&G[W]>Object(z.f)()||(delete G[W],!1)}}))}return KillSwitch}(),dn=ln,un=function(){function ClockSkewManager(){var F=!0,B=!0,G=!0,W="use-collector-delta",z=!1;Object(K.a)(ClockSkewManager,this,(function(K){K.allowRequestSending=function(){return F},K.firstRequestSent=function(){G&&(G=!1,z||(F=!1))},K.shouldAddClockSkewHeaders=function(){return B},K.getClockSkewHeaderValue=function(){return W},K.setClockSkew=function(G){z||(G?(W=G,B=!0,z=!0):B=!1,F=!0)}}))}return ClockSkewManager}(),pn=un,hn="sendAttempt",gn="&"+Vt+"=true",fn=((tn={})[1]=It,tn[100]=It,tn[200]="sent",tn[8004]=Et,tn[8003]=Et,tn),mn={};function _addCollectorHeaderQsMapping(F,B){mn[F]=B}function _getResponseText(F){try{return F.responseText}catch(F){}return""}function _hasHeader(F,B){var G=!1;if(F&&B){var W=Object(z.B)(F);if(W&&W.length>0)for(var K=B.toLowerCase(),J=0;J<W.length;J++){var Q=W[J];if(Q&&Object(z.j)(B,Q)&&Q.toLowerCase()===K){G=!0;break}}}return G}function _addRequestDetails(F,B,G,W){B&&G&&G.length>0&&(W&&mn[B]?(F.hdrs[mn[B]]=G,F.useHdrs=!0):F.url+="&"+B+"="+G)}_addCollectorHeaderQsMapping(Ht,Ht);var vn=function(){function HttpManager(F,B,G,W){this._responseHandlers=[];var J,$,ee,te,ne,ie,re="?cors=true&"+wt.toLowerCase()+"="+Ot,oe=new dn,ae=!1,se=new pn,ce=!1,le=0,de=!0,ue=[],pe={},he=[],ge=null,fe=!1,me=!1,ve=!1;Object(K.a)(HttpManager,this,(function(K){var Se=!0;function _getSenderInterface(F,B){for(var G=0,W=null,z=0;null==W&&z<F.length;)1===(G=F[z])?Object(Z.r)()?W=_xdrSendPost:Object(Z.q)()&&(W=_xhrSendPost):2===G&&Object(Z.n)(B)?W=_fetchSendPost:ce&&3===G&&Object(Z.m)()&&(W=_beaconSendPost),z++;return W?{_transport:G,_isSync:B,sendPOST:W}:null}function _xdrSendPost(F,B,G){var W=new XDomainRequest;W.open(Ct,F.urlString),F.timeout&&(W.timeout=F.timeout),W.onload=function(){var F=_getResponseText(W);_doOnComplete(B,200,{},F),_handleCollectorResponse(F)},W.onerror=function(){_doOnComplete(B,400,{})},W.ontimeout=function(){_doOnComplete(B,500,{})},W.onprogress=function(){},G?W.send(F.data):J._setTimeoutOverride((function(){W.send(F.data)}),0)}function _fetchSendPost(F,B,G){var W,K=F.urlString,Q=!1,Y=!1,$=((W={body:F.data,method:Ct})[Tt]=!0,W);G&&($.keepalive=!0,2===F._sendReason&&(Q=!0,K+=gn)),Se&&($.credentials="include"),F.headers&&Object(z.B)(F.headers).length>0&&($.headers=F.headers),fetch(K,$).then((function(F){var G={},W="";F.headers&&F.headers.forEach((function(F,B){G[B]=F})),F.body&&F.text().then((function(F){W=F})),Y||(Y=!0,_doOnComplete(B,F.status,G,W),_handleCollectorResponse(W))})).catch((function(F){Y||(Y=!0,_doOnComplete(B,0,{}))})),Q&&!Y&&(Y=!0,_doOnComplete(B,200,{})),!Y&&F.timeout>0&&J._setTimeoutOverride((function(){Y||(Y=!0,_doOnComplete(B,500,{}))}),F.timeout)}function _xhrSendPost(F,B,G){var W=F.urlString;function _appendHeader(F,B,G){if(!F[G]&&B&&B.getResponseHeader){var W=B.getResponseHeader(G);W&&(F[G]=Object(z.H)(W))}return F}function _getAllResponseHeaders(F){var B={};return F.getAllResponseHeaders?B=_convertAllHeadersToMap(F.getAllResponseHeaders()):(B=_appendHeader(B,F,kt),B=_appendHeader(B,F,Nt),B=_appendHeader(B,F,Lt)),B}function xhrComplete(F,G){_doOnComplete(B,F.status,_getAllResponseHeaders(F),G)}G&&F.disableXhrSync&&(G=!1);var K=Object(ye.o)(Ct,W,Se,!0,G,F.timeout);Object(z.z)(F.headers,(function(F,B){K.setRequestHeader(F,B)})),K.onload=function(){var F=_getResponseText(K);xhrComplete(K,F),_handleCollectorResponse(F)},K.onerror=function(){xhrComplete(K)},K.ontimeout=function(){xhrComplete(K)},K.send(F.data)}function _doOnComplete(F,B,G,W){try{F(B,G,W)}catch(F){J.diagLog().throwInternal(Q.a.WARNING,Y.f.SendPostOnCompleteFailure,Object(Z.a)(F))}}function _beaconSendPost(F,B,G){var W=200,K=F._thePayload,Q=F.urlString+gn;try{var Y=Object(Z.i)();if(!Y.sendBeacon(Q,F.data))if(K){var $=[];Object(z.a)(K.batches,(function(F){if($&&F&&F.count()>0){for(var B=F.events(),G=0;G<B.length;G++)if(!Y.sendBeacon(Q,ge.getEventBlob(B[G]))){$.push(F.split(G));break}}else $.push(F.split(0))})),_sendBatchesNotification($,8003,K.sendType,!0)}else W=0}catch(F){J.diagLog().warnToConsole("Failed to send telemetry using sendBeacon API. Ex:"+F),W=0}finally{_doOnComplete(B,W,{},"")}}function _isBeaconPayload(F){return 2===F||3===F}function _adjustSendType(F){return me&&_isBeaconPayload(F)&&(F=2),F}function _hasIdleConnection(){return!ae&&le<B}function _clearQueue(){var F=he;return he=[],F}function _canSendPayload(F,B,G){var W=!1;return F&&F.length>0&&!ae&&$[B]&&ge&&(W=0!==B||_hasIdleConnection()&&(G>0||se.allowRequestSending())),W}function _createDebugBatches(F){var B={};return F&&Object(z.a)(F,(function(F,G){B[G]={iKey:F.iKey(),evts:F.events()}})),B}function _sendBatches(B,G,W,z,K){if(B&&0!==B.length)if(ae)_sendBatchesNotification(B,1,z);else{z=_adjustSendType(z);try{var te=B,ne=0!==z;Object(X.b)(ee,(function(){return"HttpManager:_sendBatches"}),(function(J){J&&(B=B.slice(0));for(var Q=[],Y=null,X=Object(ye.i)(),Z=$[z]||(ne?$[1]:$[0]),ee=(me||_isBeaconPayload(z)||Z&&3===Z._transport)&&_canUseSendBeaconApi();_canSendPayload(B,z,G);){var te=B.shift();te&&te.count()>0&&(oe.isTenantKilled(te.iKey())?Q.push(te):(Y=Y||ge.createPayload(G,W,ne,ee,K,z),ge.appendPayload(Y,te,F)?null!==Y.overflow&&(B=[Y.overflow].concat(B),Y.overflow=null,_doPayloadSend(Y,X,Object(ye.i)(),K),X=Object(ye.i)(),Y=null):(_doPayloadSend(Y,X,Object(ye.i)(),K),X=Object(ye.i)(),B=[te].concat(B),Y=null)))}Y&&_doPayloadSend(Y,X,Object(ye.i)(),K),B.length>0&&(he=B.concat(he)),_sendBatchesNotification(Q,8004,z)}),(function(){return{batches:_createDebugBatches(te),retryCount:G,isTeardown:W,isSynchronous:ne,sendReason:K,useSendBeacon:_isBeaconPayload(z),sendType:z}}),!ne)}catch(F){J.diagLog().throwInternal(Q.a.WARNING,Y.f.CannotSerializeObject,"Unexpected Exception sending batch: "+Object(Z.a)(F))}}}function _buildRequestDetails(F,B){var G={url:re,hdrs:{},useHdrs:!1};G.hdrs=Object(ye.d)(G.hdrs,pe),G.useHdrs=Object(z.B)(G.hdrs).length>0,_addRequestDetails(G,xt,"NO_AUTH",B),_addRequestDetails(G,Ft,ye.b,B);var W="";Object(z.a)(F.apiKeys,(function(F){W.length>0&&(W+=","),W+=F})),_addRequestDetails(G,Bt,W,B),_addRequestDetails(G,jt,Object(z.f)().toString(),B);var K=_getMsfpc(F);if(Object(ye.m)(K)&&(G.url+="&ext.intweb.msfpc="+K),se.shouldAddClockSkewHeaders()&&_addRequestDetails(G,Ut,se.getClockSkewHeaderValue(),B),ee.getWParam){var J=ee.getWParam();J>=0&&(G.url+="&w="+J)}for(var Q=0;Q<ue.length;Q++)G.url+="&"+ue[Q].name+"="+ue[Q].value;return G}function _canUseSendBeaconApi(){return!de&&ce&&Object(Z.m)()}function _setTimingValue(F,B,G){F[B]=F[B]||{},F[B][J.identifier]=G}function _doPayloadSend(F,B,G,W){if(F&&F.payloadBlob&&F.payloadBlob.length>0){var Q=!!K.sendHook,Y=$[F.sendType];!_isBeaconPayload(F.sendType)&&F.isBeacon&&2===F.sendReason&&(Y=$[2]||$[3]||Y);var te=ve;(F.isBeacon||3===Y._transport)&&(te=!1);var re=_buildRequestDetails(F,te);te=te||re.useHdrs;var oe=Object(ye.i)();Object(X.b)(ee,(function(){return"HttpManager:_doPayloadSend"}),(function(){for(var $=0;$<F.batches.length;$++)for(var ae=F.batches[$].events(),ce=0;ce<ae.length;ce++){var ue=ae[ce];if(fe){var pe=ue.timings=ue.timings||{};_setTimingValue(pe,"sendEventStart",oe),_setTimingValue(pe,"serializationStart",B),_setTimingValue(pe,"serializationCompleted",G)}ue[hn]>0?ue[hn]++:ue[hn]=1}_sendBatchesNotification(F.batches,1e3+(W||0),F.sendType,!0);var he={data:F.payloadBlob,urlString:re.url,headers:re.hdrs,_thePayload:F,_sendReason:W,timeout:ne};Object(z.x)(ie)||(he.disableXhrSync=!!ie),te&&(_hasHeader(he.headers,Mt)||(he.headers[Mt]=Pt),_hasHeader(he.headers,wt)||(he.headers[wt]=Ot));var ge=null;Y&&(ge=function(B){se.firstRequestSent();var onComplete=function(B,G){_retryRequestIfNeeded(B,G,F,W)},G=F.isTeardown||F.isSync;try{Y.sendPOST(B,onComplete,G),K.sendListener&&K.sendListener(he,B,G,F.isBeacon)}catch(F){J.diagLog().warnToConsole("Unexpected exception sending payload. Ex:"+Object(Z.a)(F)),_doOnComplete(onComplete,0,{})}}),Object(X.b)(ee,(function(){return"HttpManager:_doPayloadSend.sender"}),(function(){if(ge)if(0===F.sendType&&le++,Q&&!F.isBeacon&&3!==Y._transport){var B={data:he.data,urlString:he.urlString,headers:Object(ye.d)({},he.headers),timeout:he.timeout,disableXhrSync:he.disableXhrSync},G=!1;Object(X.b)(ee,(function(){return"HttpManager:_doPayloadSend.sendHook"}),(function(){try{K.sendHook(B,(function(F){G=!0,de||F._thePayload||(F._thePayload=F._thePayload||he._thePayload,F._sendReason=F._sendReason||he._sendReason),ge(F)}),F.isSync||F.isTeardown)}catch(F){G||ge(he)}}))}else ge(he)}))}),(function(){return{thePayload:F,serializationStart:B,serializationCompleted:G,sendReason:W}}),F.isSync)}F.sizeExceed&&F.sizeExceed.length>0&&_sendBatchesNotification(F.sizeExceed,8003,F.sendType),F.failedEvts&&F.failedEvts.length>0&&_sendBatchesNotification(F.failedEvts,8002,F.sendType)}function _addEventCompletedTimings(F,B){fe&&Object(z.a)(F,(function(F){_setTimingValue(F.timings=F.timings||{},"sendEventCompleted",B)}))}function _retryRequestIfNeeded(F,B,W,K){var J=9e3,Q=null,Y=!1,$=!1;try{var X=!0;if(typeof F!==qt.l){if(B){se.setClockSkew(B[kt]);var Z=B[Nt]||B["kill-duration-seconds"];Object(z.a)(oe.setKillSwitchTenants(B[Dt],Z),(function(F){Object(z.a)(W.batches,(function(B){if(B.iKey()===F){Q=Q||[];var G=B.split(0);W.numEvents-=G.count(),Q.push(G)}}))}))}if(200==F||204==F)return void(J=200);(!sn.shouldRetryForStatus(F)||W.numEvents<=0)&&(X=!1),J=9e3+F%1e3}if(X){J=100;var ee=W.retryCnt;0===W.sendType&&(ee<G?(Y=!0,_doAction((function(){0===W.sendType&&le--,_sendBatches(W.batches,ee+1,W.isTeardown,me?2:W.sendType,5)}),me,sn.getMillisToBackoffForRetry(ee))):($=!0,me&&(J=8001)))}}finally{Y||(se.setClockSkew(),_handleRequestFinished(W,J,K,$)),_sendBatchesNotification(Q,8004,W.sendType)}}function _handleRequestFinished(F,B,G,W){try{W&&J._backOffTransmission(),200===B&&(W||F.isSync||J._clearBackOff(),_addCompleteTimings(F.batches)),_sendBatchesNotification(F.batches,B,F.sendType,!0)}finally{0===F.sendType&&(le--,5!==G&&K.sendQueuedRequests(F.sendType,G))}}function _addCompleteTimings(F){if(fe){var B=Object(ye.i)();Object(z.a)(F,(function(F){F&&F.count()>0&&_addEventCompletedTimings(F.events(),B)}))}}function _doAction(F,B,G){B?F():J._setTimeoutOverride(F,G)}function _convertAllHeadersToMap(F){var B={};if(Object(z.u)(F)){var G=Object(z.H)(F).split(/[\r\n]+/);Object(z.a)(G,(function(F){if(F){var G=F.indexOf(": ");if(-1!==G){var W=Object(z.H)(F.substring(0,G)).toLowerCase(),K=Object(z.H)(F.substring(G+1));B[W]=K}else B[Object(z.H)(F)]=1}}))}return B}function _getMsfpc(F){for(var B=0;B<F.batches.length;B++){var G=F.batches[B].Msfpc();if(G)return encodeURIComponent(G)}return""}function _handleCollectorResponse(F){var B=K._responseHandlers;try{for(var G=0;G<B.length;G++)try{B[G](F)}catch(F){J.diagLog().throwInternal(Q.a.CRITICAL,Y.f.PostResponseHandler,"Response handler failed: "+F)}if(F){var W=JSON.parse(F);Object(ye.m)(W.webResult)&&Object(ye.m)(W.webResult[Gt])&&te.set("MSFPC",W.webResult[Gt],31536e3)}}catch(F){}}function _sendBatchesNotification(F,B,G,z){if(F&&F.length>0&&W){var K=W[_getNotificationAction(B)];if(K){var $=0!==G;Object(X.b)(ee,(function(){return"HttpManager:_sendBatchesNotification"}),(function(){_doAction((function(){try{K.call(W,F,B,$,G)}catch(F){J.diagLog().throwInternal(Q.a.CRITICAL,Y.f.NotificationException,"send request notification failed: "+F)}}),z||$,0)}),(function(){return{batches:_createDebugBatches(F),reason:B,isSync:$,sendSync:z,sendType:G}}),!$)}}}function _getNotificationAction(F){var B=fn[F];return Object(ye.m)(B)||(B=Rt,F>=9e3&&F<=9999?B=At:F>=8e3&&F<=8999?B=Et:F>=1e3&&F<=1999&&(B=bt)),B}K.initialize=function(F,B,G,W,K){var Q;K||(K={}),re=F+re,ve=!Object(z.x)(K.avoidOptions)&&!K.avoidOptions,ee=B,te=B.getCookieMgr(),fe=!ee.config.disableEventTimings;var Y=!!ee.config.enableCompoundKey;J=G;var X=K.valueSanitizer,oe=K.stringifyObjects;Object(z.x)(K.enableCompoundKey)||(Y=!!K.enableCompoundKey),ne=K.xhrTimeout,ie=K.disableXhrSync,ce=!Object(Z.p)(),ge=new en(ee,X,oe,Y);var ae=W,se=K.alwaysUseXhrOverride?W:null,le=K.alwaysUseXhrOverride?W:null;if(!W){de=!1;var ue=Object(Z.g)();ue&&ue.protocol&&"file:"===ue.protocol.toLowerCase()&&(Se=!1);var pe=[];pe=Object(Z.p)()?[2,1]:[1,2,3];var he=K.transports;he&&(Object(z.s)(he)?pe=[he].concat(pe):Object(z.k)(he)&&(pe=he.concat(pe))),W=_getSenderInterface(pe,!1),ae=_getSenderInterface(pe,!0),W||J.diagLog().warnToConsole("No available transport to send events")}(Q={})[0]=W,Q[1]=ae||_getSenderInterface([1,2,3],!0),Q[2]=se||_getSenderInterface([3,2],!0)||ae||_getSenderInterface([1],!0),Q[3]=le||_getSenderInterface([2,3],!0)||ae||_getSenderInterface([1],!0),$=Q},K._getDbgPlgTargets=function(){return[$[0],oe,ge,$]},K.addQueryStringParameter=function(F,B){for(var G=0;G<ue.length;G++)if(ue[G].name===F)return void(ue[G].value=B);ue.push({name:F,value:B})},K.addHeader=function(F,B){pe[F]=B},K.canSendRequest=function(){return _hasIdleConnection()&&se.allowRequestSending()},K.sendQueuedRequests=function(F,B){Object(z.x)(F)&&(F=0),me&&(F=_adjustSendType(F),B=2),_canSendPayload(he,F,0)&&_sendBatches(_clearQueue(),0,!1,F,B||0)},K.isCompletelyIdle=function(){return!ae&&0===le&&0===he.length},K.setUnloading=function(F){me=F},K.addBatch=function(F){if(F&&F.count()>0){if(oe.isTenantKilled(F.iKey()))return!1;he.push(F)}return!0},K.teardown=function(){he.length>0&&_sendBatches(_clearQueue(),0,!0,2,2)},K.pause=function(){ae=!0},K.resume=function(){ae=!1,K.sendQueuedRequests(0,4)},K.sendSynchronousBatch=function(F,B,G){F&&F.count()>0&&(Object(z.r)(B)&&(B=1),me&&(B=_adjustSendType(B),G=2),_sendBatches([F],0,!1,B,G||0))}}))}return HttpManager}(),yn=.25,Sn=500,_n=20,Cn=6,Tn=2,En=4,bn=ye.n?window:void 0,In=2,An=1,Rn="eventsDiscarded",Pn="overrideInstrumentationKey",On="maxEventRetryAttempts",Mn="maxUnloadEventRetryAttempts",wn=function(F){function PostChannel(){var B,G=F.call(this)||this;G.identifier="PostChannel",G.priority=1011,G.version="3.1.11";var W,J,$,ee,te,ne=!1,ie=[],re=null,oe=!1,ae=0,se=500,ce=0,le=1e4,de={},ue=yt,pe=null,he=null,ge=0,fe=0,ve={},Se=-1,_e=!0,Ce=!1,Te=Cn,Ee=Tn;return Object(K.a)(PostChannel,G,(function(F,G){function _hookWParam(F){var G=F.getWParam;F.getWParam=function(){var F=0;return B.ignoreMc1Ms0CookieProcessing&&(F|=2),F|G()}}function _handleUnloadEvents(F){"beforeunload"!==(F||Object(Z.k)().event).type&&(Ce=!0,J.setUnloading(Ce)),_releaseAllQueues(2,2)}function _handleShowEvents(F){Ce=!1,J.setUnloading(Ce)}function _addEventToQueues(F,B){if(F.sendAttempt||(F.sendAttempt=0),F.latency||(F.latency=Y.a.Normal),F.ext&&F.ext.trace&&delete F.ext.trace,F.ext&&F.ext.user&&F.ext.user.id&&delete F.ext.user.id,_e&&(F.ext=Object(z.C)(F.ext),F.baseData&&(F.baseData=Object(z.C)(F.baseData)),F.data&&(F.data=Object(z.C)(F.data))),F.sync)if(ge||oe)F.latency=Y.a.RealTime,F.sync=!1;else if(J)return _e&&(F=Object(z.C)(F)),void J.sendSynchronousBatch(Wt.create(F.iKey,[F]),!0===F.sync?1:F.sync,3);var G=F.latency,W=ce,K=le;G===Y.a.Immediate&&(W=ae,K=se);var Q=!1;if(W<K)Q=!_addEventToProperQueue(F,B);else{var $=Y.a.Normal,X=_n;G===Y.a.Immediate&&($=Y.a.Immediate,X=1),Q=!0,_dropEventWithLatencyOrLess(F.iKey,F.latency,$,X)&&(Q=!_addEventToProperQueue(F,B))}Q&&_notifyEvents(Rn,[F],me.QueueFull)}function _sendEventsForLatencyAndAbove(F,B,G){var W=_queueBatches(F,B,G);return J.sendQueuedRequests(B,G),W}function _hasEvents(){return ce>0}function _scheduleTimer(){if(Se>=0&&_queueBatches(Se,0,te)&&J.sendQueuedRequests(0,te),ae>0&&!he&&!oe){var F=de[ue][2];F>=0&&(he=_createTimer((function(){he=null,_sendEventsForLatencyAndAbove(Y.a.Immediate,0,1),_scheduleTimer()}),F))}var B=de[ue][1];!pe&&!re&&B>=0&&!oe&&(_hasEvents()?pe=_createTimer((function(){pe=null,_sendEventsForLatencyAndAbove(0===fe?Y.a.RealTime:Y.a.Normal,0,1),fe++,fe%=2,_scheduleTimer()}),B):fe=0)}function _createTimer(B,G){0===G&&ge&&(G=1);var W=1e3;return ge&&(W=sn.getMillisToBackoffForRetry(ge-1)),F._setTimeoutOverride(B,G*W)}function _clearScheduledTimer(){null!==pe&&(F._clearTimeoutOverride(pe),pe=null,fe=0)}function _releaseAllQueues(B,G){_clearScheduledTimer(),re&&(F._clearTimeoutOverride(re),re=null),oe||_sendEventsForLatencyAndAbove(Y.a.Normal,B,G)}function _clearQueues(){ve[Y.a.Immediate]={batches:[],iKeyMap:{}},ve[Y.a.RealTime]={batches:[],iKeyMap:{}},ve[Y.a.CostDeferred]={batches:[],iKeyMap:{}},ve[Y.a.Normal]={batches:[],iKeyMap:{}}}function _getEventBatch(F,B,G){var W=ve[B];W||(B=Y.a.Normal,W=ve[B]);var z=W.iKeyMap[F];return!z&&G&&(z=Wt.create(F),W.batches.push(z),W.iKeyMap[F]=z),z}function _performAutoFlush(B,G){J.canSendRequest()&&!ge&&($>0&&ce>$&&(G=!0),G&&null==re&&F.flush(B,null,20))}function _addEventToProperQueue(F,B){_e&&(F=Object(z.C)(F));var G=F.latency,W=_getEventBatch(F.iKey,G,!0);return!!W.addEvent(F)&&(G!==Y.a.Immediate?(ce++,B&&0===F.sendAttempt&&_performAutoFlush(!F.sync,ee>0&&W.count()>=ee)):ae++,!0)}function _dropEventWithLatencyOrLess(F,B,G,W){for(;G<=B;){var z=_getEventBatch(F,B,!0);if(z&&z.count()>0){var K=z.split(0,W),J=K.count();if(J>0)return G===Y.a.Immediate?ae-=J:ce-=J,_notifyBatchEvents(Rn,[K],me.QueueFull),!0}G++}return _resetQueueCounts(),!1}function _resetQueueCounts(){for(var F=0,B=0,_loop_1=function(G){var W=ve[G];W&&W.batches&&Object(z.a)(W.batches,(function(W){G===Y.a.Immediate?F+=W.count():B+=W.count()}))},G=Y.a.Normal;G<=Y.a.Immediate;G++)_loop_1(G);ce=B,ae=F}function _queueBatches(B,G,W){var K=!1,Q=0===G;return!Q||J.canSendRequest()?Object(X.b)(F.core,(function(){return"PostChannel._queueBatches"}),(function(){for(var F=[],G=Y.a.Immediate;G>=B;){var W=ve[G];W&&W.batches&&W.batches.length>0&&(Object(z.a)(W.batches,(function(B){J.addBatch(B)?K=K||B&&B.count()>0:F=F.concat(B.events()),G===Y.a.Immediate?ae-=B.count():ce-=B.count()})),W.batches=[],W.iKeyMap={}),G--}F.length>0&&_notifyEvents(Rn,F,me.KillSwitch),K&&Se>=B&&(Se=-1,te=0)}),(function(){return{latency:B,sendType:G,sendReason:W}}),!Q):(Se=Se>=0?Math.min(Se,B):B,te=Math.max(te,W)),K}function _flushImpl(F,B){_sendEventsForLatencyAndAbove(Y.a.Normal,0,B),_waitForIdleManager((function(){F&&F(),ie.length>0?re=_createTimer((function(){return _flushImpl(ie.shift(),B)}),0):(re=null,_hasEvents()&&_scheduleTimer())}))}function _waitForIdleManager(F){J.isCompletelyIdle()?F():re=_createTimer((function(){_waitForIdleManager(F)}),yn)}function _resetTransmitProfiles(){_clearScheduledTimer(),_initializeProfiles(),ue=yt,_scheduleTimer()}function _initializeProfiles(){(de={})[yt]=[2,1,0],de[St]=[6,3,0],de[_t]=[18,9,0]}function _requeueEvents(B,G){var W=[],K=Te;Ce&&(K=Ee),Object(z.a)(B,(function(B){B&&B.count()>0&&Object(z.a)(B.events(),(function(B){B&&(B.sync&&(B.latency=Y.a.Immediate,B.sync=!1),B.sendAttempt<K?(Object(ye.q)(B,F.identifier),_addEventToQueues(B,!1)):W.push(B))}))})),W.length>0&&_notifyEvents(Rn,W,me.NonRetryableStatus),Ce&&_releaseAllQueues(2,2)}function _callNotification(B,G){var W=F._notificationManager||{},z=W[B];if(z)try{z.apply(W,G)}catch(G){F.diagLog().throwInternal(Q.a.CRITICAL,Y.f.NotificationException,B+" notification failed: "+G)}}function _notifyEvents(F,B){for(var G=[],W=2;W<arguments.length;W++)G[W-2]=arguments[W];B&&B.length>0&&_callNotification(F,[B].concat(G))}function _notifyBatchEvents(F,B){for(var G=[],W=2;W<arguments.length;W++)G[W-2]=arguments[W];B&&B.length>0&&Object(z.a)(B,(function(B){B&&B.count()>0&&_callNotification(F,[B.events()].concat(G))}))}function _sendingEvent(F,B,G){F&&F.length>0&&_callNotification("eventsSendRequest",[B>=1e3&&B<=1999?B-1e3:0,!0!==G])}function _eventsSentEvent(F,B){_notifyBatchEvents("eventsSent",F,B),_scheduleTimer()}function _eventsDropped(F,B){_notifyBatchEvents(Rn,F,B>=8e3&&B<=8999?B-8e3:me.Unknown)}function _eventsResponseFail(F){_notifyBatchEvents(Rn,F,me.NonRetryableStatus),_scheduleTimer()}function _otherEvent(F,B){_notifyBatchEvents(Rn,F,me.Unknown),_scheduleTimer()}function _setAutoLimits(){ee=B&&B.disableAutoBatchFlushLimit?0:Math.max(Sn*(In+1),le/6)}_initializeProfiles(),_clearQueues(),_setAutoLimits(),J=new vn(Sn,In,An,{requeue:_requeueEvents,send:_sendingEvent,sent:_eventsSentEvent,drop:_eventsDropped,rspFail:_eventsResponseFail,oth:_otherEvent}),F._getDbgPlgTargets=function(){return[J]},F.initialize=function(K,Q,Y){Object(X.b)(Q,(function(){return"PostChannel:initialize"}),(function(){var X=Q;G.initialize(K,Q,Y),F.setInitialized(!1);var Z=F._getTelCtx();K.extensionConfig[F.identifier]=K.extensionConfig[F.identifier]||{},B=Z.getExtCfg(F.identifier),F._setTimeoutOverride=B.setTimeoutOverride?B.setTimeoutOverride:setTimeout.bind(bn),F._clearTimeoutOverride=B.clearTimeoutOverride?B.clearTimeoutOverride:clearTimeout.bind(bn),_e=!B.disableOptimizeObj&&Object(ye.j)(),_hookWParam(X),B.eventsLimitInMem>0&&(le=B.eventsLimitInMem),B.immediateEventLimit>0&&(se=B.immediateEventLimit),B.autoFlushEventsLimit>0&&($=B.autoFlushEventsLimit),B.disableXhrSync,Object(z.s)(B[On])&&(Te=B[On]),Object(z.s)(B[Mn])&&(Ee=B[Mn]),_setAutoLimits(),B.httpXHROverride&&B.httpXHROverride.sendPOST&&(W=B.httpXHROverride),Object(ye.m)(K.anonCookieName)&&J.addQueryStringParameter("anoncknm",K.anonCookieName),J.sendHook=B.payloadPreprocessor,J.sendListener=B.payloadListener;var ee=B.overrideEndpointUrl?B.overrideEndpointUrl:K.endpointUrl;F._notificationManager=K.extensionConfig.NotificationManager,J.initialize(ee,F.core,F,W,B);var te=K.disablePageUnloadEvents||[];Object(Ae.d)(_handleUnloadEvents,te),Object(Ae.b)(_handleUnloadEvents,te),Object(Ae.c)(_handleShowEvents,K.disablePageShowEvents),F.setInitialized(!0)}),(function(){return{coreConfig:K,core:Q,extensions:Y}}))},F.processTelemetry=function(G,W){Object(ye.q)(G,F.identifier);var z=(W=F._getTelCtx(W)).getExtCfg(F.identifier),K=!!B.disableTelemetry;z&&(K=K||!!z.disableTelemetry);var J=G;K||ne||(B[Pn]&&(J.iKey=B[Pn]),z&&z[Pn]&&(J.iKey=z[Pn]),_addEventToQueues(J,!0),Ce?_releaseAllQueues(2,2):_scheduleTimer()),F.processNext(J,W)},F.setEventQueueLimits=function(F,B){le=F>0?F:1e4,$=B>0?B:0,_setAutoLimits();var G=ce>F;if(!G&&ee>0)for(var W=Y.a.Normal;!G&&W<=Y.a.RealTime;W++){var K=ve[W];K&&K.batches&&Object(z.a)(K.batches,(function(F){F&&F.count()>=ee&&(G=!0)}))}_performAutoFlush(!0,G)},F.teardown=function(){_releaseAllQueues(2,2),ne=!0,J.teardown()},F.pause=function(){_clearScheduledTimer(),oe=!0,J.pause()},F.resume=function(){oe=!1,J.resume(),_scheduleTimer()},F.addResponseHandler=function(F){J._responseHandlers.push(F)},F._loadTransmitProfiles=function(F){_resetTransmitProfiles(),Object(z.z)(F,(function(F,B){var G=B.length;if(G>=2){var W=G>2?B[2]:0;if(B.splice(0,G-2),B[1]<0&&(B[0]=-1),B[1]>0&&B[0]>0){var z=B[0]/B[1];B[0]=Math.ceil(z)*B[1]}W>=0&&B[1]>=0&&W>B[1]&&(W=B[1]),B.push(W),de[F]=B}}))},F.flush=function(F,B,G){void 0===F&&(F=!0),oe||(_clearScheduledTimer(),G=G||1,F?(_queueBatches(Y.a.Normal,0,G),_resetQueueCounts(),null==re?re=_createTimer((function(){_flushImpl(B,G)}),0):ie.push(B)):(_sendEventsForLatencyAndAbove(Y.a.Normal,1,G),null!=B&&B()))},F.setMsaAuthTicket=function(F){J.addHeader(Ht,F)},F.hasEvents=_hasEvents,F._setTransmitProfile=function(F){ue!==F&&void 0!==de[F]&&(_clearScheduledTimer(),ue=F,_scheduleTimer())},F._backOffTransmission=function(){ge<En&&(ge++,_clearScheduledTimer(),_scheduleTimer())},F._clearBackOff=function(){ge&&(ge=0,_clearScheduledTimer(),_scheduleTimer())}})),G}return Object(W.b)(PostChannel,F),PostChannel}(te.a),Dn=wn,Nn=function(){function BaseContext(F){this._setOverride=function(B,G){F.setOverride(B,G)},this._getOverride=function(B){return F.getOverride(B)}}return BaseContext}(),Ln=function(F){function ApplicationContext(B,G){var W=F.call(this,B)||this,K=W;return K.setId=function(F){K._setOverride(Qe.id,F)},K.getId=function(){return K._getOverride(Qe.id)},K.setVer=function(F){K._setOverride(Qe.ver,F)},K.getVer=function(){return K._getOverride(Qe.ver)},K.setName=function(F){K._setOverride(Qe.appName,F)},K.getName=function(){return K._getOverride(Qe.appName)},K.setLocale=function(F){K._setOverride(Qe.locale,F)},K.getLocale=function(){return K._getOverride(Qe.locale)},K.setEnv=function(F){K._setOverride(Qe.env,F)},K.getEnv=function(){return K._getOverride(Qe.env)},K.setExpId=function(F){K._setOverride(Qe.expId,be.validateAppExpId(F))},K.getExpId=function(){return K._getOverride(Qe.expId)},G&&(Object(z.x)(G.env)||K.setEnv(G.env),Object(z.r)(G.expId)||K.setExpId(G.expId)),W}return Object(W.b)(ApplicationContext,F),ApplicationContext}(Nn),kn=function(F){function CloudContext(B){var G=F.call(this,B)||this,W=G;return W.setRole=function(F){W._setOverride(ot.role,F)},W.getRole=function(){return W._getOverride(ot.role)},W.setRoleInstance=function(F){W._setOverride(ot.roleInstance,F)},W.getRoleInstance=function(){return W._getOverride(ot.roleInstance)},W.setRoleVer=function(F){W._setOverride(ot.roleVer,F)},W.getRoleVer=function(){return W._getOverride(ot.roleVer)},G}return Object(W.b)(CloudContext,F),CloudContext}(Nn),Fn=function(F){function DataContext(B){var G=F.call(this,B)||this,W=G;return W.setProperty=function(F,B){W._setOverride(F,B)},W.getProperty=function(F){return W._getOverride(F)},G}return Object(W.b)(DataContext,F),DataContext}(Nn),xn=function(F){function DeviceContext(B){var G=F.call(this,B)||this,W=G;return W.setLocalId=function(F){W._setOverride(rt.localId,F)},W.getLocalId=function(){return W._getOverride(rt.localId)},W.setDeviceClass=function(F){W._setOverride(rt.deviceClass,F)},W.getDeviceClass=function(){return W._getOverride(rt.deviceClass)},W.setMake=function(F){W._setOverride(rt.make,F)},W.getMake=function(){return W._getOverride(rt.make)},W.setModel=function(F){W._setOverride(rt.model,F)},W.getModel=function(){return W._getOverride(rt.model)},G}return Object(W.b)(DeviceContext,F),DeviceContext}(Nn),Un=function(F){function LocContext(B){var G=F.call(this,B)||this,W=G;return W.setTz=function(F){W._setOverride(nt.tz,F)},W.getTz=function(){return W._getOverride(nt.tz)},G}return Object(W.b)(LocContext,F),LocContext}(Nn),jn=function(F){function OperatingSystemContext(B,G){var W=F.call(this,B)||this,z=W;if(z.setOsName=function(F){z._setOverride(Xe.osName,F)},z.getOsName=function(){return z._getOverride(Xe.osName)},z.setVer=function(F){z._setOverride(Xe.ver,F)},z.getVer=function(){return z._getOverride(Xe.ver)},G&&G.userAgent&&G.populateOperatingSystemInfo){var K=new Be(G);z.setOsName(K.name),z.setVer(K.ver)}return W}return Object(W.b)(OperatingSystemContext,F),OperatingSystemContext}(Nn);
/**
	* PostManager.ts
	* @author Abhilash Panwar (abpanwar); Hector Hernandez (hectorh); Nev Wylie (newylie)
	* @copyright Microsoft 2018-2020
	*/
/**
	* OverrideContainer.ts
	* @author Nev Wylie (newylie)
	* @copyright Microsoft 2019
	*/
function _getEventRoot(F,B){if(F)for(var G=0;G<B.length;G++){var W=B[G];Object(z.r)(F[W])&&(F[W]={}),F=F[W]}return F}function _setOverride(F,B,G){if(F&&B){var W=B.split("."),K=W[W.length-1];W.length>1&&(F=_getEventRoot(F,W.slice(0,-1))),Object(z.r)(G)?Object(z.x)(F[K])||delete F[K]:F[K]=G}}var Bn=function(){function OverrideContainer(F){var B=this,G=[];B.setOverride=function(F,B){F&&G.push({key:F,value:B})},B.hasOverride=function(F){var B=!1;return Object(z.a)(G,(function(G){G.key===F&&(B=!0)})),B},B.getOverride=function(F){var B;return Object(z.a)(G,(function(G){G.key===F&&(B=G.value)})),B},B.applyOverrides=function(B,W){if(G.length>0)try{var K=_getEventRoot(B,F);Object(z.a)(G,(function(F){_setOverride(K,F.key,F.value)}))}catch(F){}}}return OverrideContainer}(),Hn=function(F){function UserContext(B){var G=F.call(this,B)||this,W=G;return W.setLocalId=function(F){W._setOverride($e.localId,F)},W.getLocalId=function(){return W._getOverride($e.localId)},W.setLocale=function(F){W._setOverride($e.locale,F)},W.getLocale=function(){return W._getOverride($e.locale)},W.setId=function(F){W._setOverride($e.id,F)},W.getId=function(){return W._getOverride($e.id)},G}return Object(W.b)(UserContext,F),UserContext}(Nn),Vn=function(F){function WebContext(B,G){var W=F.call(this,B)||this,K=W;return K.setDomain=function(F){K._setOverride(Ye.domain,F)},K.getDomain=function(){return K._getOverride(Ye.domain)},K.setBrowser=function(F){K._setOverride(Ye.browser,F)},K.getBrowser=function(){return K._getOverride(Ye.browser)},K.setBrowserVer=function(F){K._setOverride(Ye.browserVer,F)},K.getBrowserVer=function(){return K._getOverride(Ye.browserVer)},K.setScreenRes=function(F){K._setOverride(Ye.screenRes,F)},K.getScreenRes=function(){return K._getOverride(Ye.screenRes)},K.setUserConsent=function(F){K._setOverride(Ye.userConsent,F)},K.getUserContext=function(){return K._getOverride(Ye.userConsent)},G&&(Object(z.x)(G.userConsented)||K.setUserConsent(G.userConsented)),W}return Object(W.b)(WebContext,F),WebContext}(Nn),Gn=(z.u,"ext"),Wn="data",qn=function(){function OverrideContext(F,B,G){var W=this,K={};function _getContainer(F){for(var B="",G=0;G<F.length;G++)B&&(B+="_"),B+=F[G];return Object(z.x)(K[B])&&(K[B]=new Bn(F)),B?K[B]:null}W.data=new Fn(_getContainer([Wn])),W.app=new Ln(_getContainer([Gn,st.AppExt]),B),W.user=new Hn(_getContainer([Gn,st.UserExt])),W.os=new jn(_getContainer([Gn,st.OSExt]),B),W.web=new Vn(_getContainer([Gn,st.WebExt]),B),W.device=new xn(_getContainer([Gn,st.DeviceExt])),W.loc=new Un(_getContainer([Gn,st.LocExt])),W.cloud=new kn(_getContainer([Gn,st.CloudExt])),W.applyOverrides=function(F,B){var G=Object(z.B)(K);G&&G.length>0&&Object(z.a)(G,(function(G){K[G].applyOverrides(F,B)}))}}return OverrideContext}(),zn=function(F){function OverridePropertiesPlugin(){var B=F.call(this)||this;B.identifier="OverridePropertiesPlugin",B.priority=4,B.version="3.1.11";var G=B,W=null;return G._baseInit=function(F,G,z){W=new qn(F,B._getTelCtx().getExtCfg(B.identifier),G)},G.setProperty=function(F,B){W&&W.data.setProperty(F,B)},G.getOverrideContext=function(){return W},B}return Object(W.b)(OverridePropertiesPlugin,F),OverridePropertiesPlugin.prototype.initialize=function(B,G,W){F.prototype.initialize.call(this,B,G,W),this._baseInit(B,G,W)},OverridePropertiesPlugin.prototype.processTelemetry=function(F,B){Object(ye.q)(F,this.identifier),B=this._getTelCtx(B);var G=this.getOverrideContext();G&&G.applyOverrides(F,B),this.processNext(F,B)},OverridePropertiesPlugin}(te.a);
/**
	* Application.ts
	* @author Nev Wylie (newylie)
	* @copyright Microsoft 2019
	*/
/**
	* ApplInsightsManager.ts
	* @author Nev Wylie (newylie)
	* @copyright Microsoft 2019
	* Main class containing all the APIs.
	*/
function _copyObjProperties(F,B){if(B)for(var G=Object(z.B)(B),W=0;W<G.length;W++){var K=G[W];Object(z.j)(F,K)||(F[K]=B[K])}}function _isChannel(F){return F.pause&&F.teardown&&F.flush}function _getEndpointUrl(F,B){var G=null;if(B){B.endpointUrl&&(G=B.endpointUrl);var W=(B.extensionConfig||{})[F]||{};W.overrideEndpointUrl&&(G=W.overrideEndpointUrl)}return G}var Kn=function(F){function ChildNotificationManager(B,G){var W=F.call(this)||this;return Object(K.a)(ChildNotificationManager,W,(function(F,W){function _getEvents(F){var G=[];return F&&Object(z.a)(F,(function(F){F.iKey===B&&G.push(F)})),G}function _hasListeners(B){if(F[B]&&F.listeners)for(var G=0;G<F.listeners.length;G++){var W=F.listeners[G];if(W&&W[B])return!0}return!1}var K={eventsSent:function(B){if(_hasListeners("eventsSent")){var G=_getEvents(B);G.length>0&&F.eventsSent(G)}},eventsDiscarded:function(B,G){if(_hasListeners("eventsDiscarded")){var W=_getEvents(B);W.length>0&&F.eventsDiscarded(W,G)}},eventsSendRequest:function(B,G){_hasListeners("eventsSendRequest")&&F.eventsSendRequest(B,G)},perfEvent:function(B){_hasListeners("perfEvent")&&F.perfEvent(B)}};G.addNotificationListener(K)})),W}return Object(W.b)(ChildNotificationManager,F),ChildNotificationManager}(J),Jn=function(){function ApplicationInsightsManager(){var F,B,G,W,Z,ee,te,ne={},ie=[],re=null,oe=[],ae=[],se={};Object(K.a)(ApplicationInsightsManager,this,(function(K){function _registerPlugin(F,B){if(void 0===B&&(B=null),F){(_isChannel(F)?ae:oe).push(F);var G=F.identifier;ne.extensionConfig[G]=ne.extensionConfig[G]||{},_copyObjProperties(ne.extensionConfig[G],B)}return F}function _initializeSharedChannels(){var F=ne.channels||[[]],B=new Dn,K=B.identifier,J=!1;G=null,W=null,Object(z.a)(F,(function(F){Object(z.a)(F,(function(F){Object(z.o)(F)||(_registerPlugin(F),F.identifier===K&&(J=!0,G=F))}))})),J||(F[0].push(B),G=_registerPlugin(B,ne.channelConfiguration)),ne.channels=F}function _initializeSharedExtensions(F){ie=[],B=_registerPlugin(new vt,ne.propertyConfiguration),ie.push(B),ne.extensions&&Object(z.a)(ne.extensions,(function(F){Object(z.o)(F)||_registerPlugin(F)})),F&&Object(z.a)(F,(function(F){F&&!Object(z.o)(F)&&ie.push(_registerPlugin(F))}))}function _initializeSharedInstance(B){if(!re){K.diagLog().throwInternal(Q.a.WARNING,Y.f.SDKNotInitialized,"The Shared Manager is not yet created, the returned shared instance will be overwritten");var z=_createMergedConfig(B||ne.instrumentationKey||"_not_defined_",{});F=new J,(re=new Qn(K,K.diagLog(),F)).initialize(z,ie),re.isInitialized()&&G&&(W=_getEndpointUrl(G.identifier,z))}}function _createMergedConfig(F,B){var G={};return G.instrumentationKey=F,G.channels=_createMergedChannels(B),_populateMergedConfigExtensions(G),_copyObjProperties(G,B),_copyObjProperties(G,ne),G}function _createMergedChannels(F){var B=[[]];return ne.channels&&Object(z.a)(ne.channels,(function(F,G){Object(z.o)(F)||(B[G]=B[G]||[],B[G]=B[G].concat(F))})),F&&F.channels&&Object(z.a)(F.channels,(function(F,G){Object(z.o)(F)||(B[G]=B[G]||[],B[G]=B[G].concat(F))})),B}function _populateMergedConfigExtensions(F){var B=[];ne.extensions&&ne.extensions.length>0&&(B=B.concat(ne.extensions)),F&&F.extensions&&F.extensions.length>0&&(B=B.concat(F.extensions)),B.length>0&&(F.extensions=B),F.extensionConfig=F.extensionConfig||{},_copyObjProperties(F.extensionConfig,ne.extensionConfig)}function _createMergedExtensions(F){var B=[];return ie&&ie.length>0&&(B=B.concat(ie)),F&&F.length>0&&(B=B.concat(F)),B}K.diagLog=function(){return Z||(Z=new $.a(ne)),Z},K.getCookieMgr=function(){return _initializeSharedInstance(),re.getCookieMgr()},K.setCookieMgr=function(F){return _initializeSharedInstance(),re.setCookieMgr(F)},K.getPerfMgr=function(){return te||ne&&ne.enablePerfMgr&&(te=new X.a(K.getNotifyMgr())),te},K.setPerfMgr=function(F){te=F},K.create=function(F,B){ne=F||{},re=null,_initializeSharedChannels(),_initializeSharedExtensions(B)},K.getInst=function(F){return(se[F]||{}).inst},K.newInst=function(B,z,J){var $=K.getInst(B);if($)return K.diagLog().throwInternal(Q.a.WARNING,Y.f.FailedToInitializeSDK,"Instance already exists for ["+B+"]"),$;if(_initializeSharedInstance(B),re.isInitialized()){var X=_createMergedConfig(B,z);if(G){var Z=_getEndpointUrl(G.identifier,X);W&&Z&&W!==Z&&K.diagLog().throwInternal(Q.a.WARNING,Y.f.ErrorProvidedChannels,"The endpointUrl mismatch, shared Url ["+W+"] is different from configured ["+Z+"] shared will be used!")}var ee=new Kn(B,F);$=new Qn(K,K.diagLog(),ee),se[B]={iKey:B,inst:$,notifyMgr:ee},$.setPerfMgr(K.getPerfMgr()),$.initialize(X,_createMergedExtensions(J)),$.isInitialized()||(K.diagLog().throwInternal(Q.a.WARNING,Y.f.SDKNotInitialized,"Failed to initialize new instance!"),$=null,delete se[B])}return $},K.getSharedPlugin=function(F){_initializeSharedInstance();var B=null;return Object(z.a)(oe,(function(G){F===G.identifier&&(B=G)})),B||Object(z.a)(ae,(function(G){F===G.identifier&&(B=G)})),B},K.getPropertyManager=function(){return _initializeSharedInstance(),B},K.getPostChannel=function(){return _initializeSharedInstance(),G},K.getNotifyMgr=function(){return ee||(ee=new J),ee}}))}return ApplicationInsightsManager}(),Qn=function(F){function ApplicationInsights(B,G,W){var z,J=F.call(this)||this,$=B;return Object(K.a)(ApplicationInsights,J,(function(F,B){F.getSharedPropertyManager=function(){return $.getPropertyManager()},F.getSharedPostChannel=function(){return $.getPostChannel()},F.getOverridePropertyManager=function(){return z},F.initialize=function(K,J){Object(X.b)(F,(function(){return"ApplicationInsights:initialize"}),(function(){var $=[z=new zn];J&&($=$.concat(J)),K.extensionConfig=K.extensionConfig||[];var X=K.propertyConfiguration||{};K.propertyConfiguration&&delete K.propertyConfiguration,K.extensionConfig[z.identifier]=X;try{B.initialize(K,$,G,W)}catch(B){F.logger.throwInternal(Q.a.CRITICAL,Y.f.FailedToInitializeSDK,"Failed to initialize SDK."+Object(Z.a)(B))}}),(function(){return{config:K,extensions:J}}))}})),J}return Object(W.b)(ApplicationInsights,F),ApplicationInsights}(Te),Yn=100},function(F,B,G){G.d(B,"a",(function(){return Q}));var W=G(35),z=G(0),K=G(54),J="getPlugin",Q=function(){function BaseTelemetryPlugin(){var F=this,B=!1,G=null,Q=null;F.core=null,F.diagLog=function(B){return F._getTelCtx(B).diagLog()},F.isInitialized=function(){return B},F.setInitialized=function(F){B=F},F.setNextPlugin=function(F){Q=F},F.processNext=function(F,B){B?B.processNext(F):Q&&Object(z.o)(Q.processTelemetry)&&Q.processTelemetry(F,null)},F._getTelCtx=function(B){void 0===B&&(B=null);var z=B;if(!z){var K=G||new W.a(null,{},F.core);z=Q&&Q[J]?K.createNew(null,Q[J]):K.createNew(null,Q)}return z},F._baseTelInit=function(Y,$,X,Z){Y&&Object(z.D)(Y,K.a,[],null,z.r),!Z&&$&&(Z=$.getProcessTelContext().getNext());var ee=Q;Q&&Q[J]&&(ee=Q[J]()),F.core=$,G=new W.a(Z,Y,$,ee),B=!0}}return BaseTelemetryPlugin.prototype.initialize=function(F,B,G,W){this._baseTelInit(F,B,G,W)},BaseTelemetryPlugin}()},function(F,B,G){G.d(B,"a",(function(){return J})),G.d(B,"b",(function(){return __extendsFn})),G.d(B,"c",(function(){return __spreadArrayFn}));var W=G(2),z=G(29),K=((Object(z.a)()||{}).Symbol,(Object(z.a)()||{}).Reflect,function(F){for(var B,G=1,z=arguments.length;G<z;G++)for(var K in B=arguments[G])W.f[W.i].call(B,K)&&(F[K]=B[K]);return F}),J=W.a||K,extendStaticsFn=function(F,B){return extendStaticsFn=W.b.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B[W.i](G)&&(F[G]=B[G])},extendStaticsFn(F,B)};function __extendsFn(F,B){function __(){this.constructor=F}typeof B!==W.h&&null!==B&&Object(z.c)("Class extends value "+String(B)+" is not a constructor or null"),extendStaticsFn(F,B),F[W.k]=null===B?Object(z.b)(B):(__[W.k]=B[W.k],new __)}function __spreadArrayFn(F,B){for(var G=0,W=B.length,z=F.length;G<W;G++,z++)F[z]=B[G];return F}},,function(F,B,G){G(86),G(60),G(124),G(112),G(88),G(114),G(63),G(165),G(166),G(167),F.exports=G(491)},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.compareMeetingData=B.getMeetingCodeFromMeetingUrl=B.sanitizeMeetingCode=B.isMeetingCodeUrl=void 0;var W=G(14);function isMeetingCodeUrl(F){var B=new URL(F).pathname.split("/");return B.pop(),"meet"===B.pop()}function sanitizeMeetingCode(F,B,G){if(!F)return G.info("sanitizeMeetingCode[".concat(B,"] empty / undefined meeting code parameter")),F;var W=F.replace(/\s/g,"");return W=W.replace(/-/g,""),G.info("sanitizeMeetingCode[".concat(B,"] meetingCode: ").concat(F,", sanitizedMeetingCode: ").concat(W)),W}function getMeetingCodeFromMeetingUrl(F,B,G){if(!F)return G.info("getMeetingCodeFromMeetingUrl[".concat(B,"] empty / undefined meeting Url parameter")),F;var z=new URL(F),K="";if(z&&z.pathname&&z.pathname.split("/").length>=2){var J=z.pathname.split("/");"meet"===J[J.length-2]&&(K=J[J.length-1])}return G.info("getMeetingCodeFromMeetingUrl[".concat(B,"] meetingUrl: ").concat(F,", meetingUrlObject: ").concat((0,W.safeJsonStringify)(z),", meetingCode: ").concat(K)),K}function compareMeetingData(F,B,G,W){var z=sanitizeMeetingCode(F&&F.meetingCode||"",G,W),K=sanitizeMeetingCode(B&&B.meetingCode||"",G,W),definedAndEqual=function(F,B){return!!F&&!!B&&F===B};if(definedAndEqual(z,K))return!0;var J=getMeetingCodeFromMeetingUrl(F&&F.meetingUrl||"",G,W);J=sanitizeMeetingCode(J,G,W);var Q=getMeetingCodeFromMeetingUrl(B&&B.meetingUrl||"",G,W);if(definedAndEqual(J,Q=sanitizeMeetingCode(Q,G,W)))return!0;if(definedAndEqual(J,K)||definedAndEqual(Q,z))return!0;if(F&&F.meetingUrl&&B&&B.meetingUrl){var Y=new URL(F.meetingUrl),$=new URL(B.meetingUrl);if(Y.hostname===$.hostname&&Y.pathname===$.pathname)return!0}return!1}B.isMeetingCodeUrl=isMeetingCodeUrl,B.sanitizeMeetingCode=sanitizeMeetingCode,B.getMeetingCodeFromMeetingUrl=getMeetingCodeFromMeetingUrl,B.compareMeetingData=compareMeetingData},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.EventSourceImpl=void 0;var W=G(8),z=G(26),K=function(){function EventSourceImpl(F){this.eventLogger=F,this.subscriptions=[]}return EventSourceImpl.prototype.subscribe=function(F){return new J(this.subscriptions,F)},EventSourceImpl.prototype.dispose=function(F){this.subscriptions=[]},EventSourceImpl.prototype.raiseEvents=function(F){var B=this;this.subscriptions.slice().forEach((function(G){try{void 0!==G.eventHandler&&F(G.eventHandler)}catch(F){B.eventLogger&&B.eventLogger.warn&&B.eventLogger.warn("Event handler exception caught!",(0,z.stringifyObject)(F))}}))},EventSourceImpl}();B.EventSourceImpl=K;var J=function(){function EventSubscriptionImpl(F,B){this.subscriptions=F,this.eventHandler=B,this.subscriptions.push(this)}return EventSubscriptionImpl.prototype.dispose=function(){var F=this;W.remove(this.subscriptions,(function(B){return B===F})),this.eventHandler=void 0},EventSubscriptionImpl}()},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var z=G(69),K=G(17),J=G(40),Q=G(13),Y=G(14),$=function(){function AsyncOperationHandler(F){var B=this;this._disposed=!1,this._logger=F.createChild("[ASYNC]"),this._endOperationDeferred=J.defer(),this._endOperationDeferred.promise.catch((function(F){B._logger.info("Rejected all operations")})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._deferredOperationsWithCauseId={},this._logger=F}return AsyncOperationHandler.prototype.registerPromise=function(F,B){var G=!1,always=function(){G=!0};B.then(always,always);var W=this._endOperationDeferred.promise.catch((function(B){if(!G)throw new Error("Operation ".concat(F," did not complete, reason:").concat(B))}));return Promise.race([W,B])},AsyncOperationHandler.prototype.updateOperationId=function(F,B){var G=this;this._logger.info("updateOperationId ".concat(F," ").concat(B)),Object.keys(this._deferredOperationsWithOperationId).forEach((function(W){W&&G._deferredOperationsWithOperationId[W]&&(G._logger.info("_deferredOperationsWithOperationId ".concat(W)),Object.keys(G._deferredOperationsWithOperationId[W]).forEach((function(z){z&&G._deferredOperationsWithOperationId[W][z]&&(G._logger.info("_deferredOperationsWithOperationId ".concat(z," ").concat(B)),z===F&&(G._deferredOperationsWithOperationId[W][B]=G._deferredOperationsWithOperationId[W][z],delete G._deferredOperationsWithOperationId[W][z]))})))})),Object.keys(this._deferredOperationsWithCauseId).forEach((function(W){W&&G._deferredOperationsWithCauseId[W]&&(G._logger.info("_deferredOperationsWithCauseId ".concat(W)),Object.keys(G._deferredOperationsWithCauseId[W]).forEach((function(z){z&&G._deferredOperationsWithCauseId[W][z]&&(G._logger.info("_deferredOperationsWithCauseId ".concat(z," ").concat(B)),z===F&&(G._deferredOperationsWithOperationId[W][B]=G._deferredOperationsWithOperationId[W][z],delete G._deferredOperationsWithOperationId[W][z]))})))}))},AsyncOperationHandler.prototype.createPendingOperation=function(F,B,G,W){var Y=this;void 0===G&&(G=(0,Q.generateCauseId)()),void 0===W&&(W={});var $=J.defer();$.promise.catch(z.noop);var X,Z=this.getOperationInfoForLogging(G,F,B);if(this._logger.info("".concat(Z,"[creating...]")),this._disposed)return this._logger.info("".concat(Z,"[create failed, call is disposed]")),Promise.reject(60);if(B){if(this._deferredOperationsWithOperationId[F]||(this._deferredOperationsWithOperationId[F]={}),this._deferredOperationsWithOperationId[F][B])return this._logger.warn("".concat(Z," Deferred operation with given name and operation id is already defined")),Promise.reject(new Error("Deferred operation with given name is already defined:".concat(F,"/").concat(K.scrubMriOrOmit(B))));this._deferredOperationsWithOperationId[F][B]={deferred:$,causeId:G},this._deferredOperationsWithCauseId[G]||(this._deferredOperationsWithCauseId[G]={}),this._deferredOperationsWithCauseId[G][B]={deferred:$,options:W,operationName:F},X=this._endOperationDeferred.promise.catch((function(G){if(Y.hasPendingOperationWithOperationId(F,B))throw new Error("Operation ".concat(F," ").concat(B," did not complete, reason:").concat(G))}))}else{if(this._deferredOperations[F])return this._logger.warn("".concat(Z," Deferred operation with given name is already defined")),Promise.reject(new Error("Deferred operation with given name is already defined:".concat(F)));this._deferredOperationsWithCauseId[G]||(this._deferredOperationsWithCauseId[G]={}),this._deferredOperationsWithCauseId[G][""]={deferred:$,options:W,operationName:F},this._deferredOperations[F]={deferred:$,causeId:G},X=this._endOperationDeferred.promise.catch((function(B){if(Y.hasPendingOperation(F))throw new Error("Operation ".concat(F," did not complete, reason:").concat(B))}))}return Promise.race([X,$.promise])},AsyncOperationHandler.prototype.hasPendingOperation=function(F){return!!this._deferredOperations[F]},AsyncOperationHandler.prototype.hasAtleastOneOfPendingOperation=function(F){var B,G;try{for(var z=W(F),K=z.next();!K.done;K=z.next()){var J=K.value;if(this.hasPendingOperation(J))return!0}}catch(F){B={error:F}}finally{try{K&&!K.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}return!1},AsyncOperationHandler.prototype.hasPendingOperationWithOperationId=function(F,B){return!(!B||!this._deferredOperationsWithOperationId[F])&&!!this._deferredOperationsWithOperationId[F][B]},AsyncOperationHandler.prototype.hasPendingOperationWithCauseId=function(F,B){var G=B||"";return this._deferredOperationsWithCauseId[F]&&!!this._deferredOperationsWithCauseId[F][G]},AsyncOperationHandler.prototype.getPendingOperationWithCauseId=function(F,B){return this.hasPendingOperationWithCauseId(F,B)?this._deferredOperationsWithCauseId[F][B].deferred.promise:Promise.reject("[".concat(F,"][").concat(B,"]: getPendingOperationWithCauseId for given causeId, operationId"))},AsyncOperationHandler.prototype.resolveOperationWithCauseId=function(F,B,G){var W=B||"";if(this.hasPendingOperationWithCauseId(F,W)){var z=this._deferredOperationsWithCauseId[F][W],K=z.deferred.promise;return z.deferred.resolve(G),this._logger.info("[".concat(F,"][").concat(W,"] resolved, result=").concat((0,Y.getPrintableObject)(G)||"void")),delete this._deferredOperationsWithCauseId[F][W],K}return Promise.reject("[".concat(F,"][").concat(W,"] resolveOperationWithCauseId failed, operation not found"))},AsyncOperationHandler.prototype.rejectOperationWithCauseId=function(F,B,G){var W=B||"";if(this.hasPendingOperationWithCauseId(F,W)){var K=this._deferredOperationsWithCauseId[F][W],J=K.deferred.promise;return J.catch(z.noop),K.deferred.reject(G),this._logger.info("[".concat(F,"][").concat(W,"] rejected, result=").concat((0,Y.getPrintableObject)(G)||"void")),delete this._deferredOperationsWithCauseId[F][W],J}return Promise.reject("[".concat(F,"][").concat(W,"] rejectOperationWithCauseId failed, operation not found"))},AsyncOperationHandler.prototype.maybeResolveOperationWithCauseId=function(F,B,G){var W=this;this.hasPendingOperationWithCauseId(F,B)?this.resolveOperationWithCauseId(F,B,G).catch((function(B){W._logger.info("".concat(F,"maybeResolveOperationWithCauseId failed, reason=").concat((0,Y.getPrintableObject)(B)))})):this._logger.info("".concat(F,"maybeResolveOperationWithCauseId ignored, operation does not exist"))},AsyncOperationHandler.prototype.maybeRejectOperationWithCauseId=function(F,B,G){this.hasPendingOperationWithCauseId(F,B)?this.rejectOperationWithCauseId(F,B,G).catch(z.noop):this._logger.info("".concat(F,"maybeRejectOperationWithCauseId ignored, operation does not exist"))},AsyncOperationHandler.prototype.getPendingOperation=function(F,B,G){return void 0===G&&(G=(0,Q.generateCauseId)()),!B&&this._deferredOperations[F]?this._deferredOperations[F].deferred.promise:B&&this._deferredOperationsWithOperationId[F]&&this._deferredOperationsWithOperationId[F][B]?this._deferredOperationsWithOperationId[F][B].deferred.promise:Promise.reject("".concat(this.getOperationInfoForLogging(G,F,B),": Deferred operation with given name and operation does not exist"))},AsyncOperationHandler.prototype.waitForOperation=function(F,B,G){return void 0===G&&(G=(0,Q.generateCauseId)()),B&&this.hasPendingOperationWithOperationId(F,B)?this._deferredOperationsWithOperationId[F][B].deferred.promise:this.hasPendingOperation(F)?this._deferredOperations[F].deferred.promise:Promise.reject("".concat(this.getOperationInfoForLogging(G,F,B),"failed=wait failed, operation not found"))},AsyncOperationHandler.prototype.resolveOperation=function(F,B,G,W,z){if(void 0===W&&(W=(0,Q.generateCauseId)()),void 0===z&&(z=!1),!F)return Promise.reject("Unable to resolve deferred operation with empty name");if(G&&this.hasPendingOperationWithOperationId(F,G)){var K=(J=this._deferredOperationsWithOperationId[F][G]).deferred.promise;return J.deferred.resolve(B),this._logger.info("".concat(this.getOperationInfoForLogging(J.causeId,F,G),"resolved, result=").concat((0,Y.getPrintableObject)(B)||"void")),z||delete this._deferredOperationsWithOperationId[F][G],K}if(this.hasPendingOperation(F)){var J=this._deferredOperations[F];K=this._deferredOperations[F].deferred.promise;return this._deferredOperations[F].deferred.resolve(B),this._logger.info("".concat(this.getOperationInfoForLogging(J.causeId,F,G),"resolved, result=").concat((0,Y.getPrintableObject)(B)||"void")),z||delete this._deferredOperations[F],K}return Promise.reject("".concat(this.getOperationInfoForLogging(W,F,G),"failed=resolve failed, operation not found"))},AsyncOperationHandler.prototype.rejectOperation=function(F,B,G,W){return void 0===W&&(W=(0,Q.generateCauseId)()),F?G&&this.hasPendingOperationWithOperationId(F,G)?((J=(K=this._deferredOperationsWithOperationId[F][G]).deferred.promise).catch(z.noop),K.deferred.reject(B),this._logger.info("".concat(this.getOperationInfoForLogging(K.causeId,F,G),"rejected, reason=").concat((0,Y.getPrintableObject)(B)||"void")),delete this._deferredOperationsWithOperationId[F][G],J):this.hasPendingOperation(F)?((J=(K=this._deferredOperations[F]).deferred.promise).catch(z.noop),K.deferred.reject(B),this._logger.info("".concat(this.getOperationInfoForLogging(K.causeId,F,G),"rejected, reason=").concat((0,Y.getPrintableObject)(B)||"void")),delete this._deferredOperations[F],J):Promise.reject("".concat(this.getOperationInfoForLogging(W,F,G),"failed=reject failed, operation not found")):Promise.reject("Unable to reject deferred operation with empty name");var K,J},AsyncOperationHandler.prototype.maybeResolveOperation=function(F,B,G,W){var z=this;void 0===W&&(W=(0,Q.generateCauseId)());var K=this.getOperationInfoForLogging(W,F,G);G&&this.hasPendingOperationWithOperationId(F,G)||this.hasPendingOperation(F)?this.resolveOperation(F,B,G,W).catch((function(F){z._logger.info("".concat(K,"maybeResolveOperation failed, reason=").concat((0,Y.getPrintableObject)(F)))})):this._logger.info("".concat(K,"maybeResolveOperation ignored, operation does not exist"))},AsyncOperationHandler.prototype.maybeResolveOperations=function(F,B,G,z){var K,J;void 0===z&&(z=(0,Q.generateCauseId)());try{for(var Y=W(F),$=Y.next();!$.done;$=Y.next()){var X=$.value;this.maybeResolveOperation(X,B,G,z)}}catch(F){K={error:F}}finally{try{$&&!$.done&&(J=Y.return)&&J.call(Y)}finally{if(K)throw K.error}}},AsyncOperationHandler.prototype.maybeRejectOperation=function(F,B,G,W){void 0===W&&(W=(0,Q.generateCauseId)());var K=this.getOperationInfoForLogging(W,F,G);G&&this.hasPendingOperationWithOperationId(F,G)||this.hasPendingOperation(F)?this.rejectOperation(F,B,G,W).catch(z.noop):this._logger.info("".concat(K,"maybeRejectOperation ignored, operation does not exist"))},AsyncOperationHandler.prototype.maybeRejectOperations=function(F,B,G,z){var K,J;void 0===z&&(z=(0,Q.generateCauseId)());try{for(var Y=W(F),$=Y.next();!$.done;$=Y.next()){var X=$.value;this.maybeRejectOperation(X,B,G,z)}}catch(F){K={error:F}}finally{try{$&&!$.done&&(J=Y.return)&&J.call(Y)}finally{if(K)throw K.error}}},AsyncOperationHandler.prototype.rejectPendingOperations=function(F,B){var G=this;void 0===B&&(B=(0,Q.generateCauseId)()),this._disposed=!0,this._logger.info("[".concat(B,"]rejectPendingOperations=").concat(F)),Object.keys(this._deferredOperations).forEach((function(W){G.maybeRejectOperation(W,F,void 0,B),G._deferredOperationsWithOperationId[B]&&delete G._deferredOperationsWithOperationId[B][""]})),Object.keys(this._deferredOperationsWithOperationId).forEach((function(W){Object.keys(G._deferredOperationsWithOperationId[W]).forEach((function(z){G.maybeRejectOperation(W,F,z,B),G._deferredOperationsWithOperationId[B]&&delete G._deferredOperationsWithOperationId[B][z]}))})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._endOperationDeferred.reject(F)},AsyncOperationHandler.prototype.maybeRejectPendingOperationsWithPredicate=function(F,B,G){var W=this;void 0===B&&(B=(0,Q.generateCauseId)()),this._logger.info("[".concat(B,"]rejectPendingOperationsWithPredicate")),Object.keys(this._deferredOperationsWithCauseId).forEach((function(B){Object.keys(W._deferredOperationsWithCauseId[B]).forEach((function(z){var K=W._deferredOperationsWithCauseId[B][z];K&&G(K.operationName,K.options)&&(W.maybeRejectOperation(K.operationName,F,z),W.maybeRejectOperationWithCauseId(B,z,F))}))}))},AsyncOperationHandler.prototype.getOperationInfoForLogging=function(F,B,G){void 0===G&&(G="");var W=G?"[".concat(K.scrubMriOrOmit(G),"]"):"";return"[".concat(F,"][").concat(B,"]").concat(W)},AsyncOperationHandler}();B.default=$},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(8),z=G(13),K=G(14),J=function(){function ChainedPromise(F){this._logger=F,this._promise=Promise.resolve(void 0),this._actionQueue=[]}return ChainedPromise.prototype.chainPromise=function(F,B,G,J){var Q=this;void 0===G&&(G=(0,z.generateCauseId)()),void 0===J&&(J=!1);var Y=Date.now(),$=(("function"==typeof B?B():B)||"").toString();this._actionQueue.push($),this._logger.info("[".concat(G,"][").concat($,"]enqueueing, queue=[").concat(this._actionQueue,"], reset=").concat(J));var removeFromQueue=function(){Q._actionQueue=Q._actionQueue.filter((function(F){return F!==$}))};return J&&this.reset(G),this._promise=this._promise.catch(W.noop).then((function(){var B=Date.now()-Y;return Q._logger.info("[".concat(G,"][").concat($,"]begin, delayMs=").concat(B)),F()})),this._promise.then((function(){removeFromQueue();var F=Date.now()-Y;Q._logger.info("[".concat(G,"][").concat($,"]success, durationMs=").concat(F))}),(function(F){removeFromQueue();var B=Date.now()-Y;Q._logger.warn("[".concat(G,"][").concat($,"]failed=").concat((0,K.safeJsonStringify)(F),", durationMs=").concat(B))})),this._promise},ChainedPromise.prototype.reset=function(F){this._logger.info("[".concat(F,"] resetting")),this._promise=Promise.resolve(void 0)},ChainedPromise}();B.default=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.build=B.Stopwatch=void 0;var W=function(){function Stopwatch(){var F=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){F.isPaused||(F.msElapsed+=(new Date).getTime()-F._startTime,F.isPaused=!0)},this.resume=function(){F.isPaused&&(F.isPaused=!1,F._startTime=(new Date).getTime())},this.duration=function(){return F.isPaused?F.msElapsed:F.msElapsed+(new Date).getTime()-F._startTime},this.durationInMinutes=function(){var B=F.duration()/6e4;return Math.ceil(B)},this.durationInSeconds=function(){var B=F.duration()/1e3;return Math.ceil(B)}}return Object.defineProperty(Stopwatch.prototype,"startTime",{get:function(){return this._startTime},enumerable:!1,configurable:!0}),Stopwatch}();function build(){return new W}B.Stopwatch=W,B.build=build},function(F,B,G){var W=G(182),z=G(37),K=G(93),J=G(73),Q=G(94),Y=Object.prototype.toString,$=0,X=4,Z=0,ee=1,te=2,ne=-1,ie=0,re=8;function Deflate(F){if(!(this instanceof Deflate))return new Deflate(F);this.options=z.assign({level:ne,method:re,chunkSize:16384,windowBits:15,memLevel:8,strategy:ie,to:""},F||{});var B=this.options;B.raw&&B.windowBits>0?B.windowBits=-B.windowBits:B.gzip&&B.windowBits>0&&B.windowBits<16&&(B.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;var G=W.deflateInit2(this.strm,B.level,B.method,B.windowBits,B.memLevel,B.strategy);if(G!==Z)throw new Error(J[G]);if(B.header&&W.deflateSetHeader(this.strm,B.header),B.dictionary){var $;if($="string"==typeof B.dictionary?K.string2buf(B.dictionary):"[object ArrayBuffer]"===Y.call(B.dictionary)?new Uint8Array(B.dictionary):B.dictionary,(G=W.deflateSetDictionary(this.strm,$))!==Z)throw new Error(J[G]);this._dict_set=!0}}function deflate(F,B){var G=new Deflate(B);if(G.push(F,!0),G.err)throw G.msg||J[G.err];return G.result}function deflateRaw(F,B){return(B=B||{}).raw=!0,deflate(F,B)}function gzip(F,B){return(B=B||{}).gzip=!0,deflate(F,B)}Deflate.prototype.push=function(F,B){var G,J,Q=this.strm,ne=this.options.chunkSize;if(this.ended)return!1;J=B===~~B?B:!0===B?X:$,"string"==typeof F?Q.input=K.string2buf(F):"[object ArrayBuffer]"===Y.call(F)?Q.input=new Uint8Array(F):Q.input=F,Q.next_in=0,Q.avail_in=Q.input.length;do{if(0===Q.avail_out&&(Q.output=new z.Buf8(ne),Q.next_out=0,Q.avail_out=ne),(G=W.deflate(Q,J))!==ee&&G!==Z)return this.onEnd(G),this.ended=!0,!1;0!==Q.avail_out&&(0!==Q.avail_in||J!==X&&J!==te)||("string"===this.options.to?this.onData(K.buf2binstring(z.shrinkBuf(Q.output,Q.next_out))):this.onData(z.shrinkBuf(Q.output,Q.next_out)))}while((Q.avail_in>0||0===Q.avail_out)&&G!==ee);return J===X?(G=W.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===Z):J!==te||(this.onEnd(Z),Q.avail_out=0,!0)},Deflate.prototype.onData=function(F){this.chunks.push(F)},Deflate.prototype.onEnd=function(F){F===Z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.msg=this.strm.msg},B.Deflate=Deflate,B.deflate=deflate,B.deflateRaw=deflateRaw,B.gzip=gzip},function(F,B,G){var W,z=G(37),K=G(183),J=G(91),Q=G(92),Y=G(73),$=0,X=1,Z=3,ee=4,te=5,ne=0,ie=1,re=-2,oe=-3,ae=-5,se=-1,ce=1,le=2,de=3,ue=4,pe=0,he=2,ge=8,fe=9,me=15,ve=8,ye=256+1+29,Se=30,_e=19,Ce=2*ye+1,Te=15,Ee=3,be=258,Ie=be+Ee+1,Ae=32,Re=42,Pe=69,Oe=73,Me=91,we=103,De=113,Ne=666,Le=1,ke=2,Fe=3,xe=4,Ue=3;function err(F,B){return F.msg=Y[B],B}function rank(F){return(F<<1)-(F>4?9:0)}function zero(F){for(var B=F.length;--B>=0;)F[B]=0}function flush_pending(F){var B=F.state,G=B.pending;G>F.avail_out&&(G=F.avail_out),0!==G&&(z.arraySet(F.output,B.pending_buf,B.pending_out,G,F.next_out),F.next_out+=G,B.pending_out+=G,F.total_out+=G,F.avail_out-=G,B.pending-=G,0===B.pending&&(B.pending_out=0))}function flush_block_only(F,B){K._tr_flush_block(F,F.block_start>=0?F.block_start:-1,F.strstart-F.block_start,B),F.block_start=F.strstart,flush_pending(F.strm)}function put_byte(F,B){F.pending_buf[F.pending++]=B}function putShortMSB(F,B){F.pending_buf[F.pending++]=B>>>8&255,F.pending_buf[F.pending++]=255&B}function read_buf(F,B,G,W){var K=F.avail_in;return K>W&&(K=W),0===K?0:(F.avail_in-=K,z.arraySet(B,F.input,F.next_in,K,G),1===F.state.wrap?F.adler=J(F.adler,B,K,G):2===F.state.wrap&&(F.adler=Q(F.adler,B,K,G)),F.next_in+=K,F.total_in+=K,K)}function longest_match(F,B){var G,W,z=F.max_chain_length,K=F.strstart,J=F.prev_length,Q=F.nice_match,Y=F.strstart>F.w_size-Ie?F.strstart-(F.w_size-Ie):0,$=F.window,X=F.w_mask,Z=F.prev,ee=F.strstart+be,te=$[K+J-1],ne=$[K+J];F.prev_length>=F.good_match&&(z>>=2),Q>F.lookahead&&(Q=F.lookahead);do{if($[(G=B)+J]===ne&&$[G+J-1]===te&&$[G]===$[K]&&$[++G]===$[K+1]){K+=2,G++;do{}while($[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&K<ee);if(W=be-(ee-K),K=ee-be,W>J){if(F.match_start=B,J=W,W>=Q)break;te=$[K+J-1],ne=$[K+J]}}}while((B=Z[B&X])>Y&&0!=--z);return J<=F.lookahead?J:F.lookahead}function fill_window(F){var B,G,W,K,J,Q=F.w_size;do{if(K=F.window_size-F.lookahead-F.strstart,F.strstart>=Q+(Q-Ie)){z.arraySet(F.window,F.window,Q,Q,0),F.match_start-=Q,F.strstart-=Q,F.block_start-=Q,B=G=F.hash_size;do{W=F.head[--B],F.head[B]=W>=Q?W-Q:0}while(--G);B=G=Q;do{W=F.prev[--B],F.prev[B]=W>=Q?W-Q:0}while(--G);K+=Q}if(0===F.strm.avail_in)break;if(G=read_buf(F.strm,F.window,F.strstart+F.lookahead,K),F.lookahead+=G,F.lookahead+F.insert>=Ee)for(J=F.strstart-F.insert,F.ins_h=F.window[J],F.ins_h=(F.ins_h<<F.hash_shift^F.window[J+1])&F.hash_mask;F.insert&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[J+Ee-1])&F.hash_mask,F.prev[J&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=J,J++,F.insert--,!(F.lookahead+F.insert<Ee)););}while(F.lookahead<Ie&&0!==F.strm.avail_in)}function deflate_stored(F,B){var G=65535;for(G>F.pending_buf_size-5&&(G=F.pending_buf_size-5);;){if(F.lookahead<=1){if(fill_window(F),0===F.lookahead&&B===$)return Le;if(0===F.lookahead)break}F.strstart+=F.lookahead,F.lookahead=0;var W=F.block_start+G;if((0===F.strstart||F.strstart>=W)&&(F.lookahead=F.strstart-W,F.strstart=W,flush_block_only(F,!1),0===F.strm.avail_out))return Le;if(F.strstart-F.block_start>=F.w_size-Ie&&(flush_block_only(F,!1),0===F.strm.avail_out))return Le}return F.insert=0,B===ee?(flush_block_only(F,!0),0===F.strm.avail_out?Fe:xe):(F.strstart>F.block_start&&(flush_block_only(F,!1),F.strm.avail_out),Le)}function deflate_fast(F,B){for(var G,W;;){if(F.lookahead<Ie){if(fill_window(F),F.lookahead<Ie&&B===$)return Le;if(0===F.lookahead)break}if(G=0,F.lookahead>=Ee&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Ee-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),0!==G&&F.strstart-G<=F.w_size-Ie&&(F.match_length=longest_match(F,G)),F.match_length>=Ee)if(W=K._tr_tally(F,F.strstart-F.match_start,F.match_length-Ee),F.lookahead-=F.match_length,F.match_length<=F.max_lazy_match&&F.lookahead>=Ee){F.match_length--;do{F.strstart++,F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Ee-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart}while(0!=--F.match_length);F.strstart++}else F.strstart+=F.match_length,F.match_length=0,F.ins_h=F.window[F.strstart],F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+1])&F.hash_mask;else W=K._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++;if(W&&(flush_block_only(F,!1),0===F.strm.avail_out))return Le}return F.insert=F.strstart<Ee-1?F.strstart:Ee-1,B===ee?(flush_block_only(F,!0),0===F.strm.avail_out?Fe:xe):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Le:ke}function deflate_slow(F,B){for(var G,W,z;;){if(F.lookahead<Ie){if(fill_window(F),F.lookahead<Ie&&B===$)return Le;if(0===F.lookahead)break}if(G=0,F.lookahead>=Ee&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Ee-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),F.prev_length=F.match_length,F.prev_match=F.match_start,F.match_length=Ee-1,0!==G&&F.prev_length<F.max_lazy_match&&F.strstart-G<=F.w_size-Ie&&(F.match_length=longest_match(F,G),F.match_length<=5&&(F.strategy===ce||F.match_length===Ee&&F.strstart-F.match_start>4096)&&(F.match_length=Ee-1)),F.prev_length>=Ee&&F.match_length<=F.prev_length){z=F.strstart+F.lookahead-Ee,W=K._tr_tally(F,F.strstart-1-F.prev_match,F.prev_length-Ee),F.lookahead-=F.prev_length-1,F.prev_length-=2;do{++F.strstart<=z&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Ee-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart)}while(0!=--F.prev_length);if(F.match_available=0,F.match_length=Ee-1,F.strstart++,W&&(flush_block_only(F,!1),0===F.strm.avail_out))return Le}else if(F.match_available){if((W=K._tr_tally(F,0,F.window[F.strstart-1]))&&flush_block_only(F,!1),F.strstart++,F.lookahead--,0===F.strm.avail_out)return Le}else F.match_available=1,F.strstart++,F.lookahead--}return F.match_available&&(W=K._tr_tally(F,0,F.window[F.strstart-1]),F.match_available=0),F.insert=F.strstart<Ee-1?F.strstart:Ee-1,B===ee?(flush_block_only(F,!0),0===F.strm.avail_out?Fe:xe):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Le:ke}function deflate_rle(F,B){for(var G,W,z,J,Q=F.window;;){if(F.lookahead<=be){if(fill_window(F),F.lookahead<=be&&B===$)return Le;if(0===F.lookahead)break}if(F.match_length=0,F.lookahead>=Ee&&F.strstart>0&&(W=Q[z=F.strstart-1])===Q[++z]&&W===Q[++z]&&W===Q[++z]){J=F.strstart+be;do{}while(W===Q[++z]&&W===Q[++z]&&W===Q[++z]&&W===Q[++z]&&W===Q[++z]&&W===Q[++z]&&W===Q[++z]&&W===Q[++z]&&z<J);F.match_length=be-(J-z),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=Ee?(G=K._tr_tally(F,1,F.match_length-Ee),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(G=K._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),G&&(flush_block_only(F,!1),0===F.strm.avail_out))return Le}return F.insert=0,B===ee?(flush_block_only(F,!0),0===F.strm.avail_out?Fe:xe):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Le:ke}function deflate_huff(F,B){for(var G;;){if(0===F.lookahead&&(fill_window(F),0===F.lookahead)){if(B===$)return Le;break}if(F.match_length=0,G=K._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,G&&(flush_block_only(F,!1),0===F.strm.avail_out))return Le}return F.insert=0,B===ee?(flush_block_only(F,!0),0===F.strm.avail_out?Fe:xe):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Le:ke}function Config(F,B,G,W,z){this.good_length=F,this.max_lazy=B,this.nice_length=G,this.max_chain=W,this.func=z}function lm_init(F){F.window_size=2*F.w_size,zero(F.head),F.max_lazy_match=W[F.level].max_lazy,F.good_match=W[F.level].good_length,F.nice_match=W[F.level].nice_length,F.max_chain_length=W[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=Ee-1,F.match_available=0,F.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ge,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new z.Buf16(2*Ce),this.dyn_dtree=new z.Buf16(2*(2*Se+1)),this.bl_tree=new z.Buf16(2*(2*_e+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new z.Buf16(Te+1),this.heap=new z.Buf16(2*ye+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new z.Buf16(2*ye+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(F){var B;return F&&F.state?(F.total_in=F.total_out=0,F.data_type=he,(B=F.state).pending=0,B.pending_out=0,B.wrap<0&&(B.wrap=-B.wrap),B.status=B.wrap?Re:De,F.adler=2===B.wrap?0:1,B.last_flush=$,K._tr_init(B),ne):err(F,re)}function deflateReset(F){var B=deflateResetKeep(F);return B===ne&&lm_init(F.state),B}function deflateSetHeader(F,B){return F&&F.state?2!==F.state.wrap?re:(F.state.gzhead=B,ne):re}function deflateInit2(F,B,G,W,K,J){if(!F)return re;var Q=1;if(B===se&&(B=6),W<0?(Q=0,W=-W):W>15&&(Q=2,W-=16),K<1||K>fe||G!==ge||W<8||W>15||B<0||B>9||J<0||J>ue)return err(F,re);8===W&&(W=9);var Y=new DeflateState;return F.state=Y,Y.strm=F,Y.wrap=Q,Y.gzhead=null,Y.w_bits=W,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=K+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+Ee-1)/Ee),Y.window=new z.Buf8(2*Y.w_size),Y.head=new z.Buf16(Y.hash_size),Y.prev=new z.Buf16(Y.w_size),Y.lit_bufsize=1<<K+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new z.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=B,Y.strategy=J,Y.method=G,deflateReset(F)}function deflateInit(F,B){return deflateInit2(F,B,ge,me,ve,pe)}function deflate(F,B){var G,z,J,Y;if(!F||!F.state||B>te||B<0)return F?err(F,re):re;if(z=F.state,!F.output||!F.input&&0!==F.avail_in||z.status===Ne&&B!==ee)return err(F,0===F.avail_out?ae:re);if(z.strm=F,G=z.last_flush,z.last_flush=B,z.status===Re)if(2===z.wrap)F.adler=0,put_byte(z,31),put_byte(z,139),put_byte(z,8),z.gzhead?(put_byte(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),put_byte(z,255&z.gzhead.time),put_byte(z,z.gzhead.time>>8&255),put_byte(z,z.gzhead.time>>16&255),put_byte(z,z.gzhead.time>>24&255),put_byte(z,9===z.level?2:z.strategy>=le||z.level<2?4:0),put_byte(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(put_byte(z,255&z.gzhead.extra.length),put_byte(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(F.adler=Q(F.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=Pe):(put_byte(z,0),put_byte(z,0),put_byte(z,0),put_byte(z,0),put_byte(z,0),put_byte(z,9===z.level?2:z.strategy>=le||z.level<2?4:0),put_byte(z,Ue),z.status=De);else{var oe=ge+(z.w_bits-8<<4)<<8;oe|=(z.strategy>=le||z.level<2?0:z.level<6?1:6===z.level?2:3)<<6,0!==z.strstart&&(oe|=Ae),oe+=31-oe%31,z.status=De,putShortMSB(z,oe),0!==z.strstart&&(putShortMSB(z,F.adler>>>16),putShortMSB(z,65535&F.adler)),F.adler=1}if(z.status===Pe)if(z.gzhead.extra){for(J=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>J&&(F.adler=Q(F.adler,z.pending_buf,z.pending-J,J)),flush_pending(F),J=z.pending,z.pending!==z.pending_buf_size));)put_byte(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>J&&(F.adler=Q(F.adler,z.pending_buf,z.pending-J,J)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=Oe)}else z.status=Oe;if(z.status===Oe)if(z.gzhead.name){J=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>J&&(F.adler=Q(F.adler,z.pending_buf,z.pending-J,J)),flush_pending(F),J=z.pending,z.pending===z.pending_buf_size)){Y=1;break}Y=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,put_byte(z,Y)}while(0!==Y);z.gzhead.hcrc&&z.pending>J&&(F.adler=Q(F.adler,z.pending_buf,z.pending-J,J)),0===Y&&(z.gzindex=0,z.status=Me)}else z.status=Me;if(z.status===Me)if(z.gzhead.comment){J=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>J&&(F.adler=Q(F.adler,z.pending_buf,z.pending-J,J)),flush_pending(F),J=z.pending,z.pending===z.pending_buf_size)){Y=1;break}Y=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,put_byte(z,Y)}while(0!==Y);z.gzhead.hcrc&&z.pending>J&&(F.adler=Q(F.adler,z.pending_buf,z.pending-J,J)),0===Y&&(z.status=we)}else z.status=we;if(z.status===we&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&flush_pending(F),z.pending+2<=z.pending_buf_size&&(put_byte(z,255&F.adler),put_byte(z,F.adler>>8&255),F.adler=0,z.status=De)):z.status=De),0!==z.pending){if(flush_pending(F),0===F.avail_out)return z.last_flush=-1,ne}else if(0===F.avail_in&&rank(B)<=rank(G)&&B!==ee)return err(F,ae);if(z.status===Ne&&0!==F.avail_in)return err(F,ae);if(0!==F.avail_in||0!==z.lookahead||B!==$&&z.status!==Ne){var se=z.strategy===le?deflate_huff(z,B):z.strategy===de?deflate_rle(z,B):W[z.level].func(z,B);if(se!==Fe&&se!==xe||(z.status=Ne),se===Le||se===Fe)return 0===F.avail_out&&(z.last_flush=-1),ne;if(se===ke&&(B===X?K._tr_align(z):B!==te&&(K._tr_stored_block(z,0,0,!1),B===Z&&(zero(z.head),0===z.lookahead&&(z.strstart=0,z.block_start=0,z.insert=0))),flush_pending(F),0===F.avail_out))return z.last_flush=-1,ne}return B!==ee?ne:z.wrap<=0?ie:(2===z.wrap?(put_byte(z,255&F.adler),put_byte(z,F.adler>>8&255),put_byte(z,F.adler>>16&255),put_byte(z,F.adler>>24&255),put_byte(z,255&F.total_in),put_byte(z,F.total_in>>8&255),put_byte(z,F.total_in>>16&255),put_byte(z,F.total_in>>24&255)):(putShortMSB(z,F.adler>>>16),putShortMSB(z,65535&F.adler)),flush_pending(F),z.wrap>0&&(z.wrap=-z.wrap),0!==z.pending?ne:ie)}function deflateEnd(F){var B;return F&&F.state?(B=F.state.status)!==Re&&B!==Pe&&B!==Oe&&B!==Me&&B!==we&&B!==De&&B!==Ne?err(F,re):(F.state=null,B===De?err(F,oe):ne):re}function deflateSetDictionary(F,B){var G,W,K,Q,Y,$,X,Z,ee=B.length;if(!F||!F.state)return re;if(2===(Q=(G=F.state).wrap)||1===Q&&G.status!==Re||G.lookahead)return re;for(1===Q&&(F.adler=J(F.adler,B,ee,0)),G.wrap=0,ee>=G.w_size&&(0===Q&&(zero(G.head),G.strstart=0,G.block_start=0,G.insert=0),Z=new z.Buf8(G.w_size),z.arraySet(Z,B,ee-G.w_size,G.w_size,0),B=Z,ee=G.w_size),Y=F.avail_in,$=F.next_in,X=F.input,F.avail_in=ee,F.next_in=0,F.input=B,fill_window(G);G.lookahead>=Ee;){W=G.strstart,K=G.lookahead-(Ee-1);do{G.ins_h=(G.ins_h<<G.hash_shift^G.window[W+Ee-1])&G.hash_mask,G.prev[W&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=W,W++}while(--K);G.strstart=W,G.lookahead=Ee-1,fill_window(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=Ee-1,G.match_available=0,F.next_in=$,F.input=X,F.avail_in=Y,G.wrap=Q,ne}W=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],B.deflateInit=deflateInit,B.deflateInit2=deflateInit2,B.deflateReset=deflateReset,B.deflateResetKeep=deflateResetKeep,B.deflateSetHeader=deflateSetHeader,B.deflate=deflate,B.deflateEnd=deflateEnd,B.deflateSetDictionary=deflateSetDictionary,B.deflateInfo="pako deflate (from Nodeca project)"},function(F,B,G){var W=G(37),z=4,K=0,J=1,Q=2;function zero(F){for(var B=F.length;--B>=0;)F[B]=0}var Y=0,$=1,X=2,Z=3,ee=258,te=29,ne=256,ie=ne+1+te,re=30,oe=19,ae=2*ie+1,se=15,ce=16,le=7,de=256,ue=16,pe=17,he=18,ge=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],fe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],me=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ye=512,Se=new Array(2*(ie+2));zero(Se);var _e=new Array(2*re);zero(_e);var Ce=new Array(ye);zero(Ce);var Te=new Array(ee-Z+1);zero(Te);var Ee=new Array(te);zero(Ee);var be,Ie,Ae,Re=new Array(re);function StaticTreeDesc(F,B,G,W,z){this.static_tree=F,this.extra_bits=B,this.extra_base=G,this.elems=W,this.max_length=z,this.has_stree=F&&F.length}function TreeDesc(F,B){this.dyn_tree=F,this.max_code=0,this.stat_desc=B}function d_code(F){return F<256?Ce[F]:Ce[256+(F>>>7)]}function put_short(F,B){F.pending_buf[F.pending++]=255&B,F.pending_buf[F.pending++]=B>>>8&255}function send_bits(F,B,G){F.bi_valid>ce-G?(F.bi_buf|=B<<F.bi_valid&65535,put_short(F,F.bi_buf),F.bi_buf=B>>ce-F.bi_valid,F.bi_valid+=G-ce):(F.bi_buf|=B<<F.bi_valid&65535,F.bi_valid+=G)}function send_code(F,B,G){send_bits(F,G[2*B],G[2*B+1])}function bi_reverse(F,B){var G=0;do{G|=1&F,F>>>=1,G<<=1}while(--B>0);return G>>>1}function bi_flush(F){16===F.bi_valid?(put_short(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):F.bi_valid>=8&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)}function gen_bitlen(F,B){var G,W,z,K,J,Q,Y=B.dyn_tree,$=B.max_code,X=B.stat_desc.static_tree,Z=B.stat_desc.has_stree,ee=B.stat_desc.extra_bits,te=B.stat_desc.extra_base,ne=B.stat_desc.max_length,ie=0;for(K=0;K<=se;K++)F.bl_count[K]=0;for(Y[2*F.heap[F.heap_max]+1]=0,G=F.heap_max+1;G<ae;G++)(K=Y[2*Y[2*(W=F.heap[G])+1]+1]+1)>ne&&(K=ne,ie++),Y[2*W+1]=K,W>$||(F.bl_count[K]++,J=0,W>=te&&(J=ee[W-te]),Q=Y[2*W],F.opt_len+=Q*(K+J),Z&&(F.static_len+=Q*(X[2*W+1]+J)));if(0!==ie){do{for(K=ne-1;0===F.bl_count[K];)K--;F.bl_count[K]--,F.bl_count[K+1]+=2,F.bl_count[ne]--,ie-=2}while(ie>0);for(K=ne;0!==K;K--)for(W=F.bl_count[K];0!==W;)(z=F.heap[--G])>$||(Y[2*z+1]!==K&&(F.opt_len+=(K-Y[2*z+1])*Y[2*z],Y[2*z+1]=K),W--)}}function gen_codes(F,B,G){var W,z,K=new Array(se+1),J=0;for(W=1;W<=se;W++)K[W]=J=J+G[W-1]<<1;for(z=0;z<=B;z++){var Q=F[2*z+1];0!==Q&&(F[2*z]=bi_reverse(K[Q]++,Q))}}function tr_static_init(){var F,B,G,W,z,K=new Array(se+1);for(G=0,W=0;W<te-1;W++)for(Ee[W]=G,F=0;F<1<<ge[W];F++)Te[G++]=W;for(Te[G-1]=W,z=0,W=0;W<16;W++)for(Re[W]=z,F=0;F<1<<fe[W];F++)Ce[z++]=W;for(z>>=7;W<re;W++)for(Re[W]=z<<7,F=0;F<1<<fe[W]-7;F++)Ce[256+z++]=W;for(B=0;B<=se;B++)K[B]=0;for(F=0;F<=143;)Se[2*F+1]=8,F++,K[8]++;for(;F<=255;)Se[2*F+1]=9,F++,K[9]++;for(;F<=279;)Se[2*F+1]=7,F++,K[7]++;for(;F<=287;)Se[2*F+1]=8,F++,K[8]++;for(gen_codes(Se,ie+1,K),F=0;F<re;F++)_e[2*F+1]=5,_e[2*F]=bi_reverse(F,5);be=new StaticTreeDesc(Se,ge,ne+1,ie,se),Ie=new StaticTreeDesc(_e,fe,0,re,se),Ae=new StaticTreeDesc(new Array(0),me,0,oe,le)}function init_block(F){var B;for(B=0;B<ie;B++)F.dyn_ltree[2*B]=0;for(B=0;B<re;B++)F.dyn_dtree[2*B]=0;for(B=0;B<oe;B++)F.bl_tree[2*B]=0;F.dyn_ltree[2*de]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function bi_windup(F){F.bi_valid>8?put_short(F,F.bi_buf):F.bi_valid>0&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function copy_block(F,B,G,z){bi_windup(F),z&&(put_short(F,G),put_short(F,~G)),W.arraySet(F.pending_buf,F.window,B,G,F.pending),F.pending+=G}function smaller(F,B,G,W){var z=2*B,K=2*G;return F[z]<F[K]||F[z]===F[K]&&W[B]<=W[G]}function pqdownheap(F,B,G){for(var W=F.heap[G],z=G<<1;z<=F.heap_len&&(z<F.heap_len&&smaller(B,F.heap[z+1],F.heap[z],F.depth)&&z++,!smaller(B,W,F.heap[z],F.depth));)F.heap[G]=F.heap[z],G=z,z<<=1;F.heap[G]=W}function compress_block(F,B,G){var W,z,K,J,Q=0;if(0!==F.last_lit)do{W=F.pending_buf[F.d_buf+2*Q]<<8|F.pending_buf[F.d_buf+2*Q+1],z=F.pending_buf[F.l_buf+Q],Q++,0===W?send_code(F,z,B):(send_code(F,(K=Te[z])+ne+1,B),0!==(J=ge[K])&&send_bits(F,z-=Ee[K],J),send_code(F,K=d_code(--W),G),0!==(J=fe[K])&&send_bits(F,W-=Re[K],J))}while(Q<F.last_lit);send_code(F,de,B)}function build_tree(F,B){var G,W,z,K=B.dyn_tree,J=B.stat_desc.static_tree,Q=B.stat_desc.has_stree,Y=B.stat_desc.elems,$=-1;for(F.heap_len=0,F.heap_max=ae,G=0;G<Y;G++)0!==K[2*G]?(F.heap[++F.heap_len]=$=G,F.depth[G]=0):K[2*G+1]=0;for(;F.heap_len<2;)K[2*(z=F.heap[++F.heap_len]=$<2?++$:0)]=1,F.depth[z]=0,F.opt_len--,Q&&(F.static_len-=J[2*z+1]);for(B.max_code=$,G=F.heap_len>>1;G>=1;G--)pqdownheap(F,K,G);z=Y;do{G=F.heap[1],F.heap[1]=F.heap[F.heap_len--],pqdownheap(F,K,1),W=F.heap[1],F.heap[--F.heap_max]=G,F.heap[--F.heap_max]=W,K[2*z]=K[2*G]+K[2*W],F.depth[z]=(F.depth[G]>=F.depth[W]?F.depth[G]:F.depth[W])+1,K[2*G+1]=K[2*W+1]=z,F.heap[1]=z++,pqdownheap(F,K,1)}while(F.heap_len>=2);F.heap[--F.heap_max]=F.heap[1],gen_bitlen(F,B),gen_codes(K,$,F.bl_count)}function scan_tree(F,B,G){var W,z,K=-1,J=B[1],Q=0,Y=7,$=4;for(0===J&&(Y=138,$=3),B[2*(G+1)+1]=65535,W=0;W<=G;W++)z=J,J=B[2*(W+1)+1],++Q<Y&&z===J||(Q<$?F.bl_tree[2*z]+=Q:0!==z?(z!==K&&F.bl_tree[2*z]++,F.bl_tree[2*ue]++):Q<=10?F.bl_tree[2*pe]++:F.bl_tree[2*he]++,Q=0,K=z,0===J?(Y=138,$=3):z===J?(Y=6,$=3):(Y=7,$=4))}function send_tree(F,B,G){var W,z,K=-1,J=B[1],Q=0,Y=7,$=4;for(0===J&&(Y=138,$=3),W=0;W<=G;W++)if(z=J,J=B[2*(W+1)+1],!(++Q<Y&&z===J)){if(Q<$)do{send_code(F,z,F.bl_tree)}while(0!=--Q);else 0!==z?(z!==K&&(send_code(F,z,F.bl_tree),Q--),send_code(F,ue,F.bl_tree),send_bits(F,Q-3,2)):Q<=10?(send_code(F,pe,F.bl_tree),send_bits(F,Q-3,3)):(send_code(F,he,F.bl_tree),send_bits(F,Q-11,7));Q=0,K=z,0===J?(Y=138,$=3):z===J?(Y=6,$=3):(Y=7,$=4)}}function build_bl_tree(F){var B;for(scan_tree(F,F.dyn_ltree,F.l_desc.max_code),scan_tree(F,F.dyn_dtree,F.d_desc.max_code),build_tree(F,F.bl_desc),B=oe-1;B>=3&&0===F.bl_tree[2*ve[B]+1];B--);return F.opt_len+=3*(B+1)+5+5+4,B}function send_all_trees(F,B,G,W){var z;for(send_bits(F,B-257,5),send_bits(F,G-1,5),send_bits(F,W-4,4),z=0;z<W;z++)send_bits(F,F.bl_tree[2*ve[z]+1],3);send_tree(F,F.dyn_ltree,B-1),send_tree(F,F.dyn_dtree,G-1)}function detect_data_type(F){var B,G=4093624447;for(B=0;B<=31;B++,G>>>=1)if(1&G&&0!==F.dyn_ltree[2*B])return K;if(0!==F.dyn_ltree[18]||0!==F.dyn_ltree[20]||0!==F.dyn_ltree[26])return J;for(B=32;B<ne;B++)if(0!==F.dyn_ltree[2*B])return J;return K}zero(Re);var Pe=!1;function _tr_init(F){Pe||(tr_static_init(),Pe=!0),F.l_desc=new TreeDesc(F.dyn_ltree,be),F.d_desc=new TreeDesc(F.dyn_dtree,Ie),F.bl_desc=new TreeDesc(F.bl_tree,Ae),F.bi_buf=0,F.bi_valid=0,init_block(F)}function _tr_stored_block(F,B,G,W){send_bits(F,(Y<<1)+(W?1:0),3),copy_block(F,B,G,!0)}function _tr_align(F){send_bits(F,$<<1,3),send_code(F,de,Se),bi_flush(F)}function _tr_flush_block(F,B,G,W){var K,J,Y=0;F.level>0?(F.strm.data_type===Q&&(F.strm.data_type=detect_data_type(F)),build_tree(F,F.l_desc),build_tree(F,F.d_desc),Y=build_bl_tree(F),K=F.opt_len+3+7>>>3,(J=F.static_len+3+7>>>3)<=K&&(K=J)):K=J=G+5,G+4<=K&&-1!==B?_tr_stored_block(F,B,G,W):F.strategy===z||J===K?(send_bits(F,($<<1)+(W?1:0),3),compress_block(F,Se,_e)):(send_bits(F,(X<<1)+(W?1:0),3),send_all_trees(F,F.l_desc.max_code+1,F.d_desc.max_code+1,Y+1),compress_block(F,F.dyn_ltree,F.dyn_dtree)),init_block(F),W&&bi_windup(F)}function _tr_tally(F,B,G){return F.pending_buf[F.d_buf+2*F.last_lit]=B>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&B,F.pending_buf[F.l_buf+F.last_lit]=255&G,F.last_lit++,0===B?F.dyn_ltree[2*G]++:(F.matches++,B--,F.dyn_ltree[2*(Te[G]+ne+1)]++,F.dyn_dtree[2*d_code(B)]++),F.last_lit===F.lit_bufsize-1}B._tr_init=_tr_init,B._tr_stored_block=_tr_stored_block,B._tr_flush_block=_tr_flush_block,B._tr_tally=_tr_tally,B._tr_align=_tr_align},function(F,B,G){var W=G(185),z=G(37),K=G(93),J=G(95),Q=G(73),Y=G(94),$=G(188),X=Object.prototype.toString;function Inflate(F){if(!(this instanceof Inflate))return new Inflate(F);this.options=z.assign({chunkSize:16384,windowBits:0,to:""},F||{});var B=this.options;B.raw&&B.windowBits>=0&&B.windowBits<16&&(B.windowBits=-B.windowBits,0===B.windowBits&&(B.windowBits=-15)),!(B.windowBits>=0&&B.windowBits<16)||F&&F.windowBits||(B.windowBits+=32),B.windowBits>15&&B.windowBits<48&&0==(15&B.windowBits)&&(B.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;var G=W.inflateInit2(this.strm,B.windowBits);if(G!==J.Z_OK)throw new Error(Q[G]);if(this.header=new $,W.inflateGetHeader(this.strm,this.header),B.dictionary&&("string"==typeof B.dictionary?B.dictionary=K.string2buf(B.dictionary):"[object ArrayBuffer]"===X.call(B.dictionary)&&(B.dictionary=new Uint8Array(B.dictionary)),B.raw&&(G=W.inflateSetDictionary(this.strm,B.dictionary))!==J.Z_OK))throw new Error(Q[G])}function inflate(F,B){var G=new Inflate(B);if(G.push(F,!0),G.err)throw G.msg||Q[G.err];return G.result}function inflateRaw(F,B){return(B=B||{}).raw=!0,inflate(F,B)}Inflate.prototype.push=function(F,B){var G,Q,Y,$,Z,ee=this.strm,te=this.options.chunkSize,ne=this.options.dictionary,ie=!1;if(this.ended)return!1;Q=B===~~B?B:!0===B?J.Z_FINISH:J.Z_NO_FLUSH,"string"==typeof F?ee.input=K.binstring2buf(F):"[object ArrayBuffer]"===X.call(F)?ee.input=new Uint8Array(F):ee.input=F,ee.next_in=0,ee.avail_in=ee.input.length;do{if(0===ee.avail_out&&(ee.output=new z.Buf8(te),ee.next_out=0,ee.avail_out=te),(G=W.inflate(ee,J.Z_NO_FLUSH))===J.Z_NEED_DICT&&ne&&(G=W.inflateSetDictionary(this.strm,ne)),G===J.Z_BUF_ERROR&&!0===ie&&(G=J.Z_OK,ie=!1),G!==J.Z_STREAM_END&&G!==J.Z_OK)return this.onEnd(G),this.ended=!0,!1;ee.next_out&&(0!==ee.avail_out&&G!==J.Z_STREAM_END&&(0!==ee.avail_in||Q!==J.Z_FINISH&&Q!==J.Z_SYNC_FLUSH)||("string"===this.options.to?(Y=K.utf8border(ee.output,ee.next_out),$=ee.next_out-Y,Z=K.buf2string(ee.output,Y),ee.next_out=$,ee.avail_out=te-$,$&&z.arraySet(ee.output,ee.output,Y,$,0),this.onData(Z)):this.onData(z.shrinkBuf(ee.output,ee.next_out)))),0===ee.avail_in&&0===ee.avail_out&&(ie=!0)}while((ee.avail_in>0||0===ee.avail_out)&&G!==J.Z_STREAM_END);return G===J.Z_STREAM_END&&(Q=J.Z_FINISH),Q===J.Z_FINISH?(G=W.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===J.Z_OK):Q!==J.Z_SYNC_FLUSH||(this.onEnd(J.Z_OK),ee.avail_out=0,!0)},Inflate.prototype.onData=function(F){this.chunks.push(F)},Inflate.prototype.onEnd=function(F){F===J.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.msg=this.strm.msg},B.Inflate=Inflate,B.inflate=inflate,B.inflateRaw=inflateRaw,B.ungzip=inflate},function(F,B,G){var W=G(37),z=G(91),K=G(92),J=G(186),Q=G(187),Y=0,$=1,X=2,Z=4,ee=5,te=6,ne=0,ie=1,re=2,oe=-2,ae=-3,se=-4,ce=-5,le=8,de=1,ue=2,pe=3,he=4,ge=5,fe=6,me=7,ve=8,ye=9,Se=10,_e=11,Ce=12,Te=13,Ee=14,be=15,Ie=16,Ae=17,Re=18,Pe=19,Oe=20,Me=21,we=22,De=23,Ne=24,Le=25,ke=26,Fe=27,xe=28,Ue=29,je=30,Be=31,He=852,Ve=592,Ge=15;function zswap32(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new W.Buf16(320),this.work=new W.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(F){var B;return F&&F.state?(B=F.state,F.total_in=F.total_out=B.total=0,F.msg="",B.wrap&&(F.adler=1&B.wrap),B.mode=de,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new W.Buf32(He),B.distcode=B.distdyn=new W.Buf32(Ve),B.sane=1,B.back=-1,ne):oe}function inflateReset(F){var B;return F&&F.state?((B=F.state).wsize=0,B.whave=0,B.wnext=0,inflateResetKeep(F)):oe}function inflateReset2(F,B){var G,W;return F&&F.state?(W=F.state,B<0?(G=0,B=-B):(G=1+(B>>4),B<48&&(B&=15)),B&&(B<8||B>15)?oe:(null!==W.window&&W.wbits!==B&&(W.window=null),W.wrap=G,W.wbits=B,inflateReset(F))):oe}function inflateInit2(F,B){var G,W;return F?(W=new InflateState,F.state=W,W.window=null,(G=inflateReset2(F,B))!==ne&&(F.state=null),G):oe}function inflateInit(F){return inflateInit2(F,Ge)}var We,qe,ze=!0;function fixedtables(F){if(ze){var B;for(We=new W.Buf32(512),qe=new W.Buf32(32),B=0;B<144;)F.lens[B++]=8;for(;B<256;)F.lens[B++]=9;for(;B<280;)F.lens[B++]=7;for(;B<288;)F.lens[B++]=8;for(Q($,F.lens,0,288,We,0,F.work,{bits:9}),B=0;B<32;)F.lens[B++]=5;Q(X,F.lens,0,32,qe,0,F.work,{bits:5}),ze=!1}F.lencode=We,F.lenbits=9,F.distcode=qe,F.distbits=5}function updatewindow(F,B,G,z){var K,J=F.state;return null===J.window&&(J.wsize=1<<J.wbits,J.wnext=0,J.whave=0,J.window=new W.Buf8(J.wsize)),z>=J.wsize?(W.arraySet(J.window,B,G-J.wsize,J.wsize,0),J.wnext=0,J.whave=J.wsize):((K=J.wsize-J.wnext)>z&&(K=z),W.arraySet(J.window,B,G-z,K,J.wnext),(z-=K)?(W.arraySet(J.window,B,G-z,z,0),J.wnext=z,J.whave=J.wsize):(J.wnext+=K,J.wnext===J.wsize&&(J.wnext=0),J.whave<J.wsize&&(J.whave+=K))),0}function inflate(F,B){var G,He,Ve,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e,Xe,Ze,et,tt,nt,it,rt,ot,at,st,ct,lt,dt=0,ut=new W.Buf8(4),pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&0!==F.avail_in)return oe;(G=F.state).mode===Ce&&(G.mode=Te),We=F.next_out,Ve=F.output,ze=F.avail_out,Ge=F.next_in,He=F.input,qe=F.avail_in,Ke=G.hold,Je=G.bits,Qe=qe,Ye=ze,st=ne;e:for(;;)switch(G.mode){case de:if(0===G.wrap){G.mode=Te;break}for(;Je<16;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(2&G.wrap&&35615===Ke){G.check=0,ut[0]=255&Ke,ut[1]=Ke>>>8&255,G.check=K(G.check,ut,2,0),Ke=0,Je=0,G.mode=ue;break}if(G.flags=0,G.head&&(G.head.done=!1),!(1&G.wrap)||(((255&Ke)<<8)+(Ke>>8))%31){F.msg="incorrect header check",G.mode=je;break}if((15&Ke)!==le){F.msg="unknown compression method",G.mode=je;break}if(Je-=4,at=8+(15&(Ke>>>=4)),0===G.wbits)G.wbits=at;else if(at>G.wbits){F.msg="invalid window size",G.mode=je;break}G.dmax=1<<at,F.adler=G.check=1,G.mode=512&Ke?Se:Ce,Ke=0,Je=0;break;case ue:for(;Je<16;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(G.flags=Ke,(255&G.flags)!==le){F.msg="unknown compression method",G.mode=je;break}if(57344&G.flags){F.msg="unknown header flags set",G.mode=je;break}G.head&&(G.head.text=Ke>>8&1),512&G.flags&&(ut[0]=255&Ke,ut[1]=Ke>>>8&255,G.check=K(G.check,ut,2,0)),Ke=0,Je=0,G.mode=pe;case pe:for(;Je<32;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}G.head&&(G.head.time=Ke),512&G.flags&&(ut[0]=255&Ke,ut[1]=Ke>>>8&255,ut[2]=Ke>>>16&255,ut[3]=Ke>>>24&255,G.check=K(G.check,ut,4,0)),Ke=0,Je=0,G.mode=he;case he:for(;Je<16;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}G.head&&(G.head.xflags=255&Ke,G.head.os=Ke>>8),512&G.flags&&(ut[0]=255&Ke,ut[1]=Ke>>>8&255,G.check=K(G.check,ut,2,0)),Ke=0,Je=0,G.mode=ge;case ge:if(1024&G.flags){for(;Je<16;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}G.length=Ke,G.head&&(G.head.extra_len=Ke),512&G.flags&&(ut[0]=255&Ke,ut[1]=Ke>>>8&255,G.check=K(G.check,ut,2,0)),Ke=0,Je=0}else G.head&&(G.head.extra=null);G.mode=fe;case fe:if(1024&G.flags&&(($e=G.length)>qe&&($e=qe),$e&&(G.head&&(at=G.head.extra_len-G.length,G.head.extra||(G.head.extra=new Array(G.head.extra_len)),W.arraySet(G.head.extra,He,Ge,$e,at)),512&G.flags&&(G.check=K(G.check,He,$e,Ge)),qe-=$e,Ge+=$e,G.length-=$e),G.length))break e;G.length=0,G.mode=me;case me:if(2048&G.flags){if(0===qe)break e;$e=0;do{at=He[Ge+$e++],G.head&&at&&G.length<65536&&(G.head.name+=String.fromCharCode(at))}while(at&&$e<qe);if(512&G.flags&&(G.check=K(G.check,He,$e,Ge)),qe-=$e,Ge+=$e,at)break e}else G.head&&(G.head.name=null);G.length=0,G.mode=ve;case ve:if(4096&G.flags){if(0===qe)break e;$e=0;do{at=He[Ge+$e++],G.head&&at&&G.length<65536&&(G.head.comment+=String.fromCharCode(at))}while(at&&$e<qe);if(512&G.flags&&(G.check=K(G.check,He,$e,Ge)),qe-=$e,Ge+=$e,at)break e}else G.head&&(G.head.comment=null);G.mode=ye;case ye:if(512&G.flags){for(;Je<16;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(Ke!==(65535&G.check)){F.msg="header crc mismatch",G.mode=je;break}Ke=0,Je=0}G.head&&(G.head.hcrc=G.flags>>9&1,G.head.done=!0),F.adler=G.check=0,G.mode=Ce;break;case Se:for(;Je<32;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}F.adler=G.check=zswap32(Ke),Ke=0,Je=0,G.mode=_e;case _e:if(0===G.havedict)return F.next_out=We,F.avail_out=ze,F.next_in=Ge,F.avail_in=qe,G.hold=Ke,G.bits=Je,re;F.adler=G.check=1,G.mode=Ce;case Ce:if(B===ee||B===te)break e;case Te:if(G.last){Ke>>>=7&Je,Je-=7&Je,G.mode=Fe;break}for(;Je<3;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}switch(G.last=1&Ke,Je-=1,3&(Ke>>>=1)){case 0:G.mode=Ee;break;case 1:if(fixedtables(G),G.mode=Oe,B===te){Ke>>>=2,Je-=2;break e}break;case 2:G.mode=Ae;break;case 3:F.msg="invalid block type",G.mode=je}Ke>>>=2,Je-=2;break;case Ee:for(Ke>>>=7&Je,Je-=7&Je;Je<32;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if((65535&Ke)!=(Ke>>>16^65535)){F.msg="invalid stored block lengths",G.mode=je;break}if(G.length=65535&Ke,Ke=0,Je=0,G.mode=be,B===te)break e;case be:G.mode=Ie;case Ie:if($e=G.length){if($e>qe&&($e=qe),$e>ze&&($e=ze),0===$e)break e;W.arraySet(Ve,He,Ge,$e,We),qe-=$e,Ge+=$e,ze-=$e,We+=$e,G.length-=$e;break}G.mode=Ce;break;case Ae:for(;Je<14;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(G.nlen=257+(31&Ke),Ke>>>=5,Je-=5,G.ndist=1+(31&Ke),Ke>>>=5,Je-=5,G.ncode=4+(15&Ke),Ke>>>=4,Je-=4,G.nlen>286||G.ndist>30){F.msg="too many length or distance symbols",G.mode=je;break}G.have=0,G.mode=Re;case Re:for(;G.have<G.ncode;){for(;Je<3;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}G.lens[pt[G.have++]]=7&Ke,Ke>>>=3,Je-=3}for(;G.have<19;)G.lens[pt[G.have++]]=0;if(G.lencode=G.lendyn,G.lenbits=7,ct={bits:G.lenbits},st=Q(Y,G.lens,0,19,G.lencode,0,G.work,ct),G.lenbits=ct.bits,st){F.msg="invalid code lengths set",G.mode=je;break}G.have=0,G.mode=Pe;case Pe:for(;G.have<G.nlen+G.ndist;){for(;tt=(dt=G.lencode[Ke&(1<<G.lenbits)-1])>>>16&255,nt=65535&dt,!((et=dt>>>24)<=Je);){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(nt<16)Ke>>>=et,Je-=et,G.lens[G.have++]=nt;else{if(16===nt){for(lt=et+2;Je<lt;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(Ke>>>=et,Je-=et,0===G.have){F.msg="invalid bit length repeat",G.mode=je;break}at=G.lens[G.have-1],$e=3+(3&Ke),Ke>>>=2,Je-=2}else if(17===nt){for(lt=et+3;Je<lt;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}Je-=et,at=0,$e=3+(7&(Ke>>>=et)),Ke>>>=3,Je-=3}else{for(lt=et+7;Je<lt;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}Je-=et,at=0,$e=11+(127&(Ke>>>=et)),Ke>>>=7,Je-=7}if(G.have+$e>G.nlen+G.ndist){F.msg="invalid bit length repeat",G.mode=je;break}for(;$e--;)G.lens[G.have++]=at}}if(G.mode===je)break;if(0===G.lens[256]){F.msg="invalid code -- missing end-of-block",G.mode=je;break}if(G.lenbits=9,ct={bits:G.lenbits},st=Q($,G.lens,0,G.nlen,G.lencode,0,G.work,ct),G.lenbits=ct.bits,st){F.msg="invalid literal/lengths set",G.mode=je;break}if(G.distbits=6,G.distcode=G.distdyn,ct={bits:G.distbits},st=Q(X,G.lens,G.nlen,G.ndist,G.distcode,0,G.work,ct),G.distbits=ct.bits,st){F.msg="invalid distances set",G.mode=je;break}if(G.mode=Oe,B===te)break e;case Oe:G.mode=Me;case Me:if(qe>=6&&ze>=258){F.next_out=We,F.avail_out=ze,F.next_in=Ge,F.avail_in=qe,G.hold=Ke,G.bits=Je,J(F,Ye),We=F.next_out,Ve=F.output,ze=F.avail_out,Ge=F.next_in,He=F.input,qe=F.avail_in,Ke=G.hold,Je=G.bits,G.mode===Ce&&(G.back=-1);break}for(G.back=0;tt=(dt=G.lencode[Ke&(1<<G.lenbits)-1])>>>16&255,nt=65535&dt,!((et=dt>>>24)<=Je);){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(tt&&0==(240&tt)){for(it=et,rt=tt,ot=nt;tt=(dt=G.lencode[ot+((Ke&(1<<it+rt)-1)>>it)])>>>16&255,nt=65535&dt,!(it+(et=dt>>>24)<=Je);){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}Ke>>>=it,Je-=it,G.back+=it}if(Ke>>>=et,Je-=et,G.back+=et,G.length=nt,0===tt){G.mode=ke;break}if(32&tt){G.back=-1,G.mode=Ce;break}if(64&tt){F.msg="invalid literal/length code",G.mode=je;break}G.extra=15&tt,G.mode=we;case we:if(G.extra){for(lt=G.extra;Je<lt;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}G.length+=Ke&(1<<G.extra)-1,Ke>>>=G.extra,Je-=G.extra,G.back+=G.extra}G.was=G.length,G.mode=De;case De:for(;tt=(dt=G.distcode[Ke&(1<<G.distbits)-1])>>>16&255,nt=65535&dt,!((et=dt>>>24)<=Je);){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(0==(240&tt)){for(it=et,rt=tt,ot=nt;tt=(dt=G.distcode[ot+((Ke&(1<<it+rt)-1)>>it)])>>>16&255,nt=65535&dt,!(it+(et=dt>>>24)<=Je);){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}Ke>>>=it,Je-=it,G.back+=it}if(Ke>>>=et,Je-=et,G.back+=et,64&tt){F.msg="invalid distance code",G.mode=je;break}G.offset=nt,G.extra=15&tt,G.mode=Ne;case Ne:if(G.extra){for(lt=G.extra;Je<lt;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}G.offset+=Ke&(1<<G.extra)-1,Ke>>>=G.extra,Je-=G.extra,G.back+=G.extra}if(G.offset>G.dmax){F.msg="invalid distance too far back",G.mode=je;break}G.mode=Le;case Le:if(0===ze)break e;if($e=Ye-ze,G.offset>$e){if(($e=G.offset-$e)>G.whave&&G.sane){F.msg="invalid distance too far back",G.mode=je;break}$e>G.wnext?($e-=G.wnext,Xe=G.wsize-$e):Xe=G.wnext-$e,$e>G.length&&($e=G.length),Ze=G.window}else Ze=Ve,Xe=We-G.offset,$e=G.length;$e>ze&&($e=ze),ze-=$e,G.length-=$e;do{Ve[We++]=Ze[Xe++]}while(--$e);0===G.length&&(G.mode=Me);break;case ke:if(0===ze)break e;Ve[We++]=G.length,ze--,G.mode=Me;break;case Fe:if(G.wrap){for(;Je<32;){if(0===qe)break e;qe--,Ke|=He[Ge++]<<Je,Je+=8}if(Ye-=ze,F.total_out+=Ye,G.total+=Ye,Ye&&(F.adler=G.check=G.flags?K(G.check,Ve,Ye,We-Ye):z(G.check,Ve,Ye,We-Ye)),Ye=ze,(G.flags?Ke:zswap32(Ke))!==G.check){F.msg="incorrect data check",G.mode=je;break}Ke=0,Je=0}G.mode=xe;case xe:if(G.wrap&&G.flags){for(;Je<32;){if(0===qe)break e;qe--,Ke+=He[Ge++]<<Je,Je+=8}if(Ke!==(4294967295&G.total)){F.msg="incorrect length check",G.mode=je;break}Ke=0,Je=0}G.mode=Ue;case Ue:st=ie;break e;case je:st=ae;break e;case Be:return se;default:return oe}return F.next_out=We,F.avail_out=ze,F.next_in=Ge,F.avail_in=qe,G.hold=Ke,G.bits=Je,(G.wsize||Ye!==F.avail_out&&G.mode<je&&(G.mode<Fe||B!==Z))&&updatewindow(F,F.output,F.next_out,Ye-F.avail_out),Qe-=F.avail_in,Ye-=F.avail_out,F.total_in+=Qe,F.total_out+=Ye,G.total+=Ye,G.wrap&&Ye&&(F.adler=G.check=G.flags?K(G.check,Ve,Ye,F.next_out-Ye):z(G.check,Ve,Ye,F.next_out-Ye)),F.data_type=G.bits+(G.last?64:0)+(G.mode===Ce?128:0)+(G.mode===Oe||G.mode===be?256:0),(0===Qe&&0===Ye||B===Z)&&st===ne&&(st=ce),st}function inflateEnd(F){if(!F||!F.state)return oe;var B=F.state;return B.window&&(B.window=null),F.state=null,ne}function inflateGetHeader(F,B){var G;return F&&F.state?0==(2&(G=F.state).wrap)?oe:(G.head=B,B.done=!1,ne):oe}function inflateSetDictionary(F,B){var G,W=B.length;return F&&F.state?0!==(G=F.state).wrap&&G.mode!==_e?oe:G.mode===_e&&z(1,B,W,0)!==G.check?ae:updatewindow(F,B,W,W)?(G.mode=Be,se):(G.havedict=1,ne):oe}B.inflateReset=inflateReset,B.inflateReset2=inflateReset2,B.inflateResetKeep=inflateResetKeep,B.inflateInit=inflateInit,B.inflateInit2=inflateInit2,B.inflate=inflate,B.inflateEnd=inflateEnd,B.inflateGetHeader=inflateGetHeader,B.inflateSetDictionary=inflateSetDictionary,B.inflateInfo="pako inflate (from Nodeca project)"},function(F,B,G){var W=30,z=12;F.exports=function inflate_fast(F,B){var G,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me;G=F.state,K=F.next_in,fe=F.input,J=K+(F.avail_in-5),Q=F.next_out,me=F.output,Y=Q-(B-F.avail_out),$=Q+(F.avail_out-257),X=G.dmax,Z=G.wsize,ee=G.whave,te=G.wnext,ne=G.window,ie=G.hold,re=G.bits,oe=G.lencode,ae=G.distcode,se=(1<<G.lenbits)-1,ce=(1<<G.distbits)-1;e:do{re<15&&(ie+=fe[K++]<<re,re+=8,ie+=fe[K++]<<re,re+=8),le=oe[ie&se];t:for(;;){if(ie>>>=de=le>>>24,re-=de,0===(de=le>>>16&255))me[Q++]=65535&le;else{if(!(16&de)){if(0==(64&de)){le=oe[(65535&le)+(ie&(1<<de)-1)];continue t}if(32&de){G.mode=z;break e}F.msg="invalid literal/length code",G.mode=W;break e}ue=65535&le,(de&=15)&&(re<de&&(ie+=fe[K++]<<re,re+=8),ue+=ie&(1<<de)-1,ie>>>=de,re-=de),re<15&&(ie+=fe[K++]<<re,re+=8,ie+=fe[K++]<<re,re+=8),le=ae[ie&ce];n:for(;;){if(ie>>>=de=le>>>24,re-=de,!(16&(de=le>>>16&255))){if(0==(64&de)){le=ae[(65535&le)+(ie&(1<<de)-1)];continue n}F.msg="invalid distance code",G.mode=W;break e}if(pe=65535&le,re<(de&=15)&&(ie+=fe[K++]<<re,(re+=8)<de&&(ie+=fe[K++]<<re,re+=8)),(pe+=ie&(1<<de)-1)>X){F.msg="invalid distance too far back",G.mode=W;break e}if(ie>>>=de,re-=de,pe>(de=Q-Y)){if((de=pe-de)>ee&&G.sane){F.msg="invalid distance too far back",G.mode=W;break e}if(he=0,ge=ne,0===te){if(he+=Z-de,de<ue){ue-=de;do{me[Q++]=ne[he++]}while(--de);he=Q-pe,ge=me}}else if(te<de){if(he+=Z+te-de,(de-=te)<ue){ue-=de;do{me[Q++]=ne[he++]}while(--de);if(he=0,te<ue){ue-=de=te;do{me[Q++]=ne[he++]}while(--de);he=Q-pe,ge=me}}}else if(he+=te-de,de<ue){ue-=de;do{me[Q++]=ne[he++]}while(--de);he=Q-pe,ge=me}for(;ue>2;)me[Q++]=ge[he++],me[Q++]=ge[he++],me[Q++]=ge[he++],ue-=3;ue&&(me[Q++]=ge[he++],ue>1&&(me[Q++]=ge[he++]))}else{he=Q-pe;do{me[Q++]=me[he++],me[Q++]=me[he++],me[Q++]=me[he++],ue-=3}while(ue>2);ue&&(me[Q++]=me[he++],ue>1&&(me[Q++]=me[he++]))}break}}break}}while(K<J&&Q<$);K-=ue=re>>3,ie&=(1<<(re-=ue<<3))-1,F.next_in=K,F.next_out=Q,F.avail_in=K<J?J-K+5:5-(K-J),F.avail_out=Q<$?$-Q+257:257-(Q-$),G.hold=ie,G.bits=re}},function(F,B,G){var W=G(37),z=15,K=852,J=592,Q=0,Y=1,$=2,X=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Z=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],ee=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],te=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];F.exports=function inflate_table(F,B,G,ne,ie,re,oe,ae){var se,ce,le,de,ue,pe,he,ge,fe,me=ae.bits,ve=0,ye=0,Se=0,_e=0,Ce=0,Te=0,Ee=0,be=0,Ie=0,Ae=0,Re=null,Pe=0,Oe=new W.Buf16(z+1),Me=new W.Buf16(z+1),we=null,De=0;for(ve=0;ve<=z;ve++)Oe[ve]=0;for(ye=0;ye<ne;ye++)Oe[B[G+ye]]++;for(Ce=me,_e=z;_e>=1&&0===Oe[_e];_e--);if(Ce>_e&&(Ce=_e),0===_e)return ie[re++]=20971520,ie[re++]=20971520,ae.bits=1,0;for(Se=1;Se<_e&&0===Oe[Se];Se++);for(Ce<Se&&(Ce=Se),be=1,ve=1;ve<=z;ve++)if(be<<=1,(be-=Oe[ve])<0)return-1;if(be>0&&(F===Q||1!==_e))return-1;for(Me[1]=0,ve=1;ve<z;ve++)Me[ve+1]=Me[ve]+Oe[ve];for(ye=0;ye<ne;ye++)0!==B[G+ye]&&(oe[Me[B[G+ye]]++]=ye);if(F===Q?(Re=we=oe,pe=19):F===Y?(Re=X,Pe-=257,we=Z,De-=257,pe=256):(Re=ee,we=te,pe=-1),Ae=0,ye=0,ve=Se,ue=re,Te=Ce,Ee=0,le=-1,de=(Ie=1<<Ce)-1,F===Y&&Ie>K||F===$&&Ie>J)return 1;for(;;){he=ve-Ee,oe[ye]<pe?(ge=0,fe=oe[ye]):oe[ye]>pe?(ge=we[De+oe[ye]],fe=Re[Pe+oe[ye]]):(ge=96,fe=0),se=1<<ve-Ee,Se=ce=1<<Te;do{ie[ue+(Ae>>Ee)+(ce-=se)]=he<<24|ge<<16|fe|0}while(0!==ce);for(se=1<<ve-1;Ae&se;)se>>=1;if(0!==se?(Ae&=se-1,Ae+=se):Ae=0,ye++,0==--Oe[ve]){if(ve===_e)break;ve=B[G+oe[ye]]}if(ve>Ce&&(Ae&de)!==le){for(0===Ee&&(Ee=Ce),ue+=Se,be=1<<(Te=ve-Ee);Te+Ee<_e&&!((be-=Oe[Te+Ee])<=0);)Te++,be<<=1;if(Ie+=1<<Te,F===Y&&Ie>K||F===$&&Ie>J)return 1;ie[le=Ae&de]=Ce<<24|Te<<16|ue-re|0}}return 0!==Ae&&(ie[ue+Ae]=ve-Ee<<24|64<<16|0),ae.bits=Ce,0}},function(F,B,G){function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}F.exports=GZheader},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(5),z=function(){function IncomingNotificationMessageHandler(F){var B=this;this.handleMessage=function(F){if(!B.isMessageForExistingCall(F))return{isHandled:!1};if(F.url.search(new RegExp("/".concat(W.default.URL_BASE.CALLAGENT,"/"),"i"))>-1){var G=B.signalingAgent.handleIncomingNotification(F);return"number"==typeof G?{isHandled:!0,resultCode:G}:{isHandled:!0,resultCode:G.resultCode,responseBody:G.responseBody,responseHeaders:G.responseHeaders}}return{isHandled:!1}},this.signalingAgent=F}return IncomingNotificationMessageHandler.prototype.isMessageForExistingCall=function(F){return!F.eventId},IncomingNotificationMessageHandler}();B.default=z},function(F,B,G){F.exports=G(191)},function(F,B,G){var W=G(22),z=G(97),K=G(192),J=G(104);function createInstance(F){var B=new K(F),G=z(K.prototype.request,B);return W.extend(G,K.prototype,B),W.extend(G,B),G}var Q=createInstance(G(100));Q.Axios=K,Q.create=function create(F){return createInstance(J(Q.defaults,F))},Q.Cancel=G(105),Q.CancelToken=G(206),Q.isCancel=G(99),Q.all=function all(F){return Promise.all(F)},Q.spread=G(207),F.exports=Q,F.exports.default=Q},function(F,B,G){var W=G(22),z=G(98),K=G(193),J=G(194),Q=G(104);function Axios(F){this.defaults=F,this.interceptors={request:new K,response:new K}}Axios.prototype.request=function request(F){"string"==typeof F?(F=arguments[1]||{}).url=arguments[0]:F=F||{},(F=Q(this.defaults,F)).method?F.method=F.method.toLowerCase():this.defaults.method?F.method=this.defaults.method.toLowerCase():F.method="get";var B=[J,void 0],G=Promise.resolve(F);for(this.interceptors.request.forEach((function unshiftRequestInterceptors(F){B.unshift(F.fulfilled,F.rejected)})),this.interceptors.response.forEach((function pushResponseInterceptors(F){B.push(F.fulfilled,F.rejected)}));B.length;)G=G.then(B.shift(),B.shift());return G},Axios.prototype.getUri=function getUri(F){return F=Q(this.defaults,F),z(F.url,F.params,F.paramsSerializer).replace(/^\?/,"")},W.forEach(["delete","get","head","options"],(function forEachMethodNoData(F){Axios.prototype[F]=function(B,G){return this.request(W.merge(G||{},{method:F,url:B}))}})),W.forEach(["post","put","patch"],(function forEachMethodWithData(F){Axios.prototype[F]=function(B,G,z){return this.request(W.merge(z||{},{method:F,url:B,data:G}))}})),F.exports=Axios},function(F,B,G){var W=G(22);function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(F,B){return this.handlers.push({fulfilled:F,rejected:B}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(F){this.handlers[F]&&(this.handlers[F]=null)},InterceptorManager.prototype.forEach=function forEach(F){W.forEach(this.handlers,(function forEachHandler(B){null!==B&&F(B)}))},F.exports=InterceptorManager},function(F,B,G){var W=G(22),z=G(195),K=G(99),J=G(100);function throwIfCancellationRequested(F){F.cancelToken&&F.cancelToken.throwIfRequested()}F.exports=function dispatchRequest(F){return throwIfCancellationRequested(F),F.headers=F.headers||{},F.data=z(F.data,F.headers,F.transformRequest),F.headers=W.merge(F.headers.common||{},F.headers[F.method]||{},F.headers),W.forEach(["delete","get","head","post","put","patch","common"],(function cleanHeaderConfig(B){delete F.headers[B]})),(F.adapter||J.adapter)(F).then((function onAdapterResolution(B){return throwIfCancellationRequested(F),B.data=z(B.data,B.headers,F.transformResponse),B}),(function onAdapterRejection(B){return K(B)||(throwIfCancellationRequested(F),B&&B.response&&(B.response.data=z(B.response.data,B.response.headers,F.transformResponse))),Promise.reject(B)}))}},function(F,B,G){var W=G(22);F.exports=function transformData(F,B,G){return W.forEach(G,(function transform(G){F=G(F,B)})),F}},function(F,B,G){var W=G(22);F.exports=function normalizeHeaderName(F,B){W.forEach(F,(function processHeader(G,W){W!==B&&W.toUpperCase()===B.toUpperCase()&&(F[B]=G,delete F[W])}))}},function(F,B,G){var W=G(103);F.exports=function settle(F,B,G){var z=G.config.validateStatus;!z||z(G.status)?F(G):B(W("Request failed with status code "+G.status,G.config,null,G.request,G))}},function(F,B,G){F.exports=function enhanceError(F,B,G,W,z){return F.config=B,G&&(F.code=G),F.request=W,F.response=z,F.isAxiosError=!0,F.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},F}},function(F,B,G){var W=G(200),z=G(201);F.exports=function buildFullPath(F,B){return F&&!W(B)?z(F,B):B}},function(F,B,G){F.exports=function isAbsoluteURL(F){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(F)}},function(F,B,G){F.exports=function combineURLs(F,B){return B?F.replace(/\/+$/,"")+"/"+B.replace(/^\/+/,""):F}},function(F,B,G){var W=G(22),z=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];F.exports=function parseHeaders(F){var B,G,K,J={};return F?(W.forEach(F.split("\n"),(function parser(F){if(K=F.indexOf(":"),B=W.trim(F.substr(0,K)).toLowerCase(),G=W.trim(F.substr(K+1)),B){if(J[B]&&z.indexOf(B)>=0)return;J[B]="set-cookie"===B?(J[B]?J[B]:[]).concat([G]):J[B]?J[B]+", "+G:G}})),J):J}},function(F,B,G){var W=G(22),z=G(204);F.exports=W.isStandardBrowserEnv()?function standardBrowserEnv(){var F,B=/(msie|trident)/i.test(navigator.userAgent),G=document.createElement("a");function resolveURL(F){var W=F;if(z(F))throw new Error("URL contains XSS injection attempt");return B&&(G.setAttribute("href",W),W=G.href),G.setAttribute("href",W),{href:G.href,protocol:G.protocol?G.protocol.replace(/:$/,""):"",host:G.host,search:G.search?G.search.replace(/^\?/,""):"",hash:G.hash?G.hash.replace(/^#/,""):"",hostname:G.hostname,port:G.port,pathname:"/"===G.pathname.charAt(0)?G.pathname:"/"+G.pathname}}return F=resolveURL(window.location.href),function isURLSameOrigin(B){var G=W.isString(B)?resolveURL(B):B;return G.protocol===F.protocol&&G.host===F.host}}():function isURLSameOrigin(){return!0}},function(F,B,G){F.exports=function isValidXss(F){return/(\b)(on\w+)=|javascript|(<\s*)(\/*)script/gi.test(F)}},function(F,B,G){var W=G(22);F.exports=W.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(F,B,G,z,K,J){var Q=[];Q.push(F+"="+encodeURIComponent(B)),W.isNumber(G)&&Q.push("expires="+new Date(G).toGMTString()),W.isString(z)&&Q.push("path="+z),W.isString(K)&&Q.push("domain="+K),!0===J&&Q.push("secure"),document.cookie=Q.join("; ")},read:function read(F){var B=document.cookie.match(new RegExp("(^|;\\s*)("+F+")=([^;]*)"));return B?decodeURIComponent(B[3]):null},remove:function remove(F){this.write(F,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},function(F,B,G){var W=G(105);function CancelToken(F){if("function"!=typeof F)throw new TypeError("executor must be a function.");var B;this.promise=new Promise((function promiseExecutor(F){B=F}));var G=this;F((function cancel(F){G.reason||(G.reason=new W(F),B(G.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var F;return{token:new CancelToken((function executor(B){F=B})),cancel:F}},F.exports=CancelToken},function(F,B,G){F.exports=function spread(F){return function wrap(B){return F.apply(null,B)}}},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var K=G(57),J=G(14),Q=G(32),Y=G(209),$=G(96),X=G(76),Z=G(211),ee=G(25),te=G(5),ne=G(9),ie=G(3),re=function(){function SignalingAgent(F){var B=this;this.endpointId=ie.newGuid(),this.signalingSessions={},this.clientSupportsGenericTokenAPI=!1,this.getNewSignalingSession=function(F,G,W,z){var K=ie.causeId();ie.assertNotNull(F,"selfParticipant should be a non null value"),ie.assertNotNull(G,"signalingSessionCallback should be a non null value");var J=W||ie.newGuid();ie.assertNotNullOrEmpty(J,"signalingSession id generated cannot be null or empty"),B.checkConfigChange(K);var Q=Z.build(F,G,B.signalingAgentConfig,J,B,z),Y=Q.sessionId;return B.signalingSessions[Y]=Q,B.logger.info("[".concat(K,"]Created new signalingSession with correlation ID ").concat(J," and session ID ").concat(Y)),Q},this.resolvePotentialCallConflict=function(F){var G,W=ie.causeId();if(B.logger.info("[".concat(W,"][resolvePotentialCallConflict]")),!F.multiParty)return Object.keys(B.signalingSessions).forEach((function(W){B.isSessionInConflictingState(B.signalingSessions[W],!F.isIncomingCall)&&(G=F.isIncomingCall?B.compareAndGetConflictingSession(F,B.signalingSessions[W]):B.compareAndGetConflictingSession(B.signalingSessions[W],F))})),G?(B.logger.info("Call conflict done, conflicting session callId=",G.correlationId,"urlIdentifier=",G.urlIdentifier),G.telemetryHelper.recordEvent(ee.EVENTS.CONFLICTED_CALL),B.signalingAgentConfig.endConflictedCall?(B.endConflictedSession(G,W),G):void 0):void 0},this.handleIncomingNotification=function(F){if(ie.assertNotNull(F,"request should be a non null value"),B.logger.info("handleIncomingNotification to : ".concat(F.url)),!F.body&&!F.rawBody)return B.logger.error("request has no body"),B.buildNotificationResponse(te.default.HTTP_STATUS_CODES.BAD_REQUEST);var G=te.default.HTTP_STATUS_CODES.OK,W=ne.getIdFromUrl(F.url);if(W){var z=B.signalingSessions.hasOwnProperty(W);if(B.logger.info("Is session found:".concat(z)),z){var K=B.signalingSessions[W];if(ie.isEncodedMessage(F.headers))try{if(!ie.isMessageEncodingSupported(F.headers))throw new Error("Unsupported encoding");var Q=ie.decodeMessage(F.rawBody),Y=JSON.parse(Q);F.body=Y}catch(F){return K.telemetryHelper.recordEvent(ee.EVENTS.TROUTER_DECODE_PAYLOAD_FAILURE),B.buildNotificationResponse(te.default.HTTP_STATUS_CODES.BAD_REQUEST)}if(K.canHandleIncomingMsgSync(F))return K.handleIncomingMsgSync(F);window.setTimeout((function(){if(B.signalingSessions.hasOwnProperty(W)){var G=B.signalingSessions[W];G.handleIncomingMsgAsync(F).catch((function(F){G&&G.telemetryHelper&&G.telemetryHelper.recordEvent(ee.EVENTS.FAILED_TO_HANDLE_TROUTER_MESSAGE),B.logger.error("handling IncomingMsg failed with error: ".concat(F))}))}}),0)}else B.logger.info("Incoming message for session ID ".concat(W,", but session was not found!")),G=te.default.HTTP_STATUS_CODES.NOT_FOUND}else B.logger.error("Could not retrieve session ID from Url path. Path = ".concat(F.url)),G=te.default.HTTP_STATUS_CODES.BAD_REQUEST;var $=B.buildNotificationResponse(G);return B.logger.info("Result code:".concat((0,J.getPrintableObject)($))),$},this.onCallCompleted=function(F,G){B.signalingSessions.hasOwnProperty(F)?(delete B.signalingSessions[F],B.logger.info("[".concat(G,"][onCallCompleted] Session ID ").concat(F," found. Deleted from signalingSession table"))):B.logger.info("[".concat(G,"][onCallCompleted] Session ID ").concat(F," not found. Could not delete from signalingSession table"))},this.applyAuthTokenCacheConfig=function(F){B.signalingAgentConfig.enableTokenCache?(B.authTokenManager.setTokenCaching(!0,F),B.signalingAgentConfig.enableTokenPrefetch&&B.authTokenManager.getToken(F).then((function(){B.logger.info("[".concat(F,"] token prefetch success"))})).catch((function(G){B.logger.info("[".concat(F,"] token prefetch failure, error=").concat((0,J.getPrintableObject)(G)))}))):B.authTokenManager.setTokenCaching(!1,F)},this.endConflictedSession=function(F,G){B.logger.info("Call conflict, ending signalingSession with callId=",F.correlationId,"urlIdentifier=",F.urlIdentifier),F.endAsync({code:te.default.CALL_END_CODE.CONFLICT,subCode:te.default.CALL_END_SUB_CODE.CONFLICT_IN_NG,phrase:te.default.CALL_END_PHRASE.CONFLICT},{forEveryone:!1,causeId:G})},this.compareAndGetConflictingSession=function(F,B){if(ie.is1to1Mri(F.incomingCallCallerId)&&ie.is1to1Mri(B.participantManager.localParticipant.id)){var G=ie.stripMri(F.incomingCallCallerId),W=ie.stripMri(B.participantManager.getParticipantsToInitiateCallWith().length&&B.participantManager.getParticipantsToInitiateCallWith()[0].id),z=ie.stripMri(B.participantManager.localParticipant.id);if(W===G)return z>G?F:B}},this.isSessionInConflictingState=function(F,G){if(!F)return B.logger.info("Call conflict, ignore, session already disposed"),!1;var W=[te.default.CALL_STATUS.IDLE,te.default.CALL_STATUS.CONNECTING,te.default.CALL_STATUS.RINGING];return!F.multiParty&&W.indexOf(F.getCallStatus())>-1&&(G&&F.isIncomingCall||!G&&!F.isIncomingCall)},this.buildNotificationResponse=function(F,G){return B.signalingAgentConfig.supportsSynchronousTrouterResponse?{resultCode:F,responseBody:G}:F},(0,$.default)(F),this.signalingAgentConfig=F,this.logger=F.logger.createChild("SignalingAgent"),ie.assertNotNull(F,"signalingAgentConfig should be a non null value"),this.logger.info(F.isWebRtcEnabled?"webRTC enabled":"ORTC enabled");var G={aadTokenExpirationTimeInSeconds:F.aadTokenExpirationTimeInSeconds,popTokenExpirationTimeInSeconds:F.popTokenExpirationTimeInSeconds,refreshTimeBeforeTokenTimeoutInSeconds:F.refreshTimeBeforeTokenTimeoutInSeconds};this.authTokenManager=Y.authTokenManagerFactory.build(this.logger,F.skypeToken,G),this.applyAuthTokenCacheConfig(ie.causeId())}return SignalingAgent.prototype.updateSignalingAgentConfig=function(F){var B=ie.causeId(),G=JSON.stringify(F,(function(F,B){return F?String(B):B}));this.logger.info("[".concat(B,"] updateSignalingAgentConfig, SignalingAgentConfig: ").concat(G)),this.logger.info("[".concat(B,"] ecsEtag=").concat(F.ecsEtag)),(0,$.default)(F),this.updatedSignalingAgentConfig=F},SignalingAgent.prototype.updateUrls=function(F,B,G){this.logger.info("updateUrls: conversationServiceUrl: ".concat(F,", uploadLogRequestUrl: ").concat(B,", enforceUrls: ").concat(G)),this.updatedSignalingAgentConfig=this.updatedSignalingAgentConfig||this.signalingAgentConfig,G||!this.updatedSignalingAgentConfig.isConversationServiceUrlFromEcs?this.updatedSignalingAgentConfig.conversationServiceUrl=F||this.updatedSignalingAgentConfig.conversationServiceUrl:this.updatedSignalingAgentConfig.conversationServiceUrl=this.updatedSignalingAgentConfig.conversationServiceUrl||F,G||!this.updatedSignalingAgentConfig.isUploadLogRequestUrlFromEcs?this.updatedSignalingAgentConfig.uploadLogRequestUrl=B||this.updatedSignalingAgentConfig.uploadLogRequestUrl:this.updatedSignalingAgentConfig.uploadLogRequestUrl=this.updatedSignalingAgentConfig.uploadLogRequestUrl||B},SignalingAgent.prototype.update=function(F){this.logger.info("update accountConfiguration ".concat(JSON.stringify(F))),F&&F.clientSupportsGenericTokenAPI!==this.clientSupportsGenericTokenAPI&&(this.clientSupportsGenericTokenAPI=F.clientSupportsGenericTokenAPI,this.authTokenManager.updateTokenSettings({clientSupportsGenericTokenAPI:this.clientSupportsGenericTokenAPI}))},SignalingAgent.prototype.sendPushAsync=function(F,B,G,z,J){var Y=this;void 0===J&&(J=ie.causeId());var $=new X.default(this.signalingAgentConfig.piiScrubber),Z="sendPush[local participant mri = ".concat($.scrubMriOrOmit(F),"][recipientList = ").concat($.scrubMriOrOmit(B),"][headers = ").concat(G,")][causeId = ").concat(J,"]");if(!F||!F.id)return this.logger.info("".concat(Z," Empty localParticipantId")),Promise.reject("invalid localParticipantId");if(!B||0===B.length||B.every((function(F){return F&&""===F.id})))return this.logger.info("".concat(Z," Empty recipientList")),Promise.reject("invalid recipientList");if(!G)return this.logger.info("".concat(Z," Empty headers")),Promise.reject("invalid headers");if(!z||null===ie.tryParse(z))return this.logger.info("".concat(Z," Invalid body.")),Promise.reject("invalid body");var ee=W(W({},ie.tryParse(z)),{To:Array.from(B,(function(F){return F.id})),From:F.id});G.hasOwnProperty(te.default.HEADERS.CORRELATION_ID)||(G[te.default.HEADERS.CORRELATION_ID]=(0,K.default)()),G.hasOwnProperty(te.default.HEADERS.MESSAGE_ID)||(G[te.default.HEADERS.MESSAGE_ID]=(0,K.default)()),G.hasOwnProperty(te.default.HEADERS.PARTICIPANT_ID)||(G[te.default.HEADERS.PARTICIPANT_ID]=(0,K.default)()),G.hasOwnProperty(te.default.HEADERS.CONTENT_TYPE)||(G[te.default.HEADERS.CONTENT_TYPE]="application/json"),G.hasOwnProperty(te.default.HEADERS.CLIENT_USER_AGENT)&&(G[te.default.HEADERS.CLIENT_USER_AGENT]+="/TsCallingVersion=".concat((0,Q.getTsCallingVersion)(),"/Ovb=").concat((0,Q.getOvb)()));var ne=this.signalingAgentConfig.httpRequestDispatcher.getRequestOptions("POST",G,JSON.stringify(ee),3e4);return new Promise((function(F,B){Y.signalingAgentConfig.httpRequestDispatcher.postAsync(Y.signalingAgentConfig.uploadLogRequestUrl||te.default.URL_DEFAULTS.UPLOAD_LOG_URL,ne).then((function(){F()})).catch((function(F){B(F)}))}))},SignalingAgent.prototype.getSignalingSession=function(F){var B,G;try{for(var W=z(Object.keys(this.signalingSessions)),K=W.next();!K.done;K=W.next()){var J=K.value,Q=this.signalingSessions[J];if(Q.correlationId===F)return Q}}catch(F){B={error:F}}finally{try{K&&!K.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}return null},SignalingAgent.prototype.updateToken=function(F,B,G,W,z){this.authTokenManager.updateToken(F,B,G,W,z)},SignalingAgent.prototype.setTokenRequiredCallBack=function(F){this.authTokenManager.setTokenRequiredCallBack(F)},SignalingAgent.prototype.resetAuthTokenManager=function(){this.setTokenRequiredCallBack(null),this.authTokenManager.setDisableTimerFlag(!0)},SignalingAgent.prototype.checkConfigChange=function(F){this.updatedSignalingAgentConfig&&this.updatedSignalingAgentConfig!==this.signalingAgentConfig&&(this.signalingAgentConfig=this.updatedSignalingAgentConfig,this.updatedSignalingAgentConfig=null,this.applyAuthTokenCacheConfig(F))},SignalingAgent}();B.default=re},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.authTokenManagerFactory=B.AuthTokenManager=void 0;var J=G(14),Q=G(210),Y=3600,$=function(){function AuthTokenManager(F,B,G){this.tokenProvider=B,this.tokenCachingEnabled=!1,this.cachedToken="",this.lastTokenType=1,this.lastToken="",this.clientSupportsGenericTokenAPI=!1,this.refreshTimeBeforeTokenTimeoutInSeconds=60,this.stopTimerFlag=!1,this.tokensPromiseMap={},this.logger=F.createChild("TokenManager"),G&&this.updateTokenSettings(G),this.cacheTokenManager=new Q.default}return AuthTokenManager.prototype.setTokenCaching=function(F,B){this.tokenCachingEnabled!==F&&(this.logger.info("setTokenCaching=".concat(F)),this.tokenCachingEnabled=F)},AuthTokenManager.prototype.getToken=function(F,B,G){return void 0===B&&(B=!1),z(this,void 0,void 0,(function(){var W,z;return K(this,(function(K){switch(K.label){case 0:return this.clientSupportsGenericTokenAPI?(this.logger.info("[".concat(F,"][getToken] callingTokenAPI is enabled so using new API to fetch it")),[4,this.getTokenWithTokenType(F,B,G)]):[3,2];case 1:return[2,W=K.sent().token];case 2:if(B&&this.invalidateCachedToken(F),this.cachedToken&&this.tokenCachingEnabled)return this.logger.info("[".concat(F,"][getToken] returning cached token")),[2,Promise.resolve(this.cachedToken)];K.label=3;case 3:return K.trys.push([3,5,,6]),this.logger.info("[".concat(F,"][getToken] fetching new token")),[4,this.tokenProvider()];case 4:return(W=K.sent())?(this.tokenCachingEnabled&&(this.cachedToken=W),this.lastToken=W,this.lastTokenType=1,this.logger.info("[".concat(F,"][getToken] fetching new token success")),[2,W]):(this.logger.info("[".concat(F,"][getToken] received empty token")),[2,Promise.reject("Received empty token")]);case 5:throw z=K.sent(),this.logger.info("[".concat(F,"][getToken] failed to fetch token=").concat((0,J.getPrintableObject)(z))),this.cachedToken="",z;case 6:return[2]}}))}))},AuthTokenManager.prototype.invalidateCachedToken=function(F){this.cachedToken&&(this.logger.info("[".concat(F,"][invalidateCachedToken]")),this.cachedToken="")},AuthTokenManager.prototype.getLastToken=function(F){return this.logger.info("[".concat(F,"][getLastToken]")),this.lastToken},AuthTokenManager.prototype.getTokenWithTokenType=function(F,B,G){return void 0===B&&(B=!1),z(this,void 0,void 0,(function(){var W,z,Q,Y,$,X,Z,ee,te;return K(this,(function(K){switch(K.label){case 0:if(z=(W=G||{}).factorsJson,Q=W.requestMetadataJson,Y=W.invalidToken,$=(null==G?void 0:G.tokenType)||1,B&&this.cacheTokenManager.invalidateCachedToken($),this.tokenCachingEnabled&&(X=this.cacheTokenManager.getToken($,z))&&X.token)return this.logger.info("[".concat(F,"][getTokenWithTokenType] returning cached token for factorsJson ").concat(z," and tokenType ").concat($)),[2,X];K.label=1;case 1:return K.trys.push([1,3,,4]),this.logger.info("[".concat(F,"][getTokenWithTokenType] fetching new token for factorsJson ").concat(z," and tokenType ").concat($)),[4,this.onTokenRequired({factorsJson:z,tokenType:$,requestMetadataJson:Q,invalidToken:Y})];case 2:return Z=K.sent(),(ee=Z.token)?(this.lastTokenType=Z.tokenType,this.lastToken=ee,this.tokenCachingEnabled&&this.cacheTokenManager.setToken(Z.tokenType,ee,z),this.logger.info("[".concat(F,"][getTokenWithTokenType] fetching new token success for factorsJson ").concat(z," and tokenType ").concat($)),[2,Z]):(this.logger.info("[".concat(F,"][getTokenWithTokenType] received empty token")),[2,Promise.reject("Received empty token")]);case 3:throw te=K.sent(),this.logger.info("[".concat(F,"][getTokenWithTokenType] failed to fetch token=").concat((0,J.getPrintableObject)(te))),this.cacheTokenManager.invalidateCachedToken($),te;case 4:return[2]}}))}))},AuthTokenManager.prototype.getLastTokenType=function(F){return this.logger.info("[".concat(F,"][getLastTokenType]")),this.lastTokenType},AuthTokenManager.prototype.updateTokenSettings=function(F){var B=F.clientSupportsGenericTokenAPI,G=F.aadTokenExpirationTimeInSeconds,W=F.popTokenExpirationTimeInSeconds,z=F.refreshTimeBeforeTokenTimeoutInSeconds;this.logger.info("updateTokenSettings ".concat(JSON.stringify(F))),this.clientSupportsGenericTokenAPI=null!=B?B:this.clientSupportsGenericTokenAPI,this.aadTokenExpirationTimeInSeconds=null!=G?G:this.aadTokenExpirationTimeInSeconds,this.popTokenExpirationTimeInSeconds=null!=W?W:this.popTokenExpirationTimeInSeconds,this.refreshTimeBeforeTokenTimeoutInSeconds=null!=z?z:this.refreshTimeBeforeTokenTimeoutInSeconds},AuthTokenManager.prototype.updateToken=function(F,B,G,z,K){if(this.logger.info("[".concat(z,"][updateToken] UI replies a token with factorsJson=").concat(F," ")+"updateMetadata=".concat(JSON.stringify(B)," tokenExpiryInSeconds=").concat(K)),!this.tokensPromiseMap[F])throw Error("[updateToken]: UI try to update token with invalid factorsJson=".concat(F));if(B.error)this.logger.info("[".concat(z,"][updateToken] UI replies with error ").concat(B.error," for factorsJson ").concat(F)),this.tokensPromiseMap[F].reject(B.error);else{if(this.tokensPromiseMap[F].tokenRequestOptions.tokenType=B.tokenType,this.tokensPromiseMap[F].resolve({token:G,tokenType:B.tokenType}),this.logger.info("[".concat(z,"][updateToken] resolved and upateToken with factorsJson=").concat(F," tokenType=").concat(B.tokenType)),this.tokenCachingEnabled){var J=W({},this.tokensPromiseMap[F].tokenRequestOptions);this.setTimerToRefreshToken(z,J,K)}delete this.tokensPromiseMap[F]}},AuthTokenManager.prototype.onTokenRequired=function(F){return z(this,void 0,void 0,(function(){var B,G,W,z,J,Q=this;return K(this,(function(K){switch(K.label){case 0:if(B=F.factorsJson,G=F.tokenType,W=F.requestMetadataJson,z=F.invalidToken,this.logger.info("[onTokenRequired] factorsJson=".concat(B," tokenType=").concat(G)),this.clientSupportsGenericTokenAPI&&this.tokenCallback&&B&&G)return[3,2];if(!this.tokenProvider)throw new Error("[onTokenRequired]: Attempt to fetch skypeToken is not provided or already removed, factorsJson=".concat(B));return[4,this.tokenProvider()];case 1:return[2,{token:K.sent(),tokenType:1}];case 2:return this.tokensPromiseMap[B]?(this.logger.info("[onTokenRequired] factorsJson=".concat(B," has pending request")),[2,this.tokensPromiseMap[B].promise]):(J=new Promise((function(F,z){Q.tokensPromiseMap[B]={reject:z,resolve:F,promise:void 0,tokenRequestOptions:{factorsJson:B,tokenType:G,requestMetadataJson:W}}})),this.tokensPromiseMap[B].promise=J,this.tokenCallback({factorsJson:B,tokenType:G,requestMetadataJson:W,invalidToken:z}),[2,J])}}))}))},AuthTokenManager.prototype.setTokenRequiredCallBack=function(F){this.tokenCallback=F},AuthTokenManager.prototype.setDisableTimerFlag=function(F){this.logger.info("[setDisableTimerFlag] set disableTimerFlag to ".concat(F)),this.stopTimerFlag=F},AuthTokenManager.prototype.setTimerToRefreshToken=function(F,B,G){var W=this,z=B.factorsJson,K=B.tokenType,J=G;if(!J||J<=this.refreshTimeBeforeTokenTimeoutInSeconds)if(4===K)J=this.aadTokenExpirationTimeInSeconds;else J=Y;this.logger.info("[".concat(F,"][setTimerToRefreshToken] set timeout for refresing to ").concat(J," tokenType=").concat(K," factorsJson=").concat(z)),setTimeout((function(){W.stopTimerFlag?W.logger.info("[".concat(F,"][setTimerToRefreshToken] stopTimerFlag=true so cancel timer")):(W.logger.info("[".concat(F,"][setTimerToRefreshToken] refreshing token with timeout=").concat(J," tokenType=").concat(K," factorsJson=").concat(z)),W.getToken(F,!0,B))}),1e3*(J-this.refreshTimeBeforeTokenTimeoutInSeconds))},AuthTokenManager}();B.AuthTokenManager=$,B.authTokenManagerFactory={build:function(F,B,G){return new $(F,B,G)}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function CacheTokenManager(){this.skypeToken="",this.aadToken=""}return CacheTokenManager.prototype.getToken=function(F,B){return 4&F&&this.aadToken?{token:this.aadToken,tokenType:4}:1&F&&this.skypeToken?{token:this.skypeToken,tokenType:1}:null},CacheTokenManager.prototype.setToken=function(F,B,G){switch(F){case 4:this.aadToken=B;break;case 1:this.skypeToken=B;break;default:throw new Error("Invalid tokenType ".concat(F))}},CacheTokenManager.prototype.invalidateCachedToken=function(F){4&F&&(this.aadToken=""),1&F&&(this.skypeToken="")},CacheTokenManager}();B.default=W},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},J=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.build=B.SignalingSession=void 0;var Q=G(8),Y=G(41),$=G(14),X=G(45),Z=G(212),ee=G(213),te=G(26),ne=G(214),ie=G(215),re=G(216),oe=G(217),ae=G(226),se=G(230),ce=G(72),le=G(234),de=G(76),ue=G(249),pe=G(108),he=G(250),ge=G(251),fe=G(252),me=G(253),ve=G(254),ye=G(255),Se=G(256),_e=G(257),Ce=G(258),Te=G(259),Ee=G(260),be=G(261),Ie=G(262),Ae=G(263),Re=G(264),Pe=G(265),Oe=G(266),Me=G(267),we=G(268),De=G(269),Ne=G(270),Le=G(271),ke=G(272),Fe=G(273),xe=G(274),Ue=G(275),je=G(276),Be=G(277),He=G(278),Ve=G(279),Ge=G(280),We=G(281),qe=G(282),ze=G(283),Ke=G(284),Je=G(25),Qe=G(285),Ye=G(5),$e=G(74),Xe=G(48),Ze=G(3),et=G(289),tt=function(){function SignalingSession(F,B,G,z,K,X){var ee=this;this.disposed=!1,this.convSubject=null,this.groupId=null,this.threadId=null,this.incomingCallCallerId=null,this.incomingCallPayload=null,this.multiParty=!0,this.isIncomingCall=!1,this.isHostLessCall=!1,this.isCastCall=!1,this.numberOfOriginalInvitees=0,this.teamsMessageId=null,this.enableGroupCallMeetupGeneration=!1,this.meetingInfo=null,this.meetingDetails=null,this.emergencyContent=null,this.transferContext=null,this.callType="default",this.callMode=0,this.transferor=null,this.onBehalfOf=null,this.endpointMetadata={},this.sessionId=Ze.newGuid(),this.remoteCaller=null,this.acceptedElsewhereBy=null,this.breakoutDetails=null,this.callLimits=null,this.realTimeState=0,this.disposing=!1,this.links={},this.provisionalMediaAnswersSeenSoFar=[],this.incomingTrouterMessagesSeenSoFar=[],this.incomingBrokerMessagesSeenSoFar=[],this.currentCallStatus=null,this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,this.convJoined=!1,this.keepAliveTimer=null,this.keepAliveInterval=null,this.keepAliveCount=1,this.keepAliveTimerLwj=null,this.keepAliveIntervalLwj=null,this.keepAliveCountLwj=1,this.conversationKeepAliveTimer=null,this.conversationKeepAliveInterval=null,this.conversationKeepAliveCount=1,this.remoteUser=null,this.mediaTypesToUse=null,this.lastUsedOutgoingMediaContent=null,this.lastUsedJoinCallOptions=null,this.originalRoleBeforePreheat="",this.endpointStateSequenceNumber=0,this.publishStateSequenceNumber=0,this.linkUpdateRequested={conversationLinks:!1,keepAliveLinks:!1},this.incomingMessageSyncResponseCache={},this.joinedLightWeight=!1,this.isPreheatOnly=!1,this.callStartTime=(new Date).getTime(),this.callUsesMixer=!1,this.disablePreheatDefer=Ze.defer(),this.participantReplacementDetails={},this.meetingLiveStateSequenceNumber=0,this.meetingLayoutSequenceNumber=0,this.localParticipantUpdateSequenceNumber=0,this.isRedirectAllowed=!1,this.updateSequenceNumber=-1,this.isPromotingToRealtime=!1,this.updateEndpointState=function(F,B){void 0===B&&(B=Ze.causeId()),ee.logger.info("[".concat(B,"][updateEndpointState=").concat((0,$.getPrintableObject)(F.state),"]"));var G=ee.links[Ye.default.LINKS.UPDATE_ENDPOINT_STATE],z=ee.getEndpointState(),K=W(W(W({},z),F),{endpointStateSequenceNumber:++ee.endpointStateSequenceNumber});ee.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_ENDPOINT_STATE,{newEndpointState:K,causeId:B});var preheatDisabledInNewState=function(F){var B;return 0===(null===(B=null==F?void 0:F.endpointProperties)||void 0===B?void 0:B.preheatProperties)};return preheatDisabledInNewState(K)&&ee.isPreheatOnly&&(ee.telemetryHelper.recordEvent(Je.EVENTS.PREHEAT_DISABLING,{causeId:B}),ee.telemetryHelper.startPreheatedCallSetupDurationWatch(),ee.telemetryHelper.startCallCancelationDurationWatch()),2===ee.callMode&&preheatDisabledInNewState(K)?(ee.logger.info("[".concat(B,"][updateEndpointState skipped as mode is streaming]")),ee.requestedEndpointStateWhileConnecting=null,ee.handlePreheatDisabled(B),Promise.resolve()):ee.fsmState!==Ye.default.SIGNALING_FSM_STATE.CONNECTED?(ee.logger.info("[".concat(B,"][updateEndpointState will be queued as we don't have a link yet]")),ee.requestedEndpointStateWhileConnecting=F,preheatDisabledInNewState(K)?ee.disablePreheatDefer.promise:Promise.resolve()):ee.shouldUpdateEndpointState(z,K)||ee.http.hasPendingRequest(Je.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE.name)?G?(ee.latestEndpointState=K,ee.http.sendPostRequest({url:G,requestName:Je.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE.name,payload:He.getPayload(ee,K),causeId:B}).then((function(){ee.disposed||(ee.requestedEndpointStateWhileConnecting=null,preheatDisabledInNewState(K)&&ee.handlePreheatDisabled(B))})).catch((function(F){var G=Ze.getErrorForXHRFailure(F,ee.signalingAgentConfig);return ee.logger.info("[".concat(B,"][updateEndpointState] error: ").concat((0,$.getPrintableObject)(G))),Promise.reject(G.error)}))):(ee.logger.info("[".concat(B,"][updateEndpointState operation cannot be performed now, the link is not yet available]")),Promise.reject("No link")):(ee.logger.info("[".concat(B,"][updateEndpointState will ignore current update as there is nothing new to send]")),Promise.reject("Ignored"))},this.setParticipantCallLinks=function(F){F&&F.endpointDetails&&(ee.participantReplacementDetails[F.id]={},F.endpointDetails.forEach((function(B){B&&B.callLinks&&(ee.participantReplacementDetails[F.id][B.participantId]=B.callLinks)})))},this.clearParticipantCallLinks=function(F){ee.participantReplacementDetails&&ee.participantReplacementDetails.hasOwnProperty(F)&&delete ee.participantReplacementDetails[F]},this.getReplacementDetailsByParticipantLeg=function(F,B,G){return void 0===G&&(G=Ze.causeId()),ee.logger.info("[".concat(G,"]getReplacementDetailsByParticipantLeg: participantMri ").concat((0,$.getPIISafeObject)(F)," participantLegId ").concat(B)),ee.participantReplacementDetails&&ee.participantReplacementDetails.hasOwnProperty(F)&&ee.participantReplacementDetails[F].hasOwnProperty(B)?{replaces:ee.participantReplacementDetails[F][B].replacement,replacementTargetParticipantId:B}:(ee.logger.info("[".concat(G,"]getReplacementDetailsByParticipantLeg: unable to find replacement details for participantLegId ").concat(B)),{})},this.getReplacementDetailsByParticipantLegOfCall=function(F,B,G,W){void 0===W&&(W=Ze.causeId()),ee.logger.info("[".concat(W,"]getReplacementDetailsByParticipantLegOfCall: callId ").concat(F," participantMri ").concat((0,$.getPIISafeObject)(B)," participantLegId ").concat(G));var z=ee.signalingAgent.getSignalingSession(F);return z?z.getReplacementDetailsByParticipantLeg(B,G,W):{}},this.getMriByParticipantLegOfCall=function(F,B,G){ee.logger.info("[".concat(G,"]getMriByParticipantLegOfCall: callId: ").concat(F," participantLegId ").concat(B));var W=ee.signalingAgent.getSignalingSession(F);return W?W.getMriByParticipantLeg(B,G):""},this.getMriByParticipantLeg=function(F,B){var G,W;ee.logger.info("getMriByParticipantLeg[".concat(B,"] participantLegId ").concat(F));try{for(var z=J(Object.keys(ee.participantReplacementDetails)),K=z.next();!K.done;K=z.next()){var Q=K.value;if(Q&&ee.participantReplacementDetails.hasOwnProperty(Q)&&ee.participantReplacementDetails[Q]&&ee.participantReplacementDetails[Q].hasOwnProperty(F))return Q}}catch(F){G={error:F}}finally{try{K&&!K.done&&(W=z.return)&&W.call(z)}finally{if(G)throw G.error}}return""},this.handlePreheatDisabled=function(F){ee.isPreheatOnly=!1,ee.telemetryHelper.setSelfParticipantRole(ee.originalRoleBeforePreheat),ee.telemetryHelper.recordEvent(Je.EVENTS.PREHEAT_DISABLED,{causeId:F}),ee.telemetryHelper.resetCallCancelationDurationWatch(),ee.telemetryHelper.stopPreheatedCallSetupDurationWatch(),ee.telemetryHelper.startCallConnectedWatch(),ee.stopCallPreheatTimer(),ee.disablePreheatDefer.isPending()&&ee.disablePreheatDefer.resolve()},this.shouldUpdateEndpointState=function(F,B){var G,W;if(!B)return!1;var z=B.state&&B.state.isMuted?1:0,K=B.endpointProperties&&1===B.endpointProperties.preheatProperties?1:0,J=F&&F.state&&F.state.isMuted?1:0,Q=F&&F.endpointProperties&&1===F.endpointProperties.preheatProperties?1:0,Y=null===(G=null==F?void 0:F.endpointProperties)||void 0===G?void 0:G.additionalEndpointProperties,$=null===(W=null==B?void 0:B.endpointProperties)||void 0===W?void 0:W.additionalEndpointProperties;return!!(z^J||K^Q||$!==Y)},this.setInitialTelemetry=function(F,B){var G,W;switch(F){case Y.CALL_OPERATIONS.SUBSCRIBE:ee.telemetryHelper.recordEvent(Je.EVENTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,{causeId:B.causeId,correlationId:B.correlationId}),ee.telemetryHelper.setDirection(Je.default.DIRECTION.INCOMING),ee.telemetryHelper.setSelfParticipantRole(Je.default.ROLE.JOIN_FOR_ROSTER_ONLY),ee.telemetryHelper.setConversationServiceUrl(B.conversationServiceUrl||ee.signalingAgentConfig.conversationServiceUrl),ee.telemetryHelper.setCallerType(ee.participantManager.localParticipant.id);break;case Y.CALL_OPERATIONS.ACKNOWLEDGE:ee.telemetryHelper.recordEvent(Je.EVENTS.HANDLE_INCOMING_CALL,{causeId:B.causeId}),ee.telemetryHelper.setDirection(Je.default.DIRECTION.INCOMING),ee.telemetryHelper.setSelfParticipantRole(Je.default.ROLE.CALLEE),ee.telemetryHelper.setCalleeType(ee.participantManager.localParticipant.id);break;case Y.CALL_OPERATIONS.JOIN_CALL:G=ee.gatherTelemetryForStartOrJoin(B.joinCallOptions,B.causeId,B.offerGenerationTime),ee.telemetryHelper.recordEvent(Je.EVENTS.JOIN_CALL,G),ee.telemetryHelper.setDirection(Je.default.DIRECTION.INCOMING),ee.telemetryHelper.setSelfParticipantRole(Je.default.ROLE.JOIN);break;case Y.CALL_OPERATIONS.START_CALL:case Y.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL:case Y.CALL_OPERATIONS.START_CALL_WITH_NUDGE:case Y.CALL_OPERATIONS.START_CALL_AND_UNPARK:W=ee.gatherTelemetryForStartOrJoin(B.callStartOptions,B.causeId,B.offerGenerationTime),ee.telemetryHelper.recordEvent(Je.EVENTS.START_CALL,W),ee.telemetryHelper.setDirection(Je.default.DIRECTION.OUTGOING),ee.telemetryHelper.setSelfParticipantRole(Je.default.ROLE.CALLER),ee.telemetryHelper.startCallInitializationWatch(B.offerGenerationTime),ee.telemetryHelper.setMeetingInfo(ee.getMeetingInfo())}},this.getParticipantIdForOfferAnswer=function(F){Ze.assertNotNull(F,"mediaContent should be a non null value"),ee.logger.info("getParticipantIdForOfferAnswer");var B=null;return!ee.remoteUser||ee.groupId||ee.threadId||F.newOffer||F.escalationOccurring||(B=ee.remoteUser.id),B},this.getMeetingInfo=function(){return ee.meetingInfo},this.getEmergencyContent=function(){return ee.telemetryHelper.recordEvent(Je.EVENTS.GET_EMERGENCY_CONTENT),ee.emergencyContent},this.getEndpointId=function(){return ee.signalingAgent.endpointId},this.getConversationUrl=function(){return ee.links[Ye.default.LINKS.CONVERSATION_CONTROLLER]},this.setJoinedFrom=function(F){!ee.disposed&&F&&(ee.telemetryHelper.recordEvent(Je.EVENTS.SET_JOINED_FROM),ee.telemetryHelper.setJoinedFrom(F))},this.setMeetingCode=function(F){!ee.disposed&&F&&ee.telemetryHelper.setMeetingCode(F)},this.setMeetingUrl=function(F){!ee.disposed&&F&&ee.telemetryHelper.setMeetingUrl(F)},this.setSubject=function(F){ee.disposed||(ee.telemetryHelper.recordEvent(Je.EVENTS.SET_SUBJECT),Ze.assertNotNull(F,"subject should be a non null value"),ee.convSubject=F)},this.setDeviceType=function(F){ee.disposed||(ee.telemetryHelper.recordEvent(Je.EVENTS.SET_DEVICETYPE),F&&(ee.deviceType=F,ee.logger.info("setDeviceType",ee.deviceType)))},this.setOfferAnswerGenerationTimestamps=function(F){ee.disposed||ee.telemetryHelper.setOfferAnswerGenerationTimestamps(F)},this.setTimeToRingDuration=function(){ee.disposed||ee.telemetryHelper.setTimeToRingDuration()},this.setGroupId=function(F){ee.telemetryHelper.recordEvent(Je.EVENTS.SET_GROUPID),ee.groupId!==F&&F&&(Ze.assert(!ee.groupId,"conversation groupId has already been set. It cannot be overwritten"),ee.groupId=F)},this.setThreadId=function(F){ee.telemetryHelper.recordEvent(Je.EVENTS.SET_THREADID),Ze.assertNotNull(F,"threadId should be a non null value"),ee.threadId!==F&&(Ze.assert(!ee.threadId,"conversation threadId has already been set. It cannot be overwritten"),ee.threadId=F)},this.setCallOptions=function(F){if(Ze.assertNotNull(F,"callOptions should be a non null value"),ee.logger.info("setCallOptions",(0,$.getPrintableObject)(F)),ee.telemetryHelper.recordEvent(Je.EVENTS.SET_CALLOPTIONS),F){ee.teamsMessageId=F.teamsMessageId||null,ee.meetingInfo=F.meetingInfo||null,ee.emergencyContent=F.emergencyContent||null,ee.enableGroupCallMeetupGeneration=F.enableGroupCallMeetupGeneration||!1,F.broadcastContext&&(ee.broadcastSession=new ne.default(ee,ee.signalingSessionCallback),ee.broadcastSession.setContext(F.broadcastContext));try{ee.endpointMetadata=JSON.parse(F.endpointMetadata)}catch(F){ee.logger.warn("Unable to parse endpoint metadata")}}},this.setTransferContext=function(F){Ze.assertNotNull(F,"transferContext should not be null"),ee.logger.info("Transfer: setTransferContext",F),ee.telemetryHelper.recordEvent(Je.EVENTS.SET_TRANSFER_CONTEXT),ee.transferContext=F},this.muteAsync=function(F,B,G){return void 0===G&&(G=Ze.causeId()),Ze.assert(2!==ee.callMode||F!==Ye.default.MUTE_SCOPE.MYSELF,"mute self operation is not allowed in streaming mode"),ee.logger.info("[".concat(G,"][muteAsync][scope=").concat(F,"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.MUTE,{causeId:G}),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"[".concat(G,"]mute operation for all or specified only allowed in a connected call")),ee.participantManager.muteAsync(ee.links[Ye.default.LINKS.MUTE],F,B,G)},this.unmuteAsync=function(F){return void 0===F&&(F=Ze.causeId()),Ze.assert(2!==ee.callMode,"unmute operation is not allowed in streaming mode"),ee.logger.info("[".concat(F,"][unmuteAsync]")),ee.telemetryHelper.recordEvent(Je.EVENTS.UNMUTE,{causeId:F}),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"unmute operation only allowed in a connected call"),ee.participantManager.unmuteAsync(ee.links[Ye.default.LINKS.UNMUTE],F)},this.recordTelemetryForStartAudio=function(F,B){return ee.telemetryHelper.recordEvent(Je.EVENTS.START_AUDIO,{mediaNegotiationStatus:F,causeId:B}),Promise.resolve(null)},this.recordTelemetryForStopAudio=function(F,B){return ee.telemetryHelper.recordEvent(Je.EVENTS.STOP_AUDIO,{mediaNegotiationStatus:F,causeId:B}),Promise.resolve(null)},this.rejectUnmuteRequestAsync=function(F,B,G){return void 0===B&&(B=Ze.causeId()),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"rejectUnmute operation only allowed in a connected call"),Ze.assertNotNullOrEmpty(F,"requestor must be specified"),ee.logger.info("[".concat(B,"][rejectUnmuteRequestAsync][rejectionReason=").concat(G,"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.REJECT_UNMUTE,{causeId:B,rejectionReason:G}),ee.participantManager.rejectUnmuteRequestAsync(F,B,G)},this.approveUnmuteRequestAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"approveUnmute operation only allowed in a connected call"),Ze.assertNotNullOrEmpty(F,"requestor must be specified"),ee.logger.info("[".concat(B,"][approveUnmuteRequestAsync]")),ee.telemetryHelper.recordEvent(Je.EVENTS.APPROVE_UNMUTE,{causeId:B}),ee.participantManager.approveUnmuteRequestAsync(F,B)},this.sendWebRtcMediaNotificationAsync=function(F,B,G){return void 0===G&&(G=Ze.causeId()),Ze.assert(2!==ee.callMode,"sendWebRtcMediaNotification operation is not allowed in streaming mode"),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"webRtc media notification can only be sent in a connected call"),ee.telemetryHelper.recordEvent(Je.EVENTS.SEND_WEBRTC_MEDIA_NOTIFICATION,{causeId:G}),0===F?ee.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:Je.NETWORK_REQUESTS.SEND_APPLY_CHANNEL_PARAMETERS.name,requestUrl:ee.links[Ye.default.LINKS.APPLY_CHANNEL_PARAMETERS],requestBody:B,stackRetry:!1},G):ee.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:Je.NETWORK_REQUESTS.SEND_CONTROL_VIDEO_STREAMING.name,requestUrl:ee.links[Ye.default.LINKS.CONTROL_VIDEO_STREAMING],requestBody:B},G)},this.addParticipantsAsync=function(F,B,G){void 0===G&&(G=Ze.causeId()),Ze.assertNotNullOrEmpty(F,"remoteParticipants should be a non null value"),Ze.assert(ee.isCallOngoing()||ee.isCallIdleOrRosterOnly(),"remoteParticipants can only be added before starting an outgoing call or to an ongoing call"),ee.logger.info("[".concat(G,"][addParticipantsAsync][addParticipantOptions=").concat((0,$.getPrintableObject)(B),"]\n            [remoteParticipantId=").concat(F.map((function(F){return ee.piiUtils.scrubMriOrOmit(F.id)})),"]"));var W=Je.EVENTS.ADD_PARTICIPANT;switch(B.replacementType){case 2:W=Je.EVENTS.ADD_PARTICIPANT_WITH_PICKUP_CODE;break;case 1:case 3:W=Je.EVENTS.ADD_PARTICIPANT_WITH_REPLACES;break;default:W=Je.EVENTS.ADD_PARTICIPANT}ee.telemetryHelper.recordEvent(W,{causeId:G}),B.groupId=ee.groupId||B.groupId,B.threadId=ee.threadId||B.threadId;var z=B.threadId||B.groupId?ee.links[Ye.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:ee.links[Ye.default.LINKS.ADD_PARTICIPANT],K=ee.participantManager.addParticipantsAsync(F,z,ee.isCallConnectedOrConnectedForRoster(),B,G);return ee.currentCallStatus||ee.setMultiParty(1!==ee.participantManager.getParticipantsToInitiateCallWith().length,G),K},this.addGroupModalityAsync=function(F,B){Ze.assert(ee.isCallOngoing(),"GroupModality can only be added before starting an outgoing call or to an ongoing call"),ee.logger.info("[".concat(B,"][addGroupModalityAsync][addGroupModalityOptions=").concat((0,$.getPrintableObject)(F),"]"));var G=Je.EVENTS.ADD_PARTICIPANTS_AND_MODALITY;ee.telemetryHelper.recordEvent(G,{causeId:B});var W=pe.getPayload(ee,null,F);return ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY],payload:W,requestName:Je.NETWORK_REQUESTS.ADD_PARTICIPANTS_AND_MODALITY.name,causeId:B}).then((function(){Q.noop()})).catch((function(F){var G=Ze.getErrorForXHRFailure(F,ee.signalingAgentConfig);throw ee.logger.info("[".concat(B,"][sendNetworkRequestForAddingParticipant] failed:").concat((0,$.getPrintableObject)(G))),G.error}))},this.addBroadcastModalityAsync=function(F,B){if(Ze.assert(ee.isCallOngoing(),"BroadcastModality can only be added before starting an outgoing call or to an ongoing call"),ee.logger.info("[".concat(B,"][addBroadcastModalityAsync][addBroadcastContext=").concat((0,$.getPrintableObject)(ee.addBroadcastModalityAsync),"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.ADD_BROADCAST_MODALITY,{causeId:B}),ee.broadcastSession){var G="There is already a broadcast session";return ee.logger.info(G),Promise.resolve(Ye.default.SUCCESS_TRANSACTION_END)}ee.broadcastSession=new ne.default(ee,ee.signalingSessionCallback),ee.broadcastSession.setContext(F);var W=ue.getPayload(ee,F);return ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.ADD_MODALITY],payload:W,requestName:Je.NETWORK_REQUESTS.ADD_BROADCAST_MODALITY.name,causeId:B}).then((function(F){return ee.logger.info("[".concat(B,"][addBroadcastModalityAsync] response: ").concat((0,$.getPrintableObject)(F))),ee.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_ADD_BROADCAST_MODALITY_COMPLETION,{causeId:B}),Ye.default.SUCCESS_TRANSACTION_END})).catch((function(F){var G=Ze.getErrorForXHRFailure(F);return ee.logger.info("[".concat(B,"][sendNetworkRequestForAddBroadcastModalityAsync] failed:").concat((0,$.getPrintableObject)(G))),ee.endBroadcastMeeting(B),Promise.reject(G.error)}))},this.nudgeParticipantsAsync=function(F){if(Ze.assertNotNull(F.participantsIds,"ParticipantsIds should be a non null value"),Ze.assert(ee.isCallOngoing(),"Participants can only be nudged before starting an outgoing call or to an ongoing call"),ee.logger.info("[".concat(F.causeId,"][nudgeParticipantsAsync][participantsIds=").concat(ee.piiUtils.scrubParticipantsList(F.participantsIds),"][invitationData=").concat(F.invitationData,"]")),void 0===F.participantsIds||F.participantsIds.length<1)return Promise.reject("List of participants to nudge is empty");ee.telemetryHelper.recordEvent(Je.EVENTS.ADD_PARTICIPANT,{withNudge:Ye.default.INVITATION_TYPE.NUDGE,causeId:F.causeId});var B=ee.groupId||F.newGroupId,G=ee.threadId||F.newThreadId,W=ee.teamsMessageId||F.newMessageId,z=G||B?ee.links[Ye.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:ee.links[Ye.default.LINKS.ADD_PARTICIPANT];return ee.participantManager.nudgeParticipantsAsync(F.participantsIds,z,ee.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING||ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,F.causeId,F.invitationData,B,G,W)},this.callMeBackAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),Ze.assertNotNull(F,"remoteParticipant should be a non null value"),ee.logger.info("[".concat(B,"][callMeBackAsync][remoteParticipantId=").concat(ee.piiUtils.scrubMriOrOmit(F.id),"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.CALL_ME_BACK,{causeId:B}),ee.hasGroupModality()||Ze.assert(!1,"threadId/groupId must be set before using call me back"),ee.participantManager.callMeBackAsync(F,ee.links[Ye.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY],B)},this.removeParticipantAsync=function(F,B,G){switch(void 0===B&&(B=Ze.causeId()),void 0===G&&(G="none"),Ze.assertNotNull(F,"remoteParticipant should be a non null value"),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"participants can only be removed from an ongoing call"),ee.logger.info("[".concat(B,"][removeParticipantAsync][remoteParticipantId=").concat(ee.piiUtils.scrubMriOrOmit(F.id),"] [removeEndpointScope] ").concat(G)),G){case"all":ee.telemetryHelper.recordEvent(Je.EVENTS.REMOVE_PARTICIPANT_OTHERS,{causeId:B});break;case"specified":ee.telemetryHelper.recordEvent(Je.EVENTS.REMOVE_PARTICIPANT_SPECIFIED,{causeId:B});break;default:ee.telemetryHelper.recordEvent(Je.EVENTS.REMOVE_PARTICIPANT,{causeId:B})}return"none"!==G&&F.endpointId?ee.participantManager.removeParticipantEndpointAsync(F,ee.links[Ye.default.LINKS.REMOVE_PARTICIPANT],G,B):ee.participantManager.removeParticipantAsync(F,ee.links[Ye.default.LINKS.REMOVE_PARTICIPANT],B)},this.admitParticipantAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),Ze.assertNotNull(F,"remoteParticipant should be a non null value"),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"remoteParticipants can only be admitted to an ongoing call"),ee.hasGroupModality()||Ze.assert(!1,"threadId/groupId must be set before admitting more participants to connected call"),ee.logger.info("[".concat(B,"][admitParticipantAsync][remoteParticipantId=").concat(ee.piiUtils.scrubMriOrOmit(F.id),"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.ADMIT_PARTICIPANT,{causeId:B}),ee.participantManager.admitParticipantAsync(F,ee.links[Ye.default.LINKS.ADMIT],B)},this.admitAsync=function(F){if(ee.logger.info("[".concat(F,"][admitAsync]")),ee.telemetryHelper.recordEvent(Je.EVENTS.ADMIT,{causeId:F}),!ee.links[Ye.default.LINKS.ADMIT_ALL]){var B={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.ADMIT_ALL_LINK_MISSING,phrase:Ye.default.CALL_END_PHRASE.ADMIT_ALL_URL_MISSING};return ee.telemetryHelper.recordEvent(Je.EVENTS.ADMIT_FAILURE,{causeId:F,transactionEnd:B}),ee.logger.warn("admitAsync error ".concat(JSON.stringify(B))),Promise.reject(B)}var G=Ze.defer();return ee.callOperationHandler.setPendingOperation(0,F,{promise:G,causeId:F},F),ee.sendNetworkRequestForAdmit(F),G.promise},this.updateMeetingRolesAsync=function(F,B,G){return void 0===G&&(G=Ze.causeId()),Ze.assertNotNull(F,"participants array should be a non null value"),Ze.assertNotNull(B,"meetingRole should be a non null value"),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"remote participant roles can only be updated in an ongoing call"),ee.logger.info("[".concat(G,"][updateMeetingRolesAsync][participants=").concat(ee.piiUtils.scrubMriOrOmit(F),"]")),ee.participantManager.updateMeetingRolesAsync(F,B,ee.links[Ye.default.LINKS.UPDATE_PARTICIPANT_ROLE],G)},this.startContentSharingAsync=function(F,B,G,W,z){return void 0===z&&(z=Ze.causeId()),Ze.assertNotNull(F,"contentIdentifier should be a non null value"),Ze.assert(ee.isCallOngoing(),"contentSharing can only be added before starting an outgoing call or to an ongoing call"),ee.logger.info("[".concat(z,"][startContentSharingAsync]")),ee.telemetryHelper.recordEvent(Je.EVENTS.ADD_CONTENT_SHARING_MODALITY,{causeId:z}),ee.contentSharingManager.startContentSharingAsync(F,B,G,ee.links[Ye.default.LINKS.ADD_MODALITY],ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,z,W)},this.deleteContentSharingAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),ee.logger.info("[".concat(B,"][deleteContentSharingAsync][correlationId=").concat(F,"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.DELETE_CONTENT_SHARING,{causeId:B,correlationId:F}),ee.contentSharingManager.deleteContentSharingAsync(F,B)},this.joinContentSharingAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),ee.logger.info("[".concat(B,"][joinContentSharingAsync][correlationId=").concat(F,"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.JOIN_CONTENT_SHARING,{causeId:B,correlationId:F}),ee.contentSharingManager.joinContentSharingAsync(F,B)},this.updateContentSharingSessionStateAsync=function(F,B,G){return void 0===G&&(G=Ze.causeId()),Ze.assertNotNull(B,"sessionState should be a non null value"),ee.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_SESSION_STATE_CONTENT_SHARING,{causeId:G,correlationId:F}),ee.logger.info("[".concat(G,"][updateContentSharingSessionStateAsync][correlationId=").concat(F,"][sessionState=").concat(B,"]")),ee.contentSharingManager.updateContentSharingSessionStateAsync(F,B,G)},this.takeContentSharingControlAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),ee.telemetryHelper.recordEvent(Je.EVENTS.TAKE_CONTROL_CONTENT_SHARING,{causeId:B,correlationId:F}),ee.logger.info("[".concat(B,"][takeContentSharingControlAsync][correlationId=").concat(F,"]")),ee.contentSharingManager.takeContentSharingControlAsync(F,B)},this.updateContentSharingParticipantStateAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),ee.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING,{causeId:B}),ee.logger.info("[".concat(B,"][updateContentSharingParticipantStateAsync][correlationId=").concat(F,"]")),ee.contentSharingManager.updateContentSharingParticipantStateAsync(F,B)},this.configureEndpointStateForStartOrJoin=function(F){var B={endpointStateSequenceNumber:ee.endpointStateSequenceNumber},G=!1;if(F&&(F.muted&&(G=!0,Object.assign(B,{state:{isMuted:F.muted}})),F.isPreheatOnly||F.additionalEndpointProperties)){var W={};G=!0,F.isPreheatOnly&&(W.preheatProperties=1),F.additionalEndpointProperties&&(W.additionalEndpointProperties=F.additionalEndpointProperties),Object.assign(B,{endpointProperties:W})}if(G)return B},this.gatherTelemetryForStartOrJoin=function(F,B,G){var W={causeId:B};return F&&(F.invitationType===Ye.default.INVITATION_TYPE.NUDGE&&(W.withNudge=F.invitationType===Ye.default.INVITATION_TYPE.NUDGE),F.parkContext&&(W.unpark=!0,W.context=F.parkContext),F.isLwj&&(W.isLwj=!0),F.isPreheatOnly&&(W.isPreheatOnly=!0)),W},this.startOutgoingCall=function(F,B,G,W,z){if(void 0===z&&(z=Ze.causeId()),G&&G.isLwj?ee.joinedLightWeight=!0:(Ze.assertNotNull(F,"mediaContent should be a non null value"),Ze.assertNotNull(F.blob,"outgoingSdp should be a non null value")),Ze.assert(ee.isCallIdleOrRosterOnly(),"a call is already in progress"),ee.logger.info("[".concat(z,"][startOutgoingCall][start] applicationType=").concat(ee.participantManager.localParticipant.applicationType)),ee.disposed)ee.logger.warn("[".concat(z,"][startOutgoingCall][failed][reason=Session disposed]"));else{ee.lastUsedJoinCallOptions={muted:G?G.muted:null,scenario:G?G.scenario:null,isPreheatOnly:G?G.isPreheatOnly:null,clientEndpointCapabilities:G?G.clientEndpointCapabilities:null,clientEndpointDebugContent:G?G.clientEndpointDebugContent:null},ee.originalRoleBeforePreheat=Je.default.ROLE.CALLER,G&&G.scenario&&ee.telemetryHelper.setScenario(G.scenario),ee.logger.info("[".concat(z,"][startOutgoingCall]options=").concat((0,$.getPrintableObject)(ee.gatherTelemetryForStartOrJoin(G,z,W)))),ee.isBrokerEnabledForOutgoingCall()&&ee.setupBrokerChannel(),ee.callUsesMixer=!(!G||!G.callUsesMixer),ee.fsmState=Ye.default.SIGNALING_FSM_STATE.OUTGOING,ee.meetingData=G&&G.meetingData,ee.meetingPreferences=G&&G.meetingPreferences;var K={newCall:!0,suppressDialout:G&&G.suppressDialout||!1,conversationServiceUrl:ee.signalingAgentConfig.conversationServiceUrl,onBehalfOf:G?G.onBehalfOf:null,enableLightWeightMeeting:G?G.isLwj:null,callToVoicemail:!!G&&G.callToVoicemail,voicemailResourcePath:G?G.voicemailResourcePath:null,voicemailItemId:G?G.voicemailItemId:null,endpointState:ee.configureEndpointStateForStartOrJoin(G),invitationType:G&&G.invitationType?G.invitationType:null,participantsToNudge:G&&Array.isArray(G.participantsToNudge)?G.participantsToNudge:null,routingFlags:G?G.routingFlags:null,parkContext:G?G.parkContext:null,pickupCode:G?G.pickupCode:null,scenario:G?G.scenario:null,isPreheatOnly:!!G&&G.isPreheatOnly,applicationType:ee.participantManager.localParticipant.applicationType,clientEndpointCapabilities:G?G.clientEndpointCapabilities:0,clientEndpointDebugContent:G?G.clientEndpointDebugContent:null,invitationData:G?G.invitationData:null,conversationType:G?ee.getConversationType(G.isEmergency,G.castCall):null,meetingData:ee.meetingData,meetingPreferences:ee.meetingPreferences,alternateId:G?G.alternateId:null,meetingRegistrationId:G.meetingRegistrationId};ee.isCastCall=G&&G.castCall,ee.onBehalfOf=K.onBehalfOf,ee.startOrJoinCall(K,Je.NETWORK_REQUESTS.START_CALL.name,z,F,B)}},this.joinGivenConversation=function(F,B,G,W,z,K,J){if(void 0===K&&(K={}),void 0===J&&(J=Ze.causeId()),Ze.assertNotNull(B,"correlationId should be a non null value"),Ze.assertNotNullOrEmpty(F||ee.getConversationUrl(),"conversationUrl should be a non null value"),K.isLwj?ee.joinedLightWeight=!0:(Ze.assertNotNull(G,"mediaContent should be a non null value"),Ze.assertNotNull(G.blob,"outgoingSdp should be a non null value")),ee.isPromotingToRealtime=2===ee.callMode,Ze.assert(ee.isCallIdleOrRosterOnly()||ee.isPromotingToRealtime,"a call is already in progress"),ee.logger.info("[".concat(J,"][joinGivenConversation][start][correlationId=").concat(B,"] applicationType=").concat(ee.participantManager.localParticipant.applicationType)),ee.disposed)ee.logger.warn("[".concat(J,"][joinGivenConversation][failed][reason=Session disposed]"));else{var Q=ee.gatherTelemetryForStartOrJoin(K,J,z);ee.lastUsedJoinCallOptions=K,ee.originalRoleBeforePreheat=Je.default.ROLE.JOIN,ee.telemetryHelper.startCallInitializationWatch(z),K&&K.scenario&&ee.telemetryHelper.setScenario(K.scenario),ee.logger.info("[".concat(J,"][joinGivenConversation]options=").concat((0,$.getPrintableObject)(Q))),ee.isBrokerEnabledForIncomingCall()&&ee.setupBrokerChannel(),ee.fsmState=Ye.default.SIGNALING_FSM_STATE.OUTGOING,ee.updateCorrelationId(B,J),ee.meetingData=K&&K.meetingData,ee.meetingPreferences=K&&K.meetingPreferences;var Y={newCall:!1,suppressDialout:!0,conversationServiceUrl:F,enableLightWeightMeeting:K.isLwj,endpointState:ee.configureEndpointStateForStartOrJoin(K),scenario:K?K.scenario:null,isPreheatOnly:!!K&&K.isPreheatOnly,applicationType:ee.participantManager.localParticipant.applicationType,clientEndpointCapabilities:K?K.clientEndpointCapabilities:0,clientEndpointDebugContent:K?K.clientEndpointDebugContent:null,conversationType:K?ee.getConversationType(K.isEmergency,!1):null,meetingPreferences:ee.meetingPreferences,meetingData:ee.meetingData,meetingRegistrationId:null==K?void 0:K.meetingRegistrationId,sharedLineCallInvitationContent:null==K?void 0:K.sharedLineCallInvitationContent,applyServerMute:null==K?void 0:K.applyServerMute};ee.isCastCall=!1,ee.startOrJoinCall(Y,Je.NETWORK_REQUESTS.JOIN_CONVERSATION.name,J,G,W)}},this.subscribeToCall=function(F,B,G,z,K){void 0===G&&(G=0),void 0===K&&(K=Ze.causeId()),Ze.assertNotNull(B,"correlationId should be a non null value"),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.IDLE,"a call is already in progress");var J=F;return J||(J=ee.signalingAgentConfig.conversationServiceUrl,ee.logger.info("conversationServiceUrl passed is empty. so it is set to ".concat(J))),Ze.assertNotNullOrEmpty(J,"conversationUrl should be a non null value"),ee.logger.info("[".concat(K,"][subscribeToCall][start][correlationId=").concat(B,"] applicationType=").concat(ee.participantManager.localParticipant.applicationType)),ee.disposed?(ee.logger.warn("[".concat(K,"][subscribeToCall][failed][reason=Session disposed]")),Promise.reject(Ye.default.CALL_END_CODE.CALL_DOES_NOT_EXIST)):(ee.isBrokerEnabledForIncomingCall()&&ee.setupBrokerChannel(),ee.fsmState=Ye.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY,ee.updateCorrelationId(B,K),ee.http.sendPostRequest({url:J,requestName:Je.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY.name,operationType:"CallSetup",payload:Ee.getPayload(ee,null,null,W(W({subscribe:!0,clientEndpointCapabilities:G},z),{applicationType:ee.participantManager.localParticipant.applicationType,endpointState:ee.configureEndpointStateForStartOrJoin({additionalEndpointProperties:null==z?void 0:z.additionalEndpointProperties})}),K),causeId:K}).then((function(F){ee.disposed||(ee.fsmState=Ye.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,ee.processConversationServiceResponseHeaders(F,K),ee.processConversationServiceResponse(F.response,K),ee.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY,K),F.response.roster&&ee.internalHandleRosterUpdate(F.response.roster,!0,K))})).catch((function(F){if(F.stack&&!ee.isFatalException(F))return Promise.resolve();var B=Ze.getErrorForXHRFailure(F,ee.signalingAgentConfig);return ee.logger.info("[".concat(K,"][subscribeToCall] error: ").concat((0,$.getPrintableObject)(F)," xhrError: ").concat((0,$.getPrintableObject)(B))),ee.disposed?Promise.reject(ee.getCallNotFoundTransactionEnd()):(ee.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,ee.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultValue:Je.default.RESULT_VALUE.FAILURE,endCode:B.telemetryEndSubCode,endSubCode:B.error.subCode,resultCategories:B.error.resultCategories,resultDetail:B.error.phrase||ee.getTerminatingCallResultDetail("subscribe",B.error),causeId:K}),ee.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,K,B.error),Promise.reject(B.error))})))},this.getCallReplacementDetailsForCall=function(F,B){void 0===B&&(B=Ze.causeId()),ee.logger.info("[".concat(B,"] getCallReplacementDetailsForCall callId ").concat(F));var G=ee.signalingAgent.getSignalingSession(F);return G?G.getCallReplacementDetails(B):{replaces:""}},this.getCallReplacementDetails=function(F){return void 0===F&&(F=Ze.causeId()),ee.logger.info("[".concat(F,"] getCallReplacementDetails")),{replaces:ee.links[Ye.default.LINKS.REPLACE]}},this.transferCallAsync=function(F,B,G,W,z){void 0===z&&(z=Ze.causeId()),ee.logger.info("[".concat(z,"] transferCallAsync: transferTargetMri: ").concat(ee.piiUtils.scrubMriOrOmit(F)," transferType ").concat(B," callTransferOptions: ").concat((0,$.safeJsonStringify)(W))),ee.transferHelper(F,B,G,W,z)},this.redirectCall=function(F,B,G){void 0===B&&(B=Ze.causeId());var W=F.redirectOptions,z=W.id,K=W.endpointType,J=W.type;if(ee.logger.info("[".concat(B,"] redirectCall: targetId: ").concat(ee.piiUtils.scrubMriOrOmit(z)," targetEndpointType ").concat(K)),!ee.isRedirectAllowed){var Q={code:Ye.default.CALL_END_CODE.REJECT,phrase:Ye.default.CALL_END_PHRASE.CALL_REDIRECT_IS_NOT_ALLOWED};return Promise.reject(Q)}ee.telemetryHelper.recordEvent(Je.EVENTS.CALL_REDIRECT,{causeId:B});var Y=ye.getPayload(ee,J,z,K);return ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.REDIRECT],requestName:Je.NETWORK_REQUESTS.SEND_CALL_REDIRECT_REQUEST.name,payload:Y,causeId:B}).then((function(W){return ee.logger.info("[".concat(B,"][redirectCall] succeeds. Leaving the call...")),ee.telemetryHelper.recordEvent(Je.EVENTS.CALL_REDIRECT_REQUEST_SENT,{causeId:B,targetEndpointType:K}),ee.terminateEstablishedCall(G,F)})).catch((function(F){var W=Ze.getErrorForXHRFailure(F);ee.logger.info("[".concat(B,"][redirectCall] error: ").concat((0,$.getPrintableObject)(W)));var z=W.error;return ee.telemetryHelper.recordEvent(Je.EVENTS.CALL_REDIRECT_REQUEST_FAILED,{causeId:B,transactionEnd:z,endpointType:K}),ee.disposed||(ee.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,endCode:G.code,endSubCode:G.subCode,clientReasonSubCode:G.clientReasonSubCode,clientReasonPhrase:G.clientReasonPhrase,resultDetail:G.phrase||"RedirectCall",resultCategories:G.resultCategories,causeId:B}),ee.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,G),ee.dispose(G,B)),Promise.reject(z)}))},this.transferHelper=function(F,B,G,z,K){void 0===K&&(K=Ze.causeId()),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet");var J=!1;ee.logger.info("[".concat(K,"][transferHelper][replacementDetails=").concat((0,$.getPrintableObject)(G),"] disableForwardingAndUnanswered=").concat(z&&z.disableForwardingAndUnanswered)),ee.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_CALL,{causeId:K}),ee.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){ee.handleCallTransferTimeout(K,J)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT),ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.TRANSFER],requestName:Je.NETWORK_REQUESTS.SEND_TRANSFER_REQUEST.name,payload:xe.getPayload(F,ee,G,B,z),causeId:K}).then((function(){ee.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_TRANSFER_ACCEPTANCE,{causeId:K}),J=!0})).catch((function(F){var B=Ze.getErrorForXHRFailure(F,ee.signalingAgentConfig);ee.logger.info("[".concat(K,"][transferCallAsync] error: ").concat((0,$.getPrintableObject)(B))),ee.disposed||(ee.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:Ye.default.CALL_END_CODE.NETWORK_ERROR,reason:(0,$.getPrintableObject)(F)}},K),ee.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_REQUEST_FAILED,W({causeId:K},B.error)))})),ee.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_REQUEST_SENT,{causeId:K,transferType:B})},this.consultTransferCallAsync=function(F,B,G,W,z){var K,J;if(ee.logger.info("[".concat(W,"] consultTransferCallAsync: transferTargetMri: ").concat(ee.piiUtils.scrubMriOrOmit(B)," transferTargetParticipantLegId: ").concat(G)),G?(J=ee.getMriByParticipantLegOfCall(F,G,W),K=ee.getReplacementDetailsByParticipantLegOfCall(F,B,G,W)):(J=B,K=ee.getCallReplacementDetailsForCall(F,W)),!J||!K){var Q=K?"target mri corresponding not found":"unable to retrieve replacementDetails for transferTargetCallId: ".concat(F,", transferTargetMri: ").concat(B,", transferTargetParticipantLegId: ").concat(G);return ee.logger.info("[".concat(W,"] consultTransferCallAsync: error: ").concat(Q)),void ee.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:Ye.default.CALL_END_CODE.BAD_REQUEST,reason:Q}},W)}ee.transferHelper(J,"TransferTypeStandard",K,z,W)},this.isParkByTransfer=function(F,B){var G=["serverHold","sharedLinePark","teamPark"].indexOf(F)>-1;return ee.logger.info("[".concat(B,"][isParkByTransfer][context=").concat(F,"] result = ").concat(G)),G},this.parkCallAsync=function(F,B){if(void 0===B&&(B=Ze.causeId()),F&&"none"===F)throw G={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark context is missing or none"};if(Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"call is not connected yet"),ee.logger.info("[".concat(B,"][parkCallAsync][context=").concat(F,"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.PARK_CALL,{causeId:B,context:F}),ee.isParkByTransfer(F,B))return ee.parkByTransfer(F,B);if(ee.signalingAgentConfig.enableMusicOnHoldV2)return ee.park(F,B);var G={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.PARK_UNPARK_V2_DISABLED,phrase:"Park context request was ".concat(F," but park/unpark v2 was disabled.")};return Promise.reject(G)},this.unparkAsync=function(F,B){if(void 0===B&&(B=Ze.causeId()),F&&"none"===F)throw{code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark context is missing or none"};if(!ee.links[Ye.default.LINKS.UNPARK])throw{code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:"Unpark link not available"};ee.logger.info("[".concat(B,"][unparkAsync][context=").concat(F,"]")),ee.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION,(function(){ee.handleUnparkError({code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.UNPARK_COMPLETION_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.UNPARK_COMPLETION_TIMEOUT},Je.EVENTS.WAITING_FOR_UNPARK_COMPLETION_TIMEOUT,B,F)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.UNPARK_COMPLETION_TIMEOUT);var G={causeId:B};return ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.UNPARK],requestName:Je.NETWORK_REQUESTS.SEND_UNPARK_REQUEST.name,payload:je.getPayload(ee,G),causeId:B}).then((function(F){return ee.logger.info("[".concat(B,"][unparkAsync] response: ").concat((0,$.getPrintableObject)(F))),ee.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_UNPARK_COMPLETION,{causeId:B}),Promise.resolve()})).catch((function(G){var W=Ze.getErrorForXHRFailure(G,ee.signalingAgentConfig);return ee.logger.info("[".concat(B,"][unparkAsync] error: ").concat((0,$.getPrintableObject)(W))),ee.disposed?Promise.reject(ee.getCallNotFoundTransactionEnd()):(ee.handleUnparkError(W.error,Je.EVENTS.UNPARK_REQUEST_FAILED,B,F),Promise.reject(W.error))}))},this.getCallStatus=function(){return ee.currentCallStatus},this.processIncomingCallRequest=function(F,B,G){if(void 0===G&&(G=Ze.causeId()),Ze.assertNotNull(F,"request should be a non null value"),Ze.assertNotNullOrEmpty(F.body,"request should have a valid body"),Ze.assertNotNullOrEmpty(F.body.gp||F.body.cp,"request body should have payload"),Ze.assert(ee.isCallIdleOrRosterOnly(),"a call is already in progress"),ee.callUsesMixer=F.fromMixer,ee.logger.info("[".concat(G,"][processIncomingCallRequest][start]")),ee.disposed)ee.logger.warn("processIncomingCallRequest canceled");else{ee.telemetryHelper.startCallInitializationWatch(),ee.isIncomingCall=!0,ee.isBrokerEnabledForIncomingCall()&&ee.setupBrokerChannel(),ee.fsmState=Ye.default.SIGNALING_FSM_STATE.INCOMING,ee.participantManager.initializeForIncomingCall();var W={};try{B&&(W=JSON.parse(B))}catch(F){ee.logger.warn("Unable to parse endpoint metadata")}ee.endpointMetadata=W;try{var z=void 0;if(F&&F.body&&F.body.gp&&!(0,te.isStringBase64)(F.body.gp))ee.logger.info("[".concat(G,"][processIncomingCallRequest] unencoded payload, skipping decoding.")),z=F.body.gp;else{var K=F.body.gp?atob(F.body.gp):Ze.decodeMessage(F.body.cp);z=JSON.parse(K)}if(!z.callNotification)throw ee.logger.info("[".concat(G,"][processIncomingCallRequest][failed][reason=CallNotification missing]")),new Error("CallNotification is missing");ee.processIncomingCallPayload(z,G),ee.incomingCallPayload=z}catch(F){ee.endIncomingCallBecauseOfInvalidPayload(G)}}},this.sendAttachToCall=function(F){return void 0===F&&(F=Ze.causeId()),ee.logger.info("[".concat(F,"][sendAttachToCall]")),ee.incomingCallPayload?(ee.onCallStatusChanged(Ye.default.CALL_STATUS.IDLE,F),ee.sendAttachToCallInternal(F)):(ee.endIncomingCallBecauseOfInvalidPayload(F),Promise.reject(Ye.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD))},this.supportsNewOfferRequest=function(){return ee.signalingAgentConfig.handleNewOfferRequest},this.requestNewOffer=function(F,B){return void 0===B&&(B=Ze.causeId()),ee.telemetryHelper.recordEvent(Je.EVENTS.REQUEST_NEW_OFFER,{compatibleContentTypes:F,causeId:B}),ee.signalingAgentConfig.handleNewOfferRequest?(Ze.assertNotNullOrEmpty(ee.links[Ye.default.LINKS.NEW_OFFER],"newOffer link should be a non null value"),ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.NEW_OFFER],requestName:Je.NETWORK_REQUESTS.REQUEST_NEW_OFFER.name,payload:Re.getPayload(ee,F,ee.links[Ye.default.LINKS.NEW_OFFER]),causeId:B}).then((function(F){return ee.disposed?Promise.reject(ee.getCallNotFoundTransactionEnd()):Promise.resolve(F)})).catch((function(F){var G=Ze.getErrorForXHRFailure(F,ee.signalingAgentConfig);return ee.logger.info("[requestNewOffer][".concat(B,"] error ").concat((0,$.getPrintableObject)(G))),ee.disposed?Promise.reject(ee.getCallNotFoundTransactionEnd()):(ee.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,ee.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultValue:Je.default.RESULT_VALUE.FAILURE,endCode:G.telemetryEndSubCode,endSubCode:G.error.subCode,resultCategories:G.error.resultCategories,resultDetail:G.error.phrase||ee.getTerminatingCallResultDetail("requestNewOffer",G.error),causeId:B}),ee.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,G.error),ee.dispose(G.error,B),Promise.reject(G.error))}))):Promise.reject("Disabled")},this.endAsync=function(F,B){var G,W,z,K;void 0===B&&(B={}),B.causeId=B.causeId||Ze.causeId();var Y=B.causeId;if(ee.logger.info("[".concat(Y,"][endAsync][rejectionData=").concat(F&&(0,$.getPrintableObject)(F),"][endCallForAll=").concat(B.forEveryone,"]")),ee.disposed)return ee.logger.warn("[".concat(Y,"][endAsync] canceled but session already disposed")),Promise.resolve(null);if(ee.disposing=!0,ee.telemetryHelper.recordEvent(Je.EVENTS.END_CALL,F?{code:F.code,subCode:F.subCode,causeId:Y,callEndClientSubCode:F.clientReasonSubCode,callEndClientPhrase:F.clientReasonPhrase}:{causeId:Y}),B.preventAllCallbacks){var X=Object.keys(ee.signalingSessionCallback);try{for(var Z=J(X),te=Z.next();!te.done;te=Z.next()){var ne=te.value;ee.signalingSessionCallback[ne]=Q.noop}}catch(F){G={error:F}}finally{try{te&&!te.done&&(W=Z.return)&&W.call(Z)}finally{if(G)throw G.error}}}var ie=(null===(z=ee.mediaRenegotiationManager)||void 0===z?void 0:z.isIncomingRenegotiationInProgress())||(null===(K=ee.mediaRenegotiationManager)||void 0===K?void 0:K.isOutgoingRenegotiationInProgress());if(ee.telemetryHelper.stopCallCancelationDurationWatch(),ee.fsmState===Ye.default.SIGNALING_FSM_STATE.INCOMING)return F.code===Ye.default.CALL_END_CODE.CALL_REDIRECTED?ee.redirectCall(B,Y,F):ee.rejectIncomingCall(F,Y);if(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING||ee.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY)return ee.cancelOutgoingCall(F,Y);if(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK)return ee.rejectIncomingCall(F,Y);if((ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED||ie)&&B.forEveryone)return ee.deleteConversation(F,Y);if(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED||ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||ie)return ee.terminateEstablishedCall(F,B);ee.logger.info("[".concat(Y,"][endAsync] there is no call to cancel or end or reject in current state"));var re=F&&(F.code||F.subCode)?F:{code:Ye.default.CALL_END_CODE.NOT_FOUND,subCode:Ye.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:Ye.default.CALL_END_PHRASE.CALL_DOES_NOT_EXIST,resultCategories:[Ye.RESULT_CATEGORIES.ExpectedError]};return F&&ee.setClientRejectReason(re,F),ee.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultDetail:re.phrase||"CallDoesNotExist",endCode:re.code,endSubCode:re.subCode,resultCategories:re.resultCategories,causeId:Y,clientReasonSubCode:re.clientReasonSubCode,clientReasonPhrase:re.clientReasonPhrase}),ee.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,Y,re),ee.dispose(re,Y),Promise.resolve(null)},this.handleIncomingMsgAsync=function(F,B){var G,z;void 0===B&&(B=Ye.default.INCOMING_MESSAGE_ORIGIN.TROUTER),Ze.assertNotNull(F,"incoming message should be a non null value");var K=F.headers?F.headers[Ye.default.HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",J=Ze.defer(),Q=F.body,Y=F.url,X=W(W({},F),{origin:B}),Z=Ze.extractCauseIdFromMessage(X);if(ee.logger.info("[".concat(Z,"][handleIncomingMsgAsync][url=").concat(Y,"][messageId=").concat(K,"]")),!Q)return ee.logger.info("[".concat(Z,"][handleIncomingMsgAsync][failed][reason=received message with no body]")),ee.telemetryHelper.recordEvent(Je.EVENTS.MESSAGE_MISSING_BODY,{origin:B,messageId:K,causeId:Z}),J.reject(new Error("received message with no body")),J.promise;if(ee.disposed)return ee.logger.info("[".concat(Z,"][handleIncomingMsgAsync][failed][reason=call is disposed]")),J.reject(ee.getCallNotFoundTransactionEnd()),J.promise;if(ee.isDuplicatedIncomingMessage(X))return ee.logger.info("[".concat(Z,"][handleIncomingMsgAsync][failed][reason=duplicate]")),ee.telemetryHelper.recordEvent(Je.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:B,messageId:K,causeId:Z}),J.resolve(new Error("Message was already handled")),J.promise;ee.checkCorrelationIdChange(F,Z);var te=((G={})[Ye.PAYLOAD_PROPERTY.CALL_NOTIFICATION]=function(F){ee.handleCallNotification(F)},G[Ye.PAYLOAD_PROPERTY.MEDIA_ANSWER]=function(F){ee.handleMediaAnswer(F)},G[Ye.PAYLOAD_PROPERTY.MEDIA_ACKNOWLEDGEMENT]=function(F){ee.handleMediaAcknowledgement(F)},G[Ye.PAYLOAD_PROPERTY.CALL_ACCEPTANCE]=function(F){ee.handleCallAcceptance(F)},G[Ye.PAYLOAD_PROPERTY.CALL_END]=function(F){ee.handleCallEnd(F)},G[Ye.PAYLOAD_PROPERTY.CALL_PROGRESS]=function(F){ee.handleCallProgress(F)},G[Ye.PAYLOAD_PROPERTY.CALL_ACCEPTANCE_ACKNOWLEDGEMENT]=function(F){ee.handleCallAcceptanceAck(F)},G[Ye.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION]=function(F){var B;null===(B=ee.mediaRenegotiationManager)||void 0===B||B.handleMediaNegotiationOffer(F)},G[Ye.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION_FAILURE]=function(F){var B;null===(B=ee.mediaRenegotiationManager)||void 0===B||B.handleMediaNegotiationFailure(F)},G[Ye.PAYLOAD_PROPERTY.BALANCE_UPDATE]=function(F){ee.handlePSTNBalanceUpdate(F)},G[Ye.PAYLOAD_PROPERTY.RETARGET_COMPLETED]=function(F){var B;null===(B=ee.mediaRenegotiationManager)||void 0===B||B.handleRetargetCompleted(F)},G[Ye.PAYLOAD_PROPERTY.CALL_TRANSFER]=function(F){ee.handleTransferRequested(F)},G[Ye.PAYLOAD_PROPERTY.TRANSFER_COMPLETION]=function(F){ee.handleTransferCompletion(F)},G[Ye.PAYLOAD_PROPERTY.TRANSFER_ACCEPTANCE]=function(F){ee.handleTransferAcceptance(F)},G[Ye.PAYLOAD_PROPERTY.PARK_COMPLETION]=function(F){ee.handleParkCompletion(F)},G[Ye.PAYLOAD_PROPERTY.UNPARK_COMPLETION]=function(F){ee.handleUnparkCompletion(F)},G[Ye.PAYLOAD_PROPERTY.UPDATE_MEETING_LIVE_STATE_RESPONSE]=function(F){ee.handleUpdateMeetingLiveStateCompletion(F)},G[Ye.PAYLOAD_PROPERTY.UPDATE_MEETING_GROUPS_RESPONSE]=function(F){ee.handleUpdateMeetingGroupsCompletion(F)},G[Ye.PAYLOAD_PROPERTY.SET_MEETING_LAYOUT_RESPONSE]=function(F){ee.handleSetMeetingLayoutCompletion(F)},G),ne=((z={})[Ye.URL_PATH.CONTROL_VIDEO_STREAMING]=function(F){ee.webRtcSignalingManager.handleControlVideoStreaming(F)},z[Ye.URL_PATH.DOMINANT_SPEAKER_INFO]=function(F){ee.webRtcSignalingManager.handleDominantSpeakerInfo(F)},z[Ye.URL_PATH.CSRC_INFO]=function(F){ee.webRtcSignalingManager.handleCsrcInfo(F)},z[Ye.URL_PATH.CONV_ROSTER_UPDATE]=function(F){ee.handleRosterUpdate(F,!1)},z[Ye.URL_PATH.NEW_MEDIA_OFFER]=function(F){ee.handleNewMediaOffer(F)},z[Ye.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS]=function(F){ee.participantManager.handleAddParticipantSuccess(F)},z[Ye.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE]=function(F){ee.participantManager.handleAddParticipantFailure(F)},z[Ye.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS]=function(F){ee.participantManager.handleAdmitParticipantSuccess(F)},z[Ye.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE]=function(F){ee.participantManager.handleAdmitParticipantFailure(F)},z[Ye.URL_PATH.CONV_ADMIT_ALL_STATUS]=function(F){ee.handleAdmitAllStatus(F)},z[Ye.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS]=function(F){ee.participantManager.handleRemoveParticipantSuccess(F)},z[Ye.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE]=function(F){ee.participantManager.handleRemoveParticipantFailure(F)},z[Ye.URL_PATH.CONV_CONFIRM_UNMUTE]=function(F){ee.participantManager.handleUnmuteConfirmRequest(F)},z[Ye.URL_PATH.CONV_UPDATE]=function(F){ee.handleConversationUpdate(F)},z[Ye.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE]=function(F){ee.handleLocalParticipantUpdate(F)},z[Ye.URL_PATH.CONV_ADD_MODALITY_SUCCESS]=function(F){ee.handleAddModalitySuccess(F)},z[Ye.URL_PATH.CONV_ADD_MODALITY_FAILURE]=function(F){ee.handleAddModalityFailure(F)},z[Ye.URL_PATH.CONV_BROADCAST_UPDATE]=function(F){ee.broadcastSession.handleBroadcastStateChanged(F)},z[Ye.URL_PATH.CONV_CONTENT_SHARING_UPDATE]=function(F){var B;null===(B=ee.contentSharingManager)||void 0===B||B.handleContentSharingUpdate(F)},z[Ye.URL_PATH.CONV_CONTENT_SHARING_END]=function(F){var B;null===(B=ee.contentSharingManager)||void 0===B||B.handleContentSharingEnd(F)},z[Ye.URL_PATH.CONV_END]=function(F){ee.handleCallEnd(F)},z[Ye.URL_PATH.LWJ_ACCEPTANCE]=function(F){ee.handleLwjAcceptance(F)},z[Ye.URL_PATH.LWJ_END]=function(F){ee.handleCallEnd(F)},z[Ye.URL_PATH.UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS]=function(F){ee.participantManager.handleUpdateParticipantInterpretationStateCompletion(F)},z[Ye.URL_PATH.JOIN_MEETING_GROUP_STATUS]=function(F){ee.handleJoinMeetingGroupCompletion(F)},z[Ye.URL_PATH.LEAVE_MEETING_GROUP_STATUS]=function(F){ee.handleLeaveMeetingGroupCompletion(F)},z[Ye.URL_PATH.RECEIVE_MESSAGE]=function(F){ee.handleReceiveMessage(F)},z);try{var ie=Object.keys(te).filter((function(F){return Q.hasOwnProperty(F)}))[0],re=Object.keys(ne).filter((function(F){return X.url&&Ze.stringEndsWith(X.url,F)}))[0];ie?te[ie](X):re?ne[re](X):(ee.telemetryHelper.recordEvent(Je.EVENTS.UNKNOWN_MESSAGE_TYPE,{messageId:K}),ee.logger.info("[".concat(Z,"][handleIncomingMsgAsync][failed][reason=received unknown message]"))),J.resolve(!0)}catch(F){ee.telemetryHelper.recordEvent(Je.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:K,error:(0,$.getPrintableObject)(F)}),ee.logger.info("[".concat(Z,"][handleIncomingMsgAsync][failed][reason=").concat(F.message,"]")),J.reject(new Error(F.message))}return J.promise},this.canHandleIncomingMsgSync=function(F){if(ee.signalingAgentConfig.supportsSynchronousTrouterResponse){var B=F.body;return Boolean(B.callAcceptance)}return!1},this.handleIncomingMsgSync=function(F){var B=F.headers?F.headers[Ye.default.HEADERS.ORIGINAL_MESSAGE_ID]:"unknown",G=F.body,z=F.url,K=Ye.default.INCOMING_MESSAGE_ORIGIN.TROUTER,J=W(W({},F),{origin:K}),Q=Ze.extractCauseIdFromMessage(J);ee.logger.info("[".concat(Q,"][handleIncomingMsgSync][url=").concat(z,"][messageId=").concat(B,"]"));var Y=Ye.default.HTTP_STATUS_CODES.OK,X="",Z={};if(Ze.isDuplicateMessage(J.headers,ee.incomingTrouterMessagesSeenSoFar)){ee.logger.info("[".concat(Q,"][handleIncomingMsgSync][failed][reason=duplicate]"));var te=Ze.getMessageResultFromCache(J.headers,ee.incomingMessageSyncResponseCache);if(te)return ee.logger.info("[".concat(Q,"][handleIncomingMsgSync][cachedResponse]")),te;ee.telemetryHelper.recordEvent(Je.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:K,messageId:B,causeId:Q}),ee.logger.info("[".concat(Q,"][handleIncomingMsgSync][failed][reason=cachedResponseNotFound]")),Y=Ye.default.HTTP_STATUS_CODES.BAD_REQUEST}else if(G){if(G.callAcceptance)try{var ne=ee.handleCallAcceptanceSync(J);X=(0,$.safeJsonStringify)(ne)}catch(F){ee.telemetryHelper.recordEvent(Je.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:B,origin:K,causeId:Q,error:(0,$.getPrintableObject)(F)}),ee.logger.info("[".concat(Q,"][handleIncomingMsgSync][failed][reason=").concat(F&&F.message,"]")),Y=Ye.default.HTTP_STATUS_CODES.BAD_REQUEST}}else ee.logger.info("[".concat(Q,"][handleIncomingMsgSync][failed][reason=received message with no body]")),ee.telemetryHelper.recordEvent(Je.EVENTS.MESSAGE_MISSING_BODY,{origin:K,messageId:B,causeId:Q}),Y=Ye.default.HTTP_STATUS_CODES.BAD_REQUEST;J.headers&&(J.headers[Ye.default.HEADERS.CORRELATION_ID]&&(Z[Ye.default.HEADERS.CORRELATION_ID]=J.headers[Ye.default.HEADERS.CORRELATION_ID]),J.headers[Ye.default.HEADERS.MESSAGE_ID]&&(Z[Ye.default.HEADERS.MESSAGE_ID]=J.headers[Ye.default.HEADERS.MESSAGE_ID]));var ie={resultCode:Y,responseBody:X,responseHeaders:Z};return Ze.cacheMessageResult(J.headers,ee.incomingMessageSyncResponseCache,ie),ee.logger.info("[".concat(Q,"][handleIncomingMsgSync][success][resultCode=").concat(Y,"]")),ie},this.acceptRenegotiationAsync=function(F,B,G){return void 0===G&&(G=Ze.causeId()),Ze.assertNotNull(F.blob,"finalSdp should be a non null value"),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),ee.logger.info("[".concat(G,"][acceptRenegotiationAsync][mediaTypes=").concat(B,"]")),ee.mediaRenegotiationManager.acceptRenegotiationAsync(F,B,G)},this.setProvisionalAnswerAsync=function(F,B){void 0===B&&(B=Ze.causeId()),Ze.assertNotNull(F.blob,"sdp should be a non null value"),ee.telemetryHelper.recordEvent(Je.EVENTS.SET_PROVISIONAL_ANSWER,{causeId:B});var G=Ze.defer();return ee.fsmState!==Ye.default.SIGNALING_FSM_STATE.INCOMING?(ee.logger.info("[setProvisionalAnswerAsync][".concat(B,"] there is no incoming call to set provisional answer on.")),G.reject(new Error("there is no incoming call to set provisional answer on.")),G.promise):(ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.MEDIA_ANSWER],requestName:Je.NETWORK_REQUESTS.SEND_MEDIA_ANSWER.name,payload:Ke.getPayload(ee,F),causeId:B}).then((function(F){ee.disposed||ee.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTING,B),G.resolve(null),ee.disposed||(ee.telemetryHelper.recordEvent(Je.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT,{causeId:B}),ee.telemetryHelper.setTimeToRingDuration(),ee.onCallStatusChanged(Ye.default.CALL_STATUS.RINGING,B),ee.signalingSessionCallback.onMediaAcknowledgementSuccess(!1,B))})).catch((function(F){var W=Ze.getErrorForXHRFailure(F,ee.signalingAgentConfig);ee.logger.info("[setProvisionalAnswerAsync][".concat(B,"] error: ").concat((0,$.getPrintableObject)(W))),ee.disposed?G.reject(ee.getCallNotFoundTransactionEnd()):(ee.telemetryHelper.recordEvent(Je.EVENTS.SET_PROVISIONAL_ANSWER_FAILED,{causeId:B}),G.reject(W.error))})),G.promise)},this.startRenegotiationAsync=function(F,B,G){return void 0===G&&(G=Ze.causeId()),Ze.assertNotNull(F,"mediaContent should be a non null value"),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),ee.logger.info("[".concat(G,"][startRenegotiationAsync]")),ee.mediaRenegotiationManager.startRenegotiationAsync(F,ee.links[Ye.default.LINKS.MEDIA_RENEGOTIATION],B,G)},this.acceptAsync=function(F,B,G,W){void 0===W&&(W=Ze.causeId()),Ze.assertNotNull(F,"mediaContent should be a non null value"),Ze.assertNotNull(F.blob,"outgoingSdp should be a non null value"),ee.logger.info("[".concat(W,"][acceptAsync][mediaTypes=").concat(B,"]")),ee.telemetryHelper.recordEvent(Je.EVENTS.ACCEPT_CALL,{causeId:W}),ee.telemetryHelper.setAnsweredModalities(F.blob);var z=Ze.defer();return ee.fsmState!==Ye.default.SIGNALING_FSM_STATE.INCOMING?(ee.logger.warn("acceptAsync, there is no incoming call to accept"),z.reject(new Error("there is no incoming call to accept")),z.promise):(ee.fsmState=Ye.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK,ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.ACCEPT],requestName:Je.NETWORK_REQUESTS.SEND_ACCEPTANCE.name,payload:me.getPayload(ee,F,B,G),causeId:W}).then((function(F){ee.disposed||(ee.currentCallStatus===Ye.default.CALL_STATUS.IDLE&&(ee.telemetryHelper.setTimeToRingDuration(),ee.telemetryHelper.recordEvent(Je.EVENTS.ACCEPTED_BEFORE_RINGING,{causeId:W}),ee.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTING,W)),F.response.callAcceptanceAcknowledgement&&(ee.logger.info("acceptAsync, handling inlined callAcceptanceAcknowledgement"),ee.internalHandleCallAcceptanceAck(F.response,W))),z.resolve(null)})).catch((function(F){var B=Ze.getErrorForXHRFailure(F,ee.signalingAgentConfig);ee.logger.info("[acceptAsync][".concat(W,"] error: ").concat((0,$.getPrintableObject)(B))),ee.disposed?z.reject(ee.getCallNotFoundTransactionEnd()):(ee.fsmState=Ye.default.SIGNALING_FSM_STATE.INCOMING,ee.telemetryHelper.recordEvent(Je.EVENTS.ACCEPT_CALL_FAILED,{causeId:W,xhrError:B}),z.reject(B.error))})),z.promise)},this.rejectRenegotiationAsync=function(F,B){return void 0===B&&(B=Ze.causeId()),Ze.assert(ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED,"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight"),ee.logger.info("[".concat(B,"][rejectRenegotiationAsync][rejectionData=").concat(F,"]")),ee.mediaRenegotiationManager.rejectRenegotiationAsync(F,B)},this.saveMediaControllerLinksIfAny=function(F){F.links&&(ee.links[Ye.default.LINKS.CONTROL_VIDEO_STREAMING]=F.links.controlVideoStreaming||ee.links[Ye.default.LINKS.CONTROL_VIDEO_STREAMING],ee.links[Ye.default.LINKS.APPLY_CHANNEL_PARAMETERS]=F.links.applyChannelParameters||ee.links[Ye.default.LINKS.APPLY_CHANNEL_PARAMETERS])},this.getInitialMediaOfferFromIncomingCallPayload=function(F){if(void 0===F&&(F=Ze.causeId()),!ee.signalingAgentConfig.handleMediaOfferFromPushNotification)return null;var B=ee.incomingCallPayload&&ee.incomingCallPayload.callNotification&&ee.incomingCallPayload.callNotification.mediaContent?ee.incomingCallPayload.callNotification.mediaContent:null;return ee.telemetryHelper.setIsSdpInCallNotification(!!B),B},this.updateCorrelationId=function(F,B){if(void 0===B&&(B=Ze.causeId()),ee.logger.info("[".concat(B,"][updateCorrelationId][old=").concat(ee.correlationId,"][new=").concat(F,"]")),ee.correlationId!==F&&!ee.disposed){var G=ee.correlationId;ee.correlationId=F,ee.telemetryHelper&&ee.telemetryHelper.recordEvent&&ee.telemetryHelper.recordEvent(Je.EVENTS.CORRELATION_ID_UPDATED,{newId:ee.correlationId,oldId:G,causeId:B}),ee.signalingSessionCallback&&ee.signalingSessionCallback.onCorrelationIdUpdated&&ee.signalingSessionCallback.onCorrelationIdUpdated(ee.correlationId,B)}},this.endIncomingCallBecauseOfInvalidPayload=function(F){ee.logger.info("[".concat(F,"][endIncomingCallBecauseOfInvalidPayload]")),ee.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE;var B={code:Ye.default.CALL_END_CODE.BAD_REQUEST,subCode:Ye.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,phrase:Ye.default.CALL_END_PHRASE.BAD_NOTIFICATION_PAYLOAD,resultCategories:[Ye.RESULT_CATEGORIES.UnexpectedServerError]};ee.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultValue:Je.default.RESULT_VALUE.FAILURE,endCode:B.code,endSubCode:B.subCode,resultDetail:B.phrase||"EndIncomingCall",resultCategories:B.resultCategories,causeId:F}),ee.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,F,B),ee.dispose(B,F)},this.isDuplicatedIncomingMessage=function(F){return F.origin===Ye.default.INCOMING_MESSAGE_ORIGIN.BROKER&&Ze.isDuplicateMessage(F.headers,ee.incomingBrokerMessagesSeenSoFar)||F.origin===Ye.default.INCOMING_MESSAGE_ORIGIN.TROUTER&&Ze.isDuplicateMessage(F.headers,ee.incomingTrouterMessagesSeenSoFar)},this.getEndpointState=function(){return ee.currentCallStatus===Ye.default.CALL_STATUS.CONNECTED?W({},ee.latestEndpointState):W({},ee.requestedEndpointStateWhileConnecting)},this.setMultiParty=function(F,B){var G=!!F;ee.multiParty!==G&&(ee.telemetryHelper.recordEvent(Je.EVENTS.SET_MULTIPARTY,{isMultiparty:G,causeId:B}),ee.multiParty=G)},this.setupTrouterChannel=function(){ee.logger.info("Broker config: outgoing=".concat(ee.signalingAgentConfig.brokerEnabledOutgoing?"enabled":"disabled")+"incoming=".concat(ee.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled")+"batching=".concat(ee.signalingAgentConfig.brokerRequestBatching?"enabled":"disabled")+"exclusive=".concat(ee.signalingAgentConfig.brokerExclusively?"enabled":"disabled"));var setTrouterUrl=function(F){F&&"string"==typeof F&&F.trim()&&(ee.baseMessagingChannelUrl=ee.previousTrouterUrl=ee.currentTrouterUrl=F.trim(),ee.telemetryHelper.addTrouterChannel())};ee.brokerExclusiveEnabled()||(ee.signalingAgentConfig.trouterServiceProvider?(ee.signalingAgentConfig.trouterServiceProvider.state()===$e.TrouterState.Connected&&ee.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync().then(setTrouterUrl),ee.signalingAgentConfig.trouterServiceProvider.onStateChanged(ee.onTrouterStateChanged)):(setTrouterUrl(ee.signalingAgentConfig.trouterUrlGetter.trouterUrl()),ee.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed(ee.onTrouterUrlChanged)))},this.isTrouterDisconnected=function(){try{return ee.signalingAgentConfig.trouterServiceProvider.state()===$e.TrouterState.Disconnected}catch(F){return!1}},this.forceTrouterConnectionCheck=function(){try{return void ee.signalingAgentConfig.trouterServiceProvider.checkConnection(!1)}catch(F){return}},this.navigatorOnlineCallback=function(){ee.disposed||(ee.reportConnectivityStatus(),ee.isTrouterDisconnected()&&ee.signalingAgentConfig.forceTrouterReconnectOnNetworkOnline&&ee.forceTrouterConnectionCheck())},this.navigatorOfflineCallback=function(){ee.reportConnectivityStatus()},this.reportConnectivityStatus=function(){if(!ee.disposed){var F=Ze.isTrouterAndNavigatorConnected(ee.signalingAgentConfig.trouterServiceProvider);ee.logger.info("[Connectivity] status=".concat(F)),ee.telemetryHelper.recordEvent(Je.EVENTS.CONNECTIVITY_CHANGED,{status:F})}},this.onTrouterStateChanged=function(F,B){var G=Ze.causeId();ee.logger.info("[".concat(G,"][onTrouterStateChanged][state=").concat(F,"]")),ee.disposed?ee.logger.info("onTrouterStateChanged ignored"):(ee.reportConnectivityStatus(),F===$e.TrouterState.Connected&&(ee.telemetryHelper.addTrouterChannel(),ee.updateLinksToTrouter(Je.EVENTS.TROUTER_STATE_CHANGED,G)))},this.setupConnectionCheck=function(){try{navigator&&navigator.onLine&&window&&window.addEventListener&&(window.addEventListener("online",ee.navigatorOnlineCallback),window.addEventListener("offline",ee.navigatorOfflineCallback))}catch(F){return}},this.tearDownConnectionCheck=function(){try{navigator&&navigator.onLine&&window&&window.removeEventListener&&(window.removeEventListener("online",ee.navigatorOnlineCallback),window.removeEventListener("offline",ee.navigatorOfflineCallback))}catch(F){return}},this.getTrouterUrlAsync=function(){return ee.signalingAgentConfig.trouterServiceProvider?ee.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync():ee.signalingAgentConfig.trouterUrlGetter.getTrouterUrlAsync()},this.brokerExclusiveEnabled=function(){return ee.signalingAgentConfig.brokerEnabledOutgoing&&ee.signalingAgentConfig.brokerEnabledIncoming&&ee.signalingAgentConfig.brokerExclusively},this.isBrokerEnabledForOutgoingCall=function(){return ee.signalingAgentConfig.brokerEnabledOutgoing},this.isBrokerEnabledForIncomingCall=function(){return ee.signalingAgentConfig.brokerEnabledIncoming},this.isHandleUnmuteMuteFromResponseEnabled=function(){return ee.signalingAgentConfig.handleUnmuteMuteFromResponse},this.isProcessSelfDataFromSubscribeResponseEnabled=function(){return ee.signalingAgentConfig.processSelfDataFromSubscribeResponse},this.setupBrokerChannel=function(){ee.brokerService||(ee.logger.info("setupBrokerChannel, Enable broker"),ee.brokerService=new ie.default(ee),ee.brokerService.onBrokerMessage((function(F){ee.logger.info("setupBrokerChannel, message from broker",F),ee.handleIncomingMsgAsync(F,Ye.default.INCOMING_MESSAGE_ORIGIN.BROKER).catch((function(F){ee.telemetryHelper.recordEvent(Je.EVENTS.FAILED_TO_HANDLE_BROKER_MESSAGE),ee.logger.info("setupBrokerChannel, Failed to handle message from broker",F)}))})),ee.baseMessagingChannelUrl||(ee.telemetryHelper.addBrokerChannel(),ee.baseMessagingChannelUrl=ee.brokerService.baseUrl))},this.onTrouterUrlChanged=function(){var F=Ze.causeId();ee.logger.info("[".concat(F,"][onTrouterUrlChanged]")),ee.disposed?ee.logger.info("onTrouterUrlChanged ignored"):ee.getTrouterUrlAsync().then((function(B){ee.telemetryHelper.recordEvent(Je.EVENTS.TROUTER_URL_CHANGED,{url:B}),ee.telemetryHelper.addTrouterChannel(),ee.updateLinksToTrouter(Je.EVENTS.TROUTER_URL_CHANGED,F)})).catch((function(F){ee.logger.info("Failed to update links to trouter: ".concat(F))}))},this.updateLinksToTrouter=function(F,B){ee.logger.info("[".concat(B,"][updateLinksToTrouter][tag=").concat(F,"]")),ee.ensureLatestTrouterUrl(F).then((function(){var F;ee.previousTrouterUrl!==ee.currentTrouterUrl?(ee.previousTrouterUrl=ee.currentTrouterUrl,ee.updateConversationLinks(),ee.updateLwjLinks(B),ee.updateKeepAliveUrl(),null===(F=ee.contentSharingManager)||void 0===F||F.updateContentSharingNotificationLinksAsync(B),ee.broadcastSession&&ee.broadcastSession.updateBroadcastCallbackUrl(B)):ee.logger.info("[".concat(B,"][updateLinksToTrouter]skip updating links, url did not change"))})).catch((function(F){ee.disposed||ee.telemetryHelper.recordEvent(Je.EVENTS.TROUTER_URL_UPDATE_FAILED,{causeId:B}),ee.logger.info("[".concat(B,"][updateLinksToTrouter][failed][reason=").concat((0,$.getPrintableObject)(F),"]"))}))},this.updateLinks=function(F,B){ee.ensureLatestTrouterUrl(Je.EVENTS.TROUTER_URL_CHANGED).then((function(){F(B)})).catch((function(F){ee.disposed||ee.telemetryHelper.recordEvent(Je.EVENTS.TROUTER_URL_UPDATE_FAILED,{causeId:B}),ee.logger.warn("Failed to update links")}))},this.startCallPreheatTimer=function(F){ee.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT,(function(){ee.handleCallEstablishmentTimeout(F,Ye.default.CALL_END_SUB_CODE.PREHEATED_CALL_TIMEDOUT,"Preheat timed out!")}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.MAX_PREAHEATED_TIMEOUT)},this.stopCallPreheatTimer=function(){ee.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT)},this.updateKeepAliveUrl=function(){ee.logger.info("updateKeepAliveUrl"),ee.links.hasOwnProperty(Ye.default.LINKS.KEEPALIVE)?(ee.linkUpdateRequested.keepAliveLinks=!1,ee.logger.info("updateKeepAliveUrl, sending request"),ee.sendToKeepAliveUrl(Me.getPayload(ee))):ee.linkUpdateRequested.keepAliveLinks=!0},this.updateConversationLinks=function(F){void 0===F&&(F=Ze.causeId()),ee.logger.info("[".concat(F,"][updateConversationLinks]")),ee.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_CONVERSATION_LINKS,{causeId:F}),ee.links.hasOwnProperty(Ye.default.LINKS.NOTIFICATION_LINKS)?(ee.linkUpdateRequested.conversationLinks=!1,ee.logger.info("updateConversationLinks, sending request"),ee.sendToUpdateConversationLinks(!0)):ee.linkUpdateRequested.conversationLinks=!0},this.updateLwjLinks=function(F){ee.logger.info("[".concat(F,"][updateLwjLinks]")),ee.links.hasOwnProperty(Ye.default.LINKS.LMC_NOTIFICATION_LINKS)&&(ee.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_LWJ_LINKS,{causeId:F}),ee.logger.info("[".concat(F,"][updateLwjLinks][start]")),ee.http.sendPostRequest({url:ee.links[Ye.default.LINKS.LMC_NOTIFICATION_LINKS],payload:Ve.getPayload(ee),withoutTrouter:!0,requestName:Je.NETWORK_REQUESTS.UPDATE_LWJ_LINKS.name,causeId:F}).then((function(B){ee.disposed||ee.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_LWJ_LINKS_SUCCESS,{causeId:F})})).catch((function(B){var G=Ze.getErrorForXHRFailure(B,ee.signalingAgentConfig);ee.logger.info("[".concat(F,"][updateLwjLinks] error : ").concat((0,$.getPrintableObject)(G))),ee.disposed||ee.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_LWJ_LINKS_FAILED,W({causeId:F},G.error))})))},this.sendAttachToCallInternal=function(F){var B;void 0===F&&(F=Ze.causeId()),ee.telemetryHelper.recordEvent(Je.EVENTS.SEND_ATTACH,{causeId:F}),ee.logger.info("[".concat(F,"][sendAttachToCallInternal]"));var G=ee.signalingAgentConfig.sendProgressFromCC?((B={})[Ye.default.HEADERS.CACHE_SKYPE_TOKEN]="1",B):null;return ee.http.sendPostRequest({url:ee.incomingCallPayload.callNotification.links.attach,customHeaders:G,requestName:Je.NETWORK_REQUESTS.SEND_CALL_ATTACH.name,payload:ge.getPayload(ee,ee.incomingCallPayload.conversationInvitation.conversationController,!ee.getInitialMediaOfferFromIncomingCallPayload()),causeId:F}).then((function(B){if(!ee.disposed){ee.processAttachResponse(ee.incomingCallPayload,B,F);var G=B.response.additionalActionResponses;G&&G.length>0&&(ee.processConversationServiceResponse(G[0].output,F),G[0].output.roster&&(ee.logger.info("[".concat(F,"][sendAttachToCallInternal] handling roster update from join response")),ee.internalHandleRosterUpdate(G[0].output.roster,!0,F))),ee.onCallStatusChanged(Ye.default.CALL_STATUS.RINGING,F),ee.telemetryHelper.setTimeToRingDuration(),ee.handleBrokerSubscription(B.response.callInvitation,F)}})).catch((function(B){var G=Ze.getErrorForXHRFailure(B,ee.signalingAgentConfig);ee.logger.info("[".concat(F,"][sendAttachToCallInternal] error: ").concat((0,$.getPrintableObject)(B)," xhrError: ").concat((0,$.getPrintableObject)(G))),ee.disposed||(ee.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,ee.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultValue:Je.default.RESULT_VALUE.FAILURE,endCode:G.telemetryEndSubCode,endSubCode:G.error.subCode,resultCategories:G.error.resultCategories,resultDetail:G.error.phrase||ee.getTerminatingCallResultDetail("attach",G.error),causeId:F}),ee.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,F,G.error),ee.dispose(G.error,F))}))},this._processCallAcceptance=function(F,B){if(ee.logger.info("[".concat(B,"][_processCallAcceptance]")),ee.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING){ee.processCallAcceptance(F.body,B),ee.telemetryHelper.setTimeToRingDuration();try{ee.multiParty||ee.callUsesMixer||ee.participantManager.handleRosterUpdate(ee.getFakeRoster(F.body),!0,B)}catch(W){var G={code:Ye.default.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:Ye.default.CALL_END_SUB_CODE.CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE,phrase:W&&W.toString()};throw ee.logger.info("[".concat(B,"][_processCallAcceptance] ").concat((0,$.safeJsonStringify)(G))),ee.telemetryHelper.recordRosterEvent(F,Je.EVENTS.HANDLE_ROSTER_UPDATE_FAIL,B),G}}},this.restartKeepAliveInterval=function(F,B){void 0===F&&(F=!1),ee.disposed||(F&&ee.telemetryHelper.recordEvent(Je.EVENTS.SEND_KEEP_ALIVE_FAILED,B),ee.keepAliveTimer=window.setInterval(ee.sendKeepAlive.bind(ee),ee.keepAliveInterval))},this.restartKeepAliveIntervalForLwj=function(F,B){void 0===F&&(F=!1),ee.disposed||(F&&ee.telemetryHelper.recordEvent(Je.EVENTS.SEND_KEEP_ALIVE_LWJ_FAILED,B),ee.keepAliveTimerLwj=window.setInterval(ee.sendKeepAliveForLwj.bind(ee),ee.keepAliveIntervalLwj))},this.isCallOngoing=function(){return ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED||ee.fsmState===Ye.default.SIGNALING_FSM_STATE.IDLE},this.isCallIdleOrRosterOnly=function(){return ee.fsmState===Ye.default.SIGNALING_FSM_STATE.IDLE||ee.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},this.isCallConnectedOrConnectedForRoster=function(){return ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED||ee.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},X&&(this.callStartTime=X),this.signalingSessionCallback=B,this.signalingAgentConfig=G,this.signalingAgent=K,this.urlIdentifier=z,this.piiUtils=new de.default(G.piiScrubber),this.isHostLessCall=G.doHostlessCalling||!1,this.logger=G.logger.createChild((function(){return"CSA[".concat(ee.correlationId,"][").concat(ee.fsmState,"]")}),this.correlationId,!0),this.updateCorrelationId(z),this.logger.info("[endpointId=".concat((0,$.truncate)(this.signalingAgent.endpointId,8),"]")),this.logger.info("[participantId=".concat(F.participantId,"]")),this.callOperationHandler=new re.default(this.logger.createChild((function(){return"[CallOperationHandler][".concat(F.participantId,"]")}))),this.http=new ae.HttpStack(this,this.callStartTime),this.telemetryHelper=new Qe.default(this,F,this.callStartTime),this.mediaRenegotiationManager=new se.default(this,B,this.telemetryHelper),this.participantManager=new le.default(this,B,F),this.timeoutManager=new Z.default(this.logger),this.contentSharingManager=new oe.default(this,B),this.webRtcSignalingManager=new et.default(this,B),this.pstnContent={emergencyCallCountry:G.emergencyCallCountry||"",platformName:G.clientInformation,publicApiCall:!1},this.setupTrouterChannel(),this.setupConnectionCheck()}return SignalingSession.prototype.onPromotionCompleted=function(F,B,G){this.logger.info("[".concat(G,"][onPromotionCompleted] isFailed=").concat(F," error=").concat((0,$.getPrintableObject)(B),"]")),this.isPromotingToRealtime=!1,this.signalingSessionCallback.onPromotionCompleted(F,B,G)},SignalingSession.prototype.setRealTimeState=function(F,B){var G=F;(2===F&&1===this.realTimeState||1===F&&2===this.realTimeState)&&(G=3),G!==this.realTimeState&&(this.logger.info("[".concat(B,"][setRealTimeState] changed: input=").concat(F," old=").concat(this.realTimeState,", new=").concat(G)),this.realTimeState=G,3===G?this.setCallMode(1,B):0!==this.callMode||2!==G&&1!==G||this.setCallMode(1,B))},SignalingSession.prototype.setCallMode=function(F,B){this.callMode!==F&&(this.logger.info("[".concat(B,"][setCallMode] oldMode=").concat(this.callMode,", newMode=").concat(F)),this.callMode=F,this.signalingSessionCallback.onCallModeChanged(this.callMode,B))},SignalingSession.prototype.configureStreamingMode=function(F){2!==this.callMode&&(this.logger.info("[".concat(F,"][configureStreamingMode]")),this.setCallMode(2,F),this.cleanUpDueToStreaming(F),this.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTED,F))},SignalingSession.prototype.updateDominantSpeakerHistoryMessageSubscription=function(F,B){this.webRtcSignalingManager.getIsDominantSpeakerInfoLinkEnabled()!==F&&(this.logger.info("Signaling dominant speaker history subscription updated: ".concat(F)),this.webRtcSignalingManager.setIsDominantSpeakerInfoLinkEnabled(F),B&&this.sendToKeepAliveUrl(Me.getPayload(this)))},SignalingSession.prototype.cleanUpDueToStreaming=function(F){var B,G,W;this.setRealTimeState(0,F),this.fsmState=Ye.default.SIGNALING_FSM_STATE.CONNECTED,this.isPromotingToRealtime=!1,this.provisionalMediaAnswersSeenSoFar=[],null===(W=this.mediaRenegotiationManager)||void 0===W||W.dispose(),this.mediaRenegotiationManager=new se.default(this,this.signalingSessionCallback,this.telemetryHelper),this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.keepAliveTimerLwj&&window.clearInterval(this.keepAliveTimerLwj),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT);var z={code:Ye.default.CALL_END_CODE.SUCCESS,subCode:Ye.default.CALL_END_SUB_CODE.DOWNGRADE_TO_STREAMING_CLIENT,phrase:Ye.default.CALL_END_PHRASE.DOWNGRADE_TO_STREAMING_CLIENT},K=Je.NETWORK_REQUESTS;try{for(var Q=J(Object.keys(K)),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;K[$].controller!==Je.CONTROLLER.Call&&K[$].controller!==Je.CONTROLLER.LMC&&K[$].controller!==Je.CONTROLLER.ContentShare||this.http.cancelRequestIfPending(K[$].name,F,void 0,z)}}catch(F){B={error:F}}finally{try{Y&&!Y.done&&(G=Q.return)&&G.call(Q)}finally{if(B)throw B.error}}},SignalingSession.prototype.updateEndpointMetadata=function(F,B){var G=this;void 0===B&&(B=Ze.causeId());var z={};try{z=JSON.parse(F)}catch(F){return Promise.reject("Invalid metadata")}return this.http.sendPutRequest({url:this.links[Ye.default.LINKS.UPDATE_ENDPOINT_METADATA],requestName:Je.NETWORK_REQUESTS.UPDATE_ENDPOINT_METADATA.name,payload:Be.getPayload(this,z),causeId:B}).then((function(){G.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_ENDPOINT_METADATA_SUCCESS,{causeId:B})})).catch((function(F){var z=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);return G.logger.info("[".concat(B,"][updateEndpointMetadata] error: ").concat((0,$.getPrintableObject)(z))),G.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_ENDPOINT_METADATA_FAILURE,W({},z.error)),Promise.reject(z.error)}))},SignalingSession.prototype.isOneToOnePSTNCall=function(){return this.signalingSessionCallback.isOneToOnePstnCall()},SignalingSession.prototype.getLocationContent=function(){return this.isOneToOnePSTNCall()?Ze.tryParse(this.locationInfoContent):null},SignalingSession.prototype.getNetworkContent=function(){return this.isOneToOnePSTNCall()?Ze.tryParse(this.networkInfoContent):null},SignalingSession.prototype.getAreaContent=function(){return this.isOneToOnePSTNCall()?Ze.tryParse(this.areaContent):null},SignalingSession.prototype.setLocationInfo=function(F,B,G){this.locationInfoContent=F,this.networkInfoContent=B,this.areaContent=G},SignalingSession.prototype.getEndpointCapabilities=function(F){var B;return this.signalingAgentConfig.enableDeltaRosterWeb?(B=0,this.signalingAgentConfig.brokerEnabledIncoming&&(B|=16),this.signalingAgentConfig.isGVCJoiningEnabled&&(B|=1),"disabled"!==this.signalingAgentConfig.cloudScreenSharingFlag&&(B|=2),this.signalingAgentConfig.supportsHostlessGroupCalls&&(B|=4),F||(B|=64),this.signalingAgentConfig.autoJoinOnConflict&&(B|=32),this.signalingAgentConfig.supportsCompressedServicePayload&&(B|=128),this.signalingAgentConfig.enablePstnMasking&&(B|=1024)):B={implicitCallback:this.signalingAgentConfig.brokerEnabledIncoming?"enabled":"disabled",cloudAudioVideoConference:this.signalingAgentConfig.isGVCJoiningEnabled?"enabled":"disabled",cloudScreenSharing:this.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:this.signalingAgentConfig.supportsHostlessGroupCalls?"enabled":"disabled",serverMuteUnmute:F?"disabled":"enabled",autoJoinOnConflict:this.signalingAgentConfig.autoJoinOnConflict?"enabled":"disabled",supportsCompressedServicePayload:this.signalingAgentConfig.supportsCompressedServicePayload?"enabled":"disabled",enablePstnMasking:this.signalingAgentConfig.enablePstnMasking?"enabled":"disabled"},B},SignalingSession.prototype.handleAdmitAllStatus=function(F){var B=F.body&&F.body.transactionResponse,G=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(G,"][handleAdmitAllStatus][").concat((0,$.getPrintableObject)(B),"]"));var W=B&&B.operationId;if(W&&this.callOperationHandler.hasPendingOperation(0,W,G)){this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.ADMIT,W);var z=B&&B.result&&B.result.code,K=B&&B.result&&B.result.subCode,J=B&&B.result&&B.result.resultCategories,Q=B&&B.additionalDetail;if(0===z||z>=200&&z<300){var Y={code:z,subCode:K,resultCategories:J,result:(0,$.safeJsonStringify)(Q)};this.telemetryHelper.recordEvent(Je.EVENTS.ADMIT_SUCCESS,{causeId:W,transactionEnd:Y}),this.callOperationHandler.resolvePendingOperation(0,W,Y,G)}else{Y={code:z||Ye.default.CALL_END_CODE.BAD_REQUEST,subCode:K||0,resultCategories:J,result:B,phrase:Ye.default.CALL_END_PHRASE.BAD_SERVICE_RESPONSE};this.telemetryHelper.recordEvent(Je.EVENTS.ADMIT_FAILURE,{causeId:W,transactionEnd:Y}),this.callOperationHandler.rejectPendingOperation(0,W,"AdmitAllStatus response contains failure",Y,G)}}else this.logger.warn("[".concat(G,"][handleAdmitAllStatus] invalid admitAllStatus response or no pending operation. operationId=").concat(W))},SignalingSession.prototype.sendNetworkRequestForAdmit=function(F){var B=this,onceTrouterReady=function(){B.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.ADMIT,(function(){B.telemetryHelper.recordEvent(Je.EVENTS.ADMIT_TIMEOUT,{causeId:F}),B.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.ADMIT,F),B.callOperationHandler.rejectPendingOperation(0,F,"timed out waiting for admit operation",{code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.ADMIT_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.ADMIT_TIMEOUT},F)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.ADMIT_TIMEOUT,F)};this.http.sendPostRequest({url:this.links[Ye.default.LINKS.ADMIT_ALL],requestName:Je.NETWORK_REQUESTS.ADMIT.name,payload:he.getPayload(this,F),causeId:F,onceTrouterReady:onceTrouterReady}).catch((function(G){var z=Ze.getErrorForXHRFailure(G,B.signalingAgentConfig);B.telemetryHelper.recordEvent(Je.EVENTS.ADMIT_FAILURE,W({causeId:F},z.error)),B.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.ADMIT,F),B.callOperationHandler.rejectPendingOperation(0,F,G,z.error,F)}))},SignalingSession.prototype.getConversationType=function(F,B){return F?"emergencyGroupCall":B?"cast":null},SignalingSession.prototype.convertParkType=function(F){return"teamPark"===F?"TransferTypeTeamPark":"sharedLinePark"===F?"TransferTypeSharedLinePark":"serverHold"===F?"TransferTypeServerHold":(this.logger.info("convertParkType, parkType: ".concat(F," is unknown")),"none")},SignalingSession.prototype.parkByTransfer=function(F,B){var G=this;this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){G.handleCallTransferTimeout(B)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT);var z=this.getNetworkRequestName(F);return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.TRANSFER],requestName:z,payload:Pe.getPayload(F,this),causeId:B}).catch((function(F){var z=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);return G.logger.info("[".concat(B,"][parkByTransfer] error: ").concat((0,$.getPrintableObject)(z))),G.disposed?Promise.reject(G.getCallNotFoundTransactionEnd()):(G.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:Ye.default.CALL_END_CODE.NETWORK_ERROR,reason:(0,$.getPrintableObject)(F)}},B),G.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_REQUEST_FAILED,W({causeId:B},z.error)),Promise.reject(z.error))})),this.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_REQUEST_SENT,{causeId:B,transferType:this.convertParkType(F)}),Promise.resolve()},SignalingSession.prototype.park=function(F,B){var G=this;this.logger.info("[".concat(B,"][park] context ").concat(F)),this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.PARK_COMPLETION,(function(){G.handleParkError({code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.PARK_COMPLETION_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.PARK_COMPLETION_TIMEOUT},Je.EVENTS.WAITING_FOR_PARK_COMPLETION_TIMEOUT,B,F)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.PARK_COMPLETION_TIMEOUT);var W=this.getHoldTypeInRequest(F),z={causeId:B};return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.PARK],requestName:Je.NETWORK_REQUESTS.PARK_REQUEST.name,payload:Oe.getPayload(this,W,z),causeId:B}).then((function(F){G.logger.info("[".concat(B,"][park] response: ").concat((0,$.getPrintableObject)(F))),G.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_PARK_COMPLETION,{causeId:B}),Ze.assertNotNull(F.response.holdResponse.links,"server response does not include park links"),G.links[Ye.default.LINKS.UNPARK]=F.response.holdResponse.links.resume})).catch((function(W){var z=Ze.getErrorForXHRFailure(W,G.signalingAgentConfig);return G.logger.info("[".concat(B,"][park] error: ").concat((0,$.getPrintableObject)(z))),G.disposed?Promise.reject(G.getCallNotFoundTransactionEnd()):(G.handleParkError(z.error,Je.EVENTS.PARK_REQUEST_FAILED,B,F),Promise.reject(z.error))})),Promise.resolve()},SignalingSession.prototype.getHoldTypeInRequest=function(F){switch(F){case"serverHoldV2":return"musicOnHold";case"sharedLineParkV2":return"sharedLineAppearance";default:return null}},SignalingSession.prototype.handleParkError=function(F,B,G,z){this.disposed?this.logger.info("handleParkError ignored"):(this.logger.info("[".concat(G,"] handleParkError reject reason: ").concat((0,$.getPrintableObject)(F))),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.PARK_COMPLETION),this.signalingSessionCallback.onParkCompleted&&(this.telemetryHelper.recordEvent(B,W(W({},F),{parkContext:z,causeId:G})),this.signalingSessionCallback.onParkCompleted(F,G)),this.links[Ye.default.LINKS.UNPARK]=void 0)},SignalingSession.prototype.handleParkCompletion=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F),W=B.holdCompletion;this.handleOperationCompletionCommon(W,G,void 0,(0,$.getPrintableObject)(B),"handleParkCompletion",Ye.default.TIMEOUT_OPERATIONS.PARK_COMPLETION,Je.EVENTS.PARK_COMPLETED,Je.EVENTS.PARK_FAILED,this.signalingSessionCallback.onParkCompleted,this.handleParkError.bind(this))},SignalingSession.prototype.handleUnparkError=function(F,B,G,z){this.disposed?this.logger.info("handleUnparkError ignored"):(this.logger.info("[".concat(G,"] handleUnparkError reject reason: ").concat(F)),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.signalingSessionCallback.onUnparkCompleted&&(this.telemetryHelper.recordEvent(B,W(W({},F),{parkContext:z,causeId:G})),this.signalingSessionCallback.onUnparkCompleted(F,G)),this.links[Ye.default.LINKS.UNPARK]=void 0)},SignalingSession.prototype.handleUnparkCompletion=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F);if(this.disposed)this.logger.info("[".concat(G,"]handleUnparkCompletion ignored"));else{this.logger.info("[".concat(G,"][handleUnparkCompletion] body ").concat((0,$.getPrintableObject)(B)));var z=B.resumeCompletion;z.code===Ye.default.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.telemetryHelper.recordEvent(Je.EVENTS.UNPARK_COMPLETED,W(W({},z),{causeId:G})),this.signalingSessionCallback.onUnparkCompleted(z,G),this.links[Ye.default.LINKS.UNPARK]=void 0):this.handleUnparkError(z,Je.EVENTS.UNPARK_FAILED,G)}},SignalingSession.prototype.getNetworkRequestName=function(F){return{none:null,teamPark:Je.NETWORK_REQUESTS.SEND_PARK_REQUEST.name,sharedLinePark:Je.NETWORK_REQUESTS.SEND_SHARED_LINE_PARK_REQUEST.name,serverHold:Je.NETWORK_REQUESTS.SEND_SERVER_HOLD_REQUEST.name}[F]},SignalingSession.prototype.updateMeetingsGroupsAsync=function(F,B){var G=this;this.logger.info("[".concat(F,"][updateMeetingsGroupsAsync] scope=").concat(B.scope)),this.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_MEETING_GROUPS,{causeId:F,options:B}),this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION,(function(){G.handleUpdateMeetingGroupsError({code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT},Je.EVENTS.WAITING_FOR_UPDATE_MEETING_GROUPS_COMPLETION,F,F,B)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT);var W=Ge.getMeetingGroupsPayload(this,B,F);return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.UPDATE_MEETING_GROUPS],requestName:Je.NETWORK_REQUESTS.UPDATE_MEETING_GROUPS.name,payload:W,causeId:F}).then((function(B){G.logger.info("[".concat(F,"][updateMeetingsGroupsAsync] response: ").concat((0,$.getPrintableObject)(B))),G.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_UPDATE_MEETING_GROUPS_COMPLETION,{causeId:F})})).catch((function(W){var z=Ze.getErrorForXHRFailure(W,G.signalingAgentConfig);return G.logger.info("[".concat(F,"][updateMeetingsGroupsAsync] error: ").concat((0,$.getPrintableObject)(z))),G.disposed?Promise.reject(G.getCallNotFoundTransactionEnd()):(G.handleUpdateMeetingGroupsError(z.error,Je.EVENTS.UPDATE_MEETING_GROUPS_REQUEST_FAILED,F,F,B),Promise.reject(z.error))}))},SignalingSession.prototype.updateParticipantInterpretationStateAsync=function(F,B){return Ze.assertNotNullOrEmpty(B,"options should be a non null value"),this.logger.info("[".concat(F,"][updateParticipantInterpretationStateAsync]")),this.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{causeId:F,options:B}),this.participantManager.updateParticipantInterpretationStateAsync(B,this.links[Ye.default.LINKS.UPDATE_PARTICIPANT_INTERPRETATION_STATE],F)},SignalingSession.prototype.joinMeetingGroupAsync=function(F,B){var G=this;this.logger.info("[".concat(F,"][joinMeetingGroupAsync]")),this.telemetryHelper.recordEvent(Je.EVENTS.JOIN_MEETING_GROUP,{causeId:F,options:B}),this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION,(function(){G.handleJoinMeetingGroupError({code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.JOIN_MEETING_GROUP_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.JOIN_MEETING_GROUP_TIMEOUT},Je.EVENTS.WAITING_FOR_JOIN_MEETING_GROUP_COMPLETION,F,F,B)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.JOIN_MEETING_GROUP_COMPLETION_TIMEOUT);var W=be.getJoinMeetingGroupPayload(this,B,F);return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.JOIN_MEETING_GROUP],requestName:Je.NETWORK_REQUESTS.JOIN_MEETING_GROUP.name,payload:W,causeId:F}).then((function(B){G.logger.info("[".concat(F,"][joinMeetingGroupAsync] response: ").concat((0,$.getPrintableObject)(B))),G.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_JOIN_MEETING_GROUP_COMPLETION,{causeId:F})})).catch((function(W){var z=Ze.getErrorForXHRFailure(W,G.signalingAgentConfig);return G.logger.info("[".concat(F,"][joinMeetingGroupAsync] error: ").concat((0,$.getPrintableObject)(z))),G.disposed?Promise.reject(G.getCallNotFoundTransactionEnd()):(G.handleJoinMeetingGroupError(z.error,Je.EVENTS.JOIN_MEETING_GROUP_REQUEST_FAILED,F,F,B),Promise.reject(z.error))}))},SignalingSession.prototype.leaveMeetingGroupAsync=function(F,B){var G=this;this.logger.info("[".concat(F,"][leaveMeetingGroupAsync]")),this.telemetryHelper.recordEvent(Je.EVENTS.LEAVE_MEETING_GROUP,{causeId:F,options:B}),this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION,(function(){G.handleLeaveMeetingGroupError({code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.LEAVE_MEETING_GROUP_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.LEAVE_MEETING_GROUP_TIMEOUT},Je.EVENTS.WAITING_FOR_LEAVE_MEETING_GROUP_COMPLETION,F,F,B)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.LEAVE_MEETING_GROUP_COMPLETION_TIMEOUT);var W=Ae.getLeaveMeetingGroupPayload(this,B,F);return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.LEAVE_MEETING_GROUP],requestName:Je.NETWORK_REQUESTS.LEAVE_MEETING_GROUP.name,payload:W,causeId:F}).then((function(B){G.logger.info("[".concat(F,"][leaveMeetingGroupAsync] response: ").concat((0,$.getPrintableObject)(B))),G.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_LEAVE_MEETING_GROUP_COMPLETION,{causeId:F})})).catch((function(W){var z=Ze.getErrorForXHRFailure(W,G.signalingAgentConfig);return G.logger.info("[".concat(F,"][leaveMeetingGroupAsync] error: ").concat((0,$.getPrintableObject)(z))),G.disposed?Promise.reject(G.getCallNotFoundTransactionEnd()):(G.handleLeaveMeetingGroupError(z.error,Je.EVENTS.LEAVE_MEETING_GROUP_REQUEST_FAILED,F,F,B),Promise.reject(z.error))}))},SignalingSession.prototype.handleUpdateMeetingGroupsError=function(F,B,G,z,K){this.disposed?this.logger.info("[".concat(G,"][handleUpdateMeetingGroupsError] ignored. Call disposed, err: ").concat(JSON.stringify(F))):(this.logger.info("[".concat(G,"][handleUpdateMeetingGroupsError] reject reason: ").concat(JSON.stringify(F))),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION),this.telemetryHelper.recordEvent(B,W(W({},F),{updateMeetingGroupsOptions:K,causeId:G})),this.signalingSessionCallback.onUpdateMeetingGroupsCompleted(F,G,z))},SignalingSession.prototype.handleUpdateMeetingGroupsCompletion=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F),z=B.updateMeetingGroupsResponse.operationId;if(this.disposed)this.logger.info("[".concat(G,"][handleUpdateMeetingGroupsCompletion] ignored. Call disposed."));else{z||this.logger.warn("[".concat(G,"][handleUpdateMeetingGroupsCompletion] operationId is undefined.")),this.logger.info("[".concat(G,"][handleUpdateMeetingGroupsCompletion] starts"));var K=B.updateMeetingGroupsResponse,J=(0,ee.processTransactionResponse)(K);J.code===Ye.default.TRANSACTION_END_CODE.SUCCESS?(this.logger.info("[".concat(G,"][handleUpdateMeetingGroupsCompletion] update meeting group succeeded")),this.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_MEETING_GROUPS_RESPONSE_SUCCESS,W(W({},J),{causeId:G}))):(this.logger.info("[".concat(G,"][handleUpdateMeetingGroupsCompletion] update meeting group failed code=").concat(J.code," subCode=").concat(J.subCode)),this.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_MEETING_GROUPS_RESPONSE_FAILURE,W(W({},J),{causeId:G}))),this.logger.info("[".concat(G,"][handleUpdateMeetingGroupsCompletion] completes")),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION),this.signalingSessionCallback.onUpdateMeetingGroupsCompleted(J,G,z)}},SignalingSession.prototype.handleJoinMeetingGroupError=function(F,B,G,z,K){this.disposed?this.logger.info("[".concat(G,"][handleJoinedMeetingGroupError] ignored. Call disposed, err: ").concat(JSON.stringify(F))):(this.logger.info("[".concat(G,"][handleJoinedMeetingGroupError] reject reason: ").concat(JSON.stringify(F))),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION),this.telemetryHelper.recordEvent(B,W(W({},F),{joinMeetingGroupOptions:K,causeId:G})),this.signalingSessionCallback.onJoinMeetingGroupCompleted(F,G,z))},SignalingSession.prototype.handleJoinMeetingGroupCompletion=function(F){var B=F.body.joinMeetingGroupResponse,G=Ze.extractCauseIdFromMessage(F),z=B.operationId;if(this.disposed)this.logger.info("[".concat(G,"][handleJoinMeetingGroupCompletion] ignored. Call disposed."));else{z||this.logger.warn("[".concat(G,"][handleJoinMeetingGroupCompletion] operationId is undefined.")),this.logger.info("[".concat(G,"][handleJoinMeetingGroupCompletion] starts"));var K=(0,ee.processTransactionResponse)(B);K.code===Ye.default.TRANSACTION_END_CODE.SUCCESS?(this.logger.info("[".concat(G,"][handleJoinMeetingGroupCompletion] join meeting group succeeded")),this.telemetryHelper.recordEvent(Je.EVENTS.JOIN_MEETING_GROUP_RESPONSE_COMPLETED,W(W({},K),{causeId:G}))):(this.logger.info("[".concat(G,"][handleJoinMeetingGroupCompletion] join meeting group failed code=").concat(K.code," subCode=").concat(K.subCode)),this.telemetryHelper.recordEvent(Je.EVENTS.JOIN_MEETING_GROUP_RESPONSE_FAILED,W(W({},K),{causeId:G}))),this.logger.info("[".concat(G,"][handleJoinMeetingGroupCompletion] complete")),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION),this.signalingSessionCallback.onJoinMeetingGroupCompleted(K,G,z)}},SignalingSession.prototype.handleLeaveMeetingGroupError=function(F,B,G,z,K){this.disposed?this.logger.info("[".concat(G,"][handleLeaveMeetingGroupError] ignored. Call disposed, err: ").concat(JSON.stringify(F))):(this.logger.info("[".concat(G,"][handleLeaveMeetingGroupError] reject reason: ").concat(JSON.stringify(F))),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION),this.telemetryHelper.recordEvent(B,W(W({},F),{leaveMeetingGroupOptions:K,causeId:G})),this.signalingSessionCallback.onLeaveMeetingGroupCompleted(F,G,z))},SignalingSession.prototype.handleLeaveMeetingGroupCompletion=function(F){var B=F.body.leaveMeetingGroupResponse,G=Ze.extractCauseIdFromMessage(F),z=B.operationId;if(this.disposed)this.logger.info("[".concat(G,"][handleLeaveMeetingGroupCompletion] ignored. Call disposed."));else{z||this.logger.warn("[".concat(G,"][handleLeaveMeetingGroupCompletion] operationId is undefined.")),this.logger.info("[".concat(G,"][handleLeaveMeetingGroupCompletion] starts"));var K=(0,ee.processTransactionResponse)(B);K.code===Ye.default.TRANSACTION_END_CODE.SUCCESS?(this.logger.info("[".concat(G,"][handleLeaveMeetingGroupCompletion] leave meeting group succeeded")),this.telemetryHelper.recordEvent(Je.EVENTS.LEAVE_MEETING_GROUP_RESPONSE_COMPLETED,W(W({},K),{causeId:G}))):(this.logger.info("[".concat(G,"][handleLeaveMeetingGroupCompletion] leave meeting group failed code=").concat(K.code," subCode=").concat(K.subCode)),this.telemetryHelper.recordEvent(Je.EVENTS.LEAVE_MEETING_GROUP_RESPONSE_FAILED,W(W({},K),{causeId:G}))),this.logger.info("[".concat(G,"][handleLeaveMeetingGroupCompletion] complete")),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION),this.signalingSessionCallback.onLeaveMeetingGroupCompleted(K,G,z)}},SignalingSession.prototype.handleReceiveMessage=function(F){var B,G=F.body,W=Ze.extractCauseIdFromMessage(F),z=G.operationId;if(this.disposed)this.logger.info("[".concat(W,"][").concat(z,"][handleReceiveMessage] ignored. Call disposed."));else{this.logger.info("[".concat(W,"][").concat(z,"][handleReceiveMessage] complete")),this.telemetryHelper.recordEvent(Je.EVENTS.INCOMING_PROXIED_MESSAGES,{causeId:W,operationId:z});var K=[{messageType:G.type,payload:G.payload,from:(B={},B[G.from.id]={participantLegIds:[G.from.participantId],level:"endpoint"},B)}];this.signalingSessionCallback.onIncomingProxiedMessages(K,W,z)}},SignalingSession.prototype.publishStateAsync=function(F,B,G,W,z,K){var J=this;this.logger.info("[".concat(G,"][publishStateAsync][publishType=").concat(F," publishLevel=").concat(B,"]")),this.telemetryHelper.recordEvent(Je.EVENTS.PUBLISH_STATE,{causeId:G,publishType:F,publishLevel:B});var Q=this.links[Ye.default.LINKS.PUBLISH_STATE];if(!Q){var Y={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.PUBLISH_STATE_LINK_MISSING,phrase:"publish state link is missing"};return this.logger.warn(Y),Promise.reject(Y)}var X={};try{X=JSON.parse(W)}catch(F){Y={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_CONTENT,phrase:"publish state content is invalid"};return this.logger.warn(Y),Promise.reject(Y)}return this.http.sendPostRequest({url:Q,requestName:Je.NETWORK_REQUESTS.PUBLISH_STATE.name,payload:we.getPayload(this,F,B,X,++this.publishStateSequenceNumber,z,K),causeId:G,requestId:G}).then((function(F){var B;if(null===(B=null==F?void 0:F.response)||void 0===B?void 0:B.publishStateResponse)return J.parsePublishStateResult(F,G);var W="Invalid CS response which does not contains publishStateResponse. Respone: ".concat((null==F?void 0:F.response)?JSON.stringify(F.response):"no response");throw J.logger.warn(W),{response:{code:Ye.default.CALL_END_CODE.DECODING_FAILED,subCode:Ye.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:W}}})).catch((function(F){var B=Ze.getErrorForXHRFailure(F,J.signalingAgentConfig);J.logger.info("[".concat(G,"][publishStateAsync] error: ").concat((0,$.getPrintableObject)(B)));var W=B.error;return J.telemetryHelper.recordEvent(Je.EVENTS.PUBLISH_STATE_FAILURE,{causeId:G,transactionEnd:W}),Promise.reject(W)}))},SignalingSession.prototype.parsePublishStateResult=function(F,B){var G={};if(F&&F.response&&F.response.publishStateResponse){if(F.response.publishStateResponse.stateId)return F.response.publishStateResponse.stateId;if(F.response.publishStateResponse.results){if(1===F.response.publishStateResponse.results.length){if(F.response.publishStateResponse.results[0].stateId)return F.response.publishStateResponse.results[0].stateId;this.logger.warn("invalid response format")}return F.response.publishStateResponse.results.forEach((function(F){G[F.participantId]={code:F.result.code,phrase:F.result.phrase,subCode:F.result.subCode}})),JSON.stringify(G)}if(F.response.publishStateResponse.result)return G={code:F.response.publishStateResponse.result.code,phrase:F.response.publishStateResponse.result.phrase,subCode:F.response.publishStateResponse.result.subCode,result:F.response.publishStateResponse.additionalDetail},JSON.stringify(G)}var W=F&&F.response?JSON.stringify(F.response):"no response",z="Invalid CS response which does not contains publishStateResponse. Respone: ".concat(W);throw this.logger.warn(z),{response:{code:Ye.default.CALL_END_CODE.DECODING_FAILED,subCode:Ye.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:z}}},SignalingSession.prototype.removeStateAsync=function(F,B,G,W){var z=this;if(this.logger.info("[".concat(F,"][removeStateAsync][scope=").concat(B," publishType=").concat(G," stateIds=").concat(W,"]")),this.telemetryHelper.recordEvent(Je.EVENTS.REMOVE_STATE,{causeId:F,scope:B,publishType:G,stateIds:W}),!G&&!W){var K={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.REMOVE_STATE_MISSING_ARGUMENTS,phrase:"remove state operation miss arguments"};return this.logger.warn(K),Promise.reject(K)}var J=this.links[Ye.default.LINKS.REMOVE_STATE];if(!J){K={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.REMOVE_STATE_LINK_MISSING,phrase:"remove state link is missing"};return this.logger.warn(K),Promise.reject(K)}return this.http.sendPostRequest({url:J,requestName:Je.NETWORK_REQUESTS.REMOVE_STATE.name,payload:Ne.getPayload(this,++this.publishStateSequenceNumber,B,W,G),causeId:F,requestId:F}).then((function(B){return z.parseRemoveStateResult(B,F)})).catch((function(B){var G=Ze.getErrorForXHRFailure(B,z.signalingAgentConfig);z.logger.info("[".concat(F,"][removeStateAsync] error: ").concat((0,$.getPrintableObject)(G)));var W=G.error;return z.telemetryHelper.recordEvent(Je.EVENTS.REMOVE_STATE_FAILURE,{causeId:F,transactionEnd:W}),Promise.reject(W)}))},SignalingSession.prototype.parseRemoveStateResult=function(F,B){var G={};return F&&F.response&&F.response.removeStateResponse&&(F.response.removeStateResponse.results?F.response.removeStateResponse.results.forEach((function(F){G[F.stateId]={code:F.result.code,phrase:F.result.phrase,subCode:F.result.subCode}})):F.response.removeStateResponse.result&&(G={code:F.response.removeStateResponse.result.code,phrase:F.response.removeStateResponse.result.phrase,subCode:F.response.removeStateResponse.result.subCode,result:F.response.removeStateResponse.additionalDetail})),JSON.stringify(G)},SignalingSession.prototype.updateMeetingSettingsAsync=function(F,B){var G=this;this.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_MEETING_SETTINGS,{causeId:B,meetingSettings:F});var W=this.links[Ye.default.LINKS.UPDATE_MEETING_SETTINGS];if(!W){var z={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_LINK_MISSING,phrase:"update meeting settings link is missing"};return this.logger.warn(z),Promise.reject(z)}if(!Object.keys(F).length){z={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS,phrase:"update meeting settings missing arguments"};return this.logger.warn(z),Promise.reject(z)}return this.http.sendPutRequest({url:W,requestName:Je.NETWORK_REQUESTS.UPDATE_MEETING_SETTINGS.name,payload:qe.getPayload(this,++this.publishStateSequenceNumber,F),causeId:B,requestId:B}).then((function(){Q.noop()})).catch((function(F){var W=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[".concat(B,"][updateMeetingSettingsAsync] error: ").concat((0,$.getPrintableObject)(W)));var z=W.error;throw G.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_MEETING_SETTINGS_FAILURE,{causeId:B,transactionEnd:z}),z}))},SignalingSession.prototype.searchParticipantsAsync=function(F,B){var G=this;this.logger.info("[".concat(B,"][searchParticipantsAsync][queryOptions=").concat(F,"]")),this.telemetryHelper.recordEvent(Je.EVENTS.SEARCH_PARTICIPANTS,{causeId:B,queryOptions:F});var W=this.links[Ye.default.LINKS.SEARCH_PARTICIPANTS];if(!W){var z={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_LINK_MISSING,phrase:"search participants link is missing"};return this.logger.warn(z),Promise.reject(z)}return this.http.sendPostRequest({url:W,requestName:Je.NETWORK_REQUESTS.SEARCH_PARTICIPANTS.name,payload:Le.getPayload(this,F),causeId:B,requestId:B}).then((function(F){if(F&&F.response&&F.response.participants)return G.parseSearchParticipantsResult(F,B);var W=F&&F.response?JSON.stringify(F.response):"no response",z="Invalid CS response which does not contain proper search results. Respone: ".concat(W);throw G.logger.warn(z),{response:{code:Ye.default.CALL_END_CODE.DECODING_FAILED,subCode:Ye.default.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:z}}})).catch((function(F){var W=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[".concat(B,"][searchParticipantsAsync] error: ").concat((0,$.getPrintableObject)(W)));var z=W.error;return G.telemetryHelper.recordEvent(Je.EVENTS.SEARCH_PARTICIPANTS_FAILURE,{causeId:B,transactionEnd:z}),Promise.reject(z)}))},SignalingSession.prototype.parseSearchParticipantsResult=function(F,B){var G,W,z=[];if(F&&F.response){var K=F.response.participants;if(K)try{for(var Q=J(Object.keys(K)),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;z.push(ce.default.fromRosterSearchResults(F.response.participants[$]))}}catch(F){G={error:F}}finally{try{Y&&!Y.done&&(W=Q.return)&&W.call(Q)}finally{if(G)throw G.error}}}return{participants:z}},SignalingSession.prototype.getAllParticipantsAsync=function(F,B){var G=this;this.logger.info("[".concat(B,"][getAllParticipantsAsync][scope=").concat(F,"]")),this.telemetryHelper.recordEvent(Je.EVENTS.GET_ALL_PARTICIPANTS,{causeId:B,scope:F});var W=this.links[Ye.default.LINKS.GET_ALL_PARTICIPANTS];if(!W){var z={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_LINK_MISSING,phrase:"get all participants link is missing"};return this.logger.warn(z),Promise.reject(z)}if("lobby"!==F){z={code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SCOPE,phrase:"get all participants scope is invalid"};return this.logger.warn(z),Promise.reject(z)}return this.http.sendPostRequest({url:W,requestName:Je.NETWORK_REQUESTS.GET_ALL_PARTICIPANTS.name,payload:Te.getPayload(this,F),causeId:B,requestId:B}).then((function(F){if(F&&F.response)return{participants:F.response.particiapnts};var B="Invalid CS response which does not contain results.";throw G.logger.warn(B),{response:{code:Ye.default.CALL_END_CODE.DECODING_FAILED,subCode:Ye.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:B}}})).catch((function(F){var W=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[".concat(B,"][getAllParticipantsAsync] error: ").concat((0,$.getPrintableObject)(W)));var z=W.error;return G.telemetryHelper.recordEvent(Je.EVENTS.GET_ALL_PARTICIPANTS_FAILURE,{causeId:B,transactionEnd:z}),Promise.reject(z)}))},SignalingSession.prototype.setClientRejectReason=function(F,B){F.clientReasonSubCode=B.clientReasonSubCode,F.clientReasonPhrase=B.clientReasonPhrase},SignalingSession.prototype.resetState=function(){this.currentCallStatus=null,this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE},SignalingSession.prototype.saveUpdatedCallLinksIfAny=function(F){F.links&&(this.logger.info("saveUpdatedCallLinksIfAny, updated call links found, update to new links ".concat((0,$.getPrintableObject)(F))),this.links[Ye.default.LINKS.MEDIA_RENEGOTIATION]=F.links.mediaRenegotiation||this.links[Ye.default.LINKS.MEDIA_RENEGOTIATION],this.links[Ye.default.LINKS.TRANSFER]=F.links.transfer||this.links[Ye.default.LINKS.TRANSFER],this.links[Ye.default.LINKS.REPLACE]=F.links.replacement||this.links[Ye.default.LINKS.REPLACE],this.links[Ye.default.LINKS.HANGUP]=F.links.callLeg||this.links[Ye.default.LINKS.HANGUP],this.links[Ye.default.LINKS.KEEPALIVE]=F.links.callLeg||this.links[Ye.default.LINKS.KEEPALIVE],this.links[Ye.default.LINKS.PARK]=F.links.hold||this.links[Ye.default.LINKS.PARK])},SignalingSession.prototype.ensureMessageChannelReady=function(F){return this.disposed?(this.logger.info("ensureMessageChannelReady: error: call already disposed"),Promise.reject(this.getCallNotFoundTransactionEnd())):this.brokerService?(this.telemetryHelper.addTrouterWaitOperation("".concat(Je.default.TROUTER_WAIT_OPERATION.STARTED,":").concat(F)),this.telemetryHelper.addTrouterWaitOperation("".concat(Je.default.TROUTER_WAIT_OPERATION.ENDED,":").concat(F)),Promise.resolve()):this.ensureLatestTrouterUrl(F)},SignalingSession.prototype.ensureLatestTrouterUrl=function(F){var B=this;return this.telemetryHelper.addTrouterWaitOperation("".concat(Je.default.TROUTER_WAIT_OPERATION.STARTED,":").concat(F)),this.getTrouterUrlAsync().then((function(G){return!G||"string"==typeof G&&!G.trim()?(B.telemetryHelper.recordEvent(Je.EVENTS.TROUTER_URL_CHANGED_TO_INVALID),B.telemetryHelper.addTrouterWaitOperation("".concat(Je.default.TROUTER_WAIT_OPERATION.ENDED,":").concat(F)),Promise.reject(new Error("Invalid trouter url"))):B.disposed?(B.logger.info("ensureLatestTrouterUrl, trouterUrlGetter returned too late. Object is already disposed"),Promise.reject(B.getCallNotFoundTransactionEnd())):(B.telemetryHelper.addTrouterWaitOperation("".concat(Je.default.TROUTER_WAIT_OPERATION.ENDED,":").concat(F)),B.baseMessagingChannelUrl=B.currentTrouterUrl=G,Promise.resolve())})).catch((function(G){return B.disposed||B.telemetryHelper.addTrouterWaitOperation("".concat(Je.default.TROUTER_WAIT_OPERATION.FAILED,":").concat(F)),B.logger.info("ensureLatestTrouterUrl, failed because:".concat(G)),Promise.reject(G)}))},SignalingSession.prototype.signalTransferAcceptedAsync=function(F,B){var G=this;return void 0===B&&(B=Ze.causeId()),this.logger.info("[signalTransferAcceptedAsync][".concat(B,"] transferType ").concat(F)),this.disposed?(this.logger.info("[signalTransferAcceptedAsync][".concat(B,"] Call already ended, skip acceptance request")),Promise.reject({code:Ye.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(this.telemetryHelper.recordEvent(Je.EVENTS.SEND_ACCEPT_TRANSFER,{causeId:B,transferType:F}),this.http.sendPostRequest({url:this.links[Ye.default.LINKS.TRANSFER_ACCEPTANCE],requestName:Je.NETWORK_REQUESTS.TRANSFER_ACCEPTANCE.name,payload:Fe.getPayload(),causeId:B}).catch((function(F){var W=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);return G.logger.info("[signalTransferAcceptedAsync][".concat(B,"] error: ").concat((0,$.getPrintableObject)(W))),G.telemetryHelper.recordEvent(Je.EVENTS.SEND_ACCEPT_TRANSFER_FAIL,{causeId:B}),Promise.reject(W.error)})))},SignalingSession.prototype.signalTransferCompletedAsync=function(F,B){var G=this;return void 0===B&&(B=Ze.causeId()),this.logger.info("[signalTransferCompletedAsync][".concat(B,"] rejectReason ").concat(F)),this.disposed?(this.logger.info("[signalTransferCompletedAsync][".concat(B,"]  Call already ended by transferor, skip completion request")),Promise.reject({code:Ye.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(0!==F.code?this.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_COMPLETION_FAILED,{code:F.code,subcode:F.subCode,causeId:B}):this.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_COMPLETED,{causeId:B}),this.telemetryHelper.recordEvent(Je.EVENTS.SEND_COMPLETE_TRANSFER,{causeId:B}),this.http.sendPostRequest({url:this.links[Ye.default.LINKS.TRANSFER_COMPLETION],requestName:Je.NETWORK_REQUESTS.TRANSFER_COMPLETION.name,payload:Ue.getPayload(F),causeId:B}).catch((function(F){G.telemetryHelper.recordEvent(Je.EVENTS.SEND_COMPLETE_TRANSFER_FAILED,{causeId:B});var W=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);return G.logger.info("[signalTransferCompletedAsync][".concat(B,"] error: ").concat((0,$.getPrintableObject)(W))),Promise.reject(W.error)})))},SignalingSession.prototype.endWithBeacon=function(F){if(navigator&&navigator.sendBeacon&&!this.disposed){var B={code:Ye.default.CALL_END_CODE.SUCCESS,subCode:Ye.default.CALL_END_SUB_CODE.BEACON,phrase:Ye.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};this.telemetryHelper.recordEvent(Je.EVENTS.END_WITH_BEACON,{causeId:F});var G=JSON.stringify(Ie.getPayload(this,B).payload),W=-1===this.links[Ye.default.LINKS.LEAVE].indexOf("?")?"?":"&",z="skypeToken=".concat(this.signalingAgent.authTokenManager.getLastToken(F));return navigator.sendBeacon("".concat(this.links[Ye.default.LINKS.LEAVE]).concat(W).concat(z),G)}return!1},SignalingSession.prototype.setFsmState=function(F){this.fsmState=F},SignalingSession.prototype.setIsHostless=function(F,B){var G=!!F;this.isHostLessCall!==G&&(this.logger.info("[".concat(B,"][setIsHostless] isHostless=").concat(G)),this.isHostLessCall=G)},SignalingSession.prototype.hasGroupModality=function(){return this.threadId||this.groupId},SignalingSession.prototype.processConversationServiceResponseHeaders=function(F,B){this.logger.info("[".concat(B,"][processConversationServiceResponseHeaders]"));try{var G=F.request.getResponseHeader(Ye.default.HEADERS.CORRELATION_ID);this.updateCorrelationId(G,B)}catch(F){this.logger.info("[".concat(B,"][processConversationServiceResponseHeaders] failed, reason=").concat((0,$.getPrintableObject)(F)))}},SignalingSession.prototype.processConversationServiceResponse=function(F,B){this.logger.info("[".concat(B,"][processConversationServiceResponse]")),this.convJoined=!0;var G=F.sequenceNumber>=0?F.sequenceNumber:-1;if(G<this.updateSequenceNumber)this.logger.info("[".concat(B,"][processConversationServiceResponse] seqNum=").concat(G," is less than latest seqNum=").concat(this.updateSequenceNumber));else{if(this.updateSequenceNumber=G,this.links[Ye.default.LINKS.CONVERSATION_CONTROLLER]=F.conversationController,this.links[Ye.default.LINKS.ADD_PARTICIPANT]=F.links.addParticipant,this.links[Ye.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]=F.links.addParticipantAndModality,this.links[Ye.default.LINKS.LEAVE]=F.links.leave,this.links[Ye.default.LINKS.NOTIFICATION_LINKS]=F.links.notificationLinks,this.links[Ye.default.LINKS.REMOVE_PARTICIPANT]=F.links.removeParticipant,this.links[Ye.default.LINKS.ADD_MODALITY]=F.links.addModality,this.links[Ye.default.LINKS.REMOVE_MODALITY]=F.links.removeModality,this.links[Ye.default.LINKS.MUTE]=F.links.mute||null,this.links[Ye.default.LINKS.UNMUTE]=F.links.unmute||null,this.links[Ye.default.LINKS.ADMIT]=F.links.admit||null,this.links[Ye.default.LINKS.ADMIT_ALL]=F.links.admitAll||null,this.links[Ye.default.LINKS.UPDATE_ENDPOINT_STATE]=F.links.updateEndpointState||null,this.links[Ye.default.LINKS.UPDATE_ENDPOINT_METADATA]=F.links.updateEndpointMetadata||null,this.links[Ye.default.LINKS.UPDATE_PARTICIPANT_ROLE]=F.links.updateParticipantRole||null,this.links[Ye.default.LINKS.PUBLISH_STATE]=F.links.publishState||null,this.links[Ye.default.LINKS.REMOVE_STATE]=F.links.removeState||null,this.links[Ye.default.LINKS.UPDATE_MEETING_SETTINGS]=F.links.updateMeetingSettings||null,this.links[Ye.default.LINKS.SEARCH_PARTICIPANTS]=F.links.searchParticipants||null,this.links[Ye.default.LINKS.GET_ALL_PARTICIPANTS]=F.links.getAllParticipants||null,this.links[Ye.default.LINKS.UPDATE_MEETING_LIVE_STATE]=F.links.updateMeetingLiveState||null,this.links[Ye.default.LINKS.UPDATE_MEETING_GROUPS]=F.links.updateMeetingGroups||null,this.links[Ye.default.LINKS.SET_MEETING_LAYOUT]=F.links.setMeetingLayout||null,this.links[Ye.default.LINKS.UPDATE_PARTICIPANT_INTERPRETATION_STATE]=F.links.updateParticipantInterpretationState||null,this.links[Ye.default.LINKS.JOIN_MEETING_GROUP]=F.links.joinMeetingGroup||null,this.links[Ye.default.LINKS.LEAVE_MEETING_GROUP]=F.links.leaveMeetingGroup||null,this.convSubject=F.subject,F.state&&(this.setMultiParty(F.state.isMultiParty,B),this.setIsHostless(F.state.isHostless||!1,B),this.conversationType=F.state.conversationType,this.isCastCall=!!F.state.conversationType&&"cast"===F.state.conversationType),F.activeModalities&&F.activeModalities.groupChat&&this.updateGroupChatIds(F.activeModalities.groupChat,B),F.activeModalities&&F.activeModalities.broadcast&&(this.broadcastSession||(this.broadcastSession=new ne.default(this,this.signalingSessionCallback)),this.broadcastSession.handleBroadcastDetailsChanged(F,B)),this.handleMeetingDetailsChanged(F,B),this.handleBrokerSubscription(F,B),this.linkUpdateRequested.conversationLinks?(this.logger.info("[".concat(B,"][processConversationServiceResponse] Updating CS links as requested")),this.updateLinks(this.updateConversationLinks,B)):this.scheduleConversationKeepAlive(),this.isProcessSelfDataFromSubscribeResponseEnabled()&&F.subscriptionDetails&&F.subscriptionDetails.selfParticipant){var W=ce.default.fromRoster(F.subscriptionDetails.selfParticipant,!0);this.logger.info("[".concat(B,"][processConversationServiceResponse] converted selfParticipant to Participant type")),this.participantManager.updateLocalParticipantFromSubscribe(W,B)}F.meetingData&&(this.meetingData=F.meetingData),F.meetingInfo&&(this.meetingInfo=F.meetingInfo),F.region&&(this.region=F.region),F.callLimits&&(this.callLimits=F.callLimits),this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,groupId:this.groupId,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo,callLimits:this.callLimits},B)}},SignalingSession.prototype.processLocalParticipantUpdateResponse=function(F,B){this.logger.info("[".concat(B,"][processLocalParticipantUpdateResponse]")),F.sequenceNumber&&F.sequenceNumber<this.localParticipantUpdateSequenceNumber||(this.breakoutDetails=F.breakoutDetails||{},this.signalingSessionCallback.onBreakoutDetailsUpdated(this.breakoutDetails,B))},SignalingSession.prototype.handlePendingEndpointState=function(F){var B=this;this.requestedEndpointStateWhileConnecting&&(this.logger.info("[".concat(F,"][handlePendingEndpointState]sending pending endpoint state now that we are connected.")),this.updateEndpointState(this.requestedEndpointStateWhileConnecting,F).catch((function(F){B.isPreheatOnly&&(B.logger.info("handlePendingEndpointState failed"),B.disablePreheatDefer.reject(F))})))},SignalingSession.prototype.handleMeetingDetailsChanged=function(F,B){this.logger.info("[".concat(B,"][handleMeetingDetailsChanged]")),F.meetingDetails&&!Q.isEqual(F.meetingDetails,this.meetingDetails)&&this.signalingSessionCallback.onMeetingDetailsUpdated&&(this.meetingDetails=F.meetingDetails,this.meetingDetails.meetingCapability&&this.meetingDetails.meetingCapability.meetingLiveState&&(this.meetingLiveStateSequenceNumber=this.meetingDetails.meetingCapability.meetingLiveState.seqNum,this.logger.info("[".concat(B,"][handleMeetingDetailsChanged] update meeting seqNum as ").concat(this.meetingLiveStateSequenceNumber))),this.signalingSessionCallback.onMeetingDetailsUpdated(this.meetingDetails,B))},SignalingSession.prototype.handleBrokerSubscription=function(F,B){this.logger.info("[".concat(B,"][handleBrokerSubscription]")),F.links.subscribe?(this.telemetryHelper.recordEvent(Je.EVENTS.SUBSCRIBE_URL_FOUND,B),this.brokerService?this.brokerService.subscribeToBroker(F.links.subscribe):this.telemetryHelper.recordEvent(Je.EVENTS.BROKER_DISABLED_SUBSCRIBE_URL_PRESENT)):this.telemetryHelper.recordEvent(Je.EVENTS.SUBSCRIBE_URL_MISSING,B)},SignalingSession.prototype.cancelOutgoingCall=function(F,B){var G=this,W=Ze.defer();this.logger.info("[".concat(B,"][cancelOutgoingCall][rejectionData=").concat(F&&(0,$.getPrintableObject)(F),"]"));var z=F&&(F.code||F.subCode)?F:{code:Ye.default.CALL_END_CODE.CANCEL,subCode:Ye.default.CALL_END_SUB_CODE.SUCCESS,phrase:Ye.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};if(F&&this.setClientRejectReason(z,F),z.resultCategories=z.resultCategories||[Ye.RESULT_CATEGORIES.Success],this.links.hasOwnProperty(Ye.default.LINKS.LEAVE)){this.logger.info("[".concat(B,"][cancelOutgoingCall] cancelling outgoing call")),this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE;var K={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()},J={terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultDetail:z.phrase||"CancelOutgoingCall",endCode:z.code,endSubCode:z.subCode,causeId:B,clientReasonSubCode:z.clientReasonSubCode,clientReasonPhrase:z.clientReasonPhrase,resultCategories:z.resultCategories};this.http.sendPostRequest({url:this.links[Ye.default.LINKS.LEAVE],requestName:Je.NETWORK_REQUESTS.CANCEL_CALL.name,payload:Se.getPayload(this,z,K),causeId:B}).then((function(F){G.disposed||(G.telemetryHelper.setTerminatingData(J),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,z),G.dispose(z,B)),W.resolve(null)})).catch((function(F){var K=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[cancelOutgoingCall][".concat(B,"] error: ").concat((0,$.getPrintableObject)(F)," xhrError: ").concat((0,$.getPrintableObject)(K))),G.disposed||(G.telemetryHelper.setTerminatingData(J),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,z),G.dispose(z,B)),W.resolve(null)}))}else this.logger.info("[".concat(B,"][cancelOutgoingCall] Conversation Service Leave Url is not yet set. Cannot leave conversation. Disposing anyways.")),z.subCode=Ye.default.CALL_END_SUB_CODE.CONV_URL_NOT_SET,this.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultDetail:z.phrase||"CancelOutgoingCall",endCode:z.code,endSubCode:z.subCode,causeId:B,clientReasonSubCode:z.clientReasonSubCode,clientReasonPhrase:z.clientReasonPhrase,resultCategories:z.resultCategories}),this.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,z),this.dispose(z,B),W.resolve(null);return W.promise},SignalingSession.prototype.terminateEstablishedCall=function(F,B){var G=this,W=B.causeId||Ze.causeId();this.logger.info("[".concat(W,"][terminateEstablishedCall]"));var z=Ze.defer();this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE;var K=this.convJoined?Je.NETWORK_REQUESTS.LEAVE_CONVERSATION.name:Je.NETWORK_REQUESTS.END_CALL.name,J=Xe.build(),Q=F&&(F.code||F.subCode)?F:{code:Ye.default.CALL_END_CODE.SUCCESS,subCode:Ye.default.CALL_END_SUB_CODE.SUCCESS,phrase:Ye.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};F&&this.setClientRejectReason(Q,F),Q.resultCategories=Q.resultCategories||[Ye.RESULT_CATEGORIES.Success];var Y={terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,endCode:Q.code,endSubCode:Q.subCode,resultDetail:Q.phrase||"TerminateEstablishedCall",causeId:W,clientReasonSubCode:Q.clientReasonSubCode,clientReasonPhrase:Q.clientReasonPhrase,resultCategories:Q.resultCategories};return this.leaveConversation(Q,B).then((function(){G.logger.info("[".concat(W,"][terminateEstablishedCall]success")),G.disposed||(G.telemetryHelper.setTerminatingData(Y),G.telemetryHelper.addNetworkOperationCompleted(K,!0,J.duration()),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,W,Q),G.dispose(Q,W)),z.resolve(null)})).catch((function(F){var B=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[".concat(W,"][terminateEstablishedCall][failed] error: ").concat((0,$.getPrintableObject)(F)," xhrError: ").concat((0,$.getPrintableObject)(B),"]")),G.disposed||(G.telemetryHelper.setTerminatingData(Y),G.telemetryHelper.addNetworkOperationCompleted(K,!1,J.duration()),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,W,Q),G.dispose(Q,W)),z.resolve(null)})),z.promise},SignalingSession.prototype.deleteConversation=function(F,B){var G=this;this.logger.info("[".concat(B,"][deleteConversation]"));var W=Ze.defer();this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE;var z=Je.NETWORK_REQUESTS.DELETE_CONVERSATION.name,K=Xe.build(),J=F&&(F.code||F.subCode)?F:{code:Ye.default.CALL_END_CODE.SUCCESS,subCode:Ye.default.CALL_END_SUB_CODE.SUCCESS,phrase:Ye.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED,causeId:B};F&&this.setClientRejectReason(J,F),J.resultCategories=J.resultCategories||[Ye.RESULT_CATEGORIES.Success];var Q={terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,endCode:J.code,endSubCode:J.subCode,resultDetail:J.phrase,causeId:B,clientReasonSubCode:J.clientReasonSubCode,clientReasonPhrase:J.clientReasonPhrase,resultCategories:J.resultCategories};return this.deleteConversationController(J,B).then((function(){G.logger.info("[".concat(B,"][deleteConversation]success")),G.disposed||(G.telemetryHelper.setTerminatingData(Q),G.telemetryHelper.addNetworkOperationCompleted(z,!0,K.duration()),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,J),G.dispose(J,B)),W.resolve(null)})).catch((function(F){var Y=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[".concat(B,"][deleteConversation][failed] error: ").concat((0,$.getPrintableObject)(F)," xhrError: ").concat((0,$.getPrintableObject)(Y))),G.disposed||(G.telemetryHelper.setTerminatingData(Q),G.telemetryHelper.addNetworkOperationCompleted(z,!1,K.duration()),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,J),G.dispose(J,B)),W.resolve(null)})),W.promise},SignalingSession.prototype.leaveConversation=function(F,B){var G=B.causeId||Ze.causeId();if(this.convJoined){this.logger.info("[".concat(G,"][leaveConversation]"));var W={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()};return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.LEAVE],requestName:Je.NETWORK_REQUESTS.LEAVE_CONVERSATION.name,payload:Ie.getPayload(this,F,W,B.scope),withoutTrouter:!0,causeId:G})}return this.logger.info("[".concat(G,"][leaveConversation] ignore, not joined to conversation")),Promise.resolve(void 0)},SignalingSession.prototype.deleteConversationController=function(F,B){return this.convJoined?(this.logger.info("[".concat(B,"][deleteConversationController]")),this.http.sendDeleteRequest({url:this.links[Ye.default.LINKS.CONVERSATION_CONTROLLER],requestName:Je.NETWORK_REQUESTS.DELETE_CONVERSATION.name,payload:Ce.getPayload(this,F),withoutTrouter:!0,causeId:B})):(this.logger.info("[".concat(B,"][deleteConversationController]ignored, not joined to conversation")),Promise.resolve(void 0))},SignalingSession.prototype.rejectIncomingCall=function(F,B){var G=this;this.telemetryHelper.recordEvent(Je.EVENTS.REJECT_INCOMING_CALL,B),this.logger.info("[".concat(B,"][rejectIncomingCall]"));var W=Ze.defer();this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE;var z=F&&(F.code||F.subCode)?F:{code:Ye.default.CALL_END_CODE.REJECT,subCode:Ye.default.CALL_END_SUB_CODE.SUCCESS,phrase:Ye.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};F&&this.setClientRejectReason(z,F),z.resultCategories=z.resultCategories||[Ye.RESULT_CATEGORIES.Success];var K={terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,endCode:z.code,endSubCode:z.subCode,resultDetail:z.phrase||"RejectCall",causeId:B,clientReasonSubCode:z.clientReasonSubCode,clientReasonPhrase:z.clientReasonPhrase,resultCategories:z.resultCategories};return this.http.sendDeleteRequest({url:this.links[Ye.default.LINKS.REJECT],requestName:Je.NETWORK_REQUESTS.REJECT_CALL.name,payload:De.getPayload(this,z),causeId:B}).then((function(F){G.disposed||(G.telemetryHelper.setTerminatingData(K),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,z),G.dispose(z,B)),W.resolve(null)})).catch((function(F){var J=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[rejectIncomingCall][".concat(B,"] error: ").concat((0,$.getPrintableObject)(F)," xhrError: ").concat((0,$.getPrintableObject)(J))),G.disposed||(G.telemetryHelper.setTerminatingData(K),G.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,B,z),G.dispose(z,B)),W.resolve(null)})),W.promise},SignalingSession.prototype.onCallStatusChanged=function(F,B,G){var W="[".concat(B,"][onCallStatusChanged]");if(this.logger.info("".concat(W).concat(this.currentCallStatus,"=>").concat(F,"]")),this.disposed)this.logger.info("".concat(W,"Call is already disposed!!"));else if(G&&this.logger.info("".concat(W,"[statusCode=").concat((0,$.getPrintableObject)(G),"]")),this.isPromotingToRealtime)F===Ye.default.CALL_STATUS.CONNECTED&&this.onPromotionCompleted(!1,void 0,B);else if(this.isValidStateTransitions(F)){this.currentCallStatus=F;var z={callStatus:F,statusCode:G,causeId:B};this.isPreheatOnly&&(z.isPreheatOnly=!0),this.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_CALL_STATUS,z),this.signalingSessionCallback.onCallStatusChanged(F,G,B),this.currentCallStatus===Ye.default.CALL_STATUS.CONNECTED&&(this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.handlePendingEndpointState(B),this.telemetryHelper.resetCallCancelationDurationWatch(),this.isPreheatOnly&&this.startCallPreheatTimer(B))}},SignalingSession.prototype.updateMeetingLiveStateAsync=function(F,B){var G=this;this.logger.info("[".concat(F,"][updateMeetingLiveStateAsync][options=").concat(JSON.stringify(B),"]")),this.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_MEETING_LIVE_STATE,{causeId:F,meetingLiveStateOptions:B}),this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION,(function(){G.handleUpdateMeetingLiveStateError({code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT},Je.EVENTS.WAITING_FOR_UPDATE_MEETING_LIVE_STATE_COMPLETION,F,F,B)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT);var z=We.getPayload(this,W(W({},B),{seqNum:this.meetingLiveStateSequenceNumber}),F);return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.UPDATE_MEETING_LIVE_STATE],requestName:Je.NETWORK_REQUESTS.UPDATE_MEETING_LIVE_STATE.name,payload:z,causeId:F}).then((function(B){G.logger.info("[".concat(F,"][updateMeetingLiveStateAsync] response: ").concat((0,$.getPrintableObject)(B))),G.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_UPDATE_MEETING_LIVE_STATE_COMPLETION,{causeId:F})})).catch((function(W){var z=Ze.getErrorForXHRFailure(W,G.signalingAgentConfig);return G.logger.info("[".concat(F,"][updateMeetingLiveStateAsync] error: ").concat((0,$.getPrintableObject)(z))),G.disposed?Promise.reject(G.getCallNotFoundTransactionEnd()):(G.handleUpdateMeetingLiveStateError(z.error,Je.EVENTS.UPDATE_MEETING_LIVE_STATE_REQUEST_FAILED,F,F,B),Promise.reject(z.error))}))},SignalingSession.prototype.handleUpdateMeetingLiveStateError=function(F,B,G,z,K){this.disposed?this.logger.info("[".concat(G,"][handleUpdateMeetingLiveStateError] ignored. Call disposed, err: ").concat(JSON.stringify(F))):(this.logger.info("[".concat(G,"][handleUpdateMeetingLiveStateError] reject reason: ").concat(F)),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION),this.telemetryHelper.recordEvent(B,W(W({},F),{updateMeetingGroupsOptions:K,causeId:G})),this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted&&this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted(F,G,z))},SignalingSession.prototype.handleUpdateMeetingLiveStateCompletion=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F),W=B.updateMeetingLiveStateResponse.result,z=B.updateMeetingLiveStateResponse.operationId;z||this.logger.warn("[".concat(G,"][handleUpdateMeetingLiveStateCompletion] operationId is undefined.")),this.logger.info("[".concat(G,"][handleUpdateMeetingLiveStateCompletion] meetingLiveUpdate completes with operationId=").concat(z)),this.handleOperationCompletionCommon(W,G,z,(0,$.getPrintableObject)(B),"handleUpdateMeetingLiveStateCompletion",Ye.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION,Je.EVENTS.UPDATE_MEETING_LIVE_STATE_RESPONSE_SUCCESS,Je.EVENTS.UPDATE_MEETING_LIVE_STATE_RESPONSE_FAILURE,this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted,this.handleUpdateMeetingLiveStateError.bind(this))},SignalingSession.prototype.setMeetingLayoutAsync=function(F,B){var G=this;this.logger.info("[".concat(F,"][setMeetingLayoutAsync][options=").concat(JSON.stringify(B),"]")),this.telemetryHelper.recordEvent(Je.EVENTS.SET_MEETING_LAYOUT,{causeId:F,setMeetingLayoutOptions:B}),this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION,(function(){G.handleSetMeetingLayoutError({code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:Ye.default.CALL_END_SUB_CODE.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT},Je.EVENTS.WAITING_FOR_SET_MEETING_LAYOUT_COMPLETION,F,F,B)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT);var z=ke.getPayload(this,W(W({},B),{sequenceNumber:this.meetingLayoutSequenceNumber}));return this.http.sendPostRequest({url:this.links[Ye.default.LINKS.SET_MEETING_LAYOUT],requestName:Je.NETWORK_REQUESTS.SET_MEETING_LAYOUT.name,payload:z,causeId:F}).then((function(B){G.logger.info("[".concat(F,"][setMeetingLayoutAsync] response: ").concat((0,$.getPrintableObject)(B))),G.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_SET_MEETING_LAYOUT_COMPLETION,{causeId:F})})).catch((function(W){var z=Ze.getErrorForXHRFailure(W);return G.logger.info("[".concat(F,"][setMeetingLayoutAsync] error: ").concat((0,$.getPrintableObject)(z))),G.disposed?Promise.reject(G.getCallNotFoundTransactionEnd()):(G.handleSetMeetingLayoutError(z.error,Je.EVENTS.SET_MEETING_LAYOUT_REQUEST_FAILED,F,F,B),Promise.reject(z.error))}))},SignalingSession.prototype.handleSetMeetingLayoutError=function(F,B,G,z,K){this.disposed?this.logger.info("[".concat(G,"][handleSetMeetingLayoutError] ignored. Call disposed, err: ").concat(JSON.stringify(F))):(this.logger.info("[".concat(G,"][handleSetMeetingLayoutError] reject reason: ").concat(F)),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION),this.telemetryHelper.recordEvent(B,W(W({},F),{updateMeetingGroupsOptions:K,causeId:G})),this.signalingSessionCallback.onSetMeetingLayoutCompleted&&this.signalingSessionCallback.onSetMeetingLayoutCompleted(F,G,z))},SignalingSession.prototype.handleSetMeetingLayoutCompletion=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F),W=B.setMeetingLayoutResponse.result,z=B.setMeetingLayoutResponse.operationId;z||this.logger.warn("[".concat(G,"][handleSetMeetingLayoutCompletion] operationId is undefined.")),this.handleOperationCompletionCommon(W,G,z,(0,$.getPrintableObject)(B),"handleSetMeetingLayoutCompletion",Ye.default.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION,Je.EVENTS.SET_MEETING_LAYOUT_RESPONSE_SUCCESS,Je.EVENTS.SET_MEETING_LAYOUT_RESPONSE_FAILURE,this.signalingSessionCallback.onSetMeetingLayoutCompleted,this.handleSetMeetingLayoutError.bind(this))},SignalingSession.prototype.handleOperationCompletionCommon=function(F,B,G,z,K,J,Q,Y,$,X){this.disposed?this.logger.info("[".concat(B,"][").concat(K,"] ignored. Call disposed.")):(this.logger.info("[".concat(B,"][").concat(K,"] body ").concat(z)),F.code===Ye.default.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(J),this.telemetryHelper.recordEvent(Q,W(W({},F),{causeId:B})),$&&$(F,B,G)):X&&X(F,Y,B,G))},SignalingSession.prototype.isValidStateTransitions=function(F){if(this.currentCallStatus===Ye.default.CALL_STATUS.LOCAL_TERMINATED&&F===Ye.default.CALL_STATUS.CONNECTING)return!0;var orderOfCallState=function(F){switch(F){case Ye.default.CALL_STATUS.IDLE:case Ye.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY:return 0;case Ye.default.CALL_STATUS.CONNECTING:return 1;case Ye.default.CALL_STATUS.RINGING:return 2;case Ye.default.CALL_STATUS.CONNECTED:return 3;case Ye.default.CALL_STATUS.LOCAL_TERMINATED:case Ye.default.CALL_STATUS.REMOTE_TERMINATED:return 4;default:return-1}};return orderOfCallState(F)>orderOfCallState(this.currentCallStatus)},SignalingSession.prototype.handlePSTNBalanceUpdate=function(F){var B=F.body.balanceUpdate,G=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(G,"][handlePSTNBalanceUpdate]")),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,F),B.updateBalance?this.signalingSessionCallback.onPSTNBalanceUpdate(B):this.logger.info(Je.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,"this was a pstn keepAlive message - ignore")},SignalingSession.prototype.handleCallAcceptanceAck=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(G,"][handleCallAcceptanceAck]")),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_CALL_ACCEPTANCE_ACK,F),this.internalHandleCallAcceptanceAck(B,G)},SignalingSession.prototype.internalHandleCallAcceptanceAck=function(F,B){var G;this.logger.info("[".concat(B,"][internalHandleCallAcceptanceAck] ").concat((0,$.getPrintableObject)(F))),this.fsmState!==Ye.default.SIGNALING_FSM_STATE.CONNECTED&&(this.links[Ye.default.LINKS.MEDIA_RENEGOTIATION]=F.callAcceptanceAcknowledgement.links.mediaRenegotiation,this.links[Ye.default.LINKS.TRANSFER]=F.callAcceptanceAcknowledgement.links.transfer,this.links[Ye.default.LINKS.REPLACE]=F.callAcceptanceAcknowledgement.links.replacement,this.links[Ye.default.LINKS.HANGUP]=F.callAcceptanceAcknowledgement.links.callLeg,this.links[Ye.default.LINKS.KEEPALIVE]=F.callAcceptanceAcknowledgement.links.callLeg,this.links[Ye.default.LINKS.PARK]=F.callAcceptanceAcknowledgement.links.hold,this.saveMediaControllerLinksIfAny(F.callAcceptanceAcknowledgement),this.scheduleKeepAlives(F.callAcceptanceAcknowledgement.callKeepAliveInterval),this.signalingSessionCallback.updateIsSharedLineAppearanceV2Activated(null===(G=F.callAcceptanceAcknowledgement.callProperties)||void 0===G?void 0:G.isSharedLineAppearanceV2Activated),this.fsmState=Ye.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(B),this.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTED,B),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info("[".concat(B,"][internalHandleCallAcceptanceAck] updating CC links as requested")),this.updateLinks(this.updateKeepAliveUrl,B)))},SignalingSession.prototype.isFatalException=function(F){var B=!0;try{JSON.parse(F.message).code===Ye.default.CALL_END_CODE.CONFLICT&&(B=!1,this.logger.info("isFatalException: received non-fatal 409 error"))}catch(F){this.logger.error("isFatalException: failed to parse error")}return B},SignalingSession.prototype.startOrJoinCall=function(F,B,G,W,z){var K=this;if(this.logger.info("[".concat(G,"]startOrJoinCall[").concat(B,"]")),this.disposed)this.logger.info("[".concat(G,"][").concat(B,"] session already disposed, ignore"));else{this.setMultiParty(1!==this.participantManager.getParticipantsToInitiateCallWith().length,G);var J=this.getConversationUrl()?this.getConversationUrl():F.conversationServiceUrl;this.telemetryHelper.setConversationServiceUrl(J),this.logger.info("options.conversationServiceUrl ".concat(F.conversationServiceUrl," conversationServiceUrl ").concat(J)),F.enableLightWeightMeeting||this.telemetryHelper.setOfferedModalities(W.blob),F.isPreheatOnly?(this.isPreheatOnly=!0,this.telemetryHelper.recordEvent(Je.EVENTS.PREHEAT_ENABLING,{causeId:G}),this.telemetryHelper.setSelfParticipantRole(Je.default.ROLE.PREHEAT),this.telemetryHelper.setIsPreheated()):this.telemetryHelper.startCallCancelationDurationWatch(),this.mediaTypesToUse=z,this.lastUsedOutgoingMediaContent=W,this.telemetryHelper.setCallerType(this.participantManager.localParticipant.id),this.logger.info("[".concat(G,"][").concat(B,"]target endpointType = ").concat(this.transferContext&&this.transferContext.target?this.transferContext.target.endpointType:"default"));var Q=F.newCall?_e.getPayload(this,W,z,F):Ee.getPayload(this,W,z,F,G);this.signalingAgentConfig.enableCallEstablishmentTimeoutsForStartJoinCall&&this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){K.handleCallEstablishmentTimeout(G)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT),this.http.sendPostRequest({url:J,requestName:B,operationType:"CallSetup",payload:Q,causeId:G}).then((function(B){K.disposed||(F.endpointState&&(K.latestEndpointState=F.endpointState),K.processConversationServiceResponseHeaders(B,G),K.processConversationServiceResponse(B.response,G),K.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTING,G),K.signalingAgentConfig.handleRosterFromCreateAndJoin&&B.response&&B.response.roster&&K.internalHandleRosterUpdate(B.response.roster,!0,G))})).catch((function(F){if(!F.stack||K.isFatalException(F)){var W=Ze.getErrorForXHRFailure(F,K.signalingAgentConfig);if(K.logger.info("[startOrJoinCall][".concat(G,"][").concat(B,"] error: ").concat((0,$.getPrintableObject)(F)," xhrError: ").concat((0,$.getPrintableObject)(W))),!K.disposed){if(K.isPromotingToRealtime)return void K.onPromotionCompleted(!0,W.error,G);K.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,K.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultValue:Je.default.RESULT_VALUE.FAILURE,endCode:W.telemetryEndSubCode,endSubCode:W.error.subCode,resultCategories:W.error.resultCategories,resultDetail:W.error.phrase||K.getTerminatingCallResultDetail(B,W.error),causeId:G}),K.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,G,W.error),K.dispose(W.error,G)}}}))}},SignalingSession.prototype.processIncomingCallPayload=function(F,B){this.remoteUser=ce.default.fromWireParticipant(F.callNotification.from),this.participantManager.setLocalParticipantId(F.callNotification.to.participantId,B),F?(F.conversationInvitation&&(this.links[Ye.default.LINKS.CONVERSATION_CONTROLLER]=F.conversationInvitation.conversationController,this.setMultiParty(F.conversationInvitation.isMultiParty,B),this.setIsHostless(!!F.conversationInvitation.isHostless,B)),F.callNotification&&(this.links[Ye.default.LINKS.ATTACH]=F.callNotification.links&&F.callNotification.links.attach,this.links[Ye.default.LINKS.REDIRECT]=F.callNotification.links&&F.callNotification.links.redirection,this.onBehalfOf=F.callNotification.onBehalfOf&&F.callNotification.onBehalfOf.id,this.callType=F.callNotification.callType,this.incomingCallCallerId=F.callNotification.from&&F.callNotification.from.id,this.callUsesMixer=!(!F.callNotification.mediaContent||!F.callNotification.mediaContent.fromMixer),this.isRedirectAllowed=!(!F.callNotification.redirectionProperties||!F.callNotification.redirectionProperties.isRedirectAllowed)),F.debugContent&&this.updateCorrelationId(F.debugContent.callId,B),F.callNotification.transferor&&(this.transferor=F.callNotification.transferor.details?F.callNotification.transferor.details.id:null),F.groupChat&&this.updateGroupChatIds(F.groupChat,B),F.meetingData&&(this.meetingData=F.meetingData),F.meetingInfo&&(this.meetingInfo=F.meetingInfo)):this.logger.info("[".concat(B,"][processIncomingCallPayload] empty incoming payload content"))},SignalingSession.prototype.processAttachResponse=function(F,B,G){this.telemetryHelper.recordEvent(Je.EVENTS.PROCESS_INITIAL_OFFER,{causeId:G}),this.links[Ye.default.LINKS.MEDIA_ANSWER]=B.response.callInvitation.links.mediaAnswer,this.links[Ye.default.LINKS.ACCEPT]=B.response.callInvitation.links.acceptance,this.links[Ye.default.LINKS.REJECT]=B.response.callInvitation.links.callLeg,this.links[Ye.default.LINKS.REDIRECT]=B.response.callInvitation.links.redirection,this.links[Ye.default.LINKS.NEW_OFFER]=B.response.callInvitation.links.newOffer,this.signalingAgentConfig.sendProgressFromCC||this.sendProgress(B),this.remoteCaller=B.response.participants.from;var W=this.getInitialMediaOfferFromIncomingCallPayload()||B.response.callInvitation.mediaContent;this.telemetryHelper.setCallerType(this.getParticipantIdForOfferAnswer(W));var z=Ze.getMediaTypes(B.response.callInvitation.callModalities);this.telemetryHelper.addIncomingModalities(z),this.telemetryHelper.setOfferedModalities(W.blob,!0),this.callUsesMixer=W.fromMixer,this.isRedirectAllowed=!(!B.response.callInvitation.redirectionProperties||!B.response.callInvitation.redirectionProperties.isRedirectAllowed),this.signalingSessionCallback.onOffer({subject:F.conversationInvitation.subject,remoteParticipantId:this.getParticipantIdForOfferAnswer(W),remoteEndpointId:B.response.participants.from.endpointId,transferor:B.response.callInvitation.transferor,clientTransferContext:F.callNotification.transferContext,mediaTypes:z,mediaContent:W,renegotiation:!1,invitationData:B.response.callInvitation.invitationData,riskLevel:B.response.callInvitation.spamProperties&&B.response.callInvitation.spamProperties.riskLevel,stirAttestation:B.response.callInvitation.spamProperties&&B.response.callInvitation.spamProperties.stirAttestation,isRedirectAllowed:this.isRedirectAllowed},G)},SignalingSession.prototype.sendProgress=function(F,B){var G=this;void 0===B&&(B=Ze.causeId()),this.logger.info("[".concat(B,"][sendProgress]")),this.telemetryHelper.recordEvent(Je.EVENTS.SEND_PROGRESS,{causeId:B}),this.http.sendPostRequest({url:F.response.callInvitation.links.progress,requestName:Je.NETWORK_REQUESTS.SEND_CALL_PROGRESS.name,payload:ve.getPayload(this),causeId:B}).catch((function(F){var z=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[".concat(B,"][sendProgress] error: ").concat((0,$.getPrintableObject)(z))),G.disposed||G.telemetryHelper.recordEvent(Je.EVENTS.SEND_PROGRESS_FAILED,W({causeId:B},z.error))}))},SignalingSession.prototype.handleCallNotification=function(F){var B=Ze.extractCauseIdFromMessage(F);if(this.logger.info("[".concat(B,"][handleCallNotification]")),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_CALL_NOTIFICATION,F),!Ze.stringEndsWith(F.url,Ye.URL_PATH.REPLACE))throw new Error("[".concat(B,"][handleCallNotification]IncomingCallNotification should not be received in handleIncomingMsg"));this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_INCOMING_CALL_REPLACEMENT,F),this.logger.info("[".concat(B,"][handleCallNotification]replacementCallNotification")),this.signalingSessionCallback&&this.signalingSessionCallback.onIncomingCallReplacement(F.body,B)},SignalingSession.prototype.handleMediaAnswer=function(F){this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_MEDIA_ANSWER,F);var B=F.body,G=Ze.extractCauseIdFromMessage(F);if(this.logger.info("[".concat(G,"][handleMediaAnswer]")),this.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())this.mediaRenegotiationManager.handleMediaAnswer(B,G);else if(this.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED);else if(this.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING){if(Ze.isDuplicateMessage(F.headers,this.provisionalMediaAnswersSeenSoFar))return void this.logger.info("[".concat(G,"][handleMediaAnswer] ignoring provisional answer retried by service"));B.mediaAnswer.sender&&(this.remoteUser=B.mediaAnswer.sender),this.resetCallEstablishmentTimeout(G),B.mediaAnswer.noRingBack||(this.telemetryHelper.setTimeToRingDuration(),this.onCallStatusChanged(Ye.default.CALL_STATUS.RINGING,G));var W=B.mediaAnswer.mediaContent;this.signalingSessionCallback.onAnswer({provisional:!0,renegotiation:!1,remoteEndpointId:B.mediaAnswer.sender?B.mediaAnswer.sender.endpointId:Ze.newGuid(),remoteParticipantId:this.getParticipantIdForOfferAnswer(W),mediaContent:W},G)}},SignalingSession.prototype._sendCallAcceptanceAcknowledgement=function(F,B){return z(this,void 0,void 0,(function(){var G=this;return K(this,(function(z){return this.http.sendPostRequest({url:F.body.callAcceptance.links.acknowledgement,requestName:Je.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,payload:fe.getPayload(this),causeId:B}).catch((function(F){var z=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);G.logger.info("[".concat(B,"][_sendCallAcceptanceAcknowledgement] error: ").concat((0,$.getPrintableObject)(z))),G.disposed||G.telemetryHelper.recordEvent(Je.EVENTS.HANDLE_CALL_ACCEPTANCE_FAILED,W({causeId:B},z.error))})),[2]}))}))},SignalingSession.prototype.handleCallAcceptance=function(F){var B=this,G=Ze.extractCauseIdFromMessage(F);this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_CALL_ACCEPTANCE,F,{enableQuickSendAcceptanceAck:this.signalingAgentConfig.enableQuickSendAcceptanceAck,causeId:G}),this.logger.info("[".concat(G,"][handleCallAcceptance]enableQuickSendAcceptanceAck:\n            ").concat(this.signalingAgentConfig.enableQuickSendAcceptanceAck)),this.signalingAgentConfig.enableQuickSendAcceptanceAck?(this._sendCallAcceptanceAcknowledgement(F,G),this._processCallAcceptance(F,G)):(this._processCallAcceptance(F,G),this.http.sendPostRequest({url:F.body.callAcceptance.links.acknowledgement,requestName:Je.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,payload:fe.getPayload(this),causeId:G}).catch((function(F){var z=Ze.getErrorForXHRFailure(F,B.signalingAgentConfig);B.logger.info("[".concat(G,"][handleCallAcceptance] error: ").concat((0,$.getPrintableObject)(z))),B.disposed||B.telemetryHelper.recordEvent(Je.EVENTS.HANDLE_CALL_ACCEPTANCE_FAILED,W({causeId:G},z.error))})))},SignalingSession.prototype.handleCallAcceptanceSync=function(F){var B=Ze.extractCauseIdFromMessage(F);this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_CALL_ACCEPTANCE_SYNC,F,{enableQuickSendAcceptanceAck:this.signalingAgentConfig.enableQuickSendAcceptanceAck,causeId:B}),this.logger.info("[".concat(B,"][handleCallAcceptanceSync] enableQuickSendAcceptanceAck:\n            ").concat(this.signalingAgentConfig.enableQuickSendAcceptanceAck)),this.signalingAgentConfig.enableQuickSendAcceptanceAck?Q.defer(this._processCallAcceptance,F,B):this._processCallAcceptance(F,B);var G=fe.getPayload(this).payload;return this.telemetryHelper.addNetworkOperationCompleted(Je.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,!0),G},SignalingSession.prototype.getFakeRoster=function(F){var B,G,W,z=this.participantManager.getParticipantsToInitiateCallWith(),K={id:W=1===z.length?z[0].id:F.callAcceptance.acceptedBy.id,displayName:F.callAcceptance.acceptedBy.id===W?F.callAcceptance.acceptedBy.displayName:"",endpointId:F.callAcceptance.acceptedBy.endpointId,participantId:F.callAcceptance.acceptedBy.participantId,languageId:F.callAcceptance.acceptedBy.languageId},J=F.callAcceptance.acceptedBy.endpointId;return{type:"MultiPartyEndpoint",participants:(B={},B[W]={acceptedBy:F.callAcceptance.acceptedBy.id,details:K,endpoints:(G={},G[J]={call:{},contentSharing:{},capabilities:F.callAcceptance.capabilities},G)},B)}},SignalingSession.prototype.processCallAcceptance=function(F,B){var G;this.logger.info("[".concat(B,"][processCallAcceptance] ").concat((0,$.getPrintableObject)(F))),this.telemetryHelper.recordEvent(Je.EVENTS.PROCESS_CALL_ACCEPTANCE,{causeId:B}),this.fsmState=Ye.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(B);var W=!1;F.callAcceptance.controllerName===Ye.default.MISC.LOBBY_CALL_CONTROLLER&&(this.logger.info("[".concat(B,"][processCallAcceptance] Controller name is lobby so putting user in lobby")),this.participantManager.localParticipant.isLobby=!0,this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId,participantId:this.participantManager.localParticipant.participantId}),W=!0,this.telemetryHelper.recordEvent(Je.EVENTS.ACCEPTANCE_USER_IN_LOBBY,{causeId:B})),this.participantManager.localParticipant.isStaging=(0,X.hasStagingGroup)(F.callAcceptance),this.signalingSessionCallback.onMeetingGroupDetailsUpdated(F.callAcceptance.meetingGroupDetails,B),this.signalingSessionCallback.updateIsSharedLineAppearanceV2Activated(null===(G=F.callAcceptance.callProperties)||void 0===G?void 0:G.isSharedLineAppearanceV2Activated),this.logger.info("[".concat(B,"][processCallAcceptance] for localParticipant, isStaging is set to ").concat(this.participantManager.localParticipant.isStaging));var z=this.mediaTypesToUse,K=Ze.newGuid();F.callAcceptance.acceptedBy&&(this.remoteUser=ce.default.fromWireParticipant(F.callAcceptance.acceptedBy),K=F.callAcceptance.acceptedBy.endpointId),F.callAcceptance.acceptedCallModalities&&F.callAcceptance.acceptedCallModalities.length>0&&(z=F.callAcceptance.acceptedCallModalities);var J=F.callAcceptance.mediaContent;this.callUsesMixer=J.fromMixer;var Q=Ze.getMediaTypes(z);this.telemetryHelper.addIncomingModalities(Q),this.telemetryHelper.setAnsweredModalities(J.blob,!0),this.links[Ye.default.LINKS.MEDIA_RENEGOTIATION]=F.callAcceptance.links.mediaRenegotiation,this.links[Ye.default.LINKS.TRANSFER]=F.callAcceptance.links.transfer,this.links[Ye.default.LINKS.REPLACE]=F.callAcceptance.links.replacement,this.links[Ye.default.LINKS.HANGUP]=F.callAcceptance.links.callLeg,this.links[Ye.default.LINKS.KEEPALIVE]=F.callAcceptance.links.callLeg,this.links[Ye.default.LINKS.PARK]=F.callAcceptance.links.hold,this.saveMediaControllerLinksIfAny(F.callAcceptance),this.scheduleKeepAlives(F.callAcceptance.callKeepAliveInterval);var Y=this.getParticipantIdForOfferAnswer(J);this.signalingSessionCallback.onAnswer({provisional:!1,renegotiation:!1,remoteEndpointId:K,remoteParticipantId:Y,callAcceptedByNGCVoicemail:Y===Ye.default.KNOWN_BOTS.VOICEMAIL_BOT_ID,mediaTypes:Q,mediaContent:J},B),this.setRealTimeState(2,B),this.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTED,B),W&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant,B),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info("[".concat(B,"][processCallAcceptance] Updating CC links as requested")),this.updateLinks(this.updateKeepAliveUrl,B))},SignalingSession.prototype.handleLwjAcceptance=function(F){var B=Ze.extractCauseIdFromMessage(F);if(this.logger.info("[".concat(B,"][handleLwjAcceptance]")),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_LWJ_ACCEPTANCE,F),this.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING){this.telemetryHelper.recordEvent(Je.EVENTS.PROCESS_LWJ_ACCEPTANCE,{causeId:B}),this.fsmState=Ye.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch();var G=!1;F.body.participantState===Ye.default.MISC.LOBBY_PARTICIPANT_STATE&&(this.logger.info("LWJ acceptance indicates user is in lobby"),this.participantManager.localParticipant.isLobby=!0,this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId,participantId:this.participantManager.localParticipant.participantId}),G=!0,this.telemetryHelper.recordEvent(Je.EVENTS.ACCEPTANCE_USER_IN_LOBBY)),this.links[Ye.default.LINKS.LMC_NOTIFICATION_LINKS]=F.body.links.notificationLinks,this.links[Ye.default.LINKS.KEEPALIVE]=F.body.links.keepalive,this.scheduleKeepAlivesForLwj(F.body.lwj.refreshInterval),this.signalingSessionCallback.onLwjUpdated(F.body.lwj,B),this.onCallStatusChanged(Ye.default.CALL_STATUS.CONNECTED,B),this.telemetryHelper.setTimeToRingDuration(),G&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant,B)}},SignalingSession.prototype.updateGroupChatIds=function(F,B){var G=this.groupId,W=this.threadId,z=this.teamsMessageId;this.groupId=F.groupId,this.threadId=F.threadId,this.teamsMessageId=F.messageId||null,this.groupId===G&&this.threadId===W&&this.teamsMessageId===z||this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,groupId:this.groupId,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo,callLimits:this.callLimits},B)},SignalingSession.prototype.handleCallEnd=function(F){var B=F.body.callEnd||F.body,G=Ze.extractCauseIdFromMessage(F);if(this.logger.info("[".concat(G,"][handleCallEnd][content=").concat((0,$.getPrintableObject)(B),"]")),this.telemetryHelper.recordEvent(Je.EVENTS.HANDLE_CALL_END,{origin:F.origin,code:B?B.code:"unknown",subCode:B?B.subCode:"unknown",resultCategories:B?B.resultCategories:[],causeId:G}),this.fsmState!==Ye.default.SIGNALING_FSM_STATE.IDLE)if(B.code===Ye.default.CALL_END_CODE.CONFLICT&&this.multiParty&&B.conversationUrl&&B.conversationUrl.Location)this.handleConversationResolutionConflict(B,G);else{this.disposing=!0,B.callControllerTransactionEnd&&(this.logger.info("handleCallEnd: using CC end details specified in CS end"),B=B.callControllerTransactionEnd),B.broadcastOperationFailure&&(this.logger.info("handleCallEnd: using broadcastOperationFailure end details specified in CS end"),B=B.broadcastOperationFailure);var W=B.code===Ye.default.CALL_END_CODE.SUCCESS||B.code===Ye.default.CALL_END_CODE.CANCEL||B.code===Ye.default.CALL_END_CODE.REJECT;this.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.REMOTE,resultDetail:B.phrase,resultValue:W?Je.default.RESULT_VALUE.SUCCESS:Je.default.RESULT_VALUE.FAILURE,endCode:B.code,endSubCode:B.subCode,resultCategories:B?B.resultCategories:[],causeId:G});var z={code:B.code,subCode:B.subCode,phrase:B.phrase,resultCategories:B.resultCategories};this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,B.acceptedElsewhereBy&&(this.acceptedElsewhereBy={id:B.acceptedElsewhereBy.id,displayName:B.acceptedElsewhereBy.displayName}),this.onCallStatusChanged(Ye.default.CALL_STATUS.REMOTE_TERMINATED,G,z),this.dispose(z,G)}else this.logger.info("[".concat(G,"][handleCallEnd] not handling incoming callEnd since fsmstate = SIGNALING_FSM_STATE.IDLE"))},SignalingSession.prototype.handleConversationResolutionConflict=function(F,B){var G;this.logger.info("[".concat(B,"][handleConversationResolutionConflict]"));var z=W(W({},F),{phrase:F.phrase||"Conflict Resolution Error"});if(this.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||this.fsmState===Ye.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY)this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,this.http.cancelRequestIfPending(Je.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY.name,B,void 0,z),this.subscribeToCall(F.conversationUrl.Location,F.correlationId,this.lastUsedJoinCallOptions?this.lastUsedJoinCallOptions.clientEndpointCapabilities:0,{meetingData:this.meetingData,meetingPreferences:this.meetingPreferences,additionalEndpointProperties:null===(G=this.lastUsedJoinCallOptions)||void 0===G?void 0:G.additionalEndpointProperties},B);else{this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT);var K={meetingData:this.meetingData,meetingPreferences:this.meetingPreferences};if(this.joinedLightWeight&&(K.isLwj=!0),this.lastUsedJoinCallOptions){var J=this.lastUsedJoinCallOptions.scenario;K.muted=this.lastUsedJoinCallOptions.muted,K.scenario="409Redirect".concat(J||""),K.isPreheatOnly=this.lastUsedJoinCallOptions.isPreheatOnly,K.clientEndpointCapabilities=this.lastUsedJoinCallOptions.clientEndpointCapabilities,K.clientEndpointDebugContent=this.lastUsedJoinCallOptions.clientEndpointDebugContent,K.additionalEndpointProperties=this.lastUsedJoinCallOptions.additionalEndpointProperties}else K.scenario="409RedirectJoin";this.setInitialTelemetry(Y.CALL_OPERATIONS.JOIN_CALL,{correlationId:F.correlationId,causeId:B,conversationServiceUrl:F.conversationUrl.Location,joinCallOptions:K,offerGenerationTime:void 0}),this.http.cancelRequestIfPending(Je.NETWORK_REQUESTS.JOIN_CONVERSATION.name,B,void 0,z),this.http.cancelRequestIfPending(Je.NETWORK_REQUESTS.START_CALL.name,B,void 0,z),this.joinGivenConversation(F.conversationUrl.Location,F.correlationId,this.lastUsedOutgoingMediaContent,this.mediaTypesToUse,void 0,K,B)}},SignalingSession.prototype.handleCallProgress=function(F){this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_CALL_PROGRESS,F);var B=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(B,"][handleCallProgress]"));var G=F.body.callProgress;this.fsmState===Ye.default.SIGNALING_FSM_STATE.OUTGOING&&(this.telemetryHelper.setTimeToRingDuration(),this.resetCallEstablishmentTimeout(B),this.onCallStatusChanged(Ye.default.CALL_STATUS.RINGING,B),"forwarded"===G.status&&this.signalingSessionCallback.onCallForwarded({destinationType:G.forwardingDestinationType||"user"},B))},SignalingSession.prototype.resetCallEstablishmentTimeout=function(F){var B=this;this.logger.info("resetCallEstablishmentTimeout"),this.timeoutManager.stopTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.timeoutManager.startTimer(Ye.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){B.handleCallEstablishmentTimeout(F)}),Ye.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT)},SignalingSession.prototype.handleMediaAcknowledgement=function(F){this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_MEDIA_ACK,F);var B=F.body,G=Ze.extractCauseIdFromMessage(F);this.currentCallStatus!==Ye.default.CALL_STATUS.CONNECTED?this.telemetryHelper.recordEvent(Je.EVENTS.HANDLE_MEDIA_PROVISIONAL_ACK,{causeId:G}):this.mediaRenegotiationManager.handleMediaAcknowledgment(B,G)},SignalingSession.prototype.handleConversationUpdate=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(G,"][handleConversationUpdate]content=").concat((0,$.getPrintableObject)(B))),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_CONVERSATION_UPDATE,F),this.processConversationServiceResponse(B,G)},SignalingSession.prototype.endBroadcastMeeting=function(F){this.logger.info("[".concat(F,"][endBroadcastMeeting]")),this.broadcastSession=null},SignalingSession.prototype.handleLocalParticipantUpdate=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(G,"][handleLocalParticipantUpdate]content=").concat((0,$.getPrintableObject)(B))),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_LOCAL_PARTICIPANT_UPDATE,F),this.processLocalParticipantUpdateResponse(B,G)},SignalingSession.prototype.handleAddModalityFailure=function(F){var B,G=F.body,W=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(W,"][handleAddModalityFailure]")),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_ADD_MODALITY_FAILURE,F),G.modalityFailure.contentSharing?null===(B=this.contentSharingManager)||void 0===B||B.handleAddModalityFailure(G,W):G.modalityFailure.groupChat?this.signalingSessionCallback.onChatModalitySetupFailed({code:G.modalityFailure.groupChat.code,subCode:G.modalityFailure.groupChat.subCode,phrase:G.modalityFailure.groupChat.phrase,resultCategories:G.modalityFailure.groupChat.resultCategories},W):G.modalityFailure.broadcast&&this.broadcastSession&&this.broadcastSession.handleAddBroadcastModalityFailure(G,W)},SignalingSession.prototype.handleAddModalitySuccess=function(F){var B,G=F.body,W=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(W,"][handleAddModalitySuccess]")),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,F),G.modalitySuccess.contentSharing?null===(B=this.contentSharingManager)||void 0===B||B.handleAddModalitySuccess(G,W):G.modalitySuccess.groupChat?this.logger.info("[".concat(W,"][handleAddModalitySuccess] group modality ").concat((0,$.getPrintableObject)(G.modalitySuccess.groupChat))):G.modalitySuccess.broadcast&&this.broadcastSession&&this.broadcastSession.handleAddBroadcastModalitySuccess(G,W)},SignalingSession.prototype.handleTransferRequested=function(F){var B=F.body.callTransfer,G=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(G,"][handleTransferRequested]")),B.parkType?(this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_PARK_REQUESTED,F,{type:B.parkType}),this.telemetryHelper.addSharedCorrelationId(B.sharedCorrelationId)):"voicemail"===B.target.endpointType?(this.logger.info("[".concat(G,"][handleTransferRequested] target endpointType = ").concat(B.target.endpointType)),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.TRANSFER_REQUEST_RECEIVED,F)):this.telemetryHelper.recordIncomingEvent(Je.EVENTS.TRANSFER_REQUEST_RECEIVED,F),this.links[Ye.default.LINKS.TRANSFER_ACCEPTANCE]=B.links.transferAcceptance,this.links[Ye.default.LINKS.TRANSFER_COMPLETION]=B.links.transferCompletion,this.signalingSessionCallback.onTransferRequested?this.signalingSessionCallback.onTransferRequested(B,G):this.logger.info("[".concat(G,"][handleTransferRequested] failed, no callback defined"))},SignalingSession.prototype.handleTransferAcceptance=function(F){var B=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(B,"][handleTransferAcceptance]")),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.WAITING_FOR_TRANSFER_COMPLETION,F),this.signalingSessionCallback.onTransferAccepted?this.signalingSessionCallback.onTransferAccepted(B):this.logger.info("[".concat(B,"][handleTransferAcceptance]failed, no callback defined"))},SignalingSession.prototype.handleTransferCompletion=function(F){var B=F.body,G=Ze.extractCauseIdFromMessage(F);this.logger.info("[".concat(G,"][handleTransferCompletion]")),B.sharedCorrelationId&&this.telemetryHelper.addSharedCorrelationId(B.sharedCorrelationId),B.unparkContent&&void 0!==B.unparkContent.pickupCode&&(B.unparkContent.pickupCode=B.unparkContent.pickupCode.toString(),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.PICKUP_CODE_SET,F)),this.signalingSessionCallback.onTransferCompleted?(F.body.transferCompletion&&(0===F.body.transferCompletion.code?this.telemetryHelper.recordIncomingEvent(Je.EVENTS.TRANSFER_COMPLETED,F):(this.logger.info("[".concat(G,"][handleTransferCompletion]-1-code: ").concat(B.transferCompletion.code,", message: ").concat((0,$.getPrintableObject)(F))),this.telemetryHelper.recordIncomingEvent(Je.EVENTS.TRANSFER_COMPLETION_FAILED,F,{code:B.transferCompletion.code,subcode:B.transferCompletion.subCode,resultCategories:B.transferCompletion.resultCategories}))),this.signalingSessionCallback.onTransferCompleted(B,G)):(F.body.transferCompletion&&(F.body.transferCompletion.code===Ye.default.CALL_END_CODE.NETWORK_ERROR?this.telemetryHelper.recordIncomingEvent(Je.EVENTS.WAITING_FOR_TRANSFER_COMPLETION_FAIL,F):this.telemetryHelper.recordIncomingEvent(Je.EVENTS.TRANSFER_COMPLETION_FAILED,F,{code:B.transferCompletion.code,subcode:B.transferCompletion.subCode,resultCategories:B.transferCompletion.resultCategories})),this.logger.info("[".concat(G,"][handleTransferCompletion]failed, no callback defined")))},SignalingSession.prototype.handleRosterUpdate=function(F,B){var G=F.body,W=Ze.extractCauseIdFromMessage(F);this.disposing||this.disposed?this.logger.info("[".concat(W,"][handleRosterUpdate]failed=ignore call ending or ended")):this.internalHandleRosterUpdate(G,B,W)},SignalingSession.prototype.handleNewMediaOffer=function(F){var B=Ze.extractCauseIdFromMessage(F);this.telemetryHelper.recordIncomingEvent(Je.EVENTS.HANDLE_NEW_OFFER,F);var G=F.body.mediaOfferReady.mediaContent;this.callUsesMixer=G.fromMixer,this.signalingSessionCallback.onNewOffer({mediaContent:G,renegotiation:!1},B)},SignalingSession.prototype.internalHandleRosterUpdate=function(F,B,G){var W;if(F&&"Delta"!==F.type&&"MultiPartyEndpoint"!==F.type)this.logger.warn("[".concat(G,"][internalHandleRosterUpdate] roster.type=").concat(F.type," is invalid"));else{this.logger.info("[".concat(G,"][internalHandleRosterUpdate]"));try{this.participantManager.handleRosterUpdate(F,B,G),null===(W=this.contentSharingManager)||void 0===W||W.handleIncomingContentSharingFromRoster(F,B,G)}catch(B){var z={code:Ye.default.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:Ye.default.CALL_END_SUB_CODE.ROSTER_HANDLING_INVALID_SERVICE_RESPONSE,phrase:B&&B.toString()};throw this.logger.info("[".concat(G,"][internalHandleRosterUpdate] ").concat((0,$.safeJsonStringify)(z))),this.telemetryHelper.recordRosterEvent(F,Je.EVENTS.HANDLE_ROSTER_UPDATE_FAIL,G),z}}},SignalingSession.prototype.scheduleKeepAlives=function(F){var B=.9*F*1e3;this.logger.info("scheduleKeepAlives: every ".concat(B," milliseconds")),this.keepAliveInterval=B,this.keepAliveTimer=window.setInterval(this.sendKeepAlive.bind(this),this.keepAliveInterval)},SignalingSession.prototype.scheduleKeepAlivesForLwj=function(F){var B=.9*F*1e3;this.logger.info("scheduleKeepAlivesForLwj: every ".concat(B," milliseconds")),this.keepAliveIntervalLwj=B,this.keepAliveTimerLwj=window.setInterval(this.sendKeepAliveForLwj.bind(this),this.keepAliveIntervalLwj)},SignalingSession.prototype.scheduleConversationKeepAlive=function(){if(!this.conversationKeepAliveTimer&&!this.disposed){if(!this.conversationKeepAliveInterval){var F=this.signalingAgentConfig.csaTimeoutConfiguration.conversationKeepAliveTimeoutSec,B=(0,te.getRandomizedTimeout)(1e3*F);this.logger.info("sendConversationKeepAlive: every ".concat(B," milliseconds")),this.conversationKeepAliveInterval=B}this.conversationKeepAliveTimer=window.setInterval(this.sendConversationKeepAlive.bind(this),this.conversationKeepAliveInterval)}},SignalingSession.prototype.sendConversationKeepAlive=function(){this.logger.info("sendConversationKeepAlive"),this.disposed?this.logger.info("sendConversationKeepAlive ignored"):(this.logger.info("sendConversationKeepAlive keepAlive count = ".concat(this.conversationKeepAliveCount++)),this.sendToUpdateConversationLinks(!0))},SignalingSession.prototype.sendKeepAlive=function(){this.logger.info("sendKeepAlive"),this.disposed?this.logger.info("sendKeepAlive ignored"):(this.logger.info("sendKeepAlive keepAlive count = ".concat(this.keepAliveCount++)),this.sendToKeepAliveUrl(null))},SignalingSession.prototype.sendKeepAliveForLwj=function(){this.disposed?this.logger.info("sendKeepAliveForLwj ignored"):(this.logger.info("sendKeepAliveForLwj keepAlive count = ".concat(this.keepAliveCountLwj++)),this.sendToKeepAliveUrlForLwj(null))},SignalingSession.prototype.sendToUpdateConversationLinks=function(F,B){var G=this;if(void 0===B&&(B=Ze.causeId()),!this.disposed){var z=this.logger.createChild("[".concat(B,"][sendToUpdateConversationLinks]"),this.correlationId),K=F?ze.getPayload(this):{},J=F?Je.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS.name:Je.NETWORK_REQUESTS.SEND_CONVERSATION_KEEP_ALIVE.name,Q=this.links[Ye.default.LINKS.NOTIFICATION_LINKS];z.info("shouldUpdateUrl: ".concat(F,", url: ").concat(Q,", payload: ").concat((0,$.getPrintableObject)(K))),Q&&(this.conversationKeepAliveTimer&&(window.clearInterval(this.conversationKeepAliveTimer),this.conversationKeepAliveTimer=0),this.http.sendPostRequest({url:Q,payload:K,withoutTrouter:!0,requestName:J,causeId:B}).then((function(F){G.disposed||(G.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_CONVERSATION_LINKS_SUCCESS,{causeId:B}),G.processConversationServiceResponse(F.response,B))})).catch((function(F){var z=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig),K=Ze.isRetryable(z.error.code);G.logger.info("[".concat(B,"][updateConversationLinks] error: ").concat((0,$.getPrintableObject)(z),", retryable: ").concat(K)),G.disposed||(G.telemetryHelper.recordEvent(Je.EVENTS.UPDATE_CONVERSATION_LINKS_FAILED,W({causeId:B},z.error)),K?G.scheduleConversationKeepAlive():G.links[Ye.default.LINKS.NOTIFICATION_LINKS]=null)})))}},SignalingSession.prototype.sendToKeepAliveUrl=function(F,B){var G=this;void 0===B&&(B=Ze.causeId());var W=this.logger.createChild("[".concat(B,"][sendToKeepAliveUrl]"),this.correlationId);W.info("payload: ".concat((0,$.getPrintableObject)(F))),window.clearInterval(this.keepAliveTimer),this.disposed||(this.telemetryHelper.recordEvent(Je.EVENTS.SEND_KEEP_ALIVE),this.http.sendPostRequest({url:this.links[Ye.default.LINKS.KEEPALIVE],payload:F,requestName:Je.NETWORK_REQUESTS.SEND_KEEP_ALIVE.name,withoutTrouter:!0,causeId:B}).then((function(){G.restartKeepAliveInterval()})).catch((function(F){var B=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);W.info("error: ".concat((0,$.getPrintableObject)(B))),G.restartKeepAliveInterval(!0,B.error)})))},SignalingSession.prototype.sendToKeepAliveUrlForLwj=function(F,B){var G=this;void 0===B&&(B=Ze.causeId());var W=this.logger.createChild("[".concat(B,"][sendToKeepAliveUrlForLwj]"),this.correlationId);W.info("payload: ".concat((0,$.getPrintableObject)(F))),window.clearInterval(this.keepAliveTimerLwj),this.disposed||(this.telemetryHelper.recordEvent(Je.EVENTS.SEND_KEEP_ALIVE_LWJ),this.http.sendPostRequest({url:this.links[Ye.default.LINKS.KEEPALIVE],payload:F,requestName:Je.NETWORK_REQUESTS.SEND_KEEP_ALIVE_LWJ.name,withoutTrouter:!0,causeId:B}).then((function(){G.restartKeepAliveIntervalForLwj()})).catch((function(F){var z=Ze.getErrorForXHRFailure(F,G.signalingAgentConfig);W.info("error: ".concat((0,$.getPrintableObject)(z))),z.error&&z.error.code===Ye.default.CALL_END_CODE.NOT_FOUND?(W.info("disposing lwj call because of code: ".concat(z.error.code)),G.dispose(z.error,B)):G.restartKeepAliveIntervalForLwj(!0,z.error)})))},SignalingSession.prototype.handleCallEstablishmentTimeout=function(F,B,G){var W={code:Ye.default.CALL_END_CODE.TIMEOUT,subCode:B||Ye.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:G||Ye.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT,resultCategories:[Ye.RESULT_CATEGORIES.UnexpectedClientError]};this.isPromotingToRealtime?this.onPromotionCompleted(!0,W,F):(this.telemetryHelper.recordEvent(Je.EVENTS.HANDLE_CALL_ESTABLISHMENT_TIMEOUT),this.telemetryHelper.setTerminatingData({terminatingEnd:Je.default.CALL_TERMINATING_END.LOCAL,resultValue:Je.default.RESULT_VALUE.FAILURE,resultDetail:W.phrase,endCode:W.code,endSubCode:W.subCode,causeId:F,resultCategories:W.resultCategories}),this.fsmState=Ye.default.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(Ye.default.CALL_STATUS.LOCAL_TERMINATED,F,W),this.dispose(W,F))},SignalingSession.prototype.handleCallTransferTimeout=function(F,B){if(this.disposed)this.logger.info("Transfer: handleCallTransferTimeout ignored");else{var G={code:Ye.default.CALL_END_CODE.TIMEOUT,phrase:Ye.default.CALL_END_PHRASE.TRANSFER_COMPLETION_TIMEOUT};this.signalingSessionCallback.onTransferCompleted&&(!1===B?this.telemetryHelper.recordEvent(Je.EVENTS.TRANSFER_COMPLETION_FAILED,{code:Ye.default.CALL_END_CODE.TIMEOUT,subcode:Ye.default.CALL_END_SUB_CODE.TRANSFER_COMPLETE_TIMEOUT,causeId:F}):!0===B&&this.telemetryHelper.recordEvent(Je.EVENTS.WAITING_FOR_TRANSFER_ACCEPTANCE_FAIL,{causeId:F}),this.signalingSessionCallback.onTransferCompleted({transferCompletion:G},F))}},SignalingSession.prototype.checkCorrelationIdChange=function(F,B){if(F&&F.headers&&F.headers[Ye.default.HEADERS.CORRELATION_ID]&&F.headers[Ye.default.HEADERS.CORRELATION_ID].length){var G=[Ye.URL_PATH.CONV_CONTENT_SHARING_UPDATE,Ye.URL_PATH.CONV_CONTENT_SHARING_END].some((function(B){return F.url&&Ze.stringEndsWith(F.url,B)})),W=F.headers[Ye.default.HEADERS.CORRELATION_ID];this.correlationId===W||G||(this.logger.info("[".concat(B,"]checkCorrelationIdChange:").concat(this.correlationId," => ").concat(W)),this.telemetryHelper.addChangingCorrelationId(this.correlationId,W),this.updateCorrelationId(W,B))}},SignalingSession.prototype.getCommandUrlPresence=function(){var F=$e.CommandUrlPresence.None;return this.links[Ye.default.LINKS.MUTE]&&(F|=$e.CommandUrlPresence.Mute),this.links[Ye.default.LINKS.UNMUTE]&&(F|=$e.CommandUrlPresence.Unmute),F},SignalingSession.prototype.getCallNotFoundTransactionEnd=function(){return{code:Ye.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,subCode:0,phrase:Ye.default.CALL_END_PHRASE.CALL_DOES_NOT_EXIST}},SignalingSession.prototype.getTerminatingCallResultDetail=function(F,B){var G=W({source:F},B);return(0,$.getPrintableObject)(G)},SignalingSession.prototype.dispose=function(F,B){var G=this;this.disposed||(this.logger.info("[".concat(B,"][dispose] end reason ").concat((0,$.getPrintableObject)(F))),this.disposed=!0,this.disposing=!1,this.tearDownConnectionCheck(),this.conversationKeepAliveTimer&&(window.clearInterval(this.conversationKeepAliveTimer),this.conversationKeepAliveTimer=0),this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.keepAliveTimerLwj&&window.clearInterval(this.keepAliveTimerLwj),this.brokerService&&this.brokerService.dispose(),this.http.cancelAllRequests(B).then((function(){var W,z;G.signalingAgent.onCallCompleted(G.sessionId,B),G.signalingAgentConfig.trouterUrlGetter&&G.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed.off(G.onTrouterUrlChanged),G.signalingAgentConfig.trouterServiceProvider&&G.signalingAgentConfig.trouterServiceProvider.offStateChanged(G.onTrouterStateChanged),G.timeoutManager.dispose(),G.timeoutManager=null,G.participantManager.dispose(F,B),G.callOperationHandler.dispose("call ended",F,B),G.participantManager=null,null===(W=G.mediaRenegotiationManager)||void 0===W||W.dispose(),G.mediaRenegotiationManager=null,null===(z=G.contentSharingManager)||void 0===z||z.dispose(F,B),G.contentSharingManager=null,G.telemetryHelper.dispose(),G.telemetryHelper=null,G.webRtcSignalingManager.dispose(),G.webRtcSignalingManager=null})))},SignalingSession}();function build(F,B,G,W,z,K){return new tt(F,B,G,W,z,K)}B.SignalingSession=tt,B.build=build},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function TimeoutManager(F){var B=this;this.timers={},this.startTimer=function(F,G,W,z){B.logger.info("startTimer called for :  ".concat(F));var K=window.setTimeout(G,1e3*W),J=z?"".concat(F).concat(z):F;B.timers[J]=K},this.stopTimer=function(F,G){B.logger.info("stopTimer called for : ".concat(F));var W=G?"".concat(F).concat(G):F;B.timers.hasOwnProperty(W)&&(clearTimeout(B.timers[W]),delete B.timers[W])},this.dispose=function(){B.logger.info("timeoutManager :: dispose"),Object.keys(B.timers).forEach((function(F){B.stopTimer(F)}))},this.logger=F}return TimeoutManager}();B.default=W},function(F,B,G){function processTransactionResponse(F){var B={};if(F.stateId)B.result=F.stateId;else if(F.results){var G=F.results;1===G.length&&G[0].stateId&&(B.result=G[0].stateId);var W={};F.results.forEach((function(F){var G=F.result,z=getParticipantId(F);(void 0===B.code||G.code>B.code)&&(B.code=G.code,B.subCode=G.subCode),W[z]=F})),B.result=JSON.stringify(W)}else F.result&&(B={code:F.result.code,phrase:F.result.phrase,subCode:F.result.subCode,resultCategories:F.result.resultCategories},F.additionalDetail&&(B.result=F.additionalDetail));return B}function getParticipantId(F){return F.participantId||F.participant&&F.participant.id}Object.defineProperty(B,"__esModule",{value:!0}),B.processTransactionResponse=void 0,B.processTransactionResponse=processTransactionResponse},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0});var z=G(25),K=G(5),J=G(9),Q=G(3),Y=function(){function BroadcastSession(F,B){var G=this;this.broadcastContext=null,this.broadcastControllerUrl="",this.broadcastCallbackUrl="",this.broadcastState=null,this.setContext=function(F){void 0===F&&(F=null),G.logger.info("BroadcastSession :: set broadcast context",F),G.broadcastContext=F},this.getContext=function(){return G.logger.info("BroadcastSession :: get broadcast context",G.broadcastContext||null),G.broadcastContext||null},this.signalingSession=F,this.signalingSessionCallback=B,this.logger=F.logger.createChild((function(){return"[Broadcast]"}))}return BroadcastSession.prototype.handleBroadcastStateChanged=function(F){var B=F.body;this.broadcastState=B;var G=(0,Q.extractCauseIdFromMessage)(F);this.signalingSession.telemetryHelper.recordIncomingEvent(z.EVENTS.BROADCAST_STATE_CHANGED,F),this.logger.info("[".concat(G,"] broadcast state changed=").concat(this.broadcastState)),this.updateBroadcastMetadata(G)},BroadcastSession.prototype.updateBroadcastCallbackUrl=function(F){var B=J.get(this.signalingSession,K.URL_PATH.CONV_BROADCAST_UPDATE);this.broadcastCallbackUrl!==B&&(this.broadcastCallbackUrl=B,this.logger.info("[".concat(F,"] broadcast callback url changed=").concat(this.broadcastCallbackUrl)),this.updateBroadcastMetadata(F))},BroadcastSession.prototype.handleBroadcastDetailsChanged=function(F,B){this.signalingSession.telemetryHelper.recordEvent(z.EVENTS.UPDATE_BROADCAST_DETAILS,{causeId:B}),F.activeModalities&&F.activeModalities.broadcast&&F.activeModalities.broadcast.controller!==this.broadcastControllerUrl&&(this.broadcastControllerUrl=F.activeModalities.broadcast.controller,this.broadcastAdditionalData=F.activeModalities.broadcast,this.logger.info("[".concat(B,"] broadcast controller changed=").concat(this.broadcastControllerUrl)),this.signalingSessionCallback.onBroadcastMeetingConnected(K.default.SUCCESS_TRANSACTION_END,B),this.updateBroadcastMetadata(B)),!this.broadcastControllerUrl||F.activeModalities&&F.activeModalities.broadcast||(this.broadcastControllerUrl="",this.broadcastContext=null,this.logger.info("[".concat(B,"] broadcast controller changed=").concat(this.broadcastControllerUrl)),this.updateBroadcastMetadata(B),this.signalingSessionCallback.onBroadcastMeetingEnded(K.default.SUCCESS_TRANSACTION_END,B))},BroadcastSession.prototype.handleAddBroadcastModalitySuccess=function(F,B){this.logger.info("[".concat(B,"][handleAddBroadcastModalitySuccess]"))},BroadcastSession.prototype.handleAddBroadcastModalityFailure=function(F,B){this.logger.info("[".concat(B,"][handleAddBroadcastModalityFailure]"));var G=W({},F.modalityFailure.broadcast);this.signalingSessionCallback.onBroadcastMeetingEnded(G,B)},BroadcastSession.prototype.updateBroadcastMetadata=function(F){var B={broadcastControllerUrl:this.broadcastControllerUrl,broadcastStateCallbackUrl:this.broadcastCallbackUrl,broadcastState:this.broadcastState,broadcastAdditionalData:this.broadcastAdditionalData};this.logger.info("[".concat(F,"] update broadcast metadata=").concat(B)),this.signalingSessionCallback.onBroadcastMeetingUpdated&&this.signalingSessionCallback.onBroadcastMeetingUpdated(B,F)},BroadcastSession}();B.default=Y},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.TIMERS=void 0;var W,z=G(14),K=G(25),J=G(107),Q=G(5),Y=G(3),$="http://broker.invalid/",X=30,Z=5,ee=1;!function(F){F.RETRY="RETRY",F.TIMEOUT="TIMEOUT"}(W=B.TIMERS||(B.TIMERS={}));var te=function(){function BrokerService(F){var B,G=this;this._signalingSession=F,this.baseUrl=$,this._currentSubscriptionTimeoutInSec=X,this._subscribers=[],this._disposed=!1,this._reportedResultCount=0,this._subscriptionRetryBackoffInSec=Z,this._notifySubscribers=function(F){G._logger.info("_notifySubscribers"),Promise.resolve().then((function(){F.split(",").forEach((function(F){var B=Y.decodeMessage(F),W=Y.parseRawHttpMessage(B),z=W.body;Y.isEncodedMessage(W.headers)&&Y.isMessageEncodingSupported(W.headers)&&(z=Y.decodeMessage(z));var K={url:W.url,body:JSON.parse(z),headers:W.headers};G._logger.info("message length=",z.length,"n. of subscribers",G._subscribers.length),G._subscribers.forEach((function(F){return F(K)}))}))})).catch((function(F){G._logger.error("_notifySubscribers, failed to decode message",F),G._signalingSession.telemetryHelper.recordEvent(K.EVENTS.BROKER_DECODE_PAYLOAD_FAILURE)}))},this._subscribeToBroker=function(F,B){if(G._disposed)G._logger.warn("_subscribeToBroker, disposed, ignore subscription");else{var W=Y.causeId();G._logger.info("_subscribeToBroker, url: ",F,",timeout in sec",B),G._currentSubscriptionUrl=F,G._currentSubscriptionTimeoutInSec=B,G._clearAllPendingTimeouts(),G._setSubscriptionTimeout(B),G._signalingSession.http.sendGetRequest({url:G._currentSubscriptionUrl,requestName:K.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name,customHeaders:G._getBrokerRequestHeaders(W),payload:null,skipHttpTelemetry:!G._reportSubscriptionInTelemetry(),causeId:Y.causeId(),operationType:"BrokerSubscribe"}).then(G._handleSubscriptionSuccess).catch(G._handleSubscriptionFailure)}},this._clearAllPendingTimeouts=function(){G._cancelRequestTimer&&(G._cancelRequestTimer.stop(),G._cancelRequestTimer=null),G._retryRequestTimer&&(G._retryRequestTimer.stop(),G._retryRequestTimer=null)},this._abortPendingRequest=function(){G._signalingSession.http.cancelRequestIfPending(K.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name,Y.causeId())},this._setSubscriptionTimeout=function(F){G._cancelRequestTimer=J.TimerFactory.build((function(){G._disposed||(G._signalingSession.http.hasPendingRequest(K.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name)?(G._logger.warn("timeout subscription"),G._signalingSession.telemetryHelper.recordEvent(K.EVENTS.BROKER_SUBSCRIPTION_TIMEOUT),G._signalingSession.http.cancelRequestIfPending(K.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name,Y.causeId())):G._logger.error("Unable to resolve timeout deferred, it is not defined!"))}),W.TIMEOUT).start(1e3*F)},this._handleSubscriptionSuccess=function(F){if(G._disposed)G._logger.warn("_handleSubscriptionSuccess, disposed, ignore subscription success");else if(G._reportSubscriptionInTelemetry(F)&&G._signalingSession.telemetryHelper.recordEvent(K.EVENTS.BROKER_SUBSCRIPTION_SUCCESSFUL),F&&F.response){var B=F.response;G._logger.info("_handleSubscriptionSuccess, response",B),B.message&&G._notifySubscribers(B.message);var W=B.nextSubscribeUrl||G._currentSubscriptionUrl,z=B.expirationTimeInSec||G._currentSubscriptionTimeoutInSec;G._subscribeToBroker(W,z)}else G._logger.info("_handleSubscriptionSuccess, empty response")},this._handleSubscriptionFailure=function(F){if(G._disposed)G._logger.warn("_handleSubscriptionFailure, disposed, ignore subscription");else if(F.status>=400&&F.status<500&&401!==F.status&&G.isNotNetworkErrors(F.status))G._logger.warn("_handleSubscriptionFailure, received status ".concat(F.status,", stop subscribing"));else{var B=(0,z.getPrintableObject)(F);G._logger.error("_handleSubscriptionFailure failed, re-subscribing",B),G._reportSubscriptionInTelemetry()&&G._signalingSession.telemetryHelper.recordEvent(K.EVENTS.BROKER_SUBSCRIPTION_FAILED),G._retryRequestTimer=J.TimerFactory.build((function(){G._subscribeToBroker(G._currentSubscriptionUrl,G._currentSubscriptionTimeoutInSec)}),W.RETRY).start(1e3*G._subscriptionRetryBackoffInSec)}},this._reportSubscriptionInTelemetry=function(F){return G._reportedResultCount++,G._reportedResultCount<=ee},this._getBrokerRequestHeaders=function(F){var B={};return B[Q.default.HEADERS.CONTENT_TYPE]=Q.default.CONTENT_TYPE.JSON,G._signalingSession.signalingAgentConfig.brokerRequestBatching&&(B[Q.default.HEADERS.BROKER_USE_BATCHING_HEADER_NAME]="1"),B},this._logger=this._signalingSession.logger.createChild("Broker"),(null===(B=this._signalingSession.signalingAgentConfig.csaTimeoutConfiguration)||void 0===B?void 0:B.brokerRetryBackOffInSec)&&(this._subscriptionRetryBackoffInSec=this._signalingSession.signalingAgentConfig.csaTimeoutConfiguration.brokerRetryBackOffInSec)}return BrokerService.prototype.subscribeToBroker=function(F){this._abortPendingRequest(),this._clearAllPendingTimeouts(),this._subscribeToBroker(F,this._currentSubscriptionTimeoutInSec)},BrokerService.prototype.onBrokerMessage=function(F){this._logger.info("onBrokerMessage callback added"),this._subscribers.push(F)},BrokerService.prototype.dispose=function(){this._disposed=!0,this._logger.info("dispose"),this._subscribers=[],this._clearAllPendingTimeouts(),this._abortPendingRequest()},BrokerService.prototype.isNotNetworkErrors=function(F){return 490!==F&&496!==F&&498!==F&&499!==F},BrokerService}();B.default=te},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(17),z=G(5),K=function(){function CallOperations(F){this.requests={},this.logger=F}return CallOperations.prototype.clear=function(F,B){var G=this,W=B||{code:z.default.CALL_END_CODE.SUCCESS,subCode:z.default.CALL_END_SUB_CODE.SUCCESS,phrase:z.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach((function(B){try{var z=parseInt(B,10);Object.keys(G.requests[z]).forEach((function(B){G.rejectOperation(z,B,F,W)}))}catch(F){G.logger.warn("CallOperations: clear error = ".concat(F))}}))},CallOperations.prototype.hasOperation=function(F,B){return this.requests.hasOwnProperty(F.valueOf())&&this.requests[F.valueOf()].hasOwnProperty(B)},CallOperations.prototype.getAllOperations=function(){return this.requests},CallOperations.prototype.getOperation=function(F,B){return this.hasOperation(F,B)?this.requests[F.valueOf()][B]:null},CallOperations.prototype.setOperation=function(F,B,G){return!this.hasOperation(F,B)&&(this.hasOwnProperty(F.valueOf())||(this.requests[F.valueOf()]={}),this.requests[F.valueOf()][B]=G,!0)},CallOperations.prototype.rejectOperation=function(F,B,G,W){if(this.hasOperation(F,B)){var z=F.valueOf(),K=this.requests[z][B].promise;delete this.requests[z][B],K.reject(W)}},CallOperations.prototype.resolveOperation=function(F,B,G,W){if(this.hasOperation(F,B)){var z=F.valueOf(),K=this.requests[z][B].promise;delete this.requests[z][B],K.resolve(G)}},CallOperations}(),J=function(){function CallOperationHandler(F){this.logger=F,this.localRequests=new K(F)}return CallOperationHandler.prototype.dispose=function(F,B,G){this.logger.info("[".concat(G,"][dispose]")),this.rejectAllPendingOperations(F,B)},CallOperationHandler.prototype.hasPendingOperation=function(F,B,G){return this.logger.info("[".concat(G,"][hasPendingOperation] ").concat(F," ").concat((0,W.scrubMriOrOmit)(B),"}")),this.localRequests.hasOperation(F,B)},CallOperationHandler.prototype.rejectPendingOperation=function(F,B,G,W,z){this.logger.info("[".concat(z,"][rejectPendingOperation] ").concat(F," ").concat(B," reason: ").concat(G," endCode: ").concat(W)),this.localRequests.rejectOperation(F,B,G,W)},CallOperationHandler.prototype.resolvePendingOperation=function(F,B,G,z){this.logger.info("[".concat(z,"][resolvePendingOperation]: ").concat((0,W.scrubMriOrOmit)(B))),this.localRequests.resolveOperation(F,B,G,z)},CallOperationHandler.prototype.setPendingOperation=function(F,B,G,W){return this.logger.info("[".concat(W,"][setPendingOperation] ").concat(F," value: ").concat(G)),this.localRequests.setOperation(F,B,G)},CallOperationHandler.prototype.rejectAllPendingOperations=function(F,B){this.logger.info("rejectLocalQueuedOperations"),this.localRequests.clear(F,B)},CallOperationHandler}();B.default=J},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var K=G(14),J=G(218),Q=G(5),Y=G(3),$=function(){function ContentSharingManager(F,B){var G=this;this.contentSharingToStartCallWith=null,this.contentSharingSessions={},this.DEFAULT_STOP_REASON={code:Q.default.CALL_END_CODE.SUCCESS,subCode:Q.default.CALL_END_SUB_CODE.SUCCESS,phrase:Q.default.CALL_END_PHRASE.REMOTE_USER_INITIATED},this.DEFAULT_STOP_ID="8:unknown",this.deleteContentSharingAsync=function(F,B){G.logger.info("[".concat(B,"][deleteContentSharingAsync]"));var W=Y.defer(),z=G.contentSharingSessions[F];if(G.pendingSessionToStart&&G.pendingSessionToStart.correlationId===F&&(z=G.pendingSessionToStart),z){var always=function(){G.contentSharingSessions[F]&&delete G.contentSharingSessions[F]};z.delete(W,B).then(always,always)}else G.rejectBecauseOfMissingSession(F,W);return W.promise},this.signalingSession=F,this.signalingSessionCallback=B,this.logger=F.logger.createChild((function(){return"[ContentSharingManager]"})),this.lastProcessedSequenceNumber=-1,this.lastProcessedSequenceNumberForParticipant={}}return ContentSharingManager.prototype.startContentSharingAsync=function(F,B,G,W,z,K,$){var X=this;if(this.logger.info("startContentSharingAsync called for: ".concat(F)),this.pendingSessionToStart){var Z="There is already a ContentSharing session start pending";return this.logger.error(Z),Promise.reject(new Error(Z))}var ee={contentIdentifier:F,subject:G||null,sessionState:B||null,sequenceNumber:1},te=Y.defer(),ne=new J.ContentSharingSession(this.signalingSession,$||Y.newGuid());return this.pendingSessionToStart=ne,z?(this.logger.info("Call connected, send content sharing request out immediately"),ne.start(W,ee,te,K)):(this.logger.info("Content sharing is to be started when startOutgoingCall is called"),ne.addSessionPromise=te,ne.fsmState=Q.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED,this.contentSharingToStartCallWith=ee),te.promise.then((function(){X.contentSharingSessions.hasOwnProperty(ne.correlationId)||(X.contentSharingSessions[ne.correlationId]=ne),X.pendingSessionToStart=null})).catch((function(){X.pendingSessionToStart=null})),te.promise},ContentSharingManager.prototype.joinContentSharingAsync=function(F,B){this.logger.info("[".concat(B,"][joinContentSharingAsync]"));var G=Y.defer(),W=this.contentSharingSessions[F];return W?W.join(G,B):this.rejectBecauseOfMissingSession(F,G),G.promise},ContentSharingManager.prototype.updateContentSharingSessionStateAsync=function(F,B,G){this.logger.info("[".concat(G,"][updateContentSharingSessionStateAsync][sessionState=").concat(JSON.stringify(B),"]"));var W=Y.defer(),z=this.contentSharingSessions[F];return z?z.updateSessionState(B,W,G):this.rejectBecauseOfMissingSession(F,W),W.promise},ContentSharingManager.prototype.takeContentSharingControlAsync=function(F,B){this.logger.info("[".concat(B,"][takeContentSharingControlAsync]"));var G=Y.defer(),W=this.contentSharingSessions[F];return W?W.takeControl(G,B):this.rejectBecauseOfMissingSession(F,G),G.promise},ContentSharingManager.prototype.updateContentSharingParticipantStateAsync=function(F,B){this.logger.info("[".concat(B,"][updateContentSharingParticipantStateAsync]"));var G=Y.defer(),W=this.contentSharingSessions[F];return W?W.updateParticipantState(G,B):this.rejectBecauseOfMissingSession(F,G),G.promise},ContentSharingManager.prototype.updateContentSharingNotificationLinksAsync=function(F){var B,G;this.logger.info("[".concat(F,"][updateContentSharingNotificationLinksAsync]"));try{for(var W=z(Object.keys(this.contentSharingSessions)),K=W.next();!K.done;K=W.next()){var J=K.value;if(this.contentSharingSessions.hasOwnProperty(J)){var Q=this.contentSharingSessions[J];Q&&Q.updateNotificationLinks(F)}}}catch(F){B={error:F}}finally{try{K&&!K.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}},ContentSharingManager.prototype.getContentSharingInfoToStartSharing=function(){if(this.contentSharingToStartCallWith){var F=this.pendingSessionToStart,B=Q.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED;F&&F.fsmState===B||(this.contentSharingToStartCallWith=null,this.pendingSessionToStart=null)}return this.contentSharingToStartCallWith},ContentSharingManager.prototype.dispose=function(F,B){var G,W;this.logger.info("[".concat(B,"][dispose]"));try{for(var K=z(Object.keys(this.contentSharingSessions)),J=K.next();!J.done;J=K.next()){var Q=J.value;if(this.contentSharingSessions.hasOwnProperty(Q)){var Y=this.contentSharingSessions[Q];Y&&Y.dispose(F,B)}}}catch(F){G={error:F}}finally{try{J&&!J.done&&(W=K.return)&&W.call(K)}finally{if(G)throw G.error}}},ContentSharingManager.prototype.handleContentSharingUpdate=function(F){var B=F.body,G=Y.extractCauseIdFromMessage(F),W=this.contentSharingSessions[B.contentSharingCorrelationId];W?W.handleUpdate(B,G)&&this.signalingSessionCallback.onContentSharingUpdated({sessionId:B.sessionId,correlationId:B.contentSharingCorrelationId,contentIdentifier:B.identifier,presenter:B.presenter.id,subject:B.subject||null,sessionState:B.sessionState||null},G):this.logger.info("[".concat(G,"][handleContentSharingUpdate][failed][reason=no session with correlation ID ").concat(B.correlationId,"]"))},ContentSharingManager.prototype.handleAddModalitySuccess=function(F,B){this.logger.info("[".concat(B,"][handleAddModalitySuccess]"));var G=this.pendingSessionToStart;G?G.handleAddModalitySuccess(F,B):this.logger.info("[".concat(B,"][handleAddModalitySuccess]Ignoring handleAddModalitySuccess because not waiting for one"))},ContentSharingManager.prototype.handleAddModalityFailure=function(F,B){this.logger.info("[".concat(B,"][handleAddModalityFailure]"));var G=this.pendingSessionToStart;G?G.handleAddModalityFailure(F,B):this.logger.info("[".concat(B,"][handleAddModalityFailure]Ignoring handleAddModalityFailure because not waiting for one"))},ContentSharingManager.prototype.handleIncomingContentSharingFromRoster=function(F,B,G){if(this.logger.info("[".concat(G,"] handleIncomingContentSharingFromRoster: isFullRoster ").concat(B," content ").concat((0,K.getPrintableObject)(F))),("MultiPartyEndpoint"===F.type||B)&&this.lastProcessedSequenceNumber>F.sequenceNumber)this.logger.info("[".concat(G,"] handleIncomingContentSharingFromRoster invalid roster current sequenceNumber ").concat(F.sequenceNumber," lastProcessedSequenceNumber ").concat(this.lastProcessedSequenceNumber));else{var W=this.parseContentSharingSessionsFromRoster(F),z=W.sessionsWithPresenters,J=W.sessionsWithoutPresenters;this.startSessionsFromRoster(z,G),this.stopSessionsFromRoster(J,G),this.lastProcessedSequenceNumber=F.sequenceNumber}},ContentSharingManager.prototype.handleContentSharingEnd=function(F){var B=F.body,G=Y.extractCauseIdFromMessage(F);this.logger.info("handleContentSharingEnd : ",(0,K.getPrintableObject)(B));var z=this.contentSharingSessions[B.contentSharingCorrelationId];if(z){if(z.handleStop(B,G)){var J=W({},B.contentSharingTransactionEnd);this.raiseContentSharingStopped(B.contentSharingCorrelationId,G,B.presenter.id,J)}}else this.logger.info("Ignoring contentSharingEnd since there is no corresponding sharing ongoing")},ContentSharingManager.prototype.parseContentSharingSessionsFromRoster=function(F){var B,G,W,K,J,Q,Y,$={},X={},Z=new Set;try{for(var ee=z(Object.keys(F.participants)),te=ee.next();!te.done;te=ee.next()){var ne=te.value,ie=F.participants[ne];if(!("Delta"===F.type&&this.lastProcessedSequenceNumberForParticipant.hasOwnProperty(ne)&&ie.version<=this.lastProcessedSequenceNumberForParticipant[ne])&&(ie.version=ie.version||-1,this.lastProcessedSequenceNumberForParticipant[ne]=ie.version,Z.add(ie.details.id),ie.endpoints)){var re=this.signalingSession.participantManager.localParticipant.participantId;try{for(var oe=(W=void 0,z(Object.keys(ie.endpoints))),ae=oe.next();!ae.done;ae=oe.next()){var se=ae.value,ce=ie.endpoints[se],le=null===(Y=null==ce?void 0:ce.contentSharing)||void 0===Y?void 0:Y.sessionInformation;"presenter"===(null==le?void 0:le.role)&&($[le.contentSharingCorrelationId]={presenterId:ie.details.id,sessionInfo:le,selfEndpointIsPresenter:ce.participantId===re})}}catch(F){W={error:F}}finally{try{ae&&!ae.done&&(K=oe.return)&&K.call(oe)}finally{if(W)throw W.error}}}}}catch(F){B={error:F}}finally{try{te&&!te.done&&(G=ee.return)&&G.call(ee)}finally{if(B)throw B.error}}try{for(var de=z(Object.keys(this.contentSharingSessions)),ue=de.next();!ue.done;ue=de.next()){var pe=ue.value;!$[pe]&&Z.has(this.contentSharingSessions[pe].presenterMri)&&(X[pe]=this.contentSharingSessions[pe])}}catch(F){J={error:F}}finally{try{ue&&!ue.done&&(Q=de.return)&&Q.call(de)}finally{if(J)throw J.error}}return{sessionsWithPresenters:$,sessionsWithoutPresenters:X}},ContentSharingManager.prototype.stopSessionsFromRoster=function(F,B){var G,W;this.logger.info("[".concat(B,"][stopSessionsFromRoster]"));try{for(var K=z(Object.keys(F)),J=K.next();!J.done;J=K.next()){var Q=J.value;this.logger.info("[".concat(B,"][stopSessionsFromRoster] stopping session with correlationId ").concat(Q)),this.stopSession(F[Q],B)}}catch(F){G={error:F}}finally{try{J&&!J.done&&(W=K.return)&&W.call(K)}finally{if(G)throw G.error}}},ContentSharingManager.prototype.stopSession=function(F,B){this.logger.info("[".concat(B,"][stopSession] Stopping session ").concat(F.sessionId)),F.handleStopFromRoster(this.DEFAULT_STOP_REASON,B),this.raiseContentSharingStopped(F.correlationId,B)},ContentSharingManager.prototype.startSessionsFromRoster=function(F,B){var G,W;this.logger.info("[".concat(B,"][startSessionsFromRoster]"));try{for(var K=z(Object.keys(F)),J=K.next();!J.done;J=K.next()){var Q=J.value;this.logger.info("[".concat(B,"][startSessionsFromRoster]"));var Y=this.contentSharingSessions[Q],$=F[Q];if(this.pendingSessionToStart&&this.pendingSessionToStart.correlationId===Q?this.pendingSessionToStart.confirmInRoster():Y&&Y.confirmInRoster(),Y)Y&&(this.contentSharingSessions[Q].presenterMri=$.presenterId,this.logger.info("[".concat(B,"][startSessionsFromRoster]Session ").concat(Q," is already present locally")));else{if($.selfEndpointIsPresenter){this.logger.info("[".concat(B,"][startSessionsFromRoster]This endpoint is presenting, dont fire callback"));continue}this.logger.info("[".concat(B,"][startSessionsFromRoster]New sharing session found. Raising ContentSharingStarted")),this.raiseContentSharingStarted($.presenterId,$.sessionInfo,B).handleStartFromRoster($.presenterId,B)}}}catch(F){G={error:F}}finally{try{J&&!J.done&&(W=K.return)&&W.call(K)}finally{if(G)throw G.error}}},ContentSharingManager.prototype.raiseContentSharingStopped=function(F,B,G,W){this.logger.info("[".concat(B,"][raiseContentSharingStopped]")),this.signalingSessionCallback.onContentSharingStopped({sessionId:this.contentSharingSessions[F].sessionId,correlationId:F,endedBy:G||this.DEFAULT_STOP_ID,reason:W||this.DEFAULT_STOP_REASON},B),delete this.contentSharingSessions[F]},ContentSharingManager.prototype.raiseContentSharingStarted=function(F,B,G){var W;this.logger.info("[".concat(G,"][raiseContentSharingStarted]"));var z=new J.ContentSharingSession(this.signalingSession,B.contentSharingCorrelationId,B.contentSharingSessionId,((W={})[Q.default.LINKS.CONTENT_SHARING_CONTROLLER]=B.contentSharingController,W));z.presenterMri=F,this.contentSharingSessions[z.correlationId]=z;var K={sessionId:B.contentSharingSessionId,correlationId:B.contentSharingCorrelationId,contentIdentifier:B.identifier,presenter:F,subject:B.subject||null,sessionState:B.sessionState||null};return this.signalingSessionCallback.onContentSharingStarted(K,G),z},ContentSharingManager.prototype.rejectBecauseOfMissingSession=function(F,B){var G="There is no ContentSharing session with the correlation ID ".concat(F);this.logger.error(G),B&&B.reject(new Error(G))},ContentSharingManager}();B.default=$},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.ContentSharingSession=void 0;var z=G(14),K=G(219),J=G(220),Q=G(221),Y=G(222),$=G(223),X=G(224),Z=G(225),ee=G(25),te=G(5),ne=G(48),ie=G(3),re=function(){function ContentSharingSession(F,B,G,W){var z=this;this.signalingSession=F,this.correlationId=B,this.sessionId=null,this.fsmState=te.default.CONTENT_SHARING_FSM_STATE.IDLE,this.addSessionPromise=null,this.removeSessionPromise=null,this.confirmInRosterPromise=null,this.links={},this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.disposed=!1,this.isPresenter=!1,this.FSM_STATES=te.default.CONTENT_SHARING_FSM_STATE,this.logger=F.logger.createChild((function(){return"[".concat(z.fsmState,"][cs=").concat(z.sessionId,"][cc=").concat(z.correlationId,"]")})),G&&(this.sessionId=G),W&&(this.links=W)}return ContentSharingSession.prototype.start=function(F,B,G,W){var J,Q=this;if(this.logger.info("[".concat(W,"][start]")),ie.assertNotNullOrEmpty(F,"Correct addModality url is not provided"),!this.checkState("start",this.FSM_STATES.IDLE,this.addSessionPromise))return Promise.reject(null);this.addSessionPromise=G,this.confirmInRosterPromise=ie.defer(),this.fsmState=this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.addTelemetryOperation(ee.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY.name,{causeId:W});var Y=((J={})[te.default.HEADERS.CONTENT_SHARING_CORRELATION_ID]=this.correlationId,J);return this.signalingSession.http.sendPostRequest({url:F,payload:K.getPayload(this.signalingSession,B),requestName:ee.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY.name,customHeaders:Y,onceTrouterReady:function(){Q.startContentSharingTimer(W)},causeId:W}).then((function(){Q.disposed||(Q.presenterMri=Q.signalingSession.participantManager.localParticipant.id,Q.isPresenter=!0)})).catch((function(F){var B=ie.getErrorForXHRFailure(F,Q.signalingSession.signalingAgentConfig);return Q.logger.info("[".concat(W,"][start] error: ").concat((0,z.getPrintableObject)(B))),Q.disposed||(Q.signalingSession.timeoutManager.stopTimer(te.default.TIMEOUT_OPERATIONS.ADD_MODALITY),Q.rejectPendingPromise((0,z.getPrintableObject)(F),B.error)),Promise.reject(null)}))},ContentSharingSession.prototype.delete=function(F,B){var G=this;this.logger.info("[".concat(B,"][delete]"));var W=!1;if(this.fsmState===this.FSM_STATES.IDLE)return this.logger.info("[".concat(B,"][delete] skipped because state is already ").concat(this.fsmState)),F.resolve(),Promise.resolve();if(this.fsmState===this.FSM_STATES.CONTENT_SHARING_START_INITIATED)W=!0,this.rejectPendingPromise("Session delete called before start was finished");else if(!this.checkState("delete",this.FSM_STATES.CONTENT_SHARING_CONNECTED,F))return Promise.reject(null);W||ie.assertNotNullOrEmpty(this.links[te.default.LINKS.CONTENT_SHARING_CONTROLLER],"Correct controller url is not set"),this.removeSessionPromise=F,this.fsmState=this.FSM_STATES.CONTENT_SHARING_DELETE_INITIATED;var K=ne.build(),J=this.addTelemetryOperation(ee.NETWORK_REQUESTS.DELETE_CONTENT_SHARING.name,{causeId:B});return(W?Promise.resolve(void 0):this.signalingSession.http.sendDeleteRequest({url:this.links[te.default.LINKS.CONTENT_SHARING_CONTROLLER],requestName:ee.NETWORK_REQUESTS.DELETE_CONTENT_SHARING.name,payload:Q.getPayload(this.signalingSession,{code:te.default.CALL_END_CODE.SUCCESS,subCode:te.default.CALL_END_SUB_CODE.SUCCESS,phrase:te.default.CALL_END_PHRASE.LOCAL_USER_INITIATED}),causeId:B})).then((function(){if(!G.disposed){var F={success:!0,duration:K.duration()};W&&(F.skipReason="Session delete called before start was finished"),G.updateTelemetryOperation(J,F),G.fsmState=G.FSM_STATES.IDLE,G.resolvePendingPromise()}})).catch((function(F){var W=ie.getErrorForXHRFailure(F,G.signalingSession.signalingAgentConfig);if(G.logger.info("[".concat(B,"][delete] error: ").concat((0,z.getPrintableObject)(W))),!G.disposed){var Q={success:!1,duration:K.duration()};G.updateTelemetryOperation(J,Q),G.fsmState=G.FSM_STATES.IDLE,G.resolvePendingPromise()}return Promise.reject(null)}))},ContentSharingSession.prototype.join=function(F,B){var G=this;if(this.logger.info("[".concat(B,"][join]")),ie.assertNotNullOrEmpty(this.links[te.default.LINKS.CONTENT_SHARING_CONTROLLER],"Correct joinContentSharing url is not provided"),this.checkState("join",this.FSM_STATES.IDLE,F)){this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.addSessionPromise=F,this.fsmState=this.FSM_STATES.CONTENT_SHARING_JOIN_INITIATED;var W=ne.build(),K=this.addTelemetryOperation(ee.NETWORK_REQUESTS.JOIN_CONTENT_SHARING.name,{causeId:B});this.signalingSession.http.sendPostRequest({url:this.links[te.default.LINKS.CONTENT_SHARING_CONTROLLER],payload:J.getPayload(this.signalingSession),requestName:ee.NETWORK_REQUESTS.JOIN_CONTENT_SHARING.name,causeId:B}).then((function(F){if(!G.disposed){var B={success:!0,duration:W.duration()};G.updateTelemetryOperation(K,B),G.processStartOrJoinSuccess(F.response),G.resolvePendingPromise(F.response)}})).catch((function(F){var J=ie.getErrorForXHRFailure(F,G.signalingSession.signalingAgentConfig);if(G.logger.info("[".concat(B,"][join] error: ").concat((0,z.getPrintableObject)(J))),!G.disposed){var Q={success:!1,duration:W.duration()};G.updateTelemetryOperation(K,Q);var Y=J.error;G.rejectPendingPromise((0,z.getPrintableObject)(F),Y)}}))}},ContentSharingSession.prototype.takeControl=function(F,B){var G=this;if(this.logger.info("[".concat(B,"][takeControl]")),ie.assertNotNullOrEmpty(this.links[te.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],"correct contentSharingTakeControl url is not provided"),this.checkState("takeControl",this.FSM_STATES.CONTENT_SHARING_CONNECTED,F)){var W=ne.build(),K=this.addTelemetryOperation(ee.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING.name,{causeId:B});this.signalingSession.http.sendPostRequest({url:this.links[te.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],payload:Y.getPayload(this.signalingSession),requestName:ee.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING.name,withoutTrouter:!0,causeId:B}).then((function(B){if(!G.disposed){var z={success:!0,duration:W.duration()};G.updateTelemetryOperation(K,z);var J={contentIdentifier:B.response.identifier,presenter:B.response.presenter.id,subject:B.response.subject||null,sessionState:B.response.sessionState||null};F.resolve(J)}})).catch((function(J){var Q=ie.getErrorForXHRFailure(J,G.signalingSession.signalingAgentConfig);if(G.logger.info("[".concat(B,"][takeControl] error: ").concat((0,z.getPrintableObject)(Q))),!G.disposed){var Y={success:!1,duration:W.duration()};G.updateTelemetryOperation(K,Y);var $=new Error((0,z.getPrintableObject)(J));$.endCode=Q.error,F.reject($)}}))}},ContentSharingSession.prototype.updateSessionState=function(F,B,G){var W=this;if(this.logger.info("[".concat(G,"][updateSessionState]")),ie.assertNotNullOrEmpty(this.links[te.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],"Correct sendUpdateSessionState url is not provided"),this.checkState("updateSessionState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,B)){var K=ne.build(),J=this.addTelemetryOperation(ee.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING.name,{causeId:G});this.signalingSession.http.sendPostRequest({url:this.links[te.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],payload:Z.getPayload(this.signalingSession,F,this.nextClientSequenceNumberToUse++),requestName:ee.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING.name,causeId:G}).then((function(){if(!W.disposed){var F={success:!0,duration:K.duration()};W.updateTelemetryOperation(J,F),B.resolve()}})).catch((function(F){var Q=ie.getErrorForXHRFailure(F,W.signalingSession.signalingAgentConfig);if(W.logger.info("[".concat(G,"][updateSessionState] error: ").concat((0,z.getPrintableObject)(Q))),!W.disposed){var Y={success:!1,duration:K.duration()};W.updateTelemetryOperation(J,Y);var $=new Error((0,z.getPrintableObject)(F));$.endCode=Q.error,B.reject($)}}))}},ContentSharingSession.prototype.updateParticipantState=function(F,B){var G=this;if(this.logger.info("[".concat(B,"][updateParticipantState]")),ie.assertNotNullOrEmpty(this.links[te.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],"correct confirmContentSharingView url is not provided"),this.checkState("updateParticipantState",this.FSM_STATES.CONTENT_SHARING_CONNECTED,F)){var W=ne.build(),K=this.addTelemetryOperation(ee.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING.name,{causeId:B});this.signalingSession.http.sendPostRequest({url:this.links[te.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],payload:X.getPayload(this.signalingSession),requestName:ee.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING.name,withoutTrouter:!0,causeId:B}).then((function(){if(!G.disposed){var B={success:!0,duration:W.duration()};G.updateTelemetryOperation(K,B),F.resolve()}})).catch((function(J){var Q=ie.getErrorForXHRFailure(J,G.signalingSession.signalingAgentConfig);if(G.logger.info("[".concat(B,"][updateParticipantState] error: ").concat((0,z.getPrintableObject)(Q))),!G.disposed){var Y={success:!1,duration:W.duration()};G.updateTelemetryOperation(K,Y);var $=new Error((0,z.getPrintableObject)(J));$.endCode=Q.error,F.reject($)}}))}},ContentSharingSession.prototype.updateNotificationLinks=function(F){var B=this;if(this.logger.info("[".concat(F,"][updateNotificationLinks]")),ie.assertNotNullOrEmpty(this.links[te.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],"correct notificationLinks url is not provided"),this.checkState("updateState",this.FSM_STATES.CONTENT_SHARING_CONNECTED)){var G=ne.build(),W=this.addTelemetryOperation(ee.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS.name,{causeId:F});this.signalingSession.http.sendPostRequest({url:this.links[te.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],payload:$.getPayload(this.signalingSession),requestName:ee.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS.name,withoutTrouter:!0,causeId:F}).then((function(){if(!B.disposed){var F={success:!0,duration:G.duration()};B.updateTelemetryOperation(W,F)}})).catch((function(K){var J=ie.getErrorForXHRFailure(K,B.signalingSession.signalingAgentConfig);if(B.logger.info("[".concat(F,"][updateNotificationLinks] error: ").concat((0,z.getPrintableObject)(J))),!B.disposed){var Q={success:!1,duration:G.duration()};B.updateTelemetryOperation(W,Q)}}))}},ContentSharingSession.prototype.confirmInRoster=function(){this.confirmInRosterPromise&&this.confirmInRosterPromise.isPending&&(this.logger.info("Confirmed in roster"),this.confirmInRosterPromise.resolve())},ContentSharingSession.prototype.handleAddModalitySuccess=function(F,B){var G=this;return this.logger.info("[".concat(B,"][handleAddModalitySuccess]")),this.checkState("handleAddModalitySuccess",this.FSM_STATES.CONTENT_SHARING_START_INITIATED)?F.modalitySuccess&&F.modalitySuccess.contentSharing?(this.addTelemetryOperation(ee.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{causeId:B}),this.processStartOrJoinSuccess(F.modalitySuccess.contentSharing),this.confirmInRosterPromise.promise.then((function(){delete G.confirmInRosterPromise,G.signalingSession.timeoutManager.stopTimer(te.default.TIMEOUT_OPERATIONS.ADD_MODALITY),G.resolvePendingPromise(F.modalitySuccess.contentSharing)})),!0):(this.addTelemetryOperation(ee.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{causeId:B,skipReason:"no content sharing blob"}),this.logger.info("[".concat(B,"][handleAddModalitySuccess] ignored because modalitySuccess was missing or did not contain content sharing blob")),!1):(this.logger.info("[".concat(B,"][handleAddModalitySuccess] ignored because session is not waiting to start")),!1)},ContentSharingSession.prototype.handleAddModalityFailure=function(F,B){if(this.logger.info("[".concat(B,"][handleAddModalityFailure]")),!this.checkState("handleAddModalityFailure",[this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.FSM_STATES.CONTENT_SHARING_CONNECTED]))return!1;if(!F.modalityFailure||!F.modalityFailure.contentSharing)return this.addTelemetryOperation(ee.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{causeId:B,skipReason:"no content sharing blob"}),!1;var G=F.modalityFailure.contentSharing;this.addTelemetryOperation(ee.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{reason:G,causeId:B});var z=W({},G);return this.sendTelemetryData(z),this.rejectPendingPromise(z.phrase,z),this.signalingSession.timeoutManager.stopTimer(te.default.TIMEOUT_OPERATIONS.ADD_MODALITY),!0},ContentSharingSession.prototype.handleStartFromRoster=function(F,B){this.logger.info("[".concat(B,"][handleStartFromRoster]")),this.addTelemetryOperation(ee.EVENTS.CONTENT_SHARING_START_FROM_ROSTER,{causeId:B})},ContentSharingSession.prototype.handleStopFromRoster=function(F,B){this.logger.info("[".concat(B,"][handleStopFromRoster]")),this.addTelemetryOperation(ee.EVENTS.CONTENT_SHARING_END_FROM_ROSTER,{causeId:B}),this.sendTelemetryData(F)},ContentSharingSession.prototype.handleStop=function(F,B){if(this.logger.info("[".concat(B,"][handleStop]")),this.isSelfInitiatedAction(F))return this.logger.info("[".concat(B,"][handleStop]handleStop skipped because session was ended by self")),!1;var G=W({},F.contentSharingTransactionEnd);return this.addTelemetryOperation(ee.EVENTS.HANDLE_CONTENT_SHARING_END,{causeId:B}),this.sendTelemetryData(G),!0},ContentSharingSession.prototype.handleUpdate=function(F,B){return this.logger.info("[".concat(B,"][handleUpdate]")),F.sequenceNumber<=this.lastUpdateSequenceNumber?(this.logger.info("handleUpdate skipped because of old sequence number: last received ".concat(this.lastUpdateSequenceNumber,", update contained ").concat(F.sequenceNumber)),this.addTelemetryOperation(ee.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{causeId:B,skipReason:"old sequence number"}),!1):(this.lastUpdateSequenceNumber=F.sequenceNumber,this.isPresenter=F.presenter.id===this.signalingSession.participantManager.localParticipant.id,this.addTelemetryOperation(ee.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{causeId:B}),!0)},ContentSharingSession.prototype.dispose=function(F,B){this.logger.info("[".concat(B,"][dispose]")),this.disposed=!0,this.rejectPendingPromise("call ended",F||{code:te.default.CALL_END_CODE.SUCCESS,subCode:te.default.CALL_END_SUB_CODE.SUCCESS,phrase:te.default.CALL_END_PHRASE.LOCAL_USER_INITIATED}),this.addTelemetryOperation(ee.EVENTS.HANDLE_CALL_END,{causeId:B}),this.sendTelemetryData(F)},ContentSharingSession.prototype.rejectPendingPromise=function(F,B){this.logger.info("rejectPendingPromise");var G=new Error(F);B&&(G.endCode=B),this.removeSessionPromise&&(this.removeSessionPromise.reject(G),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.reject(G),this.addSessionPromise=null)},ContentSharingSession.prototype.resolvePendingPromise=function(F){this.logger.info("resolvePendingPromise");var B=null;F&&(B={sessionId:F.sessionId,correlationId:F.contentSharingCorrelationId,contentIdentifier:F.identifier,presenter:F.presenter.id,subject:F.subject||null,sessionState:F.sessionState||null}),this.removeSessionPromise&&(this.removeSessionPromise.resolve(B),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.resolve(B),this.addSessionPromise=null)},ContentSharingSession.prototype.processStartOrJoinSuccess=function(F){this.logger.info("processStartOrJoinSuccess"),this.sessionId=F.sessionId,this.fsmState=this.FSM_STATES.CONTENT_SHARING_CONNECTED,this.lastUpdateSequenceNumber=-1,this.links[te.default.LINKS.CONTENT_SHARING_CONTROLLER]=F.links.contentSharingController,this.links[te.default.LINKS.CONTENT_SHARING_TAKE_CONTROL]=F.links.takeControl,this.links[te.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE]=F.links.updateSessionState,this.links[te.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE]=F.links.sync,this.links[te.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS]=F.links.notificationLinks,this.links[te.default.LINKS.CONTENT_SHARING_LEAVE]=F.links.leave},ContentSharingSession.prototype.checkState=function(F,B,G){if("string"==typeof B?this.fsmState===B:B.indexOf(this.fsmState)>-1)return!0;var W="".concat(F," requires state ").concat(B,", but state is ").concat(this.fsmState);return this.logger.error(W),G&&G.reject(W),!1},ContentSharingSession.prototype.isSelfInitiatedAction=function(F){return F.presenter.participantId===this.signalingSession.participantManager.localParticipant.participantId},ContentSharingSession.prototype.startContentSharingTimer=function(F){var B=this;this.logger.info("startContentSharingTimer"),this.signalingSession.timeoutManager.startTimer(te.default.TIMEOUT_OPERATIONS.ADD_MODALITY,(function(){B.addTelemetryOperation(ee.EVENTS.ADD_MODALITY_TIMEOUT,{causeId:F}),B.signalingSession.timeoutManager.stopTimer(te.default.TIMEOUT_OPERATIONS.ADD_MODALITY),B.rejectPendingPromise("timed out waiting for ContentSharing to start",{code:te.default.CALL_END_CODE.TIMEOUT,subCode:te.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:te.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})}),te.default.TIMEOUT_VALUES_IN_SECONDS.ADD_MODALITY_TIMEOUT)},ContentSharingSession.prototype.addTelemetryOperation=function(F,B){return this.signalingSession.telemetryHelper.addContentSharingOperation(this.correlationId,F,B)},ContentSharingSession.prototype.updateTelemetryOperation=function(F,B){this.signalingSession.telemetryHelper.updateContentSharingOperation(this.correlationId,F,B)},ContentSharingSession.prototype.sendTelemetryData=function(F){this.signalingSession.telemetryHelper.sendContentSharingTelemetryData(this.correlationId,this.signalingSession.sessionId,this.isPresenter,F,this.links[te.default.LINKS.CONTENT_SHARING_CONTROLLER],this.sessionId)},ContentSharingSession}();B.ContentSharingSession=re},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B){return K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"content cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},to:[]},contentSharing:{identifier:B.contentIdentifier,subject:B.subject,sessionState:B.sessionState,sequenceNumber:B.sequenceNumber,links:{sessionUpdate:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_END)}},links:{addModalitySuccess:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_FAILURE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F){return K.assertNotNull(F,"signalingSession cannot be null"),{payload:{contentSharing:{links:{sessionUpdate:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_END)}},participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B){return W.assertNotNull(F,"signalingSession cannot be null"),W.assertCallEndReason(B),{payload:{contentSharingTransactionEnd:B,participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F){return W.assertNotNull(F,"signalingSession cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F){return K.assertNotNull(F,"signalingSession cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}},links:{sessionUpdate:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_END)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F){return W.assertNotNull(F,"signalingSession cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B,G){return W.assertNotNull(F,"signalingSession cannot be null"),W.assertNotNull(B,"sessionState cannot be null"),W.assertNotNull(G,"sequenceNumber cannot be null"),{payload:{sessionUpdateSequenceNumber:G,sessionState:B,participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}}}}}B.getPayload=getPayload},function(F,B,G){var W,z=this&&this.__assign||function(){return z=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},z.apply(this,arguments)},K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},Y=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.HttpStack=void 0;var $=G(14),X=G(227),Z=G(5),ee=G(228),te=G(229),ne=G(48),ie=G(3),re=((W={})[1]="POST",W[0]="GET",W[2]="PUT",W[3]="DELETE",W),oe=function(){function HttpStack(F,B){var G=this;this.signalingSession=F,this.callStartTime=B,this.pendingRequests={},this.sendGetRequest=function(F){return G.sendRequest(0,F)},this.sendPostRequest=function(F){return G.sendRequest(1,F)},this.sendPutRequest=function(F){return G.sendRequest(2,F)},this.sendDeleteRequest=function(F){return G.sendRequest(3,F)},this.cancelRequestIfPending=function(F,B,W,z){G.logger.info("[".concat(B,"][cancelRequestIfPending]")),G.pendingRequests[F]?W?G.hasPendingRequest(F,W)&&G.cancelRequest(F,W,B,z):Object.keys(G.pendingRequests[F]).forEach((function(W){return G.cancelRequest(F,W,B,z)})):G.logger.info("[".concat(B,"][cancelRequestIfPending]no pending request with name=").concat(F))},this.cancelAllRequests=function(F){G.logger.info("[".concat(F,"][cancelAllRequests]"));var B=[];return Object.keys(G.pendingRequests).forEach((function(W){Object.keys(G.pendingRequests[W]).forEach((function(z){B.push(G.cancelRequest(W,z,F))}))})),Promise.all(B).catch((function(){}))},this.hasPendingRequest=function(F,B){return!!G.pendingRequests[F]&&Boolean(B?G.pendingRequests[F][B]:G.pendingRequests[F])},this.cancelRequest=function(F,B,W,z){try{return G.pendingRequests[F][B].dispatcher&&G.pendingRequests[F][B].dispatcher.cancelRequest(),G.pendingRequests[F][B].aborted=!0,G.pendingRequests[F][B].errorDetails=z,G.logger.info("[".concat(W,"][cancelRequest]Request=").concat(F," aborted ").concat(z?"with errorDetails ".concat(JSON.stringify(z)):"")),G.pendingRequests[F][B].requestPromise.catch((function(){}))}catch(z){return G.logger.warn("[".concat(W,"][cancelRequest]Unable to cancel request=").concat(F,", requestId=").concat(B)),Promise.resolve()}},this.buildRequestTelemetry=function(F,B,W,z){return{name:"".concat(re[F],"-").concat(B.requestName),url:B.url,eventStart:W-G.callStartTime,trouterReady:-1,requestReady:-1,status:-1,attempts:[],rtt:-1,uid:B.requestId,causeId:B.causeId,requestDispatcherConfig:z,enableRequestHedging:G.shouldEnableRequestHedging(z)}},this.addPendingRequest=function(F){return G.pendingRequests[F.requestName]||(G.pendingRequests[F.requestName]={}),G.pendingRequests[F.requestName][F.requestId]={dispatcher:null,requestPromise:null,aborted:!1},G.pendingRequests[F.requestName][F.requestId]},this.sendRequest=function(F,B){if(!B.url){G.logger.error(B.requestName,"Link does not exist");var W={code:Z.default.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,subCode:Z.default.CALL_END_SUB_CODE.LOCAL_HTTP_STACK_ERROR,phrase:"Link does not exist for requestName: ".concat(B.requestName,".")};return Promise.reject(W)}B.requestId||(B.requestId=ie.newGuid()),B.causeId||(B.causeId=ie.causeId());var X=G.logger.createChild("[".concat(B.causeId,"][").concat(B.requestName,"]"));X.info("[scheduled]");var re,oe=G.getInternalHttpDispatcherConfig(B.requestName,B.operationType);B.skipHttpTelemetry||(B.skipHttpTelemetry=!1);var ae=ne.build(),se=(new Date).getTime(),ce=[],le=G.buildRequestTelemetry(F,B,se,oe),updateRequestTelemetry=function(){G.signalingSession.disposed?G.logger.info("Unable to record telemetry, session disposed"):G.signalingSession.telemetryHelper.updateNetworkRequest(le)},deleteRequestTelemetry=function(){G.signalingSession.telemetryHelper.deleteNetworkRequest(le)};updateRequestTelemetry();var logRequestAttempt=function(F,W){if(F&&F.request){X.info("[finished][status=".concat(F.request.status,"][statusText=").concat(F.request.statusText,"][retryCount=").concat(F.attempt,"]"));var z={status:F.request.status,start:F.attemptStartTimestamp-se,end:F.attemptResponseTimestamp-se,online:ie.isTrouterAndNavigatorConnected(G.signalingSession.signalingAgentConfig.trouterServiceProvider)};F.abandoned&&(z.abandoned=!0),F.request.statusText&&(z.statusText=F.request.statusText),(W||-1===le.status)&&(le.status=F.request.status),le.attempts.push(z),updateRequestTelemetry()}else G.logger.warn(B.requestName,"missing request details, unable to record for telemetry!")};if(G.hasPendingRequest(B.requestName,B.requestId))return G.logger.warn(B.requestName,B.requestId,"is already pending request!!"),G.pendingRequests[B.requestName][B.requestId].requestPromise;re=G.addPendingRequest(B);var recordTelemetryAndCleanup=function(F,W,z,K){if(F&&B.skipHttpTelemetry)return G.logger.info("Skipping telemetry"),void deleteRequestTelemetry();X.info("[steps=".concat(ce,"]")),G.pendingRequests[B.requestName][B.requestId].aborted&&(le.aborted=!0),G.hasPendingRequest(B.requestName,B.requestId)?(delete G.pendingRequests[W][z],Object.keys(G.pendingRequests[W]).length||delete G.pendingRequests[W]):G.logger.warn("Unable to clean up!"),G.signalingSession.disposed||(K&&(le.error=K),le.rtt=ae.duration(),G.signalingSession.telemetryHelper.addNetworkOperationCompleted(B.requestName,F,ae.duration()),updateRequestTelemetry())},checkIfNotDisposed=function(F){return function(){for(var W=[],z=0;z<arguments.length;z++)W[z]=arguments[z];if(G.signalingSession.disposed){var K="[".concat(B.causeId,"][").concat(B.requestName,"][failed][reason=Session disposed]");throw X.info("[failed][reason=Session disposed]"),new Error(K)}if(G.hasPendingRequest(B.requestName,B.requestId)&&G.pendingRequests[B.requestName][B.requestId].aborted){var J=void 0,$="[".concat(B.causeId,"][").concat(B.requestName,"][failed][reason=request already aborted]"),Z=G.pendingRequests[B.requestName][B.requestId].errorDetails;throw Z?(J=Z).phrase=$:J=$,X.info("".concat($)),new Error(JSON.stringify(J))}return F.apply(void 0,Y([],Q(W),!1))}},de=checkIfNotDisposed((function(){return ce.push("[waitForTrouter]"),B.withoutTrouter?Promise.resolve():G.signalingSession.ensureMessageChannelReady(B.requestName)})),ue=checkIfNotDisposed((function(){return ce.push("[trouterReady]"),le.trouterReady=ae.duration(),B.onceTrouterReady&&B.onceTrouterReady(),updateRequestTelemetry(),Promise.resolve()})),pe=checkIfNotDisposed((function(){var W=G.signalingSession.signalingAgent.clientSupportsGenericTokenAPI,z=ie.getTokenMetadata(G.signalingSession.signalingAgentConfig,W,F,B);return ce.push("[buildRequest]"),ee.get({signalingSession:G.signalingSession,operation:B.requestName,data:B.payload,customHeaders:B.customHeaders,causeId:B.causeId,tokenRequestOptions:z},G.logger)})),he=checkIfNotDisposed((function(F){ce.push("[failedToBuildRequestOptions]");var B={request:{status:Z.default.HTTP_STATUS_CODES.OTHER,statusText:"Local error"},attempt:1,success:!1,attemptResponseTimestamp:(new Date).getTime(),attemptStartTimestamp:(new Date).getTime()};return F&&F.skypeTokenError&&(B.request={status:Z.default.HTTP_STATUS_CODES.SKYPE_TOKEN_ERROR,statusText:"Failed to fetch skypetoken"}),logRequestAttempt(B,!1),Promise.reject(F)})),ge=checkIfNotDisposed((function(F){return ce.push("[requestBuilt]"),le.requestReady=ae.duration(),F.usedCachedSkypetoken&&(le.usedCachedSkypetoken=F.usedCachedSkypetoken),updateRequestTelemetry(),Promise.resolve(F)})),authRequiredCallback=function(){ce.push("[authRequired]");var W=G.signalingSession.signalingAgent.clientSupportsGenericTokenAPI,z=ie.getTokenMetadata(G.signalingSession.signalingAgentConfig,W,F,B,!0);return ee.get({signalingSession:G.signalingSession,operation:B.requestName,data:B.payload,customHeaders:B.customHeaders,causeId:B.causeId,forceFetchToken:!0,tokenRequestOptions:z},G.logger)},fe=checkIfNotDisposed((function(W){ce.push("[sendRequest]");var K=z(z({},oe),{enableRequestHedging:G.shouldEnableRequestHedging(oe),hedgeDelayMs:G.signalingSession.signalingAgentConfig.hedgeDelayMs,hedgeMaxParallelAttempts:G.signalingSession.signalingAgentConfig.hedgeMaxParallelAttempts,retryIntervalsMs:B.disableRetry||!oe.retryIntervalsMs?[]:oe.retryIntervalsMs,reportPreviousErrorsForTimeout:G.signalingSession.signalingAgentConfig.reportPreviousErrorsForTimeout}),J=(0,te.build)({logger:G.logger,causeId:B.causeId,dispatcher:G.signalingSession.signalingAgentConfig.httpRequestDispatcher,url:B.url,request:W,requestType:F,authRequiredCallback:authRequiredCallback,attemptFailureCallback:function(F){logRequestAttempt(F,!1)},settings:K});return re.dispatcher=J,updateRequestTelemetry(),J.sendRequest()})),me=checkIfNotDisposed((function(F){return K(G,void 0,void 0,(function(){return J(this,(function(G){return logRequestAttempt(F,!0),X.info("[success]"),recordTelemetryAndCleanup(!0,B.requestName,B.requestId),[2,F]}))}))})),onFailure=function(F){var G=(0,$.getPrintableObject)(F);return recordTelemetryAndCleanup(!1,B.requestName,B.requestId,G),!F||F.readyState||F.status?X.info("[failed][reason=".concat(G,"]")):X.info("[failed][offline][reason=".concat(G,"]")),Promise.reject(F)},ve=Promise.resolve().then(de).then(ue).then(pe).catch(he).then(ge).then(fe).then(me).catch(onFailure);return re.requestPromise=ve,ve},this.logger=this.signalingSession.logger.createChild("[HTTP]")}return HttpStack.prototype.getInternalHttpDispatcherConfig=function(F,B){void 0===B&&(B="Other");var G=z(z(z({},X.defaultRequestTypeHttpDispatcherConfigMap.Default),X.defaultOperationTypeHttpDispatcherConfigMap[B]),X.defaultRequestTypeHttpDispatcherConfigMap[F]);return this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap&&(G=z(z({},G),this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap[B])),this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap&&(G=z(z(z({},G),this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap.Default),this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap[F])),this.logger.info("getInternalHttpDispatcherConfig request type: ".concat(F," config: ").concat((0,$.safeJsonStringify)(G))),G},HttpStack.prototype.shouldEnableRequestHedging=function(F){return!!(this.signalingSession.getMeetingInfo()&&F.requestHedgingCapability.indexOf("enabledForMeetings")>-1)||(!this.signalingSession.multiParty&&F.requestHedgingCapability.indexOf("enabledForP2PCalls")>-1||(!!(this.signalingSession.multiParty&&F.requestHedgingCapability.indexOf("enabledForGroupCalls")>-1)||F.requestHedgingCapability.indexOf("enabled")>-1))},HttpStack}();B.HttpStack=oe},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.defaultOperationTypeHttpDispatcherConfigMap=B.defaultRequestTypeHttpDispatcherConfigMap=void 0,B.defaultRequestTypeHttpDispatcherConfigMap={Default:{retryIntervalsMs:[200,1e3,5e3],maxRequestAttempts:4,perRequestTimeoutMs:45e3,perAttemptTimeoutMs:15e3,perRequestTimeoutWithHedgingMs:45e3,perAttemptTimeoutWithHedgingMs:3e4},BrokerSubscribe:{retryIntervalsMs:[100,200,500]}},B.defaultOperationTypeHttpDispatcherConfigMap={CallSetup:{requestHedgingCapability:["disabled"]},Other:{requestHedgingCapability:["disabled"]},BrokerSubscribe:{requestHedgingCapability:["disabled"]}}},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.get=void 0;var z=G(5),K=G(3),J="HttpRequestDispatcherFactory";function get(F,B){var G=F.signalingSession,Q=F.operation,Y=F.causeId,$=F.data,X=F.customHeaders,Z=void 0===X?{}:X,ee=F.forceFetchToken,te=F.tokenRequestOptions;if(G.disposed)return Promise.reject("Session already disposed");var handleFailure=function(F){var B="string"==typeof F?new Error(F):F;throw B.skypeTokenError=!0,B},ne=!1;return G.signalingAgent.authTokenManager.getToken(Y,ee,te).catch((function(F){return!ee&&isAppOnline(G)&&G.signalingAgentConfig.attemptHttpRequestWithCachedSkypetoken&&G.signalingAgent.authTokenManager.getLastToken(Y)?(ne=!0,Promise.resolve(G.signalingAgent.authTokenManager.getLastToken(Y))):(B&&B.info("[".concat(Y,"] getToken failed with error ").concat(F)),handleFailure(F))})).then((function(F){if(G.disposed)throw new Error("skypeToken Getter returned too late. Object is already disposed");var B={};if(B[z.default.HEADERS.CORRELATION_ID]=G.correlationId,B[z.default.HEADERS.MESSAGE_ID]=K.newMessageId(Y),B[z.default.HEADERS.CLIENT_USER_AGENT]=G.signalingAgentConfig.clientInformation,G.signalingAgent.clientSupportsGenericTokenAPI){var X=G.signalingAgent.authTokenManager.getLastTokenType(Y);switch(X){case 4:B[z.default.HEADERS.AUTHORIZATION]="".concat(z.default.HEADERS.BEARER_KEYWORD," ").concat(F);break;case 1:B[z.default.HEADERS.SKYPE_TOKEN]=F;break;default:throw new Error("Error in RequestBuilder. TokenType ".concat(X," is not supported"))}}else B[z.default.HEADERS.SKYPE_TOKEN]=F;var ee=G.participantManager.localParticipant;ee&&(ee.ring&&(B[z.default.HEADERS.RING]=ee.ring),ee.region&&(B[z.default.HEADERS.REGION]=ee.region),ee.partition&&(B[z.default.HEADERS.PARTITION]=ee.partition));var te=$&&$.payload?JSON.stringify($.payload):null,ie={headers:W(W({},B),Z),payload:te,usedCachedSkypetoken:ne,reporting:{serviceName:Q?"".concat(J,"-").concat(Q):J}};return G.telemetryHelper.addNetworkOperationStarted(Q),ie})).catch(handleFailure)}function isAppOnline(F){var B=K.isTrouterAndNavigatorConnected(F.signalingAgentConfig.trouterServiceProvider);return 3===B||1===B}B.get=get},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.RequestDispatcher=B.build=B.TIMERS=void 0;var J,Q=G(76),Y=G(14),$=G(5),X=G(107),Z=G(3),ee=500,te=1e4,ne=4,ie=3e3,re=3;function build(F){return new oe(F.causeId,F.logger,F.dispatcher,F.requestType,F.url,F.request,F.attemptFailureCallback,F.authRequiredCallback,F.settings)}!function(F){F.HEDGE="HEDGE",F.ATTEMPT_TIMEOUT="ATTEMPT_TIMEOUT",F.RETRY="RETRY",F.REQUEST_TIMEOUT="REQUEST_TIMEOUT"}(J=B.TIMERS||(B.TIMERS={})),B.build=build;var oe=function(){function RequestDispatcher(F,B,G,z,K,Q,Z,oe,ae){var se=this;this.causeId=F,this.logger=B,this.dispatcher=G,this.requestType=z,this.url=K,this.request=Q,this.onRequestFailed=Z,this.authRequiredCallback=oe,this.settings=ae,this.requestsSent=0,this.otherAttemptSuccessful=!1,this.pendingAttempts=[],this.hedgeDelayMs=ie,this.hedgeMaxParallelAttempts=re,this.stopStandardRetryTimer=function(){se.standardRetryTimer&&(se.standardRetryTimer.stop(),se.standardRetryTimer=null)},this.stopHedgeTimer=function(){se.hedgeTimer&&(se.hedgeTimer.stop(),se.hedgeTimer=null)},this.stopAttemptTimeoutTimer=function(F){try{F.timeoutTimer.stop()}catch(F){se.logger.info("stopAttemptTimeoutTimer error ".concat(F))}se.logger.info("attempt time stopped")},this.stopRequestTimer=function(){try{se.requestTimer&&se.requestTimer.stop()}catch(F){se.logger.info("stopRequestTimer error ".concat(F))}se.logger.info("Request timer stopped"),se.requestTimer=null},this.canScheduleNextAttempt=function(){return se.stackError===$.default.HTTP_STACK_ERROR.REQUEST_ABORTED||se.otherAttemptSuccessful||se.requestsSent>=se.settings.maxRequestAttempts?(se.logger.info("canScheduleNextAttempt stack error ".concat(se.stackError)+" otherAttemptSuccessful ".concat(se.otherAttemptSuccessful)+" exceeded max attempt ".concat(se.requestsSent>=se.settings.maxRequestAttempts)),!1):se.settings.enableRequestHedging?((F=se.pendingAttempts.length<se.hedgeMaxParallelAttempts)||se.logger.info("canScheduleNextAttempt enableRequestHedging attempts sent: ".concat(se.pendingAttempts.length," max attempts: ").concat(se.hedgeMaxParallelAttempts)),F):((F=se.requestsSent<se.settings.retryIntervalsMs.length)||se.logger.info("canScheduleNextAttempt attempts sent: ".concat(se.requestsSent," max attempts: ").concat(se.settings.retryIntervalsMs.length)),F);var F},this.scheduleNextRequest=function(F){se.settings.enableRequestHedging?(se.logger.info("scheduleNextRequest with hedging"),se.hedgeTimer=X.TimerFactory.build((function(){se.attempt(),se.canScheduleNextAttempt()&&se.scheduleNextRequest(!1)}),J.HEDGE).start(se.getNextDelay(F))):(se.logger.info("scheduleNextRequest with retry"),se.standardRetryTimer=X.TimerFactory.build((function(){se.attempt()}),J.RETRY).start(se.getNextDelay(F)))},this.standardizeFailedRequest=function(F,B){var G,z,K,J=se.logger.createChild("[standardizeFailedRequest]");try{if(se.stackError===$.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT)J.info("request timed out"),K=$.REQUEST_DISPATCHER_RESPONSE.REQUEST_TIMEOUT;else if(se.stackError===$.default.HTTP_STACK_ERROR.REQUEST_ABORTED)J.info("request aborted"),K=$.REQUEST_DISPATCHER_RESPONSE.REQUEST_ABORTED;else if(B&&B.status===$.default.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT)J.info("request attempt timed out"),K=$.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_TIMEOUT;else if(B&&[$.default.HTTP_STACK_ERROR.ATTEMPT_ABORTED,$.default.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL].indexOf(B.status)>-1)J.info("request attempt aborted"),K=$.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_ABORTED;else if(F){if(J.info("request ".concat((0,Y.safeJsonStringify)(F))),"function"==typeof XMLHttpRequest&&F instanceof XMLHttpRequest)K=F;else if("function"==typeof XMLHttpRequest&&F&&F.request instanceof XMLHttpRequest){var Q=F;K={response:W(W({},null===(G=null==Q?void 0:Q.request)||void 0===G?void 0:G.response),{headers:null===(z=Q.response)||void 0===z?void 0:z.headers}),status:Q.request.status,statusText:Q.request.statusText,readyState:Q.request.readyState}}else F.status||F.statusCode||F.response?K={response:F.response,status:[void 0,null,""].indexOf(F.status)>-1?F.statusCode:F.status,statusText:F.statusText,readyState:F.readyState}:(J.info("Local http stack error"),K={response:$.default.CALL_END_SUB_CODE.LOCAL_HTTP_STACK_ERROR,status:$.default.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,statusText:"LocalHTTPStackError",readyState:F.readyState||0});se.isBrowserOffline()&&0===K.status&&4===K.readyState&&(J.info("offline"),K={response:$.default.HTTP_STACK_ERROR.CANNOT_CONNECT,status:$.default.HTTP_STATUS_CODES.OFFLINE,statusText:"offline",readyState:K.readyState}),F.response&&F.response.message&&(F.response.message.operationFailure||F.response.message.broadcastOperationFailure)?K={response:F.response.message}:!F.response&&F.body&&F.body.operationFailure&&(K={response:F.body})}else J.info("no response"),K={response:$.default.HTTP_STACK_ERROR.NONE,status:$.default.HTTP_STATUS_CODES.OTHER,statusText:"Empty Response",readyState:0}}catch(F){J.info("Failed to handle error ".concat(F)),K={response:"",status:$.default.HTTP_STATUS_CODES.OTHER,statusText:"FailedToHandleError",readyState:0}}return K},this.hasPendingAttempts=function(){return se.pendingAttempts.some((function(F){return F.pending}))},this.getRequestFromStatus=function(F){return F&&F.request&&F.request.status||0},this.isBrowserOffline=function(){return navigator&&!1===navigator.onLine},this.logger=B.createChild("[".concat(this.causeId,"][Dispatcher]")),this.logger.info("created request, url=".concat(K)),!isNaN(this.settings.hedgeDelayMs)&&this.settings.hedgeDelayMs>=ee&&this.settings.hedgeDelayMs<=te&&(this.hedgeDelayMs=this.settings.hedgeDelayMs),!isNaN(this.settings.hedgeMaxParallelAttempts)&&this.settings.hedgeMaxParallelAttempts>=0&&this.settings.hedgeMaxParallelAttempts<=ne&&(this.hedgeMaxParallelAttempts=this.settings.hedgeMaxParallelAttempts),(isNaN(this.settings.perAttemptTimeoutMs)||this.settings.perAttemptTimeoutMs<=0)&&(this.settings.perAttemptTimeoutMs=15e3),(isNaN(this.settings.perRequestTimeoutMs)||this.settings.perRequestTimeoutMs<=0)&&(this.settings.perRequestTimeoutMs=45e3),(isNaN(this.settings.maxRequestAttempts)||this.settings.maxRequestAttempts<=0)&&(this.settings.maxRequestAttempts=4),(isNaN(this.settings.perRequestTimeoutWithHedgingMs)||this.settings.perRequestTimeoutWithHedgingMs<=0)&&(this.settings.perRequestTimeoutWithHedgingMs=45e3),(isNaN(this.settings.perAttemptTimeoutWithHedgingMs)||this.settings.perAttemptTimeoutWithHedgingMs<=0)&&(this.settings.perAttemptTimeoutWithHedgingMs=3e4)}return RequestDispatcher.prototype.sendRequest=function(){var F=this;this.stackError=$.default.HTTP_STACK_ERROR.NONE;var timeoutCallback=function(){F.stackError=$.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT,F.cancelAllAttempts($.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT)};return this.logger.info("send api called"),this.requestTimer=X.TimerFactory.build(timeoutCallback,J.REQUEST_TIMEOUT).start(this.settings.enableRequestHedging?this.settings.perRequestTimeoutWithHedgingMs:this.settings.perRequestTimeoutMs),new Promise((function(B,G){F.resolve=B,F.reject=G,F.scheduleNextRequest(!0)}))},RequestDispatcher.prototype.cancelRequest=function(){this.logger.info("cancelRequest"),this.stackError=$.default.HTTP_STACK_ERROR.REQUEST_ABORTED,this.cancelAllAttempts($.default.HTTP_STACK_ERROR.ATTEMPT_ABORTED)},RequestDispatcher.prototype.cancelOtherAttempts=function(F){this.pendingAttempts.splice(F-1,1),this.cancelAllAttempts($.default.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL)},RequestDispatcher.prototype.cancelAllAttempts=function(F){var B=this;this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.pendingAttempts.forEach((function(G){G.status=F,G.cancelDeferred.resolve(),B.stopAttemptTimeoutTimer(G)})),this.stopRequestTimer()},RequestDispatcher.prototype.getRequestMethod=function(F){switch(F){case 0:return this.dispatcher.getAsync.bind(this.dispatcher);case 1:return this.dispatcher.postAsync.bind(this.dispatcher);case 2:return this.dispatcher.putAsync.bind(this.dispatcher);case 3:return this.dispatcher.removeAsync.bind(this.dispatcher);default:return null}},RequestDispatcher.prototype.queueAttempt=function(F){return z(this,void 0,void 0,(function(){var B,G;return K(this,(function(W){switch(W.label){case 0:if(B=F&&this.isNotRetryable(F),this.logger.info("queueAttempt"),B||!this.canScheduleNextAttempt())return this.logger.info("unable to retry isNotRetryable ".concat(B," ").concat(JSON.stringify(F))),this.stopHedgeTimer(),this.stopRequestTimer(),this.hasPendingAttempts()||(this.settings.reportPreviousErrorsForTimeout&&F===$.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_TIMEOUT&&this.previousAttempt?this.reject(this.previousAttempt):this.reject(F)),[2];if(!this.isAuthFailedStatus(F))return[3,4];this.logger.info("auth failed"),this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.stopRequestTimer(),W.label=1;case 1:return W.trys.push([1,3,,4]),[4,this.authRequiredCallback()];case 2:return G=W.sent(),this.request=G,[3,4];case 3:return W.sent(),this.reject(F),[2];case 4:return this.previousAttempt=F,this.hedgeTimer?(this.logger.info("scheduleNextRequest ignored as there's already active hedge timer"),[2]):(this.scheduleNextRequest(!1),[2])}}))}))},RequestDispatcher.prototype.attempt=function(){var F=this;if(this.logger.info("attempt to send request"),this.stackError!==$.default.HTTP_STACK_ERROR.REQUEST_ABORTED&&!this.otherAttemptSuccessful){var B=(new Date).getTime();this.requestsSent++;var G=this.requestsSent,W=Z.defer();this.request.timeout=W.promise;var z={cancelDeferred:W,status:$.default.HTTP_STACK_ERROR.NONE,timeoutTimer:null,pending:!0},timeoutRequest=function(){z.status=$.default.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT,z.cancelDeferred.resolve()},K=X.TimerFactory.build(timeoutRequest,J.ATTEMPT_TIMEOUT).start(this.settings.enableRequestHedging?this.settings.perAttemptTimeoutWithHedgingMs:this.settings.perAttemptTimeoutMs);z.timeoutTimer=K,this.pendingAttempts.push(z),this.getRequestMethod(this.requestType)(this.url,this.request).then((function(W){if(F.logger.info("attempt successful, request response=".concat(Q.default.scrubDisplayNamesFromResponse(W)," status=").concat(F.getRequestFromStatus(W))),F.otherAttemptSuccessful)throw"Other attempt succesful";if(F.stackError===$.default.HTTP_STACK_ERROR.REQUEST_ABORTED)throw"Session disposed";if(!W)throw"Invalid response";z.pending=!1,F.otherAttemptSuccessful=!0,F.stopRequestTimer(),F.stopHedgeTimer(),F.stopAttemptTimeoutTimer(z),F.cancelOtherAttempts(G),F.resolve({success:!0,request:W.request,response:W.response,attempt:F.requestsSent,attemptStartTimestamp:B,attemptResponseTimestamp:(new Date).getTime()})})).catch((function(G){z.pending=!1,F.stopAttemptTimeoutTimer(z);var W=F.standardizeFailedRequest(G,z);F.logger.info("attempt failed, request: ".concat((0,Y.safeJsonStringify)(G)," status=").concat(W.status)),F.onRequestFailed({abandoned:F.otherAttemptSuccessful,success:!1,request:W,attempt:F.requestsSent,attemptStartTimestamp:B,attemptResponseTimestamp:(new Date).getTime()}),F.queueAttempt(W)}))}},RequestDispatcher.prototype.getNextDelay=function(F){var B;if(F)B=0;else if(this.settings.enableRequestHedging)B=this.hedgeDelayMs;else{if(!(this.requestsSent<=this.settings.retryIntervalsMs.length))throw"Unable to get next delay";B=this.settings.retryIntervalsMs[this.requestsSent-1]}return this.logger.info("next delay= ".concat(B," ms")),B},RequestDispatcher.prototype.isRequestWithStatus=function(F,B){return!!F&&B.indexOf(F.status)>-1},RequestDispatcher.prototype.isNotRetryable=function(F){return!Z.isRetryable(F&&F.status)},RequestDispatcher.prototype.isAuthFailedStatus=function(F){return this.isRequestWithStatus(F,[$.default.HTTP_STATUS_CODES.UNAUTHORIZED])},RequestDispatcher}();B.RequestDispatcher=oe},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(14),z=G(231),K=G(232),J=G(233),Q=G(25),Y=G(5),$=G(3),X=function(){function MediaRenegotiationManager(F,B,G){var K=this;this.telemetryHelper=G,this.vbssInitiated=!1,this.disposed=!1,this.fsmState=Y.default.MEDIA_RENEGOTIATION_FSM_STATE.IDLE,this.fsmStateCauseId="",this.links={},this.renegotiationOffersSeenSoFar=[],this.isOutgoingRenegotiationInProgress=function(){return K.fsmState===Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION||K.fsmState===Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.isIncomingRenegotiationInProgress=function(){return K.fsmState===Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION||K.fsmState===Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.acceptRenegotiationAsync=function(F,B,G){K.logger.info("[".concat(G,"][acceptRenegotiationAsync][mediaTypes=").concat(B,"]")),K.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.ACCEPT_RENEGOTIATION,{mediaTypes:B,causeId:G}),$.assertNotNullOrEmpty(K.links[Y.default.LINKS.MEDIA_ANSWER],"MediaAnswer link not set");var z=$.defer();switch(K.fsmState){case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,G);break;case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,G);break;default:return K.logger.info("[".concat(G,"][acceptRenegotiationAsync]there is no incoming media renegotiation offer to accept")),z.reject(new Error("there is no incoming media renegotiation offer to accept")),z.promise}var onceTrouterReady=function(){K.signalingSession.timeoutManager.startTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT,K.handleMediaAnswerAcknowledgmentTimeout.bind(K,G),Y.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT)};return K.signalingSession.http.sendPostRequest({url:K.links[Y.default.LINKS.MEDIA_ANSWER],payload:J.getPayload(K.signalingSession,F,B),requestName:Q.NETWORK_REQUESTS.SEND_MEDIA_ANSWER.name,onceTrouterReady:onceTrouterReady,causeId:G}).then((function(F){z.resolve(F.response)})).catch((function(F){var B=$.getErrorForXHRFailure(F,K.signalingSession.signalingAgentConfig);K.logger.info("[".concat(G,"][acceptRenegotiationAsync] error: ").concat((0,W.getPrintableObject)(B))),K.disposed||K.signalingSession.timeoutManager.stopTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),z.reject(new Error("acceptRenegotiationAsync failed because : ".concat((0,W.getPrintableObject)(F))))})),z.promise},this.startRenegotiationAsync=function(F,B,G,J){K.logger.info("[".concat(J,"][startRenegotiationAsync][mediaTypes=").concat(G,"]")),K.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.START_RENEGOTIATION,{causeId:J,mediaTypes:G}),$.assertNotNullOrEmpty(B,"MediaRenegotiation link not set");var X=$.defer();switch(K.fsmState){case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,J);break;case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return K.logger.info("[".concat(J,"][startRenegotiationAsync][failed] can only be performed with no current outstanding renegotiations, previous negotiation causeId=").concat(K.fsmStateCauseId)),K.signalingSessionCallback.onMediaRenegotiationRejection(K.getGlareError(),J),Promise.resolve(null);default:return K.logger.info("[".concat(J,"][startRenegotiationAsync][failed] can only be performed on an established call")),X.reject(new Error("media renegotiation can only be performed on an established call")),X.promise}var Z=G&&$.arrayContains(G,Y.default.MEDIA_TYPES.SCREEN_SHARER);Z?(K.vbssInitiated=!0,K.signalingSession.telemetryHelper.addVbssOperations(Q.default.VBSS_OPERATION.START)):!Z&&K.vbssInitiated&&(K.vbssInitiated=!1,K.signalingSession.telemetryHelper.addVbssOperations(Q.default.VBSS_OPERATION.STOP));var onceTrouterReady=function(){K.signalingSession.timeoutManager.startTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER,K.handleMediaAnswerTimeout.bind(K),Y.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_TIMEOUT)};return K.signalingSession.http.sendPostRequest({url:B,payload:z.getPayload(K.signalingSession,F,G),requestName:Q.NETWORK_REQUESTS.START_RENEGOTIATION.name,onceTrouterReady:onceTrouterReady,causeId:J}).then((function(F){X.resolve(F.response)})).catch((function(F){var B=$.getErrorForXHRFailure(F,K.signalingSession.signalingAgentConfig);if(K.logger.info("[".concat(J,"][startRenegotiationAsync] error: ").concat((0,W.getPrintableObject)(B))),!K.disposed){switch(K.fsmState){case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,J);break;case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,J)}K.signalingSession.timeoutManager.stopTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER)}X.reject(new Error("startRenegotiationAsync failed because : ".concat((0,W.getPrintableObject)(F))))})),X.promise},this.handleMediaAcknowledgment=function(F,B){K.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT,{causeId:B}),K.signalingSession.timeoutManager.stopTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),K.signalingSession.saveMediaControllerLinksIfAny(F),K.signalingSession.saveUpdatedCallLinksIfAny(F),K.signalingSessionCallback.onMediaAcknowledgementSuccess(!0,B)},this.onCallConnected=function(F){K.logger.info("onCallConnected"),K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,F)},this.handleMediaNegotiationFailure=function(F){var B=$.extractCauseIdFromMessage(F);K.signalingSession.telemetryHelper.recordIncomingEvent(Q.EVENTS.HANDLE_MEDIA_NEGOTIATION_FAILURE,F),K.handleMediaNegotiationFailureInternal(F.body.mediaNegotiationFailure,F.origin,B)},this.handleMediaAnswer=function(F,B){switch(K.logger.info("[".concat(B,"][handleMediaAnswer]")),K.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.HANDLE_MEDIA_ANSWER,{causeId:B}),K.fsmState){case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,B);break;case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,B);break;default:return}K.signalingSession.timeoutManager.stopTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER);var G=[];F.mediaAnswer.callModalities&&F.mediaAnswer.callModalities.length>0&&(G=$.getMediaTypes(F.mediaAnswer.callModalities),K.signalingSession.telemetryHelper.addIncomingModalities(G));var z={provisional:!1,renegotiation:!0,mediaTypes:G,remoteParticipantId:K.signalingSession.getParticipantIdForOfferAnswer(F.mediaAnswer.mediaContent),mediaContent:F.mediaAnswer.mediaContent};K.signalingSession.http.sendPostRequest({url:F.mediaAnswer.links.mediaAcknowledgement,payload:null,requestName:Q.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT.name,causeId:B}).catch((function(F){var G=$.getErrorForXHRFailure(F,K.signalingSession.signalingAgentConfig);K.logger.info("[".concat(B,"][handleMediaAnswer] error: ").concat((0,W.getPrintableObject)(G))),K.signalingSession.disposed||K.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.HANDLE_MEDIA_ANSWER_FAILED,{causeId:B})})),K.signalingSessionCallback.onAnswer(z,B)},this.handleMediaNegotiationOffer=function(F){var B=F.body,G=F.headers,W=$.extractCauseIdFromMessage(F);K.logger.info("[".concat(W,"][handleMediaNegotiationOffer]")),K.signalingSession.telemetryHelper.recordIncomingEvent(Q.EVENTS.HANDLE_MEDIA_OFFER,F);var z=$.isDuplicateMessage(G,K.renegotiationOffersSeenSoFar);switch(K.fsmState){case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,W),K.raiseMediaRenegotiationOffer(B,W);break;case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,W),K.raiseMediaRenegotiationOffer(B,W);break;case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:if(K.signalingSession&&K.signalingSession.signalingAgentConfig&&K.signalingSession.signalingAgentConfig.supportMediaRetargetWhileIncomingRenegotiation){K.raiseMediaRenegotiationOffer(B,W);break}K.rejectAndLog(W,z,B);break;default:K.rejectAndLog(W,z,B)}},this.rejectRenegotiationAsync=function(F,B){K.logger.info("[".concat(B,"][rejectRenegotiationAsync]")),K.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.REJECT_RENEGOTIATION,{rejectionData:F,causeId:B}),$.assertNotNullOrEmpty(K.links[Y.default.LINKS.MEDIA_REJECTION],"MediaRejection link not set");var G=F||{code:Y.default.CALL_END_CODE.NOT_ACCEPTABLE_HERE,subCode:Y.default.CALL_END_SUB_CODE.MEDIA_ANSWER_PROCESSING_ERROR,phrase:Y.default.CALL_END_PHRASE.MEDIA_ANSWER_ERROR};switch(K.fsmState){case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:return K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,B),K.rejectMediaRenegotiation(K.links[Y.default.LINKS.MEDIA_REJECTION],G,B);case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,B),K.rejectMediaRenegotiation(K.links[Y.default.LINKS.MEDIA_REJECTION],G,B);default:return K.logger.error("[".concat(B,"][rejectRenegotiationAsync][failed] There is no incoming media renegotiation offer to reject")),Promise.resolve(null)}},this.handleRetargetCompleted=function(F){var B=F.body.retargetCompleted,G=$.extractCauseIdFromMessage(F);K.logger.info("[".concat(G,"][handleRetargetCompleted][details=").concat((0,W.getPrintableObject)(B),"]")),K.signalingSession.telemetryHelper.recordIncomingEvent(Q.EVENTS.HANDLE_RETARGET_COMPLETED,F,(0,W.getPIISafeObject)(B)),0===B.code?K.signalingSessionCallback.onReTargetCompletedSuccess(G):K.signalingSessionCallback.onReTargetCompletedFailure(B,G)},this.dispose=function(){K.logger.info("mediaRenegotiationManager :: dispose"),K.disposed=!0},this.getGlareError=function(){return{code:Y.default.CALL_END_CODE.GLARE_ERROR,subCode:Y.default.CALL_END_SUB_CODE.MEDIA_GLARE_ERROR,phrase:Y.default.CALL_END_PHRASE.RENEGOTIATION_IN_PROGRESS,previousNegotiationCauseId:K.fsmStateCauseId}},this.handleMediaNegotiationFailureInternal=function(F,B,G){switch(K.logger.info("[".concat(G,"][handleMediaNegotiationFailureInternal][failureData=").concat((0,W.getPIISafeObject)(F),"]")),K.signalingSession.timeoutManager.stopTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),K.fsmState){case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,G);break;case Y.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:K.setFsmState(Y.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,G);break;default:return}K.vbssInitiated&&(K.vbssInitiated=!1,K.signalingSession.telemetryHelper.addVbssOperations(Q.default.VBSS_OPERATION.REJECTED)),K.signalingSession.telemetryHelper.addIncomingModalities(["Rejected"]),K.signalingSessionCallback.onMediaRenegotiationRejection({code:F.code,subCode:F.subCode,phrase:F.phrase},G)},this.signalingSession=F,this.signalingSessionCallback=B,this.logger=F.logger.createChild((function(){return"[RenegotiationManager][".concat(K.fsmState,"][stateCauseId=").concat(K.fsmStateCauseId,"]")}))}return MediaRenegotiationManager.prototype.rejectAndLog=function(F,B,G){this.logger.error("[".concat(F,"][handleMediaNegotiationOffer] Cannot handle the incoming mediaRenegotiation offer in present callstate. Either call not connected or renegotiation in progress. isDuplicateOffer=").concat(B)),B||this.rejectMediaRenegotiation(G.mediaNegotiation.links.rejection,this.getGlareError(),F)},MediaRenegotiationManager.prototype.setFsmState=function(F,B){this.fsmState=F,this.fsmStateCauseId=B,this.logger.info("[setFsmState]state=".concat(F)),this.telemetryHelper.recordEvent(Q.EVENTS.MEDIA_FSM_STATE_CHANGED,{state:F,causeId:B})},MediaRenegotiationManager.prototype.raiseMediaRenegotiationOffer=function(F,B){this.logger.info("[".concat(B,"][raiseMediaRenegotiationOffer]")),this.links[Y.default.LINKS.MEDIA_ANSWER]=F.mediaNegotiation.links.mediaAnswer,this.links[Y.default.LINKS.MEDIA_REJECTION]=F.mediaNegotiation.links.rejection;var G=[];F.mediaNegotiation.callModalities&&F.mediaNegotiation.callModalities.length>0&&(G=$.getMediaTypes(F.mediaNegotiation.callModalities),this.signalingSession.telemetryHelper.addIncomingModalities(G),$.arrayContains(G,Y.default.MEDIA_TYPES.SCREEN_SHARER)&&this.signalingSession.telemetryHelper.addVbssOperations(Q.default.VBSS_OPERATION.REMOTE_START));var W={mediaTypes:G,remoteParticipantId:this.signalingSession.getParticipantIdForOfferAnswer(F.mediaNegotiation.mediaContent),mediaContent:F.mediaNegotiation.mediaContent,renegotiation:!0};this.signalingSessionCallback.onOffer(W,B)},MediaRenegotiationManager.prototype.rejectMediaRenegotiation=function(F,B,G){var z=this;this.logger.info("[".concat(G,"][rejectMediaRenegotiation][rejectionData=").concat((0,W.getPIISafeObject)(B),"]"));var J=$.defer();return this.signalingSession.http.sendPostRequest({url:F,payload:K.getPayload(this.signalingSession,B),requestName:Q.NETWORK_REQUESTS.SEND_MEDIA_REJECTION.name,causeId:G}).then((function(F){J.resolve(F.response)})).catch((function(F){var B=$.getErrorForXHRFailure(F,z.signalingSession.signalingAgentConfig);z.logger.info("[".concat(G,"][rejectMediaRenegotiation] error: ").concat((0,W.getPrintableObject)(B))),J.reject(new Error("rejectMediaRenegotiation failed because : ".concat((0,W.getPrintableObject)(F))))})),J.promise},MediaRenegotiationManager.prototype.handleMediaAnswerTimeout=function(F){this.logger.info("[".concat(F,"][handleMediaAnswerTimeout]")),this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(Q.default.VBSS_OPERATION.TIMEOUT)),this.signalingSession.telemetryHelper.addIncomingModalities(["Timeout"]),this.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.HANDLE_MEDIA_ANSWER_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),this.handleMediaNegotiationFailureInternal({code:Y.default.CALL_END_CODE.TIMEOUT,subCode:Y.default.CALL_END_SUB_CODE.MEDIA_FINAL_ANSWER_TIMEOUT,phrase:Y.default.CALL_END_PHRASE.MEDIA_FINAL_ANSWER_TIMEOUT},Q.default.EVENT_SOURCE.LOCAL,F)},MediaRenegotiationManager.prototype.handleMediaAnswerAcknowledgmentTimeout=function(F){this.logger.info("[".concat(F,"][handleMediaAnswerAcknowledgmentTimeout]")),this.signalingSession.telemetryHelper.recordEvent(Q.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(Y.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT);var B={reason:"timed out waiting for Media Answer Acknowledgement"};this.signalingSessionCallback.onMediaAcknowledgementFailure(!0,B,F)},MediaRenegotiationManager}();B.default=X},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){K.assertNotNull(F,"signalingSession cannot be null");var J=[];G&&(J=K.getMediaTypes(G),F.telemetryHelper.addOutgoingModalities(J));var Q=K.causeId();return{payload:{mediaNegotiation:{callModalities:J,sender:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},links:{mediaAnswer:z.get(F,W.URL_PATH.MEDIA_ANSWER,Q),rejection:z.get(F,W.URL_PATH.MEDIA_REJECTION,Q)},mediaContent:B}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B){return W.assertNotNull(F,"signalingSession cannot be null"),W.assertCallEndReason(B),{payload:{mediaNegotiationFailure:{sender:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},code:B.code,subCode:B.subCode,phrase:B.phrase},debugContent:{callId:F.correlationId,endpointId:F.participantManager.localParticipant.endpointId}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){K.assertNotNull(F,"signalingSession cannot be null");var J=[];return G&&(J=K.getMediaTypes(G),F.telemetryHelper.addOutgoingModalities(J)),{payload:{mediaAnswer:{callModalities:J,sender:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},links:{mediaAcknowledgement:z.get(F,W.URL_PATH.MEDIA_ACKNOWLEDGEMENT)},clientContentForMediaController:F.webRtcSignalingManager.getClientUrls(),mediaContent:B},debugContent:{callId:F.correlationId,endpointId:F.participantManager.localParticipant.endpointId}}}}B.getPayload=getPayload},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var K=G(8),J=G(14),Q=G(235),Y=G(108),$=G(236),X=G(237),Z=G(238),ee=G(239),te=G(240),ne=G(241),ie=G(242),re=G(243),oe=G(244),ae=G(245),se=G(246),ce=G(247),le=G(248),de=G(25),ue=G(5),pe=G(3),he=function(){function ParticipantManager(F,B,G){var K=this;this.connectedRemoteParticipantIds={},this.disposed=!1,this.unmuteApprovalLinks={},this.setLocalParticipantId=function(F,B){F&&(K.logger.info("[".concat(B,"][setLocalParticipantId][participantId=").concat(F,"]")),K.localParticipant.participantId=F)},this.admitParticipantAsync=function(F,B,G){var W="[".concat(G,"][admitParticipantAsync]");K.logger.info("".concat(W).concat(K.piiUtils.scrubMriOrOmit(F.id)));var z=pe.defer();return K.participantOperationHandler.hasPendingOperation(1,F.id,G)?(K.logger.info("".concat(W,"there is an existing pending request to admit the participant ").concat(K.piiUtils.scrubMriOrOmit(F.id))),z.reject(new Error("there is an existing pending request to admit the participant"))):(K.participantOperationHandler.setPendingOperation(1,F.id,{participant:F,promise:z,causeId:G},G),K.sendNetworkRequestForAdmittingParticipant(F,B,G)),z.promise},this.addParticipantsAsync=function(F,B,G,W,z){var J="[".concat(z,"][addParticipantsAsync]"),Q=F.map((function(F){return K.piiUtils.scrubMriOrOmit(F.id)}));K.logger.info("".concat(J," remoteParticipantsIds: ").concat(Q));var Y=[],$=[];return F.forEach((function(F){var B=pe.defer(),G=3===W.replacementType?F.participantId:F.id;K.connectedRemoteParticipantIds.hasOwnProperty(F.id)?(K.logger.info("".concat(J,"the given participant is already connected to the call ").concat(K.piiUtils.scrubMriOrOmit(F.id))),B.reject(new Error("the given participant is already connected to the call"))):K.participantOperationHandler.hasPendingOperation(0,G,z)?(K.logger.info("".concat(J,"there is an existing pending request to add the participant ").concat(K.piiUtils.scrubMriOrOmit(F.id))),B.reject(new Error("there is an existing pending request to add the participant"))):(F.participantId||(F.participantId=pe.newGuid(),K.logger.info("participantId created ".concat(F.participantId))),K.participantOperationHandler.setPendingOperation(0,G,{participant:F,promise:B,causeId:z},z),Y.push(F)),$.push(B.promise)})),G&&K.sendNetworkRequestForAddingParticipant(Y,B,W,z),$},this.nudgeParticipantsAsync=function(F,B,G,W,z,J,Q,Y){return K.logger.info("[".concat(W,"][nudgeParticipantAsync] ").concat(K.piiUtils.scrubParticipantsList(F))),G?K.sendNetworkRequestForNudgingParticipants(F,B,W,z,J,Q,Y):Promise.reject("[".concat(W,"][nudgeParticipantAsync] Call not started"))},this.updateMeetingRolesAsync=function(F,B,G,z){void 0===z&&(z=pe.causeId());var Q=pe.defer();if(!F||F.length<1){var Y="[".concat(z,"][updateMeetingRolesAsync] participantsInfo cannot be empty or null");(X=new Error(Y)).endCode={code:ue.default.CALL_END_CODE.REJECT,subCode:ue.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:Y},K.logger.info(Y),Q.reject(X)}else if(B)if(G){var $;"attendee"===B?$=de.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_ATTENDEE.name:"presenter"===B?$=de.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_PRESENTER.name:"organizer"===B?$=de.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_ORGANIZER.name:Q.reject(new Error("[".concat(z,"] Invalid meetingRole value(").concat(B,")"))),K.logger.info("[".concat(z,"][updateMeetingRolesAsync][meetingRole=").concat(B,"]")),K.signalingSession.ensureMessageChannelReady($).then((function(){K.sendNetworkRequestForUpdatingMeetingRoles(F,B,G,$,z,Q)})).catch((function(F){var B=(0,J.getPrintableObject)(F);K.logger.info("[".concat(z,"][updateMeetingRolesAsync][failed][reason=").concat(B,"]"));var G=pe.getErrorForXHRFailure(F,K.signalingSession.signalingAgentConfig),Y=W({},G.error);Q.reject(Y)}))}else{Y="[".concat(z,"][updateMeetingRolesAsync] updateMeetingRoleUrl cannot be empty or null");(X=new Error(Y)).endCode={code:ue.default.CALL_END_CODE.REJECT,subCode:ue.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:Y},K.logger.info(Y),Q.reject(X)}else{var X,Y="[".concat(z,"][updateMeetingRolesAsync] meetingRole cannot be empty or null");(X=new Error(Y)).endCode={code:ue.default.CALL_END_CODE.REJECT,subCode:ue.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:Y},K.logger.info(Y),Q.reject(X)}return Q.promise},this.updateParticipantInterpretationStateAsync=function(F,B,G){var W="[".concat(G,"][updateParticipantInterpretationStateAsync]"),z=F.map((function(F){return K.piiUtils.scrubMriOrOmit(F.id)}));K.logger.info("".concat(W," remoteParticipantsIds: ").concat(z));var J=[],Q=[];return F.forEach((function(F){var B=pe.defer();K.participantOperationHandler.hasPendingOperation(5,F.id,G)?(K.logger.info("".concat(W,"there is an existing pending request to update the participant ").concat(K.piiUtils.scrubMriOrOmit(F.id))),B.reject(new Error("there is an existing pending request to update the participant"))):(K.participantOperationHandler.setPendingOperation(5,F.id,{option:F,promise:B,causeId:G},G),J.push(F)),Q.push(B.promise)})),K.sendNetworkRequestToUpdateParticipantInterpretationState(J,B,F,G),Q},this.callMeBackAsync=function(F,B,G){K.logger.info("[".concat(G,"][callMeBackAsync] ").concat(K.piiUtils.scrubMriOrOmit(F.id)));var W=pe.defer();return K.connectedRemoteParticipantIds.hasOwnProperty(F.id)?(K.logger.info("the given participant is already connected to the call : ".concat(K.piiUtils.scrubMriOrOmit(F.id))),W.reject(new Error("the given participant is already connected to the call"))):K.participantOperationHandler.hasPendingOperation(2,F.id,G)?(K.logger.info("there is an existing pending request to call back the participant : ".concat(K.piiUtils.scrubMriOrOmit(F.id))),W.reject(new Error("there is an existing pending request to call back the participant"))):(K.participantOperationHandler.setPendingOperation(2,F.id,{participant:F,promise:W},G),K.sendNetworkRequestForCallMeBack(F,B,G)),W.promise},this.isRosterStale=function(F,B){return K.rosterManager.isRosterStale(F,B)},this.removeParticipantAsync=function(F,B,G){K.logger.info("[".concat(G,"][removeParticipantAsync] ").concat(K.piiUtils.scrubMriOrOmit(F.id))),pe.assertNotNullOrEmpty(B,"correct removeParticipantUrl is not provided");var W=pe.defer();if(K.participantOperationHandler.hasPendingOperation(3,F.id,G))K.logger.info("there is an existing pending request to remove the participant ".concat(K.piiUtils.scrubMriOrOmit(F.id))),W.reject(new Error("there is an existing pending request to remove the participant"));else{K.participantOperationHandler.setPendingOperation(3,F.id,{participant:F,promise:W},G);var onceTrouterReady=function(){K.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,(function(){K.signalingSession.telemetryHelper.recordEvent(de.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),K.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,F.id),K.participantOperationHandler.rejectPendingOperation(3,F.id,"timed out waiting for participant to not show up in roster",{code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},G)}),ue.default.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT,F.id)};K.signalingSession.http.sendPostRequest({url:B,payload:oe.getPayload(K.signalingSession,F),requestName:de.NETWORK_REQUESTS.REMOVE_PARTICIPANT_NONE.name,onceTrouterReady:onceTrouterReady,causeId:G}).catch((function(B){var W=pe.getErrorForXHRFailure(B,K.signalingSession.signalingAgentConfig);K.logger.info("[".concat(G,"][removeParticipantAsync][failed][reason=").concat((0,J.getPrintableObject)(W),"]")),K.disposed||(K.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,F.id),K.participantOperationHandler.rejectPendingOperation(3,F.id,B,W.error,G))}))}return W.promise},this.removeParticipantEndpointAsync=function(F,B,G,W){K.logger.info("[".concat(W,"][removeParticipantEndpointAsync] ").concat((0,J.truncate)(F.endpointId,8)," [endPointScope] ").concat(G)),pe.assertNotNullOrEmpty(B,"correct removeParticipantUrl is not provided");var z=pe.defer(),Q="";switch(G){case"all":Q=de.NETWORK_REQUESTS.REMOVE_PARTICIPANT_OTHERS.name;break;case"specified":Q=de.NETWORK_REQUESTS.REMOVE_PARTICIPANT_SPECIFIED.name;break;default:return Promise.reject("invalid scope ".concat(G," removeParticipantEndpointAsync"))}K.participantOperationHandler.setPendingOperation(4,F.endpointId,{participant:F,promise:z,scope:G},W);var onceTrouterReady=function(){K.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,(function(){K.signalingSession&&!K.signalingSession.disposed&&(K.signalingSession.telemetryHelper.recordEvent(de.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),K.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,F.endpointId),K.participantOperationHandler.rejectPendingOperation(4,F.endpointId,"timed out waiting for participant endpoint sync response from service",{code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},W))}),ue.default.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT,F.endpointId)};return K.signalingSession.http.sendPostRequest({url:B,payload:re.getPayload(K.signalingSession,F,G),requestName:Q,onceTrouterReady:onceTrouterReady,causeId:W}).then((function(F){if(F.response&&F.response.code)if(-1!==[ue.default.HTTP_STATUS_CODES.OK,ue.default.HTTP_STATUS_CODES.CREATED].indexOf(F.response.code))K.logger.info("[".concat(W,"][removeParticipantEndpointAsync][endPointScope] ").concat(G," [passed][reason=").concat((0,J.getPrintableObject)(F.response),"]")),z.resolve(F.response);else{var B=new Error("invalid service response for removeParticipantEndpoint");B.endCode={code:F.response.code,subCode:F.response.subcode,phrase:F.response.reason},K.logger.info("[".concat(W,"][removeParticipantEndpointAsync][endPointScope] ").concat(G," [failed][reason=").concat((0,J.getPrintableObject)(F.response),"]")),z.reject(B)}z.resolve()})).catch((function(B){var z=pe.getErrorForXHRFailure(B,K.signalingSession.signalingAgentConfig);K.logger.info("[".concat(W,"][removeParticipantEndpointAsync][endPointScope] ").concat(G," [failed][reason=").concat((0,J.getPrintableObject)(z),"]")),K.disposed||(K.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,F.endpointId),K.participantOperationHandler.rejectPendingOperation(4,F.endpointId,(0,J.getPrintableObject)(B),z.error,W))})),z.promise},this.getParticipantsToInitiateCallWith=function(){var F,B;K.logger.info("getParticipantsToInitiateCallWith");var G=[],W=K.participantOperationHandler.getAllPendingOperations(0,pe.causeId());try{for(var J=z(Object.keys(W)),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;W.hasOwnProperty(Y)&&W[Y]&&G.push(W[Y].participant)}}catch(B){F={error:B}}finally{try{Q&&!Q.done&&(B=J.return)&&B.call(J)}finally{if(F)throw F.error}}return G},this.initializeForIncomingCall=function(F){K.logger.info("initializeForIncomingCall"),K.participantOperationHandler.dispose("incoming calls cannot add/remove participants until call is connected",null,pe.causeId())},this.handleAddParticipantSuccess=function(F){var B=F.body,G=pe.extractCauseIdFromMessage(F);K.logger.info("[".concat(G,"][handleAddParticipantSuccess(").concat(B.participantInfos?"new format":"old format",")]").concat((0,J.getPrintableObject)(B),"]")),K.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS,F),K.internalHandleCallMeBackSuccess(B,G)||K.signalingSession.telemetryHelper.recordEvent(de.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS)},this.handleAddParticipantFailure=function(F){var B=F.body,G=pe.extractCauseIdFromMessage(F);K.logger.info("[".concat(G,"][handleAddParticipantFailure(").concat(B.participantInfos?"new format":"old format",")][").concat((0,J.getPrintableObject)(B),"]")),B.modalityFailure?(K.logger.info("[".concat(G,"][handleAddParticipantFailure][modalityFailure=").concat((0,J.getPrintableObject)(B),"]")),K.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE,F)):K.internalHandleAddParticipantFailure(F,G)},this.handleAdmitParticipantSuccess=function(F){var B=F.body,G=pe.extractCauseIdFromMessage(F);K.logger.info("[".concat(G,"][handleAdmitParticipantSuccess][").concat((0,J.getPrintableObject)(B),"]")),K.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_ADMIT_PARTICIPANT_SUCCESS,F),B.participants&&K.internalHandleAdmitParticipantSuccess(F,G)},this.handleAdmitParticipantFailure=function(F){var B=F.body,G=pe.extractCauseIdFromMessage(F);K.logger.info("[".concat(G,"][handleAdmitParticipantFailure][").concat((0,J.getPrintableObject)(B),"]")),B.participants&&K.internalHandleAdmitParticipantFailure(F,G)},this.handleRemoveParticipantFailure=function(F){var B,G,W=F.body,Q=pe.extractCauseIdFromMessage(F);K.logger.info("[".concat(Q,"][handleRemoveParticipantFailure][").concat((0,J.getPrintableObject)(W),"]")),K.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_REMOVE_PARTICIPANT_FAILURE,F);try{for(var Y=z(Object.keys(W.participants)),$=Y.next();!$.done;$=Y.next()){var X=$.value;W.participants.hasOwnProperty(X)&&K.internalHandleRemoveParticipantFailure(X,W.participants[X],Q)}}catch(F){B={error:F}}finally{try{$&&!$.done&&(G=Y.return)&&G.call(Y)}finally{if(B)throw B.error}}},this.handleRemoveParticipantSuccess=function(F){var B=F.body,G=pe.extractCauseIdFromMessage(F);K.logger.info("[".concat(G,"][handleRemoveParticipantSuccess][").concat((0,J.getPrintableObject)(B),"]")),K.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_REMOVE_PARTICIPANT_SUCCESS,F)},this.handleUnmuteConfirmRequest=function(F){var B=F.body,G=pe.extractCauseIdFromMessage(F);K.logger.info("[".concat(G,"][handleUnmuteConfirmRequest][").concat((0,J.getPrintableObject)(B),"]")),K.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_UNMUTE_CONFIRM,F),K.unmuteApprovalLinks[B.from.id]={approve:B.links.approveUnmute,reject:B.links.rejectUnmute},K.signalingSessionCallback.onUnmuteRequested(B.from.id,G)},this.approveUnmuteRequestAsync=function(F,B){K.logger.info("[".concat(B,"][approveUnmuteRequestAsync]"));var G=pe.defer();return K.unmuteApprovalLinks.hasOwnProperty(F)?(K.signalingSession.ensureMessageChannelReady(de.NETWORK_REQUESTS.APPROVE_UNMUTE.name).then((function(){K.muteUnmute(de.NETWORK_REQUESTS.APPROVE_UNMUTE.name,Z.getPayload(K.signalingSession),G,K.unmuteApprovalLinks[F].approve,B)})).catch((function(F){var W=(0,J.getPrintableObject)(F);K.logger.info("[".concat(B,"][approveUnmuteRequestAsync][failed][reason=").concat(W,"]")),G.reject(new Error(F))})),G.promise):(G.reject(new Error("no unmute links found for given participant")),G.promise)},this.rejectUnmuteRequestAsync=function(F,B,G){K.logger.info("[".concat(B,"][rejectUnmuteRequestAsync]"));var W=pe.defer();if(!K.unmuteApprovalLinks.hasOwnProperty(F))return W.reject(new Error("no unmute links found for given participant")),W.promise;var z=G||{code:ue.default.CALL_END_CODE.REJECT,subCode:ue.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_REJECTED,phrase:ue.default.CALL_END_PHRASE.UNMUTE_REQUEST_REJECTED};return K.signalingSession.ensureMessageChannelReady(de.NETWORK_REQUESTS.REJECT_UNMUTE.name).then((function(){K.muteUnmute(de.NETWORK_REQUESTS.REJECT_UNMUTE.name,ie.getPayload(K.signalingSession,z),W,K.unmuteApprovalLinks[F].reject,B)})).catch((function(F){var G=(0,J.getPrintableObject)(F);K.logger.info("[".concat(B,"][rejectUnmuteRequestAsync][failed][reason=").concat(G,"]")),W.reject(new Error(F))})),W.promise},this.handleRosterUpdate=function(F,B,G){var W=K.getCurrentParticipantsInCallModality(!1);K.rosterManager.handleRosterUpdate(F,W,B,G)},this.updateLocalParticipantFromSubscribe=function(F,B){K.localParticipant.fromRoster||K.rosterManager.updateLocalParticipantFromSubscribe(F,B)},this.muteAsync=function(F,B,G,W){K.logger.info("[".concat(W,"][muteAsync][muteScope=").concat(B,"]"));var z="specified",Q=[],Y=de.NETWORK_REQUESTS.MUTE_SPECIFIED;switch(B){case ue.default.MUTE_SCOPE.MYSELF:Y=de.NETWORK_REQUESTS.MUTE_MYSELF,Q.push({id:K.localParticipant.id});break;case ue.default.MUTE_SCOPE.EVERYONE_ELSE:Y=K.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?de.NETWORK_REQUESTS.MUTE_ALL_SYNC:de.NETWORK_REQUESTS.MUTE_ALL,z="all",G.forEach((function(F){Q.push({id:F})}));break;case ue.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS:pe.assertNotNullOrEmpty(G,"[".concat(W,"]array of participantIds must be specified for SPECIFIED_PARTICIPANTS mute scope")),Y=K.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?de.NETWORK_REQUESTS.MUTE_SPECIFIED_SYNC:de.NETWORK_REQUESTS.MUTE_SPECIFIED,G.forEach((function(F){Q.push({id:F})}));break;default:pe.assert(!1,"[".concat(W,"]muteScope is a required param. please pass in a valid value."))}var $=pe.defer();if(B===ue.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS){var X=K.areParticipantsConnectedToCall(G);if(!X.result)return $.reject(new Error("[".concat(W,"]specified participant is not connected to call yet. Id = ").concat(X.participant))),$.promise}return K.signalingSession.ensureMessageChannelReady(Y.name).then((function(){K.muteUnmute(Y.name,ee.getPayload(K.signalingSession,z,Q),$,F,W)})).catch((function(F){var B=(0,J.getPrintableObject)(F),G=pe.getErrorForXHRFailure(F,K.signalingSession.signalingAgentConfig);K.logger.info("[".concat(W,"][muteAsync][failed][reason=").concat(B,"]")),$.reject(G)})),$.promise},this.unmuteAsync=function(F,B){K.logger.info("[".concat(B,"][unmuteAsync]"));var G=pe.defer();return K.signalingSession.ensureMessageChannelReady(de.NETWORK_REQUESTS.UNMUTE.name).then((function(){K.muteUnmute(K.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?de.NETWORK_REQUESTS.UNMUTE_SYNC.name:de.NETWORK_REQUESTS.UNMUTE.name,ae.getPayload(K.signalingSession),G,F,B,!0)})).catch((function(F){var W=(0,J.getPrintableObject)(F);K.logger.info("[".concat(B,"][unmuteAsync][failed][reason=").concat(W,"]")),G.reject(new Error(F))})),G.promise},this.dispose=function(F,B){K.logger.info("[".concat(B,"][dispose]")),K.disposed=!0,K.participantOperationHandler.dispose("call ended",F,B),K.signalingSession.telemetryHelper.setParticipantId(K.localParticipant.participantId)},this.internalHandleCallMeBackSuccess=function(F,B){var G,W,J,Q,Y=!1;if(F&&F.participantInfos){var $=F.participantInfos;try{for(var X=z($),Z=X.next();!Z.done;Z=X.next()){var ee=Z.value.id;K.internalHandleCallMeBackSuccessHelper(ee,B)&&(Y=!0)}}catch(F){G={error:F}}finally{try{Z&&!Z.done&&(W=X.return)&&W.call(X)}finally{if(G)throw G.error}}}else if(F&&F.participants)try{for(var te=z(F.participants),ne=te.next();!ne.done;ne=te.next()){ee=ne.value;K.internalHandleCallMeBackSuccessHelper(ee,B)&&(Y=!0)}}catch(F){J={error:F}}finally{try{ne&&!ne.done&&(Q=te.return)&&Q.call(te)}finally{if(J)throw J.error}}return Y},this.signalingSession=F,this.signalingSessionCallback=B,this.localParticipant=G,this.localParticipant.endpointId||(this.localParticipant.endpointId=this.signalingSession.getEndpointId());var Y=(0,J.truncate)(this.localParticipant.endpointId,8);this.logger=F.logger.createChild((function(){return"[PM][".concat(Y,"]")})),this.piiUtils=F.piiUtils,this.participantOperationHandler=new Q.default(F.logger.createChild((function(){return"[ParticipantOperationHandler][".concat(Y,"]")}))),this.rosterManager=new le.default(this,F.logger.createChild((function(){return"[RosterManager][".concat(Y,"]")}))),this.localParticipant.participantId||(this.localParticipant.participantId=pe.newGuid()),"string"==typeof F.signalingAgentConfig.languageCode?this.localParticipant.languageId=F.signalingAgentConfig.languageCode:"function"==typeof F.signalingAgentConfig.languageCode&&(this.localParticipant.languageId=F.signalingAgentConfig.languageCode()),F.telemetryHelper.setEndPointId(this.localParticipant.endpointId)}return ParticipantManager.prototype.handleUpdateParticipantInterpretationStateCompletion=function(F){var B,G,W=F.body,K=pe.extractCauseIdFromMessage(F),Q=W.operationId;if(this.disposed)this.logger.info("[".concat(K,"][handleUpdateParticipantInterpretationStateCompletion] ignored. Call disposed."));else{Q||this.logger.warn("[".concat(K,"][handleUpdateParticipantInterpretationStateCompletion] operationId is undefined.")),this.logger.info("[".concat(K,"][handleUpdateParticipantInterpretationStateCompletion] starts"));var Y=F.body;if(Y.participantInfos)try{for(var $=z(Y.participantInfos),X=$.next();!X.done;X=$.next()){var Z=X.value;if(this.logger.info(Z),this.participantOperationHandler.hasPendingOperation(5,Z.participant.id,K))if(this.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,Z.participant.id),Z.transactionEnd.code===ue.default.TRANSACTION_END_CODE.SUCCESS)this.logger.info("[".concat(K,"]Update participant interpretation state succeeded for: ").concat(this.piiUtils.scrubMriOrOmit(Z.participant.id))),this.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_COMPLETED,F),this.participantOperationHandler.resolvePendingOperation(5,Z.participant.id,void 0,K);else{var ee=Z.transactionEnd.reason;this.logger.info("[".concat(K,"]Update participant interpretation state failed for: ").concat(this.piiUtils.scrubMriOrOmit(Z.participant.id)," reason : ").concat((0,J.getPrintableObject)(ee)));var te=this.getCallEndGivenParticipantFailure(ee);this.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_FAILED,F,te),this.participantOperationHandler.rejectPendingOperation(5,Z.participant.id,te.phrase,te,K)}}}catch(F){B={error:F}}finally{try{X&&!X.done&&(G=$.return)&&G.call($)}finally{if(B)throw B.error}}}},ParticipantManager.prototype.areParticipantsConnectedToCall=function(F){var B,G;this.logger.info("areParticipantsConnectedToCall : ".concat((0,J.getPrintableObject)(F)));var W=this.getCurrentParticipantsInCallModality(!0);try{for(var K=z(F),Q=K.next();!Q.done;Q=K.next()){var Y=Q.value;if(!W.hasOwnProperty(Y))return this.logger.info("areParticipantsConnectedToCall : returning false for :".concat(this.piiUtils.scrubMriOrOmit(Y))),{result:!1,participant:Y}}}catch(F){B={error:F}}finally{try{Q&&!Q.done&&(G=K.return)&&G.call(K)}finally{if(B)throw B.error}}return this.logger.info("areParticipantsConnectedToCall : returning true"),{result:!0}},ParticipantManager.prototype.processUnmuteInfo=function(F){var B=this;if(void 0!==F&&void 0!==F.muteUnmuteResponse){var G=F.muteUnmuteResponse[this.localParticipant.id];if(void 0!==G){var W=K.find(G,(function(F){return F.participantId===B.localParticipant.participantId}));void 0!==W&&("success"===W.reason?this.signalingSession.telemetryHelper.recordEvent(de.EVENTS.HANDLE_UNMUTE_SUCCESS,W.serverMuteVersion):this.signalingSession.telemetryHelper.recordEvent(de.EVENTS.HANDLE_UNMUTE_FAILURE,W.serverMuteVersion))}}},ParticipantManager.prototype.muteUnmute=function(F,B,G,W,z,K){var Q=this;pe.assert(2!==this.signalingSession.callMode,"mute/unmute operations are not allowed in streaming mode"),this.logger.info("[muteUnmute][".concat(z,"][operation=").concat(F,"]")),W?(K&&this.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.UNMUTE,(function(){if(Q.signalingSession&&!Q.signalingSession.disposed){Q.signalingSession.telemetryHelper.recordEvent(de.EVENTS.UNMUTE_TIMEOUT),Q.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.UNMUTE);var F=new Error("timed out waiting for response to request");F.endCode={code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.UNMUTE_REQUEST_TIMEOUT},G.reject(F)}}),ue.default.TIMEOUT_VALUES_IN_SECONDS.UNMUTE_TIMEOUT),this.signalingSession.http.sendPostRequest({url:W,payload:B,requestName:F,withoutTrouter:!0,causeId:z}).then((function(B){Q.disposed||(F===de.NETWORK_REQUESTS.UNMUTE.name&&B.response&&Q.processUnmuteInfo(B.response),Q.signalingSession.isHandleUnmuteMuteFromResponseEnabled()&&(F===de.NETWORK_REQUESTS.UNMUTE_SYNC.name&&B.response&&G.resolve(B.response),F!==de.NETWORK_REQUESTS.MUTE_ALL_SYNC.name&&F!==de.NETWORK_REQUESTS.MUTE_SPECIFIED_SYNC.name||!B.response||G.resolve(B.response)),G.resolve())})).catch((function(F){var B=pe.getErrorForXHRFailure(F,Q.signalingSession.signalingAgentConfig);Q.logger.info("[".concat(z,"][muteUnmute][failed][reason=").concat((0,J.getPrintableObject)(B),"]")),Q.disposed||(K&&Q.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.UNMUTE),G.reject(B.error))}))):G.reject(new Error("[".concat(z,"][muteUnmute] cannot be performed now, the link is not yet available")))},ParticipantManager.prototype.sendNetworkRequestForUpdatingMeetingRoles=function(F,B,G,W,z,K){var Q=this;if(!G){var Y="[".concat(z,"][sendNetworkRequestForUpdatingMeetingRoles] failed because correct updateMeetingRoleUrl is not provided");($=new Error(Y)).endCode={code:ue.default.CALL_END_CODE.REJECT,subCode:ue.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:Y},this.logger.info(Y),K.reject()}if(!F){var $;Y="[".concat(z,"][sendNetworkRequestForUpdatingMeetingRoles] failed because participants list is empty or null");($=new Error(Y)).endCode={code:ue.default.CALL_END_CODE.REJECT,subCode:ue.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:Y},this.logger.info(Y),K.reject($)}var onceTrouterReady=function(){Q.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE,(function(){if(Q.signalingSession&&!Q.signalingSession.disposed){Q.signalingSession.telemetryHelper.recordEvent(de.EVENTS.UPDATE_MEETING_ROLE,{causeId:z}),Q.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE);var F=new Error("[".concat(z,"] Timed out waiting for response to request"));F.endCode={code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.UPDATE_MEETING_ROLE_TIMEOUT},K.reject(F)}}),ue.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_MEETING_ROLE_TIMEOUT)};this.signalingSession.http.sendPostRequest({url:G,payload:se.getPayload(this.signalingSession,F,"specified",B),requestName:W,onceTrouterReady:onceTrouterReady,causeId:z}).then((function(F){K.resolve(F.response)})).catch((function(F){var B=(0,J.getPrintableObject)(F);Q.logger.info("[".concat(z,"][sendNetworkRequestForUpdatingMeetingRoles] failed: ").concat(B));var G=new Error("[".concat(z,"][CS response] Forbidden request")),W=pe.getErrorForXHRFailure(F,Q.signalingSession.signalingAgentConfig);G.code=W.error.code,G.subCode=W.error.subCode,G.phrase=W.error.phrase,Q.disposed||(Q.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE),K.reject(G))}))},ParticipantManager.prototype.sendNetworkRequestForNudgingParticipants=function(F,B,G,W,z,K,Q){var Y=this;if(B){var onceTrouterReady=function(){Y.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,(function(){Y.signalingSession&&!Y.signalingSession.disposed&&(Y.signalingSession.telemetryHelper.recordEvent(de.EVENTS.NUDGE_PARTICIPANT_TIMEOUT),Y.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,F?F.join():""))}),ue.default.TIMEOUT_VALUES_IN_SECONDS.NUDGE_PARTICIPANT_TIMEOUT,F?F.join():"")},$=K||z?te.getPayload(this.signalingSession,F,z,K,Q,W):ne.getPayload(this.signalingSession,F,W);return this.signalingSession.http.sendPostRequest({url:B,payload:$,requestName:de.NETWORK_REQUESTS.NUDGE_PARTICIPANT.name,onceTrouterReady:onceTrouterReady,causeId:G}).then((function(){})).catch((function(B){var W=pe.getErrorForXHRFailure(B,Y.signalingSession.signalingAgentConfig);return Y.logger.info("[".concat(G,"][sendNetworkRequestForNudgingParticipant][failed][reason=").concat((0,J.getPrintableObject)(W),"]")),Y.disposed||Y.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,F?F.join():""),Promise.reject(W.error)}))}return this.logger.info("[".concat(G,"][sendNetworkRequestForNudgingParticipant] failed because correct nudgeParticipantUrl is not provided")),Promise.reject("Missing nudgeParticipant url")},ParticipantManager.prototype.sendNetworkRequestForAddingParticipant=function(F,B,G,W){var z=this;if(void 0===W&&(W=pe.causeId()),B){var K=de.NETWORK_REQUESTS.ADD_PARTICIPANT.name,Q=de.EVENTS.ADD_PARTICIPANT_TIMEOUT,X={};switch(G.replacementType){case 2:K=de.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_PICKUP_CODE.name,Q=de.EVENTS.ADD_PARTICIPANT_WITH_PICKUP_CODE_TIMEOUT,X.unparkContent={pickupCode:G.pickupCode};break;case 1:K=de.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_REPLACES.name,Q=de.EVENTS.ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT,X=this.signalingSession.getCallReplacementDetailsForCall(G.callIdToReplace,W);break;case 3:K=de.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_REPLACES.name,Q=de.EVENTS.ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT,X=this.signalingSession.getReplacementDetailsByParticipantLegOfCall(G.callIdToReplace,F[0].id,F[0].replacementParticipantId,W);break;default:K=de.NETWORK_REQUESTS.ADD_PARTICIPANT.name,Q=de.EVENTS.ADD_PARTICIPANT_TIMEOUT,X=null}var onceTrouterReady=function(){F.forEach((function(F){var B=3===G.replacementType?F.participantId:F.id;z.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,(function(){z.signalingSession&&!z.signalingSession.disposed&&(z.signalingSession.telemetryHelper.recordEvent(Q,{causeId:W}),z.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,B),z.participantOperationHandler.rejectPendingOperation(0,B,"timed out waiting for participant to show up in roster",{code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},W))}),ue.default.TIMEOUT_VALUES_IN_SECONDS.ADD_PARTICIPANT_TIMEOUT,B)}))},Z=G.threadId||G.groupId?Y.getPayload(this.signalingSession,F,G,X):$.getPayload(this.signalingSession,F,G,X);this.signalingSession.http.sendPostRequest({url:B,payload:Z,requestName:K,onceTrouterReady:onceTrouterReady,causeId:W}).catch((function(B){var K=pe.getErrorForXHRFailure(B,z.signalingSession.signalingAgentConfig);z.logger.info("[".concat(W,"][sendNetworkRequestForAddingParticipant] failed:").concat((0,J.getPrintableObject)(B))),z.disposed||F.forEach((function(F){var J=3===G.replacementType?F.participantId:F.id;z.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,J),z.participantOperationHandler.rejectPendingOperation(0,J,B,K.error,W)}))}))}else this.logger.info("[".concat(W,"][sendNetworkRequestForAddingParticipants] failed because correct addParticipantUrl is not provided")),F.forEach((function(F){var B=3===G.replacementType?F.participantId:F.id;z.participantOperationHandler.rejectPendingOperation(0,B,"correct addParticipantUrl is not provided",{code:ue.default.CALL_END_CODE.LOCAL_ERROR,subCode:ue.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:ue.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},W)}))},ParticipantManager.prototype.sendNetworkRequestToUpdateParticipantInterpretationState=function(F,B,G,W){var z=this;if(void 0===W&&(W=pe.causeId()),B){var K=de.NETWORK_REQUESTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE.name,Q=de.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT,onceTrouterReady=function(){var B={code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT};F.forEach((function(F){z.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,(function(){z.signalingSession&&!z.signalingSession.disposed&&(z.logger.info("[".concat(W,"][sendNetworkRequestToUpdateParticipantInterpretationState] timed out")),z.signalingSession.telemetryHelper.recordEvent(Q,{causeId:W}),z.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,F.id),z.participantOperationHandler.rejectPendingOperation(5,F.id,"timed out waiting to update particiant interpretation state",B,W))}),ue.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION_TIMEOUT,F.id)}))},Y=ce.getUpdateParticipantInterpretationStatePayload(this.signalingSession,G,W);this.signalingSession.http.sendPostRequest({url:B,payload:Y,requestName:K,onceTrouterReady:onceTrouterReady,causeId:W}).catch((function(B){var G=pe.getErrorForXHRFailure(B,z.signalingSession.signalingAgentConfig);z.logger.info("[".concat(W,"][sendNetworkRequestToUpdateParticipantInterpretationState] failed:").concat((0,J.getPrintableObject)(B))),z.disposed||F.forEach((function(F){z.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,F.id),z.participantOperationHandler.rejectPendingOperation(5,F.id,B,G.error,W)}))}))}else{this.logger.info("[".concat(W,"][sendNetworkRequestToUpdateParticipantInterpretationState] failed because correct updateParticipantUrl is not provided"));var $={code:ue.default.CALL_END_CODE.LOCAL_ERROR,subCode:ue.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:ue.default.CALL_END_PHRASE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_URL_MISSING};F.forEach((function(F){z.participantOperationHandler.rejectPendingOperation(5,F.id,"correct updateParticipantUrl is not provided",$,W)}))}},ParticipantManager.prototype.sendNetworkRequestForCallMeBack=function(F,B,G){var W=this;if(B){var onceTrouterReady=function(){W.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,(function(){W.signalingSession&&!W.signalingSession.disposed&&(W.signalingSession.telemetryHelper.recordEvent(de.EVENTS.CALL_ME_BACK_TIMEOUT,{causeId:G}),W.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,F.id),W.participantOperationHandler.rejectPendingOperation(2,F.id,"timed out waiting for call me back success response",{code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},G))}),ue.default.TIMEOUT_VALUES_IN_SECONDS.CALL_ME_BACK_TIMEOUT,F.id)},z={groupId:this.signalingSession.groupId,threadId:this.signalingSession.threadId,messageId:this.signalingSession.teamsMessageId};this.signalingSession.http.sendPostRequest({url:B,payload:Y.getPayload(this.signalingSession,[F],z),requestName:de.NETWORK_REQUESTS.CALL_ME_BACK.name,onceTrouterReady:onceTrouterReady,causeId:G}).catch((function(B){var z=pe.getErrorForXHRFailure(B,W.signalingSession.signalingAgentConfig);W.logger.info("[".concat(G,"][sendNetworkRequestForCallMeBack] failed: ").concat((0,J.getPrintableObject)(z))),W.disposed||(W.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,F.id),W.participantOperationHandler.rejectPendingOperation(2,F.id,B,z.error,G))}))}else this.logger.info("[".concat(G,"][sendNetworkRequestForCallMeBack] failed because correct addParticipantUrl is not provided")),this.participantOperationHandler.rejectPendingOperation(2,F.id,"correct addParticipantUrl is not provided",{code:ue.default.CALL_END_CODE.LOCAL_ERROR,subCode:ue.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:ue.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},G)},ParticipantManager.prototype.sendNetworkRequestForAdmittingParticipant=function(F,B,G){var W=this;if(B){var onceTrouterReady=function(){W.signalingSession.timeoutManager.startTimer(ue.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,(function(){W.signalingSession&&!W.signalingSession.disposed&&(W.signalingSession.telemetryHelper.recordEvent(de.EVENTS.ADMIT_PARTICIPANT_TIMEOUT),W.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,F.id),W.participantOperationHandler.rejectPendingOperation(1,F.id,"timed out waiting for participant to show up in roster",{code:ue.default.CALL_END_CODE.TIMEOUT,subCode:ue.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:ue.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},G))}),ue.default.TIMEOUT_VALUES_IN_SECONDS.ADMIT_PARTICIPANT_TIMEOUT,F.id)};this.signalingSession.http.sendPostRequest({url:B,payload:X.getPayload(this.signalingSession,F,G),requestName:de.NETWORK_REQUESTS.ADMIT_PARTICIPANT.name,onceTrouterReady:onceTrouterReady,causeId:G}).catch((function(B){var z=pe.getErrorForXHRFailure(B,W.signalingSession.signalingAgentConfig);W.logger.info("[".concat(G,"][sendNetworkRequestForAdmittingParticipant][failed][reason=").concat((0,J.getPrintableObject)(z),"]")),W.disposed||(W.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,F.id),W.participantOperationHandler.rejectPendingOperation(1,F.id,B,z.error,G))}))}else this.logger.info("[".concat(G,"][sendNetworkRequestForAdmittingParticipant] failed because correct admitParticipantUrl is not provided")),this.participantOperationHandler.rejectPendingOperation(1,F.id,"correct admitParticipantUrl is not provided",{code:ue.default.CALL_END_CODE.LOCAL_ERROR,subCode:ue.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:ue.default.CALL_END_PHRASE.ADMIT_PARTICIPANT_URL_MISSING},G)},ParticipantManager.prototype.getCurrentParticipantsInCallModality=function(F){var B={},G=[ue.default.PARTICIPANT_AUDIO_STATE.CONNECTED];return F||G.push(ue.default.PARTICIPANT_AUDIO_STATE.CONNECTING,ue.default.PARTICIPANT_AUDIO_STATE.RINGING),this.signalingSessionCallback.getRemoteParticipantCollection().forEach((function(F){G.some((function(B){return B===F.audioState}))&&(B[F.mri]=!0)})),B},ParticipantManager.prototype.internalHandleRemoveParticipantFailure=function(F,B,G){if(this.participantOperationHandler.hasPendingOperation(3,F,G)){this.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,F),this.logger.info("[".concat(G,"][internalHandleRemoveParticipantFailure] failed for ").concat(this.piiUtils.scrubMriOrOmit(F)," reason ").concat((0,J.getPrintableObject)(B)));var W=this.getCallEndGivenParticipantFailure(B);this.participantOperationHandler.rejectPendingOperation(3,F,W.phrase,W,G)}},ParticipantManager.prototype.internalHandleCallMeBackSuccessHelper=function(F,B){if(this.participantOperationHandler.hasPendingOperation(2,F,B)){var G={id:F};return this.logger.info("participant : ".concat(this.piiUtils.scrubMriOrOmit(F)," was successfully added. Resolving CallMeBack request")),this.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,F),this.participantOperationHandler.resolvePendingOperation(2,G.id,G,B),!0}return!1},ParticipantManager.prototype.internalHandleAddParticipantFailure=function(F,B){var G,W,K=this;void 0===B&&(B=pe.causeId());var J=F.body;if(J.participantInfos)J.participantInfos.forEach((function(G){var W=[G.participant.participantId],z=K.participantOperationHandler.getRnlMri(W,B)||G.participant.id;K.rejectAddParticipantFailure(z,G.transactionEnd,F,B)}));else if(J.participants)try{for(var Q=z(Object.keys(J.participants)),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;this.rejectAddParticipantFailure($,J.participants[$],F,B)}}catch(F){G={error:F}}finally{try{Y&&!Y.done&&(W=Q.return)&&W.call(Q)}finally{if(G)throw G.error}}},ParticipantManager.prototype.rejectAddParticipantFailure=function(F,B,G,W){var z=this.getCallEndGivenParticipantFailure(B);this.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,G,z),this.participantOperationHandler.hasPendingOperation(0,F,W)?(this.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,F),this.logger.info("participantAdd failed for : ".concat(this.piiUtils.scrubMriOrOmit(F)," reason : ").concat((0,J.getPrintableObject)(B))),this.participantOperationHandler.rejectPendingOperation(0,F,z.phrase,z,W)):this.participantOperationHandler.hasPendingOperation(2,F,W)&&(this.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,F),this.logger.info("callMeBack failed for : ".concat(this.piiUtils.scrubMriOrOmit(F)," reason : ").concat((0,J.getPrintableObject)(B))),this.participantOperationHandler.rejectPendingOperation(2,F,z.phrase,z,W))},ParticipantManager.prototype.internalHandleAdmitParticipantSuccess=function(F,B){var G,W,K=F.body;try{for(var J=z(K.participants),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;this.participantOperationHandler.hasPendingOperation(1,Y,B)&&(this.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,Y),this.logger.info("Admit participant success for : ".concat(this.piiUtils.scrubMriOrOmit(Y))),this.participantOperationHandler.resolvePendingOperation(1,Y,void 0,B))}}catch(F){G={error:F}}finally{try{Q&&!Q.done&&(W=J.return)&&W.call(J)}finally{if(G)throw G.error}}},ParticipantManager.prototype.internalHandleAdmitParticipantFailure=function(F,B){var G,W,K=F.body;try{for(var Q=z(Object.keys(K.participants)),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;if(this.participantOperationHandler.hasPendingOperation(1,$,B)){this.signalingSession.timeoutManager.stopTimer(ue.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,$);var X=K.participants[$];this.logger.info("Admit participant failed for : ".concat(this.piiUtils.scrubMriOrOmit($)," reason : ").concat((0,J.getPrintableObject)(X)));var Z=this.getCallEndGivenParticipantFailure(X);this.signalingSession.telemetryHelper.recordIncomingEvent(de.EVENTS.HANDLE_ADMIT_PARTICIPANT_FAILURE,F,Z),this.participantOperationHandler.rejectPendingOperation(1,$,Z.phrase,Z,B)}}}catch(F){G={error:F}}finally{try{Y&&!Y.done&&(W=Q.return)&&W.call(Q)}finally{if(G)throw G.error}}},ParticipantManager.prototype.getCallEndGivenParticipantFailure=function(F){var B={code:F.code,subCode:F.subCode,phrase:F.phrase,resultCategories:F.resultCategories};return F.code===ue.default.CALL_END_CODE.CALL_MODALITY_FAILURE&&F.callControllerTransactionEnd?B=W({},F.callControllerTransactionEnd):F.code===ue.default.CALL_END_CODE.ATC_CONTROLLER_FAILURE&&F.atcControllerTransactionEnd?B=W({},F.atcControllerTransactionEnd):F.code===ue.default.CALL_END_CODE.CVA_CONTROLLER_FAILURE&&F.cvaControllerTransactionEnd&&(B=W({},F.cvaControllerTransactionEnd)),B},ParticipantManager}();B.default=he},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var z=G(17),K=G(5),J=function(){function ParticipantOperations(){this.requests={}}return ParticipantOperations.prototype.clear=function(F,B){var G=this,W=B||{code:K.default.CALL_END_CODE.SUCCESS,subCode:K.default.CALL_END_SUB_CODE.SUCCESS,phrase:K.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach((function(B){G.rejectOperation(B,F,W)}))},ParticipantOperations.prototype.hasOperation=function(F){return this.requests.hasOwnProperty(F)},ParticipantOperations.prototype.getAllOperations=function(){return this.requests},ParticipantOperations.prototype.getOperation=function(F){return this.hasOperation(F)?this.requests[F]:null},ParticipantOperations.prototype.setOperation=function(F,B){return!this.hasOperation(F)&&(this.requests[F]=B,!0)},ParticipantOperations.prototype.rejectOperation=function(F,B,G){var W=new Error(B);if(G&&(W.endCode=G),this.hasOperation(F)){var z=this.requests[F].promise;delete this.requests[F],z.reject(W)}},ParticipantOperations.prototype.resolveOperation=function(F,B){if(this.hasOperation(F)){var G=this.requests[F].promise;delete this.requests[F],G.resolve(B)}},ParticipantOperations}(),Q=function(){function ParticipantOperationHandler(F){this.logger=F,this.localAddParticipantRequests=new J,this.localAdmitParticipantRequests=new J,this.localCallMeBackRequests=new J,this.localRemoveParticipantEndpointRequests=new J,this.localRemoveParticipantRequests=new J,this.localUpdateParticipantInterpretationStateRequest=new J,this.participantIdMriMap=new Map}return ParticipantOperationHandler.prototype.dispose=function(F,B,G){this.logger.info("[".concat(G,"][dispose]")),this.rejectAllPendingOperations(F,B)},ParticipantOperationHandler.prototype.getAllPendingOperations=function(F,B){this.logger.info("[".concat(B,"][getAllPendingOperations] ").concat(F));var G=this.getOperationTable(F);return G?G.getAllOperations():null},ParticipantOperationHandler.prototype.getPendingOperation=function(F,B,G){this.logger.info("[".concat(G,"][getPendingOperation] ").concat(F," ").concat(B));var W=this.getOperationTable(F);return W?W.getOperation(B):null},ParticipantOperationHandler.prototype.getRnlMri=function(F,B){var G,z;this.logger.info("[".concat(B,"][getRnlMri] ").concat(F));try{for(var K=W(F),J=K.next();!J.done;J=K.next()){var Q=J.value;if(this.participantIdMriMap.has(Q))return this.participantIdMriMap.get(Q)}}catch(F){G={error:F}}finally{try{J&&!J.done&&(z=K.return)&&z.call(K)}finally{if(G)throw G.error}}return""},ParticipantOperationHandler.prototype.hasPendingOperation=function(F,B,G){this.logger.info("[".concat(G,"][hasPendingOperation] ").concat(F," ").concat((0,z.scrubMriOrOmit)(B)));var W=this.getOperationTable(F);return!!W&&W.hasOperation(B)},ParticipantOperationHandler.prototype.rejectPendingOperation=function(F,B,G,W,K){this.logger.info("[".concat(K,"][rejectPendingOperation] ").concat(F," ").concat((0,z.scrubMriOrOmit)(B)," reason: ").concat(G));var J=this.getOperationTable(F);J&&J.rejectOperation(B,G,W)},ParticipantOperationHandler.prototype.resolvePendingOperation=function(F,B,G,W){this.logger.info("[".concat(W,"][resolvePendingOperation]: ").concat((0,z.scrubMriOrOmit)(B)));var K=this.getOperationTable(F);K&&K.resolveOperation(B,G)},ParticipantOperationHandler.prototype.setPendingOperation=function(F,B,G,W){this.logger.info("[".concat(W,"][setPendingOperation] ").concat(F," ").concat((0,z.scrubMriOrOmit)(B)," value: ").concat(G));var K=this.getOperationTable(F);if(!K)return!1;if(0===F){var J=G&&G.participant&&G.participant.participantId;J&&this.participantIdMriMap.set(J,B)}return K.setOperation(B,G)},ParticipantOperationHandler.prototype.getOperationTable=function(F){switch(F){case 0:return this.localAddParticipantRequests;case 1:return this.localAdmitParticipantRequests;case 2:return this.localCallMeBackRequests;case 4:return this.localRemoveParticipantEndpointRequests;case 3:return this.localRemoveParticipantRequests;case 5:return this.localUpdateParticipantInterpretationStateRequest;default:return null}},ParticipantOperationHandler.prototype.rejectAllPendingOperations=function(F,B){this.logger.info("rejectLocalQueuedOperations"),this.localAddParticipantRequests.clear(F,B),this.localAdmitParticipantRequests.clear(F,B),this.localCallMeBackRequests.clear(F,B),this.localRemoveParticipantRequests.clear(F,B),this.localRemoveParticipantEndpointRequests.clear(F,B),this.localUpdateParticipantInterpretationStateRequest.clear(F,B)},ParticipantOperationHandler}();B.default=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G,J){K.assertNotNull(F,"signalingSession cannot be null");var Q=B.map((function(F){return K.assertNotNull(F,"remoteParticipant cannot be null"),{id:F.id,assertedId:F.assertedId,displayName:F.displayName,participantId:F.participantId}}));return{payload:{disableUnmute:G&&G.disableUnmute,participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId,alternateId:G?G.alternateId:null},to:Q},participantInvitationData:G.additionalData,replacementDetails:J,links:{addParticipantSuccess:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)},debugContent:{clientScenario:G.clientScenario}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){return K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},to:[{id:B.id,displayName:B.displayName}]},links:{admitFailure:z.get(F,W.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE),admitSuccess:z.get(F,W.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS)},debugContent:{causeId:G}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F){return W.assertNotNull(F,"signalingSession cannot be null"),{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},mediaTypes:["audio"]}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B,G){return W.assertNotNull(F,"signalingSession cannot be null"),W.assertNotNull(B,"muteScope be null"),W.assertNotNull(G,"participantList cannot be null"),{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},scope:B,muteParticipants:G,mediaTypes:["audio"]}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G,J,Q,Y){K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"participantsIds cannot be null");var $=F.groupId?{id:F.groupId}:null,X=J?{threadId:J,messageId:Q||null}:null,Z=[];return B.forEach((function(F){var B={id:F};Z.push(B)})),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},invitationType:W.default.INVITATION_TYPE.NUDGE,to:Z},participantInvitationData:Y,groupContext:$,groupChat:X,links:{nudgeParticipantSuccess:z.get(F,W.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:z.get(F,W.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"participantsIds cannot be null");var J=[];return B.forEach((function(F){var B={id:F};J.push(B)})),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},invitationType:W.default.INVITATION_TYPE.NUDGE,to:J},participantInvitationData:G,links:{nudgeParticipantSuccess:z.get(F,W.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:z.get(F,W.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE),addParticipantSuccess:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B){return W.assertNotNull(F,"signalingSession cannot be null"),W.assertCallEndReason(B),{payload:{transactionEnd:B}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){return K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},scope:G,toEndpoints:[{id:B.id,endpointId:B.endpointId}]},links:{removeParticipantSuccess:z.get(F,W.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:z.get(F,W.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B){return K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"remoteParticipant cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},to:[{id:B.id,displayName:B.displayName}]},links:{removeParticipantSuccess:z.get(F,W.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:z.get(F,W.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F){return W.assertNotNull(F,"signalingSession cannot be null"),{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},mediaTypes:["audio"]}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B,G,z){void 0===z&&(z=""),W.assertNotNull(G&&"specified"===G,"Only non-null non-empty scope of 'specified' is supported."),W.assertNotNull(F,"signalingSession cannot be null"),W.assertNotNull(B,"participantsIds cannot be null");var K=[];return B.forEach((function(F){var B={id:F,meetingRole:z};K.push(B)})),{payload:{from:{id:F.participantManager.localParticipant.id,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},scope:G,to:K}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getUpdateParticipantInterpretationStatePayload=void 0;var W=G(5),z=G(9),K=G(3);function getUpdateParticipantInterpretationStatePayload(F,B,G){return K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"options cannot be null"),{payload:{from:{id:F.participantManager.localParticipant.id},to:B,links:{updateParticipantInterpretationStateStatus:z.get(F,W.URL_PATH.UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS)},operationId:G}}}B.getUpdateParticipantInterpretationStatePayload=getUpdateParticipantInterpretationStatePayload},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var z=G(8),K=G(45),J=G(17),Q=G(72),Y=G(25),$=G(5),X=G(3),Z=function(){function RosterManager(F,B){var G=this;this.participantManager=F,this.logger=B,this.handleRosterUpdate=function(F,B,z,K){var J,$;if("Delta"===F.type||"MultiPartyEndpoint"===F.type){if(void 0===F.sequenceNumber&&(F.sequenceNumber=G.lastRosterUpdateSeqNumber),G.logger.info("[".concat(K,"][handleRosterUpdate][sequenceNumber=").concat(F.sequenceNumber,"]")),G.rostersInLifetime.add(F.sequenceNumber),"Delta"===F.type)G.logger.info("[".concat(K,"][handleRosterUpdate], RosterType: Delta, isFullRoster: ").concat(z)),G.handleDeltaRoster(F,z,B,K);else{if(G.logger.info("[".concat(K,"][handleRosterUpdate], RosterType: MultiPartyEndpoint")),G.isRosterStale(F,K))return G.participantManager.signalingSession.telemetryHelper.recordEvent(Y.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:G.lastRosterUpdateSeqNumber,sequenceNumber:F.sequenceNumber,causeId:K}),void G.logger.info("[".concat(K,"][handleRosterUpdate] Ignoring old roster update: received ").concat(F.sequenceNumber,", but already handled ").concat(G.lastRosterUpdateSeqNumber));try{for(var X=W(Object.keys(F.participants)),Z=X.next();!Z.done;Z=X.next()){var ee=Z.value,te=Q.default.fromRoster(F.participants[ee]);G.handleRosterParticipant(te,B,K)}}catch(F){J={error:F}}finally{try{Z&&!Z.done&&($=X.return)&&$.call(X)}finally{if(J)throw J.error}}G.checkForRemovedParticipants(B,F.participants,K),G.participantManager.signalingSessionCallback.onParticipantCountsUpdated(F.participantCounts,K)}if(F.sequenceNumber>G.lastRosterUpdateSeqNumber){G.lastRosterUpdateSeqNumber=F.sequenceNumber,G.firstRosterUpdateSeqNumber<0&&(G.firstRosterUpdateSeqNumber=G.lastRosterUpdateSeqNumber);var ne=Object.keys(F.participants||0).length;G.participantCountInFirstRoster<0&&(G.participantCountInFirstRoster=ne),G.maxConcurrentParticipantsDuringLeg=Math.max(G.maxConcurrentParticipantsDuringLeg,ne)}G.recordTelemetry(F,z,K),G.participantManager.signalingSessionCallback.onRosterHandlingComplete()}else G.logger.warn("[".concat(K,"][handleRosterUpdate][sequenceNumber=").concat(F.sequenceNumber,"] invalid roster type ").concat(F.type))},this.isRosterStale=function(F,B){return G.logger.info("[".concat(B,"][isRosterStale] ").concat(F.sequenceNumber<G.lastRosterUpdateSeqNumber)),F.sequenceNumber<G.lastRosterUpdateSeqNumber},this.updateLocalParticipantFromSubscribe=function(F,B){G.logger.info("[".concat(B,"][updateLocalParticipantFromSubscribe]")),G.updateLocalParticipant(F,B)},this.lastRosterUpdateSeqNumber=-1,this.firstRosterUpdateSeqNumber=-1,this.tombstoneSequence=new Map,this.latestRosterVersionForActiveParticipants=new Map,this.rostersInLifetime=new Set,this.maxConcurrentParticipantsDuringLeg=-1,this.participantCountInFirstRoster=-1}return RosterManager.prototype.recordTelemetry=function(F,B,G){var W={participantCountInLastRoster:Object.keys(F.participants||0).length,participantCountInFirstRoster:this.participantCountInFirstRoster,sequenceNumberOfLastRoster:this.lastRosterUpdateSeqNumber,sequenceNumberOfFirstRoster:this.firstRosterUpdateSeqNumber,rosterType:F.type,isFullRoster:B,maxConcurrentParticipantsDuringLeg:this.maxConcurrentParticipantsDuringLeg,totalParticipantsDuringLifetimeOfLeg:this.tombstoneSequence.size+this.latestRosterVersionForActiveParticipants.size,countOfMissingNotifications:this.getMissingNotificiations()};this.logger.info("[recordTelemetry] data ".concat(JSON.stringify(W,null,4))),this.participantManager.signalingSession.telemetryHelper.recordRosterEvent(W,Y.EVENTS.HANDLE_ROSTER_UPDATE,G)},RosterManager.prototype.getMissingNotificiations=function(){var F=this.lastRosterUpdateSeqNumber-this.firstRosterUpdateSeqNumber+1-this.rostersInLifetime.size;return F>0?F:0},RosterManager.prototype.isParticipantRosterStale=function(F,B){if(this.logger.info("[isParticipantRosterStale], rosterParticipantVersion ".concat(B)),B){if(this.tombstoneSequence.has(F))return B<=this.tombstoneSequence.get(F);if(this.latestRosterVersionForActiveParticipants.has(F))return B<=this.latestRosterVersionForActiveParticipants.get(F)}return!1},RosterManager.prototype.handleDeltaRoster=function(F,B,G,z){var K,J,$,X;if(this.logger.info("[".concat(z,"][handleDeltaRoster] isFullRoster ").concat(B)),B){if(this.isRosterStale(F,z))return this.participantManager.signalingSession.telemetryHelper.recordEvent(Y.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:this.lastRosterUpdateSeqNumber,sequenceNumber:F.sequenceNumber,causeId:z}),void this.logger.info("[".concat(z,"][handleRosterUpdate] Ignoring old roster update: received ").concat(F.sequenceNumber,", but already handled ").concat(this.lastRosterUpdateSeqNumber));try{for(var Z=W(Object.keys(G)),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value;if(!F.participants.hasOwnProperty(te)){var ne=new Q.default({id:te});this.logger.info("[".concat(z,"][handleRosterUpdate] participant missing from delta, full roster")),this.handleRemovedDeltaRosterParticipant(ne,F.sequenceNumber,G,z)}}}catch(F){K={error:F}}finally{try{ee&&!ee.done&&(J=Z.return)&&J.call(Z)}finally{if(K)throw K.error}}}else if(!F||!F.participants)return void this.logger.warn("[".concat(z,"][handleRosterUpdate] participants blob empty in delta roster"));try{for(var ie=W(Object.keys(F.participants)),re=ie.next();!re.done;re=ie.next()){var oe=re.value,ae=F.participants[oe];if(!this.isParticipantRosterStale(oe,ae.version)){ne=Q.default.fromRoster(ae);ae.state&&"active"===ae.state?(this.logger.info("[".concat(z,"][handleDeltaRoster] participant active")),this.handleRosterParticipant(ne,G,z),this.tombstoneSequence.has(oe)&&this.tombstoneSequence.delete(oe),this.latestRosterVersionForActiveParticipants.set(oe,ae.version)):ae.state&&"inactive"===ae.state?(ne=ne||new Q.default({id:ae.details.id}),this.logger.info("[".concat(z,"][handleDeltaRoster] participant inactive")),this.handleRemovedDeltaRosterParticipant(ne,ae.version,G,z)):this.logger.info("[".concat(z,"][handleDeltaRoster] unexpected participant state ").concat(ae.state))}}}catch(F){$={error:F}}finally{try{re&&!re.done&&(X=ie.return)&&X.call(ie)}finally{if($)throw $.error}}this.handleRemoveParticipantRequests(this.getActiveParticipants(F.participants),z),this.participantManager.signalingSessionCallback.onParticipantCountsUpdated(F.participantCounts,z)},RosterManager.prototype.getRnlMri=function(F,B){var G=this.participantManager.participantOperationHandler;if(F){var W=this.getRnlParticipantIdsFromRoster(F,B);return G.getRnlMri(W,B)}return""},RosterManager.prototype.handleRemovedDeltaRosterParticipant=function(F,B,G,W){var z=F.id,K=this.getRnlMri(F,W),J="";G.hasOwnProperty(z)?J=z:G.hasOwnProperty(K)&&(J=K),J&&this.handleRemovedParticipant(G,J,W),this.tombstoneSequence.set(z,B),this.latestRosterVersionForActiveParticipants.has(z)&&this.latestRosterVersionForActiveParticipants.delete(z)},RosterManager.prototype.handleRemovedParticipant=function(F,B,G){var W=this.participantManager.signalingSessionCallback,z=this.participantManager.signalingSession;!1!==F[B]&&(X.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,B),this.logger.info("[".concat(G,"][handleRemovedParticipant] ").concat(J.scrubMriOrOmit(B)," removed from roster")),W.onParticipantRemoved({id:B},G),z.clearParticipantCallLinks(B))},RosterManager.prototype.getActiveParticipants=function(F){var B,G,z={};try{for(var K=W(Object.keys(F)),J=K.next();!J.done;J=K.next()){var Q=J.value;"inactive"!==F[Q].state&&(z[Q]=F[Q])}}catch(F){B={error:F}}finally{try{J&&!J.done&&(G=K.return)&&G.call(K)}finally{if(B)throw B.error}}return z},RosterManager.prototype.handleRosterParticipant=function(F,B,G){var z,K;if(F)if(F.id!==this.participantManager.localParticipant.id){var Q=this.participantManager.participantOperationHandler,Y=this.participantManager.signalingSession,Z=this.participantManager.signalingSessionCallback,ee=F.id,te=this.getRnlMri(F,G);Y.signalingAgentConfig.overrideDisplayName&&Y.remoteCaller&&F.participantId===Y.remoteCaller.participantId&&(F.displayName=Y.remoteCaller.displayName),X.tryAddNewKeyToHashTable(this.participantManager.connectedRemoteParticipantIds,F.id,!0);var ne=B.hasOwnProperty(F.id),ie=B.hasOwnProperty(te);(ne||ie)&&(B[F.id]=!1),Q.hasPendingOperation(0,F.id,G)&&this.isParticipantInCall(F)?(this.logger.info("participant ".concat(J.scrubMriOrOmit(F.id)," appears in roster. Resolving AddParticipant request")),Y.timeoutManager.stopTimer($.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,F.id),Q.resolvePendingOperation(0,F.id,F,G)):te&&Q.hasPendingOperation(0,te,G)&&this.isParticipantInCall(F)?(this.logger.info("RNL participant ".concat(J.scrubMriOrOmit(te)," appears in roster. Resolving AddParticipant request")),Y.timeoutManager.stopTimer($.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,te),Q.resolvePendingOperation(0,te,F,G)):Q.hasPendingOperation(1,F.id,G)&&this.isParticipantInCall(F)&&(this.logger.info("participant: ".concat(J.scrubMriOrOmit(F.id)," appears in roster. Resolving AdmitParticipant request")),Y.timeoutManager.stopTimer($.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,F.id),Q.resolvePendingOperation(1,F.id,F,G));try{for(var re=W(F.endpointDetails),oe=re.next();!oe.done;oe=re.next()){var ae=oe.value;Q.hasPendingOperation(0,ae.participantId,G)&&this.isParticipantInCall(F)&&(this.logger.info("participant ".concat(J.scrubMriOrOmit(F.id)," appears in roster. Resolving AddParticipant request")),Y.timeoutManager.stopTimer($.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,ae.participantId),Q.resolvePendingOperation(0,ae.participantId,F,G))}}catch(F){z={error:F}}finally{try{oe&&!oe.done&&(K=re.return)&&K.call(re)}finally{if(z)throw z.error}}ne?(this.logger.info("participantId=".concat(F.participantId," updated ").concat(J.scrubMriOrOmit(F.id))),Z.onParticipantUpdated(F,G),Y.setParticipantCallLinks(F)):ie?(this.logger.info("RNL participant participantId=".concat(F.participantId," removed old ").concat(J.scrubMriOrOmit(te)," and added new ").concat(J.scrubMriOrOmit(ee))),Z.onParticipantRemoved({id:te},G,!0),Y.clearParticipantCallLinks(te),Z.onParticipantJoined(F,G),Y.setParticipantCallLinks(F)):Q.hasPendingOperation(3,F.id,G)?this.logger.info("participantId=".concat(F.participantId," ignored ").concat(J.scrubMriOrOmit(F.id))):(this.logger.info("participantId=".concat(F.participantId," joined ").concat(J.scrubMriOrOmit(F.id))),Z.onParticipantJoined(F,G),Y.setParticipantCallLinks(F))}else{this.updateLocalParticipant(F,G);var se=this.getLocalEndpoint();(null==se?void 0:se.stream)||(null==se?void 0:se.streamLobby)?this.participantManager.signalingSession.configureStreamingMode(G):this.participantManager.signalingSession.setRealTimeState(1,G)}else this.logger.info("[handleRosterParticipant] [".concat(G,"] rosterParticipant processing skipped because null."))},RosterManager.prototype.getLocalEndpoint=function(){var F=this;return z.find(this.participantManager.localParticipant.endpointDetails,(function(B){return F.participantManager.localParticipant.endpointId===B.endpointId}))},RosterManager.prototype.getRnlParticipantIdsFromRoster=function(F,B){var G,z,K=[];try{for(var J=W(F.endpointDetails),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;K.push(Y.participantId)}}catch(F){G={error:F}}finally{try{Q&&!Q.done&&(z=J.return)&&z.call(J)}finally{if(G)throw G.error}}return this.logger.info("[".concat(B,"][getRnlParticipantIdsFromRoster] ").concat(JSON.stringify(K))),K},RosterManager.prototype.isParticipantInCall=function(F){return F.endpointDetails&&F.endpointDetails[0]&&!F.endpointDetails[0].isLobby},RosterManager.prototype.updateLocalParticipant=function(F,B){var G=this.participantManager.localParticipant,W=this.participantManager.signalingSession,J=this.participantManager.signalingSessionCallback;this.logger.info("[".concat(B,"][updateLocalParticipant]"));var Q=!1;if(F&&F.endpointDetails){var $=z.find(F.endpointDetails,(function(F){return G.endpointId===F.endpointId})),X=z.find(G.endpointDetails,(function(F){return G.endpointId===F.endpointId}));Q=(0,K.hasStagingGroup)($),!$||!$.isLobby||X&&X.isLobby?!$||$.isLobby||X&&!X.isLobby||(Q?W.telemetryHelper.recordEvent(Y.EVENTS.STAGING,{causeId:B}):W.telemetryHelper.recordEvent(Y.EVENTS.CONNECTED,{causeId:B})):W.telemetryHelper.recordEvent(Y.EVENTS.IN_LOBBY,{causeId:B}),J.onMeetingGroupDetailsUpdated($&&$.meetingGroupDetails,B)}F&&(G.endpointDetails=F.endpointDetails||[],G.acceptedBy=F.acceptedBy,G.role=F.role,G.meetingRole=F.meetingRole,G.advancedMeetingRole=F.advancedMeetingRole,G.tenantId=F.tenantId,G.isLobby=F.isLobby,G.publishedStates=F.publishedStates,G.isStaging=Q,this.participantManager.localParticipant.fromRoster=!0,J.onSelfParticipantUpdated(G,B))},RosterManager.prototype.checkForRemovedParticipants=function(F,B,G){var z,K,Q=this.participantManager.signalingSessionCallback,Y=this.participantManager.signalingSession,$=this.participantManager.participantOperationHandler;this.logger.info("[".concat(G,"][checkForRemovedParticipants]"));try{for(var Z=W(Object.keys(F)),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value;F.hasOwnProperty(te)&&!1!==F[te]&&!$.hasPendingOperation(0,te,G)&&(X.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,te),this.logger.info("[".concat(G,"][checkForRemovedParticipants] ").concat(J.scrubMriOrOmit(te)," removed from roster")),Q.onParticipantRemoved({id:te},G),Y.clearParticipantCallLinks(te))}}catch(F){z={error:F}}finally{try{ee&&!ee.done&&(K=Z.return)&&K.call(Z)}finally{if(z)throw z.error}}this.handleRemoveParticipantRequests(B,G)},RosterManager.prototype.handleRemoveParticipantRequests=function(F,B){var G,z,K=this.participantManager.signalingSession,Y=this.participantManager.participantOperationHandler;this.logger.info("handleRemoveParticipantRequests [".concat(B,"] dynamicRosterParticipants"));var Z=[];Object.keys(F).forEach((function(B){var G=Q.default.fromRoster(F[B]);G&&G.endpointDetails&&G.endpointDetails.forEach((function(F){F.originalId&&Z.push(F.originalId)}))}));var ee=Y.getAllPendingOperations(3,B);try{for(var te=W(Object.keys(ee)),ne=te.next();!ne.done;ne=te.next()){var ie=ne.value;-1!==Z.indexOf(ie)||F.hasOwnProperty(ie)||(this.logger.info("[".concat(B,"][handleRemoveParticipantRequests] ").concat(J.scrubMriOrOmit(ie)," no longer appears in roster. Resolving RemoveParticipant request")),X.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,ie),K.timeoutManager.stopTimer($.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,ie),Y.resolvePendingOperation(3,ie,{id:ie},B))}}catch(F){G={error:F}}finally{try{ne&&!ne.done&&(z=te.return)&&z.call(te)}finally{if(G)throw G.error}}},RosterManager}();B.default=Z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B){return K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"broadcastContext cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}},broadcast:B,links:{addModalitySuccess:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_FAILURE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B){return K.assertNotNull(F,"signalingSession cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}},links:{admitAllStatus:z.get(F,W.URL_PATH.CONV_ADMIT_ALL_STATUS)},operationId:B,debugContent:{causeId:B}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){void 0===G&&(G=!0),K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(B,"joinUrl cannot be null");var J={type:F.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:z.get(F,W.URL_PATH.CONV_ROSTER_UPDATE)},Q=F.getEndpointCapabilities(),Y={payload:{attach:{requireMediaContent:G,links:{end:z.get(F,W.URL_PATH.END)},locationContent:F.getLocationContent(),networkContent:F.getNetworkContent(),areaContent:F.getAreaContent()},capabilities:F.signalingAgentConfig.enableDeltaRosterWeb?null:Q,endpointCapabilities:F.signalingAgentConfig.enableDeltaRosterWeb?Q:null,additionalActions:[{input:{capabilities:F.signalingAgentConfig.enableDeltaRosterWeb?null:Q,endpointCapabilities:F.signalingAgentConfig.enableDeltaRosterWeb?Q:null,conversationRequest:{applicationType:F.participantManager.localParticipant.applicationType,roster:J,links:{conversationEnd:z.get(F,W.URL_PATH.CONV_END),conversationUpdate:z.get(F,W.URL_PATH.CONV_UPDATE),localParticipantUpdate:z.get(F,W.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE),receiveMessage:z.get(F,W.URL_PATH.RECEIVE_MESSAGE)}},endpointMetadata:F.endpointMetadata,participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}}},name:"join",url:B,waitForResponse:!0}]}};return F.signalingAgentConfig.ecsEtag&&(Y.payload.debugContent={ecsEtag:F.signalingAgentConfig.ecsEtag}),Y.payload.additionalActions.length>0&&F.deviceType&&"default"!==F.deviceType&&(Y.payload.additionalActions[0].input.conversationRequest.deviceType=F.deviceType),Y}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F){return K.assertNotNull(F,"signalingSession cannot be null"),{payload:{callAcceptanceAcknowledgement:{links:{mediaRenegotiation:z.get(F,W.URL_PATH.MEDIA_RENEGOTIATION),transfer:z.get(F,W.URL_PATH.TRANSFER),replacement:z.get(F,W.URL_PATH.REPLACE),balanceUpdate:z.get(F,W.URL_PATH.BALANCE_UPDATE),retargetCompletion:z.get(F,W.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:z.get(F,W.URL_PATH.CONTROL_VIDEO_STREAMING)}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G,J){K.assertNotNull(F,"signalingSession cannot be null");var Q=K.getMediaTypes(G);F.telemetryHelper.addOutgoingModalities(Q);var Y=F.getEndpointCapabilities();return{payload:{callAcceptance:{acceptedBy:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},acceptedCallModalities:Q,capabilities:F.signalingAgentConfig.enableDeltaRosterWeb?null:Y,endpointCapabilities:F.signalingAgentConfig.enableDeltaRosterWeb?Y:null,clientEndpointCapabilities:0!==J?J:null,links:{mediaRenegotiation:z.get(F,W.URL_PATH.MEDIA_RENEGOTIATION),transfer:z.get(F,W.URL_PATH.TRANSFER),replacement:z.get(F,W.URL_PATH.REPLACE),balanceUpdate:z.get(F,W.URL_PATH.BALANCE_UPDATE),retargetCompletion:z.get(F,W.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:z.get(F,W.URL_PATH.CONTROL_VIDEO_STREAMING)},clientContentForMediaController:F.webRtcSignalingManager.getClientUrls(),mediaContent:B,pstnContent:F.pstnContent,callKeepAliveInterval:null}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F){return W.assertNotNull(F,"signalingSession cannot be null"),{payload:{callProgress:{sender:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},status:"ringing",phrase:"ringing"}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B,G,z){W.assertNotNull(F,"signalingSession cannot be null");var K=F.participantManager.localParticipant;return{payload:{invitationRedirection:{target:{type:B,endpointType:z,id:G},sender:{id:K.id,endpointId:K.endpointId,participantId:K.participantId,languageId:K.languageId}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(3);function getPayload(F,B,G){z.assertNotNull(F,"signalingSession cannot be null"),z.assertCallEndReason(B);var K={payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,languageId:F.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:W.default.CALL_END_CODE.SUCCESS,phrase:W.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:B}};return G&&B.code===W.default.CALL_END_CODE.CANCEL&&(K.payload.callTransactionEnd.callQualityDiagnosticsInformation=G),K}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G,J){K.assertNotNull(F,"signalingSession cannot be null");var Q=[];Q=J.invitationType===W.default.INVITATION_TYPE.NUDGE&&Array.isArray(J.participantsToNudge)?J.participantsToNudge.map((function(F){return{id:F}})):F.participantManager.getParticipantsToInitiateCallWith(),F.signalingAgentConfig.doHostlessCalling||K.assert(Q.length>0,"remoteParticipants need to be set before a call can be made");var Y={type:F.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:z.get(F,W.URL_PATH.CONV_ROSTER_UPDATE)},$=F.groupId?{id:F.groupId}:null,X=F.threadId?{threadId:F.threadId,messageId:F.teamsMessageId||null}:null,Z=F.contentSharingManager.getContentSharingInfoToStartSharing(),ee=null===Z?null:{identifier:Z.contentIdentifier,subject:Z.subject,sessionState:Z.sessionState,sessionUpdateSequenceNumber:Z.sequenceNumber,links:{sessionUpdate:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:z.get(F,W.URL_PATH.CONV_CONTENT_SHARING_END)}},te=F.broadcastSession&&F.broadcastSession.getContext(),ne=F.getEndpointCapabilities(J.enableLightWeightMeeting);1===Q.length&&F.telemetryHelper.setCalleeType(Q[0].id),F.numberOfOriginalInvitees=Q.length;var ie=[];Q.forEach((function(B){var G={id:B.id};B.displayName&&(G.displayName=B.displayName),B.participantId&&(G.participantId=B.participantId),(J.callToVoicemail||F.transferContext&&F.transferContext.target&&"voicemail"===F.transferContext.target.endpointType)&&(G.endpointType="voicemail"),ie.push(G)}));var re=F.transferContext?F.transferContext.transferor:null,oe=F.transferContext?F.transferContext.transferContext:null,ae={};J.callToVoicemail&&(J.voicemailResourcePath&&(ae.localResourcePath=J.voicemailResourcePath),J.voicemailItemId&&(ae.voicemailItemId=J.voicemailItemId));var se={payload:{conversationRequest:{conversationType:J.conversationType,subject:F.convSubject,suppressDialout:J.suppressDialout,applicationType:J.applicationType,roster:Y,properties:{allowConversationWithoutHost:F.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:F.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:F.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:F.enableGroupCallMeetupGeneration},links:{conversationEnd:z.get(F,W.URL_PATH.CONV_END),conversationUpdate:z.get(F,W.URL_PATH.CONV_UPDATE),localParticipantUpdate:z.get(F,W.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE),addModalitySuccess:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:z.get(F,W.URL_PATH.CONV_ADD_MODALITY_FAILURE),confirmUnmute:z.get(F,W.URL_PATH.CONV_CONFIRM_UNMUTE),receiveMessage:z.get(F,W.URL_PATH.RECEIVE_MESSAGE)}},broadcast:te,contentSharing:ee,participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId,meetingRegistrationId:J.meetingRegistrationId},to:ie},capabilities:F.signalingAgentConfig.enableDeltaRosterWeb?null:ne,endpointCapabilities:F.signalingAgentConfig.enableDeltaRosterWeb?ne:null,clientEndpointCapabilities:J.clientEndpointCapabilities?J.clientEndpointCapabilities:null,endpointMetadata:F.endpointMetadata,groupContext:$,groupChat:X,meetingInfo:F.getMeetingInfo(),meetingData:J.meetingData,meetingPreferences:J.meetingPreferences,endpointState:J.endpointState}};if(F.deviceType&&"default"!==F.deviceType&&(se.payload.conversationRequest.deviceType=F.deviceType),J.enableLightWeightMeeting)se.payload.lwj={end:z.get(F,W.URL_PATH.LWJ_END),acceptance:z.get(F,W.URL_PATH.LWJ_ACCEPTANCE)};else{var ce=K.getMediaTypes(G);F.telemetryHelper.addOutgoingModalities(ce),se.payload.callInvitation={callModalities:ce,replaces:null,transferor:re||null,clientTransferContext:oe,links:{progress:z.get(F,W.URL_PATH.PROGRESS),mediaAnswer:z.get(F,W.URL_PATH.MEDIA_ANSWER),acceptance:z.get(F,W.URL_PATH.ACCEPT),redirection:z.get(F,W.URL_PATH.REDIRECTION),end:z.get(F,W.URL_PATH.END)},clientContentForMediaController:F.webRtcSignalingManager.getClientUrls(),pstnContent:F.pstnContent,emergencyContent:F.getEmergencyContent(),mediaContent:B,voicemailSettings:ae,routingFlags:J.routingFlags,invitationData:J.invitationData,locationContent:F.getLocationContent(),networkContent:F.getNetworkContent(),areaContent:F.getAreaContent()},J.pickupCode&&(se.payload.callInvitation.unparkContent={pickupCode:parseInt(J.pickupCode,10)}),J.onBehalfOf&&(se.payload.callInvitation.onBehalfOf={id:J.onBehalfOf}),J.scenario&&(se.payload.conversationRequest.scenario=J.scenario),J.alternateId&&(se.payload.participants.from.alternateId=J.alternateId)}if(J.invitationType===W.default.INVITATION_TYPE.NUDGE&&(se.payload.participants.invitationType=J.invitationType),F.signalingAgentConfig.ecsEtag&&(se.payload.debugContent={ecsEtag:F.signalingAgentConfig.ecsEtag}),J.clientEndpointDebugContent){se.payload.debugContent||(se.payload.debugContent={});try{se.payload.debugContent.clientDebugContent=JSON.parse(J.clientEndpointDebugContent)}catch(F){K.assert(!1,"Failed to parse ".concat(J.clientEndpointDebugContent))}}return se}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(3);function getPayload(F,B){return z.assertNotNull(F,"signalingSession cannot be null"),z.assertCallEndReason(B),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:"noError",code:W.default.CALL_END_CODE.SUCCESS,phrase:W.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED},callTransactionEnd:B}}}B.getPayload=getPayload},function(F,B,G){function getPayload(F,B){return{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},scope:B}}}Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0,B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G,J,Q){K.assertNotNull(F,"signalingSession cannot be null");var Y={type:F.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:z.get(F,W.URL_PATH.CONV_ROSTER_UPDATE)},$=F.getEndpointCapabilities(J.enableLightWeightMeeting),X=F.groupId?{id:F.groupId}:null,Z=F.threadId?{threadId:F.threadId,messageId:F.teamsMessageId||null}:null,ee={payload:{conversationRequest:{conversationType:J.conversationType,subject:F.convSubject,suppressDialout:J.suppressDialout,scenario:J.scenario,applicationType:J.applicationType,roster:Y,properties:{allowConversationWithoutHost:F.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:F.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:F.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:F.enableGroupCallMeetupGeneration},links:{conversationEnd:z.get(F,W.URL_PATH.CONV_END),conversationUpdate:z.get(F,W.URL_PATH.CONV_UPDATE),localParticipantUpdate:z.get(F,W.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:z.get(F,W.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE),receiveMessage:z.get(F,W.URL_PATH.RECEIVE_MESSAGE)}},groupContext:X,groupChat:Z,participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId,meetingRegistrationId:J.meetingRegistrationId}},capabilities:F.signalingAgentConfig.enableDeltaRosterWeb?null:$,endpointCapabilities:F.signalingAgentConfig.enableDeltaRosterWeb?$:null,clientEndpointCapabilities:J.clientEndpointCapabilities?J.clientEndpointCapabilities:null,endpointMetadata:F.endpointMetadata,meetingInfo:F.getMeetingInfo(),meetingData:J.meetingData,meetingPreferences:J.meetingPreferences,endpointState:J.endpointState}};if((null==J?void 0:J.applyServerMute)&&(ee.payload.participants.from.applyServerMute=J.applyServerMute.value,J.applyServerMute.mediaTypes&&(ee.payload.participants.from.mediaTypes=J.applyServerMute.mediaTypes)),F.deviceType&&"default"!==F.deviceType&&(ee.payload.conversationRequest.deviceType=F.deviceType),!J.subscribe&&!J.enableLightWeightMeeting){var te=K.getMediaTypes(G);F.telemetryHelper.addOutgoingModalities(te),ee.payload.callInvitation={callModalities:te,replaces:null,transferor:null,links:{progress:z.get(F,W.URL_PATH.PROGRESS),mediaAnswer:z.get(F,W.URL_PATH.MEDIA_ANSWER),acceptance:z.get(F,W.URL_PATH.ACCEPT),redirection:z.get(F,W.URL_PATH.REDIRECTION),end:z.get(F,W.URL_PATH.END)},clientContentForMediaController:F.webRtcSignalingManager.getClientUrls(),mediaContent:B,pstnContent:F.pstnContent,locationContent:F.getLocationContent(),networkContent:F.getNetworkContent(),areaContent:F.getAreaContent(),sharedLineCallInvitationContent:J.sharedLineCallInvitationContent}}if(J.enableLightWeightMeeting&&(ee.payload.lwj={end:z.get(F,W.URL_PATH.LWJ_END),acceptance:z.get(F,W.URL_PATH.LWJ_ACCEPTANCE)}),F.signalingAgentConfig.ecsEtag&&(ee.payload.debugContent={ecsEtag:F.signalingAgentConfig.ecsEtag}),Q&&(ee.payload.debugContent||(ee.payload.debugContent={}),ee.payload.debugContent.causeId=Q),J.clientEndpointDebugContent){ee.payload.debugContent||(ee.payload.debugContent={});try{ee.payload.debugContent.clientDebugContent=JSON.parse(J.clientEndpointDebugContent)}catch(F){K.assert(!1,"Failed to parse ".concat(J.clientEndpointDebugContent))}}return ee}B.getPayload=getPayload},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.getJoinMeetingGroupPayload=void 0;var z=G(5),K=G(9),J=G(3);function getJoinMeetingGroupPayload(F,B,G){J.assertNotNull(F,"signalingSession cannot be null");var Q=B.meetingGroupId,Y=B.groupPreferences;return{payload:W(W({from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},meetingGroup:Q},Y&&{groupPreferences:Y}),{links:{joinMeetingGroupStatus:K.get(F,z.URL_PATH.JOIN_MEETING_GROUP_STATUS)},operationId:G})}}B.getJoinMeetingGroupPayload=getJoinMeetingGroupPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(3);function getPayload(F,B,G,K){z.assertNotNull(F,"signalingSession cannot be null"),z.assertCallEndReason(B);var J={payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},scope:K&&"all"!==K?void 0:K},conversationTransactionEnd:{reason:"noError",code:W.default.CALL_END_CODE.SUCCESS,phrase:W.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:B}};return G&&B.code===W.default.CALL_END_CODE.CANCEL&&(J.payload.callTransactionEnd.callQualityDiagnosticsInformation=G),J}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getLeaveMeetingGroupPayload=void 0;var W=G(5),z=G(9),K=G(3);function getLeaveMeetingGroupPayload(F,B,G){K.assertNotNull(F,"signalingSession cannot be null");var J=B.meetingGroupId;return{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},meetingGroup:J,links:{leaveMeetingGroupStatus:z.get(F,W.URL_PATH.LEAVE_MEETING_GROUP_STATUS)},operationId:G}}}B.getLeaveMeetingGroupPayload=getLeaveMeetingGroupPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){return K.assertNotNull(F,"signalingSession cannot be null"),K.assertNotNull(G,"newOfferLink cannot be null"),{payload:{mediaOfferRequirements:{compatibleContentTypes:B,links:{offerReady:z.get(F,W.URL_PATH.NEW_MEDIA_OFFER)}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B){return K.assertNotNull(B,"signalingSession cannot be null"),{payload:{callTransfer:{target:{id:B.participantManager.localParticipant.id},transferor:{details:{id:B.participantManager.localParticipant.id,endpointId:B.participantManager.localParticipant.endpointId,participantId:B.participantManager.localParticipant.participantId,languageId:B.participantManager.localParticipant.languageId},authorizationToken:null},parkType:F,links:{transferAcceptance:z.get(B,W.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:z.get(B,W.URL_PATH.TRANSFER_COMPLETION)}}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){K.assertNotNull(F,"ParkRequestPayload: signalingSession cannot be null");var J={payload:{hold:{holdType:B,links:{holdCompletion:z.get(F,W.URL_PATH.PARK_COMPLETION)}}}};return G&&(J.payload.debugContent=G),J}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F){return K.assertNotNull(F,"signalingSession cannot be null"),{payload:{callParticipantUpdate:{links:{mediaRenegotiation:z.get(F,W.URL_PATH.MEDIA_RENEGOTIATION),transfer:z.get(F,W.URL_PATH.TRANSFER),replacement:z.get(F,W.URL_PATH.REPLACE),end:z.get(F,W.URL_PATH.END),balanceUpdate:z.get(F,W.URL_PATH.BALANCE_UPDATE),retargetCompletion:z.get(F,W.URL_PATH.RETARGET_COMPLETION)},clientContentForMediaController:F.webRtcSignalingManager.getClientUrls()}}}}B.getPayload=getPayload},function(F,B,G){function getPayload(F,B,G,W,z,K,J){var Q={payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},publishedState:{content:W,level:G,stateType:B,sequenceNumber:z},scope:K}};if(J&&J.length>0){var Y=J.map((function(F){return{id:F}}));Q.payload.to=Y}return Q}Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0,B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B){return W.assertNotNull(F,"signalingSession cannot be null"),W.assertCallEndReason(B),{payload:{callEnd:B}}}B.getPayload=getPayload},function(F,B,G){function getPayload(F,B,G,W,z){var K={from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},sequenceNumber:B,scope:G};return"specified"===G?K.stateIds=W:K.stateType=z,{payload:K}}Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0,B.getPayload=getPayload},function(F,B,G){function getPayload(F,B){return{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},searchOptions:B}}}Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0,B.getPayload=getPayload},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var z=G(5),K=G(9),J=G(3);function getPayload(F,B){return J.assertNotNull(F,"signalingSession cannot be null"),{payload:W(W({from:{id:F.participantManager.localParticipant.id,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId,displayName:F.participantManager.localParticipant.displayName}},B),{links:{setMeetingLayoutStatus:K.get(F,z.URL_PATH.SET_MEETING_LAYOUT_STATUS)}})}}B.getPayload=getPayload},function(F,B,G){function getPayload(){return{payload:{transferAcceptance:{}}}}Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0,B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G,J,Q){return K.assertNotNull(B,"signalingSession cannot be null"),K.assertNotNullOrEmpty(F,"transferTarget cannot be null OR empty"),{payload:{callTransfer:{target:{id:F,endpointType:"TransferTypeVoicemail"===J?"voicemail":void 0},transferor:{details:{id:B.participantManager.localParticipant.id,endpointId:B.participantManager.localParticipant.endpointId,participantId:B.participantManager.localParticipant.participantId,languageId:B.participantManager.localParticipant.languageId},authorizationToken:null},links:{transferAcceptance:z.get(B,W.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:z.get(B,W.URL_PATH.TRANSFER_COMPLETION)},replacementDetails:G,disableForwardingAndUnanswered:Q&&Q.disableForwardingAndUnanswered,transferContext:Q&&Q.clientTransferContext}}}}B.getPayload=getPayload},function(F,B,G){function getPayload(F){return{payload:{transferCompletion:F}}}Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0,B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B){K.assertNotNull(F,"ResumePayload: signalingSession cannot be null");var G={payload:{resume:{links:{resumeCompletion:z.get(F,W.URL_PATH.UNPARK_COMPLETION)}}}};return B&&(G.payload.debugContent=B),G}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B){return W.assertNotNull(B,"clientMetadataJson cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}},endpointMetadata:B}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B){return W.assertNotNull(B,"clientStateJson cannot be null"),{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},endpointState:B}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F){return K.assertNotNull(F,"signalingSession cannot be null"),{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}},links:{end:z.get(F,W.URL_PATH.LWJ_END),acceptance:z.get(F,W.URL_PATH.LWJ_ACCEPTANCE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getMeetingGroupsPayload=void 0;var W=G(5),z=G(9),K=G(3);function getMeetingGroupsPayload(F,B,G){K.assertNotNull(F,"signalingSession cannot be null");var J=B.scope,Q=B.toGroup,Y=B.fromGroup,$=B.participants;"specified"===J&&K.assertNotNull($,"participantsIds cannot be null");var X={from:{id:F.participantManager.localParticipant.id,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId,displayName:F.participantManager.localParticipant.displayName},scope:J,fromGroup:Y,toGroup:Q,links:{updateMeetingGroupsStatus:z.get(F,W.URL_PATH.UPDATE_MEETING_GROUPS_STATUS)},operationId:G};return $&&(X.to=$.map((function(F){return{id:F.mri,endpointId:F.endpointId,participantId:F.participantId}}))),{payload:X}}B.getMeetingGroupsPayload=getMeetingGroupsPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F,B,G){return K.assertNotNull(F,"signalingSession cannot be null"),{payload:{from:{id:F.participantManager.localParticipant.id,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId,displayName:F.participantManager.localParticipant.displayName},meetingLiveState:B,links:{updateMeetingLiveStateStatus:z.get(F,W.URL_PATH.UPDATE_MEETING_LIVE_STATE_STATUS)},operationId:G}}}B.getPayload=getPayload},function(F,B,G){function getPayload(F,B,G){var W={};return void 0!==G.allowRaiseHands&&(W.allowRaiseHands=G.allowRaiseHands),void 0!==G.attendeeRestrictions&&(W.attendeeRestrictions=G.attendeeRestrictions),void 0!==G.lockMeeting&&(W.lockMeeting=G.lockMeeting),void 0!==G.breakoutRoomsEnabled&&(W.breakoutRoomsEnabled=G.breakoutRoomsEnabled),void 0!==G.allowPresentersToManageBreakoutRooms&&(W.allowPresentersToManageBreakoutRooms=G.allowPresentersToManageBreakoutRooms),void 0!==G.disableMdpClientAudioRecording&&(W.disableMdpClientAudioRecording=G.disableMdpClientAudioRecording),void 0!==G.refreshSettings&&(W.refreshSettings=G.refreshSettings),{payload:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},meetingSettings:W,sequenceNumber:B}}}Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0,B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(5),z=G(9),K=G(3);function getPayload(F){K.assertNotNull(F,"signalingSession cannot be null");var B={type:F.signalingAgentConfig.enableDeltaRosterWeb?"Delta":"MultiPartyEndpoint",rosterUpdate:z.get(F,W.URL_PATH.CONV_ROSTER_UPDATE)};return{payload:{participants:{from:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId}},roster:B,links:{conversationEnd:z.get(F,W.URL_PATH.CONV_END),conversationUpdate:z.get(F,W.URL_PATH.CONV_UPDATE),localParticipantUpdate:z.get(F,W.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),confirmUnmute:z.get(F,W.URL_PATH.CONV_CONFIRM_UNMUTE)}}}}B.getPayload=getPayload},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getPayload=void 0;var W=G(3);function getPayload(F,B){return W.assertNotNull(F,"signalingSession cannot be null"),{payload:{mediaAnswer:{sender:{id:F.participantManager.localParticipant.id,displayName:F.participantManager.localParticipant.displayName,endpointId:F.participantManager.localParticipant.endpointId,participantId:F.participantManager.localParticipant.participantId,languageId:F.participantManager.localParticipant.languageId},mediaContent:B,pstnContent:F.pstnContent}}}}B.getPayload=getPayload},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var K=G(8),J=G(46),Q=G(5),Y=G(48),$=G(3),X=G(25),Z=G(288),ee=function(){function TelemetryHelper(F,B,G){var ee=this;this.signalingSession=F,this.callStartTime=G,this.networkRequestsCompleted=[],this.networkRequestsStarted={},this.networkRequests={},this.localOperationsPerformed=[],this.recordedEvents=[],this.rosterUpdates=[],this.contentSharingOperationsPerformed={},this.outgoingModalities=[],this.incomingModalities=[],this.offeredModalities="",this.answeredModalities="",this.vbssOperations=[],this.vbssStarted=!1,this.localOfferAnswerGenerationTimestamps=[],this.trouterWaitOperations=[],this.telemetryData={},this.contentSharingBaseTelemetryData={},this.httpRequestTelemetryData={},this.connectedStopWatch=null,this.preheatedCallSetupDurationWatch=null,this.callCancelationDurationWatch=null,this.timeToRingStopWatch=null,this.isSdpInCallNotification=!1,this.isPreheated=0,this.addBrokerChannel=function(){ee.setMessagingChannel(X.default.MESSAGING_CHANNEL.BROKER)},this.addTrouterChannel=function(){ee.setMessagingChannel(X.default.MESSAGING_CHANNEL.TROUTER)},this.addTrouterWaitOperation=function(F){ee.trouterWaitOperations.push(ee.recordOperation(F))},this.recordIncomingEvent=function(F,B,G){var W=$.extractCauseIdFromMessage(B),z={origin:B.origin,causeId:W,data:G};G||delete z.data,ee.recordEvent(F,z)},this.recordIncomingEventCount=function(F){ee.localOperationsPerformed.push(ee.recordOperation(F));var B=ee.recordedEvents.findIndex((function(B){return B[F]}));if(-1!==B)ee.recordedEvents[B][F]+=1;else{var G={};G[F]=1,ee.recordedEvents.push(G)}},this.recordEvent=function(F,B){ee.logger.debug("Event:",F,B),ee.localOperationsPerformed.push(ee.recordOperation(F));var G={};G[F]=ee.timeSinceCallStart(),B&&(G.data=B),ee.recordedEvents.push(G)},this.recordRosterEvent=function(F,B,G){ee.localOperationsPerformed.push(ee.recordOperation(B));var W={data:F,causeId:G},z={eventName:ee.timeSinceCallStart(),data:W};ee.rosterUpdates.push(z)},this.addOutgoingModalities=function(F){F&&ee.outgoingModalities.push(F)},this.addIncomingModalities=function(F){F&&ee.incomingModalities.push(F)},this.setOfferedModalities=function(F,B){ee.offeredModalities=ee.sdpTelemetryFormat(F,B)},this.setAnsweredModalities=function(F,B){ee.answeredModalities=ee.sdpTelemetryFormat(F,B)},this.setIsSdpInCallNotification=function(F){ee.isSdpInCallNotification=F},this.addVbssOperations=function(F){F&&(F===X.default.VBSS_OPERATION.START?ee.vbssStarted=!0:ee.vbssStarted=!1,ee.vbssOperations.push(ee.recordOperation(F)))},this.addNetworkOperationStarted=function(F){$.tryAddNewKeyToHashTable(ee.networkRequestsStarted,F,ee.recordOperation(F))},this.addNetworkOperationCompleted=function(F,B,G){var W=B?X.default.RESULT_VALUE.SUCCESS:X.default.RESULT_VALUE.FAILURE,z=G?"".concat(F,":").concat(W,":").concat(G):"".concat(F,":").concat(W);ee.networkRequestsCompleted.push(ee.recordOperation(z)),$.tryRemoveKeyFromHashTable(ee.networkRequestsStarted,F)},this.updateNetworkRequest=function(F){ee.networkRequests[F.uid]?K.assign(ee.networkRequests[F.uid],F):ee.networkRequests[F.uid]=F},this.deleteNetworkRequest=function(F){delete ee.networkRequests[F.uid]},this.addContentSharingOperation=function(F,B,G){var W;ee.contentSharingOperationsPerformed[F]||(ee.contentSharingOperationsPerformed[F]=[]);var z=((W={})[B]=ee.timeSinceCallStart(),W);ee.contentSharingOperationsPerformed[F].push(z);var K=ee.contentSharingOperationsPerformed[F].length-1;return G&&ee.updateContentSharingOperation(F,K,G),K},this.updateContentSharingOperation=function(F,B,G){var W,K;if(ee.contentSharingOperationsPerformed[F]){var J=ee.contentSharingOperationsPerformed[F][B],Q=[];try{for(var Y=z(Object.keys(G)),$=Y.next();!$.done;$=Y.next()){var X=$.value;Q.push("".concat(X,": ").concat(G[X]))}}catch(F){W={error:F}}finally{try{$&&!$.done&&(K=Y.return)&&K.call(Y)}finally{if(W)throw W.error}}J.data=Q.join(", ")}},this.setDirection=function(F){ee.telemetryData[X.default.EXTENSIONS.DIRECTION]=F},this.setEndPointId=function(F){ee.telemetryData[X.default.CONTEXT_ID.ENDPOINT_ID]=F,ee.contentSharingBaseTelemetryData[X.default.CONTEXT_ID.ENDPOINT_ID]=F,ee.httpRequestTelemetryData[X.default.CONTEXT_ID.ENDPOINT_ID]=F},this.setParticipantId=function(F){ee.telemetryData[X.default.CONTEXT_ID.PARTICIPANT_ID]=F,ee.contentSharingBaseTelemetryData[X.default.CONTEXT_ID.PARTICIPANT_ID]=F,ee.httpRequestTelemetryData[X.default.CONTEXT_ID.PARTICIPANT_ID]=F},this.setConversationServiceUrl=function(F){ee.telemetryData[X.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=F},this.setMeetingInfo=function(F){F||(ee.telemetryData[X.default.EXTENSIONS.MEETING_INFO]=F)},this.setJoinedFrom=function(F){ee.telemetryData[X.default.EXTENSIONS.JOINED_FROM]=F},this.setMeetingCode=function(F){ee.telemetryData[X.default.EXTENSIONS.MEETING_CODE]=F},this.setMeetingUrl=function(F){ee.telemetryData[X.default.EXTENSIONS.MEETING_URL]=F},this.setSelfParticipantRole=function(F){ee.telemetryData[X.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]=F},this.setScenario=function(F){ee.telemetryData[X.default.EXTENSIONS.SCENARIO]=F},this.setCallerType=function(F){F&&(ee.telemetryData[X.default.EXTENSIONS.CALLER_TYPE]=F.split(":",1)[0])},this.setCalleeType=function(F){F&&(ee.telemetryData[X.default.EXTENSIONS.CALLEE_TYPE]=F.split(":",1)[0])},this.setTerminatingData=function(F){ee.telemetryData[X.default.EXTENSIONS.CALL_TERMINATING_END]=F.terminatingEnd,ee.telemetryData[X.default.EXTENSIONS.CALL_END_CODE]=F.endCode||Q.default.CALL_END_CODE.SUCCESS,ee.telemetryData[X.default.EXTENSIONS.CALL_END_SUB_CODE]=F.endSubCode||Q.default.CALL_END_SUB_CODE.SUCCESS,ee.telemetryData[X.default.EXTENSIONS.CALL_PHRASE]=F.phrase||Q.default.CALL_END_PHRASE.UNKNOWN,ee.telemetryData[X.default.EXTENSIONS.RESULT_VALUE]=F.resultValue||X.default.RESULT_VALUE.SUCCESS,ee.telemetryData[X.default.EXTENSIONS.RESULT_DETAIL]=F.resultDetail||"Call gracefully hungup",ee.telemetryData[X.default.EXTENSIONS.RESULT_CAUSE_ID]=F.causeId||"unknown",ee.telemetryData[X.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=F.resultCategories||[],ee.telemetryData[X.default.EXTENSIONS.CALL_END_CLIENT_SUB_CODE]=F.clientReasonSubCode,ee.telemetryData[X.default.EXTENSIONS.CALL_END_CLIENT_PHRASE]=F.clientReasonPhrase},this.startCallInitializationWatch=function(F){ee.timeToRingStopWatch=Y.build(),F&&(ee.timeToRingStopWatch.msElapsed+=F)},this.startCallConnectedWatch=function(){ee.connectedStopWatch=Y.build()},this.setIsPreheated=function(){ee.isPreheated=1},this.startPreheatedCallSetupDurationWatch=function(){ee.preheatedCallSetupDurationWatch=Y.build()},this.stopPreheatedCallSetupDurationWatch=function(){ee.preheatedCallSetupDurationWatch.pause()},this.startCallCancelationDurationWatch=function(){ee.callCancelationDurationWatch=Y.build()},this.stopCallCancelationDurationWatch=function(){ee.callCancelationDurationWatch&&ee.callCancelationDurationWatch.pause()},this.getCallCancelationDuration=function(){return ee.callCancelationDurationWatch?ee.callCancelationDurationWatch.durationInSeconds():0},this.resetCallCancelationDurationWatch=function(){ee.callCancelationDurationWatch=null},this.setOfferAnswerGenerationTimestamps=function(F){ee.localOfferAnswerGenerationTimestamps.push(ee.recordOperation(F))},this.setTimeToRingDuration=function(){ee.timeToRingStopWatch&&(ee.telemetryData[X.default.EXTENSIONS.TIME_TO_RING_IN_MS]=ee.timeToRingStopWatch.duration(),ee.timeToRingStopWatch=null)},this.dispose=function(){ee.sendCallModalityTelemetryData(),ee.sendHttpTelemetryData()},this.setMessagingChannel=function(F){ee.telemetryData[X.default.EXTENSIONS.MESSAGING_CHANNEL]||(ee.telemetryData[X.default.EXTENSIONS.MESSAGING_CHANNEL]=[]),ee.telemetryData[X.default.EXTENSIONS.MESSAGING_CHANNEL].some((function(B){return-1!==B.indexOf(F)}))||ee.telemetryData[X.default.EXTENSIONS.MESSAGING_CHANNEL].push(ee.recordOperation(F))},this.sendHttpTelemetryData=function(){var F=W({},ee.httpRequestTelemetryData);F[X.default.CONTEXT_ID.CORRELATION_ID]=ee.signalingSession.correlationId,F[X.default.CONTEXT_ID.SIGNALING_SESSION_ID]=ee.signalingSession.sessionId,F[X.default.EXTENSIONS.CLIENT_INFORMATION]=ee.signalingSession.signalingAgentConfig.clientInformation;var B=Object.keys(ee.networkRequests).map((function(F){return delete ee.networkRequests[F].uid,ee.networkRequests[F]})),G=JSON.stringify({eventStart:ee.callStartTime,events:B});F[X.default.EXTENSIONS.NETWORK_REQUESTS_BAG]=G,ee.telemetryLogger.logHttpTelemetryEvent(F)},this.sdpTelemetryFormat=function(F,B){var G,W;if(!F)return"";var convertType=function(F){switch(F){case"main-audio":return"Audio";case"main-video":return"Video";case"applicationsharing-video":return"AppSharing";default:return}},convertDirection=function(F){switch(F){case"inactive":return"Inactive";case"sendonly":return B?"ReceiveFromPeer":"SendToPeer";case"recvonly":return B?"SendToPeer":"ReceiveFromPeer";default:return"Bidirectional"}},K={"main-audio":0,"main-video":0,"applicationsharing-video":0},Q=[],Y=J.parse(F);try{for(var $=z(Y.media),X=$.next();!X.done;X=$.next()){var Z=X.value,ee=convertType(Z.label);if(ee){var te=K[Z.label]++,ne=convertDirection(Z.direction);Q.push("".concat(ee,"[").concat(te,"] = ").concat(ne))}}}catch(F){G={error:F}}finally{try{X&&!X.done&&(W=$.return)&&W.call($)}finally{if(G)throw G.error}}return Q.join(", ")},this.logger=F.logger,this.telemetryLogger=Z.getLogger(F,this.logger),this.telemetryData[X.default.EXTENSIONS.CALL_START_TIME]=this.callStartTime,this.telemetryData[X.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=F.signalingAgentConfig.conversationServiceUrl,this.fillCommonData(B,this.telemetryData),this.fillCommonData(B,this.httpRequestTelemetryData),this.fillCommonData(B,this.contentSharingBaseTelemetryData)}return TelemetryHelper.prototype.fillCommonData=function(F,B){B[X.default.EXTENSIONS.APPLICATION_TYPE]=F.applicationType,B[X.default.EXTENSIONS.RING]=F.ring,B[X.default.EXTENSIONS.TENANT_ID]=F.tenantId,B[X.default.EXTENSIONS.USER_HEX_CID]=F.userHexCID,B[X.default.EXTENSIONS.ACS_RESOURCE_ID]=F.acsResourceId,B[X.default.EXTENSIONS.REGION]=F.region,B[X.default.EXTENSIONS.PARTITION]=F.partition},TelemetryHelper.prototype.addChangingCorrelationId=function(F,B){this.telemetryData[X.default.EXTENSIONS.CHANGING_CORRELATION_ID_OLD_ID]=F,this.telemetryData[X.default.EXTENSIONS.CHANGING_CORRELATION_ID_NEW_ID]=B},TelemetryHelper.prototype.addSharedCorrelationId=function(F){this.telemetryData[X.default.CONTEXT_ID.SHARED_CORRELATION_ID]=F},TelemetryHelper.prototype.sendContentSharingTelemetryData=function(F,B,G,z,K,J){var Q=W({},this.contentSharingBaseTelemetryData),Y=this.contentSharingOperationsPerformed[F];Y&&(Q[X.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=JSON.stringify(Y)),Q[X.default.CONTEXT_ID.CONTENT_SHARING_CORRELATION_ID]=F,Q[X.default.CONTEXT_ID.SIGNALING_SESSION_ID]=B,Q[X.default.CONTEXT_ID.CONTENT_SHARING_ID]=J||"",Q[X.default.EXTENSIONS.CONTENT_SHARING_SERVICE_URL]=K,Q[X.default.EXTENSIONS.CONTENT_SHARING_DIRECTION]=G?X.default.DIRECTION.OUTGOING:X.default.DIRECTION.INCOMING,Q[X.default.EXTENSIONS.CALL_END_CODE]=z.code,Q[X.default.EXTENSIONS.CALL_END_SUB_CODE]=z.subCode,Q[X.default.EXTENSIONS.CALL_PHRASE]=z.phrase,Q[X.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(z.resultCategories),Q[X.default.EXTENSIONS.CALL_END_CAUSE_ID]=z.causeId,Q[X.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,delete this.contentSharingOperationsPerformed[F],this.telemetryLogger.logConversationContentSharingEvent(Q)},TelemetryHelper.prototype.recordOperation=function(F){return"".concat(F,":").concat(this.timeSinceCallStart())},TelemetryHelper.prototype.timeSinceCallStart=function(){return(new Date).getTime()-this.callStartTime},TelemetryHelper.prototype.sendCallModalityTelemetryData=function(){var F,B;this.vbssStarted&&this.addVbssOperations(X.default.VBSS_OPERATION.CALL_END);var durationMsToS=function(F){return"number"==typeof F?F/1e3:0};if(this.telemetryData[X.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,this.telemetryData[X.default.EXTENSIONS.CALL_END_TIME]=(new Date).getTime(),this.connectedStopWatch&&(this.telemetryData[X.default.EXTENSIONS.CONNECTED_DURATION_IN_MS]=this.connectedStopWatch.duration()),this.telemetryData[X.default.EXTENSIONS.IS_PREHEATED]=this.isPreheated,this.preheatedCallSetupDurationWatch&&(this.telemetryData[X.default.EXTENSIONS.PREHEATED_CALL_SETUP_DURATION_IN_S]=durationMsToS(this.preheatedCallSetupDurationWatch.duration())),this.callCancelationDurationWatch&&(this.telemetryData[X.default.EXTENSIONS.CALL_CANCELATION_DURATION_IN_S]=durationMsToS(this.callCancelationDurationWatch.duration())),this.networkRequestsCompleted.length&&(this.telemetryData[X.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=JSON.stringify(this.networkRequestsCompleted)),this.localOperationsPerformed.length&&(this.telemetryData[X.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=JSON.stringify(this.localOperationsPerformed)),this.trouterWaitOperations.length&&(this.telemetryData[X.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS]=JSON.stringify(this.trouterWaitOperations)),this.localOfferAnswerGenerationTimestamps.length&&(this.telemetryData[X.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=JSON.stringify(this.localOfferAnswerGenerationTimestamps)),this.incomingModalities.length&&(this.telemetryData[X.default.EXTENSIONS.INCOMING_MODALITIES]=JSON.stringify(this.incomingModalities)),this.outgoingModalities.length&&(this.telemetryData[X.default.EXTENSIONS.OUTGOING_MODALITIES]=JSON.stringify(this.outgoingModalities)),this.offeredModalities.length&&(this.telemetryData[X.default.EXTENSIONS.OFFERED_MODALITIES]=this.offeredModalities),this.answeredModalities.length&&(this.telemetryData[X.default.EXTENSIONS.ANSWERED_MODALITIES]=this.answeredModalities),this.telemetryData[X.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(this.telemetryData[X.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]),this.telemetryData[X.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION]=this.isSdpInCallNotification.toString(),this.vbssOperations.length&&(this.telemetryData[X.default.EXTENSIONS.VBSS_OPERATIONS]=JSON.stringify(this.vbssOperations)),this.recordedEvents.length){var G=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents});this.telemetryData[X.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=G}if(this.rosterUpdates.length){var W=JSON.stringify({eventStart:this.callStartTime,events:this.rosterUpdates});this.telemetryData[X.default.EXTENSIONS.ROSTER_UPDATES_BAG]=W}var K=[];try{for(var J=z(Object.keys(this.networkRequestsStarted)),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;K.push(this.networkRequestsStarted[Y])}}catch(B){F={error:B}}finally{try{Q&&!Q.done&&(B=J.return)&&B.call(J)}finally{if(F)throw F.error}}K.length>0&&(this.telemetryData[X.default.EXTENSIONS.NETWORK_REQUESTS_PENDING]=JSON.stringify(K)),this.telemetryLogger.logConversationCallModalityEvent(this.telemetryData)},TelemetryHelper.prototype.getResultCategoryString=function(F){return F&&Array.isArray(F)?F.join(","):""},TelemetryHelper}();B.default=ee},function(F,B,G){var toIntIfInt=function(F){return String(Number(F))===F?Number(F):F},attachProperties=function(F,B,G,W){if(W&&!G)B[W]=toIntIfInt(F[1]);else for(var z=0;z<G.length;z+=1)null!=F[z+1]&&(B[G[z]]=toIntIfInt(F[z+1]))},parseReg=function(F,B,G){var W=F.name&&F.names;F.push&&!B[F.push]?B[F.push]=[]:W&&!B[F.name]&&(B[F.name]={});var z=F.push?{}:W?B[F.name]:B;attachProperties(G.match(F.reg),z,F.names,F.name),F.push&&B[F.push].push(z)},W=G(109),z=RegExp.prototype.test.bind(/^([a-z])=(.*)/);B.parse=function(F){var B={},G=[],K=B;return F.split(/(\r\n|\r|\n)/).filter(z).forEach((function(F){var B=F[0],z=F.slice(2);"m"===B&&(G.push({rtp:[],fmtp:[]}),K=G[G.length-1]);for(var J=0;J<(W[B]||[]).length;J+=1){var Q=W[B][J];if(Q.reg.test(z))return parseReg(Q,K,z)}})),B.media=G,B};var paramReducer=function(F,B){var G=B.split(/=(.+)/,2);return 2===G.length?F[G[0]]=toIntIfInt(G[1]):1===G.length&&B.length>1&&(F[G[0]]=void 0),F};B.parseParams=function(F){return F.split(/;\s?/).reduce(paramReducer,{})},B.parseFmtpConfig=B.parseParams,B.parsePayloads=function(F){return F.toString().split(" ").map(Number)},B.parseRemoteCandidates=function(F){for(var B=[],G=F.split(" ").map(toIntIfInt),W=0;W<G.length;W+=3)B.push({component:G[W],ip:G[W+1],port:G[W+2]});return B},B.parseImageAttributes=function(F){return F.split(" ").map((function(F){return F.substring(1,F.length-1).split(",").reduce(paramReducer,{})}))},B.parseSimulcastStreamList=function(F){return F.split(";").map((function(F){return F.split(",").map((function(F){var B,G=!1;return"~"!==F[0]?B=toIntIfInt(F):(B=toIntIfInt(F.substring(1,F.length)),G=!0),{scid:B,paused:G}}))}))}},function(F,B,G){var W=G(109),z=/%[sdv%]/g,format=function(F){var B=1,G=arguments,W=G.length;return F.replace(z,(function(F){if(B>=W)return F;var z=G[B];switch(B+=1,F){case"%%":return"%";case"%s":return String(z);case"%d":return Number(z);case"%v":return""}}))},makeLine=function(F,B,G){var W=[F+"="+(B.format instanceof Function?B.format(B.push?G:G[B.name]):B.format)];if(B.names)for(var z=0;z<B.names.length;z+=1){var K=B.names[z];B.name?W.push(G[B.name][K]):W.push(G[B.names[z]])}else W.push(G[B.name]);return format.apply(null,W)},K=["v","o","s","i","u","e","p","c","b","t","r","z","a"],J=["i","c","b","a"];F.exports=function(F,B){B=B||{},null==F.version&&(F.version=0),null==F.name&&(F.name=" "),F.media.forEach((function(F){null==F.payloads&&(F.payloads="")}));var G=B.outerOrder||K,z=B.innerOrder||J,Q=[];return G.forEach((function(B){W[B].forEach((function(G){G.name in F&&null!=F[G.name]?Q.push(makeLine(B,G,F)):G.push in F&&null!=F[G.push]&&F[G.push].forEach((function(F){Q.push(makeLine(B,G,F))}))}))})),F.media.forEach((function(F){Q.push(makeLine("m",W.m[0],F)),z.forEach((function(B){W[B].forEach((function(G){G.name in F&&null!=F[G.name]?Q.push(makeLine(B,G,F)):G.push in F&&null!=F[G.push]&&F[G.push].forEach((function(F){Q.push(makeLine(B,G,F))}))}))}))})),Q.join("\r\n")+"\r\n"}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.getLogger=B.TelemetryLogger=void 0;var W=G(17),z=G(25),K=function(){function TelemetryLogger(F,B){var G=this;this.signalingSession=F,this.logger=B,this.logConversationCallModalityEvent=function(F){var B=G.createCallModalityEvent(F);G.logger.info("sending modality telemetry:",G.getStringifiedEventData(B)),B.hostName=G.getHostDomainInfo(),G.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(z.default.EVENT_TYPE.CONVERSATION_CALL_MODALITY,B)},this.logConversationContentSharingEvent=function(F){F[z.default.CONTEXT_ID.CORRELATION_ID]=G.signalingSession.correlationId,F[z.default.EXTENSIONS.ECS_ETAG]=G.signalingSession.signalingAgentConfig.ecsEtag,G.logger.info("sending content sharing telemetry:",G.getStringifiedEventData(F)),F.hostName=G.getHostDomainInfo(),G.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(z.default.EVENT_TYPE.CONVERSATION_CONTENT_SHARING,F)},this.logHttpTelemetryEvent=function(F){F[z.default.EXTENSIONS.ECS_ETAG]=G.signalingSession.signalingAgentConfig.ecsEtag,F[z.default.SIGNALING_CONFIG]=G.getSignalingAgentConfig(),G.logger.info("sending http telemetry:",G.getStringifiedEventData(F)),F.hostName=G.getHostDomainInfo(),G.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(z.default.EVENT_TYPE.CONVERSATION_HTTP_REQUEST,F)},this.getHostDomainInfo=function(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost":"<redacted>"},this.getSignalingAgentConfig=function(){var F=[],B=G.signalingSession.signalingAgentConfig;return B.supportsCompressedServicePayload&&F.push(z.default.SIGNALING_CONFIG_FLAGS.SUPPORTS_COMPRESSED_PAYLOAD),B.brokerEnabledOutgoing&&F.push(z.default.SIGNALING_CONFIG_FLAGS.BROKER_OUTGOING_ENABLED),B.brokerEnabledIncoming&&F.push(z.default.SIGNALING_CONFIG_FLAGS.BROKER_INCOMING_ENABLED),B.brokerRequestBatching&&F.push(z.default.SIGNALING_CONFIG_FLAGS.BROKER_REQUEST_BATCHING_ENABLED),B.brokerExclusively&&F.push(z.default.SIGNALING_CONFIG_FLAGS.BROKER_EXCLUSIVELY_ENABLED),B.supportsSynchronousTrouterResponse&&F.push(z.default.SIGNALING_CONFIG_FLAGS.SYNC_TROUTER_RESPONSE),B.handleMediaOfferFromPushNotification&&F.push(z.default.SIGNALING_CONFIG_FLAGS.HANDLE_OFFER_FROM_NOTIFICATION),B.handleNewOfferRequest&&F.push(z.default.SIGNALING_CONFIG_FLAGS.HANDLE_NEW_OFFER_REQUEST),B.sendProgressFromCC&&F.push(z.default.SIGNALING_CONFIG_FLAGS.SEND_PROGRESS_FROM_CC),B.handleUnmuteMuteFromResponse&&F.push(z.default.SIGNALING_CONFIG_FLAGS.HANDLE_UNMUTE_MUTE_FROM_RESPONSE),B.useInternalHttpDispatcher&&F.push(z.default.SIGNALING_CONFIG_FLAGS.INTERNAL_HTTP_DISPATCHER),B.enableTokenCache&&F.push(z.default.SIGNALING_CONFIG_FLAGS.ENABLE_TOKEN_CACHE),B.enableTokenPrefetch&&F.push(z.default.SIGNALING_CONFIG_FLAGS.ENABLE_TOKEN_PREFETCH),B.processSelfDataFromSubscribeResponse&&F.push(z.default.SIGNALING_CONFIG_FLAGS.PROCESS_SELF_DATA_FROM_SUBSCRIBE_RESPONSE),B.supportMediaRetargetWhileIncomingRenegotiation&&F.push(z.default.SIGNALING_CONFIG_FLAGS.SUPPORT_MEDIA_RETARGET_WHILE_INCOMING_RENEGOTIATION),B.enableErrorCodeImprovementsForNetworkFailures&&F.push(z.default.SIGNALING_CONFIG_FLAGS.ENABLE_ERROR_CODE_IMPROVEMENTS_FOR_NETWORK_FAILURES),B.enableCallEstablishmentTimeoutsForStartJoinCall&&F.push(z.default.SIGNALING_CONFIG_FLAGS.ENABLE_CALL_ESTABLISHMENT_TIMEOUTS_FOR_START_OR_JOIN_CALL),F.push(z.default.SIGNALING_CONFIG_FLAGS.SERVER_MUTE_UNMUTE),F.join(",")},this.getStringifiedEventData=function(F){try{return JSON.stringify(F)}catch(F){return"invalid data"}}}return TelemetryLogger.prototype.createCallModalityEvent=function(F){var B={};B.Type=z.default.SOURCE.NGC_SOURCE;var setEventPropertyIfRecorded=function(G,W){void 0===W&&(W=!1),F.hasOwnProperty(G)&&(B[G]=W?JSON.stringify(F[G]):F[G])};return B.ResultDetail=F[z.default.EXTENSIONS.RESULT_DETAIL],B.ResultValue=F[z.default.EXTENSIONS.RESULT_VALUE],B.ResultCode=F[z.default.EXTENSIONS.CALL_END_CODE],B.ResultCauseId=F[z.default.EXTENSIONS.RESULT_CAUSE_ID],B[z.default.SIGNALING_CONFIG]=this.getSignalingAgentConfig(),B[z.default.CONTEXT_ID.CORRELATION_ID]=this.signalingSession.correlationId,B[z.default.CONTEXT_ID.SIGNALING_SESSION_ID]=this.signalingSession.sessionId,B[z.default.CONTEXT_ID.ENDPOINT_ID]=F[z.default.CONTEXT_ID.ENDPOINT_ID],B[z.default.CONTEXT_ID.PARTICIPANT_ID]=F[z.default.CONTEXT_ID.PARTICIPANT_ID],B[z.default.EXTENSIONS.ECS_ETAG]=this.signalingSession.signalingAgentConfig.ecsEtag,B[z.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=F[z.default.EXTENSIONS.CONVERSATION_SERVICE_URL],B[z.default.EXTENSIONS.CALL_START_TIME]=JSON.stringify(F[z.default.EXTENSIONS.CALL_START_TIME]),B[z.default.EXTENSIONS.CALL_END_TIME]=JSON.stringify(F[z.default.EXTENSIONS.CALL_END_TIME]),B[z.default.EXTENSIONS.MESSAGING_CHANNEL]=JSON.stringify(F[z.default.EXTENSIONS.MESSAGING_CHANNEL]),B[z.default.EXTENSIONS.IS_GROUP_CALL]=this.signalingSession.multiParty?"true":"false",B[z.default.EXTENSIONS.IS_HOSTLESS_CALL]=this.signalingSession.isHostLessCall?"true":"false",B[z.default.EXTENSIONS.IS_CAST_CALL]=this.signalingSession.isCastCall?"true":"false",B[z.default.EXTENSIONS.IS_ON_BEHALF_OF_CALL]=this.signalingSession.onBehalfOf?"true":"false",B[z.default.EXTENSIONS.CLIENT_INFORMATION]=F[z.default.EXTENSIONS.CLIENT_INFORMATION],B[z.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION]=F[z.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION],B[z.default.EXTENSIONS.CALL_TERMINATING_END]=F[z.default.EXTENSIONS.CALL_TERMINATING_END],B[z.default.EXTENSIONS.CALL_END_CODE]=JSON.stringify(F[z.default.EXTENSIONS.CALL_END_CODE]),B[z.default.EXTENSIONS.CALL_END_SUB_CODE]=JSON.stringify(F[z.default.EXTENSIONS.CALL_END_SUB_CODE]),setEventPropertyIfRecorded(z.default.CONTEXT_ID.SHARED_CORRELATION_ID),setEventPropertyIfRecorded(z.default.EXTENSIONS.DIRECTION),setEventPropertyIfRecorded(z.default.EXTENSIONS.SELF_PARTICIPANT_ROLE),setEventPropertyIfRecorded(z.default.EXTENSIONS.CONNECTED_DURATION_IN_MS,!0),setEventPropertyIfRecorded(z.default.EXTENSIONS.TIME_TO_RING_IN_MS,!0),setEventPropertyIfRecorded(z.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED),setEventPropertyIfRecorded(z.default.EXTENSIONS.NETWORK_REQUESTS_PENDING),setEventPropertyIfRecorded(z.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED),setEventPropertyIfRecorded(z.default.EXTENSIONS.EVENT_TIMESTAMP_BAG),setEventPropertyIfRecorded(z.default.EXTENSIONS.ROSTER_UPDATES_BAG),setEventPropertyIfRecorded(z.default.EXTENSIONS.NETWORK_REQUESTS_BAG),setEventPropertyIfRecorded(z.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS),setEventPropertyIfRecorded(z.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS),setEventPropertyIfRecorded(z.default.EXTENSIONS.OUTGOING_MODALITIES),setEventPropertyIfRecorded(z.default.EXTENSIONS.INCOMING_MODALITIES),setEventPropertyIfRecorded(z.default.EXTENSIONS.OFFERED_MODALITIES),setEventPropertyIfRecorded(z.default.EXTENSIONS.ANSWERED_MODALITIES),setEventPropertyIfRecorded(z.default.EXTENSIONS.VBSS_OPERATIONS),setEventPropertyIfRecorded(z.default.EXTENSIONS.CALLER_TYPE),setEventPropertyIfRecorded(z.default.EXTENSIONS.CALLEE_TYPE),setEventPropertyIfRecorded(z.default.EXTENSIONS.SCENARIO),setEventPropertyIfRecorded(z.default.EXTENSIONS.PREHEATED_CALL_SETUP_DURATION_IN_S),setEventPropertyIfRecorded(z.default.EXTENSIONS.CALL_CANCELATION_DURATION_IN_S),setEventPropertyIfRecorded(z.default.EXTENSIONS.IS_PREHEATED),setEventPropertyIfRecorded(z.default.EXTENSIONS.ACS_RESOURCE_ID),setEventPropertyIfRecorded(z.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES),setEventPropertyIfRecorded(z.default.EXTENSIONS.APPLICATION_TYPE),setEventPropertyIfRecorded(z.default.EXTENSIONS.RING),setEventPropertyIfRecorded(z.default.EXTENSIONS.REGION),setEventPropertyIfRecorded(z.default.EXTENSIONS.PARTITION),setEventPropertyIfRecorded(z.default.EXTENSIONS.JOINED_FROM),setEventPropertyIfRecorded(z.default.EXTENSIONS.MEETING_URL),setEventPropertyIfRecorded(z.default.EXTENSIONS.MEETING_CODE),setEventPropertyIfRecorded(z.default.EXTENSIONS.USER_HEX_CID),this.signalingSession.callType&&(B[z.default.EXTENSIONS.CALL_TYPE]=this.signalingSession.callType),this.signalingSession.signalingAgentConfig.testCall&&(B[z.default.EXTENSIONS.TEST_CONTEXT_ID]="Test"),this.signalingSession.groupId&&(B[z.default.CONTEXT_ID.GROUP_ID]=W.scrubMriOrOmit(this.signalingSession.groupId)),this.signalingSession.threadId&&(B[z.default.CONTEXT_ID.THREAD_ID]=W.getLoggableThreadId(this.signalingSession.threadId)),this.signalingSession.teamsMessageId&&(B[z.default.CONTEXT_ID.TEAMS_MESSAGEID]=this.signalingSession.teamsMessageId),this.signalingSession.getMeetingInfo()&&(B[z.default.CONTEXT_ID.TEAMS_MEETINGINFO]=JSON.stringify(this.signalingSession.getMeetingInfo())),this.signalingSession.multiParty&&0===this.signalingSession.numberOfOriginalInvitees&&F.hasOwnProperty(z.default.EXTENSIONS.SELF_PARTICIPANT_ROLE)&&F[z.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]===z.default.ROLE.CALLER&&(B[z.default.EXTENSIONS.IS_MEETUP_CALL]="true"),B},TelemetryLogger}();function getLogger(F,B){return new K(F,B)}B.TelemetryLogger=K,B.getLogger=getLogger},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(14),z=G(25),K=G(5),J=G(9),Q=G(3),Y=function(){function WebRtcSignalingManager(F,B){var G=this;this.disposed=!1,this.lastSeenSeqNumbers={},this.isDominantSpeakerInfoLinkEnabled=!0,this.getClientUrls=function(){var F=null;return G.isWebRtcCall&&(F={controlVideoStreaming:J.get(G.signalingSession,K.URL_PATH.CONTROL_VIDEO_STREAMING),csrcInfo:J.get(G.signalingSession,K.URL_PATH.CSRC_INFO)},G.isDominantSpeakerInfoLinkEnabled&&(F.dominantSpeakerInfo=J.get(G.signalingSession,K.URL_PATH.DOMINANT_SPEAKER_INFO))),F},this.handleDominantSpeakerInfo=function(F){var B=F.body;G.logger.debug("handleDominantSpeakerInfo : ",(0,W.getPrintableObject)(B)),G.signalingSession.telemetryHelper.recordIncomingEventCount(z.EVENTS.HANDLE_DOMINANT_SPEAKER_CHANGED_COUNT),G.handleWebRtcNotification(K.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO,B.dominantSpeakerInformation)},this.handleControlVideoStreaming=function(F){var B=F.body;G.logger.debug("handleControlVideoStreaming: ",(0,W.getPrintableObject)(B)),G.signalingSession.telemetryHelper.recordIncomingEvent(z.EVENTS.HANDLE_CONTROL_VIDEO_STREAMING,F),G.handleWebRtcNotification(K.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING,B.controlVideoStreaming)},this.handleCsrcInfo=function(F){var B=F.body;G.logger.debug("handleCsrcInfo : ",(0,W.getPrintableObject)(B)),G.signalingSession.telemetryHelper.recordIncomingEvent(z.EVENTS.HANDLE_CSRC_INFO,F),G.handleWebRtcNotification(K.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO,B.csrcInfo)},this.sendWebRtcMediaNotificationAsync=function(F,B){var z=F.operation,J=F.requestUrl,Y=F.requestBody,$=F.stackRetry,X=void 0===$||$;G.logger.info("sendWebRtcMediaNotificationAsync"),Q.assert(G.isWebRtcCall,"this is not a webrtc call"),Q.assertNotNullOrEmpty(J,"correct media notification requestUrl is not provided"),Q.assertNotNullOrEmpty(Y,"media notification requestBody cannot be null or empty");var Z=Q.defer(),ee={url:J,payload:{payload:Y},requestName:z,withoutTrouter:!0,causeId:B};return X||(ee.disableRetry=!0),G.signalingSession.http.sendPostRequest(ee).then((function(){G.disposed||Z.resolve()})).catch((function(F){var B=(0,W.getPrintableObject)(F);if(G.logger.error("sendWebRtcMediaNotificationAsync failed because : ".concat(B)),!G.disposed){var z=new Error(F);z.endCode=K.default.CALL_END_NETWORK_ERROR,Z.reject(z)}})),Z.promise},this.dispose=function(){G.logger.info("WebRtcSignalingManager :: dispose"),G.disposed=!0},this.signalingSession=F,this.signalingSessionCallback=B,this.isWebRtcCall=F.signalingAgentConfig.isWebRtcEnabled,this.logger=F.logger,this.lastSeenSeqNumbers[K.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING]=-1,this.lastSeenSeqNumbers[K.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO]=-1,this.lastSeenSeqNumbers[K.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO]=-1}return WebRtcSignalingManager.prototype.getIsDominantSpeakerInfoLinkEnabled=function(){return this.isDominantSpeakerInfoLinkEnabled},WebRtcSignalingManager.prototype.setIsDominantSpeakerInfoLinkEnabled=function(F){this.isDominantSpeakerInfoLinkEnabled=F},WebRtcSignalingManager.prototype.handleWebRtcNotification=function(F,B){Q.assert(this.isWebRtcCall,"ignoring message in non-webrtc call");var G=this.lastSeenSeqNumbers[F];B.sequenceNumber<=G?this.logger.info("ignoring ".concat(F," . Last seen seq = ").concat(G)+" current seq = ".concat(B.sequenceNumber)):(this.lastSeenSeqNumbers[F]=B.sequenceNumber,this.signalingSessionCallback.onWebRtcMediaNotification(F,B))},WebRtcSignalingManager}();B.default=Y},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function SkypeConCoreTelemetryManager(F,B){this.appTelemetryManager=F,this.skypeConcoreToken=B}return SkypeConCoreTelemetryManager.prototype.sendEvent=function(F,B){this.appTelemetryManager.sendEvent(this.skypeConcoreToken,F,B)},SkypeConCoreTelemetryManager}();B.default=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.generateAliasedMri=B.stripMriAliases=B.PSTN_MRI_PREFIX=B.MRI_SIP_PREFIX=B.MRI_ALIAS_PREFIX=B.MRI_SKYPE_PREFIX=void 0;var W=/;aliases=.*$/i;function stripMriAliases(F){return F?F.replace(W,""):F}function generateAliasedMri(F,G){var W=F;return G&&(W+=B.MRI_ALIAS_PREFIX+B.MRI_SIP_PREFIX+G),W}B.MRI_SKYPE_PREFIX="8:",B.MRI_ALIAS_PREFIX=";aliases=",B.MRI_SIP_PREFIX="2:",B.PSTN_MRI_PREFIX="4:",B.stripMriAliases=stripMriAliases,B.generateAliasedMri=generateAliasedMri},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.isPhaseError=B.isOneOfPhaseErrors=void 0;var K=G(14),isOneOfPhaseErrors=function(F,B){return B&&void 0!==B.phase&&!!F[B.phase]};B.isOneOfPhaseErrors=isOneOfPhaseErrors;var isPhaseError=function(F,B){return B&&void 0!==B.phase&&B.phase===F};function createPhaseExecutor(F){var B=this,G={},recordPhaseStep=function(F){var B={status:"Pending"};G[F]=B},recordStepDoneTelemetry=function(F,B){G[F].t=B,delete G[F].status},recordStepFailedTelemetry=function(F,B,W){G[F].status="Failed",G[F].t=B,G[F].reason=(0,K.getPrintableObject)(W)};return{execute:function(J,Q){return W(B,void 0,void 0,(function(){var B,W,Y,$,X;return z(this,(function(z){switch(z.label){case 0:B=F.createChild("[phase=".concat(J,"]")),recordPhaseStep(J),B.info("started"),W=(new Date).getTime(),z.label=1;case 1:return z.trys.push([1,3,,4]),[4,Q()];case 2:return Y=z.sent(),X=+new Date-W,B.logSuccess("done, time=".concat(X)),recordStepDoneTelemetry(J,X),[2,Y];case 3:throw $=z.sent(),X=+new Date-W,B.logFailure("time=".concat(X,", error=").concat((0,K.getPrintableObject)($))),recordStepFailedTelemetry(J,X,$),{phase:J,error:$,phases:G};case 4:return[2]}}))}))},executeSync:function(B,W){var z=F.createChild("[phase=".concat(B,"]"));z.info("started"),recordPhaseStep(B);var J=(new Date).getTime();try{var Q=W(),Y=+new Date-J;return recordStepDoneTelemetry(B,Y),z.logSuccess("done, time=".concat(Y)),Q}catch(F){Y=+new Date-J;throw z.logFailure("time=".concat(Y,", error=").concat((0,K.getPrintableObject)(F))),recordStepFailedTelemetry(B,Y,F),{phase:B,error:F,phases:G}}},getTelemetryData:function(){return G}}}B.isPhaseError=isPhaseError,B.default=createPhaseExecutor},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.MediaControlPlane=void 0;var Y=G(15),$=G(26),X=G(38),Z=18,ee=4294967292,te=function(F){function MediaControlPlane(B,G,W){var z=F.call(this)||this;return z.dcAdapter=B,z.logger=G,z.mcpConfig=W,z.dcSend=null,z.telemetryLogger=new ne,z.handshakePromise=new X.SettablePromise,z.isStarted=!1,z}return z(MediaControlPlane,F),MediaControlPlane.prototype.dispose=function(){F.prototype.dispose.call(this),this.isStarted&&this.dcAdapter.removeHandler(Z),this.handshakePromise.promise.catch((function(){})),this.handshakePromise.reject("mcp disposed"),this.dcSend=null},MediaControlPlane.prototype.getTelemetryReport=function(){return this.logger.debug("MCP telemetry ".concat(JSON.stringify(this.telemetryLogger.getReport()))),this.telemetryLogger.getReport()},MediaControlPlane.prototype.sendMsg=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){switch(B.label){case 0:return[4,this.handshakePromise.promise];case 1:return B.sent(),[2,this.sendMsgInternal(F)]}}))}))},MediaControlPlane.prototype.start=function(){var F=this;if(!this.isStarted&&this.mcpConfig){this.isStarted=!0;var B={onStarted:function(B,G){return K(F,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.logger.info("Data channel handler is started ".concat(B)),this.telemetryLogger.logStarted(),this.dcSend=G,[4,this.startHandshake()];case 1:return F.sent(),[2]}}))}))},onStopped:function(B){return K(F,void 0,void 0,(function(){return J(this,(function(F){return this.logger.info("Data channel handler is stopped ".concat(B)),this.telemetryLogger.logStopped(),this.dcSend=null,[2]}))}))},onDataReceived:function(B,G,W){return K(F,void 0,void 0,(function(){return J(this,(function(F){return this.processIncomingData(G),[2]}))}))}};this.dcAdapter.addHandler(Z,B)}},MediaControlPlane.prototype.startHandshake=function(){return K(this,void 0,void 0,(function(){var F,B;return J(this,(function(G){switch(G.label){case 0:this.handshakePromise.isPending||(this.handshakePromise=new X.SettablePromise),this.telemetryLogger.logHandshakeStarted(),G.label=1;case 1:return G.trys.push([1,3,,4]),F=[],this.mcpConfig.enableDominantSpeakerHistory&&F.push("dsh"),this.mcpConfig.enableBweNotifications&&F.push("bwe"),this.logger.info("MediaControlPlane - Send syn, client capabilities: ".concat(JSON.stringify(F))),[4,this.sendMsgInternal({type:"syn",client_capabilities:F})];case 2:return G.sent(),[3,4];case 3:return B=G.sent(),this.handshakePromise.reject(B),[3,4];case 4:return[2]}}))}))},MediaControlPlane.prototype.sendMsgInternal=function(F){return K(this,void 0,void 0,(function(){var B,G,W,z,K,Y,X,Z,te;return J(this,(function(J){switch(J.label){case 0:B=Array.isArray(F)?F:[F],G=(new TextEncoder).encode(JSON.stringify(B)),(W=new Uint8Array(1+G.length))[0]=1,W.set(G,1),J.label=1;case 1:return J.trys.push([1,3,,4]),[4,this.dcSend(W,[ee])];case 2:J.sent();try{for(z=Q(B),K=z.next();!K.done;K=z.next())Y=K.value,this.telemetryLogger.logSentMsg(Y)}catch(F){Z={error:F}}finally{try{K&&!K.done&&(te=z.return)&&te.call(z)}finally{if(Z)throw Z.error}}return[3,4];case 3:throw X=J.sent(),this.logger.error("send failed: ".concat((0,$.stringifyObject)(X))),this.telemetryLogger.logSentFailed((0,$.stringifyObject)(X)),X;case 4:return[2]}}))}))},MediaControlPlane.prototype.processIncomingData=function(F){var B,G;if(1!==F[0]){var W="unsupported header version ".concat(F[0]);return this.logger.info(W),void this.telemetryLogger.logRecvFailed(W)}var z,K=new DataView(F.buffer,1);try{var J=(new TextDecoder).decode(K);z=JSON.parse(J)}catch(F){return this.logger.error("Failed to parse received data, error ".concat((0,$.stringifyObject)(F))),void this.telemetryLogger.logRecvFailed((0,$.stringifyObject)(F))}try{for(var Y=Q(z),X=Y.next();!X.done;X=Y.next()){var Z=X.value;switch(this.telemetryLogger.logReceivedMsg(Z),Z.type){case"syn":break;case"ack":this.processAckMsg(Z);break;case"bwe":this.processBweMsg(Z);break;default:W="Unsupported msg type ".concat(Z.type);this.logger.error(W),this.telemetryLogger.logRecvFailed(W)}}}catch(F){B={error:F}}finally{try{X&&!X.done&&(G=Y.return)&&G.call(Y)}finally{if(B)throw B.error}}},MediaControlPlane.prototype.processBweMsg=function(F){this.mcpConfig.enableBweNotifications&&this.event("mpSendBandwidthChanged").raise(F.bw)},MediaControlPlane.prototype.processAckMsg=function(F){var B;this.telemetryLogger.logHandshakeCompleted(F),this.logger.info("MediaControlPlane - Ack received: ".concat(JSON.stringify(F)));var G=!(!this.mcpConfig.enableDominantSpeakerHistory||!(null===(B=F.send_capabilities)||void 0===B?void 0:B.includes("dsh")));this.event("mpDshStatusChanged").raise(G),this.handshakePromise.resolve()},MediaControlPlane}(Y.default);B.MediaControlPlane=te;var ne=function(){function TelemetryLogger(){this.storage={createTime:Date.now(),startedTs:-1,stoppedTs:-1,handshakeDuration:-1,mpCapabilities:{},sentMessages:{},recvMessages:{},sentFailed:0,recvFailed:0}}return TelemetryLogger.prototype.logStarted=function(){this.storage.startedTs=-1===this.storage.startedTs?duration(this.storage.createTime):this.storage.startedTs},TelemetryLogger.prototype.logStopped=function(){this.storage.stoppedTs=duration(this.storage.createTime)},TelemetryLogger.prototype.logSentMsg=function(F){var B,G,W;null!==(B=(G=this.storage.sentMessages)[W=F.type])&&void 0!==B||(G[W]=0),this.storage.sentMessages[F.type]++},TelemetryLogger.prototype.logReceivedMsg=function(F){var B,G,W;null!==(B=(G=this.storage.recvMessages)[W=F.type])&&void 0!==B||(G[W]=0),this.storage.recvMessages[F.type]++},TelemetryLogger.prototype.logHandshakeStarted=function(){this.handshakeStartedTs=Date.now()},TelemetryLogger.prototype.logHandshakeCompleted=function(F){-1===this.storage.handshakeDuration&&(this.storage.handshakeDuration=duration(this.handshakeStartedTs)),this.storage.mpCapabilities.send=F.send_capabilities},TelemetryLogger.prototype.logSentFailed=function(F){this.storage.sentFailed++,this.storage.lastSentFailed={ts:duration(this.storage.createTime),error:F}},TelemetryLogger.prototype.logRecvFailed=function(F){this.storage.recvFailed++,this.storage.lastRecvFailed={ts:duration(this.storage.createTime),error:F}},TelemetryLogger.prototype.getReport=function(){return this.storage},TelemetryLogger}();function duration(F){return Date.now()-F}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.scrubAddParticipantPayload=B.scrubITransferContext=B.scrubSignalingParticipant=void 0;var W=G(31),z=G(17);function scrub(F,B,G,z){var K=JSON.stringify(F),J=JSON.parse(K);return J&&(scrubOneTypeOfParams(F,J,B,W.pii.Omit),scrubOneTypeOfParams(F,J,G,W.pii.Mri),scrubOneTypeOfParams(F,J,z,W.pii.UserName)),JSON.stringify(J)}function scrubOneTypeOfParams(F,B,G,W){null==G||G.forEach((function(G){F[G]&&(B[G]=W(F[G]))}))}function scrubSignalingParticipant(F){return"id=".concat(W.pii.Mri(F.id),", participantId=").concat(F.participantId)}function scrubITransferContext(F){return scrub(F,[],["transferorMri","targetMri"])}function scrubAddParticipantPayload(F){var B,G="payload: ";if(F.participants){if(F.participants.from){var K=F.participants.from;G+="from: ".concat(scrub(K,["id"],[],["displayName"]),", to: ")}null===(B=F.participants.to)||void 0===B||B.forEach((function(F){var B=scrub(F,["id","assertedId"],[],["displayName"]);G+="".concat(B,", ")}))}return F.groupId&&(G+="groupId: ".concat((0,z.scrubMriOrOmit)(F.groupId),", ")),F.threadId&&(G+="threadId: ".concat((0,z.getLoggableThreadId)(F.threadId),", ")),F.messageId&&(G+="messageId: ".concat(F.messageId,", ")),F.sipUri&&(G+="sipUri: ".concat(F.sipUri,", ")),F.participantInvitationData&&(G+="participantInvitationData: ".concat(W.pii.Omit(F.participantInvitationData),", ")),F.links&&(G+="links: ".concat(JSON.stringify(F.links))),F.alternateId&&(G+="alternateId: ".concat(W.pii.Omit(F.alternateId))),G}B.scrubSignalingParticipant=scrubSignalingParticipant,B.scrubITransferContext=scrubITransferContext,B.scrubAddParticipantPayload=scrubAddParticipantPayload},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=function(F){function AudioStream(){return null!==F&&F.apply(this,arguments)||this}return z(AudioStream,F),AudioStream}(G(61).default);B.default=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var Q=G(63),Y=function(F){function ImageStream(B,G,W,z){var K=F.call(this,void 0,B,G)||this;return K.frameUris=W,K.imageRenderingSession=z,K.type=1,K.renderers=[],K.imageRendererId=0,K}return z(ImageStream,F),ImageStream.prototype.getRawStream=function(){throw this.logger.error("getRawStream not implemented, stream id:".concat(this.id,", imageRendererId: ").concat(this.imageRendererId)),"Not implemented in ImageStream"},Object.defineProperty(ImageStream.prototype,"mediaSourceId",{get:function(){return this.id},enumerable:!1,configurable:!0}),ImageStream.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,msi:this.mediaSourceId,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},ImageStream.prototype.stop=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){return this.dispose(),[2,Promise.resolve()]}))}))},ImageStream.prototype.start=function(F){return K(this,void 0,void 0,(function(){var B,G=this;return J(this,(function(W){return this.imageRenderingSession?(this.imageRendererId++,this.logger.info("Image stream start stream id:".concat(this.id,", imageRendererId: ").concat(this.imageRendererId)),B=new Q.RemoteImageRenderer(this.imageRenderingSession,F,this.imageRendererId),this.renderers.push(B),[2,B.start(this.frameUris).catch((function(F){throw G.logger.error("Failed starting renderer, stream id:".concat(G.id,", imageRendererId: ").concat(G.imageRendererId,": ").concat(F)),F})).then((function(){return G.isStreaming=!0,B}))]):[2,Promise.reject("imageRenderingSession not passed, id: ".concat(this.id))]}))}))},ImageStream.prototype.dispose=function(){var B=this;F.prototype.dispose.call(this),this.isStreaming=!1,this.renderers.forEach((function(F){try{F.dispose()}catch(F){B.logger.error("Failed disposing renderer, stream id:".concat(B.id,": ").concat(F))}})),this.renderers=[]},ImageStream}(G(61).default);B.default=Y},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var Q=G(117),Y=G(298),$=function(F){function MiddleLaneStream(B,G,W,z){var K=F.call(this,void 0,B,G)||this;return K.middleLaneMetadata=W,K.telemetryLogger=z,K.type=2,K.maxPlayerPlaybackEventCount=10,K.maxPlayerDiagnosticsCount=10,K.initializeStatistics(),K.player=new Y.MiddleLaneLiveStreamPlayer(K.logger.createChild("MiddleLaneLiveStreamPlayer"),K.liveStreamStatistic,(function(F){return K.sendTelemetry(F)}),(function(){return K.sendDiagnostics()})),K.player.configure(K.middleLaneMetadata),K.isAvailable=!0,K}return z(MiddleLaneStream,F),MiddleLaneStream.prototype.getStreamMetadata=function(){return this.player.streamMetadata},MiddleLaneStream.prototype.initializeStatistics=function(){var F={currentPlayPosition:[],statsInterval:[]},B={maxPlayerPlaybackEventCount:this.maxPlayerPlaybackEventCount,maxPlayerDiagnosticsCount:this.maxPlayerDiagnosticsCount,debug:!0};this.liveStreamStatistic=new Q.LiveStreamStatistic(B,this.logger.createChild("MiddleLaneLiveStreamStatistic"),F)},MiddleLaneStream.prototype.setVideoStreamConfig=function(F){throw new Error("Method not implemented.")},MiddleLaneStream.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},MiddleLaneStream.prototype.stop=function(){return Promise.resolve(void 0)},MiddleLaneStream.prototype.start=function(F,B){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:return this.logger.info("[start]: Starting middle lane stream"),this.renderer?[3,2]:(B=this,[4,this.player.loadPlayer(F)]);case 1:if(B.renderer=G.sent(),!this.renderer)return this.player.stop(),this.logger.error("[start]: Failed to load middle lane player"),[2,Promise.reject("Failed to load middle lane player")];G.label=2;case 2:return this.isStreaming=!0,[2,this.renderer]}}))}))},MiddleLaneStream.prototype.sendDiagnostics=function(){var F=this.liveStreamStatistic.getPlayerDiagnosticSnapshotTelemetry();this.logger.debug("[sendDiagnostics] sending diagnostics: ",F),this.telemetryLogger.sendEvent({eventName:"middle_lane",props:F})},MiddleLaneStream.prototype.sendTelemetry=function(F){var B={isFinal:F},G=this.liveStreamStatistic.getReport(B);this.logger.debug("[sendTelemetry] sending telemetry: ",G),this.telemetryLogger.sendEvent({eventName:"middle_lane",props:G})},MiddleLaneStream}(G(61).default);B.default=$},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.MiddleLaneLiveStreamPlayer=void 0;var Q=G(15),Y=G(26),$=G(299),X=G(300),Z=G(301),ee=G(303),te=G(304),ne=function(F){function MiddleLaneLiveStreamPlayer(B,G,W,z){var K=F.call(this,B)||this;return K.logger=B,K.liveStreamStatistic=G,K.sendTelemetry=W,K.sendDiagnostics=z,K.playbackStopRequested=!0,K.retryCount=0,K.lastPlaybackError=null,K.videoElementEvents=[],K.isSwitchStreamingUrlOngoing=!1,K.maxRetryCount=10,K.reconnectStreamTimer=null,K.switchStreamTimer=null,K.reconnectTimeoutMs=200,K.switchTimeoutMs=500,K.updateDiagnosticsTimer=-1,K.sendDiagnosticsTimer=-1,K.updateDiagnosticsIntervalMs=1e3,K.sendDiagnosticsIntervalMs=5e3,K.initialStatsTimer=-1,K.initialTelemetrySentMs=6e4,K.diagnosticProvider=new $.MiddleLaneDiagnosticProvider,K.videoAdjuster=new ee.VideoAdjuster(B,K.diagnosticProvider),K.latencyTraceProcessor=new te.LatencyTraceProcessor(B,K.diagnosticProvider),K}return z(MiddleLaneLiveStreamPlayer,F),Object.defineProperty(MiddleLaneLiveStreamPlayer.prototype,"streamMetadata",{get:function(){return this.middleLaneMetadata},enumerable:!1,configurable:!0}),MiddleLaneLiveStreamPlayer.prototype.configure=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this.middleLaneMetadata=F,F.primaryStreamInfo&&F.primaryStreamInfo.streamingUrl?(this.logger.info("[configure]: Valid Live Stream configuration provided: Configuring with primary stream"),this.selectedStreamInfo=F.primaryStreamInfo):F.altStreamInfo&&F.altStreamInfo.streamingUrl?(this.logger.info("[configure]: Valid Live Stream configuration provided: Configuring with backup stream"),this.selectedStreamInfo=F.altStreamInfo):this.logger.info("[configure]: Invalid Live Stream configuration provided"),[2]}))}))},MiddleLaneLiveStreamPlayer.prototype.loadPlayer=function(F){return K(this,void 0,void 0,(function(){var B=this;return J(this,(function(G){switch(G.label){case 0:return this.selectedStreamInfo?this.video?(this.logger.warn("[loadPlayer]: Player already started - not reloading player"),[2,null]):(this.container=F,[4,this.trySetupPlayer(!0)]):(this.logger.error("[loadPlayer]: Failed to load player: live stream not selected yet"),[2,null]);case 1:return G.sent()?(this.initialStatsTimer=window.setTimeout((function(){clearTimeout(B.initialStatsTimer),B.logger.debug("[loadPlayer]: Initial telemetry sent after ".concat(B.initialTelemetrySentMs," ms")),B.sendTelemetry(!1),B.initialStatsTimer=null}),this.initialTelemetrySentMs),[2,new X.MiddleLaneStreamRenderer(this,this.logger.createChild("MiddleLaneStreamRenderer"))]):[2,null]}}))}))},MiddleLaneLiveStreamPlayer.prototype.trySetupPlayer=function(F){return void 0===F&&(F=!1),K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:return F&&this.liveStreamStatistic.registerPlayerLoadAttempt(),[4,this.setupPlayer()];case 1:return B=G.sent(),F&&(B?this.liveStreamStatistic.registerPlayerLoadSucceeded():this.liveStreamStatistic.registerPlayerLoadFailed("setupPlayer failed")),[2,B]}}))}))},MiddleLaneLiveStreamPlayer.prototype.setupPlayer=function(){return K(this,void 0,void 0,(function(){var F,B;return J(this,(function(G){switch(G.label){case 0:if(this.liveStreamStatistic.registerPlayerSetupAttempt(),this.logger.info("[setupPlayer]: Attempting to setup stream, Stream ID: ".concat(this.selectedStreamInfo.identifier,", Stream URL: ").concat(this.selectedStreamInfo.streamingUrl)),!this.video)try{this.createVideoElement()}catch(F){return B=(0,Y.stringifyObject)(F),this.logger.error("[setupPlayer]: Creating HTML video element failed: ".concat(B)),this.liveStreamStatistic.registerPlayerSetupFailed("HTMLVideoElementCreationFailed"),this.endPlayback(!0),[2,!1]}this.diagnosticProvider.setVideo(this.video),G.label=1;case 1:return G.trys.push([1,3,,4]),[4,this.preparePlayback()];case 2:return G.sent(),[3,4];case 3:return F=G.sent(),B=(0,Y.stringifyObject)(F),this.logger.error("[setupPlayer]: Failed to prepare playback: ".concat(B)),this.endPlayback(!0),[2,!1];case 4:return this.setPlaybackState("Initialized"),this.liveStreamStatistic.registerPlayerSetupSucceeded(),[2,!0]}}))}))},MiddleLaneLiveStreamPlayer.prototype.createVideoElement=function(){this.logger.info("[createVideoElement]: Creating video element in container"),this.video=this.container.ownerDocument.createElement("video"),this.video.id="ml-player",this.video.autoplay=!0,this.video.style.width="100%",this.video.style.height="100%",this.video.setAttribute("playsinline","true"),this.container.appendChild(this.video)},MiddleLaneLiveStreamPlayer.prototype.preparePlayback=function(){return K(this,void 0,void 0,(function(){var F,B,G,W=this;return J(this,(function(z){switch(z.label){case 0:this.playbackStopRequested=!1,this.diagnosticProvider.setValue("outputStreamState",1|this.diagnosticProvider.getValue("outputStreamState")),z.label=1;case 1:return z.trys.push([1,3,,4]),F=this,[4,(0,Z.default)({onInputChunk:function(F){return W.updateMp4StreamStats(!1,F)},onOutputChunk:function(F){return W.updateMp4StreamStats(!0,F)},onInputStreamDone:function(){return W.diagnosticProvider.setValue("inputStreamState",4|W.diagnosticProvider.getValue("inputStreamState"))},onInputStreamCancelled:function(){return W.diagnosticProvider.setValue("inputStreamState",8|W.diagnosticProvider.getValue("inputStreamState"))}},(function(F){return W.videoAdjuster.onUmsMessage(F)}),(function(F){return W.latencyTraceProcessor.processLatencyTrace(F)}))];case 2:return F.mp4StreamInstance=z.sent(),[3,4];case 3:throw B=z.sent(),this.liveStreamStatistic.registerPlayerSetupFailed("Mp4StreamInitializationFailed"),B;case 4:return this.diagnosticProvider.setValue("outputStreamState",2|this.diagnosticProvider.getValue("outputStreamState")),this.diagnosticProvider.setValue("outputChunkCount",0),this.diagnosticProvider.setValue("outputByteCount",0),this.selectedStreamInfo.decryptionKey&&this.selectedStreamInfo.decryptionKey.id&&this.selectedStreamInfo.decryptionKey.value?(G=Uint8Array.from(atob(this.selectedStreamInfo.decryptionKey.value),(function(F){return F.charCodeAt(0)})),this.mp4StreamInstance.setDecryptionKey(this.selectedStreamInfo.decryptionKey.id,G)):this.logger.warn("[initializeMp4Stream]: No decryption key set for Mp4Stream"),this.setSource(),[2]}}))}))},MiddleLaneLiveStreamPlayer.prototype.setSource=function(){var F=this;this.liveStreamStatistic.registerSetSourceAttempt();var B=new MediaSource;B.addEventListener("sourceopen",(function(B){return F.sourceOpen(B)})),this.video.src=URL.createObjectURL(B),this.liveStreamStatistic.registerSetSourceSucceeded()},MiddleLaneLiveStreamPlayer.prototype.updateMp4StreamStats=function(F,B){F?(this.diagnosticProvider.setValue("outputChunkCount",this.diagnosticProvider.getValue("outputChunkCount")+1),this.diagnosticProvider.setValue("outputByteCount",this.diagnosticProvider.getValue("outputByteCount")+B)):(this.diagnosticProvider.setValue("inputChunkCount",this.diagnosticProvider.getValue("inputChunkCount")+1),this.diagnosticProvider.setValue("inputByteCount",this.diagnosticProvider.getValue("inputByteCount")+B))},MiddleLaneLiveStreamPlayer.prototype.sourceOpen=function(F){return K(this,void 0,void 0,(function(){var B,G,W,z,K;return J(this,(function(J){switch(J.label){case 0:return J.trys.push([0,4,,5]),URL.revokeObjectURL(this.video.src),this.diagnosticProvider.setValue("inputStreamState",1|this.diagnosticProvider.getValue("inputStreamState")),B="".concat(this.selectedStreamInfo.streamingUrl,"/?ums"),this.middleLaneMetadata.sessionId&&(B+="&ccid=".concat(this.middleLaneMetadata.sessionId)),[4,fetch(B)];case 1:return G=J.sent(),this.diagnosticProvider.setValue("inputStreamState",2|this.diagnosticProvider.getValue("inputStreamState")),this.diagnosticProvider.setValue("inputChunkCount",0),this.diagnosticProvider.setValue("inputByteCount",0),this.registerEvents(G.url),[4,this.mp4StreamInstance.setupStream(G.body)];case 2:return W=J.sent(),[4,this.startStream(F.target,W)];case 3:return J.sent(),[3,5];case 4:return z=J.sent(),K=(0,Y.stringifyObject)(z),this.logger.error("[sourceOpen]: Error while reading from stream: ".concat(K)),this.setPlaybackState("Error"),this.retryStreaming(K),[3,5];case 5:return[2]}}))}))},MiddleLaneLiveStreamPlayer.prototype.startStream=function(F,B){return K(this,void 0,void 0,(function(){var G,W;return J(this,(function(z){switch(z.label){case 0:return this.logger.info("[startStream]: Attempting to start stream"),G=[],W=this.createSourceBuffer(F,B,G),this.playbackStopRequested?[3,2]:[4,this.readStream(F,W,G)];case 1:z.sent(),z.label=2;case 2:return[2]}}))}))},MiddleLaneLiveStreamPlayer.prototype.readStream=function(F,B,G){return K(this,void 0,void 0,(function(){var W,z,K=this;return J(this,(function(J){switch(J.label){case 0:this.logger.info("[readStream]: Reading from stream to play on player"),J.label=1;case 1:if(this.lastPlaybackError)throw this.lastPlaybackError;J.label=2;case 2:return J.trys.push([2,4,,5]),[4,this.mp4StreamInstance.read()];case 3:return W=J.sent(),this.playbackStopRequested?[3,6]:W.event&&"restart"===W.event.name?(this.reconnectStreamTimer=window.setTimeout((function(){return K.setupPlayer()}),this.reconnectTimeoutMs),this.endPlayback(!1),[3,6]):(W.value&&(G.push(W.value),this.diagnosticProvider.setValue("playerQueueSize",G.length),this.processPlayerQueue(G,B)),W.done?(F.endOfStream(),this.diagnosticProvider.setValue("outputStreamState",8|this.diagnosticProvider.getValue("outputStreamState")),this.endPlayback(!0),[3,6]):[3,5]);case 4:throw z=J.sent(),this.diagnosticProvider.setValue("outputStreamState",32|this.diagnosticProvider.getValue("outputStreamState")),z;case 5:return[3,1];case 6:return[2]}}))}))},MiddleLaneLiveStreamPlayer.prototype.createSourceBuffer=function(F,B,G){var W=this,z=B,K=MediaSource.isTypeSupported(z);if(!K&&B.match(/,opus"$/)){var J=B.replace(/,opus"$/,'"');MediaSource.isTypeSupported(J)&&(K=!0,z=J,this.logger.warn("[createSourceBuffer]: Switched to video-only mode"))}if(!K)throw new Error("Unsupported mime type '".concat(z,"'"));var Q=F.addSourceBuffer(z);return Q.onupdateend=function(){return W.processPlayerQueue(G,Q)},this.diagnosticProvider.setValue("outputStreamState",4|this.diagnosticProvider.getValue("outputStreamState")),Q},MiddleLaneLiveStreamPlayer.prototype.processPlayerQueue=function(F,B){for(;!this.playbackStopRequested&&!B.updating;){if(!(F.length>0)){for(var G=25,W=10,z=this.video.buffered,K=this.video.currentTime,J=0;J<z.length;++J)if(K-z.start(J)>G+W){this.logger.info("[processPlayerQueue]: Processing player queue:\n                            Cut played ".concat(z.start(J),"..").concat(K-G)),B.remove(z.start(J),K-G);break}break}B.appendBuffer(F.shift()),this.diagnosticProvider.setValue("playerQueueSize",F.length)}},MiddleLaneLiveStreamPlayer.prototype.stop=function(){this.logger.info("[stop]: Stop player"),this.endPlayback(!0)},MiddleLaneLiveStreamPlayer.prototype.getStreamSize=function(){return this.video?{width:this.video.videoWidth,height:this.video.videoHeight}:{width:0,height:0}},MiddleLaneLiveStreamPlayer.prototype.startGatheringTelemetry=function(){var F=this;this.logger.debug("[startGatheringTelemetry]: telemetry gathering started"),this.updateDiagnosticsTimer=window.setInterval((function(){var B=F.getPlayerDiagnostics();F.logger.debug("[startGatheringTelemetry]: updating diagnostics: ".concat(JSON.stringify(B))),F.liveStreamStatistic.registerStatsUpdated(B)}),this.updateDiagnosticsIntervalMs),this.sendDiagnosticsTimer=window.setInterval((function(){F.sendDiagnostics()}),this.sendDiagnosticsIntervalMs)},MiddleLaneLiveStreamPlayer.prototype.stopGatheringTelemetry=function(){this.logger.debug("[stopGatheringTelemetry]: telemetry gathering stopped"),this.liveStreamStatistic.registerStatsUpdated(this.getPlayerDiagnostics()),-1!==this.updateDiagnosticsTimer&&clearInterval(this.updateDiagnosticsTimer),-1!==this.sendDiagnosticsTimer&&clearInterval(this.sendDiagnosticsTimer),this.updateDiagnosticsTimer=-1,this.sendDiagnosticsTimer=-1},MiddleLaneLiveStreamPlayer.prototype.getPlayerDiagnostics=function(){var F=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return F.statsInterval=this.sendDiagnosticsIntervalMs,F},MiddleLaneLiveStreamPlayer.prototype.registerEvents=function(F){var B=this;this.registerPlayerEvent("error",(function(){return B.handlePlaybackError()})),this.registerPlayerEvent("canplaythrough",(function(){return B.onCanPlayThrough()})),this.registerPlayerEvent("play",(function(){return B.onPlay(F)})),this.registerPlayerEvent("playing",(function(){return B.onPlaying()})),this.registerPlayerEvent("pause",(function(){return B.onPause()})),this.registerPlayerEvent("ended",(function(){return B.onEnded()})),this.registerPlayerEvent("loadedmetadata",(function(){return B.onMetadataLoaded()})),this.registerPlayerEvent("waiting",(function(){return B.onWaiting()})),this.registerPlayerEvent("loadeddata",(function(){return B.onLoadedData()})),this.registerPlayerEvent("loadstart",(function(){return B.onLoadStart()}))},MiddleLaneLiveStreamPlayer.prototype.registerPlayerEvent=function(F,B){this.videoElementEvents.push({name:F,callback:B}),this.video.addEventListener(F,B)},MiddleLaneLiveStreamPlayer.prototype.removeEventListeners=function(){var F=this;this.video&&this.videoElementEvents.forEach((function(B){F.video.removeEventListener(B.name,B.callback)})),this.videoElementEvents=[]},MiddleLaneLiveStreamPlayer.prototype.onCanPlayThrough=function(){this.setPlaybackState("Ready"),-1===this.updateDiagnosticsTimer&&-1===this.sendDiagnosticsTimer&&this.startGatheringTelemetry()},MiddleLaneLiveStreamPlayer.prototype.onPlay=function(F){this.setPlaybackState("Play"),this.retryCount>0&&(this.logger.info("[onPlay]: Playing stream after retry count ".concat(this.retryCount)),this.retryCount=0),!0===this.isSwitchStreamingUrlOngoing&&(this.logger.info("[onPlay]: Streaming URL was switched successfully to start playback"),this.isSwitchStreamingUrlOngoing=!1),this.videoAdjuster.start(this.video,this.middleLaneMetadata.sessionId?"".concat(F,"?ccid=").concat(this.middleLaneMetadata.sessionId):F)},MiddleLaneLiveStreamPlayer.prototype.onPlaying=function(){this.setPlaybackState("Playing")},MiddleLaneLiveStreamPlayer.prototype.onPause=function(){this.setPlaybackState("Paused")},MiddleLaneLiveStreamPlayer.prototype.onEnded=function(){this.setPlaybackState("Ended")},MiddleLaneLiveStreamPlayer.prototype.onMetadataLoaded=function(){this.setPlaybackState("LoadedMetadata")},MiddleLaneLiveStreamPlayer.prototype.onWaiting=function(){this.setPlaybackState("Buffering")},MiddleLaneLiveStreamPlayer.prototype.onLoadedData=function(){this.setPlaybackState("LoadedData")},MiddleLaneLiveStreamPlayer.prototype.onLoadStart=function(){this.setPlaybackState("LoadStart")},MiddleLaneLiveStreamPlayer.prototype.handlePlaybackError=function(){return K(this,void 0,void 0,(function(){var F;return J(this,(function(B){return this.lastPlaybackError=this.video.error,F=(0,Y.stringifyObject)(this.lastPlaybackError),this.logger.warn("[handlePlaybackError]: Playback error: ".concat(F)),[2]}))}))},MiddleLaneLiveStreamPlayer.prototype.retryStreaming=function(F){var B=this;this.playbackStopRequested||(this.retryCount<this.maxRetryCount?(this.endPlayback(!1),this.logger.info("[retryStreaming]: Retrying to connect to stream after playback error: ".concat(F)),this.middleLaneMetadata.primaryStreamInfo&&this.middleLaneMetadata.altStreamInfo&&(this.selectedStreamInfo.streamingUrl===this.middleLaneMetadata.primaryStreamInfo.streamingUrl&&this.middleLaneMetadata.altStreamInfo&&this.middleLaneMetadata.altStreamInfo.streamingUrl?this.selectedStreamInfo=this.middleLaneMetadata.altStreamInfo:this.selectedStreamInfo.streamingUrl===this.middleLaneMetadata.altStreamInfo.streamingUrl&&this.middleLaneMetadata.primaryStreamInfo&&this.middleLaneMetadata.primaryStreamInfo.streamingUrl&&(this.selectedStreamInfo=this.middleLaneMetadata.primaryStreamInfo)),this.switchStreamTimer=window.setTimeout((function(){B.retryCount++,B.raisePlaybackError("PlaybackRetried",F),B.isSwitchStreamingUrlOngoing=!0,B.setupPlayer()}),this.switchTimeoutMs)):(this.logger.warn("[retryStreaming]: Hit retry max - destroying player"),this.raisePlaybackError("PlaybackError",F),this.endPlayback(!0)))},MiddleLaneLiveStreamPlayer.prototype.setPlaybackState=function(F){this.logger.debug("[setPlaybackState]: Playback state changed: ".concat(F)),this.liveStreamStatistic.registerPlaybackStateChanged(F),this.event("playbackStateChanged").raise(F)},MiddleLaneLiveStreamPlayer.prototype.raisePlaybackError=function(F,B){this.liveStreamStatistic.registerPlaybackError(F,B)},MiddleLaneLiveStreamPlayer.prototype.endPlayback=function(F){this.logger.info("[endPlayback]: End playback"),this.playbackStopRequested=!0,this.videoAdjuster.reset(),this.lastPlaybackError=null,this.removeEventListeners(),this.mp4StreamInstance&&(this.mp4StreamInstance.close(),this.diagnosticProvider.setValue("outputStreamState",16|this.diagnosticProvider.getValue("outputStreamState")),this.mp4StreamInstance=null),F&&(this.video&&(this.video.parentNode&&this.video.parentNode.removeChild(this.video),this.video=null),this.initialStatsTimer&&(clearTimeout(this.initialStatsTimer),this.initialStatsTimer=null),this.reconnectStreamTimer&&(clearTimeout(this.reconnectStreamTimer),this.reconnectStreamTimer=null),this.switchStreamTimer&&(clearTimeout(this.switchStreamTimer),this.switchStreamTimer=null),this.liveStreamStatistic.registerPlayerDestroyed(),this.setPlaybackState("Destroyed")),this.stopGatheringTelemetry(),this.sendTelemetry(F),this.diagnosticProvider.reset()},MiddleLaneLiveStreamPlayer}(Q.default);B.MiddleLaneLiveStreamPlayer=ne},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MiddleLaneDiagnosticProvider=void 0;var W=function(){function MiddleLaneDiagnosticProvider(){this.currentSnapshot={currentPlayPosition:null,videoReadyState:null,bufferedMediaSize:null,cachedMediaSize:null,minPlayerBufferSizeInInterval:null,maxPlayerBufferSizeInInterval:null,avgPlayerBufferSizeInInterval:null,playerBufferSizeVariationInInterval:null,playerBufferSizeHistoryInterval:null,targetPlayerBufferSize:null,serverBufferStartTime:null,serverBufferEndTime:null,lastUploadedTime:null,serverQueueAvailability:null,bufferEndDelay:null,mediaDelay:null,playbackRate:null,estimatedSpeedup:null,appliedSpeedup:null,speedupAppliedCount:null,speedupResetCount:null,currentResolution:null,minResolutionSelectedCount:null,resolutionIncreaseCount:null,maxResolutionSelectedCount:null,inputStreamState:null,inputChunkCount:null,inputByteCount:null,inputBitrate:null,outputStreamState:null,outputChunkCount:null,outputByteCount:null,playerQueueSize:null,playerType:2,recentHopLatencyMetrics:null,overallHopLatencyMetrics:null,serviceAvgLatency:null,endToEndAvgLatency:null,memoryLog:null,statsInterval:null}}return MiddleLaneDiagnosticProvider.prototype.setVideo=function(F){this.video=F},MiddleLaneDiagnosticProvider.prototype.reset=function(){var F=this;Object.keys(this.currentSnapshot).forEach((function(B){F.currentSnapshot[B]=null})),this.video=null},MiddleLaneDiagnosticProvider.prototype.setValue=function(F,B){this.video&&(this.currentSnapshot[F]=B)},MiddleLaneDiagnosticProvider.prototype.getValue=function(F){return this.video?this.currentSnapshot[F]:null},MiddleLaneDiagnosticProvider.prototype.getPlayerDiagnosticSnapshot=function(){return this.video&&(this.currentSnapshot.currentPlayPosition=this.video.currentTime,this.currentSnapshot.videoReadyState=this.video.readyState,this.currentSnapshot.playbackRate=this.video.playbackRate),this.currentSnapshot},MiddleLaneDiagnosticProvider.prototype.dispose=function(){},MiddleLaneDiagnosticProvider}();B.MiddleLaneDiagnosticProvider=W},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.MiddleLaneStreamRenderer=void 0;var J=function(F){function MiddleLaneStreamRenderer(B,G){var W=F.call(this,G)||this;return W.player=B,W.logger=G,W.playerSubs=[],W.isRendering=!1,W.subscribeForPlayerEvents(),W}return z(MiddleLaneStreamRenderer,F),Object.defineProperty(MiddleLaneStreamRenderer.prototype,"streamSize",{get:function(){return this.player?this.player.getStreamSize():{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(MiddleLaneStreamRenderer.prototype,"rendererType",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(MiddleLaneStreamRenderer.prototype,"frameType",{get:function(){return-1},enumerable:!1,configurable:!0}),MiddleLaneStreamRenderer.prototype.dumpVideoSourceImages=function(){throw new Error("Method not implemented.")},MiddleLaneStreamRenderer.prototype.cameraAutoControl=function(F){throw new Error("Method not implemented.")},MiddleLaneStreamRenderer.prototype.dispose=function(){this.stopPlayer(),F.prototype.dispose.call(this)},MiddleLaneStreamRenderer.prototype.getStats=function(){throw new Error("Method not implemented.")},MiddleLaneStreamRenderer.prototype.setScalingMode=function(F,B){throw new Error("Method not implemented.")},MiddleLaneStreamRenderer.prototype.captureFrame=function(F,B){throw new Error("Method not implemented.")},MiddleLaneStreamRenderer.prototype.stopPlayer=function(){var F=this.player;this.player=null,F&&(this.logger.info("stopping middle lane player"),this.unsubscribeFromPlayerEvents(),F.stop())},MiddleLaneStreamRenderer.prototype.subscribeForPlayerEvents=function(){var F=this;this.playerSubs.push(this.player.on("playbackStateChanged",(function(B){return F.onPlaybackStateChanged(B)})))},MiddleLaneStreamRenderer.prototype.unsubscribeFromPlayerEvents=function(){var F,B;try{for(var G=K(this.playerSubs),W=G.next();!W.done;W=G.next()){W.value.dispose()}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}this.playerSubs=[]},MiddleLaneStreamRenderer.prototype.onPlaybackStateChanged=function(F){switch(F){case"Playing":this.isRendering=!0,this.raiseChanged();break;case"Error":case"Destroyed":this.isRendering=!1,this.raiseChanged()}},MiddleLaneStreamRenderer}(G(15).default);B.MiddleLaneStreamRenderer=J},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var K=G(302);function Mp4Stream(F,B,G){return W(this,void 0,void 0,(function(){var W;return z(this,(function(z){switch(z.label){case 0:return W=J.bind,[4,(0,K.default)()];case 1:return[2,new(W.apply(J,[void 0,z.sent(),F,B,G]))]}}))}))}B.default=Mp4Stream;var J=function(){function Transcoder(F,B,G,W){this._wasm=F,this._stat=B,this._onMessage=G,this._onLatencyTrace=W,this._initWasmTranscoder()}return Transcoder.prototype.setupStream=function(F){return W(this,void 0,void 0,(function(){var B;return z(this,(function(G){switch(G.label){case 0:console.assert(!this._reader),this._reader=F.getReader(),G.label=1;case 1:return this._streamMimeType?[3,3]:[4,this._ProcessOneInputChunk()];case 2:if(G.sent(),this._inputDone)throw new Error("Unexpected input UMS stream end");return[3,1];case 3:return B=this._streamMimeType,this._streamMimeType=null,[2,B]}}))}))},Transcoder.prototype.setDecryptionKey=function(F,B){var G=this._wasm.allocateUTF8OnStack(F),W=this._wasm.stackAlloc(B.byteLength);this._wasm.HEAPU8.set(new Uint8Array(B),W),this._wasm._TranscoderSetDecryptionKey(G,W,B.byteLength)},Transcoder.prototype.read=function(){return W(this,void 0,void 0,(function(){var F,B;return z(this,(function(G){switch(G.label){case 0:return this._outArray||this._inputDone||this._streamMimeType?[3,2]:[4,this._ProcessOneInputChunk()];case 1:return G.sent(),[3,0];case 2:return this._streamMimeType?(F={name:"restart",mime:this._streamMimeType},this._streamMimeType=null,[2,{value:null,done:null,event:F}]):(B={value:this._outArray,done:this._inputDone,event:null},this._outArray=null,[2,B])}}))}))},Transcoder.prototype.close=function(){clearInterval(this._intervalId),this._wasm._DeleteTranscoder(),this._streamReadyFunPtr&&this._wasm.removeFunction(this._streamReadyFunPtr),this._outputFunPtr&&this._wasm.removeFunction(this._outputFunPtr),this._fatalErrorFunPtr&&this._wasm.removeFunction(this._fatalErrorFunPtr),this._umsMessageFunPtr&&this._wasm.removeFunction(this._umsMessageFunPtr),this._latencyTraceFunPtr&&this._wasm.removeFunction(this._latencyTraceFunPtr),!this._inputDone&&this._reader&&(this._reader.cancel(),null!==this._stat&&this._stat.onInputStreamCancelled())},Transcoder.prototype._initWasmTranscoder=function(){var F=this;this._streamReadyFunPtr=this._wasm.addFunction((function(B){F._streamMimeType=F._wasm.UTF8ToString(B),F._outArray=null}),"vi"),this._outputFunPtr=this._wasm.addFunction((function(B,G){console.assert(G>=2),console.assert(G%2==0);for(var W=0,z=new Uint32Array(F._wasm.HEAPU8.buffer,B,G),K=1;K<z.length;K+=2)W+=z[K];null!==F._stat&&null!==F._stat.onOutputChunk&&F._stat.onOutputChunk(W);var J=0;if(F._outArray){var Q=new Uint8Array(F._outArray.length+W);Q.set(F._outArray,0),J=F._outArray.length,F._outArray=Q}else F._outArray=new Uint8Array(W);for(K=1;K<z.length;K+=2){var Y=z[K-1],$=z[K],X=new Uint8Array(F._wasm.HEAPU8.buffer,Y,$);F._outArray.set(X,J),J+=$}}),"vii"),this._fatalErrorFunPtr=this._wasm.addFunction((function(B){F._fatalError=F._wasm.UTF8ToString(B)}),"vi"),this._umsMessageFunPtr=this._wasm.addFunction((function(B){F._onMessage(F._wasm.UTF8ToString(B))}),"vi"),this._latencyTraceFunPtr=this._wasm.addFunction((function(B){F._onLatencyTrace(F._wasm.UTF8ToString(B))}),"vi"),this._wasm._CreateTranscoder(this._streamReadyFunPtr,this._outputFunPtr,this._fatalErrorFunPtr,this._umsMessageFunPtr,this._latencyTraceFunPtr),this._intervalId=window.setInterval((function(){return F._wasm._TranscoderRunTurn(50)}),50)},Transcoder.prototype._ProcessOneInputChunk=function(){return W(this,void 0,void 0,(function(){var F,B,G,W;return z(this,(function(z){switch(z.label){case 0:return[4,this._reader.read()];case 1:if(F=z.sent(),B=F.done,(G=F.value)&&(null!==this._stat&&null!==this._stat.onInputChunk&&this._stat.onInputChunk(G.length),W=this._wasm._TranscoderAllocateBuffer(G.length),new Uint8Array(this._wasm.HEAPU8.buffer,W,G.length).set(G),this._wasm._TranscoderConsumeBuffer(W,G.length),this._fatalError))throw new Error("UMS decoder: ".concat(this._fatalError));return B&&(this._inputDone=!0,null!==this._stat&&this._stat.onInputStreamDone()),[2]}}))}))},Transcoder}()},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var Module=function(F){var B,G;(F=void 0!==(F=F||{})?F:{}).ready=new Promise((function(F,W){B=F,G=W}));var W,z={};for(W in F)F.hasOwnProperty(W)&&(z[W]=F[W]);var K,J,Q="./this.program",Y=!0,$="";function locateFile(B){return F.locateFile?F.locateFile(B,$):$+B}"undefined"!=typeof document&&document.currentScript&&($=document.currentScript.src),$=0!==$.indexOf("blob:")?$.substr(0,$.lastIndexOf("/")+1):"",K=function(F){var B=new XMLHttpRequest;return B.open("GET",F,!1),B.send(null),B.responseText};var X=F.print||console.log.bind(console),Z=F.printErr||console.warn.bind(console);for(W in z)z.hasOwnProperty(W)&&(F[W]=z[W]);z=null,F.arguments&&F.arguments,F.thisProgram&&(Q=F.thisProgram),F.quit&&F.quit;var ee=16;function alignMemory(F,B){return B||(B=ee),Math.ceil(F/B)*B}function convertJsFunctionToWasm(F,B){if("function"==typeof WebAssembly.Function){for(var G={i:"i32",j:"i64",f:"f32",d:"f64"},W={parameters:[],results:"v"==B[0]?[]:[G[B[0]]]},z=1;z<B.length;++z)W.parameters.push(G[B[z]]);return new WebAssembly.Function(W,F)}var K=[1,0,1,96],J=B.slice(0,1),Q=B.slice(1),Y={i:127,j:126,f:125,d:124};for(K.push(Q.length),z=0;z<Q.length;++z)K.push(Y[Q[z]]);"v"==J?K.push(0):K=K.concat([1,Y[J]]),K[1]=K.length-2;var $=new Uint8Array([0,97,115,109,1,0,0,0].concat(K,[2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0])),X=new WebAssembly.Module($);return new WebAssembly.Instance(X,{e:{f:F}}).exports.f}var te,ne,ie,re=[];function getEmptyTableSlot(){if(re.length)return re.pop();try{ue.grow(1)}catch(F){if(!(F instanceof RangeError))throw F;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return ue.length-1}function addFunctionWasm(F,B){if(!te){te=new WeakMap;for(var G=0;G<ue.length;G++){var W=ue.get(G);W&&te.set(W,G)}}if(te.has(F))return te.get(F);var z=getEmptyTableSlot();try{ue.set(z,F)}catch(G){if(!(G instanceof TypeError))throw G;var K=convertJsFunctionToWasm(F,B);ue.set(z,K)}return te.set(F,z),z}function removeFunction(F){te.delete(ue.get(F)),re.push(F)}function addFunction(F,B){return addFunctionWasm(F,B)}F.wasmBinary&&(ne=F.wasmBinary),F.noExitRuntime,"object"!=typeof WebAssembly&&abort("no native wasm support detected");var oe,ae,se,ce,le=!1,de="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function UTF8ArrayToString(F,B,G){for(var W=B+G,z=B;F[z]&&!(z>=W);)++z;if(z-B>16&&F.subarray&&de)return de.decode(F.subarray(B,z));for(var K="";B<z;){var J=F[B++];if(128&J){var Q=63&F[B++];if(192!=(224&J)){var Y=63&F[B++];if((J=224==(240&J)?(15&J)<<12|Q<<6|Y:(7&J)<<18|Q<<12|Y<<6|63&F[B++])<65536)K+=String.fromCharCode(J);else{var $=J-65536;K+=String.fromCharCode(55296|$>>10,56320|1023&$)}}else K+=String.fromCharCode((31&J)<<6|Q)}else K+=String.fromCharCode(J)}return K}function UTF8ToString(F,B){return F?UTF8ArrayToString(se,F,B):""}function stringToUTF8Array(F,B,G,W){if(!(W>0))return 0;for(var z=G,K=G+W-1,J=0;J<F.length;++J){var Q=F.charCodeAt(J);if(Q>=55296&&Q<=57343&&(Q=65536+((1023&Q)<<10)|1023&F.charCodeAt(++J)),Q<=127){if(G>=K)break;B[G++]=Q}else if(Q<=2047){if(G+1>=K)break;B[G++]=192|Q>>6,B[G++]=128|63&Q}else if(Q<=65535){if(G+2>=K)break;B[G++]=224|Q>>12,B[G++]=128|Q>>6&63,B[G++]=128|63&Q}else{if(G+3>=K)break;B[G++]=240|Q>>18,B[G++]=128|Q>>12&63,B[G++]=128|Q>>6&63,B[G++]=128|63&Q}}return B[G]=0,G-z}function stringToUTF8(F,B,G){return stringToUTF8Array(F,se,B,G)}function lengthBytesUTF8(F){for(var B=0,G=0;G<F.length;++G){var W=F.charCodeAt(G);W>=55296&&W<=57343&&(W=65536+((1023&W)<<10)|1023&F.charCodeAt(++G)),W<=127?++B:B+=W<=2047?2:W<=65535?3:4}return B}function allocateUTF8(F){var B=lengthBytesUTF8(F)+1,G=Fe(B);return G&&stringToUTF8Array(F,ae,G,B),G}function allocateUTF8OnStack(F){var B=lengthBytesUTF8(F)+1,G=He(B);return stringToUTF8Array(F,ae,G,B),G}function writeArrayToMemory(F,B){ae.set(F,B)}function writeAsciiToMemory(F,B,G){for(var W=0;W<F.length;++W)ae[B++>>0]=F.charCodeAt(W);G||(ae[B>>0]=0)}function alignUp(F,B){return F%B>0&&(F+=B-F%B),F}function updateGlobalBufferAndViews(B){oe=B,F.HEAP8=ae=new Int8Array(B),F.HEAP16=new Int16Array(B),F.HEAP32=ce=new Int32Array(B),F.HEAPU8=se=new Uint8Array(B),F.HEAPU16=new Uint16Array(B),F.HEAPU32=new Uint32Array(B),F.HEAPF32=new Float32Array(B),F.HEAPF64=new Float64Array(B)}F.INITIAL_MEMORY;var ue,pe=[],he=[],ge=[];function preRun(){if(F.preRun)for("function"==typeof F.preRun&&(F.preRun=[F.preRun]);F.preRun.length;)addOnPreRun(F.preRun.shift());callRuntimeCallbacks(pe)}function initRuntime(){F.noFSInit||Pe.init.initialized||Pe.init(),Pe.ignorePermissions=!1,Ae.init(),callRuntimeCallbacks(he)}function postRun(){if(F.postRun)for("function"==typeof F.postRun&&(F.postRun=[F.postRun]);F.postRun.length;)addOnPostRun(F.postRun.shift());callRuntimeCallbacks(ge)}function addOnPreRun(F){pe.unshift(F)}function addOnInit(F){he.unshift(F)}function addOnPostRun(F){ge.unshift(F)}var fe=0,me=null;function addRunDependency(B){fe++,F.monitorRunDependencies&&F.monitorRunDependencies(fe)}function removeRunDependency(B){if(fe--,F.monitorRunDependencies&&F.monitorRunDependencies(fe),0==fe&&me){var G=me;me=null,G()}}function abort(B){F.onAbort&&F.onAbort(B),Z(B+=""),le=!0,B="abort("+B+"). Build with -s ASSERTIONS=1 for more info.";var W=new WebAssembly.RuntimeError(B);throw G(W),W}F.preloadedImages={},F.preloadedAudios={};var ve,ye,Se,_e,Ce="data:application/octet-stream;base64,";function isDataURI(F){return F.startsWith(Ce)}function getBinary(F){try{if(F==ve&&ne)return new Uint8Array(ne);if(!J)throw"both async and sync fetching of the wasm failed"}catch(F){abort(F)}}function getBinaryPromise(){return!ne&&Y&&"function"==typeof fetch?fetch(ve,{credentials:"same-origin"}).then((function(F){if(!F.ok)throw"failed to load wasm binary file at '"+ve+"'";return F.arrayBuffer()})).catch((function(){return getBinary(ve)})):Promise.resolve().then((function(){return getBinary(ve)}))}function createWasm(){var B={a:ke};function receiveInstance(B,G){var W=B.exports;F.asm=W,updateGlobalBufferAndViews((ie=F.asm.o).buffer),ue=F.asm.q,addOnInit(F.asm.p),removeRunDependency()}function receiveInstantiationResult(F){receiveInstance(F.instance)}function instantiateArrayBuffer(F){return getBinaryPromise().then((function(F){return WebAssembly.instantiate(F,B)})).then(F,(function(F){Z("failed to asynchronously prepare wasm: "+F),abort(F)}))}function instantiateAsync(){return ne||"function"!=typeof WebAssembly.instantiateStreaming||isDataURI(ve)||"function"!=typeof fetch?instantiateArrayBuffer(receiveInstantiationResult):fetch(ve,{credentials:"same-origin"}).then((function(F){return WebAssembly.instantiateStreaming(F,B).then(receiveInstantiationResult,(function(F){return Z("wasm streaming compile failed: "+F),Z("falling back to ArrayBuffer instantiation"),instantiateArrayBuffer(receiveInstantiationResult)}))}))}if(addRunDependency(),F.instantiateWasm)try{return F.instantiateWasm(B,receiveInstance)}catch(F){return Z("Module.instantiateWasm callback failed with error: "+F),!1}return instantiateAsync().catch(G),{}}function callRuntimeCallbacks(B){for(;B.length>0;){var G=B.shift();if("function"!=typeof G){var W=G.func;"number"==typeof W?void 0===G.arg?ue.get(W)():ue.get(W)(G.arg):W(void 0===G.arg?null:G.arg)}else G(F)}}function ___assert_fail(F,B,G,W){abort("Assertion failed: "+UTF8ToString(F)+", at: "+[B?UTF8ToString(B):"unknown filename",G,W?UTF8ToString(W):"unknown function"])}function _tzset(){if(!_tzset.called){_tzset.called=!0;var F=(new Date).getFullYear(),B=new Date(F,0,1),G=new Date(F,6,1),W=B.getTimezoneOffset(),z=G.getTimezoneOffset(),K=Math.max(W,z);ce[Be()>>2]=60*K,ce[je()>>2]=Number(W!=z);var J=extractZone(B),Q=extractZone(G),Y=allocateUTF8(J),$=allocateUTF8(Q);z<W?(ce[Ue()>>2]=Y,ce[Ue()+4>>2]=$):(ce[Ue()>>2]=$,ce[Ue()+4>>2]=Y)}function extractZone(F){var B=F.toTimeString().match(/\(([A-Za-z ]+)\)$/);return B?B[1]:"GMT"}}function _localtime_r(F,B){_tzset();var G=new Date(1e3*ce[F>>2]);ce[B>>2]=G.getSeconds(),ce[B+4>>2]=G.getMinutes(),ce[B+8>>2]=G.getHours(),ce[B+12>>2]=G.getDate(),ce[B+16>>2]=G.getMonth(),ce[B+20>>2]=G.getFullYear()-1900,ce[B+24>>2]=G.getDay();var W=new Date(G.getFullYear(),0,1),z=(G.getTime()-W.getTime())/864e5|0;ce[B+28>>2]=z,ce[B+36>>2]=-60*G.getTimezoneOffset();var K=new Date(G.getFullYear(),6,1).getTimezoneOffset(),J=W.getTimezoneOffset(),Q=0|(K!=J&&G.getTimezoneOffset()==Math.min(J,K));ce[B+32>>2]=Q;var Y=ce[Ue()+(Q?4:0)>>2];return ce[B+40>>2]=Y,B}function ___localtime_r(F,B){return _localtime_r(F,B)}function _abort(){abort()}F.locateFile?isDataURI(ve="UMSTranscoder.wasm")||(ve=locateFile(ve)):ve=new URL("https://middlelanewasm.z13.web.core.windows.net/UMSTranscoder.wasm").toString(),_e=function(){return performance.now()};var Te=!0;function setErrNo(F){return ce[xe()>>2]=F,F}function _clock_gettime(F,B){var G;if(0===F)G=Date.now();else{if(1!==F&&4!==F||!Te)return setErrNo(28),-1;G=_e()}return ce[B>>2]=G/1e3|0,ce[B+4>>2]=G%1e3*1e3*1e3|0,0}function _emscripten_memcpy_big(F,B,G){se.copyWithin(F,B,B+G)}function emscripten_realloc_buffer(F){try{return ie.grow(F-oe.byteLength+65535>>>16),updateGlobalBufferAndViews(ie.buffer),1}catch(F){}}function _emscripten_resize_heap(F){var B=se.length,G=2147483648;if((F>>>=0)>G)return!1;for(var W=1;W<=4;W*=2){var z=B*(1+.2/W);if(z=Math.min(z,F+100663296),emscripten_realloc_buffer(Math.min(G,alignUp(Math.max(F,z),65536))))return!0}return!1}var Ee={};function getExecutableName(){return Q||"./this.program"}function getEnvStrings(){if(!getEnvStrings.strings){var F={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:getExecutableName()};for(var B in Ee)void 0===Ee[B]?delete F[B]:F[B]=Ee[B];var G=[];for(var B in F)G.push(B+"="+F[B]);getEnvStrings.strings=G}return getEnvStrings.strings}var be={splitPath:function(F){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(F).slice(1)},normalizeArray:function(F,B){for(var G=0,W=F.length-1;W>=0;W--){var z=F[W];"."===z?F.splice(W,1):".."===z?(F.splice(W,1),G++):G&&(F.splice(W,1),G--)}if(B)for(;G;G--)F.unshift("..");return F},normalize:function(F){var B="/"===F.charAt(0),G="/"===F.substr(-1);return(F=be.normalizeArray(F.split("/").filter((function(F){return!!F})),!B).join("/"))||B||(F="."),F&&G&&(F+="/"),(B?"/":"")+F},dirname:function(F){var B=be.splitPath(F),G=B[0],W=B[1];return G||W?(W&&(W=W.substr(0,W.length-1)),G+W):"."},basename:function(F){if("/"===F)return"/";var B=(F=(F=be.normalize(F)).replace(/\/$/,"")).lastIndexOf("/");return-1===B?F:F.substr(B+1)},extname:function(F){return be.splitPath(F)[3]},join:function(){var F=Array.prototype.slice.call(arguments,0);return be.normalize(F.join("/"))},join2:function(F,B){return be.normalize(F+"/"+B)}};function getRandomDevice(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var F=new Uint8Array(1);return function(){return crypto.getRandomValues(F),F[0]}}return function(){abort("randomDevice")}}var Ie={resolve:function(){for(var F="",B=!1,G=arguments.length-1;G>=-1&&!B;G--){var W=G>=0?arguments[G]:Pe.cwd();if("string"!=typeof W)throw new TypeError("Arguments to path.resolve must be strings");if(!W)return"";F=W+"/"+F,B="/"===W.charAt(0)}return(B?"/":"")+(F=be.normalizeArray(F.split("/").filter((function(F){return!!F})),!B).join("/"))||"."},relative:function(F,B){function trim(F){for(var B=0;B<F.length&&""===F[B];B++);for(var G=F.length-1;G>=0&&""===F[G];G--);return B>G?[]:F.slice(B,G-B+1)}F=Ie.resolve(F).substr(1),B=Ie.resolve(B).substr(1);for(var G=trim(F.split("/")),W=trim(B.split("/")),z=Math.min(G.length,W.length),K=z,J=0;J<z;J++)if(G[J]!==W[J]){K=J;break}var Q=[];for(J=K;J<G.length;J++)Q.push("..");return(Q=Q.concat(W.slice(K))).join("/")}},Ae={ttys:[],init:function(){},shutdown:function(){},register:function(F,B){Ae.ttys[F]={input:[],output:[],ops:B},Pe.registerDevice(F,Ae.stream_ops)},stream_ops:{open:function(F){var B=Ae.ttys[F.node.rdev];if(!B)throw new Pe.ErrnoError(43);F.tty=B,F.seekable=!1},close:function(F){F.tty.ops.flush(F.tty)},flush:function(F){F.tty.ops.flush(F.tty)},read:function(F,B,G,W,z){if(!F.tty||!F.tty.ops.get_char)throw new Pe.ErrnoError(60);for(var K=0,J=0;J<W;J++){var Q;try{Q=F.tty.ops.get_char(F.tty)}catch(F){throw new Pe.ErrnoError(29)}if(void 0===Q&&0===K)throw new Pe.ErrnoError(6);if(null==Q)break;K++,B[G+J]=Q}return K&&(F.node.timestamp=Date.now()),K},write:function(F,B,G,W,z){if(!F.tty||!F.tty.ops.put_char)throw new Pe.ErrnoError(60);try{for(var K=0;K<W;K++)F.tty.ops.put_char(F.tty,B[G+K])}catch(F){throw new Pe.ErrnoError(29)}return W&&(F.node.timestamp=Date.now()),K}},default_tty_ops:{get_char:function(F){if(!F.input.length){var B=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(B=window.prompt("Input: "))&&(B+="\n"):"function"==typeof readline&&null!==(B=readline())&&(B+="\n"),!B)return null;F.input=intArrayFromString(B,!0)}return F.input.shift()},put_char:function(F,B){null===B||10===B?(X(UTF8ArrayToString(F.output,0)),F.output=[]):0!=B&&F.output.push(B)},flush:function(F){F.output&&F.output.length>0&&(X(UTF8ArrayToString(F.output,0)),F.output=[])}},default_tty1_ops:{put_char:function(F,B){null===B||10===B?(Z(UTF8ArrayToString(F.output,0)),F.output=[]):0!=B&&F.output.push(B)},flush:function(F){F.output&&F.output.length>0&&(Z(UTF8ArrayToString(F.output,0)),F.output=[])}}};function mmapAlloc(F){for(var B=alignMemory(F,65536),G=Fe(B);F<B;)ae[G+F++]=0;return G}var Re={ops_table:null,mount:function(F){return Re.createNode(null,"/",16895,0)},createNode:function(F,B,G,W){if(Pe.isBlkdev(G)||Pe.isFIFO(G))throw new Pe.ErrnoError(63);Re.ops_table||(Re.ops_table={dir:{node:{getattr:Re.node_ops.getattr,setattr:Re.node_ops.setattr,lookup:Re.node_ops.lookup,mknod:Re.node_ops.mknod,rename:Re.node_ops.rename,unlink:Re.node_ops.unlink,rmdir:Re.node_ops.rmdir,readdir:Re.node_ops.readdir,symlink:Re.node_ops.symlink},stream:{llseek:Re.stream_ops.llseek}},file:{node:{getattr:Re.node_ops.getattr,setattr:Re.node_ops.setattr},stream:{llseek:Re.stream_ops.llseek,read:Re.stream_ops.read,write:Re.stream_ops.write,allocate:Re.stream_ops.allocate,mmap:Re.stream_ops.mmap,msync:Re.stream_ops.msync}},link:{node:{getattr:Re.node_ops.getattr,setattr:Re.node_ops.setattr,readlink:Re.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Re.node_ops.getattr,setattr:Re.node_ops.setattr},stream:Pe.chrdev_stream_ops}});var z=Pe.createNode(F,B,G,W);return Pe.isDir(z.mode)?(z.node_ops=Re.ops_table.dir.node,z.stream_ops=Re.ops_table.dir.stream,z.contents={}):Pe.isFile(z.mode)?(z.node_ops=Re.ops_table.file.node,z.stream_ops=Re.ops_table.file.stream,z.usedBytes=0,z.contents=null):Pe.isLink(z.mode)?(z.node_ops=Re.ops_table.link.node,z.stream_ops=Re.ops_table.link.stream):Pe.isChrdev(z.mode)&&(z.node_ops=Re.ops_table.chrdev.node,z.stream_ops=Re.ops_table.chrdev.stream),z.timestamp=Date.now(),F&&(F.contents[B]=z,F.timestamp=z.timestamp),z},getFileDataAsTypedArray:function(F){return F.contents?F.contents.subarray?F.contents.subarray(0,F.usedBytes):new Uint8Array(F.contents):new Uint8Array(0)},expandFileStorage:function(F,B){var G=F.contents?F.contents.length:0;if(!(G>=B)){var W=1048576;B=Math.max(B,G*(G<W?2:1.125)>>>0),0!=G&&(B=Math.max(B,256));var z=F.contents;F.contents=new Uint8Array(B),F.usedBytes>0&&F.contents.set(z.subarray(0,F.usedBytes),0)}},resizeFileStorage:function(F,B){if(F.usedBytes!=B)if(0==B)F.contents=null,F.usedBytes=0;else{var G=F.contents;F.contents=new Uint8Array(B),G&&F.contents.set(G.subarray(0,Math.min(B,F.usedBytes))),F.usedBytes=B}},node_ops:{getattr:function(F){var B={};return B.dev=Pe.isChrdev(F.mode)?F.id:1,B.ino=F.id,B.mode=F.mode,B.nlink=1,B.uid=0,B.gid=0,B.rdev=F.rdev,Pe.isDir(F.mode)?B.size=4096:Pe.isFile(F.mode)?B.size=F.usedBytes:Pe.isLink(F.mode)?B.size=F.link.length:B.size=0,B.atime=new Date(F.timestamp),B.mtime=new Date(F.timestamp),B.ctime=new Date(F.timestamp),B.blksize=4096,B.blocks=Math.ceil(B.size/B.blksize),B},setattr:function(F,B){void 0!==B.mode&&(F.mode=B.mode),void 0!==B.timestamp&&(F.timestamp=B.timestamp),void 0!==B.size&&Re.resizeFileStorage(F,B.size)},lookup:function(F,B){throw Pe.genericErrors[44]},mknod:function(F,B,G,W){return Re.createNode(F,B,G,W)},rename:function(F,B,G){if(Pe.isDir(F.mode)){var W;try{W=Pe.lookupNode(B,G)}catch(F){}if(W)for(var z in W.contents)throw new Pe.ErrnoError(55)}delete F.parent.contents[F.name],F.parent.timestamp=Date.now(),F.name=G,B.contents[G]=F,B.timestamp=F.parent.timestamp,F.parent=B},unlink:function(F,B){delete F.contents[B],F.timestamp=Date.now()},rmdir:function(F,B){var G=Pe.lookupNode(F,B);for(var W in G.contents)throw new Pe.ErrnoError(55);delete F.contents[B],F.timestamp=Date.now()},readdir:function(F){var B=[".",".."];for(var G in F.contents)F.contents.hasOwnProperty(G)&&B.push(G);return B},symlink:function(F,B,G){var W=Re.createNode(F,B,41471,0);return W.link=G,W},readlink:function(F){if(!Pe.isLink(F.mode))throw new Pe.ErrnoError(28);return F.link}},stream_ops:{read:function(F,B,G,W,z){var K=F.node.contents;if(z>=F.node.usedBytes)return 0;var J=Math.min(F.node.usedBytes-z,W);if(J>8&&K.subarray)B.set(K.subarray(z,z+J),G);else for(var Q=0;Q<J;Q++)B[G+Q]=K[z+Q];return J},write:function(F,B,G,W,z,K){if(B.buffer===ae.buffer&&(K=!1),!W)return 0;var J=F.node;if(J.timestamp=Date.now(),B.subarray&&(!J.contents||J.contents.subarray)){if(K)return J.contents=B.subarray(G,G+W),J.usedBytes=W,W;if(0===J.usedBytes&&0===z)return J.contents=B.slice(G,G+W),J.usedBytes=W,W;if(z+W<=J.usedBytes)return J.contents.set(B.subarray(G,G+W),z),W}if(Re.expandFileStorage(J,z+W),J.contents.subarray&&B.subarray)J.contents.set(B.subarray(G,G+W),z);else for(var Q=0;Q<W;Q++)J.contents[z+Q]=B[G+Q];return J.usedBytes=Math.max(J.usedBytes,z+W),W},llseek:function(F,B,G){var W=B;if(1===G?W+=F.position:2===G&&Pe.isFile(F.node.mode)&&(W+=F.node.usedBytes),W<0)throw new Pe.ErrnoError(28);return W},allocate:function(F,B,G){Re.expandFileStorage(F.node,B+G),F.node.usedBytes=Math.max(F.node.usedBytes,B+G)},mmap:function(F,B,G,W,z,K){if(0!==B)throw new Pe.ErrnoError(28);if(!Pe.isFile(F.node.mode))throw new Pe.ErrnoError(43);var J,Q,Y=F.node.contents;if(2&K||Y.buffer!==oe){if((W>0||W+G<Y.length)&&(Y=Y.subarray?Y.subarray(W,W+G):Array.prototype.slice.call(Y,W,W+G)),Q=!0,!(J=mmapAlloc(G)))throw new Pe.ErrnoError(48);ae.set(Y,J)}else Q=!1,J=Y.byteOffset;return{ptr:J,allocated:Q}},msync:function(F,B,G,W,z){if(!Pe.isFile(F.node.mode))throw new Pe.ErrnoError(43);return 2&z||Re.stream_ops.write(F,B,0,W,G,!1),0}}},Pe={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(F,B){if(B=B||{},!(F=Ie.resolve(Pe.cwd(),F)))return{path:"",node:null};var G={follow_mount:!0,recurse_count:0};for(var W in G)void 0===B[W]&&(B[W]=G[W]);if(B.recurse_count>8)throw new Pe.ErrnoError(32);for(var z=be.normalizeArray(F.split("/").filter((function(F){return!!F})),!1),K=Pe.root,J="/",Q=0;Q<z.length;Q++){var Y=Q===z.length-1;if(Y&&B.parent)break;if(K=Pe.lookupNode(K,z[Q]),J=be.join2(J,z[Q]),Pe.isMountpoint(K)&&(!Y||Y&&B.follow_mount)&&(K=K.mounted.root),!Y||B.follow)for(var $=0;Pe.isLink(K.mode);){var X=Pe.readlink(J);if(J=Ie.resolve(be.dirname(J),X),K=Pe.lookupPath(J,{recurse_count:B.recurse_count}).node,$++>40)throw new Pe.ErrnoError(32)}}return{path:J,node:K}},getPath:function(F){for(var B;;){if(Pe.isRoot(F)){var G=F.mount.mountpoint;return B?"/"!==G[G.length-1]?G+"/"+B:G+B:G}B=B?F.name+"/"+B:F.name,F=F.parent}},hashName:function(F,B){for(var G=0,W=0;W<B.length;W++)G=(G<<5)-G+B.charCodeAt(W)|0;return(F+G>>>0)%Pe.nameTable.length},hashAddNode:function(F){var B=Pe.hashName(F.parent.id,F.name);F.name_next=Pe.nameTable[B],Pe.nameTable[B]=F},hashRemoveNode:function(F){var B=Pe.hashName(F.parent.id,F.name);if(Pe.nameTable[B]===F)Pe.nameTable[B]=F.name_next;else for(var G=Pe.nameTable[B];G;){if(G.name_next===F){G.name_next=F.name_next;break}G=G.name_next}},lookupNode:function(F,B){var G=Pe.mayLookup(F);if(G)throw new Pe.ErrnoError(G,F);for(var W=Pe.hashName(F.id,B),z=Pe.nameTable[W];z;z=z.name_next){var K=z.name;if(z.parent.id===F.id&&K===B)return z}return Pe.lookup(F,B)},createNode:function(F,B,G,W){var z=new Pe.FSNode(F,B,G,W);return Pe.hashAddNode(z),z},destroyNode:function(F){Pe.hashRemoveNode(F)},isRoot:function(F){return F===F.parent},isMountpoint:function(F){return!!F.mounted},isFile:function(F){return 32768==(61440&F)},isDir:function(F){return 16384==(61440&F)},isLink:function(F){return 40960==(61440&F)},isChrdev:function(F){return 8192==(61440&F)},isBlkdev:function(F){return 24576==(61440&F)},isFIFO:function(F){return 4096==(61440&F)},isSocket:function(F){return 49152==(49152&F)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(F){var B=Pe.flagModes[F];if(void 0===B)throw new Error("Unknown file open mode: "+F);return B},flagsToPermissionString:function(F){var B=["r","w","rw"][3&F];return 512&F&&(B+="w"),B},nodePermissions:function(F,B){return Pe.ignorePermissions||(!B.includes("r")||292&F.mode)&&(!B.includes("w")||146&F.mode)&&(!B.includes("x")||73&F.mode)?0:2},mayLookup:function(F){var B=Pe.nodePermissions(F,"x");return B||(F.node_ops.lookup?0:2)},mayCreate:function(F,B){try{return Pe.lookupNode(F,B),20}catch(F){}return Pe.nodePermissions(F,"wx")},mayDelete:function(F,B,G){var W;try{W=Pe.lookupNode(F,B)}catch(F){return F.errno}var z=Pe.nodePermissions(F,"wx");if(z)return z;if(G){if(!Pe.isDir(W.mode))return 54;if(Pe.isRoot(W)||Pe.getPath(W)===Pe.cwd())return 10}else if(Pe.isDir(W.mode))return 31;return 0},mayOpen:function(F,B){return F?Pe.isLink(F.mode)?32:Pe.isDir(F.mode)&&("r"!==Pe.flagsToPermissionString(B)||512&B)?31:Pe.nodePermissions(F,Pe.flagsToPermissionString(B)):44},MAX_OPEN_FDS:4096,nextfd:function(F,B){F=F||0,B=B||Pe.MAX_OPEN_FDS;for(var G=F;G<=B;G++)if(!Pe.streams[G])return G;throw new Pe.ErrnoError(33)},getStream:function(F){return Pe.streams[F]},createStream:function(F,B,G){Pe.FSStream||(Pe.FSStream=function(){},Pe.FSStream.prototype={object:{get:function(){return this.node},set:function(F){this.node=F}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var W=new Pe.FSStream;for(var z in F)W[z]=F[z];F=W;var K=Pe.nextfd(B,G);return F.fd=K,Pe.streams[K]=F,F},closeStream:function(F){Pe.streams[F]=null},chrdev_stream_ops:{open:function(F){var B=Pe.getDevice(F.node.rdev);F.stream_ops=B.stream_ops,F.stream_ops.open&&F.stream_ops.open(F)},llseek:function(){throw new Pe.ErrnoError(70)}},major:function(F){return F>>8},minor:function(F){return 255&F},makedev:function(F,B){return F<<8|B},registerDevice:function(F,B){Pe.devices[F]={stream_ops:B}},getDevice:function(F){return Pe.devices[F]},getMounts:function(F){for(var B=[],G=[F];G.length;){var W=G.pop();B.push(W),G.push.apply(G,W.mounts)}return B},syncfs:function(F,B){"function"==typeof F&&(B=F,F=!1),Pe.syncFSRequests++,Pe.syncFSRequests>1&&Z("warning: "+Pe.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var G=Pe.getMounts(Pe.root.mount),W=0;function doCallback(F){return Pe.syncFSRequests--,B(F)}function done(F){if(F)return done.errored?void 0:(done.errored=!0,doCallback(F));++W>=G.length&&doCallback(null)}G.forEach((function(B){if(!B.type.syncfs)return done(null);B.type.syncfs(B,F,done)}))},mount:function(F,B,G){var W,z="/"===G,K=!G;if(z&&Pe.root)throw new Pe.ErrnoError(10);if(!z&&!K){var J=Pe.lookupPath(G,{follow_mount:!1});if(G=J.path,W=J.node,Pe.isMountpoint(W))throw new Pe.ErrnoError(10);if(!Pe.isDir(W.mode))throw new Pe.ErrnoError(54)}var Q={type:F,opts:B,mountpoint:G,mounts:[]},Y=F.mount(Q);return Y.mount=Q,Q.root=Y,z?Pe.root=Y:W&&(W.mounted=Q,W.mount&&W.mount.mounts.push(Q)),Y},unmount:function(F){var B=Pe.lookupPath(F,{follow_mount:!1});if(!Pe.isMountpoint(B.node))throw new Pe.ErrnoError(28);var G=B.node,W=G.mounted,z=Pe.getMounts(W);Object.keys(Pe.nameTable).forEach((function(F){for(var B=Pe.nameTable[F];B;){var G=B.name_next;z.includes(B.mount)&&Pe.destroyNode(B),B=G}})),G.mounted=null;var K=G.mount.mounts.indexOf(W);G.mount.mounts.splice(K,1)},lookup:function(F,B){return F.node_ops.lookup(F,B)},mknod:function(F,B,G){var W=Pe.lookupPath(F,{parent:!0}).node,z=be.basename(F);if(!z||"."===z||".."===z)throw new Pe.ErrnoError(28);var K=Pe.mayCreate(W,z);if(K)throw new Pe.ErrnoError(K);if(!W.node_ops.mknod)throw new Pe.ErrnoError(63);return W.node_ops.mknod(W,z,B,G)},create:function(F,B){return B=void 0!==B?B:438,B&=4095,B|=32768,Pe.mknod(F,B,0)},mkdir:function(F,B){return B=void 0!==B?B:511,B&=1023,B|=16384,Pe.mknod(F,B,0)},mkdirTree:function(F,B){for(var G=F.split("/"),W="",z=0;z<G.length;++z)if(G[z]){W+="/"+G[z];try{Pe.mkdir(W,B)}catch(F){if(20!=F.errno)throw F}}},mkdev:function(F,B,G){return void 0===G&&(G=B,B=438),B|=8192,Pe.mknod(F,B,G)},symlink:function(F,B){if(!Ie.resolve(F))throw new Pe.ErrnoError(44);var G=Pe.lookupPath(B,{parent:!0}).node;if(!G)throw new Pe.ErrnoError(44);var W=be.basename(B),z=Pe.mayCreate(G,W);if(z)throw new Pe.ErrnoError(z);if(!G.node_ops.symlink)throw new Pe.ErrnoError(63);return G.node_ops.symlink(G,W,F)},rename:function(F,B){var G,W,z=be.dirname(F),K=be.dirname(B),J=be.basename(F),Q=be.basename(B);if(G=Pe.lookupPath(F,{parent:!0}).node,W=Pe.lookupPath(B,{parent:!0}).node,!G||!W)throw new Pe.ErrnoError(44);if(G.mount!==W.mount)throw new Pe.ErrnoError(75);var Y,$=Pe.lookupNode(G,J),X=Ie.relative(F,K);if("."!==X.charAt(0))throw new Pe.ErrnoError(28);if("."!==(X=Ie.relative(B,z)).charAt(0))throw new Pe.ErrnoError(55);try{Y=Pe.lookupNode(W,Q)}catch(F){}if($!==Y){var ee=Pe.isDir($.mode),te=Pe.mayDelete(G,J,ee);if(te)throw new Pe.ErrnoError(te);if(te=Y?Pe.mayDelete(W,Q,ee):Pe.mayCreate(W,Q))throw new Pe.ErrnoError(te);if(!G.node_ops.rename)throw new Pe.ErrnoError(63);if(Pe.isMountpoint($)||Y&&Pe.isMountpoint(Y))throw new Pe.ErrnoError(10);if(W!==G&&(te=Pe.nodePermissions(G,"w")))throw new Pe.ErrnoError(te);try{Pe.trackingDelegate.willMovePath&&Pe.trackingDelegate.willMovePath(F,B)}catch(G){Z("FS.trackingDelegate['willMovePath']('"+F+"', '"+B+"') threw an exception: "+G.message)}Pe.hashRemoveNode($);try{G.node_ops.rename($,W,Q)}catch(F){throw F}finally{Pe.hashAddNode($)}try{Pe.trackingDelegate.onMovePath&&Pe.trackingDelegate.onMovePath(F,B)}catch(G){Z("FS.trackingDelegate['onMovePath']('"+F+"', '"+B+"') threw an exception: "+G.message)}}},rmdir:function(F){var B=Pe.lookupPath(F,{parent:!0}).node,G=be.basename(F),W=Pe.lookupNode(B,G),z=Pe.mayDelete(B,G,!0);if(z)throw new Pe.ErrnoError(z);if(!B.node_ops.rmdir)throw new Pe.ErrnoError(63);if(Pe.isMountpoint(W))throw new Pe.ErrnoError(10);try{Pe.trackingDelegate.willDeletePath&&Pe.trackingDelegate.willDeletePath(F)}catch(B){Z("FS.trackingDelegate['willDeletePath']('"+F+"') threw an exception: "+B.message)}B.node_ops.rmdir(B,G),Pe.destroyNode(W);try{Pe.trackingDelegate.onDeletePath&&Pe.trackingDelegate.onDeletePath(F)}catch(B){Z("FS.trackingDelegate['onDeletePath']('"+F+"') threw an exception: "+B.message)}},readdir:function(F){var B=Pe.lookupPath(F,{follow:!0}).node;if(!B.node_ops.readdir)throw new Pe.ErrnoError(54);return B.node_ops.readdir(B)},unlink:function(F){var B=Pe.lookupPath(F,{parent:!0}).node,G=be.basename(F),W=Pe.lookupNode(B,G),z=Pe.mayDelete(B,G,!1);if(z)throw new Pe.ErrnoError(z);if(!B.node_ops.unlink)throw new Pe.ErrnoError(63);if(Pe.isMountpoint(W))throw new Pe.ErrnoError(10);try{Pe.trackingDelegate.willDeletePath&&Pe.trackingDelegate.willDeletePath(F)}catch(B){Z("FS.trackingDelegate['willDeletePath']('"+F+"') threw an exception: "+B.message)}B.node_ops.unlink(B,G),Pe.destroyNode(W);try{Pe.trackingDelegate.onDeletePath&&Pe.trackingDelegate.onDeletePath(F)}catch(B){Z("FS.trackingDelegate['onDeletePath']('"+F+"') threw an exception: "+B.message)}},readlink:function(F){var B=Pe.lookupPath(F).node;if(!B)throw new Pe.ErrnoError(44);if(!B.node_ops.readlink)throw new Pe.ErrnoError(28);return Ie.resolve(Pe.getPath(B.parent),B.node_ops.readlink(B))},stat:function(F,B){var G=Pe.lookupPath(F,{follow:!B}).node;if(!G)throw new Pe.ErrnoError(44);if(!G.node_ops.getattr)throw new Pe.ErrnoError(63);return G.node_ops.getattr(G)},lstat:function(F){return Pe.stat(F,!0)},chmod:function(F,B,G){var W;if(!(W="string"==typeof F?Pe.lookupPath(F,{follow:!G}).node:F).node_ops.setattr)throw new Pe.ErrnoError(63);W.node_ops.setattr(W,{mode:4095&B|-4096&W.mode,timestamp:Date.now()})},lchmod:function(F,B){Pe.chmod(F,B,!0)},fchmod:function(F,B){var G=Pe.getStream(F);if(!G)throw new Pe.ErrnoError(8);Pe.chmod(G.node,B)},chown:function(F,B,G,W){var z;if(!(z="string"==typeof F?Pe.lookupPath(F,{follow:!W}).node:F).node_ops.setattr)throw new Pe.ErrnoError(63);z.node_ops.setattr(z,{timestamp:Date.now()})},lchown:function(F,B,G){Pe.chown(F,B,G,!0)},fchown:function(F,B,G){var W=Pe.getStream(F);if(!W)throw new Pe.ErrnoError(8);Pe.chown(W.node,B,G)},truncate:function(F,B){if(B<0)throw new Pe.ErrnoError(28);var G;if(!(G="string"==typeof F?Pe.lookupPath(F,{follow:!0}).node:F).node_ops.setattr)throw new Pe.ErrnoError(63);if(Pe.isDir(G.mode))throw new Pe.ErrnoError(31);if(!Pe.isFile(G.mode))throw new Pe.ErrnoError(28);var W=Pe.nodePermissions(G,"w");if(W)throw new Pe.ErrnoError(W);G.node_ops.setattr(G,{size:B,timestamp:Date.now()})},ftruncate:function(F,B){var G=Pe.getStream(F);if(!G)throw new Pe.ErrnoError(8);if(0==(2097155&G.flags))throw new Pe.ErrnoError(28);Pe.truncate(G.node,B)},utime:function(F,B,G){var W=Pe.lookupPath(F,{follow:!0}).node;W.node_ops.setattr(W,{timestamp:Math.max(B,G)})},open:function(B,G,W,z,K){if(""===B)throw new Pe.ErrnoError(44);var J;if(W=void 0===W?438:W,W=64&(G="string"==typeof G?Pe.modeStringToFlags(G):G)?4095&W|32768:0,"object"==typeof B)J=B;else{B=be.normalize(B);try{J=Pe.lookupPath(B,{follow:!(131072&G)}).node}catch(F){}}var Q=!1;if(64&G)if(J){if(128&G)throw new Pe.ErrnoError(20)}else J=Pe.mknod(B,W,0),Q=!0;if(!J)throw new Pe.ErrnoError(44);if(Pe.isChrdev(J.mode)&&(G&=-513),65536&G&&!Pe.isDir(J.mode))throw new Pe.ErrnoError(54);if(!Q){var Y=Pe.mayOpen(J,G);if(Y)throw new Pe.ErrnoError(Y)}512&G&&Pe.truncate(J,0),G&=-131713;var $=Pe.createStream({node:J,path:Pe.getPath(J),flags:G,seekable:!0,position:0,stream_ops:J.stream_ops,ungotten:[],error:!1},z,K);$.stream_ops.open&&$.stream_ops.open($),!F.logReadFiles||1&G||(Pe.readFiles||(Pe.readFiles={}),B in Pe.readFiles||(Pe.readFiles[B]=1,Z("FS.trackingDelegate error on read file: "+B)));try{if(Pe.trackingDelegate.onOpenFile){var X=0;1!=(2097155&G)&&(X|=Pe.tracking.openFlags.READ),0!=(2097155&G)&&(X|=Pe.tracking.openFlags.WRITE),Pe.trackingDelegate.onOpenFile(B,X)}}catch(F){Z("FS.trackingDelegate['onOpenFile']('"+B+"', flags) threw an exception: "+F.message)}return $},close:function(F){if(Pe.isClosed(F))throw new Pe.ErrnoError(8);F.getdents&&(F.getdents=null);try{F.stream_ops.close&&F.stream_ops.close(F)}catch(F){throw F}finally{Pe.closeStream(F.fd)}F.fd=null},isClosed:function(F){return null===F.fd},llseek:function(F,B,G){if(Pe.isClosed(F))throw new Pe.ErrnoError(8);if(!F.seekable||!F.stream_ops.llseek)throw new Pe.ErrnoError(70);if(0!=G&&1!=G&&2!=G)throw new Pe.ErrnoError(28);return F.position=F.stream_ops.llseek(F,B,G),F.ungotten=[],F.position},read:function(F,B,G,W,z){if(W<0||z<0)throw new Pe.ErrnoError(28);if(Pe.isClosed(F))throw new Pe.ErrnoError(8);if(1==(2097155&F.flags))throw new Pe.ErrnoError(8);if(Pe.isDir(F.node.mode))throw new Pe.ErrnoError(31);if(!F.stream_ops.read)throw new Pe.ErrnoError(28);var K=void 0!==z;if(K){if(!F.seekable)throw new Pe.ErrnoError(70)}else z=F.position;var J=F.stream_ops.read(F,B,G,W,z);return K||(F.position+=J),J},write:function(F,B,G,W,z,K){if(W<0||z<0)throw new Pe.ErrnoError(28);if(Pe.isClosed(F))throw new Pe.ErrnoError(8);if(0==(2097155&F.flags))throw new Pe.ErrnoError(8);if(Pe.isDir(F.node.mode))throw new Pe.ErrnoError(31);if(!F.stream_ops.write)throw new Pe.ErrnoError(28);F.seekable&&1024&F.flags&&Pe.llseek(F,0,2);var J=void 0!==z;if(J){if(!F.seekable)throw new Pe.ErrnoError(70)}else z=F.position;var Q=F.stream_ops.write(F,B,G,W,z,K);J||(F.position+=Q);try{F.path&&Pe.trackingDelegate.onWriteToFile&&Pe.trackingDelegate.onWriteToFile(F.path)}catch(B){Z("FS.trackingDelegate['onWriteToFile']('"+F.path+"') threw an exception: "+B.message)}return Q},allocate:function(F,B,G){if(Pe.isClosed(F))throw new Pe.ErrnoError(8);if(B<0||G<=0)throw new Pe.ErrnoError(28);if(0==(2097155&F.flags))throw new Pe.ErrnoError(8);if(!Pe.isFile(F.node.mode)&&!Pe.isDir(F.node.mode))throw new Pe.ErrnoError(43);if(!F.stream_ops.allocate)throw new Pe.ErrnoError(138);F.stream_ops.allocate(F,B,G)},mmap:function(F,B,G,W,z,K){if(0!=(2&z)&&0==(2&K)&&2!=(2097155&F.flags))throw new Pe.ErrnoError(2);if(1==(2097155&F.flags))throw new Pe.ErrnoError(2);if(!F.stream_ops.mmap)throw new Pe.ErrnoError(43);return F.stream_ops.mmap(F,B,G,W,z,K)},msync:function(F,B,G,W,z){return F&&F.stream_ops.msync?F.stream_ops.msync(F,B,G,W,z):0},munmap:function(F){return 0},ioctl:function(F,B,G){if(!F.stream_ops.ioctl)throw new Pe.ErrnoError(59);return F.stream_ops.ioctl(F,B,G)},readFile:function(F,B){if((B=B||{}).flags=B.flags||0,B.encoding=B.encoding||"binary","utf8"!==B.encoding&&"binary"!==B.encoding)throw new Error('Invalid encoding type "'+B.encoding+'"');var G,W=Pe.open(F,B.flags),z=Pe.stat(F).size,K=new Uint8Array(z);return Pe.read(W,K,0,z,0),"utf8"===B.encoding?G=UTF8ArrayToString(K,0):"binary"===B.encoding&&(G=K),Pe.close(W),G},writeFile:function(F,B,G){(G=G||{}).flags=G.flags||577;var W=Pe.open(F,G.flags,G.mode);if("string"==typeof B){var z=new Uint8Array(lengthBytesUTF8(B)+1),K=stringToUTF8Array(B,z,0,z.length);Pe.write(W,z,0,K,void 0,G.canOwn)}else{if(!ArrayBuffer.isView(B))throw new Error("Unsupported data type");Pe.write(W,B,0,B.byteLength,void 0,G.canOwn)}Pe.close(W)},cwd:function(){return Pe.currentPath},chdir:function(F){var B=Pe.lookupPath(F,{follow:!0});if(null===B.node)throw new Pe.ErrnoError(44);if(!Pe.isDir(B.node.mode))throw new Pe.ErrnoError(54);var G=Pe.nodePermissions(B.node,"x");if(G)throw new Pe.ErrnoError(G);Pe.currentPath=B.path},createDefaultDirectories:function(){Pe.mkdir("/tmp"),Pe.mkdir("/home"),Pe.mkdir("/home/web_user")},createDefaultDevices:function(){Pe.mkdir("/dev"),Pe.registerDevice(Pe.makedev(1,3),{read:function(){return 0},write:function(F,B,G,W,z){return W}}),Pe.mkdev("/dev/null",Pe.makedev(1,3)),Ae.register(Pe.makedev(5,0),Ae.default_tty_ops),Ae.register(Pe.makedev(6,0),Ae.default_tty1_ops),Pe.mkdev("/dev/tty",Pe.makedev(5,0)),Pe.mkdev("/dev/tty1",Pe.makedev(6,0));var F=getRandomDevice();Pe.createDevice("/dev","random",F),Pe.createDevice("/dev","urandom",F),Pe.mkdir("/dev/shm"),Pe.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){Pe.mkdir("/proc");var F=Pe.mkdir("/proc/self");Pe.mkdir("/proc/self/fd"),Pe.mount({mount:function(){var B=Pe.createNode(F,"fd",16895,73);return B.node_ops={lookup:function(F,B){var G=+B,W=Pe.getStream(G);if(!W)throw new Pe.ErrnoError(8);var z={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return W.path}}};return z.parent=z,z}},B}},{},"/proc/self/fd")},createStandardStreams:function(){F.stdin?Pe.createDevice("/dev","stdin",F.stdin):Pe.symlink("/dev/tty","/dev/stdin"),F.stdout?Pe.createDevice("/dev","stdout",null,F.stdout):Pe.symlink("/dev/tty","/dev/stdout"),F.stderr?Pe.createDevice("/dev","stderr",null,F.stderr):Pe.symlink("/dev/tty1","/dev/stderr"),Pe.open("/dev/stdin",0),Pe.open("/dev/stdout",1),Pe.open("/dev/stderr",1)},ensureErrnoError:function(){Pe.ErrnoError||(Pe.ErrnoError=function ErrnoError(F,B){this.node=B,this.setErrno=function(F){this.errno=F},this.setErrno(F),this.message="FS error"},Pe.ErrnoError.prototype=new Error,Pe.ErrnoError.prototype.constructor=Pe.ErrnoError,[44].forEach((function(F){Pe.genericErrors[F]=new Pe.ErrnoError(F),Pe.genericErrors[F].stack="<generic error, no stack>"})))},staticInit:function(){Pe.ensureErrnoError(),Pe.nameTable=new Array(4096),Pe.mount(Re,{},"/"),Pe.createDefaultDirectories(),Pe.createDefaultDevices(),Pe.createSpecialDirectories(),Pe.filesystems={MEMFS:Re}},init:function(B,G,W){Pe.init.initialized=!0,Pe.ensureErrnoError(),F.stdin=B||F.stdin,F.stdout=G||F.stdout,F.stderr=W||F.stderr,Pe.createStandardStreams()},quit:function(){Pe.init.initialized=!1;var B=F._fflush;B&&B(0);for(var G=0;G<Pe.streams.length;G++){var W=Pe.streams[G];W&&Pe.close(W)}},getMode:function(F,B){var G=0;return F&&(G|=365),B&&(G|=146),G},findObject:function(F,B){var G=Pe.analyzePath(F,B);return G.exists?G.object:null},analyzePath:function(F,B){try{F=(W=Pe.lookupPath(F,{follow:!B})).path}catch(F){}var G={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var W=Pe.lookupPath(F,{parent:!0});G.parentExists=!0,G.parentPath=W.path,G.parentObject=W.node,G.name=be.basename(F),W=Pe.lookupPath(F,{follow:!B}),G.exists=!0,G.path=W.path,G.object=W.node,G.name=W.node.name,G.isRoot="/"===W.path}catch(F){G.error=F.errno}return G},createPath:function(F,B,G,W){F="string"==typeof F?F:Pe.getPath(F);for(var z=B.split("/").reverse();z.length;){var K=z.pop();if(K){var J=be.join2(F,K);try{Pe.mkdir(J)}catch(F){}F=J}}return J},createFile:function(F,B,G,W,z){var K=be.join2("string"==typeof F?F:Pe.getPath(F),B),J=Pe.getMode(W,z);return Pe.create(K,J)},createDataFile:function(F,B,G,W,z,K){var J=B?be.join2("string"==typeof F?F:Pe.getPath(F),B):F,Q=Pe.getMode(W,z),Y=Pe.create(J,Q);if(G){if("string"==typeof G){for(var $=new Array(G.length),X=0,Z=G.length;X<Z;++X)$[X]=G.charCodeAt(X);G=$}Pe.chmod(Y,146|Q);var ee=Pe.open(Y,577);Pe.write(ee,G,0,G.length,0,K),Pe.close(ee),Pe.chmod(Y,Q)}return Y},createDevice:function(F,B,G,W){var z=be.join2("string"==typeof F?F:Pe.getPath(F),B),K=Pe.getMode(!!G,!!W);Pe.createDevice.major||(Pe.createDevice.major=64);var J=Pe.makedev(Pe.createDevice.major++,0);return Pe.registerDevice(J,{open:function(F){F.seekable=!1},close:function(F){W&&W.buffer&&W.buffer.length&&W(10)},read:function(F,B,W,z,K){for(var J=0,Q=0;Q<z;Q++){var Y;try{Y=G()}catch(F){throw new Pe.ErrnoError(29)}if(void 0===Y&&0===J)throw new Pe.ErrnoError(6);if(null==Y)break;J++,B[W+Q]=Y}return J&&(F.node.timestamp=Date.now()),J},write:function(F,B,G,z,K){for(var J=0;J<z;J++)try{W(B[G+J])}catch(F){throw new Pe.ErrnoError(29)}return z&&(F.node.timestamp=Date.now()),J}}),Pe.mkdev(z,K,J)},forceLoadFile:function(F){if(F.isDevice||F.isFolder||F.link||F.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!K)throw new Error("Cannot load without read() or XMLHttpRequest.");try{F.contents=intArrayFromString(K(F.url),!0),F.usedBytes=F.contents.length}catch(F){throw new Pe.ErrnoError(29)}},createLazyFile:function(F,B,G,W,z){function LazyUint8Array(){this.lengthKnown=!1,this.chunks=[]}if(LazyUint8Array.prototype.get=function LazyUint8Array_get(F){if(!(F>this.length-1||F<0)){var B=F%this.chunkSize,G=F/this.chunkSize|0;return this.getter(G)[B]}},LazyUint8Array.prototype.setDataGetter=function LazyUint8Array_setDataGetter(F){this.getter=F},LazyUint8Array.prototype.cacheLength=function LazyUint8Array_cacheLength(){var F=new XMLHttpRequest;if(F.open("HEAD",G,!1),F.send(null),!(F.status>=200&&F.status<300||304===F.status))throw new Error("Couldn't load "+G+". Status: "+F.status);var B,W=Number(F.getResponseHeader("Content-length")),z=(B=F.getResponseHeader("Accept-Ranges"))&&"bytes"===B,K=(B=F.getResponseHeader("Content-Encoding"))&&"gzip"===B,J=1048576;z||(J=W);var doXHR=function(F,B){if(F>B)throw new Error("invalid range ("+F+", "+B+") or no bytes requested!");if(B>W-1)throw new Error("only "+W+" bytes available! programmer error!");var z=new XMLHttpRequest;if(z.open("GET",G,!1),W!==J&&z.setRequestHeader("Range","bytes="+F+"-"+B),"undefined"!=typeof Uint8Array&&(z.responseType="arraybuffer"),z.overrideMimeType&&z.overrideMimeType("text/plain; charset=x-user-defined"),z.send(null),!(z.status>=200&&z.status<300||304===z.status))throw new Error("Couldn't load "+G+". Status: "+z.status);return void 0!==z.response?new Uint8Array(z.response||[]):intArrayFromString(z.responseText||"",!0)},Q=this;Q.setDataGetter((function(F){var B=F*J,G=(F+1)*J-1;if(G=Math.min(G,W-1),void 0===Q.chunks[F]&&(Q.chunks[F]=doXHR(B,G)),void 0===Q.chunks[F])throw new Error("doXHR failed!");return Q.chunks[F]})),!K&&W||(J=W=1,W=this.getter(0).length,J=W,X("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=W,this._chunkSize=J,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var K={isDevice:!1,url:G},J=Pe.createFile(F,B,K,W,z);K.contents?J.contents=K.contents:K.url&&(J.contents=null,J.url=K.url),Object.defineProperties(J,{usedBytes:{get:function(){return this.contents.length}}});var Q={};return Object.keys(J.stream_ops).forEach((function(F){var B=J.stream_ops[F];Q[F]=function forceLoadLazyFile(){return Pe.forceLoadFile(J),B.apply(null,arguments)}})),Q.read=function stream_ops_read(F,B,G,W,z){Pe.forceLoadFile(J);var K=F.node.contents;if(z>=K.length)return 0;var Q=Math.min(K.length-z,W);if(K.slice)for(var Y=0;Y<Q;Y++)B[G+Y]=K[z+Y];else for(Y=0;Y<Q;Y++)B[G+Y]=K.get(z+Y);return Q},J.stream_ops=Q,J},createPreloadedFile:function(B,G,W,z,K,J,Q,Y,$,X){Browser.init();var Z=G?Ie.resolve(be.join2(B,G)):B;function processData(W){function finish(F){X&&X(),Y||Pe.createDataFile(B,G,F,z,K,$),J&&J(),removeRunDependency()}var ee=!1;F.preloadPlugins.forEach((function(F){ee||F.canHandle(Z)&&(F.handle(W,Z,finish,(function(){Q&&Q(),removeRunDependency()})),ee=!0)})),ee||finish(W)}addRunDependency(),"string"==typeof W?Browser.asyncLoad(W,(function(F){processData(F)}),Q):processData(W)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(F,B,G){B=B||function(){},G=G||function(){};var W=Pe.indexedDB();try{var z=W.open(Pe.DB_NAME(),Pe.DB_VERSION)}catch(F){return G(F)}z.onupgradeneeded=function openRequest_onupgradeneeded(){X("creating db"),z.result.createObjectStore(Pe.DB_STORE_NAME)},z.onsuccess=function openRequest_onsuccess(){var W=z.result.transaction([Pe.DB_STORE_NAME],"readwrite"),K=W.objectStore(Pe.DB_STORE_NAME),J=0,Q=0,Y=F.length;function finish(){0==Q?B():G()}F.forEach((function(F){var B=K.put(Pe.analyzePath(F).object.contents,F);B.onsuccess=function putRequest_onsuccess(){++J+Q==Y&&finish()},B.onerror=function putRequest_onerror(){Q++,J+Q==Y&&finish()}})),W.onerror=G},z.onerror=G},loadFilesFromDB:function(F,B,G){B=B||function(){},G=G||function(){};var W=Pe.indexedDB();try{var z=W.open(Pe.DB_NAME(),Pe.DB_VERSION)}catch(F){return G(F)}z.onupgradeneeded=G,z.onsuccess=function openRequest_onsuccess(){var W=z.result;try{var K=W.transaction([Pe.DB_STORE_NAME],"readonly")}catch(F){return void G(F)}var J=K.objectStore(Pe.DB_STORE_NAME),Q=0,Y=0,$=F.length;function finish(){0==Y?B():G()}F.forEach((function(F){var B=J.get(F);B.onsuccess=function getRequest_onsuccess(){Pe.analyzePath(F).exists&&Pe.unlink(F),Pe.createDataFile(be.dirname(F),be.basename(F),B.result,!0,!0,!0),++Q+Y==$&&finish()},B.onerror=function getRequest_onerror(){Y++,Q+Y==$&&finish()}})),K.onerror=G},z.onerror=G}},Oe={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(F,B,G){if("/"===B[0])return B;var W;if(-100===F)W=Pe.cwd();else{var z=Pe.getStream(F);if(!z)throw new Pe.ErrnoError(8);W=z.path}if(0==B.length){if(!G)throw new Pe.ErrnoError(44);return W}return be.join2(W,B)},doStat:function(F,B,G){try{var W=F(B)}catch(F){if(F&&F.node&&be.normalize(B)!==be.normalize(Pe.getPath(F.node)))return-54;throw F}return ce[G>>2]=W.dev,ce[G+4>>2]=0,ce[G+8>>2]=W.ino,ce[G+12>>2]=W.mode,ce[G+16>>2]=W.nlink,ce[G+20>>2]=W.uid,ce[G+24>>2]=W.gid,ce[G+28>>2]=W.rdev,ce[G+32>>2]=0,Se=[W.size>>>0,(ye=W.size,+Math.abs(ye)>=1?ye>0?(0|Math.min(+Math.floor(ye/4294967296),4294967295))>>>0:~~+Math.ceil((ye-+(~~ye>>>0))/4294967296)>>>0:0)],ce[G+40>>2]=Se[0],ce[G+44>>2]=Se[1],ce[G+48>>2]=4096,ce[G+52>>2]=W.blocks,ce[G+56>>2]=W.atime.getTime()/1e3|0,ce[G+60>>2]=0,ce[G+64>>2]=W.mtime.getTime()/1e3|0,ce[G+68>>2]=0,ce[G+72>>2]=W.ctime.getTime()/1e3|0,ce[G+76>>2]=0,Se=[W.ino>>>0,(ye=W.ino,+Math.abs(ye)>=1?ye>0?(0|Math.min(+Math.floor(ye/4294967296),4294967295))>>>0:~~+Math.ceil((ye-+(~~ye>>>0))/4294967296)>>>0:0)],ce[G+80>>2]=Se[0],ce[G+84>>2]=Se[1],0},doMsync:function(F,B,G,W,z){var K=se.slice(F,F+G);Pe.msync(B,K,z,G,W)},doMkdir:function(F,B){return"/"===(F=be.normalize(F))[F.length-1]&&(F=F.substr(0,F.length-1)),Pe.mkdir(F,B,0),0},doMknod:function(F,B,G){switch(61440&B){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return Pe.mknod(F,B,G),0},doReadlink:function(F,B,G){if(G<=0)return-28;var W=Pe.readlink(F),z=Math.min(G,lengthBytesUTF8(W)),K=ae[B+z];return stringToUTF8(W,B,G+1),ae[B+z]=K,z},doAccess:function(F,B){if(-8&B)return-28;var G;if(!(G=Pe.lookupPath(F,{follow:!0}).node))return-44;var W="";return 4&B&&(W+="r"),2&B&&(W+="w"),1&B&&(W+="x"),W&&Pe.nodePermissions(G,W)?-2:0},doDup:function(F,B,G){var W=Pe.getStream(G);return W&&Pe.close(W),Pe.open(F,B,0,G,G).fd},doReadv:function(F,B,G,W){for(var z=0,K=0;K<G;K++){var J=ce[B+8*K>>2],Q=ce[B+(8*K+4)>>2],Y=Pe.read(F,ae,J,Q,W);if(Y<0)return-1;if(z+=Y,Y<Q)break}return z},doWritev:function(F,B,G,W){for(var z=0,K=0;K<G;K++){var J=ce[B+8*K>>2],Q=ce[B+(8*K+4)>>2],Y=Pe.write(F,ae,J,Q,W);if(Y<0)return-1;z+=Y}return z},varargs:void 0,get:function(){return Oe.varargs+=4,ce[Oe.varargs-4>>2]},getStr:function(F){return UTF8ToString(F)},getStreamFromFD:function(F){var B=Pe.getStream(F);if(!B)throw new Pe.ErrnoError(8);return B},get64:function(F,B){return F}};function _environ_get(F,B){try{var G=0;return getEnvStrings().forEach((function(W,z){var K=B+G;ce[F+4*z>>2]=K,writeAsciiToMemory(W,K),G+=W.length+1})),0}catch(F){return void 0!==Pe&&F instanceof Pe.ErrnoError||abort(F),F.errno}}function _environ_sizes_get(F,B){try{var G=getEnvStrings();ce[F>>2]=G.length;var W=0;return G.forEach((function(F){W+=F.length+1})),ce[B>>2]=W,0}catch(F){return void 0!==Pe&&F instanceof Pe.ErrnoError||abort(F),F.errno}}function _fd_close(F){try{var B=Oe.getStreamFromFD(F);return Pe.close(B),0}catch(F){return void 0!==Pe&&F instanceof Pe.ErrnoError||abort(F),F.errno}}function _fd_read(F,B,G,W){try{var z=Oe.getStreamFromFD(F),K=Oe.doReadv(z,B,G);return ce[W>>2]=K,0}catch(F){return void 0!==Pe&&F instanceof Pe.ErrnoError||abort(F),F.errno}}function _fd_seek(F,B,G,W,z){try{var K=Oe.getStreamFromFD(F),J=4294967296*G+(B>>>0),Q=9007199254740992;return J<=-Q||J>=Q?-61:(Pe.llseek(K,J,W),Se=[K.position>>>0,(ye=K.position,+Math.abs(ye)>=1?ye>0?(0|Math.min(+Math.floor(ye/4294967296),4294967295))>>>0:~~+Math.ceil((ye-+(~~ye>>>0))/4294967296)>>>0:0)],ce[z>>2]=Se[0],ce[z+4>>2]=Se[1],K.getdents&&0===J&&0===W&&(K.getdents=null),0)}catch(F){return void 0!==Pe&&F instanceof Pe.ErrnoError||abort(F),F.errno}}function _fd_write(F,B,G,W){try{var z=Oe.getStreamFromFD(F),K=Oe.doWritev(z,B,G);return ce[W>>2]=K,0}catch(F){return void 0!==Pe&&F instanceof Pe.ErrnoError||abort(F),F.errno}}function __isLeapYear(F){return F%4==0&&(F%100!=0||F%400==0)}function __arraySum(F,B){for(var G=0,W=0;W<=B;G+=F[W++]);return G}var Me=[31,29,31,30,31,30,31,31,30,31,30,31],we=[31,28,31,30,31,30,31,31,30,31,30,31];function __addDays(F,B){for(var G=new Date(F.getTime());B>0;){var W=__isLeapYear(G.getFullYear()),z=G.getMonth(),K=(W?Me:we)[z];if(!(B>K-G.getDate()))return G.setDate(G.getDate()+B),G;B-=K-G.getDate()+1,G.setDate(1),z<11?G.setMonth(z+1):(G.setMonth(0),G.setFullYear(G.getFullYear()+1))}return G}function _strftime(F,B,G,W){var z=ce[W+40>>2],K={tm_sec:ce[W>>2],tm_min:ce[W+4>>2],tm_hour:ce[W+8>>2],tm_mday:ce[W+12>>2],tm_mon:ce[W+16>>2],tm_year:ce[W+20>>2],tm_wday:ce[W+24>>2],tm_yday:ce[W+28>>2],tm_isdst:ce[W+32>>2],tm_gmtoff:ce[W+36>>2],tm_zone:z?UTF8ToString(z):""},J=UTF8ToString(G),Q={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var Y in Q)J=J.replace(new RegExp(Y,"g"),Q[Y]);var $=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],X=["January","February","March","April","May","June","July","August","September","October","November","December"];function leadingSomething(F,B,G){for(var W="number"==typeof F?F.toString():F||"";W.length<B;)W=G[0]+W;return W}function leadingNulls(F,B){return leadingSomething(F,B,"0")}function compareByDay(F,B){function sgn(F){return F<0?-1:F>0?1:0}var G;return 0===(G=sgn(F.getFullYear()-B.getFullYear()))&&0===(G=sgn(F.getMonth()-B.getMonth()))&&(G=sgn(F.getDate()-B.getDate())),G}function getFirstWeekStartDate(F){switch(F.getDay()){case 0:return new Date(F.getFullYear()-1,11,29);case 1:return F;case 2:return new Date(F.getFullYear(),0,3);case 3:return new Date(F.getFullYear(),0,2);case 4:return new Date(F.getFullYear(),0,1);case 5:return new Date(F.getFullYear()-1,11,31);case 6:return new Date(F.getFullYear()-1,11,30)}}function getWeekBasedYear(F){var B=__addDays(new Date(F.tm_year+1900,0,1),F.tm_yday),G=new Date(B.getFullYear(),0,4),W=new Date(B.getFullYear()+1,0,4),z=getFirstWeekStartDate(G),K=getFirstWeekStartDate(W);return compareByDay(z,B)<=0?compareByDay(K,B)<=0?B.getFullYear()+1:B.getFullYear():B.getFullYear()-1}var Z={"%a":function(F){return $[F.tm_wday].substring(0,3)},"%A":function(F){return $[F.tm_wday]},"%b":function(F){return X[F.tm_mon].substring(0,3)},"%B":function(F){return X[F.tm_mon]},"%C":function(F){return leadingNulls((F.tm_year+1900)/100|0,2)},"%d":function(F){return leadingNulls(F.tm_mday,2)},"%e":function(F){return leadingSomething(F.tm_mday,2," ")},"%g":function(F){return getWeekBasedYear(F).toString().substring(2)},"%G":function(F){return getWeekBasedYear(F)},"%H":function(F){return leadingNulls(F.tm_hour,2)},"%I":function(F){var B=F.tm_hour;return 0==B?B=12:B>12&&(B-=12),leadingNulls(B,2)},"%j":function(F){return leadingNulls(F.tm_mday+__arraySum(__isLeapYear(F.tm_year+1900)?Me:we,F.tm_mon-1),3)},"%m":function(F){return leadingNulls(F.tm_mon+1,2)},"%M":function(F){return leadingNulls(F.tm_min,2)},"%n":function(){return"\n"},"%p":function(F){return F.tm_hour>=0&&F.tm_hour<12?"AM":"PM"},"%S":function(F){return leadingNulls(F.tm_sec,2)},"%t":function(){return"\t"},"%u":function(F){return F.tm_wday||7},"%U":function(F){var B=new Date(F.tm_year+1900,0,1),G=0===B.getDay()?B:__addDays(B,7-B.getDay()),W=new Date(F.tm_year+1900,F.tm_mon,F.tm_mday);if(compareByDay(G,W)<0){var z=__arraySum(__isLeapYear(W.getFullYear())?Me:we,W.getMonth()-1)-31,K=31-G.getDate()+z+W.getDate();return leadingNulls(Math.ceil(K/7),2)}return 0===compareByDay(G,B)?"01":"00"},"%V":function(F){var B,G=new Date(F.tm_year+1900,0,4),W=new Date(F.tm_year+1901,0,4),z=getFirstWeekStartDate(G),K=getFirstWeekStartDate(W),J=__addDays(new Date(F.tm_year+1900,0,1),F.tm_yday);return compareByDay(J,z)<0?"53":compareByDay(K,J)<=0?"01":(B=z.getFullYear()<F.tm_year+1900?F.tm_yday+32-z.getDate():F.tm_yday+1-z.getDate(),leadingNulls(Math.ceil(B/7),2))},"%w":function(F){return F.tm_wday},"%W":function(F){var B=new Date(F.tm_year,0,1),G=1===B.getDay()?B:__addDays(B,0===B.getDay()?1:7-B.getDay()+1),W=new Date(F.tm_year+1900,F.tm_mon,F.tm_mday);if(compareByDay(G,W)<0){var z=__arraySum(__isLeapYear(W.getFullYear())?Me:we,W.getMonth()-1)-31,K=31-G.getDate()+z+W.getDate();return leadingNulls(Math.ceil(K/7),2)}return 0===compareByDay(G,B)?"01":"00"},"%y":function(F){return(F.tm_year+1900).toString().substring(2)},"%Y":function(F){return F.tm_year+1900},"%z":function(F){var B=F.tm_gmtoff,G=B>=0;return B=(B=Math.abs(B)/60)/60*100+B%60,(G?"+":"-")+String("0000"+B).slice(-4)},"%Z":function(F){return F.tm_zone},"%%":function(){return"%"}};for(var Y in Z)J.includes(Y)&&(J=J.replace(new RegExp(Y,"g"),Z[Y](K)));var ee=intArrayFromString(J,!1);return ee.length>B?0:(writeArrayToMemory(ee,F),ee.length-1)}function _strftime_l(F,B,G,W){return _strftime(F,B,G,W)}var FSNode=function(F,B,G,W){F||(F=this),this.parent=F,this.mount=F.mount,this.mounted=null,this.id=Pe.nextInode++,this.name=B,this.mode=G,this.node_ops={},this.stream_ops={},this.rdev=W},De=365,Ne=146;function intArrayFromString(F,B,G){var W=G>0?G:lengthBytesUTF8(F)+1,z=new Array(W),K=stringToUTF8Array(F,z,0,z.length);return B&&(z.length=K),z}Object.defineProperties(FSNode.prototype,{read:{get:function(){return(this.mode&De)===De},set:function(F){F?this.mode|=De:this.mode&=~De}},write:{get:function(){return(this.mode&Ne)===Ne},set:function(F){F?this.mode|=Ne:this.mode&=~Ne}},isFolder:{get:function(){return Pe.isDir(this.mode)}},isDevice:{get:function(){return Pe.isChrdev(this.mode)}}}),Pe.FSNode=FSNode,Pe.staticInit();var Le,ke={a:___assert_fail,i:___localtime_r,b:_abort,h:_clock_gettime,k:_emscripten_memcpy_big,l:_emscripten_resize_heap,d:_environ_get,e:_environ_sizes_get,f:_fd_close,g:_fd_read,j:_fd_seek,c:_fd_write,n:_strftime,m:_strftime_l},Fe=(createWasm(),F.___wasm_call_ctors=function(){return(F.___wasm_call_ctors=F.asm.p).apply(null,arguments)},F._malloc=function(){return(Fe=F._malloc=F.asm.r).apply(null,arguments)}),xe=(F._CreateTranscoder=function(){return(F._CreateTranscoder=F.asm.s).apply(null,arguments)},F._CreateRTTranscoder=function(){return(F._CreateRTTranscoder=F.asm.t).apply(null,arguments)},F._DeleteTranscoder=function(){return(F._DeleteTranscoder=F.asm.u).apply(null,arguments)},F._TranscoderSetDecryptionKey=function(){return(F._TranscoderSetDecryptionKey=F.asm.v).apply(null,arguments)},F._TranscoderAllocateBuffer=function(){return(F._TranscoderAllocateBuffer=F.asm.w).apply(null,arguments)},F._TranscoderConsumeBuffer=function(){return(F._TranscoderConsumeBuffer=F.asm.x).apply(null,arguments)},F._RTTranscoderAttachInput=function(){return(F._RTTranscoderAttachInput=F.asm.y).apply(null,arguments)},F._RTTranscoderDetachInput=function(){return(F._RTTranscoderDetachInput=F.asm.z).apply(null,arguments)},F._RTTranscoderConsumeBuffer=function(){return(F._RTTranscoderConsumeBuffer=F.asm.A).apply(null,arguments)},F._TranscoderRunTurn=function(){return(F._TranscoderRunTurn=F.asm.B).apply(null,arguments)},F.___errno_location=function(){return(xe=F.___errno_location=F.asm.C).apply(null,arguments)}),Ue=F.__get_tzname=function(){return(Ue=F.__get_tzname=F.asm.D).apply(null,arguments)},je=F.__get_daylight=function(){return(je=F.__get_daylight=F.asm.E).apply(null,arguments)},Be=F.__get_timezone=function(){return(Be=F.__get_timezone=F.asm.F).apply(null,arguments)},He=F.stackAlloc=function(){return(He=F.stackAlloc=F.asm.G).apply(null,arguments)};function run(G){function doRun(){Le||(Le=!0,F.calledRun=!0,le||(initRuntime(),B(F),F.onRuntimeInitialized&&F.onRuntimeInitialized(),postRun()))}fe>0||(preRun(),fe>0||(F.setStatus?(F.setStatus("Running..."),setTimeout((function(){setTimeout((function(){F.setStatus("")}),1),doRun()}),1)):doRun()))}if(F.UTF8ToString=UTF8ToString,F.addFunction=addFunction,F.removeFunction=removeFunction,F.allocateUTF8OnStack=allocateUTF8OnStack,me=function runCaller(){Le||run(),Le||(me=runCaller)},F.run=run,F.preInit)for("function"==typeof F.preInit&&(F.preInit=[F.preInit]);F.preInit.length>0;)F.preInit.pop()();return run(),F.ready};B.default=Module},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.VideoAdjuster=void 0;var J=function(){function VideoAdjuster(F,B){this.logger=F,this.diagnosticProvider=B,this.isRunning=!1,this.minTargetBufferSize=.1,this.targetBufferSize=this.minTargetBufferSize,this.bufferSizeHistory=[],this.targetBufferSizeEstimatorTimer=null,this.playbackAdjusterTimer=null,this.pipelineId=0,this.connectionId=0,this.tracks=[],this.currentVideoTrack=0,this.desiredVideoTrack=0,this.sortedVideoTracks=[],this.paranoiacAlertThreshold=1.5,this.alertMode=!1,this.resolutionReviseTimeout=5e3,this.resolutionReviseTime=this.resolutionReviseTimeout,this.minResolutionSelectedCount=0,this.resolutionAdjusterTimer=null}return VideoAdjuster.prototype.start=function(F,B){this.isRunning||(this.streamUrl=B,this.video=F,this.runTargetBufferSizeEstimator(),this.runPlaybackSpeedAdjuster(),this.runVideoResolutionAdjuster(),this.isRunning=!0,this.diagnosticProvider.setValue("minResolutionSelectedCount",this.minResolutionSelectedCount))},VideoAdjuster.prototype.runTargetBufferSizeEstimator=function(){var F=this,B=0,G=0;this.targetBufferSizeEstimatorTimer=window.setInterval((function(){var W,z,J=F.bufferSizeHistory.length>0?F.bufferSizeHistory[0]:0,Q=F.bufferSizeHistory.length>0?F.bufferSizeHistory[0]:0,Y=0;try{for(var $=K(F.bufferSizeHistory),X=$.next();!X.done;X=$.next()){var Z=X.value;J=Math.min(J,Z),Q=Math.max(Q,Z),Y+=Z/F.bufferSizeHistory.length}}catch(F){W={error:F}}finally{try{X&&!X.done&&(z=$.return)&&z.call($)}finally{if(W)throw W.error}}B=Q-J;var ee=F.minTargetBufferSize+B;F.targetBufferSize=ee>F.targetBufferSize?ee:.1*ee+.9*F.targetBufferSize,F.diagnosticProvider.setValue("minPlayerBufferSizeInInterval",Number(J.toFixed(3))),F.diagnosticProvider.setValue("maxPlayerBufferSizeInInterval",Number(Q.toFixed(3))),F.diagnosticProvider.setValue("avgPlayerBufferSizeInInterval",Number(Y.toFixed(3))),F.diagnosticProvider.setValue("playerBufferSizeVariationInInterval",Number(B.toFixed(3))),F.diagnosticProvider.setValue("targetPlayerBufferSize",Number(F.targetBufferSize.toFixed(3)));var te=F.diagnosticProvider.getValue("inputByteCount");if(!isNaN(te)){var ne=te-G;G=te;var ie=8*ne/1e6*2;ie<0&&(ie=0),F.diagnosticProvider.setValue("inputBitrate",Number(ie.toFixed(3)))}}),500)},VideoAdjuster.prototype.runPlaybackSpeedAdjuster=function(){var F=this,B=.5,G=2,W=.08,z=10,K=15,J=0,Q=0,Y=0,$=0;this.diagnosticProvider.setValue("speedupAppliedCount",Y),this.diagnosticProvider.setValue("speedupResetCount",$),this.diagnosticProvider.setValue("playerBufferSizeHistoryInterval",K),this.playbackAdjusterTimer=window.setInterval((function(){++J;var X=F.video.buffered;if(X.length>0){var Z=X.end(X.length-1)-F.video.currentTime,ee=X.end(X.length-1)-X.start(X.length-1);if(F.diagnosticProvider.setValue("bufferedMediaSize",Number(Z.toFixed(3))),F.diagnosticProvider.setValue("cachedMediaSize",Number(ee.toFixed(3))),Z>F.targetBufferSize){var te=Math.min(Z-F.targetBufferSize,G)*B/G;F.diagnosticProvider.setValue("estimatedSpeedup",Number(te.toFixed(3)));var ne=te+1;if(Math.abs(ne-F.video.playbackRate)>W){var ie=!1;ne>F.video.playbackRate?ie=++Q>z:(Q=0,ie=!0),ie&&(F.logger.info("[runPlaybackSpeedAdjuster]: Speed up ".concat(ne.toFixed(3)," at ").concat(J)),ne>F.video.playbackRate&&F.diagnosticProvider.setValue("speedupAppliedCount",++Y),F.video.playbackRate=ne,F.diagnosticProvider.setValue("appliedSpeedup",Number(te.toFixed(3))))}F.video.paused&&(F.video.play(),F.logger.info("[runPlaybackSpeedAdjuster]: Video resumed after data stream interruption"))}else Q=0,1!==F.video.playbackRate&&(F.video.playbackRate=1,F.logger.info("[runPlaybackSpeedAdjuster]: Target player buffer size reached at ".concat(J)),F.diagnosticProvider.setValue("speedupResetCount",++$));for(F.bufferSizeHistory.push(Z);F.bufferSizeHistory.length>K;)F.bufferSizeHistory.shift();F.adaptVideoResolution()}}),50)},VideoAdjuster.prototype.adaptVideoResolution=function(){this.alertMode||this.sortedVideoTracks.length<2||this.targetBufferSize>this.paranoiacAlertThreshold&&(this.logger.info("[adaptVideoResolution]: Network quality alert, switching to the minimal quality"),this.selectVideoTrack(this.sortedVideoTracks[0].track_id),this.alertMode=!0,this.resolutionReviseTime=this.resolutionReviseTimeout,this.diagnosticProvider.setValue("minResolutionSelectedCount",++this.minResolutionSelectedCount))},VideoAdjuster.prototype.runVideoResolutionAdjuster=function(){var F=this,B=.5,G=0,W=0;this.diagnosticProvider.setValue("resolutionIncreaseCount",G),this.diagnosticProvider.setValue("maxResolutionSelectedCount",W),this.resolutionAdjusterTimer=window.setInterval((function(){if(!(0===F.resolutionReviseTime||F.sortedVideoTracks.length<2)&&(F.resolutionReviseTime=F.resolutionReviseTime>1e3?F.resolutionReviseTime-1e3:0,0===F.resolutionReviseTime)){if(F.targetBufferSize>B)return F.logger.info("[runVideoResolutionAdjuster]: Resolution increase supressed,\n                    network quality is not enough"),void(F.resolutionReviseTime=F.resolutionReviseTimeout);var z=F.sortedVideoTracks.findIndex((function(B){return B.track_id===F.currentVideoTrack}));z>=0&&z<F.sortedVideoTracks.length-1&&(F.selectVideoTrack(F.sortedVideoTracks[z+1].track_id),F.alertMode=!1,F.diagnosticProvider.setValue("resolutionIncreaseCount",++G),z===F.sortedVideoTracks.length-2?(F.logger.info("[runVideoResolutionAdjuster]: Max resolution selected"),F.resolutionReviseTime=0,F.diagnosticProvider.setValue("maxResolutionSelectedCount",++W)):(F.logger.info("[runVideoResolutionAdjuster]: Resolution increased"),F.resolutionReviseTime=F.resolutionReviseTimeout))}}),500)},VideoAdjuster.prototype.onUmsMessage=function(F){var B=JSON.parse(F);if("track_list"===B.type)this.pipelineId=B.pid,this.connectionId=B.cid,this.tracks=B.tracks,this.tracks.sort((function(F,B){return F.track_id<B.track_id?-1:1})),this.sortedVideoTracks=this.tracks.filter((function(F){return"Video"===F.modality})),this.sortedVideoTracks.sort((function(F,B){return F.bitrate<B.bitrate?-1:1}));else if("track_selected"===B.type){this.connectionId=B.cid;var G=this.tracks.find((function(F){return F.track_id===B.track_id}));void 0!==G&&"Video"===G.modality&&(this.currentVideoTrack=G.track_id,this.diagnosticProvider.setValue("currentResolution",G.title))}else if("connection_status"===B.type){var W=B.recorder_start_time/1e6,z=B.recorder_end_time/1e6,K=B.uploaded_time/1e6;if(this.diagnosticProvider.setValue("serverBufferStartTime",Number(W.toFixed(3))),this.diagnosticProvider.setValue("serverBufferEndTime",Number(z.toFixed(3))),this.diagnosticProvider.setValue("lastUploadedTime",Number(K.toFixed(3))),this.diagnosticProvider.setValue("serverQueueAvailability",B.queue_availability),!this.video||0===this.video.buffered.length)return;var J=z-K,Q=z-K+(this.video.buffered.end(this.video.buffered.length-1)-this.video.currentTime);this.diagnosticProvider.setValue("mediaDelay",Number(Q.toFixed(3))),this.diagnosticProvider.setValue("bufferEndDelay",Number(J.toFixed(3)))}},VideoAdjuster.prototype.selectVideoTrack=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){switch(B.label){case 0:return F===this.currentVideoTrack||F===this.desiredVideoTrack?[2]:(this.desiredVideoTrack=F,[4,this.requestTrack(this.desiredVideoTrack)]);case 1:return B.sent(),[2]}}))}))},VideoAdjuster.prototype.requestTrack=function(F){return W(this,void 0,void 0,(function(){var B,G;return z(this,(function(W){switch(W.label){case 0:return B={control:{type:"select_video_track",pid:this.pipelineId,cid:this.connectionId,track_id:F}},[4,this.postData(this.streamUrl,B)];case 1:return 200!==(G=W.sent()).status&&this.logger.warn("[requestTrack]: select_video_track failed: ".concat(G)),[2]}}))}))},VideoAdjuster.prototype.postData=function(F,B){return void 0===F&&(F=""),void 0===B&&(B={}),fetch(F,{method:"POST",mode:"no-cors",cache:"no-cache",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(B)})},VideoAdjuster.prototype.reset=function(){this.isRunning=!1,this.bufferSizeHistory=[],this.targetBufferSize=this.minTargetBufferSize,this.connectionId=0,this.tracks=[],this.currentVideoTrack=0,this.desiredVideoTrack=0,this.sortedVideoTracks=[],this.alertMode=!1,this.resolutionReviseTime=this.resolutionReviseTimeout,window.clearInterval(this.targetBufferSizeEstimatorTimer),window.clearInterval(this.playbackAdjusterTimer),window.clearInterval(this.resolutionAdjusterTimer)},VideoAdjuster}();B.VideoAdjuster=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.LatencyTraceProcessor=void 0;var W=G(26),z=function(){function LatencyTraceProcessor(F,B){this.logger=F,this.diagnosticProvider=B,this.recentHopLatenciesHistory=[],this.overallHopLatencies=[],this.overallHopJitters=[],this.overallHopLatencyDeltas=[],this.numLatencyTraces=0,this.maxHopLatenciesHistorySize=10}return LatencyTraceProcessor.prototype.processLatencyTrace=function(F){try{for(var B=[],G=[],z=JSON.parse(F),K=0;K<z.latency_trace.length;K++)B.push({nodeType:z.latency_trace[K].node_type,nodeId:z.latency_trace[K].node_id,pipelineId:z.latency_trace[K].pipeline_id});JSON.stringify(B)!==JSON.stringify(this.currentLatencyTracePath)&&(this.logger.warn("[processLatencyTrace] New latency trace path found ".concat(JSON.stringify(B))),this.currentLatencyTracePath=B,this.recentHopLatenciesHistory=[],this.overallHopLatencies=[],this.overallHopJitters=[],this.overallHopLatencyDeltas=[],this.numLatencyTraces=0),this.numLatencyTraces++;for(K=0;K<z.latency_trace.length;K++)if(K>0){var J=z.latency_trace[K].timestamp-z.latency_trace[K-1].timestamp;if(G.push(J),this.overallHopLatencies.length>K-1?this.overallHopLatencies[K-1]=(this.overallHopLatencies[K-1]*(this.numLatencyTraces-1)+J)/this.numLatencyTraces:this.overallHopLatencies[K-1]=J,this.numLatencyTraces>=2){var Q=J-this.recentHopLatenciesHistory[this.recentHopLatenciesHistory.length-1][K-1];this.overallHopJitters.length>K-1?this.overallHopJitters[K-1]=(this.overallHopJitters[K-1]*(this.numLatencyTraces-2)+Math.abs(Q))/(this.numLatencyTraces-1):this.overallHopJitters[K-1]=Math.abs(Q),this.overallHopLatencyDeltas.length>K-1?this.overallHopLatencyDeltas[K-1]=(this.overallHopLatencyDeltas[K-1]*(this.numLatencyTraces-2)+Q)/(this.numLatencyTraces-1):this.overallHopLatencyDeltas[K-1]=Q}}for(this.recentHopLatenciesHistory.push(G);this.recentHopLatenciesHistory.length>this.maxHopLatenciesHistorySize;)this.recentHopLatenciesHistory.shift();this.updateDiagnostics()}catch(F){var Y=(0,W.stringifyObject)(F);this.logger.warn("[processLatencyTrace]: Failed to parse latency trace Json: ".concat(Y))}},LatencyTraceProcessor.prototype.updateDiagnostics=function(){for(var F=[],B=0;B<this.recentHopLatenciesHistory[0].length;B++){for(var G=void 0,W=void 0,z=void 0,K=void 0,J=0;J<this.recentHopLatenciesHistory.length;J++){var Q=this.recentHopLatenciesHistory[J][B];if(G?G+=Q/this.recentHopLatenciesHistory.length:G=Q/this.recentHopLatenciesHistory.length,J>0){var Y=Q-K;W?W+=Math.abs(Y)/(this.recentHopLatenciesHistory.length-1):W=Math.abs(Y)/(this.recentHopLatenciesHistory.length-1),z?z+=Y/(this.recentHopLatenciesHistory.length-1):z=Y/(this.recentHopLatenciesHistory.length-1)}K=Q}F.push({previousNode:{nodeId:this.currentLatencyTracePath[B].nodeId,nodeType:this.currentLatencyTracePath[B].nodeType,pipelineId:this.currentLatencyTracePath[B].pipelineId},currentNode:{nodeId:this.currentLatencyTracePath[B+1].nodeId,nodeType:this.currentLatencyTracePath[B+1].nodeType,pipelineId:this.currentLatencyTracePath[B+1].pipelineId},averageLatency:G,averageJitter:W,averageLatencyDelta:z})}var $=[],X=0,Z=0;for(B=0;B<this.overallHopLatencies.length;B++)$.push({previousNode:{nodeId:this.currentLatencyTracePath[B].nodeId,nodeType:this.currentLatencyTracePath[B].nodeType,pipelineId:this.currentLatencyTracePath[B].pipelineId},currentNode:{nodeId:this.currentLatencyTracePath[B+1].nodeId,nodeType:this.currentLatencyTracePath[B+1].nodeType,pipelineId:this.currentLatencyTracePath[B+1].pipelineId},averageLatency:this.overallHopLatencies[B],averageJitter:this.overallHopJitters[B],averageLatencyDelta:this.overallHopLatencyDeltas[B]}),B!==this.overallHopLatencies.length-1&&(X+=this.overallHopLatencies[B]),Z+=this.overallHopLatencies[B];this.diagnosticProvider.setValue("recentHopLatencyMetrics",F),this.diagnosticProvider.setValue("overallHopLatencyMetrics",$),this.diagnosticProvider.setValue("serviceAvgLatency",X),this.diagnosticProvider.setValue("endToEndAvgLatency",Z)},LatencyTraceProcessor}();B.LatencyTraceProcessor=z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=function(F){function SharingStream(B,G,W,z,K){var J=F.call(this,B,G,W,z,K)||this;return J.type=1,J}return z(SharingStream,F),SharingStream}(G(118).default);B.default=K},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.RawIncomingAudioStreamClientHandler=void 0;var K=G(78),J=function(){function RawIncomingAudioStreamClientHandler(F,B,G){var J=this;this.stream=F,this.rawBaseClient=new K.RawStreamBase((function(){return W(J,void 0,void 0,(function(){return z(this,(function(F){return[2,this.stream]}))}))}),(function(){return J.dispose()}),B,G)}return RawIncomingAudioStreamClientHandler.prototype.client=function(){return this.rawBaseClient},RawIncomingAudioStreamClientHandler.prototype.updateAndNotifyClient=function(F){this.rawBaseClient&&(this.stream=F,this.rawBaseClient.notifyStreamChange())},RawIncomingAudioStreamClientHandler.prototype.dispose=function(){this.rawBaseClient=null,this.stream=null},RawIncomingAudioStreamClientHandler}();B.RawIncomingAudioStreamClientHandler=J},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.RawIncomingVideoStreamClientHandler=void 0;var K=G(78),J=G(4),Q=function(){function RawIncomingVideoStreamClientHandler(F,B,G,Q){var Y=this;this.videoStream=F,this.subscriptionManager=B,this.logger=G,this.causeId=Q,this.modality=0===F.type?J.default.MODALITY.video:J.default.MODALITY.sharing,this.subscriptionClient=B.subscribeVideo(this.modality,F.mediaSourceId),this.rawBaseClient=new K.RawStreamBase((function(){return W(Y,void 0,void 0,(function(){var F;return z(this,(function(B){return[2,null===(F=this.subscriptionClient)||void 0===F?void 0:F.subscribedStream]}))}))}),(function(){return Y.unsubscribeVideo()}),G,Q),this.setClientSubscription(),this.videoStream.changed((function(){var B;(null===(B=Y.rawBaseClient)||void 0===B?void 0:B.isDisposed)||(F.isAvailable?Y.updateSubscription():Y.unsubscribeVideo())}))}return RawIncomingVideoStreamClientHandler.prototype.client=function(){return this.rawBaseClient},RawIncomingVideoStreamClientHandler.prototype.updateSubscription=function(){var F,B;(null===(F=this.rawBaseClient)||void 0===F?void 0:F.isDisposed)?this.logger.error("updateSubscription skipped, raw stream client disposed: stream already exists, causeId=".concat(this.causeId)):(null===(B=this.subscriptionClient)||void 0===B?void 0:B.subscribedStream)?this.logger.info("new subscription creation skipped: stream already exists, causeId=".concat(this.causeId)):(this.logger.info("update subcription: Created new subscription, causeId=".concat(this.causeId)),this.subscriptionClient=this.subscriptionManager.subscribeVideo(this.modality,this.videoStream.mediaSourceId),this.setClientSubscription())},RawIncomingVideoStreamClientHandler.prototype.unsubscribeVideo=function(){var F;null===(F=this.subscriptionClient)||void 0===F||F.dispose(),this.subscriptionClient=null},RawIncomingVideoStreamClientHandler.prototype.setClientSubscription=function(){var F=this;this.logger.info("setting onMediaStreamChanged callback, causeId=".concat(this.causeId)),this.subscriptionClient.setOnMediaStreamChangedHandler((function(){var B;return null===(B=F.rawBaseClient)||void 0===B?void 0:B.notifyStreamChange()}))},RawIncomingVideoStreamClientHandler}();B.RawIncomingVideoStreamClientHandler=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},J=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},Q=this&&this.__param||function(F,B){return function(G,W){B(G,W,F)}};Object.defineProperty(B,"__esModule",{value:!0});var Y=G(15),$=G(41),X=G(13),Z=G(68),ee=G(70),te=G(56),ne=function(F){function PluginlessContentSharingSession(B,G,W,z,K,J,Q,Y){void 0===J&&(J="");var $=F.call(this)||this;return $.callTelemetry=B,$.signalingSession=W,$.contentSharingGuid=z,$.contentSharingIdentity=K,$.state=J,$.subject=Q,$.handleOperationFailure=function(F,B,G){G.logFailure(F);var W=$.getTerminatedReasonFromError(F);return B.updateStatusTo&&($.contentSharingStatus=B.updateStatusTo,$.rejectContentSharing(W)),Promise.reject(W)},$._logger=G.createChild((function(){return"[ContentSharingSession][".concat($.contentSharingGuid,"]")})),$.contentSharingStatus=0,$.contentSharingTerminationReason=null,$.contentSharingState=J,$._callOperationHandler=new ee.default($._logger,$.callTelemetry),Y&&($.sessionId=Y),$}return z(PluginlessContentSharingSession,F),Object.defineProperty(PluginlessContentSharingSession.prototype,"contentSharingStatus",{get:function(){return this.status},set:function(F){if(this._logger.info("[set contentSharingStatus][currentStatus=".concat(this.status,"][newStatus=").concat(F,"]")),this.callTelemetry.recordEvent($.CONTENT_SHARING_OPERATIONS_INTERNAL.SET_CONTENT_SHARING_STATUS,{newStatus:F,oldStatus:this.status}),this.status!==F&&7!==this.status&&8!==this.status){if(this._logger.info("[set contentSharingStatus] Changing content sharing status to: ".concat(F)),this.status=F,7===this.status){var B={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"[set contentSharingStatus] Content sharing is disconnected"};this._callOperationHandler.maybeResolveOperation($.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),this._callOperationHandler.rejectPendingOperations(B)}if(2===this.status||5===this.status){B={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Content sharing cannot be ended when not presenting"};this._callOperationHandler.maybeRejectOperation($.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,B)}3===this.status&&(this._callOperationHandler.maybeResolveOperation($.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),this._callOperationHandler.maybeResolveOperation($.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)),this.raiseChanged()}},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessContentSharingSession.prototype,"contentSharingState",{get:function(){return this.state},set:function(F){this.state!==F&&(this.state=F,this.raiseChanged())},enumerable:!1,configurable:!0}),PluginlessContentSharingSession.prototype.startContentSharing=function(F){var B=this;void 0===F&&(F=(0,X.generateCauseId)());var G=this._logger.createFnLogger($.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING,F);if(0!==this.contentSharingStatus){var W="[".concat(F,"][startContentSharing][failed][reason=InvalidState]"),z={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:W};return G.logFailure("state=".concat(this.contentSharingStatus,", reason=").concat(W)),Promise.reject(z)}return this.signalingSession.startContentSharingAsync(this.contentSharingIdentity,this.contentSharingState,this.subject,this.contentSharingGuid,F).then((function(F){B.sessionId=F.sessionId,B.contentSharingStatus=3,B.presenterId=B.signalingSession.participantManager.localParticipant.id})).catch((function(W){return B.handleOperationFailure(W,{causeId:F,operation:$.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING,updateStatusTo:8},G)})),this._callOperationHandler.waitForOperation($.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING)},PluginlessContentSharingSession.prototype.joinContentSharing=function(F){var B=this;void 0===F&&(F=(0,X.generateCauseId)());var G=this._logger.createFnLogger($.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING,F);if(2!==this.contentSharingStatus){var W="[".concat(F,"][joinContentSharing][failed][reason=InvalidState]"),z={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:W};return G.logFailure("state=".concat(this.contentSharingStatus,", reason=").concat(W)),Promise.reject(z)}return this.signalingSession.joinContentSharingAsync(this.contentSharingGuid,F).then((function(F){return B.contentSharingStatus=4,B.contentSharingState=F.sessionState,B.presenterId=F.presenter,Promise.resolve()})).catch((function(W){return B.handleOperationFailure(W,{causeId:F,operation:$.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING,updateStatusTo:8},G)}))},PluginlessContentSharingSession.prototype.updateContentSharingSessionState=function(F,B,G){var W=this;void 0===G&&(G=(0,X.generateCauseId)());var z=this._logger.createFnLogger($.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,G);if(3!==this.contentSharingStatus){var K="[".concat(G,"][updateContentSharingSessionState][failed][reason=InvalidState]"),J={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:K};return z.logFailure("state=".concat(this.contentSharingStatus,", reason=").concat(K)),Promise.reject(J)}return this.signalingSession.updateContentSharingSessionStateAsync(this.contentSharingGuid,B,G).then((function(){return Promise.resolve()})).catch((function(B){return W.handleOperationFailure(B,{causeId:G,operation:$.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,operationId:F},z)}))},PluginlessContentSharingSession.prototype.takeContentSharingControl=function(F){var B=this;void 0===F&&(F=(0,X.generateCauseId)());var G=this._logger.createFnLogger($.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL,F);if(5!==this.contentSharingStatus){var W="[".concat(F,"][updateContentSharingSessionState][failed][reason=InvalidState]"),z={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:W};return G.logFailure("state=".concat(this.contentSharingStatus,", reason=").concat(W)),Promise.reject(z)}return this.signalingSession.takeContentSharingControlAsync(this.contentSharingGuid,F).then((function(){B.contentSharingStatus=3,B.presenterId=B.signalingSession.participantManager.localParticipant.id})).catch((function(W){return B.handleOperationFailure(W,{causeId:F,operation:$.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL},G)})),this._callOperationHandler.waitForOperation($.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)},PluginlessContentSharingSession.prototype.updateContentSharingParticipantStateToViewer=function(F){var B=this;void 0===F&&(F=(0,X.generateCauseId)());var G=this._logger.createFnLogger($.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE,F);if(4!==this.contentSharingStatus){var W="[".concat(F,"][updateContentSharingSessionState][failed][reason=InvalidState]"),z={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:W};return G.logFailure("state=".concat(this.contentSharingStatus,", reason=").concat(W)),Promise.reject(z)}return this.signalingSession.updateContentSharingParticipantStateAsync(this.contentSharingGuid,F).then((function(){return B.contentSharingStatus=B.presenterId===B.signalingSession.participantManager.localParticipant.id?3:5,Promise.resolve()})).catch((function(W){return B.handleOperationFailure(W,{causeId:F,operation:$.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE},G)}))},PluginlessContentSharingSession.prototype.stopContentSharing=function(F){var B=this;void 0===F&&(F=(0,X.generateCauseId)());var G=this._logger.createFnLogger($.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,F);if(2===this.contentSharingStatus||4===this.contentSharingStatus||5===this.contentSharingStatus){var W="[".concat(F,"][stopContentSharing][failed][reason=InvalidState]"),z={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:W};return G.logFailure("state=".concat(this.contentSharingStatus,", reason=").concat(W)),Promise.reject(z)}return this.signalingSession.deleteContentSharingAsync(this.contentSharingGuid,F).then((function(){return B.contentSharingStatus=7,B._callOperationHandler.waitForOperation($.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)})).catch((function(W){return B.handleOperationFailure(W,{causeId:F,operation:$.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING},G)}))},PluginlessContentSharingSession.prototype.dispose=function(B){void 0===B&&(B=(0,X.generateCauseId)());var G={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"};this._callOperationHandler.rejectPendingOperations(G,B),this.contentSharingStatus=7,this.contentSharingState="",F.prototype.dispose.call(this)},PluginlessContentSharingSession.prototype.rejectContentSharing=function(F){if(void 0===F&&(F={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"[rejectContentSharing] Content sharing is disconnected"}),7!==this.status&&8!==this.status)throw new Error("Tried to reject content sharing with status=".concat(this.status));this._callOperationHandler.maybeResolveOperation($.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),this._callOperationHandler.rejectPendingOperations(F)},PluginlessContentSharingSession.prototype.getTerminatedReasonFromError=function(F){var B=F&&F.endCode&&F.endCode.code||0,G={terminatedReason:32,terminatedReasonCode:B,terminatedReasonSubCode:F&&F.endCode&&F.endCode.subCode||0,errorMessage:F};switch(B){case te.jsCallEndCodes.NotFound:G.terminatedReason=34,G.errorMessage="Active session not found on server";break;case te.jsCallEndCodes.Forbidden:G.terminatedReason=8,G.errorMessage="Failed due to insufficient permissions"}return G},K([(0,Z.callOperation)($.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),Q(0,Z.causeId),J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],PluginlessContentSharingSession.prototype,"startContentSharing",null),K([(0,Z.callOperation)($.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),Q(0,Z.causeId),J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],PluginlessContentSharingSession.prototype,"joinContentSharing",null),K([(0,Z.callOperation)($.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE),Q(0,Z.operationId),Q(2,Z.causeId),J("design:type",Function),J("design:paramtypes",[String,String,Object]),J("design:returntype",Promise)],PluginlessContentSharingSession.prototype,"updateContentSharingSessionState",null),K([(0,Z.callOperation)($.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),Q(0,Z.causeId),J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],PluginlessContentSharingSession.prototype,"takeContentSharingControl",null),K([(0,Z.callOperation)($.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),Q(0,Z.causeId),J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],PluginlessContentSharingSession.prototype,"updateContentSharingParticipantStateToViewer",null),K([(0,Z.callOperation)($.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,{waitFor:$.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING}),Q(0,Z.causeId),J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],PluginlessContentSharingSession.prototype,"stopContentSharing",null),PluginlessContentSharingSession}(Y.default);B.default=ne},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},Y=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.PluginlessDataChannel=void 0;var $=G(13),X=G(58),Z=function(F){function PluginlessDataChannel(B,G){var W=F.call(this)||this;return W.configProvider=G,W.mainChannel=null,W.sourceId=X.DATA_SOURCE_ID_ANY,W._state="Inactive",W.dataHandlers=new Map,W.dataHandlerTelemetry=new Map,W.startTime=Date.now(),W.configProviderView=W.configProvider.getConfigView(!1),W.sendMessage=function(F,B,G){return K(W,void 0,void 0,(function(){return J(this,(function(W){if(this.logger.debug("Sending message for ".concat(F,", from: ").concat(this.sourceId," to: ").concat(G," state: ").concat(!!this.mainChannel&&this.mainChannel.state," len: ").concat(B.length)),!this.mainChannel||"Connected"!==this.mainChannel.state||"Active"!==this.state)throw new Error("No active data channel to send data from");return this.mainChannel.sendMessage(F,this.sourceId,B,G),[2]}))}))},W.logger=B.createChild("PluginlessDataChannel"),W}return z(PluginlessDataChannel,F),Object.defineProperty(PluginlessDataChannel.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),PluginlessDataChannel.prototype.registerSessionDataChannel=function(F,B){this.sessionDataChannel&&this.stop(B),this.sessionDataChannel=F,this.subscribeForSessionDataChannelEvents()},PluginlessDataChannel.prototype.setDataChannelSourceId=function(F){this.logger.debug("setDataChannelSourceId ".concat(F)),this.sourceId=F},PluginlessDataChannel.prototype.requestDataChannelHandler=function(F){return this.sessionDataChannel.getDataChannel(F)},PluginlessDataChannel.prototype.sendUserEvents=function(F,B){return K(this,void 0,void 0,(function(){var G;return J(this,(function(W){if(!this.mainChannel)throw this.logger.info("sendUserEvents() no data channel available"),new Error("Main DataChannel is not active");return G=B?B.map((function(F){return parseInt(F,10)})):[],this.mainChannel.sendMessage(0,this.sourceId,(new TextEncoder).encode(F),G),[2]}))}))},PluginlessDataChannel.prototype.addHandler=function(F,B){return K(this,void 0,void 0,(function(){var G;return J(this,(function(W){if(this.logger.info("Adding handler with dataId ".concat(F)),this.dataHandlers.get(F))throw new Error("Data Id ".concat(F," is already registered"));return G={isStarted:!1,handler:B},this.dataHandlers.set(F,G),this.recordDataHandlerEvent(F,"added"),this.mainChannel&&"Connected"===this.mainChannel.state&&this.startHandler(F,G),[2]}))}))},PluginlessDataChannel.prototype.removeHandler=function(F){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){if(this.logger.info("Removing handler with dataId ".concat(F)),!this.dataHandlers.has(F))throw new Error("Handler associated with Data Id ".concat(F," is not attached"));return(B=this.dataHandlers.get(F)).isStarted&&this.stopHandler(F,B),this.dataHandlers.delete(F),[2]}))}))},PluginlessDataChannel.prototype.updateNegotiationTag=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(F){return[2]}))}))},PluginlessDataChannel.prototype.getTelemetry=function(){var F,B;if(!this.dataHandlerTelemetry.size)return"";var G={};try{for(var W=Q(this.dataHandlerTelemetry),z=W.next();!z.done;z=W.next()){var K=Y(z.value,2),J=K[0],$=K[1];G[J]=$}}catch(B){F={error:B}}finally{try{z&&!z.done&&(B=W.return)&&B.call(W)}finally{if(F)throw F.error}}return JSON.stringify(G)},PluginlessDataChannel.prototype.start=function(F){this.mainChannel?this.logger.info("[".concat(F,"] already started")):(this.logger.info("[".concat(F,"] starting")),this.mainChannel=this.sessionDataChannel.getDataChannel(F),this.subscribeForMainDataChannelEvents())},PluginlessDataChannel.prototype.stop=function(F){this.mainChannel&&(this.logger.info("[".concat(F,"] stopping")),this.mainChannel.dispose(),this.mainChannel=null)},PluginlessDataChannel.prototype.dispose=function(){this.stop(void 0),this.sessionDataChannel=null,F.prototype.dispose.call(this)},PluginlessDataChannel.prototype.setMultiparty=function(F){this.configProviderView=this.configProvider.getConfigView(F)},PluginlessDataChannel.prototype.subscribeForMainDataChannelEvents=function(){var F=this;this.mainChannel.on("onmessage",(function(B,G,W){F.logger.debug("Got message for ".concat(B,", from: ").concat(G," state: ").concat(!!F.mainChannel&&F.mainChannel.state,", len: ").concat(W.length)),F.dataHandlers.has(B)&&(F.recordDataHandlerEvent(B,"recvd"),F.dataHandlers.get(B).handler.onDataReceived(B,W,G)),F.event("remoteUserEventsReceived").raise(B.toString(),(new TextDecoder).decode(W))})),this.onMainChannelStateChanged(),this.mainChannel.on("onStateChanged",(function(){return F.onMainChannelStateChanged()}))},PluginlessDataChannel.prototype.onMainChannelStateChanged=function(){if(this.mainChannel)switch(this.mainChannel.state){case"Connected":this.startHandlers();break;case"Closed":case"Destroyed":this.stopHandlers()}},PluginlessDataChannel.prototype.startHandlers=function(){var F,B;try{for(var G=Q(this.dataHandlers.entries()),W=G.next();!W.done;W=G.next()){var z=Y(W.value,2),K=z[0],J=z[1];J.isStarted||this.startHandler(K,J)}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}},PluginlessDataChannel.prototype.stopHandlers=function(){var F,B;try{for(var G=Q(this.dataHandlers.entries()),W=G.next();!W.done;W=G.next()){var z=Y(W.value,2),K=z[0],J=z[1];J.isStarted&&this.stopHandler(K,J)}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}},PluginlessDataChannel.prototype.startHandler=function(F,B){var G=this;this.logger.info("Starting dataHandler id: ".concat(F)),B.handler.onStarted(F,(function(B,W){return G.recordDataHandlerEvent(F,"sent"),G.sendMessage(F,B,W)})),B.isStarted=!0,this.recordDataHandlerEvent(F,"started")},PluginlessDataChannel.prototype.stopHandler=function(F,B){this.logger.info("Stopping dataHandler id: ".concat(F)),B.handler.onStopped(F),B.isStarted=!1,this.recordDataHandlerEvent(F,"removed")},PluginlessDataChannel.prototype.subscribeForSessionDataChannelEvents=function(){var F=this;this.sessionDataChannel.on("onStateChanged",(function(B){var G=(0,$.generateCauseId)();switch(B){case"Active":F.start(G),F.setState("Active");break;case"Inactive":F.stop(G),F.setState("Inactive");break;case"Failed":F.stop(G),F.setState("Failed");break;default:F.logger.warn("[".concat(G,"] unhandled SessionDataChannelState ").concat(B))}}))},PluginlessDataChannel.prototype.recordDataHandlerEvent=function(F,B){var G,W=this.dataHandlerTelemetry.get(F);switch(W?G=W[W.length-1]:(W=[G={}],this.dataHandlerTelemetry.set(F,W)),"added"===B&&void 0!==G.added&&(G={},W.push(G),W.length>this.configProviderView.config.maxStoredDataChannelValues&&W.shift()),B){case"added":case"started":case"removed":G[B]=Date.now()-this.startTime;break;case"recvd":case"sent":G[B]=isNaN(G[B])?1:G[B]+1}},PluginlessDataChannel.prototype.setState=function(F){this._state!==F&&(this._state=F,this.logger.info("PluginlessDataChannelState changed, state=".concat(this._state)),this.event("onDataChannelStateUpdated").raise(this._state))},PluginlessDataChannel}(G(15).default);B.PluginlessDataChannel=Z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.PluginlessScreenSharingControl=B.bufferToString=void 0;var Q=G(23),Y=G(15),$=G(45),X=G(311),Z=G(120),ee=G(313),te=G(121),ne=function(){function ControlInjectorAdapter(F){var B=this;this.logger=F,this.activeSourceId=0,this.edgeVirtualInputSupported=!1,this.pendingPointerImages=new Map,this.logger.info("ControlInjectorAdapter"),"EdgeAnaheim"===(0,Q.getBrowserInfo)().name&&(0,te.sendIsVirtualInputSupportedMessage)(F).then((function(G){B.edgeVirtualInputSupported=G,F.info("ControlInjectorAdapter - Edge supports virtual input device: ".concat(JSON.stringify(B.edgeVirtualInputSupported)))})).catch((function(B){F.error("ControlInjectorAdapter - Edge IsVirtualInputSupported error ".concat(JSON.stringify(B)))}))}return ControlInjectorAdapter.prototype.enableInjector=function(F){var B=this;if(this.injector)return this.logger.error("Control injector already present"),Promise.reject();if("EdgeAnaheim"===(0,Q.getBrowserInfo)().name){if(!this.edgeVirtualInputSupported)return this.logger.info("ControlInjectorAdapter - Edge doesn't support give control"),Promise.reject();var onInitErrorCallback=function(){return B.disableInjector(),B.logger.error("ControlInjectorAdapter - An error occured, control injector is disabled."),Promise.reject()};this.injector=new ee.EdgeControlInjector(this.logger,F,onInitErrorCallback),this.logger.info("ControlInjectorAdapter - Edge ControlInjector created")}else window.ControlInjector&&(this.injector=window.ControlInjector(F),this.logger.info("ControlInjectorAdapter - Window ControlInjector created"));return this.pendingPointerImages.forEach((function(F,G){B.injector.setAvatar(G,F)})),this.pendingPointerImages.clear(),Promise.resolve()},ControlInjectorAdapter.prototype.disableInjector=function(){return this.injector?(this.logger.info("ControlInjectorAdapter - ControlInjector disposed"),this.injector.dispose(),this.injector=null,Promise.resolve()):(this.logger.error("Control injector not present"),Promise.reject())},ControlInjectorAdapter.prototype.setPointerImage=function(F,B){var G=this;return this.injector?new Promise((function(W){G.injector.setAvatar(F,B),W()})):(this.pendingPointerImages.set(F,B),Promise.resolve())},ControlInjectorAdapter.prototype.showVirtualCursor=function(F){var B=this;return this.logger.info("ControlInjectorAdapter - showVirtualCursor ".concat(F," ").concat(this.activeSourceId)),this.injector?new Promise((function(G){F?(B.activeSourceId&&B.injector.showVirtualCursor(B.activeSourceId,!1),B.injector.showVirtualCursor(F,!0),B.activeSourceId=F):B.activeSourceId&&(B.injector.showVirtualCursor(B.activeSourceId,!1),B.activeSourceId=0),G()})):(this.logger.error("Control injector not present"),Promise.reject())},ControlInjectorAdapter.prototype.injectRawInput=function(F,B){var G=this;if(!this.injector)return this.logger.error("Control injector not present"),Promise.reject();var W=this.injector;return new Promise((function(z,K){var J,Q,Y=Z.ScreenSharingControlProtocol.decodeEventType(F);switch(Y){case 1:J=Z.ScreenSharingControlProtocol.decodeMouseEvent(F),W.injectMouseEvent(B,J).then((function(F){return 0===F?z():K()}));break;case 0:Q=Z.ScreenSharingControlProtocol.decodeKeyboardEvent(F),W.injectKeyboardEvent(B,Q).then((function(F){return 0===F?z():K()}));break;default:G.logger.error("Invalid event type in raw input: ".concat(Y)),K()}}))},ControlInjectorAdapter.prototype.canBeEnabled=function(){return"EdgeAnaheim"===(0,Q.getBrowserInfo)().name?this.edgeVirtualInputSupported:!!window.ControlInjector},ControlInjectorAdapter}(),ie=function(){function RendererAdapter(F){this.logger=F,this.logger.info("RendererAdapter")}return RendererAdapter.prototype.getTarget=function(F){return F.target},RendererAdapter.prototype.subscribeVideoSizeChangedEvent=function(F,B){var G=F;return G.streamSize&&B(G.streamSize.width,G.streamSize.height),G.renderer.on("onVideoSizeChanged",B)},RendererAdapter.prototype.subscribeRenderStartedEvent=function(F,B){return F.renderer.on("onVideoStarted",(function(F,G){return B()}))},RendererAdapter}();function bufferToString(F){return String.fromCharCode.apply(null,F)}B.bufferToString=bufferToString;var re=function(F){function DataChannelAdapter(B,G){var W=F.call(this,B)||this;return W.logger=B,W._call=G,W}return z(DataChannelAdapter,F),DataChannelAdapter.prototype.isActive=function(){return!(!this.protocolSendFunc||!this.controlSendFunc)},DataChannelAdapter.prototype.sendProtocolMessage=function(F,B){return this.protocolSendFunc?this.protocolSendFunc(F,B):(this.logger.error("Cannot send protocol message, ProtocolHandler hasn't started"),Promise.resolve())},DataChannelAdapter.prototype.sendControlMessage=function(F,B){return this.controlSendFunc?this.controlSendFunc(F,B):(this.logger.error("Cannot send control message, ControlHandler hasn't started"),Promise.resolve())},DataChannelAdapter.prototype.getProtocolHandler=function(){var F=this;return{onStarted:function(B,G){return K(F,void 0,void 0,(function(){return J(this,(function(F){return this.logger.info("ProtocolHandler started for ".concat(B)),this.protocolSendFunc=G,this.isActive()&&this.event("stateChange").raise(!0),[2]}))}))},onStopped:function(B){return K(F,void 0,void 0,(function(){var F;return J(this,(function(G){return this.logger.info("ProtocolHandler stopped for ".concat(B)),F=this.isActive(),this.protocolSendFunc=null,F&&this.event("stateChange").raise(!1),[2]}))}))},onDataReceived:function(B,G,W){return K(F,void 0,void 0,(function(){var F,z,K;return J(this,(function(J){return 1===B?(F=JSON.parse(bufferToString(G)),z=this._call.mapDataChannelSourceIdToParticipant(W),K=void 0,z&&(K=$.getParticipantIdForSourceId(z,3,W)),[2,this.event("protocolMessage").raise(F.message,z,K,W)]):[2]}))}))}}},DataChannelAdapter.prototype.getControlHandler=function(){var F=this;return{onStarted:function(B,G){return K(F,void 0,void 0,(function(){return J(this,(function(F){return this.logger.info("ControlHandler started for ".concat(B)),this.controlSendFunc=G,this.isActive()&&this.event("stateChange").raise(!0),[2]}))}))},onStopped:function(B){return K(F,void 0,void 0,(function(){var F;return J(this,(function(G){return this.logger.info("ControlHandler stopped for ".concat(B)),F=this.isActive(),this.controlSendFunc=null,F&&this.event("stateChange").raise(!1),[2]}))}))},onDataReceived:function(B,G,W){return K(F,void 0,void 0,(function(){return J(this,(function(F){return 2===B?[2,this.event("controlMessage").raise(G,W)]:[2]}))}))}}},DataChannelAdapter}(Y.default),oe=function(F){function PluginlessScreenSharingControl(B,G,W,z){var K=F.call(this,B.createChild("ScreenSharingControl"),W,z)||this;K.dataChannel=G;var J=new ne(K._logger),Q=new ie(K._logger),Y=new re(K._logger,W);return K.setAdapters(J,Q,Y),K}return z(PluginlessScreenSharingControl,F),PluginlessScreenSharingControl.prototype.setupDataHandlers=function(){this.dataChannel.addHandler(1,this.getProtocolHandler()),this.dataChannel.addHandler(2,this.getControlHandler())},PluginlessScreenSharingControl.prototype.startOrStopControlForViewer=function(F,B,G){F&&G&&"nonInteractive"!==G.appliedInteractivityLevel?B&&0===this.role&&this.initControlForViewer(B):2===this.role&&this.shutdownControlForViewer()},PluginlessScreenSharingControl.prototype.getProtocolHandler=function(){return this._dataChannelAdapter.getProtocolHandler()},PluginlessScreenSharingControl.prototype.getControlHandler=function(){return this._dataChannelAdapter.getControlHandler()},PluginlessScreenSharingControl}(X.ControlBase);B.PluginlessScreenSharingControl=oe},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.ControlBase=void 0;var Y,$,X=G(312),Z=G(120),ee=G(8),te=G(40),ne=G(55),ie=G(57),re=G(17),oe=G(32),ae=G(31),se=G(13),ce=G(58),le=G(59),de=G(15),ue=G(45),pe=G(26),he=3e4,ge=1e4,fe=2e3,me=6,ve="";!function(F){F.INITIATED="Initiated",F.CALL_STATE="CallState",F.SHARING_STARTED="SharingStarted",F.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",F.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",F.CONTROL_GIVEN="ControlGiven",F.CONTROL_REQUEST="ControlRequest",F.AVAILABLE_HANDSHAKE="AvailableHandshake",F.SESSION_SHUTDOWN="Shutdown",F.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession"}(Y||(Y={})),function(F){F.INITIATED="Initiated",F.CALL_STATE="CallState",F.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",F.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",F.GIVE_CONTROL="GiveControl",F.CONTROL_REQUEST="ControlRequest",F.SESSION_SHUTDOWN="Shutdown",F.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession",F.AVAILABLE_ACK_ENABLED="AvailableAckEnabled",F.AVAILABLE_ACK_DISABLED="AvailableAckDisabled"}($||($={}));var ye=function(F){function ControlSessionTelemetryBase(B,G,W,z,K,J){var Q=F.call(this,B,G,(function(){return Q.recordedEvents.length>100}))||this;return Q.negotiationTag=W,Q.callId=z,Q.participantId=K,Q.endpointId=J,Q.messagesFromUnknownSender={},Q.tsCallingVersion=(0,oe.getTsCallingVersion)(),Q}return z(ControlSessionTelemetryBase,F),ControlSessionTelemetryBase.prototype.recordProtocolMessage=function(F,B){F||(B in this.messagesFromUnknownSender||(this.messagesFromUnknownSender[B]=0),this.messagesFromUnknownSender[B]++)},ControlSessionTelemetryBase.prototype.setCallId=function(F){this.callId=F},ControlSessionTelemetryBase.prototype.setEndpointId=function(F){this.endpointId=F},ControlSessionTelemetryBase.prototype.setParticipantId=function(F){this.participantId=F},ControlSessionTelemetryBase.prototype.setTenantId=function(F){this.tenantId=F},ControlSessionTelemetryBase.prototype.setUserHexCID=function(F){this.userHexCID=F},ControlSessionTelemetryBase}(ne.TelemetryUtilities),Se=function(F){function ViewerControlSessionTelemetry(B,G,W,z,K,J,Q){var Y=F.call(this,B,G,W,z,K,J)||this,$=ue.getSharingParticipantLeg(Q);if($){Y.sharerParticipantId=$;var X=ee.find(Q.endpoints.endpointDetails,(function(F){return F.participantId===$}));X&&(Y.sharerClientVersion=X.clientVersion)}return Y}return z(ViewerControlSessionTelemetry,F),ViewerControlSessionTelemetry.prototype.getEvent=function(B,G){var getValue=function(F){return void 0===F?"":F};return{CorrelationId:getValue(this.callId),ParticipantId:getValue(this.participantId),EndpointId:getValue(this.endpointId),NegotiationTag:getValue(this.negotiationTag),TsCallingVersion:getValue(this.tsCallingVersion),TenantId:getValue(this.tenantId),SharerParticipantId:getValue(this.sharerParticipantId),SharerClientVersion:getValue(this.sharerClientVersion),EventTimestampBag:F.prototype.getEventTimestampBag.call(this,B,G),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},ViewerControlSessionTelemetry}(ye),_e=function(F){function SharerControlSessionTelemetry(B,G,W,z,K,J){return F.call(this,B,G,W,z,K,J)||this}return z(SharerControlSessionTelemetry,F),SharerControlSessionTelemetry.prototype.getEvent=function(B,G){var getValue=function(F){return void 0===F?"":F};return{CorrelationId:getValue(this.callId),ParticipantId:getValue(this.participantId),EndpointId:getValue(this.endpointId),NegotiationTag:getValue(this.negotiationTag),TsCallingVersion:getValue(this.tsCallingVersion),TenantId:getValue(this.tenantId),EventTimestampBag:F.prototype.getEventTimestampBag.call(this,B,G),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},SharerControlSessionTelemetry}(ye),Ce=function(F){function ControlBase(B,G,W){var z=F.call(this,B)||this;return z._logger=B,z._telemetryLoggers=W,z.controlState=0,z.role=0,z._enabled=!1,z._availableAckEnabled=!0,z._dataChannelActive=!1,z._dataChannelAvailableSent=!1,z._controlRequest=null,z._controlRequestSubscription=null,z._controllerParticipant=null,z._controllerParticipantSubscription=null,z._controllerSourceId=null,z._screenSharingVideoRenderer=null,z._screenSharingVideoRendererSubscriptions=[],z._sharerParticipant=null,z._pendingSharer=null,z._controlCapturer=null,z._captureEventSubscription=null,z._mouseControlEventSubscription=null,z._keyboardControlEventSubscription=null,z._requestControlTimer=null,z._grantControlTimer=null,z._acceptControlTimer=null,z._terminateControlTimer=null,z._availableAckTimer=null,z._retryAttempt=0,z._raiseRenderedAtViewer=null,z._participantSubscriptions={},z._viewerSessionLastTerminatedReason=0,z._completedViewerSessions=[],z.enableParticipantLegToSourceIdMapping=!0,z.giveControlEnabled=!0,z.isEscalationInProgress=!1,z._logger.info("constructor"),z._callId=G.callId,G.on("callIdChanged",(function(F){z._callId=F,z._currentViewerSessionTelemetry&&z._currentViewerSessionTelemetry.setCallId(F),z._currentSharerSessionTelemetry&&z._currentSharerSessionTelemetry.setCallId(F)})),z._participantId=G.participantId,G.on("callLegIdChanged",(function(F){z._participantId=F,z._currentViewerSessionTelemetry&&z._currentViewerSessionTelemetry.setParticipantId(F),z._currentSharerSessionTelemetry&&z._currentSharerSessionTelemetry.setParticipantId(F)})),z._endpointId=G.endpointId,z}return z(ControlBase,F),ControlBase.prototype.setAdapters=function(F,B,G){var W=this;this._controlInjector=F,this._rendererAdapter=B,this._dataChannelAdapter=G,this._dataChannelAdapter.on("stateChange",(function(F){W._onDataChannelStatusChanged(F)})),this._dataChannelAdapter.on("protocolMessage",(function(F,B,G,z){return W.processProtocolMessage(F,B,G,z)})),this._dataChannelAdapter.on("controlMessage",(function(F,B){return W.processControlMessage(F,B)}))},ControlBase.prototype.testSetControlInjector=function(F){},ControlBase.prototype.enableScreenSharingControl=function(F,B,G,W){if(this._logger.info("enableScreenSharingControl() enabled=".concat(F," disabledReason=").concat(B)),this._availableAckEnabled!==F||this._allowControlForUser!==W){if(this._allowControlForUser=W,F)this._raiseScreenSharingControlCapableEvent(!0,ve);else{if(0===B){var z={reason:2,detail:G};this.event("sharingControlError").raise(z)}this._raiseScreenSharingControlCapableEvent(!1,ve)}if(this._availableAckEnabled!==F){var K=F?$.AVAILABLE_ACK_ENABLED:$.AVAILABLE_ACK_DISABLED;this._recordSharerSessionTelemetry((function(F){return F.recordEvent(K)}),!1)}this._availableAckEnabled=F}},ControlBase.prototype.setGiveControlEnabled=function(F){this.giveControlEnabled=F},ControlBase.prototype._canEnableGiveControl=function(){return this._controlInjector.canBeEnabled()&&this.giveControlEnabled},ControlBase.prototype.setRaiseRenderedAtViewer=function(F){this._raiseRenderedAtViewer=F},ControlBase.prototype.setScreenSharingControlFeatureFlag=function(F){this._logger.info("setScreenSharingControlFeatureFlag() enabled=".concat(F)),this._enabled=F,this._availableAckEnabled=F,this._enabled&&this._handleCallState(this._callState)},ControlBase.prototype.isScreenSharingControlEnabled=function(){return this._enabled},ControlBase.prototype._disposeRenderer=function(F){var B,G;this._disposeControlCapturer(F);try{for(var W=Q(this._screenSharingVideoRendererSubscriptions),z=W.next();!z.done;z=W.next()){z.value.dispose()}}catch(F){B={error:F}}finally{try{z&&!z.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}this._screenSharingVideoRendererSubscriptions=[],this._screenSharingVideoRenderer=null},ControlBase.prototype.setRenderer=function(F,B){var G=this;this._logger.info("setRenderer");var W=(0,se.generateCauseId)();if(this._disposeRenderer(W),!F)return Promise.resolve();var z=B||this._rendererAdapter.getTarget(F);return te.asap((function(){G._setViewingRenderer(F,z)}))},ControlBase.prototype._isDataChannelActive=function(){return this._dataChannelAdapter.isActive()&&this._dataChannelActive},ControlBase.prototype._raiseScreenSharingControlCapableEvent=function(F,B,G){if(this._enabled&&this._isDataChannelActive()){this._logger.info("_raiseScreenSharingControlCapableEvent() enabled=true, capable=".concat(F,", role=").concat(this.role));var W={capable:F,id:B,disabledBySharer:G};this.event("sharingControlCapable").raise(W)}else{this._logger.info("_raiseScreenSharingControlCapableEvent() enabled=false, capable=".concat(F,", role=").concat(this.role));W={capable:!1,id:B};this.event("sharingControlCapable").raise(W)}},ControlBase.prototype.initControlForSharer=function(F){this._logger.info("initControlForSharer()"),this._isSharing()&&this._logger.warn("initControlForSharer() when already sharing"),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this._logger.info("role is changing from=".concat(this.role," to=").concat(1)),this.role=1,this._dataChannelAvailableSent=!1,this._raiseScreenSharingControlCapableEvent(this._canEnableGiveControl(),ve),this._initiateSharerSessionTelemetry(F)},ControlBase.prototype.enableControlInjector=function(F){var B=this;this._logger.info("enableControlInjector() trackId: ".concat(F)),this._canEnableGiveControl()?this._controlInjector.enableInjector(F).catch((function(F){var G={reason:0,detail:JSON.stringify({errorMsg:F})};B.event("sharingControlError").raise(G)})):this._logger.info("enableControlInjector() give control cannot be enabled")},ControlBase.prototype.shutdownControlForSharer=function(){var F=this;if(this._logger.info("shutdownControlForSharer()"),this._isSharing()||this._logger.warn("shutdownControlForSharer() when not sharing"),this._controlRequest){this._logger.warn("Rejecting pending control requests");var B=this._getDataSourceIdForParticipantLeg(this._controlRequest),G=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(G),this._sendControlRejectRequest(5,B)}if(this._controllerParticipant){var W={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this.event("sharingControlChanged").raise(W)}this._finalizeSharerSessionTelemetry($.SESSION_SHUTDOWN),this._teardownSharerRemoteControl(),this._controlInjector.disableInjector().catch((function(B){var G={reason:0,detail:JSON.stringify({errorMsg:B})};F.event("sharingControlError").raise(G)})),this._resetControlState(),this._resetParticipantSubscriptions(),this._availableAckEnabled=this._enabled,this._logger.info("role is changing from=".concat(this.role," to=").concat(0)),this.role=0},ControlBase.prototype._resetParticipantSubscriptions=function(){this._logger.info("resetParticipantSubscriptions() Stopping tracking all participant state changes"),ee.each(this._participantSubscriptions,(function(F){F.dispose()})),this._participantSubscriptions={}},ControlBase.prototype._initiateViewerSessionTelemetry=function(F,B,G){if(!G&&!B)return null;if(!G&&ee.find(this._completedViewerSessions,(function(F){return B===F})))return null;if(this._currentViewerSessionTelemetry){if(this._currentViewerSessionTelemetry.negotiationTag===B)return null;this._finalizeViewerSessionTelemetry(Y.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}return this._logger.info("Initiating new viewer session telemetry for ".concat(B)),this._currentViewerSessionTelemetry=new Se(this._logger,(new Date).getTime(),B,this._callId,this._participantId,this._endpointId,F),this._currentViewerSessionTelemetry.recordEvent(Y.CALL_STATE,{state:this._callState}),this._isDataChannelActive()&&this._currentViewerSessionTelemetry.recordEvent(Y.DATA_CHANNEL_AVAILABLE),this._currentViewerSessionTelemetry},ControlBase.prototype._recordViewerSessionTelemetry=function(F,B){void 0===B&&(B=!0),this._currentViewerSessionTelemetry?F&&F(this._currentViewerSessionTelemetry):B&&this._logger.error("Cannot record telemetry without current session")},ControlBase.prototype._finalizeViewerSessionTelemetry=function(F){if(this._currentViewerSessionTelemetry){this._currentViewerSessionTelemetry.recordEvent(F);var B=this._currentViewerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_viewer_session",B),this._currentViewerSessionTelemetry.negotiationTag&&this._completedViewerSessions.push(this._currentViewerSessionTelemetry.negotiationTag),this._currentViewerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentViewerSessionTelemetry.messagesFromUnknownSender).length&&ae.RootToolsManager.logExternalForDDL("ScreenSharingControl_viewer: messages received from unkonwn sender",JSON.stringify(B.ProtocolMessages)),this._currentViewerSessionTelemetry=null}},ControlBase.prototype._initiateSharerSessionTelemetry=function(F){if(this._currentSharerSessionTelemetry){if(this._currentSharerSessionTelemetry.negotiationTag===F)return null;this._finalizeSharerSessionTelemetry($.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}this._logger.info("Initiating new sharer session telemetry for ".concat(F)),this._currentSharerSessionTelemetry=new _e(this._logger,(new Date).getTime(),F,this._callId,this._participantId,this._endpointId),this._isDataChannelActive()&&this._currentSharerSessionTelemetry.recordEvent($.DATA_CHANNEL_AVAILABLE)},ControlBase.prototype._recordSharerSessionTelemetry=function(F,B){void 0===B&&(B=!0),this._currentSharerSessionTelemetry?F&&F(this._currentSharerSessionTelemetry):B&&this._logger.error("Cannot record telemetry without current session")},ControlBase.prototype._finalizeSharerSessionTelemetry=function(F){if(this._currentSharerSessionTelemetry){this._currentSharerSessionTelemetry.recordEvent(F);var B=this._currentSharerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_sharer_session",B),this._currentSharerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentSharerSessionTelemetry.messagesFromUnknownSender).length&&ae.RootToolsManager.logExternalForDDL("ScreenSharingControl_sharer: messages received from unkonwn sender",JSON.stringify(B.ProtocolMessages)),this._currentSharerSessionTelemetry=null}},ControlBase.prototype._sendTelemetryEvent=function(F,B){var G,W,z=this;this._logger.info("Sending event ".concat(F,": ")),Object.keys(B).forEach((function(F){z._logger.info("     ".concat(F," => ").concat(B[F]))})),null===(W=null===(G=this._telemetryLoggers)||void 0===G?void 0:G.media)||void 0===W||W.sendEvent({eventName:F,props:B})},ControlBase.prototype._recordProtocolMessage=function(F,B){this._currentViewerSessionTelemetry&&this._currentViewerSessionTelemetry.recordProtocolMessage(F,B),this._currentSharerSessionTelemetry&&this._currentSharerSessionTelemetry.recordProtocolMessage(F,B)},ControlBase.prototype.reportSharingSessionChangeForViewer=function(F,B){B&&this._initiateViewerSessionTelemetry(F,B,!1)},ControlBase.prototype.initControlForViewer=function(F,B){if(this._logger.info("initControlForViewer(".concat(re.scrubMriOrOmit(null==F?void 0:F.id),", ").concat(B,")")),F){if(this._isViewing()&&this._logger.warn("initControlForViewer: called when already viewing"),3!==this._callState)return this._logger.info("initControlForViewer: postponed until call is connected, callState=".concat(this._callState)),this._pendingNegotiationTag=B,void(this._pendingSharer=F);var G=!this._sharerParticipant||this._sharerParticipant&&this._sharerParticipant.id!==F.id||B!==this._currentNegotiationTag;this._currentNegotiationTag=B,this._logger.info("role is changing from=".concat(this.role," to=").concat(2)),this.role=2,this._sharerParticipant?this._sharerParticipant.id!==F.id&&(this._recordViewerSessionTelemetry((function(F){return F.recordEvent(Y.SESSION_SHUTDOWN_BY_ANOTHER_SESSION,null,B)})),this._logger.info("initControlForViewer: sharer switched, new sharer id=".concat(re.scrubMriOrOmit(F.id))),this._dataChannelAvailableSent=!1,4===this.controlState&&this._terminateControl(!1)):(this._logger.info("initControlForViewer: setting sharer to id=".concat(re.scrubMriOrOmit(F.id))),this._sharerParticipant=F,this._dataChannelAvailableSent=!1),this._initiateViewerSessionTelemetry(F,B,!0),G&&this._recordViewerSessionTelemetry((function(F){return F.recordEvent(Y.SHARING_STARTED)})),this._isDataChannelActive()&&!this._dataChannelAvailableSent&&(this._resetControlState(),this._sharerParticipant=F,this._logger.info("initControlForViewer: sending Available message to sharer"),this._startAvailableHandshake())}else this._logger.warn("initControlForViewer: Sharer undefined, ignoring")},ControlBase.prototype.shutdownControlForViewer=function(F){var B;this._logger.info("shutdownControlForViewer()"),this._pendingSharer=null;var G=!1;if(F&&F.id!==(null===(B=this._sharerParticipant)||void 0===B?void 0:B.id)||(this._logger.info("shutdownControlForViewer: setting shouldShutdownControlForViewer to true, isViewing: ".concat(this._isViewing())),G=!0),G&&this._isViewing()){if(1===this.controlState){if(this._sharerParticipant){var W=this._getSharerDataSourceId();this._sendRequest({action:2,terminatedReason:6},W)}else this._logger.warn("shutdownControlForViewer: sharer participant is null");var z={inControl:!1,id:ve,terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:z,details:""}))):this._logger.error("shutdownControlForViewer: Unexpected, no promise could be resolved, controlState=RequestSent")}else if(4===this.controlState){z={inControl:!1,id:ve,terminatedReason:6};this.event("sharingControlChanged").raise(z)}this._teardownViewerRemoteControl(),this._resetControlState(),this._screenSharingVideoRenderer=null,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._dataChannelAvailableSent=!1,this._finalizeViewerSessionTelemetry(Y.SESSION_SHUTDOWN),2===this.role?(this._logger.info("_raiseScreenSharingControlCapableEvent  with user role=".concat(this.role,", MRI=").concat(ve,", isCapable=false")),this._raiseScreenSharingControlCapableEvent(!1,ve)):this._logger.warn("can't call _raiseScreenSharingControlCapableEvent, role=".concat(this.role)),this._logger.info("role is changing from=".concat(this.role," to=").concat(0)),this.role=0}},ControlBase.prototype._resetControlRequest=function(F){this._clearControlRequest(),this._controlRequest=F,this._registerParticipantListener(F),3===F.participantState&&(this._logger.info("participantState: Connected, raising: sharingIncomingControlRequest for participantId: ".concat(F.participant.id)),this.event("sharingIncomingControlRequest").raise(F.participant.id))},ControlBase.prototype._clearControlRequest=function(){this._logger.info("_clearControlRequest()"),this._stopListeningToParticipantChanges(this._controlRequest),this._controlRequest=null},ControlBase.prototype._stopListeningToParticipantChanges=function(F){this._controlRequestSubscription&&(this._logger.info("_stopListeningToParticipantChanges: stopping tracking changes for ".concat(F.participant.id)),this._controlRequestSubscription.dispose(),this._controlRequestSubscription=null)},ControlBase.prototype._registerParticipantListener=function(F){var B=this;this._logger.info("_registerParticipantListener: tracking changes for ".concat(F.participant.id)),this._logger.info("request.participantState: ".concat(F.participantState," | request.participant.state: ").concat(F.participant.state)),this._controlRequestSubscription=F.participant.changed((function(){if(F.participant.state!==F.participantState)switch(B._logger.info("request.participantState about to changed from: ".concat(F.participantState," to: ").concat(F.participant.state)),F.participantState=F.participant.state,F.participantState){case 3:B.event("sharingIncomingControlRequest").raise(F.participant.id),B._logger.info("participantState: Connected, raising: sharingIncomingControlRequest for participantId: ".concat(F.participant.id));break;case 0:case 5:case 4:B.denyControlRequest().catch((function(F){B._logger.info("It is ok if denyControlRequest rejects here as screensharing may have just been stopped. Err: ".concat(F))})),B._logger.info("_registerParticipantListener: participant ".concat(F.participant.id," is no longer connected. resetting")),B._clearControlRequest(),B._raiseControlRequestCanceled(F);break;case 1:case 2:case 6:case 7:B._logger.info("participantState: ".concat(F.participantState,", participantId: ").concat(F.participant.id));break;default:B._logger.error("_registerParticipantListener: Unexpected participantState ".concat(F.participantState," unhandled"))}}))},ControlBase.prototype._resetControllerParticipant=function(F){var B=this;this._controllerParticipantSubscription&&(this._logger.info("_resetControllerParticipant: stopping tracking changes for ".concat(this._controllerParticipant.participant.id)),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),F&&(this._logger.info("_resetControllerParticipant: tracking changes for ".concat(F.participant.id)),this._controllerParticipantSubscription=F.participant.changed((function(){3!==F.participant.state&&B.handleParticipantRemoved(F.participant.id)}))),this._controllerParticipant=F},ControlBase.prototype.handleParticipantRemoved=function(F){if(this._participantSubscriptions[F]&&(this._logger.info("handleParticipantRemoved(): Stopping tracking state changes for ".concat(F)),this._participantSubscriptions[F].dispose(),delete this._participantSubscriptions[F]),this._isSharing()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===F){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._teardownSharerRemoteControl(),this.controlState=0,this._resetControllerParticipant();var B={inControl:!1,id:F,terminatedReason:5};this.event("sharingControlChanged").raise(B)}this._raiseScreenSharingControlCapableEvent(!1,F)}else if(this._sharerParticipant&&this._sharerParticipant.id===F&&4===this.controlState){this._logger.info("handleParticipantRemoved: sharer left call, tearing down control session"),this._teardownViewerRemoteControl(),this.controlState=0;B={inControl:!1,id:ve,terminatedReason:6};this.event("sharingControlChanged").raise(B)}},ControlBase.prototype.callStateChanged=function(F){this._callState=F,this._recordViewerSessionTelemetry((function(B){return B.recordEvent(Y.CALL_STATE,{state:F})}),!1),this._recordSharerSessionTelemetry((function(B){return B.recordEvent($.CALL_STATE,{state:F})}),!1),this.isScreenSharingControlEnabled()&&this._handleCallState(F)},ControlBase.prototype.setIsEscalationInProgress=function(F){this.isEscalationInProgress=F},ControlBase.prototype._handleCallState=function(F){switch(F){case 3:this._handleCallConnected();break;case 7:this._handleCallDisconnected();break;case 4:case 5:this.shutdownControlForViewer()}},ControlBase.prototype._handleCallConnected=function(){this._logger.info("_handleCallConnected()"),this._pendingSharer&&(this.initControlForViewer(this._pendingSharer,this._pendingNegotiationTag),this._pendingSharer=null)},ControlBase.prototype._handleCallDisconnected=function(){this._logger.info("_handleCallDisconnected()"),this._isSharing()?this.shutdownControlForSharer():this.shutdownControlForViewer()},ControlBase.prototype._videoSizeChanged=function(F,B){null!==this._controlCapturer&&this._controlCapturer.updateVideoSize(F,B)},ControlBase.prototype._onRenderStarted=function(){var F={action:11,terminatedReason:0};if(this._sharerParticipant){var B=this._getSharerDataSourceId();this._sendRequest(F,B)}else this._logger.error("Attempted to send sharing rendered message to null sharerParticipant")},ControlBase.prototype._setViewingRenderer=function(F,B){var G=this;try{this._screenSharingVideoRenderer=F,this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeVideoSizeChangedEvent(this._screenSharingVideoRenderer,(function(F,B){G._videoSizeChanged(F,B)}))),this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeRenderStartedEvent(this._screenSharingVideoRenderer,(function(){G._onRenderStarted()})));var W=1;F.streamSize&&F.streamSize.width>0&&F.streamSize.height>0&&(W=F.streamSize.width/F.streamSize.height),this._controlCapturer=new X.SlimCoreElectronControlCapturer(this._logger,B,!0,W),4===this.controlState?(this._logger.info("_setViewingRenderer: detected local state is controlling"),this._setupViewerRemoteControl()):this._teardownViewerRemoteControl()}catch(F){this._logger.error("_setViewingRenderer: unable to set _screenSharingVideoRenderer error=".concat(F))}},ControlBase.prototype._onDataChannelStatusChanged=function(F){this._logger.info("_onDataChannelStatusChanged(): Data channel status=".concat(F,", isEscalationInProgress=").concat(this.isEscalationInProgress)),F?this._enabled&&(this._dataChannelActive||(this._dataChannelActive=!0,this._recordViewerSessionTelemetry((function(F){return F.recordEvent(Y.DATA_CHANNEL_AVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(F){return F.recordEvent($.DATA_CHANNEL_AVAILABLE)}),!1),this._isViewing()?this._dataChannelAvailableSent||(this._sharerParticipant?(this._logger.info("_onDataChannelStatusChanged: sending Available message to sharer"),this._startAvailableHandshake()):this._logger.error("Unexpected null _sharerParticipant trying to send Available to sharer")):this._isSharing()&&(this.isEscalationInProgress||this._raiseScreenSharingControlCapableEvent(!0,ve)))):this._dataChannelActive&&(this._recordViewerSessionTelemetry((function(F){return F.recordEvent(Y.DATA_CHANNEL_UNAVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(F){return F.recordEvent($.DATA_CHANNEL_UNAVAILABLE)}),!1),this._dataChannelActive=!1,this._dataChannelAvailableSent=!1,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(3),this.isEscalationInProgress||this._raiseScreenSharingControlCapableEvent(!1,ve))},ControlBase.prototype._isSharing=function(){return 1===this.role},ControlBase.prototype._isViewing=function(){return 2===this.role},ControlBase.prototype._handleAvailableRequest=function(F,B,G){var W=this,z=!1,K=0;if(this._enabled)if(this._availableAckEnabled)if(this._canEnableGiveControl())if(null==B?void 0:B.id){if(this._allowControlForUser&&typeof this._allowControlForUser==typeof Function)return void this._allowControlForUser(B).then((function(J){J||(z=!0,K=1),W._sendResponseToAvailableRequest(F,B,G,z,K)}))}else z=!0,K=10;else this._logger.info("GiveControl is not enabled. no need to answer the available ack"),z=!0,K=9;else this._logger.info("Available ack is off. no need to answer the available ack"),z=!0,K=9;else this._logger.info("Feature flag is off. no need to answer the available ack"),z=!0,K=9;this._sendResponseToAvailableRequest(F,B,G,z,K)},ControlBase.prototype._sendResponseToAvailableRequest=function(F,B,G,W,z){var K=this;W?(this._logger.info("Rejecting Available for handShake:".concat(G,":").concat(F.handshakeId)),this.event("controlAvailableHandshake").raise(F.handshakeId,G,7,this._getAvailableHandshakeTerminatedFromControlTerminated(z)),this._sendRequest({action:10,terminatedReason:z,handshakeId:F.handshakeId},G)):(this._raiseScreenSharingControlCapableEvent(!0,B.id),this._participantSubscriptions[B.id]||(this._logger.info("Tracking participant status for ".concat(B.id)),this._participantSubscriptions[B.id]=B.changed((function(){3!==B.state&&(K._logger.info("Participant ".concat(B.id," is not connected. removing")),K.handleParticipantRemoved(B.id))}))),this._logger.info("Acking Available for handShake:".concat(G,":").concat(F.handshakeId)),this.event("controlAvailableHandshake").raise(F.handshakeId,G,3),this._sendRequest({action:9,terminatedReason:0,handshakeId:F.handshakeId},G))},ControlBase.prototype.processProtocolMessage=function(F,B,G,W){var z=this;return te.asap((function(){z._processProtocolMessage(F,B,G,W)}))},ControlBase.prototype._raiseControlRequestCanceled=function(F){this.event("sharingIncomingControlRequestCancelled").raise(F.participant.id)},ControlBase.prototype._handleControlRequest=function(F,B,G){this._recordSharerSessionTelemetry((function(F){F.recordOperation($.CONTROL_REQUEST,null,String(B))})),this._enabled?this._controlRequest?(this._logger.warn("Sharer is already processing a control request...rejecting new requests"),this._sendControlRejectRequest(3,B)):this._controllerParticipant&&this._controllerParticipant.participant===F?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==G?(this._logger.warn("rejecting control request from second endpoint. participantId: ".concat(G)),this._sendControlRejectRequest(3,B)):(this._logger.warn("Got control request for someone already in control"),this._resetControllerParticipant(),this._resetControlRequest({participant:F,participantState:F.state,participantId:G})):F?(this._logger.info("resetControlRequest for participantId: ".concat(G)),this._resetControlRequest({participant:F,participantState:F.state,participantId:G})):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring"):(this._logger.warn("Sharer control is disabled - rejecting request"),this._sendControlRejectRequest(9,B))},ControlBase.prototype._handleAcceptRequest=function(F,B){if(1===this.controlState){var G=this._sendRequest({action:5,terminatedReason:0},B);this._logger.info("_handleAcceptRequest controlMessage.action: ".concat(toControlActionString(F.action)," _sendRequest isSent: ").concat(G)),G?(this._setupViewerRemoteControl(),this.controlState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error("Unexpected, no promise could be resolved - controlState=RequestSent action=".concat(toControlActionString(F.action))),this._recordViewerSessionTelemetry((function(F){F.recordOperationSuccess(Y.CONTROL_REQUEST,null)}))):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but failed to send ack"}))):this._logger.error("Unexpected, no promise could be resolved - controlState=".concat(toControlStateString(this.controlState)," action=").concat(toControlActionString(F.action))),this._cancelRequestControlTimer()}else this._logger.warn("AcceptRequest message received in controlState=".concat(toControlStateString(this.controlState)))},ControlBase.prototype._handleRejectRequest=function(F){if(1===this.controlState){this._logger.info("_handleRejectRequest: controlState: ".concat(toControlStateString(this.controlState),", about to be changed to: ").concat(toControlStateString(0))),this.controlState=0;var B={inControl:!1,id:ve,terminatedReason:F.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:B,details:""}))):this._logger.error("Unexpected, no promise could be resolved - controlState=RequestSent action=".concat(toControlActionString(F.action))),this._recordViewerSessionTelemetry((function(B){B.recordOperationFailure(Y.CONTROL_REQUEST,{reason:toControlTerminatedReason(F.terminatedReason)})})),this._cancelRequestControlTimer()}else this._logger.warn("RejectRequest message received in controlState=".concat(toControlStateString(this.controlState)," reason=").concat(F.terminatedReason))},ControlBase.prototype._handleCancelControlRequest=function(F,B){if(this._logger.info("_handleCancelControlRequest action=".concat(toControlActionString(F.action)," sender=").concat(B,", controlRequest participantId: ").concat(this._controlRequest.participantId,", controlRequest participantState: ").concat(this._controlRequest.participantState,":")),this._controlRequest){var G=this._controlRequest;this._logger.info("_handleCancelControlRequest action=".concat(toControlActionString(F.action)," sender=").concat(B,", about to raise: _raiseControlRequestCanceled state: ").concat(this._controlRequest.participantState," ")),this._recordSharerSessionTelemetry((function(F){F.recordOperationTimeout($.CONTROL_REQUEST,{participantId:B},String(B))})),this._clearControlRequest(),this._raiseControlRequestCanceled(G)}},ControlBase.prototype._handleGiveControl=function(F,B,G){var W=this._sendRequest({action:5,terminatedReason:0},B);if(this._logger.info("_handleGiveControl: controlMessage.action: ".concat(toControlActionString(F.action)," _sendRequest isSent: ").concat(W)),W){this._setupViewerRemoteControl(),this._logger.info("controlState: ".concat(toControlStateString(this.controlState),", about to be changed to: ").concat(toControlStateString(4))),this.controlState=4,this._recordViewerSessionTelemetry((function(F){F.recordEvent(Y.CONTROL_GIVEN,{sender:B})}));var z={inControl:!0,id:ve,terminatedReason:F.terminatedReason};this.event("sharingControlChanged").raise(z)}},ControlBase.prototype._handleAck=function(F,B,G){if(2===this.controlState)if(this._controllerParticipant&&this._controllerParticipant.participant===B){var W=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);G!==W&&this._logger.warn("acknowledging source id: ".concat(G," does not match requesting source id: ").concat(W)),this._logger.info("Setting up remote control for controller source id=".concat(W)),this._setupSharerRemoteControl(W),this._logger.info("controlState: ".concat(toControlStateString(this.controlState),", about to be changed to: ").concat(toControlStateString(3))),this.controlState=3;var z={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:F.terminatedReason};this.event("sharingControlChanged").raise(z),this._grantControlPromise?(this._grantControlPromise.resolve(),this._cancelGrantControlTimer(),this._recordSharerSessionTelemetry((function(F){F.recordOperationSuccess($.GIVE_CONTROL,{participantId:W})}))):this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer(),this._recordSharerSessionTelemetry((function(F){F.recordOperationSuccess($.CONTROL_REQUEST,{participantId:W},String(W))}))):this._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck action=".concat(toControlActionString(F.action)))}else B?this._logger.warn("Ignoring ack from participant that does not match controller id=".concat(re.scrubMriOrOmit(B.id))):this._logger.warn("Ignoring ack from null participant source id=".concat(G));else 5===this.controlState?(this._logger.info("controlState: ".concat(toControlStateString(this.controlState),", about to be changed to: ").concat(toControlStateString(0))),this.controlState=0,this._resetControllerParticipant(),this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._cancelTerminateControlTimer()):this._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck action=".concat(toControlActionString(F.action)))):this._logger.warn("Unexpected ack in control controlState=".concat(toControlStateString(this.controlState)))},ControlBase.prototype._handleTerminate=function(F,B,G){var W;this._isViewing()?(this._teardownViewerRemoteControl(),W=ve):(this._teardownSharerRemoteControl(),B?W=B.id:this._logger.error("Got terminate message but could not find a sender participant!")),this._logger.info("controlMessage action: ".concat(toControlActionString(F.action),", controllerId: ").concat(W)),this._logger.info("controlState: ".concat(toControlStateString(this.controlState),", about to be changed to: ").concat(toControlStateString(0))),this.controlState=0,this._resetControllerParticipant();var z={inControl:!1,id:W,terminatedReason:F.terminatedReason};this.event("sharingControlChanged").raise(z),8===F.action&&this._sendRequest({action:5,terminatedReason:0},G)},ControlBase.prototype._handleAvailableAck=function(F){this._terminateAvailableHandshake&&(this._logger.info("_handleAvailableAck: terminate available handshake reason: ".concat(1,",handshakeId: ").concat(F.handshakeId)),this._terminateAvailableHandshake(1,F.handshakeId)),2===this.role?this._raiseScreenSharingControlCapableEvent(!0,ve):this._logger.info("Ignoring AvailableAck as viewer session is not initialized, role: ".concat(this.role))},ControlBase.prototype._handleAvailableNack=function(F){this._logger.info("_handleAvailableNack: action=".concat(toControlActionString(F.action)," terminate reason: ").concat(toControlTerminatedReason(F.terminatedReason))),this._viewerSessionLastTerminatedReason=F.terminatedReason,this._recordViewerSessionTelemetry((function(B){B.updateOperationData(Y.AVAILABLE_HANDSHAKE,{nackReason:F.terminatedReason},F.handshakeId)})),10!==F.terminatedReason?(this._terminateAvailableHandshake&&(this._terminateAvailableHandshake(this._getAvailableHandshakeTerminatedFromControlTerminated(F.terminatedReason),F.handshakeId),this._logger.info("_handleAvailableNack: terminateAvailableHandshake reason=".concat(toControlTerminatedReason(F.terminatedReason)))),1===F.terminatedReason?(this._logger.warn("_handleAvailableNack: control terminate reason: SharerDenied"),this._raiseScreenSharingControlCapableEvent(!0,ve,!0)):this._raiseScreenSharingControlCapableEvent(!1,ve)):this._logger.warn("_handleAvailableNack: control terminate reason: UnknownSender")},ControlBase.prototype._handleRenderedAtViewer=function(F,B){this._raiseRenderedAtViewer&&(B?(this._logger.info("raiseRenderedAtViewer senderId=".concat(B.id,", action=").concat(toControlActionString(F.action))),this._raiseRenderedAtViewer(B.id)):this._logger.error("Got RenderedAtViewer message but could not find a sender participant!"))},ControlBase.prototype._processProtocolMessage=function(F,B,G,W){var z;this._recordProtocolMessage(B,W);try{z=JSON.parse(F)}catch(F){return void this._logger.error("Error parsing controlMessage")}switch(B||this._logger.warn("protocol message from unknown sender with sourceId=".concat(W)),this._logger.info("_processProtocolMessage action=".concat(toControlActionString(z.action),", sourceId=").concat(W)),z.action){case 0:this._handleAvailableRequest(z,B,W);break;case 1:this._handleControlRequest(B,W,G);break;case 3:this._handleAcceptRequest(z,W);break;case 4:this._handleRejectRequest(z);break;case 2:this._handleCancelControlRequest(z,W);break;case 6:this._handleGiveControl(z,W,B);break;case 5:this._handleAck(z,B,W);break;case 8:case 7:this._handleTerminate(z,B,W);break;case 9:this._handleAvailableAck(z);break;case 10:this._handleAvailableNack(z);break;case 11:this._handleRenderedAtViewer(z,B);break;default:this._logger.error("Unknown request action received on control protocol data sink, action=".concat(toControlActionString(z.action)))}},ControlBase.prototype._getAvailableHandshakeTerminatedFromControlTerminated=function(F){switch(F){case 10:return 6;case 1:return 7;default:return 0}},ControlBase.prototype._sendRequest=function(F,B){this._logger.info("_sendRequest() action=".concat(toControlActionString(F.action)," recipient sourceid=").concat(B));var G={type:0,message:JSON.stringify(F)},W=[B];return this._dataChannelAdapter.sendProtocolMessage((0,pe.stringToBuffer)(JSON.stringify(G)),W),!0},ControlBase.prototype.processControlMessage=function(F,B){return K(this,void 0,void 0,(function(){return J(this,(function(G){return B!==this._controllerSourceId?(this._logger.debug("Ignoring control message, wrong sourceId. Expected: ".concat(B,", got: ").concat(this._controllerSourceId)),[2]):3!==this.controlState?(this._logger.debug("Ignoring control message, wrong controlState. Expected: RemoteControlling, got: ".concat(toControlStateString(this.controlState))),[2]):[2,this._processControlMessage(F,B)]}))}))},ControlBase.prototype._processControlMessage=function(F,B){return this._controlInjector.injectRawInput(F,B)},ControlBase.prototype._resetControlState=function(){this._logger.info("_resetControlState()"),this.controlState=0,this._resetControllerParticipant(),this._sharerParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer()},ControlBase.prototype._setupSharerRemoteControl=function(F){var B=this;this._logger.info("_setupSharerRemoteControl() sourceId=".concat(F)),this._controllerSourceId=F,this._controlInjector.showVirtualCursor(F).catch((function(G){var W={reason:3,detail:JSON.stringify({sourceId:F,errorMsg:G})};B.event("sharingControlError").raise(W)}))},ControlBase.prototype._teardownSharerRemoteControl=function(){var F=this;this._logger.info("_teardownSharerRemoteControl()"),this._controllerSourceId=null,this._controlInjector.showVirtualCursor(0).catch((function(B){var G={reason:3,detail:JSON.stringify({sourceId:0,errorMsg:B})};F.event("sharingControlError").raise(G)}))},ControlBase.prototype._setupViewerRemoteControl=function(){this._logger.info("_setupViewerRemoteControl()"),this._setCapturerMode(3)},ControlBase.prototype._teardownViewerRemoteControl=function(){this._logger.info("_teardownViewerRemoteControl()"),this._setCapturerMode(0)},ControlBase.prototype._clearCapturerEventSubscriptions=function(){this._logger.info("_clearCapturerEventSubscriptions()"),this._captureEventSubscription&&(this._captureEventSubscription.dispose(),this._captureEventSubscription=null),this._mouseControlEventSubscription&&(this._mouseControlEventSubscription.dispose(),this._mouseControlEventSubscription=null),this._keyboardControlEventSubscription&&(this._keyboardControlEventSubscription.dispose(),this._keyboardControlEventSubscription=null)},ControlBase.prototype.sendRemoteControlEvent=function(F,B){if(B)switch(F){case"mouseControlEvent":this._sendControlEvent(Z.ScreenSharingControlProtocol.encodeMouseEvent(B));break;case"keyboardControlEvent":this._sendControlEvent(Z.ScreenSharingControlProtocol.encodeKeyboardEvent(B));break;default:return void this._logger.error("sendRemoteControlEvent: Invalid type=",F)}else this._logger.error("sendRemoteControlEvent: Invalid argument.")},ControlBase.prototype._sendControlEvent=function(F){if(this._isDataChannelActive()&&this._sharerParticipant&&4===this.controlState){var B=[this._getSharerDataSourceId()];this._dataChannelAdapter.sendControlMessage(F,B)}else this._logger.error("_sendControlEvent: Dropping message - No data channel or wrong controlState. dataConnected: ".concat(this._isDataChannelActive()," controlState: ").concat(toControlStateString(this.controlState),")"))},ControlBase.prototype._setCapturerMode=function(F){var B=this;this._logger.info("_setCapturerMode() capturerMode=".concat(F)),this._controlCapturer?(this._controlCapturer.setCaptureMode(F),this._clearCapturerEventSubscriptions(),1===F?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(F){0===F&&B.event("sharingRendererClicked").raise()})):2===F?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(F){1===F?B.event("sharingRendererMouseEntering").raise():2===F&&B.event("sharingRendererMouseLeaving").raise()})):3===F&&(this._mouseControlEventSubscription=this._controlCapturer.on("mouseControlEvent",(function(F){B._sendControlEvent(Z.ScreenSharingControlProtocol.encodeMouseEvent(F))})),this._keyboardControlEventSubscription=this._controlCapturer.on("keyboardControlEvent",(function(F){B._sendControlEvent(Z.ScreenSharingControlProtocol.encodeKeyboardEvent(F))})),this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(F){1===F?B.event("sharingRendererMouseEntering").raise():2===F&&B.event("sharingRendererMouseLeaving").raise()})))):this._logger.warn("_controlCapturer not found when trying to setup viewer capture mode")},ControlBase.prototype.setPointerImage=function(F,B){return this._logger.warn("setPointerImage is deprecated. Use setLocalPointerImage or setRemotePointerImage"),F?this.setRemotePointerImage(F,B):this.setLocalPointerImage(B)},ControlBase.prototype.setLocalPointerImage=function(F){return 0===F.length?Promise.reject(new Error("setLocalPointerImage invalid image length")):this._setPointerImage(0,F)},ControlBase.prototype.setRemotePointerImage=function(F,B){return K(this,void 0,void 0,(function(){var G,W,z,K,Y,$,X;return J(this,(function(J){switch(J.label){case 0:if(!F)throw new Error("setRemotePointerImage participant is null");if(0===B.length)throw new Error("setRemotePointerImage invalid image length");if(this.enableParticipantLegToSourceIdMapping)return[3,2];if((K=this._mapParticipantToSourceId(F))<0)throw new Error("setRemotePointerImage unable to map participant to sourceId");return[4,this._setPointerImage(K,B)];case 1:return J.sent(),[2];case 2:if(0===(G=this._getParticipantsDataSourceIds(F)).length)throw new Error("setRemotePointerImage unable to map participant to sourceIds");this._logger.info("set pointer image for ".concat(G.length," sources")),J.label=3;case 3:J.trys.push([3,8,9,10]),W=Q(G),z=W.next(),J.label=4;case 4:return z.done?[3,7]:(K=z.value,[4,this._setPointerImage(K,B)]);case 5:J.sent(),J.label=6;case 6:return z=W.next(),[3,4];case 7:return[3,10];case 8:return Y=J.sent(),$={error:Y},[3,10];case 9:try{z&&!z.done&&(X=W.return)&&X.call(W)}finally{if($)throw $.error}return[7];case 10:return[2]}}))}))},ControlBase.prototype._setPointerImage=function(F,B){return this._isSharing()||this._logger.warn("_setPointerImage called when not sharing"),this._controlInjector.setPointerImage(F,B)},ControlBase.prototype.startPointerMode=function(){var F=this;return this._isDataChannelActive()?0!==this.controlState?Promise.reject(new Error("startPointerMode called in bad control controlState=".concat(toControlStateString(this.controlState)))):this._isViewing()?te.asap((function(){F._setCapturerMode(2)})):Promise.reject(new Error("startPointerMode when not viewing")):Promise.reject(new Error("startPointerMode when data channel not active"))},ControlBase.prototype.stopPointerMode=function(){var F=this;return 0!==this.controlState?Promise.reject(new Error("stopPointerMode called in bad control controlState=".concat(toControlStateString(this.controlState)))):this._isViewing()?te.asap((function(){F._setCapturerMode(1)})):Promise.reject(new Error("stopPointerMode when not viewing"))},ControlBase.prototype._startAvailableHandshake=function(){var F,B=this,G=this._getSharerDataSourceId();G<0&&this._logger.warn("sharer: ".concat(re.scrubMriOrOmit(null===(F=this._sharerParticipant)||void 0===F?void 0:F.id)," has no data channel"));var W=(0,ie.default)();this._logger.info("_startAvailableHandshake() - handshakeId: ".concat(G,":").concat(W)),this.event("controlAvailableHandshake").raise(W,G,1),this._terminateAvailableHandshake&&(this._logger.warn("Replacing existing availble handshake"),this._terminateAvailableHandshake(4)),this._recordViewerSessionTelemetry((function(F){return F.recordOperation(Y.AVAILABLE_HANDSHAKE,W)})),this._sendRequest({action:0,terminatedReason:0,handshakeId:W},G)||this._logger.error("Failed to send Available message to sharer, will retry after backoff"),this._dataChannelAvailableSent=!0,this._waitForAvailableAck(W),this._terminateAvailableHandshake=function(F,z){void 0===F&&(F=0),B._logger.info("_terminateAvailableHandshake() - handshakeId: ".concat(G,":").concat(W,", status: ").concat(F)),B._recordViewerSessionTelemetry((function(F){F.updateOperationData(Y.AVAILABLE_HANDSHAKE,{tries:B._retryAttempt},z)})),1===F?B._recordViewerSessionTelemetry((function(F){F.recordOperationSuccess(Y.AVAILABLE_HANDSHAKE,null,"",z)})):(B._logger.error("GTC handshake terminated with code ".concat(F,", last terminated reason: ").concat(toControlTerminatedReason(B._viewerSessionLastTerminatedReason))),ae.RootToolsManager.logExternalForDDL("GTC handshake terminated with code ".concat(F,","),B._viewerSessionLastTerminatedReason.toString()),B._recordViewerSessionTelemetry((function(B){B.recordOperationFailure(Y.AVAILABLE_HANDSHAKE,{reason:F},"",z)}))),B._terminateAvailableHandshake=null,B.event("controlAvailableHandshake").raise(W,G,1===F?5:6,F),z&&z!==W&&B._logger.warn("AvailableSeries: Got handshake from another series - expected: ".concat(W,", received: ").concat(z)),B._availableAckTimer&&(clearTimeout(B._availableAckTimer),B._availableAckTimer=null),B._retryAttempt=0}},ControlBase.prototype._waitForAvailableAck=function(F){var B=this;this._logger.info("_waitForAvailableAck()"),this._availableAckTimer=window.setTimeout((function(){B._logger.warn("No Ack received for Available message from attempt=".concat(B._retryAttempt)),B._availableAckTimer=null;var G=B._getSharerDataSourceId();if(B._retryAttempt<=me)B._logger.info("Re-sending Available message handshakeId: ".concat(G,":").concat(F)),B.event("controlAvailableHandshake").raise(F,G,2),B._sendRequest({action:0,terminatedReason:0,handshakeId:F},G),B._waitForAvailableAck(F);else if(B._logger.error("Reached Available retry limit! Control capability will be false"),B._terminateAvailableHandshake)B._terminateAvailableHandshake(5);else{var W={reason:4,detail:JSON.stringify({sourceId:G,errorMsg:"Timed out after ".concat(B._retryAttempt," tries")})};B.event("sharingControlError").raise(W)}}),fe*++this._retryAttempt)},ControlBase.prototype.requestControl=function(){return this._isDataChannelActive()?0!==this.controlState?Promise.reject(new Error("requestControl called in bad controlState=".concat(toControlStateString(this.controlState)))):this._isViewing()?this._sharerParticipant?this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while requesting control")):this._requestControl():Promise.reject(new Error("requestControl unexpected null sharer")):Promise.reject(new Error("requestControl when not viewing")):Promise.reject(new Error("requestControl when data channel not active"))},ControlBase.prototype._requestControl=function(){var F=this;this._logger.info("_requestControl(), controlState: ".concat(this.controlState)),this._requestControlPromise=te.defer();var always=function(){F._requestControlPromise=null};this._requestControlPromise.promise.then(always,always);var B=this._getSharerDataSourceId();if(!this._sendRequest({action:1,terminatedReason:0},B)){var G={inControl:!1,id:ve,terminatedReason:7};return this._requestControlPromise.reject(new Error),this._logger.error("_requestControl(): failed to send the request."),Promise.reject(new Error(JSON.stringify({controlInfo:G,details:""})))}return this._recordViewerSessionTelemetry((function(F){return F.recordOperation(Y.CONTROL_REQUEST,"")})),this.controlState=1,this._requestControlTimer=window.setTimeout((function(){if(1===F.controlState){F.controlState=0,F._logger.warn("No response to control request - canceling"),F._sendRequest({action:2,terminatedReason:2},B)||F._logger.error("Failed to send the cancel control request");var G={inControl:!1,id:ve,terminatedReason:2};F._recordViewerSessionTelemetry((function(F){F.recordOperationTimeout(Y.CONTROL_REQUEST,null)})),F._requestControlPromise?F._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:G,details:"we did not get any response to the control - terminating control"}))):F._logger.error("Unexpected, no promise could be resolved - controlState=RequestSent")}else F._requestControlPromise?F._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):F._logger.error("Unexpected, no promise could be resolved - controlState=".concat(toControlStateString(F.controlState)));F._requestControlTimer=null}),he),this._requestControlPromise.promise},ControlBase.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},ControlBase.prototype.cancelControl=function(){return this._isDataChannelActive()?1!==this.controlState?Promise.reject(new Error("cancelControl called in bad state=".concat(toControlStateString(this.controlState)))):this._isViewing()?this._sharerParticipant?this._requestControlPromise?this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while cancelling control")):this._cancelControl():Promise.reject(new Error("Request control promise has been resolved while cancelling control")):Promise.reject(new Error("cancelControl unexpected null sharer")):Promise.reject(new Error("cancelControl when not viewing")):Promise.reject(new Error("cancelControl when data channel not active"))},ControlBase.prototype._cancelControl=function(){this._logger.info("_cancelControl()");var F=this._getSharerDataSourceId();if(1!==this.controlState)return Promise.reject(new Error("Cancel control - in bad state - do nothing"));if(this._cancelRequestControlTimer(),this.controlState=0,this._logger.info("Viewer cancels the control"),!this._sendRequest({action:2,terminatedReason:8},F))return Promise.reject(new Error("Failed to send cancel control request"));var B={inControl:!1,id:ve,terminatedReason:8};return this._recordViewerSessionTelemetry((function(F){F.recordOperationFailure(Y.CONTROL_REQUEST,{reason:toControlTerminatedReason(B.terminatedReason)})})),this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:B,details:""}))),new Promise((function(F,B){F()}))},ControlBase.prototype.acceptControlRequest=function(){return this._isDataChannelActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while accepting control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while accepting control")):this._acceptControlRequest():Promise.reject(new Error("acceptControlRequest when not sharing")):Promise.reject(new Error("acceptControlRequest while no control request pending")):Promise.reject(new Error("acceptControlRequest when data channel not active"))},ControlBase.prototype._acceptControlRequest=function(){var F=this;this._logger.info("_acceptControlRequest()"),this._acceptControlPromise=te.defer();var always=function(){F._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(always,always),this._controllerParticipant){this._logger.warn("_acceptControlRequest called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var B=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},B)||this._logger.error("Failed to send the terminateNoAck request"),this._resetControllerParticipant()}var G=this._getDataSourceIdForParticipantLeg(this._controlRequest),W=this._controlRequest.participant.id;return this._sendControlAcceptRequest(G)?(this._resetControllerParticipant(this._controlRequest),this._clearControlRequest(),this.controlState=2,this._acceptControlTimer=window.setTimeout((function(){if(2===F.controlState){F.controlState=0,F._resetControllerParticipant(),F._recordSharerSessionTelemetry((function(F){F.recordOperationTimeout($.CONTROL_REQUEST,{participantId:G},String(G))})),F._logger.error("No ack received when accepting control request - terminating control"),F._sendRequest({action:7,terminatedReason:4},G)||F._logger.error("Failed to send the TerminateNoAck request");var B={inControl:!1,id:W,terminatedReason:4};F.event("sharingControlChanged").raise(B),F._acceptControlPromise?F._acceptControlPromise.reject(new Error("No ack received when accept control - terminating control")):F._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck")}else F._acceptControlPromise?F._acceptControlPromise.reject(new Error("accept control - times out in bad state - do nothing")):F._logger.error("Unexpected, no promise could be resolved - controlState=".concat(toControlStateString(F.controlState)));F._acceptControlTimer=null}),ge),this._acceptControlPromise.promise):(this._logger.error("Failed to send the accept control request"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error("Failed to send the accept control request!")))},ControlBase.prototype._sendControlAcceptRequest=function(F){var B=this._sendRequest({action:3,terminatedReason:0},F);return this._recordSharerSessionTelemetry((function(B){B.updateOperationData($.CONTROL_REQUEST,{status:"accepting",participantId:F},null,String(F))})),B},ControlBase.prototype._sendControlRejectRequest=function(F,B){var G=this._sendRequest({action:4,terminatedReason:F},B);return this._recordSharerSessionTelemetry((function(G){G.recordOperationFailure($.CONTROL_REQUEST,{participantId:B,reason:toControlTerminatedReason(F)},String(B))})),G},ControlBase.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},ControlBase.prototype.denyControlRequest=function(){return this._isDataChannelActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while denying control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while denying control")):this._denyControlRequest():Promise.reject(new Error("denyControlRequest when not sharing")):Promise.reject(new Error("denyControlRequest while no control request pending")):Promise.reject(new Error("denyControlRequest when data channel not active"))},ControlBase.prototype._denyControlRequest=function(){this._logger.info("_denyControlRequest()");var F=this._getDataSourceIdForParticipantLeg(this._controlRequest);return this._clearControlRequest(),this._sendControlRejectRequest(1,F)?Promise.resolve():Promise.reject(new Error("Failed to send the deny control requst"))},ControlBase.prototype.grantControl=function(F){return this._isDataChannelActive()?this._controlRequest?Promise.reject(new Error("grantControl called while control request pending")):this._isSharing()?F?this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while granting control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while granting control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while granting control")):this._grantControl(F):Promise.reject(new Error("grantControl null participant")):Promise.reject(new Error("grantControl when not sharing")):Promise.reject(new Error("grantControl when data channel not active"))},ControlBase.prototype._grantControl=function(F){var B=this;this._logger.info("_grantControl()"),this._grantControlPromise=te.defer();var always=function(){B._grantControlPromise=null};if(this._grantControlPromise.promise.then(always,always),3===this.controlState){if(this._controllerParticipant.participant===F)return this._logger.warn("_grantControl called for participant who already has control"),this._grantControlPromise.resolve(),new Promise((function(F,B){F()}));this._logger.warn("_grantControl called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var G=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},G)||this._logger.error("Failed to send the terminateNoAck request")}var W=this._mapParticipantToSourceId(F),z=this._sendRequest({action:6,terminatedReason:0},W);if(this._recordSharerSessionTelemetry((function(F){F.recordOperation($.GIVE_CONTROL,null)})),!z)return this._logger.error("Failed to send the grant control request"),this._grantControlPromise.reject(new Error),Promise.reject(new Error("Failed to send the grant control request!"));var K=this._getParticipantIdForDataSourceId(F,W);return this._resetControllerParticipant({participant:F,participantState:F.state,participantId:K}),this.controlState=2,this._grantControlTimer=window.setTimeout((function(){2===B.controlState?(B.controlState=0,B._resetControllerParticipant(),B._logger.error("No ack received when granting control - terminating control"),B._sendRequest({action:7,terminatedReason:4},W)||B._logger.error("Failed to send the terminateNoAck request"),B._recordSharerSessionTelemetry((function(F){F.recordOperationTimeout($.GIVE_CONTROL,null)})),B._grantControlPromise?B._grantControlPromise.reject(new Error("No ack received when granting control - terminating control")):B._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForControlAck")):B._grantControlPromise?B._grantControlPromise.reject(new Error("Grant control - times out in bad state - do nothing")):B._logger.error("Unexpected, no promise could be resolved - controlState=".concat(toControlStateString(B.controlState)));B._grantControlTimer=null}),ge),this._grantControlPromise.promise},ControlBase.prototype._cancelGrantControlTimer=function(){this._grantControlTimer&&(this._grantControlPromise&&this._grantControlPromise.reject(new Error("cancelled by _cancelGrantControlTimer")),clearTimeout(this._grantControlTimer),this._grantControlTimer=null)},ControlBase.prototype._mapParticipantToSourceId=function(F){return this._dataChannelAdapter.isActive()?ue.getSourceIdForMediaType(F,3):(this._logger.error("Null data channel cannot map participant to source id"),-1)},ControlBase.prototype._getParticipantsDataSourceIds=function(F){var B,G,W,z,K,J=[];try{if(null===(K=null==F?void 0:F.endpoints)||void 0===K?void 0:K.endpointDetails){if(1===F.endpoints.endpointDetails.length)if(!(X=F.endpoints.endpointDetails[0])||!X.mediaStreams)return J.push(ce.DATA_SOURCE_ID_ANY),J;try{for(var Y=Q(F.endpoints.endpointDetails),$=Y.next();!$.done;$=Y.next()){var X;if(null==(X=$.value)?void 0:X.mediaStreams)try{for(var Z=(W=void 0,Q(X.mediaStreams)),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value;if(3===le.mapMediaTypeStringToMediaType(te.type)){if(J.push(te.sourceId),J.length>=8)return this._logger.error("Excessive amount of data streams"),J;break}}}catch(F){W={error:F}}finally{try{ee&&!ee.done&&(z=Z.return)&&z.call(Z)}finally{if(W)throw W.error}}}}catch(F){B={error:F}}finally{try{$&&!$.done&&(G=Y.return)&&G.call(Y)}finally{if(B)throw B.error}}}}catch(F){this._logger.error("_getParticipantsDataSourceIds caught exception error=".concat(F))}return J},ControlBase.prototype._getParticipantIdForDataSourceId=function(F,B){return ue.getParticipantIdForSourceId(F,3,B)},ControlBase.prototype._getDataSourceIdForParticipantId=function(F,B){return this._dataChannelAdapter.isActive()?ue.getSourceId(F,B,3):(this._logger.error("Null data channel cannot map participant to source id"),-1)},ControlBase.prototype._getDataSourceIdForParticipantLeg=function(F){return this._getDataSourceIdForParticipantId(F.participant,F.participantId)},ControlBase.prototype._getSharerDataSourceId=function(){var F=ue.getSharingParticipantLeg(this._sharerParticipant);return F?this._getDataSourceIdForParticipantId(this._sharerParticipant,F):(this._logger.warn("Unable to identify the sharer participantId, falling back to first data channel"),this._mapParticipantToSourceId(this._sharerParticipant))},ControlBase.prototype.terminateControl=function(){if(this._isViewing()){if(4!==this.controlState)return Promise.reject(new Error("terminateControl called while not in control"));if(!this._sharerParticipant)return Promise.reject(new Error("terminateControl called but _sharerParticipant is null"))}else{if(!this._isSharing())return Promise.reject(new Error("terminateControl called but not sharing nor viewing"));if(!this._controllerParticipant)return Promise.reject(new Error("terminateControl called but controllerParticipant is null"))}return this._requestControlPromise?Promise.reject(new Error("Request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(new Error("Accept control promise has not been resolved yet while terminating control")):this._grantControlPromise?Promise.reject(new Error("Grant control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(new Error("Terminate control promise has not been resolved yet while terminating control")):this._terminateControl()},ControlBase.prototype._terminateControl=function(F){var B=this;void 0===F&&(F=!0),this._logger.info("_terminateControl()"),this._terminateControlPromise=te.defer();var always=function(){B._terminateControlPromise=null};this._terminateControlPromise.promise.then(always,always);var G,W,z=0,K=F?8:7;if(this._isViewing()){if(4!==this.controlState)return this._logger.error("Local viewer called terminateControl when not controlling"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local viewer called terminateControl when not controlling"));this._teardownViewerRemoteControl(),z=6,G=this._getSharerDataSourceId(),W=ve,this._logger.info("Terminating remote control reason: ".concat(z,",  recipient: ").concat(G,", controllerId: ").concat(W))}else{if(3!==this.controlState||!this._controllerParticipant)return this._logger.error("Local sharer called terminateControl when no one is in control"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local sharer called terminateControl when no one is in control"));this._teardownSharerRemoteControl(),z=5,G=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),W=this._controllerParticipant.participant.id,this._logger.info("Terminating control on the sharer side, reason: ".concat(z,", recipient: ").concat(G,", controllerId: ").concat(W))}if(!this._sendRequest({action:K,terminatedReason:z},G)){if(F)return this._logger.error("Failed to send the terminate control request"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Failed to send the grant control request!"));this._logger.error("Failed to send the terminateNoAck request")}this.controlState=F?5:0;var J={inControl:!1,id:W,terminatedReason:z};return this._logger.info("raising event sharingControlChanged reason=".concat(J.terminatedReason," controlState=").concat(this.controlState)),this.event("sharingControlChanged").raise(J),F?(this._terminateControlTimer=window.setTimeout((function(){5===B.controlState?(B.controlState=0,B._resetControllerParticipant(),B._logger.error("No ack received when terminating control - resending terminate request"),B._sendRequest({action:7,terminatedReason:4},G)||B._logger.error("Failed to send the terminateNoAck request"),B._terminateControlPromise?B._terminateControlPromise.reject(new Error("No ack received when terminating control - resending terminate request")):B._logger.error("Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck")):B._terminateControlPromise?B._terminateControlPromise.reject(new Error("terminate control - times out in bad state - do nothing")):B._logger.error("Unexpected, no promise could be resolved - controlState=".concat(toControlStateString(B.controlState)));B._terminateControlTimer=null}),ge),this._terminateControlPromise.promise):(this._terminateControlPromise.resolve(),new Promise((function(F,B){F()})))},ControlBase.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null,this._logger.info("_cancelTerminateControlTimer()"))},ControlBase.prototype._disposeControlCapturer=function(F){void 0===F&&(F=(0,se.generateCauseId)()),this._logger.info("_disposeControlCapturer causeId: ".concat(F)),this._clearCapturerEventSubscriptions(),this._controlCapturer&&(this._controlCapturer.dispose(F),this._controlCapturer=null)},ControlBase.prototype.dispose=function(B){this._logger.info("dispose causeId: ".concat(B)),this._dataChannelAdapter.dispose(B),this._resetControlState(),this._disposeRenderer(B),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._resetParticipantSubscriptions(),this._finalizeViewerSessionTelemetry(Y.SESSION_SHUTDOWN),this._finalizeSharerSessionTelemetry($.SESSION_SHUTDOWN),F.prototype.dispose.call(this,B)},ControlBase}(de.default);function toControlActionString(F){switch(F){case 0:return"Available";case 1:return"ControlRequest";case 2:return"CancelControlRequest";case 3:return"AcceptRequest";case 4:return"RejectRequest";case 5:return"Ack";case 6:return"GiveControl";case 7:return"TerminateNoAck";case 8:return"Terminate";case 9:return"AvailableAck";case 10:return"AvailableNack";case 11:return"RenderedAtViewer";default:return"Unknown"}}function toControlStateString(F){switch(F){case 0:return"None";case 1:return"RequestSent";case 2:return"WaitingForControlAck";case 3:return"RemoteControlling";case 4:return"LocalControlling";case 5:return"WaitingForTerminateAck";default:return"Unknown"}}function toControlTerminatedReason(F){switch(F){case 0:return"None";case 1:return"SharerDenied";case 2:return"SharerNoResponse";case 3:return"SharerBusy";case 4:return"AckTimeout";case 5:return"SharerTerminated";case 6:return"ViewerTerminated";case 7:return"DataChannelError";case 8:return"ViewerCancelled";case 9:return"SharerControlDisabled";case 10:return"UnknownSender";default:return"Unknown"}}B.ControlBase=Ce},function(F,B,G){!function webpackUniversalModuleDefinition(B,W){F.exports=W(G(8))}(window,(function(F){return function(F){var B={};function __webpack_require__(G){if(B[G])return B[G].exports;var W=B[G]={i:G,l:!1,exports:{}};return F[G].call(W.exports,W,W.exports,__webpack_require__),W.l=!0,W.exports}return __webpack_require__.m=F,__webpack_require__.c=B,__webpack_require__.d=function(F,B,G){__webpack_require__.o(F,B)||Object.defineProperty(F,B,{enumerable:!0,get:G})},__webpack_require__.r=function(F){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})},__webpack_require__.t=function(F,B){if(1&B&&(F=__webpack_require__(F)),8&B)return F;if(4&B&&"object"==typeof F&&F&&F.__esModule)return F;var G=Object.create(null);if(__webpack_require__.r(G),Object.defineProperty(G,"default",{enumerable:!0,value:F}),2&B&&"string"!=typeof F)for(var W in F)__webpack_require__.d(G,W,function(B){return F[B]}.bind(null,W));return G},__webpack_require__.n=function(F){var B=F&&F.__esModule?function getDefault(){return F.default}:function getModuleExports(){return F};return __webpack_require__.d(B,"a",B),B},__webpack_require__.o=function(F,B){return Object.prototype.hasOwnProperty.call(F,B)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(F,B,G){F.exports=G(1)},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.SlimCoreElectronControlCapturer=void 0;var K=G(2),J=G(6),Q=65535,Y=3e3,$=250,X=18,Z=17,ee=16,te=91,ne=50,ie=30,re=function(F){function SlimCoreElectronControlCapturer(B,G,W,z){void 0===W&&(W=!0),void 0===z&&(z=1);var K,J,Q=this;return(Q=F.call(this)||this)._logger=B,Q._element=G,Q._captureRegionPreserveAspectRatio=W,Q._mouseMoveCount=0,Q._mouseMoveStartTime=0,Q._isMouseDown=!1,Q._isMouseOnRenderer=!1,Q._captureMode=0,Q._pollTimerID=0,Q._resizeTimerID=0,Q._mouseMoveThrottlingEnabled=!1,Q._handleResizeEvents=function(){clearTimeout(Q._resizeTimerID),Q._resizeTimerID=window.setTimeout((function(){Q.updateCaptureRegion()}),$)},Q._handleMouseLeave=function(F){!Q._isOnScreenContent(F)&&Q._isMouseOnRenderer&&(Q._raiseCaptureEvent(2),Q._logger.info("Mouse leaving render region")),Q._isMouseOnRenderer=!1},Q._handleMouseEnter=function(F){Q._isOnScreenContent(F)&&(Q._isMouseOnRenderer=!0,Q._raiseCaptureEvent(1),Q._logger.info("Mouse entering render region"))},Q._handleLosingFocus=function(){Q._syncKeyStates(!0)},Q._handleClick=function(F){Q._isOnScreenContent(F)&&(Q._raiseCaptureEvent(0),Q._logger.info("Mouse clicked"))},Q._handleMouseMove=function(F){if(!Q._isOnScreenContent(F)&&Q._isMouseOnRenderer)return Q._raiseCaptureEvent(2),Q._isMouseOnRenderer=!1,void Q._logger.info("Mouse leaving render region");if(Q._isOnScreenContent(F)&&!Q._isMouseOnRenderer&&(Q._raiseCaptureEvent(1),Q._isMouseOnRenderer=!0,Q._logger.info("Mouse entering render region")),2===Q._captureMode||3===Q._captureMode){if(Q._mouseMoveCount++,Q._mouseMoveThrottlingEnabled){if(!Q._isOnScreenContent(F)||!Q._shouldMoveMouse())return}else if(!Q._isOnScreenContent(F)||Q._mouseMoveCount%2==0)return;var B={type:0};Q._normalizeMousePosition(F,B),Q._raiseMouseEvent(B)}},Q._handleMouseDown=function(F){if((2===Q._captureMode||3===Q._captureMode)&&Q._isOnScreenContent(F)){var B={type:2,buttonType:convertButton(F.button),buttonDown:!0};Q._isMouseDown=!0,Q._normalizeMousePosition(F,B),Q._raiseMouseEvent(B)}},Q._handleMouseUp=function(F){if((2===Q._captureMode||3===Q._captureMode)&&Q._isOnScreenContent(F)){var B={type:2,buttonType:convertButton(F.button),buttonDown:!1};Q._isMouseDown=!1,Q._normalizeMousePosition(F,B),Q._raiseMouseEvent(B)}},Q._handleKeyDown=function(F){Q._raiseKeyboardEvent({codeType:1,code:F.keyCode,repeat:F.repeat,keyUp:!1}),F.stopPropagation(),F.preventDefault()},Q._handleKeyUp=function(F){Q._raiseKeyboardEvent({codeType:1,code:F.keyCode,repeat:F.repeat,keyUp:!0}),F.stopPropagation(),F.preventDefault()},Q._handleWheel=function(F){Q._raiseMouseEvent({type:1,wheelRotation:F.deltaY>0?-120:120})},Q._handleContextMenu=function(F){F.preventDefault()},Q._ensureCanReceiveKeyboardInput(),null===(J=null===(K=Q._element.ownerDocument)||void 0===K?void 0:K.defaultView)||void 0===J||J.addEventListener("resize",Q._handleResizeEvents,!1),Q._captureRegion={left:0,top:0,width:Q._element.clientWidth,height:Q._element.clientHeight},Q._videoSize={width:Math.floor(G.clientHeight*z),height:G.clientHeight},Q._origElementSize={width:0,height:0},Q._checkElementSize(),Q._mouseMoveStartTime=new Date(0).getTime(),Q}return z(SlimCoreElectronControlCapturer,F),Object.defineProperty(SlimCoreElectronControlCapturer.prototype,"captureMode",{get:function(){return this._captureMode},enumerable:!1,configurable:!0}),Object.defineProperty(SlimCoreElectronControlCapturer.prototype,"captureRegion",{get:function(){return this._captureRegion},enumerable:!1,configurable:!0}),SlimCoreElectronControlCapturer.prototype.setMouseMoveThrottlingFeatureFlag=function(F){this._mouseMoveThrottlingEnabled=F},SlimCoreElectronControlCapturer.prototype.dispose=function(B){var G,W;this._logger.info("dispose causeId: ".concat(B)),window.clearTimeout(this._pollTimerID),null===(W=null===(G=this._element.ownerDocument)||void 0===G?void 0:G.defaultView)||void 0===W||W.removeEventListener("resize",this._handleResizeEvents,!1),F.prototype.dispose.call(this,B)},SlimCoreElectronControlCapturer.prototype.updateVideoSize=function(F,B){this._videoSize.width=F,this._videoSize.height=B,this.updateCaptureRegion()},SlimCoreElectronControlCapturer.prototype.updateCaptureRegion=function(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)},SlimCoreElectronControlCapturer.prototype.setCaptureMode=function(F){3===this._captureMode&&3!==F&&this._syncKeyStates(!0),this._captureMode=F,0!==F?(this._element.addEventListener("click",this._handleClick),this._element.addEventListener("pointermove",this._handleMouseMove),this._element.addEventListener("pointerdown",this._handleMouseDown),this._element.addEventListener("pointerup",this._handleMouseUp),this._element.addEventListener("pointerenter",this._handleMouseEnter),this._element.addEventListener("pointerleave",this._handleMouseLeave),3===F?(this._element.addEventListener("wheel",this._handleWheel),this._element.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("keyup",this._handleKeyUp),this._element.addEventListener("contextmenu",this._handleContextMenu),this._element.addEventListener("blur",this._handleLosingFocus)):(this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))):(this._element.removeEventListener("pointermove",this._handleMouseMove),this._element.removeEventListener("pointerdown",this._handleMouseDown),this._element.removeEventListener("pointerup",this._handleMouseUp),this._element.removeEventListener("pointerenter",this._handleMouseEnter),this._element.removeEventListener("pointerleave",this._handleMouseLeave),this._element.removeEventListener("click",this._handleClick),this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))},SlimCoreElectronControlCapturer.prototype._ensureCanReceiveKeyboardInput=function(){this._element.tabIndex=this._element.tabIndex},SlimCoreElectronControlCapturer.prototype._checkElementSize=function(){var F=this;this._origElementSize.width===this._element.clientWidth&&this._origElementSize.height===this._element.clientHeight||(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout((function(){F._checkElementSize()}),Y)},SlimCoreElectronControlCapturer.prototype._raiseMouseEvent=function(F){this.event("mouseControlEvent").raise(F)},SlimCoreElectronControlCapturer.prototype._raiseKeyboardEvent=function(F){this.event("keyboardControlEvent").raise(F)},SlimCoreElectronControlCapturer.prototype._raiseCaptureEvent=function(F){this.event("ctrlCaptureEvent").raise(F)},SlimCoreElectronControlCapturer.prototype._normalizeMousePosition=function(F,B){B.xPos=(F.offsetX-this._captureRegion.left)/this._captureRegion.width*Q,B.yPos=(F.offsetY-this._captureRegion.top)/this._captureRegion.height*Q},SlimCoreElectronControlCapturer.prototype._isOnScreenContent=function(F){var B=this._captureRegion.left,G=this._captureRegion.left+this._captureRegion.width,W=this._captureRegion.top,z=this._captureRegion.top+this._captureRegion.height;return B<=F.offsetX&&F.offsetX<G&&W<=F.offsetY&&F.offsetY<z},SlimCoreElectronControlCapturer.prototype._shouldMoveMouse=function(){if(this._mouseMoveStartTime){var F=(new Date).getTime(),B=F-this._mouseMoveStartTime;if(this._isMouseDown&&B>=ie||!this._isMouseDown&&B>=ne)return this._mouseMoveStartTime=F,!0}else this._mouseMoveStartTime=(new Date).getTime();return!1},SlimCoreElectronControlCapturer.prototype._syncKeyStates=function(F){this._raiseKeyboardEvent({codeType:1,code:Z,repeat:!1,keyUp:F}),this._raiseKeyboardEvent({codeType:1,code:ee,repeat:!1,keyUp:F}),this._raiseKeyboardEvent({codeType:1,code:X,repeat:!1,keyUp:F}),this._raiseKeyboardEvent({codeType:1,code:te,repeat:!1,keyUp:F}),this._logger.info("Synced Key states.")},SlimCoreElectronControlCapturer.formatMouseEvent=function(F){return J.ScreenSharingControlProtocol.encodeMouseEvent(F)},SlimCoreElectronControlCapturer.formatKeyboardEvent=function(F){return J.ScreenSharingControlProtocol.encodeKeyboardEvent(F)},SlimCoreElectronControlCapturer}(K.default);function convertButton(F){switch(F){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}B.SlimCoreElectronControlCapturer=re},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var J=function(F){function ObservableBase(B){return F.call(this,B)||this}return z(ObservableBase,F),ObservableBase.prototype.changed=function(F,B){return this.subscribe({changed:{skipEventConfig:B,handler:F},on:void 0})},ObservableBase.prototype.on=function(F,B){return this.subscribe({changed:void 0,on:{name:String(F),handler:this._toEventCallback(B)}})},ObservableBase.prototype.once=function(F,B,G){var W,z=this,onceSubscription=function(){for(var F=[],K=0;K<arguments.length;K++)F[K]=arguments[K];W.dispose(G),z._toEventCallback(B).apply(void 0,F)};return W=this.on(F,this._fromEventCallback(onceSubscription))},ObservableBase.prototype.raiseChanged=function(F){var B=this;this.raiseEvents((function(G){if(G.changed){var W=G.changed,z=W.skipEventConfig,K=W.handler;!B.getShouldSkipChangedEvent(F,z)&&K()}}))},ObservableBase.prototype.event=function(F){var B=this;return{raise:this._fromEventCallback((function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];return B._raiseEventImpl.apply(B,K([String(F)],G,!1))}))}},ObservableBase.prototype._raiseEventImpl=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];this.raiseEvents((function(G){var W;return G.on&&G.on.name===F&&(W=G.on).handler.apply(W,B)}))},ObservableBase.prototype._toEventCallback=function(F){return F},ObservableBase.prototype._fromEventCallback=function(F){return F},ObservableBase.prototype.getShouldSkipChangedEvent=function(F,B){return(null==F?void 0:F.skipDominantSpeakerUpdatesOnCall)?!!(null==B?void 0:B.skipDominantSpeakerUpdatesOnCall):!!(null==F?void 0:F.skipParticipantsUpdatesOnCall)&&!!(null==B?void 0:B.skipParticipantsUpdatesOnCall)},ObservableBase}(G(3).EventSourceImpl);B.default=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.EventSourceImpl=void 0;var W=G(4),z=G(5),K=function(){function EventSourceImpl(F){this.eventLogger=F,this.subscriptions=[]}return EventSourceImpl.prototype.subscribe=function(F){return new J(this.subscriptions,F)},EventSourceImpl.prototype.dispose=function(F){this.subscriptions=[]},EventSourceImpl.prototype.raiseEvents=function(F){var B=this;this.subscriptions.slice().forEach((function(G){try{void 0!==G.eventHandler&&F(G.eventHandler)}catch(F){B.eventLogger&&B.eventLogger.warn&&B.eventLogger.warn("Event handler exception caught!",(0,z.stringifyObject)(F))}}))},EventSourceImpl}();B.EventSourceImpl=K;var J=function(){function EventSubscriptionImpl(F,B){this.subscriptions=F,this.eventHandler=B,this.subscriptions.push(this)}return EventSubscriptionImpl.prototype.dispose=function(){var F=this;W.remove(this.subscriptions,(function(B){return B===F})),this.eventHandler=void 0},EventSubscriptionImpl}()},function(B,G){B.exports=F},function(F,B,G){function getRandomizedTimeout(F){var B=Math.floor(11*Math.random())+10;return Math.floor(F*(1-B/100))}function isStringBase64(F){if(!F)return!1;try{return atob(F),!0}catch(F){return!1}}function isPromiseLike(F){return!!F&&"function"==typeof F.then}function stringifyObject(F){if(!F)return"".concat(F);if(F instanceof Map)return mapToString(F);var B=F.toString();return B.endsWith("[object Object]")?JSON.stringify(F):B}function mapToString(F){var B={};return F.forEach((function(F,G){B[G.toString()]=F})),JSON.stringify(B)}function stringToBuffer(F){for(var B=new ArrayBuffer(F.length),G=new Uint8Array(B),W=0;W<F.length;W++)G[W]=F.charCodeAt(W);return G}Object.defineProperty(B,"__esModule",{value:!0}),B.stringToBuffer=B.stringifyObject=B.isPromiseLike=B.isStringBase64=B.getRandomizedTimeout=void 0,B.getRandomizedTimeout=getRandomizedTimeout,B.isStringBase64=isStringBase64,B.isPromiseLike=isPromiseLike,B.stringifyObject=stringifyObject,B.stringToBuffer=stringToBuffer},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ScreenSharingControlProtocol=void 0,function(F){var B=7,G=3;function encodeMouseEvent(F){if(!F)return new Uint8Array(0);F.buttonType||(F.buttonType=0),F.xPos||(F.xPos=0),F.yPos||(F.yPos=0),F.wheelRotation||(F.wheelRotation=0);var G=new ArrayBuffer(B),W=new DataView(G),z=(3&F.type)<<0,K=(7&F.buttonType)<<2,J=(F.buttonDown?1:0)<<5,Q=(F.wheelButtonDown?1:0)<<6,Y=0;return W.setUint8(0,1),W.setUint8(1,z|K|J|Q|Y),W.setUint16(2,F.xPos,!0),W.setUint16(4,F.yPos,!0),W.setUint8(6,F.wheelRotation),new Uint8Array(G)}function encodeKeyboardEvent(F){var B=new ArrayBuffer(G),W=new DataView(B),z=(3&F.codeType)<<0,K=0,J=(F.keyUp?1:0)<<4,Q=(F.repeat?1:0)<<5,Y=0,$=0;return W.setUint8(0,0),W.setUint8(1,z|K|J|Q|Y|$),W.setUint8(2,F.code),new Uint8Array(B)}function decodeEventType(F){return F[0]}function decodeMouseEvent(F){if(1!==F[0]||F.length!==B)return null;var G=new DataView(F.buffer),W=G.getUint8(1);return{type:3&W,buttonType:W>>2&7,buttonDown:!!(W>>5&1),wheelButtonDown:!!(W>>6&1),xPos:G.getUint16(2,!0),yPos:G.getUint16(4,!0),wheelRotation:G.getUint8(6)}}function decodeKeyboardEvent(F){if(0!==F[0]||F.length!==G)return null;var B=new DataView(F.buffer),W=B.getUint8(1);return{codeType:3&W,code:B.getUint8(2),repeat:!!(W>>5&1),keyUp:!!(W>>4&1)}}F.encodeMouseEvent=encodeMouseEvent,F.encodeKeyboardEvent=encodeKeyboardEvent,F.decodeEventType=decodeEventType,F.decodeMouseEvent=decodeMouseEvent,F.decodeKeyboardEvent=decodeKeyboardEvent}(B.ScreenSharingControlProtocol||(B.ScreenSharingControlProtocol={}))}])}))},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.EdgeControlInjector=void 0;var K=G(314),J=G(121),Q=function(){function EdgeControlInjector(F,B,G){this.logger=F,this.sharingTrackId=B,this.onInitErrorCallback=G,this.images=new Map,this.controlEventConverter=new K.EdgeControlEventConverter(F),this.edgeApi=new J.EdgeControlInjectorApi(this.logger)}return EdgeControlInjector.prototype.showVirtualCursor=function(F,B){if(this.logger.info("EdgeControlInjector - showVirtualCursor, id: ".concat(F," sharingTrackId: ").concat(this.sharingTrackId)),B){this.edgeApi.createInputDeviceId(this.sharingTrackId,this.onInitErrorCallback,this.images[F]);var G=this.images[0];G?this.edgeApi.sendSetLocalUserAvatarMessage(G):this.logger.error("EdgeControllerInjector - local avatar is missing, continue without local avatar")}else this.edgeApi.sendCloseVirtualInputDeviceMessage()},EdgeControlInjector.prototype.setAvatar=function(F,B){this.logger.info("".concat(F," EdgeControlInjector - setAvatar, id: ").concat(F,", data: ").concat(JSON.stringify(B))),this.images[F]=B},EdgeControlInjector.prototype.injectMouseEvent=function(F,B){return W(this,void 0,void 0,(function(){var G;return z(this,(function(W){return this.logger.info("".concat(F," EdgeControlInjector - injectMouseEvent ").concat(JSON.stringify(B))),G=this.controlEventConverter.toEdgeControlMouseEvent(B),[2,this.edgeApi.sendInjectInputEventMessage(G.apiName,G.event)]}))}))},EdgeControlInjector.prototype.injectKeyboardEvent=function(F,B){return W(this,void 0,void 0,(function(){var F;return z(this,(function(G){return F=this.controlEventConverter.toEdgeControlKeyboardEvent(B),[2,this.edgeApi.sendInjectInputEventMessage(F.apiName,F.event)]}))}))},EdgeControlInjector.prototype.injectClipboardText=function(F,B){return this.logger.info("".concat(F," EdgeControlInjector - injectClipboardText is unimplemented")),Promise.resolve(0)},EdgeControlInjector.prototype.dispose=function(F){this.logger.info("EdgeControlInjector - dispose"),this.edgeApi.sendCloseVirtualInputDeviceMessage()},EdgeControlInjector}();B.EdgeControlInjector=Q},function(F,B,G){var W,z;Object.defineProperty(B,"__esModule",{value:!0}),B.EdgeControlEventConverter=B.EdgeControlEventData=void 0,function(F){F[F.LEFT=0]="LEFT",F[F.RIGHT=1]="RIGHT",F[F.MIDDLE=2]="MIDDLE",F[F.BACK=3]="BACK",F[F.FORWARD=4]="FORWARD"}(W||(W={})),function(F){F[F.SCAN_CODE=0]="SCAN_CODE",F[F.VIRTUAL_KEY=1]="VIRTUAL_KEY",F[F.RECOGNITION_INPUT=2]="RECOGNITION_INPUT"}(z||(z={}));var K=function(){function EdgeControlEventData(){}return EdgeControlEventData}();B.EdgeControlEventData=K;var J=function(){function EdgeControlEventConverter(F){this.logger=F}return EdgeControlEventConverter.prototype.toEdgeControlMouseEvent=function(F){var B;switch(F.type){case 0:return{event:this.toMouseMoveEvent(F),apiName:"injectMouseMoveEvent"};case 1:return{event:this.toMouseWheelEvent(F),apiName:"injectMouseWheelEvent"};case 2:return{event:this.toMouseButtonPressedEvent(F),apiName:"injectMouseButtonEvent"};default:throw B="Uncovered mouse control event type. Event: ".concat(F),this.logger.error(B),Error(B)}},EdgeControlEventConverter.prototype.toEdgeControlKeyboardEvent=function(F){return{event:{repeat:F.repeat,keyUp:F.keyUp,codeType:z[F.codeType],keyCode:F.code},apiName:"injectKeyEvent"}},EdgeControlEventConverter.prototype.toMouseMoveEvent=function(F){return{xPos:F.xPos,yPos:F.yPos}},EdgeControlEventConverter.prototype.toMouseWheelEvent=function(F){return{wheelButtonDown:F.wheelButtonDown,wheelRotation:F.wheelRotation}},EdgeControlEventConverter.prototype.toMouseButtonPressedEvent=function(F){return{xPos:F.xPos,yPos:F.yPos,button:W[F.buttonType],buttonDown:F.buttonDown}},EdgeControlEventConverter}();B.EdgeControlEventConverter=J},function(F,B,G){(function(F){var G=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},W=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};function pngBase64ToBitmap(B,z,K){return G(this,void 0,void 0,(function(){return W(this,(function(G){return[2,new Promise((function(G,W){var J=F.from(B,"base64"),Q=document.createElement("canvas").getContext("2d"),Y=new Blob([J],{type:"image/png"}),$=new Image;$.onload=function(){Q.drawImage($,0,0,$.width,$.height,0,0,z,K);var F=Q.getImageData(0,0,z,K);window.URL.revokeObjectURL($.src),$=null,G(Array.from(F.data))},$.onerror=function(F){W(F)},$.src=window.URL.createObjectURL(Y)}))]}))}))}Object.defineProperty(B,"__esModule",{value:!0}),B.pngBase64ToBitmap=void 0,B.pngBase64ToBitmap=pngBase64ToBitmap}).call(this,G(316).Buffer)},function(F,B,G){(function(F){
/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <http://feross.org>
	 * @license  MIT
	 */
var W=G(317),z=G(318),K=G(319);function typedArraySupport(){try{var F=new Uint8Array(1);return F.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===F.foo()&&"function"==typeof F.subarray&&0===F.subarray(1,1).byteLength}catch(F){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(F,B){if(kMaxLength()<B)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(F=new Uint8Array(B)).__proto__=Buffer.prototype:(null===F&&(F=new Buffer(B)),F.length=B),F}function Buffer(F,B,G){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(F,B,G);if("number"==typeof F){if("string"==typeof B)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,F)}return from(this,F,B,G)}function from(F,B,G,W){if("number"==typeof B)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&B instanceof ArrayBuffer?fromArrayBuffer(F,B,G,W):"string"==typeof B?fromString(F,B,G):fromObject(F,B)}function assertSize(F){if("number"!=typeof F)throw new TypeError('"size" argument must be a number');if(F<0)throw new RangeError('"size" argument must not be negative')}function alloc(F,B,G,W){return assertSize(B),B<=0?createBuffer(F,B):void 0!==G?"string"==typeof W?createBuffer(F,B).fill(G,W):createBuffer(F,B).fill(G):createBuffer(F,B)}function allocUnsafe(F,B){if(assertSize(B),F=createBuffer(F,B<0?0:0|checked(B)),!Buffer.TYPED_ARRAY_SUPPORT)for(var G=0;G<B;++G)F[G]=0;return F}function fromString(F,B,G){if("string"==typeof G&&""!==G||(G="utf8"),!Buffer.isEncoding(G))throw new TypeError('"encoding" must be a valid string encoding');var W=0|byteLength(B,G),z=(F=createBuffer(F,W)).write(B,G);return z!==W&&(F=F.slice(0,z)),F}function fromArrayLike(F,B){var G=B.length<0?0:0|checked(B.length);F=createBuffer(F,G);for(var W=0;W<G;W+=1)F[W]=255&B[W];return F}function fromArrayBuffer(F,B,G,W){if(B.byteLength,G<0||B.byteLength<G)throw new RangeError("'offset' is out of bounds");if(B.byteLength<G+(W||0))throw new RangeError("'length' is out of bounds");return B=void 0===G&&void 0===W?new Uint8Array(B):void 0===W?new Uint8Array(B,G):new Uint8Array(B,G,W),Buffer.TYPED_ARRAY_SUPPORT?(F=B).__proto__=Buffer.prototype:F=fromArrayLike(F,B),F}function fromObject(F,B){if(Buffer.isBuffer(B)){var G=0|checked(B.length);return 0===(F=createBuffer(F,G)).length||B.copy(F,0,0,G),F}if(B){if("undefined"!=typeof ArrayBuffer&&B.buffer instanceof ArrayBuffer||"length"in B)return"number"!=typeof B.length||isnan(B.length)?createBuffer(F,0):fromArrayLike(F,B);if("Buffer"===B.type&&K(B.data))return fromArrayLike(F,B.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(F){if(F>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|F}function SlowBuffer(F){return+F!=F&&(F=0),Buffer.alloc(+F)}function byteLength(F,B){if(Buffer.isBuffer(F))return F.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(F)||F instanceof ArrayBuffer))return F.byteLength;"string"!=typeof F&&(F=""+F);var G=F.length;if(0===G)return 0;for(var W=!1;;)switch(B){case"ascii":case"latin1":case"binary":return G;case"utf8":case"utf-8":case void 0:return utf8ToBytes(F).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*G;case"hex":return G>>>1;case"base64":return base64ToBytes(F).length;default:if(W)return utf8ToBytes(F).length;B=(""+B).toLowerCase(),W=!0}}function slowToString(F,B,G){var W=!1;if((void 0===B||B<0)&&(B=0),B>this.length)return"";if((void 0===G||G>this.length)&&(G=this.length),G<=0)return"";if((G>>>=0)<=(B>>>=0))return"";for(F||(F="utf8");;)switch(F){case"hex":return hexSlice(this,B,G);case"utf8":case"utf-8":return utf8Slice(this,B,G);case"ascii":return asciiSlice(this,B,G);case"latin1":case"binary":return latin1Slice(this,B,G);case"base64":return base64Slice(this,B,G);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,B,G);default:if(W)throw new TypeError("Unknown encoding: "+F);F=(F+"").toLowerCase(),W=!0}}function swap(F,B,G){var W=F[B];F[B]=F[G],F[G]=W}function bidirectionalIndexOf(F,B,G,W,z){if(0===F.length)return-1;if("string"==typeof G?(W=G,G=0):G>2147483647?G=2147483647:G<-2147483648&&(G=-2147483648),G=+G,isNaN(G)&&(G=z?0:F.length-1),G<0&&(G=F.length+G),G>=F.length){if(z)return-1;G=F.length-1}else if(G<0){if(!z)return-1;G=0}if("string"==typeof B&&(B=Buffer.from(B,W)),Buffer.isBuffer(B))return 0===B.length?-1:arrayIndexOf(F,B,G,W,z);if("number"==typeof B)return B&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?z?Uint8Array.prototype.indexOf.call(F,B,G):Uint8Array.prototype.lastIndexOf.call(F,B,G):arrayIndexOf(F,[B],G,W,z);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(F,B,G,W,z){var K,J=1,Q=F.length,Y=B.length;if(void 0!==W&&("ucs2"===(W=String(W).toLowerCase())||"ucs-2"===W||"utf16le"===W||"utf-16le"===W)){if(F.length<2||B.length<2)return-1;J=2,Q/=2,Y/=2,G/=2}function read(F,B){return 1===J?F[B]:F.readUInt16BE(B*J)}if(z){var $=-1;for(K=G;K<Q;K++)if(read(F,K)===read(B,-1===$?0:K-$)){if(-1===$&&($=K),K-$+1===Y)return $*J}else-1!==$&&(K-=K-$),$=-1}else for(G+Y>Q&&(G=Q-Y),K=G;K>=0;K--){for(var X=!0,Z=0;Z<Y;Z++)if(read(F,K+Z)!==read(B,Z)){X=!1;break}if(X)return K}return-1}function hexWrite(F,B,G,W){G=Number(G)||0;var z=F.length-G;W?(W=Number(W))>z&&(W=z):W=z;var K=B.length;if(K%2!=0)throw new TypeError("Invalid hex string");W>K/2&&(W=K/2);for(var J=0;J<W;++J){var Q=parseInt(B.substr(2*J,2),16);if(isNaN(Q))return J;F[G+J]=Q}return J}function utf8Write(F,B,G,W){return blitBuffer(utf8ToBytes(B,F.length-G),F,G,W)}function asciiWrite(F,B,G,W){return blitBuffer(asciiToBytes(B),F,G,W)}function latin1Write(F,B,G,W){return asciiWrite(F,B,G,W)}function base64Write(F,B,G,W){return blitBuffer(base64ToBytes(B),F,G,W)}function ucs2Write(F,B,G,W){return blitBuffer(utf16leToBytes(B,F.length-G),F,G,W)}function base64Slice(F,B,G){return 0===B&&G===F.length?W.fromByteArray(F):W.fromByteArray(F.slice(B,G))}function utf8Slice(F,B,G){G=Math.min(F.length,G);for(var W=[],z=B;z<G;){var K,J,Q,Y,$=F[z],X=null,Z=$>239?4:$>223?3:$>191?2:1;if(z+Z<=G)switch(Z){case 1:$<128&&(X=$);break;case 2:128==(192&(K=F[z+1]))&&(Y=(31&$)<<6|63&K)>127&&(X=Y);break;case 3:K=F[z+1],J=F[z+2],128==(192&K)&&128==(192&J)&&(Y=(15&$)<<12|(63&K)<<6|63&J)>2047&&(Y<55296||Y>57343)&&(X=Y);break;case 4:K=F[z+1],J=F[z+2],Q=F[z+3],128==(192&K)&&128==(192&J)&&128==(192&Q)&&(Y=(15&$)<<18|(63&K)<<12|(63&J)<<6|63&Q)>65535&&Y<1114112&&(X=Y)}null===X?(X=65533,Z=1):X>65535&&(X-=65536,W.push(X>>>10&1023|55296),X=56320|1023&X),W.push(X),z+=Z}return decodeCodePointsArray(W)}B.Buffer=Buffer,B.SlowBuffer=SlowBuffer,B.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==F.TYPED_ARRAY_SUPPORT?F.TYPED_ARRAY_SUPPORT:typedArraySupport(),B.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(F){return F.__proto__=Buffer.prototype,F},Buffer.from=function(F,B,G){return from(null,F,B,G)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(F,B,G){return alloc(null,F,B,G)},Buffer.allocUnsafe=function(F){return allocUnsafe(null,F)},Buffer.allocUnsafeSlow=function(F){return allocUnsafe(null,F)},Buffer.isBuffer=function isBuffer(F){return!(null==F||!F._isBuffer)},Buffer.compare=function compare(F,B){if(!Buffer.isBuffer(F)||!Buffer.isBuffer(B))throw new TypeError("Arguments must be Buffers");if(F===B)return 0;for(var G=F.length,W=B.length,z=0,K=Math.min(G,W);z<K;++z)if(F[z]!==B[z]){G=F[z],W=B[z];break}return G<W?-1:W<G?1:0},Buffer.isEncoding=function isEncoding(F){switch(String(F).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(F,B){if(!K(F))throw new TypeError('"list" argument must be an Array of Buffers');if(0===F.length)return Buffer.alloc(0);var G;if(void 0===B)for(B=0,G=0;G<F.length;++G)B+=F[G].length;var W=Buffer.allocUnsafe(B),z=0;for(G=0;G<F.length;++G){var J=F[G];if(!Buffer.isBuffer(J))throw new TypeError('"list" argument must be an Array of Buffers');J.copy(W,z),z+=J.length}return W},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var F=this.length;if(F%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var B=0;B<F;B+=2)swap(this,B,B+1);return this},Buffer.prototype.swap32=function swap32(){var F=this.length;if(F%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var B=0;B<F;B+=4)swap(this,B,B+3),swap(this,B+1,B+2);return this},Buffer.prototype.swap64=function swap64(){var F=this.length;if(F%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var B=0;B<F;B+=8)swap(this,B,B+7),swap(this,B+1,B+6),swap(this,B+2,B+5),swap(this,B+3,B+4);return this},Buffer.prototype.toString=function toString(){var F=0|this.length;return 0===F?"":0===arguments.length?utf8Slice(this,0,F):slowToString.apply(this,arguments)},Buffer.prototype.equals=function equals(F){if(!Buffer.isBuffer(F))throw new TypeError("Argument must be a Buffer");return this===F||0===Buffer.compare(this,F)},Buffer.prototype.inspect=function inspect(){var F="",G=B.INSPECT_MAX_BYTES;return this.length>0&&(F=this.toString("hex",0,G).match(/.{2}/g).join(" "),this.length>G&&(F+=" ... ")),"<Buffer "+F+">"},Buffer.prototype.compare=function compare(F,B,G,W,z){if(!Buffer.isBuffer(F))throw new TypeError("Argument must be a Buffer");if(void 0===B&&(B=0),void 0===G&&(G=F?F.length:0),void 0===W&&(W=0),void 0===z&&(z=this.length),B<0||G>F.length||W<0||z>this.length)throw new RangeError("out of range index");if(W>=z&&B>=G)return 0;if(W>=z)return-1;if(B>=G)return 1;if(this===F)return 0;for(var K=(z>>>=0)-(W>>>=0),J=(G>>>=0)-(B>>>=0),Q=Math.min(K,J),Y=this.slice(W,z),$=F.slice(B,G),X=0;X<Q;++X)if(Y[X]!==$[X]){K=Y[X],J=$[X];break}return K<J?-1:J<K?1:0},Buffer.prototype.includes=function includes(F,B,G){return-1!==this.indexOf(F,B,G)},Buffer.prototype.indexOf=function indexOf(F,B,G){return bidirectionalIndexOf(this,F,B,G,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(F,B,G){return bidirectionalIndexOf(this,F,B,G,!1)},Buffer.prototype.write=function write(F,B,G,W){if(void 0===B)W="utf8",G=this.length,B=0;else if(void 0===G&&"string"==typeof B)W=B,G=this.length,B=0;else{if(!isFinite(B))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");B|=0,isFinite(G)?(G|=0,void 0===W&&(W="utf8")):(W=G,G=void 0)}var z=this.length-B;if((void 0===G||G>z)&&(G=z),F.length>0&&(G<0||B<0)||B>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");for(var K=!1;;)switch(W){case"hex":return hexWrite(this,F,B,G);case"utf8":case"utf-8":return utf8Write(this,F,B,G);case"ascii":return asciiWrite(this,F,B,G);case"latin1":case"binary":return latin1Write(this,F,B,G);case"base64":return base64Write(this,F,B,G);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,F,B,G);default:if(K)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),K=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var J=4096;function decodeCodePointsArray(F){var B=F.length;if(B<=J)return String.fromCharCode.apply(String,F);for(var G="",W=0;W<B;)G+=String.fromCharCode.apply(String,F.slice(W,W+=J));return G}function asciiSlice(F,B,G){var W="";G=Math.min(F.length,G);for(var z=B;z<G;++z)W+=String.fromCharCode(127&F[z]);return W}function latin1Slice(F,B,G){var W="";G=Math.min(F.length,G);for(var z=B;z<G;++z)W+=String.fromCharCode(F[z]);return W}function hexSlice(F,B,G){var W=F.length;(!B||B<0)&&(B=0),(!G||G<0||G>W)&&(G=W);for(var z="",K=B;K<G;++K)z+=toHex(F[K]);return z}function utf16leSlice(F,B,G){for(var W=F.slice(B,G),z="",K=0;K<W.length;K+=2)z+=String.fromCharCode(W[K]+256*W[K+1]);return z}function checkOffset(F,B,G){if(F%1!=0||F<0)throw new RangeError("offset is not uint");if(F+B>G)throw new RangeError("Trying to access beyond buffer length")}function checkInt(F,B,G,W,z,K){if(!Buffer.isBuffer(F))throw new TypeError('"buffer" argument must be a Buffer instance');if(B>z||B<K)throw new RangeError('"value" argument is out of bounds');if(G+W>F.length)throw new RangeError("Index out of range")}function objectWriteUInt16(F,B,G,W){B<0&&(B=65535+B+1);for(var z=0,K=Math.min(F.length-G,2);z<K;++z)F[G+z]=(B&255<<8*(W?z:1-z))>>>8*(W?z:1-z)}function objectWriteUInt32(F,B,G,W){B<0&&(B=4294967295+B+1);for(var z=0,K=Math.min(F.length-G,4);z<K;++z)F[G+z]=B>>>8*(W?z:3-z)&255}function checkIEEE754(F,B,G,W,z,K){if(G+W>F.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("Index out of range")}function writeFloat(F,B,G,W,K){return K||checkIEEE754(F,B,G,4),z.write(F,B,G,W,23,4),G+4}function writeDouble(F,B,G,W,K){return K||checkIEEE754(F,B,G,8),z.write(F,B,G,W,52,8),G+8}Buffer.prototype.slice=function slice(F,B){var G,W=this.length;if((F=~~F)<0?(F+=W)<0&&(F=0):F>W&&(F=W),(B=void 0===B?W:~~B)<0?(B+=W)<0&&(B=0):B>W&&(B=W),B<F&&(B=F),Buffer.TYPED_ARRAY_SUPPORT)(G=this.subarray(F,B)).__proto__=Buffer.prototype;else{var z=B-F;G=new Buffer(z,void 0);for(var K=0;K<z;++K)G[K]=this[K+F]}return G},Buffer.prototype.readUIntLE=function readUIntLE(F,B,G){F|=0,B|=0,G||checkOffset(F,B,this.length);for(var W=this[F],z=1,K=0;++K<B&&(z*=256);)W+=this[F+K]*z;return W},Buffer.prototype.readUIntBE=function readUIntBE(F,B,G){F|=0,B|=0,G||checkOffset(F,B,this.length);for(var W=this[F+--B],z=1;B>0&&(z*=256);)W+=this[F+--B]*z;return W},Buffer.prototype.readUInt8=function readUInt8(F,B){return B||checkOffset(F,1,this.length),this[F]},Buffer.prototype.readUInt16LE=function readUInt16LE(F,B){return B||checkOffset(F,2,this.length),this[F]|this[F+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(F,B){return B||checkOffset(F,2,this.length),this[F]<<8|this[F+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(F,B){return B||checkOffset(F,4,this.length),(this[F]|this[F+1]<<8|this[F+2]<<16)+16777216*this[F+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(F,B){return B||checkOffset(F,4,this.length),16777216*this[F]+(this[F+1]<<16|this[F+2]<<8|this[F+3])},Buffer.prototype.readIntLE=function readIntLE(F,B,G){F|=0,B|=0,G||checkOffset(F,B,this.length);for(var W=this[F],z=1,K=0;++K<B&&(z*=256);)W+=this[F+K]*z;return W>=(z*=128)&&(W-=Math.pow(2,8*B)),W},Buffer.prototype.readIntBE=function readIntBE(F,B,G){F|=0,B|=0,G||checkOffset(F,B,this.length);for(var W=B,z=1,K=this[F+--W];W>0&&(z*=256);)K+=this[F+--W]*z;return K>=(z*=128)&&(K-=Math.pow(2,8*B)),K},Buffer.prototype.readInt8=function readInt8(F,B){return B||checkOffset(F,1,this.length),128&this[F]?-1*(255-this[F]+1):this[F]},Buffer.prototype.readInt16LE=function readInt16LE(F,B){B||checkOffset(F,2,this.length);var G=this[F]|this[F+1]<<8;return 32768&G?4294901760|G:G},Buffer.prototype.readInt16BE=function readInt16BE(F,B){B||checkOffset(F,2,this.length);var G=this[F+1]|this[F]<<8;return 32768&G?4294901760|G:G},Buffer.prototype.readInt32LE=function readInt32LE(F,B){return B||checkOffset(F,4,this.length),this[F]|this[F+1]<<8|this[F+2]<<16|this[F+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(F,B){return B||checkOffset(F,4,this.length),this[F]<<24|this[F+1]<<16|this[F+2]<<8|this[F+3]},Buffer.prototype.readFloatLE=function readFloatLE(F,B){return B||checkOffset(F,4,this.length),z.read(this,F,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(F,B){return B||checkOffset(F,4,this.length),z.read(this,F,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(F,B){return B||checkOffset(F,8,this.length),z.read(this,F,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(F,B){return B||checkOffset(F,8,this.length),z.read(this,F,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(F,B,G,W){(F=+F,B|=0,G|=0,W)||checkInt(this,F,B,G,Math.pow(2,8*G)-1,0);var z=1,K=0;for(this[B]=255&F;++K<G&&(z*=256);)this[B+K]=F/z&255;return B+G},Buffer.prototype.writeUIntBE=function writeUIntBE(F,B,G,W){(F=+F,B|=0,G|=0,W)||checkInt(this,F,B,G,Math.pow(2,8*G)-1,0);var z=G-1,K=1;for(this[B+z]=255&F;--z>=0&&(K*=256);)this[B+z]=F/K&255;return B+G},Buffer.prototype.writeUInt8=function writeUInt8(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(F=Math.floor(F)),this[B]=255&F,B+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[B]=255&F,this[B+1]=F>>>8):objectWriteUInt16(this,F,B,!0),B+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[B]=F>>>8,this[B+1]=255&F):objectWriteUInt16(this,F,B,!1),B+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[B+3]=F>>>24,this[B+2]=F>>>16,this[B+1]=F>>>8,this[B]=255&F):objectWriteUInt32(this,F,B,!0),B+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[B]=F>>>24,this[B+1]=F>>>16,this[B+2]=F>>>8,this[B+3]=255&F):objectWriteUInt32(this,F,B,!1),B+4},Buffer.prototype.writeIntLE=function writeIntLE(F,B,G,W){if(F=+F,B|=0,!W){var z=Math.pow(2,8*G-1);checkInt(this,F,B,G,z-1,-z)}var K=0,J=1,Q=0;for(this[B]=255&F;++K<G&&(J*=256);)F<0&&0===Q&&0!==this[B+K-1]&&(Q=1),this[B+K]=(F/J>>0)-Q&255;return B+G},Buffer.prototype.writeIntBE=function writeIntBE(F,B,G,W){if(F=+F,B|=0,!W){var z=Math.pow(2,8*G-1);checkInt(this,F,B,G,z-1,-z)}var K=G-1,J=1,Q=0;for(this[B+K]=255&F;--K>=0&&(J*=256);)F<0&&0===Q&&0!==this[B+K+1]&&(Q=1),this[B+K]=(F/J>>0)-Q&255;return B+G},Buffer.prototype.writeInt8=function writeInt8(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(F=Math.floor(F)),F<0&&(F=255+F+1),this[B]=255&F,B+1},Buffer.prototype.writeInt16LE=function writeInt16LE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[B]=255&F,this[B+1]=F>>>8):objectWriteUInt16(this,F,B,!0),B+2},Buffer.prototype.writeInt16BE=function writeInt16BE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[B]=F>>>8,this[B+1]=255&F):objectWriteUInt16(this,F,B,!1),B+2},Buffer.prototype.writeInt32LE=function writeInt32LE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[B]=255&F,this[B+1]=F>>>8,this[B+2]=F>>>16,this[B+3]=F>>>24):objectWriteUInt32(this,F,B,!0),B+4},Buffer.prototype.writeInt32BE=function writeInt32BE(F,B,G){return F=+F,B|=0,G||checkInt(this,F,B,4,2147483647,-2147483648),F<0&&(F=4294967295+F+1),Buffer.TYPED_ARRAY_SUPPORT?(this[B]=F>>>24,this[B+1]=F>>>16,this[B+2]=F>>>8,this[B+3]=255&F):objectWriteUInt32(this,F,B,!1),B+4},Buffer.prototype.writeFloatLE=function writeFloatLE(F,B,G){return writeFloat(this,F,B,!0,G)},Buffer.prototype.writeFloatBE=function writeFloatBE(F,B,G){return writeFloat(this,F,B,!1,G)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(F,B,G){return writeDouble(this,F,B,!0,G)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(F,B,G){return writeDouble(this,F,B,!1,G)},Buffer.prototype.copy=function copy(F,B,G,W){if(G||(G=0),W||0===W||(W=this.length),B>=F.length&&(B=F.length),B||(B=0),W>0&&W<G&&(W=G),W===G)return 0;if(0===F.length||0===this.length)return 0;if(B<0)throw new RangeError("targetStart out of bounds");if(G<0||G>=this.length)throw new RangeError("sourceStart out of bounds");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),F.length-B<W-G&&(W=F.length-B+G);var z,K=W-G;if(this===F&&G<B&&B<W)for(z=K-1;z>=0;--z)F[z+B]=this[z+G];else if(K<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(z=0;z<K;++z)F[z+B]=this[z+G];else Uint8Array.prototype.set.call(F,this.subarray(G,G+K),B);return K},Buffer.prototype.fill=function fill(F,B,G,W){if("string"==typeof F){if("string"==typeof B?(W=B,B=0,G=this.length):"string"==typeof G&&(W=G,G=this.length),1===F.length){var z=F.charCodeAt(0);z<256&&(F=z)}if(void 0!==W&&"string"!=typeof W)throw new TypeError("encoding must be a string");if("string"==typeof W&&!Buffer.isEncoding(W))throw new TypeError("Unknown encoding: "+W)}else"number"==typeof F&&(F&=255);if(B<0||this.length<B||this.length<G)throw new RangeError("Out of range index");if(G<=B)return this;var K;if(B>>>=0,G=void 0===G?this.length:G>>>0,F||(F=0),"number"==typeof F)for(K=B;K<G;++K)this[K]=F;else{var J=Buffer.isBuffer(F)?F:utf8ToBytes(new Buffer(F,W).toString()),Q=J.length;for(K=0;K<G-B;++K)this[K+B]=J[K%Q]}return this};var Q=/[^+\/0-9A-Za-z-_]/g;function base64clean(F){if((F=stringtrim(F).replace(Q,"")).length<2)return"";for(;F.length%4!=0;)F+="=";return F}function stringtrim(F){return F.trim?F.trim():F.replace(/^\s+|\s+$/g,"")}function toHex(F){return F<16?"0"+F.toString(16):F.toString(16)}function utf8ToBytes(F,B){var G;B=B||1/0;for(var W=F.length,z=null,K=[],J=0;J<W;++J){if((G=F.charCodeAt(J))>55295&&G<57344){if(!z){if(G>56319){(B-=3)>-1&&K.push(239,191,189);continue}if(J+1===W){(B-=3)>-1&&K.push(239,191,189);continue}z=G;continue}if(G<56320){(B-=3)>-1&&K.push(239,191,189),z=G;continue}G=65536+(z-55296<<10|G-56320)}else z&&(B-=3)>-1&&K.push(239,191,189);if(z=null,G<128){if((B-=1)<0)break;K.push(G)}else if(G<2048){if((B-=2)<0)break;K.push(G>>6|192,63&G|128)}else if(G<65536){if((B-=3)<0)break;K.push(G>>12|224,G>>6&63|128,63&G|128)}else{if(!(G<1114112))throw new Error("Invalid code point");if((B-=4)<0)break;K.push(G>>18|240,G>>12&63|128,G>>6&63|128,63&G|128)}}return K}function asciiToBytes(F){for(var B=[],G=0;G<F.length;++G)B.push(255&F.charCodeAt(G));return B}function utf16leToBytes(F,B){for(var G,W,z,K=[],J=0;J<F.length&&!((B-=2)<0);++J)W=(G=F.charCodeAt(J))>>8,z=G%256,K.push(z),K.push(W);return K}function base64ToBytes(F){return W.toByteArray(base64clean(F))}function blitBuffer(F,B,G,W){for(var z=0;z<W&&!(z+G>=B.length||z>=F.length);++z)B[z+G]=F[z];return z}function isnan(F){return F!=F}}).call(this,G(49))},function(F,B,G){B.byteLength=byteLength,B.toByteArray=toByteArray,B.fromByteArray=fromByteArray;for(var W=[],z=[],K="undefined"!=typeof Uint8Array?Uint8Array:Array,J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Q=0,Y=J.length;Q<Y;++Q)W[Q]=J[Q],z[J.charCodeAt(Q)]=Q;function getLens(F){var B=F.length;if(B%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var G=F.indexOf("=");return-1===G&&(G=B),[G,G===B?0:4-G%4]}function byteLength(F){var B=getLens(F),G=B[0],W=B[1];return 3*(G+W)/4-W}function _byteLength(F,B,G){return 3*(B+G)/4-G}function toByteArray(F){var B,G,W=getLens(F),J=W[0],Q=W[1],Y=new K(_byteLength(F,J,Q)),$=0,X=Q>0?J-4:J;for(G=0;G<X;G+=4)B=z[F.charCodeAt(G)]<<18|z[F.charCodeAt(G+1)]<<12|z[F.charCodeAt(G+2)]<<6|z[F.charCodeAt(G+3)],Y[$++]=B>>16&255,Y[$++]=B>>8&255,Y[$++]=255&B;return 2===Q&&(B=z[F.charCodeAt(G)]<<2|z[F.charCodeAt(G+1)]>>4,Y[$++]=255&B),1===Q&&(B=z[F.charCodeAt(G)]<<10|z[F.charCodeAt(G+1)]<<4|z[F.charCodeAt(G+2)]>>2,Y[$++]=B>>8&255,Y[$++]=255&B),Y}function tripletToBase64(F){return W[F>>18&63]+W[F>>12&63]+W[F>>6&63]+W[63&F]}function encodeChunk(F,B,G){for(var W,z=[],K=B;K<G;K+=3)W=(F[K]<<16&16711680)+(F[K+1]<<8&65280)+(255&F[K+2]),z.push(tripletToBase64(W));return z.join("")}function fromByteArray(F){for(var B,G=F.length,z=G%3,K=[],J=16383,Q=0,Y=G-z;Q<Y;Q+=J)K.push(encodeChunk(F,Q,Q+J>Y?Y:Q+J));return 1===z?(B=F[G-1],K.push(W[B>>2]+W[B<<4&63]+"==")):2===z&&(B=(F[G-2]<<8)+F[G-1],K.push(W[B>>10]+W[B>>4&63]+W[B<<2&63]+"=")),K.join("")}z["-".charCodeAt(0)]=62,z["_".charCodeAt(0)]=63},function(F,B){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
B.read=function(F,B,G,W,z){var K,J,Q=8*z-W-1,Y=(1<<Q)-1,$=Y>>1,X=-7,Z=G?z-1:0,ee=G?-1:1,te=F[B+Z];for(Z+=ee,K=te&(1<<-X)-1,te>>=-X,X+=Q;X>0;K=256*K+F[B+Z],Z+=ee,X-=8);for(J=K&(1<<-X)-1,K>>=-X,X+=W;X>0;J=256*J+F[B+Z],Z+=ee,X-=8);if(0===K)K=1-$;else{if(K===Y)return J?NaN:1/0*(te?-1:1);J+=Math.pow(2,W),K-=$}return(te?-1:1)*J*Math.pow(2,K-W)},B.write=function(F,B,G,W,z,K){var J,Q,Y,$=8*K-z-1,X=(1<<$)-1,Z=X>>1,ee=23===z?Math.pow(2,-24)-Math.pow(2,-77):0,te=W?0:K-1,ne=W?1:-1,ie=B<0||0===B&&1/B<0?1:0;for(B=Math.abs(B),isNaN(B)||B===1/0?(Q=isNaN(B)?1:0,J=X):(J=Math.floor(Math.log(B)/Math.LN2),B*(Y=Math.pow(2,-J))<1&&(J--,Y*=2),(B+=J+Z>=1?ee/Y:ee*Math.pow(2,1-Z))*Y>=2&&(J++,Y/=2),J+Z>=X?(Q=0,J=X):J+Z>=1?(Q=(B*Y-1)*Math.pow(2,z),J+=Z):(Q=B*Math.pow(2,Z-1)*Math.pow(2,z),J=0));z>=8;F[G+te]=255&Q,te+=ne,Q/=256,z-=8);for(J=J<<z|Q,$+=z;$>0;F[G+te]=255&J,te+=ne,J/=256,$-=8);F[G+te-ne]|=128*ie}},function(F,B){var G={}.toString;F.exports=Array.isArray||function(F){return"[object Array]"==G.call(F)}},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};function createParticipantListFromMriMap(F){var B,G,z,K,J=[];try{for(var Q=W(Object.keys(F)),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;if(F[$].participantLegIds)try{for(var X=(z=void 0,W(F[$].participantLegIds)),Z=X.next();!Z.done;Z=X.next()){var ee=Z.value;J.push({id:$,mri:$,participantId:ee})}}catch(F){z={error:F}}finally{try{Z&&!Z.done&&(K=X.return)&&K.call(X)}finally{if(z)throw z.error}}else J.push({id:$,mri:$})}}catch(F){B={error:F}}finally{try{Y&&!Y.done&&(G=Q.return)&&G.call(Q)}finally{if(B)throw B.error}}return J}function mapParticipantScope(F){switch(F){case 1:return"specified";case 0:return"all";case 3:return"attendees";case 2:return"presenters";default:return"none"}}Object.defineProperty(B,"__esModule",{value:!0}),B.mapParticipantScope=B.createParticipantListFromMriMap=void 0,B.createParticipantListFromMriMap=createParticipantListFromMriMap,B.mapParticipantScope=mapParticipantScope},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.hasReceiveDirectionality=B.hasSendDirectionality=void 0;var W=G(10);Object.defineProperty(B,"hasSendDirectionality",{enumerable:!0,get:function(){return W.hasSendDirectionality}}),Object.defineProperty(B,"hasReceiveDirectionality",{enumerable:!0,get:function(){return W.hasReceiveDirectionality}})},function(F,B,G){function getStreamInformation(F){var B=[];return F.forEach((function(F){try{var G=B.find((function(B){return B.participantId===F.participantId&&B.endpointId===F.endpointId}));G||(G={participantId:F.participantId,endpointId:F.endpointId},B.push(G)),"audio"!==F.type&&"audioteleconference"!==F.type||(G.serverMuted=F.serverMuted),G[F.type]=F.direction}catch(F){B=[]}})),B}Object.defineProperty(B,"__esModule",{value:!0}),B.getStreamInformation=void 0,B.getStreamInformation=getStreamInformation},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.PictureInPictureWindowContainer=void 0;var Q=G(8),Y=G(6),$=100,X=4e3,Z=function(F){function PictureInPictureWindowContainer(B,G){void 0===G&&(G=null);var W=F.call(this,B)||this;return W.logger=B,W.videoElement=G,W.pictureInPictureWindow=null,W.isActive=!1,W.onEnter=function(){W.setActive(!0)},W.onLeave=function(){W.setActive(!1)},W.onResize=(0,Q.debounce)((function(){return W.raiseOnResize()}),$,{leading:!0,trailing:!0}),W.videoElement||(W.videoElement=document.createElement("video"),W.videoElement.autoplay=!0),W.videoElement.addEventListener("enterpictureinpicture",W.onEnter),W.videoElement.addEventListener("leavepictureinpicture",W.onLeave),W}return z(PictureInPictureWindowContainer,F),Object.defineProperty(PictureInPictureWindowContainer.prototype,"width",{get:function(){var F;return null===(F=this.pictureInPictureWindow)||void 0===F?void 0:F.width},enumerable:!1,configurable:!0}),Object.defineProperty(PictureInPictureWindowContainer.prototype,"height",{get:function(){var F;return null===(F=this.pictureInPictureWindow)||void 0===F?void 0:F.height},enumerable:!1,configurable:!0}),PictureInPictureWindowContainer.prototype.setVideoSource=function(F){this.videoElement.srcObject=F},PictureInPictureWindowContainer.prototype.start=function(){return K(this,void 0,void 0,(function(){var F,B,G=this;return J(this,(function(W){switch(W.label){case 0:return this.isAvailableForUse()?[4,new Promise((function(B,W){var z=window.setTimeout((function(){return K(G,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.logger.warn("Waited too long for video metadata to be ready. Aborting."),[4,this.stop()];case 1:return F.sent(),W("Waited too long for video metadata to be ready."),[2]}}))}))}),X);F=function(){window.clearTimeout(z),B()},G.videoElement.addEventListener("loadedmetadata",F)})).finally((function(){var B;null===(B=G.videoElement)||void 0===B||B.removeEventListener("loadedmetadata",F)}))]:(this.logger.info("Browser PiP busy."),[2]);case 1:return W.sent(),B=this,[4,this.videoElement.requestPictureInPicture()];case 2:return B.pictureInPictureWindow=W.sent(),this.pictureInPictureWindow.addEventListener("resize",this.onResize),this.onResize(),[2]}}))}))},PictureInPictureWindowContainer.prototype.stop=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.isActive?(this.pictureInPictureWindow&&(this.pictureInPictureWindow.removeEventListener("resize",this.onResize),this.pictureInPictureWindow=null),document.pictureInPictureElement?[4,document.exitPictureInPicture()]:[3,2]):(this.logger.info("PiP currently inactive, skipping stop operation"),[2]);case 1:return F.sent(),this.videoElement.srcObject=null,[3,3];case 2:this.logger.warn("No active PiP sessions found."),F.label=3;case 3:return[2]}}))}))},PictureInPictureWindowContainer.prototype.dispose=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.isActive?[4,this.stop()]:[3,2];case 1:F.sent(),F.label=2;case 2:return this.videoElement&&(this.videoElement.removeEventListener("enterpictureinpicture",this.onEnter),this.videoElement.removeEventListener("leavepictureinpicture",this.onLeave),this.videoElement=null),[2]}}))}))},PictureInPictureWindowContainer.prototype.setActive=function(F){this.isActive=F,this.event("onActiveStateChanged").raise(F)},PictureInPictureWindowContainer.prototype.raiseOnResize=function(){var F={width:this.width,height:this.height};this.event("onResize").raise(F)},PictureInPictureWindowContainer.prototype.isAvailableForUse=function(){return!document.pictureInPictureElement||(this.logger.info("Browser PictureInPicture busy/already in use."),!1)},PictureInPictureWindowContainer}(Y.default);B.PictureInPictureWindowContainer=Z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.PictureInPictureStreamProvider=void 0;var Y=G(8),$=G(6),X="#000",Z=3e3,ee=function(F){function PictureInPictureStreamProvider(B,G){var W=F.call(this,B)||this;return W.logger=B,W.call=G,W.isStarted=!1,W.callSubscriptions=[],W.fallbackStreamSize={width:1,height:1},W.onParticipantUpdated=function(F){return K(W,void 0,void 0,(function(){var B,G,W,z,K,Q,Y,$,X,Z;return J(this,(function(J){switch(J.label){case 0:return B=!(null===(Y=this.currentActiveStream)||void 0===Y?void 0:Y.participant),G=(null===(X=null===($=this.currentActiveStream)||void 0===$?void 0:$.participant)||void 0===X?void 0:X.id)===F.id,W=F.streams[1].some((function(F){return F.isAvailable})),z=F.streams[0].some((function(F){return F.isAvailable})),K=null===(null===(Z=this.currentActiveStream)||void 0===Z?void 0:Z.streamType),Q=0===this.connectedDominantSpeakers().length,B||G||W||z&&K&&Q?(this.debouncedUpdate.cancel(),[4,this.debouncedUpdate()]):[3,2];case 1:J.sent(),J.label=2;case 2:return[2]}}))}))},W.onDominantSpeakerChanged=function(){return K(W,void 0,void 0,(function(){var F;return J(this,(function(B){switch(B.label){case 0:return(null===(F=this.currentActiveStream)||void 0===F?void 0:F.participant)===this.getMostDominantSpeaker()?[3,2]:[4,this.debouncedUpdate()];case 1:B.sent(),B.label=2;case 2:return[2]}}))}))},W.debouncedUpdate=(0,Y.debounce)((function(){return W.updateCurrentActiveStream()}),Z,{leading:!0,trailing:!0}),W.createFallbackStream(),W}return z(PictureInPictureStreamProvider,F),PictureInPictureStreamProvider.prototype.start=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.isStarted?[2]:(this.isStarted=!0,this.callSubscriptions.push(this.call.on("participantUpdated",this.onParticipantUpdated),this.call.on("dominantSpeakerChanged",this.onDominantSpeakerChanged)),this.debouncedUpdate.cancel(),[4,this.debouncedUpdate()]);case 1:return F.sent(),[2]}}))}))},PictureInPictureStreamProvider.prototype.stop=function(){this.debouncedUpdate.cancel(),this.callSubscriptions.forEach((function(F){null==F||F.dispose()})),this.callSubscriptions=[],this.currentActiveStream=void 0,this.isStarted=!1},PictureInPictureStreamProvider.prototype.setFallbackStreamProvider=function(F){this.fallbackStreamProvider=F,this.currentActiveStream&&this.fallbackStreamProvider&&this.fallbackStreamProvider(this.currentActiveStream.participant,this.fallbackStreamCanvasContext)},PictureInPictureStreamProvider.prototype.setFallbackStreamSize=function(F){var B=F.width,G=F.height;this.fallbackStreamCanvas.width=B,this.fallbackStreamCanvas.height=G,this.currentActiveStream&&this.fallbackStreamProvider&&this.fallbackStreamProvider(this.currentActiveStream.participant,this.fallbackStreamCanvasContext)},PictureInPictureStreamProvider.prototype.dispose=function(){this.stop()},PictureInPictureStreamProvider.prototype.connectedDominantSpeakers=function(){var F,B,G=this,W=null===(F=this.call.dominantSpeakerInfo)||void 0===F?void 0:F.speakerList;return null!==(B=null==W?void 0:W.filter((function(F){var B=G.getParticipantForMri(F);return 3===(null==B?void 0:B.state)})))&&void 0!==B?B:[]},PictureInPictureStreamProvider.prototype.getParticipantForMri=function(F){return this.call.participants.find((function(B){return(null==B?void 0:B.mri)===F}))},PictureInPictureStreamProvider.prototype.getScreensharingParticipant=function(){return this.call.participants.filter((function(F){return(null==F?void 0:F.streams[1]).some((function(F){return F.isAvailable}))}))[0]},PictureInPictureStreamProvider.prototype.getMostDominantSpeaker=function(){var F,B,G,W,z=null!==(W=null===(G=this.call.dominantSpeakerInfo)||void 0===G?void 0:G.speakerList)&&void 0!==W?W:[];try{for(var K=Q(z),J=K.next();!J.done;J=K.next()){var Y=J.value,$=this.getParticipantForMri(Y);if(3===(null==$?void 0:$.state))return $}}catch(B){F={error:B}}finally{try{J&&!J.done&&(B=K.return)&&B.call(K)}finally{if(F)throw F.error}}},PictureInPictureStreamProvider.prototype.getParticipantWithVideo=function(){var F,B,G=this.call.participants;try{for(var W=Q(G),z=W.next();!z.done;z=W.next()){var K=z.value;if(K.streams[0].some((function(F){return F.isAvailable})))return K}}catch(B){F={error:B}}finally{try{z&&!z.done&&(B=W.return)&&B.call(W)}finally{if(F)throw F.error}}},PictureInPictureStreamProvider.prototype.getStreamFromParticipant=function(F,B){return F.streams[B].filter((function(F){return F.isAvailable}))[0]},PictureInPictureStreamProvider.prototype.updateCurrentActiveStream=function(){var F,B,G,W,z;return K(this,void 0,void 0,(function(){var K,Q,Y,$,X,Z;return J(this,(function(J){switch(J.label){case 0:return($=this.getScreensharingParticipant())?Y=1:($=null!==(B=null!==(F=this.getMostDominantSpeaker())&&void 0!==F?F:this.getParticipantWithVideo())&&void 0!==B?B:this.call.participants.find((function(F){return 3===(null==F?void 0:F.state)})),Y=0),$?(X=this.getStreamFromParticipant($,Y))?[4,null==(Q=X.getRawStream())?void 0:Q.getMediaStream()]:[3,2]:[3,2];case 1:(Z=J.sent())&&(K=Z,Y=X.type),null==Q||Q.dispose(),Q=null,J.label=2;case 2:return K||(this.logger.info("No remote streams found to attach to PiP window"),null===(G=this.fallbackStreamProvider)||void 0===G||G.call(this,$,this.fallbackStreamCanvasContext),this.requestFallbackStreamFrame(),K=this.fallbackMediaStream,Q=null,Y=null),K===(null===(W=this.currentActiveStream)||void 0===W?void 0:W.mediaStream)&&$===(null===(z=this.currentActiveStream)||void 0===z?void 0:z.participant)?(null==Q||Q.dispose(),[2]):(this.currentActiveStream={mediaStream:K,streamType:Y,participant:$,dispose:function(){null==Q||Q.dispose()}},this.event("onCurrentActiveStreamChanged").raise(this.currentActiveStream),[2])}}))}))},PictureInPictureStreamProvider.prototype.createFallbackStream=function(){this.fallbackStreamCanvas=document.createElement("canvas"),this.fallbackStreamCanvas.width=this.fallbackStreamSize.width,this.fallbackStreamCanvas.height=this.fallbackStreamSize.height;var F=this.fallbackStreamCanvasContext=this.fallbackStreamCanvas.getContext("2d"),B=this.fallbackStreamCanvas.width,G=this.fallbackStreamCanvas.height;F.fillStyle=X,F.fillRect(0,0,B,G),this.fallbackMediaStream=this.fallbackStreamCanvas.captureStream()},PictureInPictureStreamProvider.prototype.requestFallbackStreamFrame=function(){var F,B;null===(B=null===(F=this.fallbackMediaStream)||void 0===F?void 0:F.getVideoTracks()[0])||void 0===B||B.requestFrame()},PictureInPictureStreamProvider}($.default);B.PictureInPictureStreamProvider=ee},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.OverlayTransformer=B.LetterboxToAspectRatioTransformer=B.CropToAspectRatioTransformer=B.PictureInPictureStreamPipeline=void 0;var J=G(123),Q=function(){function PictureInPictureStreamPipeline(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];this.transformers=B,this.statistics=new J.PipelineStatistics(F.config.pictureInPictureStatisticsBufferSize,B)}return PictureInPictureStreamPipeline.prototype.getTransformedStream=function(F){var B,G=null===(B=F.mediaStream.getTracks()[0])||void 0===B?void 0:B.clone(),J=new MediaStreamTrackGenerator("video"),Q=new MediaStreamTrackProcessor({track:G}).readable,Y=[],$=this.statistics;this.transformers.forEach((function(F,B){var G=new TransformStream({transform:function(G,W){return z(this,void 0,void 0,(function(){var z,J;return K(this,(function(K){switch(K.label){case 0:(z=$.transformerStats[B]).start(),K.label=1;case 1:return K.trys.push([1,3,,4]),[4,F.transform(G,W)];case 2:return K.sent(),[3,4];case 3:return J=K.sent(),$.addError(B,J.message),[3,4];case 4:return z.stop(),[2]}}))}))},start:function(G){var W;try{return Y.push(G),null===(W=F.start)||void 0===W?void 0:W.call(F,G)}catch(F){$.addError(B,F.message)}}});Q=Q.pipeThrough(G)})),Q.pipeTo(J.writable);var X=new MediaStream([J]),dispose=function(){Y.forEach((function(F){return F.terminate()})),G.stop(),J.stop(),F.dispose()};return W(W({},F),{mediaStream:X,dispose:dispose})},PictureInPictureStreamPipeline.prototype.getStats=function(){return this.statistics.getReport()},PictureInPictureStreamPipeline}();B.PictureInPictureStreamPipeline=Q;var Y=function(){function CropToAspectRatioTransformer(F){this.aspectRatio=F}return CropToAspectRatioTransformer.prototype.transform=function(F,B){var G=F.visibleRect,W=G.width,z=G.height,K=cropToAspectRatio({width:W,height:z},this.aspectRatio),J=K.width,Q=K.height,Y={x:Math.floor((W-J)/2),y:Math.floor((z-Q)/2),width:Math.floor(J),height:Math.floor(Q)},$=new VideoFrame(F,{timestamp:F.timestamp,visibleRect:Y});F.close(),B.enqueue($)},CropToAspectRatioTransformer}();B.CropToAspectRatioTransformer=Y;var $=function(){function LetterboxToAspectRatioTransformer(F){this.aspectRatio=F,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.previousWidth=0,this.previousHeight=0}return LetterboxToAspectRatioTransformer.prototype.transform=function(F,B){var G=F.visibleRect,W=G.width,z=G.height,K=G.x,J=G.y,Q=Math.max(W,z*this.aspectRatio),Y=Math.max(z,W/this.aspectRatio),$=(Q-W)/2,X=(Y-z)/2;this.canvas.width!==Q||this.canvas.height!==Y?(this.canvas.width=Q,this.canvas.height=Y):this.previousWidth===W&&this.previousHeight===z||this.resetCanvas(),this.ctx.drawImage(F,K,J,W,z,$,X,W,z);var Z=new VideoFrame(this.canvas,{timestamp:F.timestamp});F.close(),B.enqueue(Z)},LetterboxToAspectRatioTransformer.prototype.resetCanvas=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},LetterboxToAspectRatioTransformer}();B.LetterboxToAspectRatioTransformer=$;var X=function(){function OverlayTransformer(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return OverlayTransformer.prototype.setWindowSize=function(F){this.windowSize=F},OverlayTransformer.prototype.setStreamInfo=function(F,B){this.participant=F,this.streamType=B},OverlayTransformer.prototype.setOverlayProvider=function(F){this.overlayProvider=F},OverlayTransformer.prototype.transform=function(F,B){if(this.windowSize&&this.overlayProvider){var G=F.displayWidth,W=F.displayHeight,z=this.windowSize,K=z.width,J=z.height;this.canvas.width===K&&this.canvas.height===J||(this.canvas.width=K,this.canvas.height=J),this.ctx.clearRect(0,0,K,J),this.ctx.drawImage(F,0,0,G,W,0,0,K,J),this.overlayProvider(this.participant,this.streamType,this.ctx);var Q=new VideoFrame(this.canvas,{timestamp:F.timestamp});F.close(),B.enqueue(Q)}else B.enqueue(F)},OverlayTransformer}();function cropToAspectRatio(F,B){var G=F.width,W=F.height;return{width:Math.min(G,W*B),height:Math.min(W,G/B)}}B.OverlayTransformer=X},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var K=G(8),J=function(){function NoopLogger(F){var B=this;this._prefix=F,this._children=[],this._useConsoleLogger=!1,this.createChild=function(F,G){var W="function"==typeof F?"":F,z=new NoopLogger((B._prefix||"")+W);return B._children.push(z),B._useConsoleLogger&&z.useConsoleLogger(),z},this.createFnLogger=function(F,G){for(var W=[],z=2;z<arguments.length;z++)W[z-2]=arguments[z];var K="[".concat(G,"][").concat(F,"]"),J=new NoopLogger((B._prefix||"")+K);return B._children.push(J),B._useConsoleLogger&&J.useConsoleLogger(),J}}return NoopLogger.prototype.logInfo=function(){},NoopLogger.prototype.logFailure=function(){},NoopLogger.prototype.logSuccess=function(){},NoopLogger.prototype.log=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B]},NoopLogger.prototype.debug=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B]},NoopLogger.prototype.info=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B]},NoopLogger.prototype.warn=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B]},NoopLogger.prototype.error=function(){for(var F=[],B=0;B<arguments.length;B++)F[B]=arguments[B]},NoopLogger.prototype.useConsoleLogger=function(){var F=this;this._useConsoleLogger=!0;var logWithConsole=function(){for(var B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];console.info.apply(console,z([F._prefix||""],W(B),!1))};this.log=logWithConsole,this.debug=logWithConsole,this.info=logWithConsole,this.warn=logWithConsole,this.error=logWithConsole,K.each(this._children,(function(F){return F.useConsoleLogger()}))},NoopLogger}();B.default=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(18),z=function(){function Capabilities(F){var B=this;this.configProvider=F,this.window=W.default.window,this.updateCapabilityOverrides(),this.configProviderSub=F.on("configUpdated",(function(){return B.updateCapabilityOverrides()}))}return Object.defineProperty(Capabilities.prototype,"audio",{get:function(){return this.getCapability("audio")},enumerable:!1,configurable:!0}),Object.defineProperty(Capabilities.prototype,"video",{get:function(){return this.getCapability("video")},enumerable:!1,configurable:!0}),Object.defineProperty(Capabilities.prototype,"screensharing",{get:function(){return this.getCapability("screensharing")},enumerable:!1,configurable:!0}),Object.defineProperty(Capabilities.prototype,"retargeting",{get:function(){return this.getCapability("retargeting")},enumerable:!1,configurable:!0}),Capabilities.prototype.dispose=function(){this.configProviderSub&&this.configProviderSub.dispose()},Capabilities.prototype.updateCapabilityOverrides=function(){var F;this.configProvider.config.capabilities&&(F=this.configProvider.config.capabilities),this.overrides=F||{}},Capabilities.prototype.hasMediaCapture=function(){return!!this.window.navigator.getUserMedia},Capabilities.prototype.getCapability=function(F){return void 0!==this.overrides[F]?!!this.overrides[F]:this.hasMediaCapture()&&this.hasWebRtc()},Capabilities.prototype.hasWebRtc=function(){return void 0!==this.window.RTCPeerConnection},Capabilities}();B.default=z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},J=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.UFDManager=void 0;var Q=G(13),Y=function(F){function UFDManager(B,G){var W=F.call(this,B)||this;return W.logger=B,W.configProvider=G,W.eventStates=new Map,W.swMuted=!1,W.logger.safe.info("Initialized"),W}return z(UFDManager,F),UFDManager.prototype.signalEvent=function(F,B,G,W,z){void 0===G&&(G="Audio"),void 0===W&&(W=!0),void 0===z&&(z=(0,Q.generateCauseId)());var K={type:F,value:B,isLocalSource:W,mediaType:G},J=this.getEventKey(K),Y=this.eventStates.get(J);(!Y||Y.value!==B||this.configProvider.config.alwaysRaiseBadDeviceEvents&&"Good"!==B)&&(Y||"Good"!==B)&&(this.eventStates.set(J,K),this.shouldRaiseEvent(K,Y)&&(this.logger.safe.info("[".concat(z,"] Raising UFD ").concat(F," for ").concat(G,": ").concat(B)),this.event("onQualityChanged").raise(K)))},UFDManager.prototype.signalDeviceEvent=function(F,B,G){var W=UFDManager.getQualityEventType(F,G,this.configProvider);W?this.signalEvent(W,B,G):this.logger.warn("Unknown device quality event type: ".concat(F))},UFDManager.prototype.raisePendingWhitelistingUFD=function(){this.lastWhitelistingUFD&&(this.logger.safe.debug("Raising whitelisting UFD ".concat(this.lastWhitelistingUFD.type,": ").concat(this.lastWhitelistingUFD.value)),this.event("onQualityChanged").raise(this.lastWhitelistingUFD),this.cancelPendingWhitelistingUFD())},UFDManager.prototype.cancelPendingWhitelistingUFD=function(){if(this.lastWhitelistingUFD){var F=this.getEventKey(this.lastWhitelistingUFD);this.eventStates.delete(F)}this.lastWhitelistingUFD=void 0},UFDManager.prototype.setSwMute=function(F){if(this.swMuted=F,F){var B=this.eventStates.get(this.getEventKey({type:"DeviceSpeakWhileMuted",mediaType:"Audio"}));B&&"Good"!==B.value&&this.event("onQualityChanged").raise(B)}},UFDManager.prototype.applyCurrentState=function(F){var B,G;this.cancelPendingWhitelistingUFD();var W=0;try{for(var z=K(this.eventStates.values()),J=z.next();!J.done;J=z.next()){var Q=J.value;"Good"!==Q.value&&(F(Q),W++)}}catch(F){B={error:F}}finally{try{J&&!J.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}W>0&&this.logger.safe.info("Applied ".concat(W," UFDs"))},UFDManager.prototype.reset=function(){var F,B;this.logger.safe.info("Resetting UFD states");try{for(var G=K(this.eventStates.entries()),W=G.next();!W.done;W=G.next()){var z=J(W.value,2),Q=z[0],Y=z[1];UFDManager.persistent.has(Y.type)||this.eventStates.delete(Q)}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}this.lastWhitelistingUFD=void 0,this.swMuted=!1},UFDManager.prototype.getEventKey=function(F){return"".concat(F.type,":").concat(F.mediaType)},UFDManager.prototype.shouldRaiseEvent=function(F,B){return"NetworkRelaysNotReachable"===F.type?(this.lastWhitelistingUFD=F,!1):!!("DeviceSpeakWhileMuted"!==F.type||this.swMuted||"Good"===F.value&&"Good"!==(null==B?void 0:B.value))&&(!("NetworkRecvQuality"===F.type&&!this.configProvider.config.webrtcStatNetworkDetectionEnabled)&&!(this.configProvider.config.alwaysRaiseBadDeviceEvents&&!UFDManager.deviceQualityEvents.has(F.type)&&F.value===(null==B?void 0:B.value)))},UFDManager.getQualityEventType=function(F,B,G){switch(F){case 0:return"Audio"===B?"DeviceCaptureNotFunctioning":"VideoCapturerDeviceStartFailed";case 1:return"Audio"===B?"DeviceCaptureNotFunctioning":"VideoCapturerDeviceStartTimedOut";case 2:return"DeviceCaptureMute";case 3:switch(B){case"ScreenShare":return"ScreenshareRecordingDisabled";case"Audio":return G.config.enableSignalingAudioPermissionDeniedUFD?"AudioCapturePermissionDenied":"DeviceCaptureNotMuteButSilent";case"Video":return"VideoCapturePermissionDenied";default:return}default:return}},UFDManager.persistent=new Set(["ZeroCaptureDevicesEnumerated","ZeroRenderDevicesEnumerated"]),UFDManager.deviceQualityEvents=new Set(["DeviceCaptureNotFunctioning","VideoCapturerDeviceStartFailed","DeviceCaptureNotFunctioning","VideoCapturerDeviceStartTimedOut","DeviceCaptureMute","ScreenshareRecordingDisabled","DeviceCaptureNotMuteButSilent","VideoCapturePermissionDenied"]),UFDManager}(G(6).default);B.UFDManager=Y},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(8),J=G(6),Q=G(1),Y=G(10),$=G(330),X=G(27),Z=function(){function MediaSettingsImp(F){this.settings=F,this.isTransportUnbundled=!1,this.webrtcRejectedFeatures="",this.webrtcRequiredFeatures="",this._maxBandwidthInKbps=0,this._noiseSuppressionMode="Auto"}return MediaSettingsImp.prototype.setMediaConfiguration=function(F){this.maxBandwidthInKbps=Math.floor((F.maxBandwidthInBps||0)/1e3),this.isTransportUnbundled=this.settings.forceUnbundledTransport||this.settings.enableQosSupport&&(F.enableMediaQoS||!!F.mediaPortRanges),this._mediaPortRanges=F.mediaPortRanges,this.simulcastSessionEnabled=this.settings.webrtcSimulcastSessionEnabled&&(0,Y.canUseWebrtc1_0)(this.settings.checkSupportForWebrtc_1_0),this._noiseSuppressionMode=F.noiseSuppressionMode||"Auto",this.webrtcRejectedFeatures=F.enableMediaBypass?"":this.settings.webrtcRejectedFeatures,this.webrtcRequiredFeatures=F.enableMediaBypass?"":this.settings.webrtcRequiredFeatures},Object.defineProperty(MediaSettingsImp.prototype,"noiseSuppressionMode",{get:function(){return this._noiseSuppressionMode},enumerable:!1,configurable:!0}),Object.defineProperty(MediaSettingsImp.prototype,"maxBandwidthInKbps",{get:function(){return this._maxBandwidthInKbps},set:function(F){this._maxBandwidthInKbps=F,this.settings.maxBandwidthInKbps&&(this._maxBandwidthInKbps=Math.min(this.settings.maxBandwidthInKbps,this._maxBandwidthInKbps||Number.MAX_SAFE_INTEGER))},enumerable:!1,configurable:!0}),Object.defineProperty(MediaSettingsImp.prototype,"audioPortRange",{get:function(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.audioMin&&this._mediaPortRanges.audioMax)return{min:this._mediaPortRanges.audioMin,max:this._mediaPortRanges.audioMax}},enumerable:!1,configurable:!0}),Object.defineProperty(MediaSettingsImp.prototype,"videoPortRange",{get:function(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.videoMin&&this._mediaPortRanges.videoMax)return{min:this._mediaPortRanges.videoMin,max:this._mediaPortRanges.videoMax}},enumerable:!1,configurable:!0}),MediaSettingsImp}(),arrayMergeCustomizer=function(F,B){if(Array.isArray(F))return B.slice()},ee=function(F){function ConfigProvider(B,G,W){var z,J=this;return(J=F.call(this,B)||this).logger=B,J.platformCallConstraintsProvider=G,J.platformConfig=(0,$.getPlatformConfig)(),J.sessionCount=0,J.initialSettings=Q.deepClone(J.platformConfig.getInitialSettings()),J.consoleOverridesInternal={},J.uaConfig=new X.UserAgentConfig(J),J.mediaConfiguration={},W&&(J.stackSettings=Q.deepClone(W),K.mergeWith(J.initialSettings,W,arrayMergeCustomizer)),K.mergeWith(J.initialSettings,J.platformConfig.getEnforcedSettings(),arrayMergeCustomizer),J.settings=J.initialSettings,J.settingsOut=J.settings,J.mediaSettings=new Z(J.settingsOut),null===(z=J.platformCallConstraintsProvider)||void 0===z||z.changed((function(){J.updateConfigInternal(J.settings)})),J.logger.safe.info("Initialized"),J}return z(ConfigProvider,F),ConfigProvider.prototype.getConfigView=function(F){var B=F?"Multiparty":"1on1",G=K.cloneDeep(this.settingsOut);Object.keys(G).forEach((function(F){F.endsWith(B)&&(G[F.replace(B,"")]=G[F])}));var W=new Z(G);return W.setMediaConfiguration(this.mediaConfiguration),{config:G,mediaConfig:W,countryCode:this.countryCode,userAgentConfig:this.userAgentConfig}},ConfigProvider.prototype.updateConfig=function(F,B,G,W){this.etag=B||this.etag,this.configIds=G||this.configIds,this.country=W||this.country,this.event("newConfigReceived").raise(F,B,G),this.updateConfigInternal(F)},ConfigProvider.prototype.updateSessionCount=function(F){this.sessionCount=F,0===F&&this.pendingSettings&&(this.logSettings("Applying pending configuration",this.pendingSettings),this.updateConfigInternal(this.pendingSettings),this.pendingSettings=null)},Object.defineProperty(ConfigProvider.prototype,"config",{get:function(){return this.settingsOut},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,"stackConfig",{get:function(){return this.stackSettings||{}},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,"consoleOverrides",{get:function(){return this.consoleOverridesInternal},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,"defaultConfig",{get:function(){return this.initialSettings},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,"userAgentConfig",{get:function(){return this.uaConfig},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,"countryCode",{get:function(){return this.country},enumerable:!1,configurable:!0}),ConfigProvider.prototype.setMediaConfiguration=function(F){this.mediaConfiguration=F,this.mediaSettings.setMediaConfiguration(F)},Object.defineProperty(ConfigProvider.prototype,"mediaConfig",{get:function(){return this.mediaSettings},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,"ETag",{get:function(){return this.etag},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,"ecsConfigIds",{get:function(){return this.configIds},enumerable:!1,configurable:!0}),ConfigProvider.prototype.setConsoleOverrides=function(F){K.mergeWith(this.consoleOverridesInternal,F,arrayMergeCustomizer),this.updateConfigInternal(this.settings)},ConfigProvider.prototype.setConsoleOverride=function(F,B){this.consoleOverridesInternal[F]=B,this.updateConfigInternal(this.settings)},ConfigProvider.prototype.clearConsoleOverride=function(F){delete this.consoleOverridesInternal[F],this.updateConfigInternal(this.settings)},ConfigProvider.prototype.clearAllConsoleOverrides=function(){this.consoleOverridesInternal={},this.updateConfigInternal(this.settings)},ConfigProvider.prototype.updateConfigInternal=function(F){if(this.sessionCount>0)this.pendingSettings=F,this.logSettings("pendingSettings updated",F);else{if(this.settings=K.mergeWith(Q.deepClone(this.initialSettings),F,arrayMergeCustomizer),this.settingsOut=Q.deepClone(this.settings),this.settings.enablePlatformCallConstraints||this.consoleOverridesInternal.enablePlatformCallConstraints){this.consoleOverridesInternal.setConsoleOverridesBeforeCallConstraints&&K.mergeWith(this.settingsOut,this.consoleOverridesInternal,arrayMergeCustomizer);var B=this.platformCallConstraintsProvider.getSettings(this.settingsOut);this.logger.safe.info("Merging settings with platform call constraints: ".concat(Q.stringifyObject(B))),K.assign(this.settingsOut,B,arrayMergeCustomizer)}K.mergeWith(this.settingsOut,this.consoleOverridesInternal,arrayMergeCustomizer),this.event("configUpdated").raise(),this.logSettings("Settings updated",this.settingsOut)}},ConfigProvider.prototype.logSettings=function(F,B){var G=this,W={};Q.forOwn(B,(function(F,z){B[z]!==G.initialSettings[z]&&(W[z]=F)})),this.logger.safe.info("".concat(F,": ").concat(JSON.stringify(W)))},ConfigProvider}(J.default);B.default=ee},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.getPlatformConfig=void 0;var K=G(23),J=G(4),Q=G(10);function getPlatformConfig(){var F=(0,K.getBrowserInfo)();return"Safari"===F.name?new $(F):"Firefox"===F.name?new X:"Electron"===F.name?new Z:"Chromium"===F.engine?new ee(F):new Y}B.getPlatformConfig=getPlatformConfig;var Y=function(){function BaseConfig(){}return BaseConfig.prototype.getInitialSettings=function(){return{activeSpeaker:{timeToPromote:3e3},dtmf:{toneDuration:200,toneGap:100},mediaStreamHoldInterval:5e3,webrtcContributingSourcesPollingInterval:1e3,webrtcIceGatheringTimeoutMs:2e4,webrtcAllowedMediaContentType:J.default.ALLOWED_CONTENT_TYPES.SDP_NGC,webrtcMediaContentType:J.default.CONTENT_TYPE.SDP,webrtcScreensharingCapabilityMaxFS:8160,webrtcScreensharingCapabilityMaxFPS:1500,webrtcStatHwSilentDetectionDuration:5,webrtcStatHwSilentDetectionLevel:14,webrtcStatPollInterval:1e3,webrtcStatStoredRecordsNumber:60,webrtcStatNetworkDetectionDuration:10,webrtcStatNetworkDetectionHysteresis:.01,webrtcStatNetworkDetectionBadLevel:.07,webrtcStatNetworkDetectionGoodLevel:.03,webrtcMinAudioSamplesRecvForNetworkRecvQuality:48e4,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMinMultiparty:5e3,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcVideoCapabilityCheckIntervalMaxMultiparty:5500,webrtcScreensharingCapabilityCheckIntervalMin:0,webrtcScreensharingCapabilityCheckIntervalMax:0,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcMultiPartyRecvVideoMaxFS:8160,webrtcRecvVideoMaxFS:8160,webrtcCameraOpenFs:8160,webrtcMultipartyMaxScalingFs:8160,webrtcMaxScalingFs:8160,webrtcMultiPartyVideoScaling:!0,webrtcVideoScaling:!1,ovcBandwidthPerVideoReceiver:2e5,ovcSlidingWindowPercentile:.3,ovcSlidingWindowSamples:20,nonEstimatedDefaultVideoReceiversCount:4,ovcMaxCount:4,ovcIgnoreFirstSamples:10,ovcReportingTimoutMs:3e4,webrtcStatNetworkDetectionEnabled:!1,webrtcUseNewStatsApi:!0,useAudioAnalyzer:!0,webrtcVideoSubscriptionDisposeTimeout:2e3,webrtcCompareContentTypeInOffer:!0,iceServerTransport:"udp,tcp,tls",iceHostCandidateOnly:!0,iceUdpAddressType:"ip",iceTcpAddressType:"ip",renegotiationAttempts:3,reconnectTimeLimit:9e4,initialReconnectTimeLimit:0,maxReconnectDelayTime:5,waitForRelayOnReconnect:!0,relayWaitSaneTimeoutMs:25e3,reconnectOnDisconnect:!1,webrtcSpeakingWhileMutedBadDuration:3,webrtcSpeakingWhileMutedDetectionLevel:4e3,webrtcNegotiateDisabledDataModality:!1,recoverableMediaErrors:[J.default.MEDIA_ERROR.iceConnectionError,J.default.MEDIA_ERROR.noNetworkError,J.default.MEDIA_ERROR.srtpError,J.default.MEDIA_ERROR.incompatibleOffer,J.default.MEDIA_ERROR.internalError].join(","),sendCallStartupTelemetry:!0,webrtcMultiPartyRecvVideoSignaling:!0,webrtcVideoDelayThreshold:10,webrtcEndOfCallFreezeThreshold:3,webrtcSubscriptionEventLimit:300,webrtcHandleRollback:!0,losingConnectivityTimeoutMs:-1,iceCandidateFilterMDns:!0,webrtcInjectTransportCCAudio:!1,webrtcRejectedFeatures:"",webrtcRequiredFeatures:"",webrtcSimulcastSessionEnabled:!1,webrtcSimulcastStreamsCountForVideo:1,webrtcSimulcastStreamsCountForSharing:1,webrtcFmtParamListSupported:!1,webrtcNegotiatedSsrcRangeForVideo:0,webrtcNegotiatedSsrcRangeForSharing:0,webrtcNegotiatedSsrcRangeForVideoOneToOne:0,webrtcNegotiatedSsrcRangeForSharingOneToOne:0,webrtcAllowRestoreKeyframe:!1,webrtcEnabledCustomBwEstimationForVideo:!1,webrtcDisabledSenderBitrate:1e3,maxStoredPreferredResolutionCount:4,maxStoredQualityLimitationReasonEvents:30,maxStoredUFDCount:50,simulcastTelemetryLayoutsPerSession:5,simulcastTelemetryNumModalitySessions:3,simulcastTelemetryNumFMTP:10,maxSendVideoCapabilitiesReportingForVideoEnabled:!1,maxSendVideoCapabilitiesReportingForSharingEnabled:!1,maxReportedOvershootingEvents:20,permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!0,adpRequestAVLast:!0,rememberNegative:!1,persistOnDeniedError:!0},devices:{blacklist:{microphone:"stereo mix \\(",camera:"ir camera",speaker:""},overrideDefault:!1,compositeLabelMatchingThreshold:.5,piiSafeWords:["airpod","bluetooth","hands-free","stereo","wireless","citrix hdx","remote audio","vmware","built-in","integrated","internal","teams","high definition","facetime","macbook","smartaudio","front","rear","back","iphone","ipad","display","displayport","dp","hdmi","amd","nvidia","intel","analog","digital","dock","line( in| out)?","s/pdif","external","thunderbolt\\d*","usb","panoramic","desktop","capture","cable","cam","virtual","manycam","snap camera","obs","vb-audio","vaio","default","test"],pollingIntervalActive:3e3,enumerateDevicesTimeout:25e3,enumerateDevicesAfterADP:!1},useGoogPrefixAudioConstraints:!0,multiviewResolutionLimits:{1:720,2:720,3:480,4:360,more:360},multiviewResolutionLimitUpdateThrottleDelay:300,useMultiviewLimitsOnInitialRequest:!0,maxVideoFreezeTimestampsInBucket:5,webrtcSendBandwidthNotificationsEnabled:!1,webrtcSendBandwidthIgnoredUpdateLimit:6,webrtcSendBandwidthThreshold:.1,webrtcUnifiedPlanEnabled:!1,checkSupportForWebrtc_1_0:!1,webrtcLastAppliedVideoCapabilitiesCount:5,webrtcLastAppliedVideoCapabilitiesSequenceCount:5,gumRequestTimeout:2e4,videoCaptureFreezeTimeout:5e3,webrtcCloseAfterIceFailure:!0,audioBandwidthInKbps:90,videoBandwidthAllocation:.3,enableQosSupport:!1,forceUnbundledTransport:!1,allowedAudioCodecs:[],allowedVideoCodecs:[],filterCodecsInSdp:!1,subscribeToSsrcForVideo:!1,audioRendererUsePauseOnDetach:!1,audioRendererRestartOnPause:!1,preferSdesSrtp:!1,preferSdesSrtpPstn:!1,useLocalStorageForOneDs:!1,useOneDsLogger:!1,useSendBeaconSync:!1,addTelemetryReportingCallback:!1,eventsLimitInMem:200,enableCompoundKey:!1,telemetryTenants:{signaling:"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",media:"1cae5691997646c98b01d15beddae7a3-ce16e198-bc32-420f-ac64-42bb916111af-6865",realtimeMedia:"5aea257f81424f5d8574e57a50974ead-d3a768ce-590c-4595-ab85-3dd046114290-6701",tlePlayer:"2efdf03d07594586a5977c404e185186-71b046c4-f48f-4ba7-96d3-2a74b54e1d46-7326"},collectorUrl:"https://ic3.events.data.microsoft.com/OneCollector/1.0/",transmitProfileName:"REAL_TIME",transmitProfileTimings:[],waitReportStatsAtCallStop:!1,oneStreamPerDeviceType:!1,enableWebRtcInternalsLogs:!1,enableMultiViewStats:!0,webrtcBWJumpLowerLimit:1e5,webrtcBWJumpUpperLimit:3e5,webrtcBWStabilizationSlidingWindowSize:10,webrtcBWStabilizationMaxDeviation:.1,webrtcBWStabilizationMinBandwidth:1e5,maxKeyFrameTimestampsInBucket:5,enableAudioSharing:!1,enableDevtoolsAPI:!1,enableDataChannel:!1,enableDataChannelPstn:!1,alwaysNegotiateDataChannel:!1,enableGiveControl:!1,maxStoredDataChannelValues:15,localPreviewMirroringSupported:!1,enableVideoEffects:!1,useRawMediaApiForVideoEffects:!1,forceKeyFrameV2ScaleFactor:1.1,effectsTelemetryBufferSize:20,wasmdns:{pTime:10,goodPerfThreshold:8,poorPerfThreshold:10,badPerfThreshold:12,perfWindowLength:10,enableNoiseSuppression:!1,noiseSuppressionMode:"Off",backgroundMode:!1},webcv:{qualityConfig:{outputFps:{min:15,max:30},outputResolution:720,preserveResolution:!0,degradationLadder:[{resolution:{width:1920,height:1080},fps:{min:15,max:30}},{resolution:{width:1280,height:720},fps:{min:15,max:30}},{resolution:{width:960,height:540},fps:{min:15,max:30}},{resolution:{width:852,height:480},fps:{min:15,max:30}},{resolution:{width:640,height:360},fps:{min:15,max:30}},{resolution:{width:480,height:270},fps:{min:10,max:15}},{resolution:{width:426,height:240},fps:{min:10,max:15}},{resolution:{width:320,height:180},fps:{min:10,max:15}}],initialLadderResolution:360,improvementFpsThresholdPercent:20,statsIntervalSec:5,enableMaskPropagation:!1,maskPropagationFramesInterval:30},powerPreference:"default",useInsertableStreams:!1,webGLUnsupportedRenderers:["Google SwiftShader"],webGLRequiredExtensions:["EXT_color_buffer_float","WEBGL_debug_renderer_info","OES_texture_float_linear"],usePreheat:!0,useSharedArrayBuffer:!0,useWasmEffects:!1,processorType:"Webgl2"},insertFakeCandidateIfNeeded:!0,useSdpCapabilities:!0,enableH264SpsPpsIdrKeyframe:!0,enableReconnectChrome:!0,enableReconnectEdge:!0,disableMsSdp:!1,disableSdes:!1,disableIceReinvite:!1,iceDisconnectedTimeoutMs:3e4,enableLocalVideoConstraints:!0,webrtcAudioChannelSignalingFeedback:"app recv:dsh",webrtcVideoChannelSignalingFeedback:"app send:src recv:src,vc",webrtcResolutionManagerCooldownTimeout:15e3,webrtcResolutionManagerRetryDelay:5e3,webrtcNativeCpuOveruseDisabled:!1,webrtcDisplayStreamContentHint:"text",h264SendProfileOverride:"42C02A",addFmtpToInitialSubscription:!0,h264SubscribeProfile:"64001f",notRenderingTimeInterval:{video:3,sharing:10},notRenderingLowBitrateThreshold:6,isBytesRecvUsedInIsRenderingCalculation:!0,useConnectionState:!0,useDtlsTrasportConnectionCheck:!1,enableNetworkRecvQualityUFD:!0,enableNetworkSendQualityUFD:!0,enableSignalingAudioPermissionDeniedUFD:!1,webrtcJitterLowThreshold:.2,webrtcJitterHighThreshold:.35,webrtcJitterSticknessTime:5e3,webrtcLossRateLowThreshold:.03,webrtcLossRateHighThreshold:.1,webrtcLossRateSticknessTime:5e3,webrtcMinPacketsSentForNetworkSendQuality:200,webrtcLossRateWindowSize:3,webrtcJitterWindowSize:3,isStreamingMatchIsRendering:!0,freezeMinDuration:128,freezeIntervalFrequency:1e3,minPacketsReceivedToCalculatePacketLossRate:100,healedRatioPrecision:8,requestNewStreamOnUnmute:!0,raiseVideoMuteUfd:!1,useMediaQualityController:!1,useMediaQualityControllerForceKeyFrame:!1,layoutControlTimeout:1e4,extmapAllowMixed:!1,enableVla:!1,allowRemoteVla:!1,enableNonAdvVla:!1,specCompliantSimulcast:{video:{enableLocally:!1,allowEnableRemotely:!1,layerScaleFactors:[1]},sharing:{enableLocally:!1,allowEnableRemotely:!1,layerScaleFactors:[1]},allowOverride:!1},enforceOpusFmtpMultiparty:{usedtx:1},videoIsRenderingCheck:!1,fixSdpForPartialIceRestart:!1,mapSsrcToTrackForStats:!1,enableVideoOrientationExtension:!1,speakerGainLevel:0,ignoreClosedDtlsTransportState:!1,disconnectOnPageHide:!1,renderThroughCanvas:!1,isRenderingBasedOnRawStatistics:!1,enableDevicePixelRatio:!0,useSetParametersToApplyCapabilities:!1,enablePlatformCallConstraints:!1,setParametersMaxBitrateUndefined:!1,onAddTrackRemoveOtherTracks:!0,avoidFakeStreamsDuringEscalation:!0,navConnectionPollingInterval:1e3,navConnectionNumSamplesToCollect:60,allowProvisionalAnswer:!1,allowProvisionalAnswerPstn:!1,disableIncomingDtlsRoleOverride:!1,disableOutgoingDtlsRoleOverride:!1,statsAllowAnyVideoSendTrack:!1,enablePictureInPicture:!1,pictureInPictureStatisticsBufferSize:20,showStatsInCall:!1,useSetStreamsForSender:!0,addPrefixForMsidInSdp:!1,enableMuteSpeakerUnmuteSpeakerWorkaround:!1,alwaysRaiseBadDeviceEvents:!1,removeRecvStreamOnEnded:!1,requiredVideoCodecs:["h264"],enableActiveSpeakerBasedDSH:!1,enableInitialSignalingDSHSubscription:!0,emptyInitialDSH:!0,diagnostics:{sideBySide:!1,useForTelemetry:!1,collectionLimits:{numDeviceEvents:300,numVideoEffectsEvents:100,numAudioEffectsEvents:100,numOvershootEvents:100,numIsRenderingEvents:100,numStatsReports:600,numStatsErrors:100,numSubscriptionEvents:200,numMultiViewStats:50,numUFDs:200,numNativeSessions:10,numSessions:10,numCapabilitiesRequested:60,numCapabilitiesApplied:60},telemetryLimits:{numDeviceEvents:50,numVideoEffectsEvents:50,numAudioEffectsEvents:50,numOvershootEvents:20,numIsRenderingEvents:4,numPreferredResolutions:3,numSubscriptionEvents:100,numMultiViewStats:6,numUFDs:50,numAggregatedSamples:60,numStatsErrors:20,numCapabilitiesRequested:5,numCapabilitiesApplied:3},realtimeTelemetry:{pollingInterval:15}},enableReinviteless:!1,requireUserActionForAudioSharing:!1,deactiveAudioSender:!1,webrtcForceSdesForS1:!1,webrctRemoveVideoModalitiesForPstn:!1,removeSendersOnConfigureModalities:!1,setBWSeed:!1,defaultBWSeed:1e5,stopCallOnAcceptFailure:!1}},BaseConfig.prototype.getEnforcedSettings=function(){return{}},BaseConfig}(),$=function(F){function SafariConfig(B){var G=F.call(this)||this;return G.browserInfo=B,G}return z(SafariConfig,F),SafariConfig.prototype.getEnforcedSettings=function(){var F={webrtcSimulcastSessionEnabled:!0,webrtcFmtParamListSupported:!0,webrtcAllowRestoreKeyframe:!0,webrtcUnifiedPlanEnabled:!0,permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!1,adpRequestAVLast:!1,rememberNegative:!1},devices:{pollingIntervalIdle:1e4},audioRendererUsePauseOnDetach:!0,audioRendererRestartOnPause:!0,subscribeToSsrcForVideo:!0,webrtcEnabledCustomBwEstimationForVideo:!1};return Q.isVersionGreaterOrEqual(this.browserInfo.version,"15.0")||(F.statsAllowAnyVideoSendTrack=!0),F},SafariConfig}(Y),X=function(F){function MozConfig(){return null!==F&&F.apply(this,arguments)||this}return z(MozConfig,F),MozConfig.prototype.getEnforcedSettings=function(){return{webrtcSimulcastSessionEnabled:!0,webrtcFmtParamListSupported:!0,webrtcAllowRestoreKeyframe:!0,webrtcUnifiedPlanEnabled:!0,webrtcEnabledCustomBwEstimationForVideo:!1,oneStreamPerDeviceType:!0,useDtlsTrasportConnectionCheck:!0,videoIsRenderingCheck:!1,fixSdpForPartialIceRestart:!0,mapSsrcToTrackForStats:!0,ignoreClosedDtlsTransportState1on1:!0,subscribeToSsrcForVideo1on1:!0,devices:{enumerateDevicesTimeout:0,pollingIntervalIdle:1e4,idlePollingOnStart:!0},webrtcInjectTransportCCAudio:!1,videoCaptureFreezeTimeout:0,filterCodecsInSdp:!0,useSetParametersToApplyCapabilities:!0,removeRecvStreamOnEnded:!0,webrtcDisabledSenderBitrate:0}},MozConfig}(Y),Z=function(F){function ElectronConfig(){return F.call(this)||this}return z(ElectronConfig,F),ElectronConfig.prototype.getEnforcedSettings=function(){return{checkSupportForWebrtc_1_0:!0,requireUserActionForAudioSharing:!0,useConnectionState:!1,webrtcSimulcastSessionEnabled:!0,webrtcAllowRestoreKeyframe:!0,webrtcUnifiedPlanEnabled:!0,useAudioAnalyzer:!1,onAddTrackRemoveOtherTracks:!1}},ElectronConfig}(Y),ee=function(F){function ChromiumConfig(B){var G=F.call(this)||this;return G.browserInfo=B,G}return z(ChromiumConfig,F),ChromiumConfig.prototype.getEnforcedSettings=function(){var F={};return Q.isVersionGreaterOrEqual(this.browserInfo.version,"74.0")&&(F.webrtcSimulcastSessionEnabled=!0,F.webrtcFmtParamListSupported=!0,F.webrtcAllowRestoreKeyframe=!0,F.enableAudioSharing=!0),Q.isVersionGreaterOrEqual(this.browserInfo.version,"93.0")&&(F.webrtcUnifiedPlanEnabled=!0),"CiscoOS"===this.browserInfo.name&&(F.waitReportStatsAtCallStop=!0),"Mobile"===this.browserInfo.formFactor&&(F.oneStreamPerDeviceType=!0,F.devices={pollingIntervalIdle:1e4}),"SamsungTV"===this.browserInfo.name&&(F.useSetParametersToApplyCapabilities=!0),F},ChromiumConfig}(Y)},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)},J=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},Q=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Y=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0});var $=G(13),X=G(17),Z=G(332),ee=G(6),te=G(79),ne=G(333),ie=G(28),re=G(334),oe=G(1),ae=G(4),se=G(10),ce=G(349),le=G(353),de=G(450),ue=G(451),pe=G(453),he=function(F){function DeviceManager(B,G,W,z,J,Q,Y,$){var X=F.call(this,B)||this;return X.logger=B,X.configProvider=G,X.diagnostics=W,X.domOverrides=z,X.ufdManager=J,X.deviceEnumerator=new ce.DeviceEnumerator(X.configProvider,X.logger.createChild("DeviceEnumerator")),X.permissionManager=new pe.PermissionManager(X.configProvider,{getMediaStream:function(F){return X.getMediaStream(K(K({},F),{withEffect:!1,withTimeout:!0,force:!1}),"permissionManager")},hasCamera:function(){return X.hasDeviceType("camera")},raiseTelemetryEvent:function(F,B){return X.raiseTelemetryEvent(F,B)},getActiveConstraints:function(){return X.mediaStreamManager.getActiveConstraints()},handlePermissionStateChange:function(){return X.handlePermissionStateChange()}},X.logger.createChild("PermissionManager")),X.activeRenderers=[],X.selectedDevices={camera:null,microphone:null,speaker:null},X.pendingDevices=null,X.streamManagerSubscriptions=[],X.streamSubscriptions=new Map,X.rendererSubscriptions=new Map,X.rawDeviceStreamManager=new Z.RawDeviceStreamManager(X.logger.createChild("RawDeviceStream"),X.raiseTelemetryEvent.bind(X)),X.customDeviceMediaStreamMap=new Map,X.clientAudioRenderers=new Map,X.permissionManager.on("onDevicesPermissionChanged",(function(){return X.event("onDevicesPermissionChanged").raise()})),X.deviceList.on("onDevicesChanged",(function(F,B){return X.onDevicesChanged(F,B)})),X.deviceSelection.on("onSelectedDevicesChanged",(function(F,B){return X.onSelectedDevicesChanged(F,B)})),X.deviceEnumerator.initialize(),X.audioManager=new de.AudioEffectManager(Y,$,X.configProvider,X.logger.createChild("AudioEffectManager")),X.audioManager.on("onAudioEffectTelemetryEvent",(function(F){var B;null===(B=X.diagnostics)||void 0===B||B.registerAudioEffectsEvent(oe.deepClone(F)),X.event("onAudioEffectsTelemetryEvent").raise(F)})),X.effectManager=new ue.VideoEffectManager(Q,X.configProvider,X.logger.createChild("EffectMgr")),X.effectManager.on("onMediaStreamUpdateRequested",(function(F){return X.onEffectAppliedOnStreamProcessor(F)})),X.effectManager.on("onVideoEffectQualityChanged",(function(F){return X.onVideoEffectsQualityEventHandler(F)})),X.effectManager.on("onVideoEffectTelementyEvent",(function(F){var B;null===(B=X.diagnostics)||void 0===B||B.registerVideoEffectsEvent(oe.deepClone(F)),X.event("onVideoEffectsTelemetryEvent").raise(F)})),X.effectManager.on("onVideoEffectApplied",(function(){X.raiseTelemetryEvent("video_effect_applied",{}),X.event("onVideoEffectApplied").raise()})),X.mediaStreamManager=new re.MediaStreamManager(X.logger.createChild("MediaStreamManager"),X,X.configProvider,X.effectManager,X.audioManager),X.subscribeOnStreamManagerEvents(),X.subscribeOnDeviceEnumeratorEvents(),X}return z(DeviceManager,F),Object.defineProperty(DeviceManager.prototype,"devices",{get:function(){return this.deviceList.devices},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,"deviceList",{get:function(){return this.deviceEnumerator.list},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,"deviceSelection",{get:function(){return this.deviceEnumerator.selection},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,"isInitialized",{get:function(){return this.deviceEnumerator.isInitialized},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,"isAudioOutputSelectionSupported",{get:function(){return this.configProvider.userAgentConfig.isAudioOutputSelectionSupported},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,"videoEffectManager",{get:function(){return this.effectManager},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,"audioEffectManager",{get:function(){return this.audioManager},enumerable:!1,configurable:!0}),DeviceManager.prototype.createPreviewRenderer=function(F){var B=new ne.LocalVideoRenderer(F,this,this.logger.createChild("videorenderer"),this.configProvider);return this.domOverrides.onMediaElementAdded&&this.domOverrides.onMediaElementAdded(B.getVideoElement()),this.subscribeOnRendererEvents(B),B},DeviceManager.prototype.askDevicePermission=function(F){return J(this,void 0,void 0,(function(){var B,G;return Q(this,(function(W){switch(W.label){case 0:return[4,this.isInitialized.promise];case 1:return W.sent(),[4,this.permissionManager.askDevicePermission(F)];case 2:if(B=W.sent(),!this.configProvider.config.devices.enumerateDevicesAfterADP)return[3,6];W.label=3;case 3:return W.trys.push([3,5,,6]),[4,this.deviceEnumerator.enumerateDevices()];case 4:return W.sent(),[3,6];case 5:return G=W.sent(),this.logger.safe.warn("Post-ADP device enumeration failed: ".concat(oe.stringifyObject(G))),[3,6];case 6:return[2,B]}}))}))},DeviceManager.prototype.getPermissionState=function(F){return this.permissionManager.getPermissionState(F)},DeviceManager.prototype.handlePermissionStateChange=function(){this.diagnostics&&(this.diagnostics.permissionStates=this.permissionManager.knownPermissionStates),this.event("onPermissionStateChanged").raise()},DeviceManager.prototype.onMediaStreamUpdateRequested=function(F){this.updateRenderersAsync(),this.event("onStreamUpdateRequested").raise(F)},DeviceManager.prototype.createAudioRenderer=function(){var F=this,B=new te.default(this.logger.createChild("CustomAudioRenderer"),this.configProvider),G=oe.uniqueId();this.clientAudioRenderers.set(G,B);var W=B.play.bind(B),z=B.stop.bind(B);return this.raiseTelemetryEvent("custom_audio_renderer_created",this.getSelectedDevices()),{play:W,stop:z,dispose:function(){var B;null===(B=F.clientAudioRenderers.get(G))||void 0===B||B.dispose(),F.clientAudioRenderers.delete(G)},setMuted:function(F,G){return void 0===G&&(G=(0,$.generateCauseId)()),B.setMuted(F,G)},isMuted:function(){return B.muted}}},DeviceManager.prototype.createDevicesHandle=function(F,B){return new le.DevicesHandle(this.logger.createChild("DevicesHandle"),this.getMediaStream(K(K({},F),{withTimeout:!1,withEffect:!1,audioProcessingFlags:this.audioProcessingFlags,force:!1}),B))},DeviceManager.prototype.getAllowedModalities=function(){var F=oe.shallowClone(this.permissionManager.browserPermittedModalities);return this.hasDeviceType("microphone")||(F.audio=[ae.default.MEDIA_STATE.inactive,ae.default.MEDIA_STATE.receive]),this.hasDeviceType("camera")||(F.video=[ae.default.MEDIA_STATE.inactive,ae.default.MEDIA_STATE.receive]),F},DeviceManager.prototype.getRawDeviceMediaStream=function(F,B){if(!this.hasDeviceType(this.getDeviceType(F)))throw new Error("NoInputDevice");var G=this.getStreamHandlerByType(F,B);if(!G)return this.logger.safe.debug("method not found for ".concat(F)),null;var W=this.rawDeviceStreamManager.createIRawStreamClient(G,F);return this.raiseTelemetryEvent("IRawStream_client_created",F),W},DeviceManager.prototype.setRawMediaStream=function(F,B){if(!F)throw this.logger.error("Could not set ".concat(F," as to ").concat(B)),new Error("InvalidStream");this.customDeviceMediaStreamMap.set(B,F),this.onMediaStreamUpdateRequested(B),this.raiseTelemetryEvent("set_raw_outgoing_media_stream",B)},DeviceManager.prototype.unsetRawMediaStream=function(F){this.customDeviceMediaStreamMap.get(F)?(this.customDeviceMediaStreamMap.delete(F),this.onMediaStreamUpdateRequested(F),this.raiseTelemetryEvent("unset_raw_outgoing_media_stream",F)):this.logger.safe.debug("no custom stream")},DeviceManager.prototype.setVideoEffects=function(F){return J(this,void 0,void 0,(function(){return Q(this,(function(B){return[2,this.videoEffectManager.setEffectAsync(F)]}))}))},DeviceManager.prototype.getAudioStream=function(F,B,G){var W,z;return void 0===G&&(G=!1),this.getMediaStream({audio:!0,withTimeout:this.permissionManager.isPermissionKnown("microphone"),withEffect:!1,audioProcessingFlags:null!==(W=this.audioProcessingFlags)&&void 0!==W?W:this.configProvider.config.defaultAudioProcessingFlags,force:F,withOverridenStream:!G&&(null===(z=this.customDeviceMediaStreamMap.get("Audio"))||void 0===z?void 0:z.active)&&this.customDeviceMediaStreamMap.get("Audio")},B)},DeviceManager.prototype.getVideoStream=function(F,B,G){var W;return void 0===G&&(G=!1),this.getMediaStream({video:!0,withTimeout:this.permissionManager.isPermissionKnown("camera"),withEffect:!G&&this.configProvider.config.enableVideoEffects&&this.videoEffectManager.isEffectEnabled,force:F,withOverridenStream:!G&&(null===(W=this.customDeviceMediaStreamMap.get("Video"))||void 0===W?void 0:W.active)&&this.customDeviceMediaStreamMap.get("Video")},B)},DeviceManager.prototype.getDisplayStream=function(F,B,G){var W;void 0===G&&(G=!1);var z=F&&this.configProvider.config.enableAudioSharing;return this.getMediaStream({audio:z,sharing:!0,withTimeout:!1,withEffect:!1,audioProcessingFlags:z?0:void 0,force:!1,withOverridenStream:!G&&(null===(W=this.customDeviceMediaStreamMap.get("ScreenShare"))||void 0===W?void 0:W.active)&&this.customDeviceMediaStreamMap.get("ScreenShare")},B)},DeviceManager.prototype.enumerateDevicesAsync=function(){var F=this;return this.isInitialized.promise.then((function(){return F.getDeviceDescriptions(F.devices)}))},DeviceManager.prototype.getDeviceNameAsync=function(F){var B=this;return this.isInitialized.promise.then((function(){var G,W=B.devices.find((function(B){return B.guid===F})),z="";return null!==(G=null==W?void 0:W.label)&&void 0!==G?G:z}))},DeviceManager.prototype.getSpeakerDeviceDomIdAsync=function(F){var B=this;return this.isInitialized.promise.then((function(){var G,W=B.devices.find((function(B){return B.guid===F}));return null!==(G=null==W?void 0:W.deviceId)&&void 0!==G?G:""}))},DeviceManager.prototype.selectDevices=function(F){var B=this;return this.pendingDevices?(this.logger.safe.info("Overriding device selection until enumeration is complete with ".concat(JSON.stringify((0,se.scrubSelectedDevices)(this.pendingDevices)))),void(this.pendingDevices=F)):this.isInitialized.isPending?(this.logger.safe.info("Postponing device selection until enumeration is complete"),this.pendingDevices=F,void this.isInitialized.promise.then((function(){B.logger.safe.info("Performing postponed device selection");var F=B.pendingDevices;B.pendingDevices=null,B.selectDevices(F)}))):void this.deviceSelection.selectDevices(F)},DeviceManager.prototype.getSelectedDevices=function(){return this.toSelectedDevices(this.deviceSelection.selectedDevices)},DeviceManager.prototype.setAudioProcessingFlags=function(F){F!==this.audioProcessingFlags&&(this.logger.debug("Setting audio processing flags: ".concat(this.audioProcessingFlags," -> ").concat(F)),this.audioProcessingFlags=F,this.event("onStreamUpdateRequested").raise("Audio"))},DeviceManager.prototype.getOutputDeviceId=function(){var F;return null===(F=this.selectedDevices.speaker)||void 0===F?void 0:F.deviceId},DeviceManager.prototype.getDeviceDescriptions=function(F){return(F||this.devices).map((function(F){return F.toDeviceDesc()}))},DeviceManager.prototype.getDevicesCount=function(){return this.devices.reduce((function(F,B){return F[B.type]++,F}),{camera:0,speaker:0,microphone:0,compositeAudio:0})},DeviceManager.prototype.getKnownPermissionStates=function(){return J(this,void 0,void 0,(function(){return Q(this,(function(F){switch(F.label){case 0:return[4,this.permissionManager.initialize()];case 1:return F.sent(),[2,this.permissionManager.knownPermissionStates]}}))}))},DeviceManager.prototype.getLocalVideoRenderers=function(){return this.activeRenderers},DeviceManager.prototype.dispose=function(){var B,G;this.unsubscribeFromStreamManagerEvents(),this.deviceEnumerator.dispose(),this.mediaStreamManager.dispose(),null===(B=this.activeVideoEffectSub)||void 0===B||B.dispose(),null===(G=this.activeVideoStreamForEffect)||void 0===G||G.dispose(),this.disposeRawStreamAccess(),this.disposeClientAudioRenderer(),F.prototype.dispose.call(this)},DeviceManager.prototype.onEffectAppliedOnStreamProcessor=function(F){var B;return J(this,void 0,void 0,(function(){var G=this;return Q(this,(function(W){return this.configProvider.config.useRawMediaApiForVideoEffects?(this.logger.debug("Effect is processed with Raw Media API, type:".concat(F,", useRawMediaApi:").concat(this.configProvider.config.useRawMediaApiForVideoEffects)),!this.videoEffectManager.isEffectEnabled&&this.activeVideoStreamForEffect?(this.logger.debug("Effect is turned off, processed with Raw Media API"),this.activeVideoStreamForEffect.dispose(),this.activeVideoStreamForEffect=null,[2,this.unsetRawMediaStream(F)]):(this.logger.debug("IRawStream requested by onEffectAppliedOnStreamProcessor"),null!==(B=this.activeVideoStreamForEffect)&&void 0!==B||(this.activeVideoStreamForEffect=this.getRawDeviceMediaStream(F)),this.activeVideoStreamForEffect.changed((function(){return G.updateStreamVideoEffect("Video")})),[2,this.updateStreamVideoEffect("Video")])):[2,this.onMediaStreamUpdateRequested(F)]}))}))},DeviceManager.prototype.updateStreamVideoEffect=function(F){return J(this,void 0,void 0,(function(){var B,G;return Q(this,(function(W){switch(W.label){case 0:return[4,this.activeVideoStreamForEffect.getMediaStream()];case 1:return B=W.sent(),[4,this.videoEffectManager.setSourceAsync(B)];case 2:return G=W.sent(),[2,this.setRawMediaStream(G,F)]}}))}))},DeviceManager.prototype.disposeClientAudioRenderer=function(){this.clientAudioRenderers.size&&(this.clientAudioRenderers.forEach((function(F){F.dispose()})),this.clientAudioRenderers.clear(),this.raiseTelemetryEvent("custom_audio_renderer_disposed",this.getSelectedDevices()))},DeviceManager.prototype.disposeRawStreamAccess=function(){this.rawDeviceStreamManager.disposeAll(),this.rawDeviceStreamManager=null},DeviceManager.prototype.toSelectedDevices=function(F){return Object.entries(F).reduce((function(F,B){var G=Y(B,2),W=G[0],z=G[1];return z&&(F[W]=z.guid),F}),{})},DeviceManager.prototype.getStreamConstraints=function(F){return{deviceId:(null==F?void 0:F.deviceId)||void 0}},DeviceManager.prototype.hasDeviceType=function(F){return oe.values(this.devices).some((function(B){return B.type===F}))},DeviceManager.prototype.getConstraints=function(F){var B=this;if(!F.audio&&!F.video&&!F.sharing)throw new Error("requesting nothing");if(this.logger.safe.info("retrieving media stream: ".concat(JSON.stringify(F))),F.sharing)return{audio:F.audio?{deviceId:ae.default.SYSTEM_AUDIO_SOURCE_ID}:void 0,sharing:{deviceId:ae.default.DISPLAY_SOURCE_ID},withTimeout:F.withTimeout,withEffect:!1,audioProcessingFlags:F.audioProcessingFlags,force:!1,withOverridenStream:F.withOverridenStream};var G=this.selectedDevices.microphone,W=this.selectedDevices.camera,z=F.audio&&G,K=F.video&&W;if(!z&&!K)throw{type:ae.default.MEDIA_ERROR.noDeviceSelected,detail:"audio requested ".concat(F.audio,", video requested: ").concat(F.video," Devices: ").concat(JSON.stringify(this.devices.map((function(F){return JSON.stringify((0,se.scrubDevices)(F,B.configProvider.config.devices.piiSafeWords))}))))};var J=this.getStreamConstraints(G),Q=this.getStreamConstraints(W),Y=F.audioProcessingFlags;return void 0!==Y&&F.audio&&!F.video&&G&&G.capabilities&&(G.capabilities.echoCancellation&&!G.capabilities.echoCancellation.includes(!!(2&Y))&&(Y^=2),G.capabilities.autoGainControl&&!G.capabilities.autoGainControl.includes(!!(1&Y))&&(Y^=1),G.capabilities.noiseSuppression&&!G.capabilities.noiseSuppression.includes(!!(4&Y))&&(Y^=4)),Y!==F.audioProcessingFlags&&this.logger.safe.warn("Unable to fulfill processing flags ".concat(F.audioProcessingFlags,", using ").concat(Y," instead")),{audio:F.audio?J:void 0,video:F.video?Q:void 0,withTimeout:F.withTimeout,withEffect:F.withEffect,audioProcessingFlags:Y,force:F.force,withOverridenStream:F.withOverridenStream}},DeviceManager.prototype.getMediaStream=function(F,B){var G=this,W=this.getConstraints(F),z=this.mediaStreamManager.getMediaStream(W,B);return this.subscribeOnStreamEvents(z),z.start().then((function(){var B=z.hasAudio(),W=z.hasVideo();B&&G.signalDeviceGood("Audio",z.rawTrack.muted),W&&G.signalDeviceGood("Video",z.rawTrack.muted),G.permissionManager.update(F,F)})).catch((function(B){return G.handleUserMediaError(F,B)})),z},DeviceManager.prototype.signalDeviceGood=function(F,B){this.ufdManager.signalDeviceEvent(0,"Good",F),this.ufdManager.signalDeviceEvent(1,"Good",F),this.ufdManager.signalDeviceEvent(3,"Good",F),B||"Audio"!==F&&!this.configProvider.config.raiseVideoMuteUfd||this.ufdManager.signalDeviceEvent(2,"Good",F)},DeviceManager.prototype.handleUserMediaError=function(F,B){var G=this.getMediaType(F);switch(B.type){case ae.default.MEDIA_ERROR.permissionDeniedError:this.ufdManager.signalDeviceEvent(3,"Bad",G),this.configProvider.config.permissions.persistOnDeniedError&&this.refreshPermissions(F);break;case ae.default.MEDIA_ERROR.permissionDeniedBySystemError:this.ufdManager.signalDeviceEvent(3,"Bad",G);break;case ae.default.MEDIA_ERROR.sourceUnavailableError:this.ufdManager.signalDeviceEvent(0,"Bad",G);break;case ae.default.MEDIA_ERROR.mediaStreamRequestTimedOut:this.ufdManager.signalDeviceEvent(1,"Bad",G);break;default:this.logger.safe.error("getMediaStream() error: ".concat(oe.stringifyObject(B)))}},DeviceManager.prototype.refreshPermissions=function(F){var B=F.audio&&!F.video,G=!F.audio&&F.video;B?this.permissionManager.update({audio:!0},{audio:!1}):G&&this.permissionManager.update({video:!0},{video:!1})},DeviceManager.prototype.getMediaType=function(F){if(F.sharing)return"ScreenShare";if(F.video)return"Video";if(F.audio)return"Audio";throw new Error("mediaType is not defined for this constraint ".concat(JSON.stringify(F)))},DeviceManager.prototype.subscribeOnStreamEvents=function(F){var B=this,G=[];G.push(F.on("onStreamClientStarted",(function(F,G){return B.onStreamStarted(F,G)}))),G.push(F.on("onStreamClientDisposing",(function(F){return B.onStreamDisposing(F)}))),G.push(F.on("onStreamClientEnded",(function(F,G){return B.onStreamEnded(F,G)}))),G.push(F.on("onStreamClientMuted",(function(F,G){return B.onStreamMuted(F,G)}))),G.push(F.on("onStreamClientError",(function(F,G){return B.onStreamError(F,G)}))),G.push(F.on("onConstraintsToBeApplied",(function(F){return B.resetVideoEffectConstraints(F)}))),this.configProvider.config.useRawMediaApiForVideoEffects&&G.push(F.on("onStreamClientDisposed",(function(F){return B.removeVideoEffectStream(F)}))),this.streamSubscriptions.set(F,G)},DeviceManager.prototype.resetVideoEffectConstraints=function(F){var B;return J(this,void 0,void 0,(function(){var G,W;return Q(this,(function(z){switch(z.label){case 0:if(!(null==(G=F.getCurrentConstraints())?void 0:G.withEffect))return[3,4];z.label=1;case 1:return z.trys.push([1,3,,4]),[4,null===(B=this.videoEffectManager)||void 0===B?void 0:B.resetOutputConstraints(G)];case 2:return z.sent(),[3,4];case 3:return W=z.sent(),this.logger.warn("Apply constraints failed on stream with blur with error ".concat(W)),[3,4];case 4:return[2]}}))}))},DeviceManager.prototype.removeVideoEffectStream=function(F){var B,G;return J(this,void 0,void 0,(function(){var W;return Q(this,(function(z){switch(z.label){case 0:return F.getCurrentConstraints().withEffect?(this.logger.safe.info("this.activeVideoEffectSub: ".concat(this.activeVideoEffectSub," to be disposed")),null===(B=this.activeVideoEffectSub)||void 0===B||B.dispose(),[4,null===(G=this.activeVideoStreamForEffect)||void 0===G?void 0:G.getMediaStream()]):[3,2];case 1:W=z.sent(),this.videoEffectManager.removeSourceAsync(W),z.label=2;case 2:return[2]}}))}))},DeviceManager.prototype.unsubscribeFromStreamEvents=function(F){this.streamSubscriptions.has(F)&&(this.streamSubscriptions.get(F).forEach((function(F){return F.dispose()})),this.streamSubscriptions.delete(F))},DeviceManager.prototype.subscribeOnRendererEvents=function(F){var B=this,G=[];G.push(F.on("onRendererDisposed",(function(F){return B.onRendererDisposed(F)}))),G.push(F.on("onRendererStarted",(function(F){return B.onRendererStarted(F)}))),this.rendererSubscriptions.set(F,G)},DeviceManager.prototype.unsubscribeFromRendererEvents=function(F){this.rendererSubscriptions.has(F)&&(this.rendererSubscriptions.get(F).forEach((function(F){return F.dispose()})),this.rendererSubscriptions.delete(F))},DeviceManager.prototype.subscribeOnStreamManagerEvents=function(){var F=this;this.streamManagerSubscriptions=[],this.streamManagerSubscriptions.push(this.mediaStreamManager.on("onAllStreamsRemoved",(function(){return F.onAllStreamsRemoved()}))),this.streamManagerSubscriptions.push(this.mediaStreamManager.on("onStreamAcquired",(function(B,G,W,z){return F.onStreamAcquired(B,G,W,z)})))},DeviceManager.prototype.subscribeOnDeviceEnumeratorEvents=function(){var F=this;this.deviceEnumerator.on("onDeviceEnumerationfailed",(function(B){return F.raiseTelemetryEvent("enumeration_failed",{error:B})}))},DeviceManager.prototype.unsubscribeFromStreamManagerEvents=function(){this.streamManagerSubscriptions.forEach((function(F){return F.dispose()}))},DeviceManager.prototype.updateRenderersAsync=function(){return J(this,void 0,void 0,(function(){var F;return Q(this,(function(B){switch(B.label){case 0:return B.trys.push([0,2,,3]),[4,Promise.all(this.activeRenderers.map((function(F){return F.updateStreamAsync()})))];case 1:return B.sent(),this.logger.safe.info("Renderers updates finished"),[3,3];case 2:return F=B.sent(),this.logger.safe.error("Error updating renderers: ".concat(oe.stringifyObject(F))),[3,3];case 3:return[2]}}))}))},DeviceManager.prototype.onSelectedDevicesChanged=function(F,B){var G,W=this,z=this.selectedDevices;if(this.selectedDevices=F,null===(G=this.diagnostics)||void 0===G||G.setSelectedDevices(F,B),!("camera"in z^"camera"in this.selectedDevices||"microphone"in z^"microphone"in this.selectedDevices)){var K=this.toSelectedDevices(this.selectedDevices),J=this.toSelectedDevices(z);this.event("onSelectedDevicesChanged").raise(K,J),K.microphone!==J.microphone&&this.rawDeviceStreamManager.notifyChange("Audio"),K.camera!==J.camera&&this.rawDeviceStreamManager.notifyChange("Video"),this.clientAudioRenderers.forEach((function(F){F.setOutputDevice(W.getOutputDeviceId())}))}var Q=this.configProvider.config.devices.piiSafeWords;this.raiseTelemetryEvent("selected_devices_changed",{microphone:this.selectedDevices.microphone&&oe.scrubDeviceLabelPii(this.selectedDevices.microphone.label,Q),camera:this.selectedDevices.camera&&oe.scrubDeviceLabelPii(this.selectedDevices.camera.label,Q),speaker:this.selectedDevices.speaker&&oe.scrubDeviceLabelPii(this.selectedDevices.speaker.label,Q),fromInterface:B}),this.updateRenderersAsync()},DeviceManager.prototype.onDevicesChanged=function(F,B){var G,W=this;this.event("onDevicesChanged").raise(F),null===(G=this.diagnostics)||void 0===G||G.setDeviceList(F,B,this.deviceEnumerator.list.debugInfo);var z=this.getDevicesCount();this.ufdManager.signalEvent("ZeroCaptureDevicesEnumerated",z.microphone>0?"Good":"Bad"),this.isAudioOutputSelectionSupported&&this.ufdManager.signalEvent("ZeroRenderDevicesEnumerated",z.speaker>0?"Good":"Bad");var K=new Map,J=1;this.raiseTelemetryEvent("devices_changed",{devices:F.map((function(F){var B=K.get(F.groupId)||J++;return K.set(F.groupId,B),{label:oe.scrubDeviceLabelPii(F.label,W.configProvider.config.devices.piiSafeWords),isSystemDefault:F.isSystemDefault,kind:F.kind,type:F.type,capabilities:F.capabilities,groupId:"".concat(B)}})),debug:this.deviceList.debugInfo})},DeviceManager.prototype.getDeviceListDebugInfo=function(){return this.deviceList.debugInfo},Object.defineProperty(DeviceManager.prototype,"isPollingInProgress",{get:function(){return this.deviceEnumerator.isPollingInProgress},enumerable:!1,configurable:!0}),DeviceManager.prototype.raiseTelemetryEvent=function(F,B){var G;this.logger.safe.info("Device event: ".concat(F,": ").concat(JSON.stringify(this.scrubPayload(F,B))));var W={eventType:F,timestamp:Date.now(),payload:B};null===(G=this.diagnostics)||void 0===G||G.registerDeviceTelemetryEvent(oe.deepClone(W)),this.event("onDeviceTelemetryEvent").raise(W)},DeviceManager.prototype.scrubPayload=function(F,B){var G=this;if("devices_changed"===F){var W=B;return{devices:oe.values(W.devices).map((function(F){return(0,se.scrubDevices)(F,G.configProvider.config.devices.piiSafeWords)})),debug:B.debug}}return B},DeviceManager.prototype.onStreamStarted=function(F,B){return J(this,void 0,void 0,(function(){var G;return Q(this,(function(W){switch(W.label){case 0:if(!this.permissionManager.browserPermittedModalities.audio.some((function(F){return F===ae.default.MEDIA_STATE.send}))&&!this.permissionManager.browserPermittedModalities.video.some((function(F){return F===ae.default.MEDIA_STATE.send})))return[3,4];W.label=1;case 1:return W.trys.push([1,3,,4]),[4,this.deviceEnumerator.enumerateDevices()];case 2:return W.sent(),[3,4];case 3:return G=W.sent(),this.logger.safe.warn("onStreamStarted device enumeration failed: ".concat(oe.stringifyObject(G))),[3,4];case 4:if(!F.rawTrack)return this.logger.safe.warn("stream:".concat(F.id," is already disposed")),[2];switch(F.mediaType){case"Audio":this.deviceEnumerator.startDevicePolling(),this.updateActiveMicrophone(F,B);break;case"Video":this.deviceEnumerator.startDevicePolling(),this.notifyMaxVideoSendCapabilitiesChanged(F);break;case"ScreenShare":this.notifyMaxVideoSendCapabilitiesChanged(F)}return this.configProvider.config.useRawMediaApiForVideoEffects&&F.getCurrentConstraints().withEffect&&(this.activeVideoEffectSub=this.videoEffectManager.on("onVideoStreamQualityChanged",(function(B,G){return F.onVideoStreamQualityChanged(B,G)}))),[2]}}))}))},DeviceManager.prototype.updateActiveMicrophone=function(F,B){var G=this;if(F.deviceId){var W=this.devices.find((function(B){return B.deviceId===F.deviceId}));if(!W&&"default"!==F.deviceId)return void this.logger.safe.error("Active device not found","Device id from track: '".concat(X.scrubMriOrOmit(F.deviceId),"', known devices: [").concat(this.devices.map((function(F){return JSON.stringify((0,se.scrubDevices)(F,G.configProvider.config.devices.piiSafeWords))})),"]}"),JSON.stringify((0,se.scrubConstraints)(B)));W&&"default"!==F.deviceId&&B.audio&&B.audio.deviceId===ae.default.MEDIA_DEVICE.defaultId&&this.deviceList.updateActiveMicrophone(W)}},DeviceManager.prototype.notifyMaxVideoSendCapabilitiesChanged=function(F){var B=F.getResolution(),G=new ie.ResolutionInfo(B.width,B.height),W=F.getFrameRate(),z={maxFs:G.fs,maxMbps:G.fs*W,maxFps:W,maxWidth:G.width,maxHeight:G.height};this.logger.safe.info("Capabilities for ".concat(F.mediaType," stream: ").concat(JSON.stringify(z))),this.event("onMaxVideoSendCapabilitiesChanged").raise(F.mediaType,z)},DeviceManager.prototype.onStreamDisposing=function(F){this.unsubscribeFromStreamEvents(F),this.raiseTelemetryEvent("stream_disposed",F.mediaType)},DeviceManager.prototype.onStreamMuted=function(F,B){("Audio"===F.mediaType||this.configProvider.config.raiseVideoMuteUfd)&&this.ufdManager.signalDeviceEvent(2,B?"Bad":"Good",F.mediaType),this.raiseTelemetryEvent(B?"stream_muted":"stream_unmuted",F.mediaType)},DeviceManager.prototype.onStreamEnded=function(F,B){B.error?(this.raiseTelemetryEvent("stream_ended_error",{mediaType:F.mediaType,error:{type:B.error.name,detail:B.error.message}}),"SourceUnavailableError"===B.error.name&&this.ufdManager.signalDeviceEvent(0,"Bad","Audio")):("Audio"!==F.mediaType&&"Video"!==F.mediaType||this.ufdManager.signalDeviceEvent(0,"Bad",F.mediaType),this.raiseTelemetryEvent("stream_ended",F.mediaType))},DeviceManager.prototype.onStreamError=function(F,B){this.raiseTelemetryEvent("stream_error",{mediaType:F.mediaType,error:B})},DeviceManager.prototype.onAllStreamsRemoved=function(){this.deviceEnumerator.stopDevicePolling()},DeviceManager.prototype.onStreamAcquired=function(F,B,G,W){0!==B&&this.raiseTelemetryEvent("stream_acquired",{mediaType:F,timestamp:B,resolution:G,withAudio:W})},DeviceManager.prototype.onRendererDisposed=function(F){var B,G;oe.remove(this.activeRenderers,(function(B){return B===F})),null===(G=(B=this.domOverrides).onMediaElementRemoved)||void 0===G||G.call(B,F.getVideoElement()),this.unsubscribeFromRendererEvents(F)},DeviceManager.prototype.onRendererStarted=function(F){this.activeRenderers.push(F),this.event("onLocalRendererStarted").raise(F)},DeviceManager.prototype.onVideoEffectsQualityEventHandler=function(F){var B=this.deviceSelection.selectedDevices.camera;if(null==B?void 0:B.deviceId){var G={type:"onVideoEffectQualityChanged",payload:{message:F.message,effectType:F.effectType}};this.event("onVideoEffectsEvent").raise(B.deviceId,G)}},DeviceManager.prototype.getDeviceType=function(F){return"Video"===F?"camera":"microphone"},DeviceManager.prototype.getStreamHandlerByType=function(F,B){var G=this;return"Video"===F?function(){return G.getVideoStream(!1,"rawStream",!0)}:"Audio"===F?function(){return G.getAudioStream(!1,"rawStream",!0)}:"ScreenShare"===F?function(){return G.getDisplayStream(B,"rawStream",!0)}:null},DeviceManager}(ee.default);B.default=he},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.RawDeviceStreamManager=B.RawDeviceStream=void 0;var K=G(78),J=function(){function RawDeviceStream(F,B){var G=this;this.streamClient=F,this.logger=B,this.rawBaseClient=new K.RawStreamBase((function(){return G.getStream()}),(function(){var F;return null===(F=G.activeRawInputMediaStreamClient)||void 0===F?void 0:F.dispose()}),B)}return RawDeviceStream.prototype.client=function(){return this.rawBaseClient},RawDeviceStream.prototype.disposeActiveMediaStreamClient=function(){var F;this.logger.info("Disposing active media stream client"),null===(F=this.activeRawInputMediaStreamClient)||void 0===F||F.dispose("Disposed by RawDeviceStreamManager"),this.activeRawInputMediaStreamClient=null},RawDeviceStream.prototype.getStream=function(){var F,B;return W(this,void 0,void 0,(function(){return z(this,(function(G){switch(G.label){case 0:return(null===(B=null===(F=this.activeRawInputMediaStreamClient)||void 0===F?void 0:F.originalMediaStream)||void 0===B?void 0:B.active)?(this.logger.info("Returning stream from active mediaStreamClient"),[2,this.activeRawInputMediaStreamClient.originalMediaStream]):(this.activeRawInputMediaStreamClient=this.streamClient(),[4,this.activeRawInputMediaStreamClient.start()]);case 1:return G.sent(),[2,this.activeRawInputMediaStreamClient.originalMediaStream]}}))}))},RawDeviceStream}();B.RawDeviceStream=J;var Q=function(){function RawDeviceStreamManager(F,B){this.logger=F,this.raiseTelemetryEvent=B,this.handlerMap=new Map([["Audio",new Map],["Video",new Map],["ScreenShare",new Map]])}return RawDeviceStreamManager.prototype.dispose=function(F){this.logger.info("disposing IRawStream ".concat(F)),this.handlerMap.get(F).forEach((function(F){return F.client().dispose()}))},RawDeviceStreamManager.prototype.disposeAll=function(){this.logger.info("Dispose All clients"),this.handlerMap.forEach((function(F){return F.forEach((function(F){return F.client().dispose()}))}))},RawDeviceStreamManager.prototype.notifyChange=function(F){this.handlerMap.get(F).forEach((function(F){F.disposeActiveMediaStreamClient(),F.client().notifyStreamChange()}))},RawDeviceStreamManager.prototype.createIRawStreamClient=function(F,B){this.logger.info("Create new IRawStream client for ".concat(B));var G=new J(F,this.logger);return this.handlerAdded(G,B),G.client()},RawDeviceStreamManager.prototype.handlerAdded=function(F,B){var G=F.client();this.setClientSubscription(G,B),this.handlerMap.get(B).set(G.clientId,F)},RawDeviceStreamManager.prototype.deleteRawStreamManagerById=function(F,B){this.logger.info("Deleting from map: ".concat(B)),this.handlerMap.get(B).delete(F)},RawDeviceStreamManager.prototype.setClientSubscription=function(F,B){var G=this;this.logger.info("Setting subscription on IRawStream client for ".concat(B)),F.on("clientDisposed",(function(W){G.deleteRawStreamManagerById(F.clientId,B),G.raiseTelemetryEvent("IRawStream_client_disposed",{mediaType:B,clientId:W})})),F.on("rawStreamRequested",(function(F){G.raiseTelemetryEvent("IRawStream_media_stream_changed",{mediaType:B,clientId:F})})),F.on("notifiedOnStreamChanged",(function(F){return G.raiseTelemetryEvent("IRawStream_media_stream_changed",{mediaType:B,clientId:F})}))},RawDeviceStreamManager}();B.RawDeviceStreamManager=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.LocalVideoRenderer=void 0;var Q=G(13),Y=G(33),$=G(1),X=G(125),Z=function(F){function LocalVideoRenderer(B,G,W,z){var K=F.call(this,B,W.createChild("local"))||this;return K.mediaStreamProvider=G,K.configProvider=z,K.isDisposed=!1,K.serialQueue=new Y.PromiseQueue(K.logger.createChild("rendererQueue")),K.logger.safe.info("ctor"),K.overlayStats=(0,X.createLocalRendererStatsOverlay)(K.configProvider.config.showStatsInCall,B),K}return z(LocalVideoRenderer,F),LocalVideoRenderer.prototype.dispose=function(){var B;this.logger.safe.info("dispose"),this.isDisposed=!0,this.event("onRendererDisposed").raise(this),F.prototype.dispose.call(this),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null),null===(B=this.statsSub)||void 0===B||B.dispose(),this.overlayStats.dispose()},LocalVideoRenderer.prototype.setVideoMirroring=function(F){this.configProvider.config.localPreviewMirroringSupported&&(this.getVideoElement().style.transform=F?"scaleX(-1)":void 0)},LocalVideoRenderer.prototype.startVideoAsync=function(F){var B=this;return void 0===F&&(F=(0,Q.generateCauseId)()),this.logger.safe.info("[".concat(F,"] starting local video")),this.event("onRendererStarted").raise(this),this.serialQueue.add((function(){return B.restartVideo()}),F)},LocalVideoRenderer.prototype.updateStreamAsync=function(F){var B=this;return void 0===F&&(F=(0,Q.generateCauseId)()),this.logger.safe.info("[".concat(F,"] updating local video")),this.serialQueue.add((function(){return B.restartVideo()}),F)},LocalVideoRenderer.prototype.setStatsProvider=function(F){var B,G=this;null===(B=this.statsSub)||void 0===B||B.dispose(),this.statsSub=F.on("onRawStatisticsChanged",(function(F){var B=Object.keys(F.ssrc).filter((function(B){return"video"===F.ssrc[B].mediaType&&-1!==B.indexOf("_send")})).map((function(B){return F.ssrc[B]}));B.length&&G.overlayStats.setStats(B)}))},LocalVideoRenderer.prototype.restartVideo=function(){return K(this,void 0,void 0,(function(){var F,B;return J(this,(function(G){switch(G.label){case 0:F=this.mediaStreamProvider.getVideoStream(!1,"localVideoRenderer"),G.label=1;case 1:return G.trys.push([1,3,,4]),[4,F.start()];case 2:if(G.sent(),this.isDisposed)throw F.dispose(),new Error("local video renderer is disposed");return this.attachStream(F),[3,4];case 3:throw B=G.sent(),this.mediaStreamProvider.raiseTelemetryEvent("video_preview_error",{mediaType:"Video",error:$.stringifyObject(B)}),B;case 4:return[2]}}))}))},LocalVideoRenderer.prototype.attachStream=function(B){var G;if(this.mediaStream!==B)if((null===(G=this.mediaStream)||void 0===G?void 0:G.parentId)!==(null==B?void 0:B.parentId)){this.logger.safe.info("attach media stream ".concat(null==B?void 0:B.id));try{this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null),B&&F.prototype.attachMediaStream.call(this,B.rawStream),this.mediaStream=B}catch(F){throw B&&B.dispose(),F}}else B.dispose()},LocalVideoRenderer}(G(126).VideoRendererBase);B.LocalVideoRenderer=Z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.MediaStreamManager=void 0;var J=G(6),Q=G(33),Y=G(10),$=G(27),X=G(1),Z=G(335),ee=G(345),te=function(F){function MediaStreamManager(B,G,W,z,K){var J=F.call(this,B)||this;return J.logger=B,J.deviceManager=G,J.configProvider=W,J.videoEffectManager=z,J.audioEffectManager=K,J.cachedStreamsSubs=new Map,J.cachedStreamsMap=new Map,J.mediaStreamSerialQueue=new Q.PromiseQueue(J.logger),J.couldUseWebrtc_1_0=!1,J.deviceManager.on("onDevicesChanged",(function(F){return J.onDevicesChanged(F)})),J}return z(MediaStreamManager,F),MediaStreamManager.prototype.getMediaStream=function(F,B){var G=this;this.logger.safe.info("retrieving media stream: ".concat(JSON.stringify((0,Y.scrubConstraints)(F)))),this.cachedStreamsMap.size||(this.couldUseWebrtc_1_0=(0,Y.canUseWebrtc1_0)(this.configProvider.config.checkSupportForWebrtc_1_0));var W=this.getSuitableStream(F);W||(this.logger.safe.info("cached stream is not found. Creating a new one with constraints: ".concat(X.stringifyObject((0,Y.scrubConstraints)(F)))),W=this.createCachedStream(F)),this.logger.safe.info("starting cached stream id=".concat(W.id),B);var z=W.getClient(B);return z.start().catch((function(F){G.logger.safe.error("could not start media stream: ".concat(W.id,", total streams: ").concat(G.cachedStreamsMap.size,", error: ").concat(X.stringifyObject(F))),G.removeStream(W)})),z},MediaStreamManager.prototype.dispose=function(){this.cachedStreamsSubs&&(this.cachedStreamsSubs.forEach((function(F){F.forEach((function(F){F.dispose()}))})),this.cachedStreamsSubs=null),this.cachedStreamsMap&&(this.cachedStreamsMap.forEach((function(F){return F.dispose("MSM dispose")})),this.cachedStreamsMap=null),this.mediaStreamSerialQueue&&(this.mediaStreamSerialQueue.dispose(),this.mediaStreamSerialQueue=null),F.prototype.dispose.call(this)},MediaStreamManager.prototype.getCachedStreams=function(){return this.cachedStreamsMap},MediaStreamManager.prototype.getActiveConstraints=function(){var F={audio:!1,video:!1,sharing:!1};return this.cachedStreamsMap.forEach((function(B,G){G.audio&&(F.audio=!0),G.video&&(F.video=!0),G.sharing&&(F.sharing=!0)})),F},MediaStreamManager.prototype.getSuitableStream=function(F){var B,G=this;return this.cachedStreamsMap.forEach((function(W,z){G.isSuitable(G.addDeviceIdIfNecessary(W,z),F)&&(B=z)})),B&&this.cachedStreamsMap.get(B)},MediaStreamManager.prototype.addDeviceIdIfNecessary=function(F,B){if(!F.deviceId)return B;var G=this.cloneStreamConstraints(B);return B.audio&&void 0===B.audio.deviceId&&(G.audio.deviceId=F.deviceId),B.video&&void 0===B.video.deviceId&&(G.video.deviceId=F.deviceId),G},MediaStreamManager.prototype.cloneStreamConstraints=function(F){return K(K({},X.deepClone(F)),{withOverridenStream:F.withOverridenStream})},MediaStreamManager.prototype.createCachedStream=function(F){var B=this.createStream(F);return this.subscribeOnStreamEvents(B),this.logger.safe.info("created media stream, id: ".concat(B.id," total: ").concat(this.cachedStreamsMap.size)),this.cachedStreamsMap.set(F,B),B},MediaStreamManager.prototype.disposeCurrentDeviceStream=function(F){var deviceChanged=function(F,B){return F&&B&&F.deviceId!==B.deviceId};this.cachedStreamsMap.forEach((function(B,G){F.sharing||G.sharing||!deviceChanged(F.audio,G.audio)&&!deviceChanged(F.video,G.video)||B.dispose("MSM dispose oneStreamPerDeviceType")}))},MediaStreamManager.prototype.createStream=function(F){return this.configProvider.config.oneStreamPerDeviceType&&this.disposeCurrentDeviceStream(F),this.configProvider.config.webrtcSimulcastSessionEnabled&&$.UserAgentConfig.hasApplyConstraints()&&this.couldUseWebrtc_1_0?new ee.SimulcastMediaStream(F,this.mediaStreamSerialQueue,this.configProvider,this.logger,this.videoEffectManager,this.audioEffectManager):new Z.MediaStreamInternal(F,this.mediaStreamSerialQueue,this.logger,this.configProvider)},MediaStreamManager.prototype.subscribeOnStreamEvents=function(F){var B=this,G=[];G.push(F.on("onStreamAcquired",(function(F,G,W){return B.onStreamAcquired(F,G,W)}))),G.push(F.on("onStreamDisposing",(function(F){return B.onStreamDisposing(F)}))),this.cachedStreamsSubs.set(F,G)},MediaStreamManager.prototype.unsubscribeFromStreamEvents=function(F){this.cachedStreamsSubs.get(F).forEach((function(F){return F.dispose()})),this.cachedStreamsSubs.delete(F)},MediaStreamManager.prototype.removeStream=function(F){this.logger.safe.info("release media stream generation: ".concat(F.id," cached: ").concat(this.cachedStreamsMap.size)),this.cachedStreamsSubs.has(F)?(this.unsubscribeFromStreamEvents(F),this.cachedStreamsMap.delete(this.getConstraintsForStream(F)),this.cachedStreamsMap.size||this.event("onAllStreamsRemoved").raise()):this.logger.safe.warn("skipping unknown stream ".concat(F.id))},MediaStreamManager.prototype.getConstraintsForStream=function(F){var B;return this.cachedStreamsMap.forEach((function(G,W){F===G&&(B=W)})),B},MediaStreamManager.prototype.isSuitable=function(F,B){var G,W,z=!(!F.withOverridenStream||!B.withOverridenStream),K=z||B.sharing||this.isAcceptable(F.audio,B.audio)&&F.audioProcessingFlags===B.audioProcessingFlags,J=z||this.isAcceptable(F.video,B.video),Q=this.isAcceptable(F.sharing,B.sharing),Y=F.withEffect===B.withEffect,$=(null===(G=F.withOverridenStream)||void 0===G?void 0:G.id)===(null===(W=B.withOverridenStream)||void 0===W?void 0:W.id);return!B.force&&K&&J&&Q&&Y&&$},MediaStreamManager.prototype.isAcceptable=function(F,B){return!F&&!B||F&&B&&F.deviceId===B.deviceId},MediaStreamManager.prototype.isDeviceOutdated=function(F,B){return F&&F.deviceId&&!B.some((function(B){return B.deviceId===F.deviceId}))},MediaStreamManager.prototype.onStreamDisposing=function(F){this.logger.safe.info("onStreamDisposing event ".concat(F.id)),this.removeStream(F)},MediaStreamManager.prototype.onStreamAcquired=function(F,B,G){var W="Audio"===F.mediaType?void 0:!!F.rawStream.getAudioTracks()[0];this.event("onStreamAcquired").raise(F.mediaType,B,G,W)},MediaStreamManager.prototype.onDevicesChanged=function(F){var B=this;this.cachedStreamsMap.forEach((function(G,W){if(!W.sharing){var z=B.isDeviceOutdated(W.audio,F),K=B.isDeviceOutdated(W.video,F);(z||K)&&B.cachedStreamsMap.delete(W)}}))},MediaStreamManager}(J.default);B.MediaStreamManager=te},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},Y=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.MediaStreamInternal=void 0;var $=G(6),X=G(4),Z=G(10),ee=G(38),te=G(1),ne=G(127),ie=G(131),re=G(132),oe=G(344),ae=G(81),se=function(F){function MediaStreamInternal(B,G,W,z){var K=F.call(this,W)||this;return K.streamConstraints=B,K.serialQueue=G,K.configProvider=z,K.clientId=0,K.clients=[],K.gumStreams={},K.clientGumStreams=[],K.streamsDump=[],K.isMuted=!1,K.isHold=!1,K.gumStartTime=0,K.streamId=MediaStreamInternal.streamGeneration++,K.logger=W.createChild("MediaStream:".concat(K.streamId)),K.mediaType=K.getMediaType(K.streamConstraints),K.constraintsProvider=ne.ConstraintsProviderFactory.getProvider(K.mediaType,K.configProvider,K.logger),K.currentConstraints=K.constraintsProvider.createConstraintsObject(B),K}return z(MediaStreamInternal,F),Object.defineProperty(MediaStreamInternal.prototype,"id",{get:function(){return this.streamId},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamInternal.prototype,"rawStream",{get:function(){return this.currentGumStream},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamInternal.prototype,"deviceId",{get:function(){var F,B,G,W,z,K;return null!==(K=null===(z=null===(W=null===(G=null===(B=null===(F=this.rawStream)||void 0===F?void 0:F.getTracks())||void 0===B?void 0:B[0])||void 0===G?void 0:G.getSettings)||void 0===W?void 0:W.call(G))||void 0===z?void 0:z.deviceId)&&void 0!==K?K:null},enumerable:!1,configurable:!0}),MediaStreamInternal.prototype.applyCapabilities=function(F){var B=this;if(this.currentGumStream){var G=this.constraintsProvider.updateVideoConstraints(this.currentConstraints,F,this.getResolution());if(!G)return Promise.resolve(!1);if(this.currentConstraints!==G){this.currentConstraints=G;var W=this.currentConstraints;return this.hasDisplay()?this.applyConstraints(this.currentConstraints).then((function(){return te.deepEqual(B.currentConstraints,W)})).catch((function(F){return B.logger.safe.error("Apply constraints error: ".concat(te.stringifyObject(F))),!1})):this.applyConstraintsInternal().then((function(){return te.deepEqual(B.currentConstraints,W)}))}}return Promise.resolve(!1)},MediaStreamInternal.prototype.getClient=function(){var F,B;this.currentGumStream?(B=this.getClone(),this.clientGumStreams.push(((F={})[this.constraintsProvider.getKey(this.currentConstraints)]=B,F))):this.clientGumStreams.push({});var G=new oe.MediaStreamClient(this,B,this.logger.createChild("Client:".concat(this.clientId++)));return this.clients.push(G),G},MediaStreamInternal.prototype.getClone=function(){return this.hasDisplay()?this.currentGumStream:this.currentGumStream.clone()},MediaStreamInternal.prototype.setMuted=function(F){this.isMuted=F,this.clients.forEach((function(B){B.setMuted(F)})),this.enableDisableTracks()},MediaStreamInternal.prototype.getMuted=function(){return this.isMuted},MediaStreamInternal.prototype.setHold=function(F){this.isHold=F,this.clients.forEach((function(B){B.setHold(F)})),this.enableDisableTracks()},MediaStreamInternal.prototype.start=function(){return this.mediaStreamStartPromise||(this.mediaStreamStartPromise=this.startStream(this.currentConstraints)),this.mediaStreamStartPromise},MediaStreamInternal.prototype.dispose=function(){for(var F=this.clients.length-1;F>=0;F--)this.clients[F].dispose()},MediaStreamInternal.prototype.disposeClient=function(F){var B=this.clients.indexOf(F);B>=0&&(this.clients.splice(B,1),this.streamsDump.push(this.clientGumStreams[B]),this.clientGumStreams.splice(B,1),0===this.clients.length)&&this.disposeStream()},MediaStreamInternal.prototype.disposeStream=function(){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:this.event("onStreamDisposing").raise(this),G.label=1;case 1:return G.trys.push([1,3,,4]),[4,this.stopGumStream()];case 2:return G.sent(),this.event("onStreamDisposed").raise(this),[3,4];case 3:return B=G.sent(),this.event("onStreamError").raise(this,B),[3,4];case 4:return this.constraintsProvider=null,this.serialQueue=null,this.configProvider=null,this.logger=this.logger.createChild("DISPOSED"),F.prototype.dispose.call(this),[2]}}))}))},MediaStreamInternal.prototype.hasAudio=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getAudioTracks().length},MediaStreamInternal.prototype.hasVideo=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getVideoTracks().length&&this.currentConstraints.video&&this.currentConstraints.video.deviceId!==X.default.DISPLAY_SOURCE_ID},MediaStreamInternal.prototype.hasDisplay=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getVideoTracks().length&&this.currentConstraints.video&&this.currentConstraints.video.deviceId===X.default.DISPLAY_SOURCE_ID},MediaStreamInternal.prototype.getVideoDeviceId=function(){return this.currentConstraints.video.deviceId},MediaStreamInternal.prototype.getResolution=function(){var F=this;if(!["Video","ScreenShare","PanoramicVideo"].some((function(B){return B===F.mediaType})))return null;var B={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},G=ae.getResolutionForStream(this.currentGumStream,B);return G===B?this.logger.safe.error("Stream resolution is not avalable, assuming we're at ".concat(B.width,"x").concat(B.height," now")):this.logger.safe.info("Stream resolution is ".concat(G.width,"x").concat(G.height)),G},MediaStreamInternal.prototype.getFrameRate=function(){var F=this;if(!["Video","ScreenShare","PanoramicVideo"].some((function(B){return B===F.mediaType})))return null;var B=ae.getFrameRateForStream(this.currentGumStream);return 0===B?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info("Stream fps is ".concat(B)),B},MediaStreamInternal.prototype.startStream=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:B=F.video?this.applyConstraintsInternal():this.updateGumStreamInternal(F),W.label=1;case 1:return W.trys.push([1,3,,4]),[4,B];case 2:return W.sent(),this.event("onStreamStarted").raise(this,F),[3,4];case 3:throw G=W.sent(),this.event("onStreamError").raise(this,G),G;case 4:return[2]}}))}))},MediaStreamInternal.prototype.getMediaType=function(F){if(F.sharing)return"ScreenShare";if(F.video)return"Video";if(F.audio)return"Audio";throw new Error("Media type is not defined: ".concat(JSON.stringify(F)))},MediaStreamInternal.prototype.updateClients=function(F){var B=this,G=this.constraintsProvider.getKey(F);this.clients.forEach((function(F,W){B.clientGumStreams[W][G]||(B.clientGumStreams[W][G]=B.getClone()),F.update(B.clientGumStreams[W][G])}))},MediaStreamInternal.prototype.applyConstraints=function(F){var B=this.getGumStreamProvider();return Promise.all(this.clients.map((function(G){return B.applyConstraints(G.rawStream,F)}))).then((function(){}))},MediaStreamInternal.prototype.applyConstraintsInternal=function(){var F=this;return new Promise((function(B,G){F.logger.safe.info("applying stream constraints: ".concat(JSON.stringify((0,Z.scrubConstraints)(F.currentConstraints))));var W=new ee.SettablePromise;F.clients.forEach((function(F){F.onApplyConstraints&&F.onApplyConstraints(W.promise)})),B(F.serialQueue.add((function(){var B=new ie.RequestPolicyGenerator(F.configProvider).getPolicies(F.currentConstraints);return F.mediaStreamStartPromise=F.updateGumStreamInternal(B[0]),B.slice(1).forEach((function(B){F.mediaStreamStartPromise=F.mediaStreamStartPromise.catch((function(G){if(X.default.MEDIA_ERROR.constraintNotSatisfiedError===G.type)return F.logger.safe.warn("could not obtain constrained media stream, will attempt weaker policy"),F.updateGumStreamInternal(B);throw G.constraints=B,G}))})),F.mediaStreamStartPromise})).then((function(){W.resolve()})).catch((function(B){throw F.logger.safe.error("failed to apply constraints: ".concat(JSON.stringify((0,Z.scrubConstraints)(B.constraints))," error: ").concat(te.stringifyObject(B))),W.reject(B),B})))}))},MediaStreamInternal.prototype.enableDisableTracks=function(){var F=this;this.currentGumStream&&this.currentGumStream.getTracks().forEach((function(B){void 0!==B.enabled&&(B.enabled=!("audio"===B.kind&&F.isMuted||F.isHold),F.logger.safe.info("control media stream track kind: ".concat(B.kind," enabled: ").concat(B.enabled," muted: ").concat(B.muted)))}))},MediaStreamInternal.prototype.getGumStreamProvider=function(){return re.GumStreamProviderFactory.getStreamProvider(this.mediaType,this.configProvider,this.logger.createChild("MSProvider"))},MediaStreamInternal.prototype.updateGumStreamInternal=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:return this.logger.safe.info("querying user media for stream: ".concat(JSON.stringify(F))),this.logger.safe.info("Getting GUM stream"),[4,this.getGumStream(F)];case 1:return B=W.sent(),this.logger.safe.info("Updating gum stream audio tracks"),this.updateGumStreamAudioTracks(B),this.currentGumStream=B,this.logger.safe.info("Updating stream constraints"),this.updateConstraints(F,B),this.logger.safe.info("Caching GUM stream"),this.cacheGumStream(this.currentConstraints,B),this.updateClients(this.currentConstraints),this.updateGumStreamVideoTracks(B),this.enableDisableTracks(),this.logger.safe.info("media stream updated"),G=this.stopRequestCalculation(),this.event("onStreamAcquired").raise(this,G,(this.hasVideo()||this.hasDisplay())&&this.getResolution()||void 0),[2]}}))}))},MediaStreamInternal.prototype.getGumStream=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){return(B=this.gumStreams[this.constraintsProvider.getKey(F)])?[2,B]:(G=this.getGumStreamProvider(),this.startRequestCalculation(),[2,G.getStream(F)])}))}))},MediaStreamInternal.prototype.updateGumStreamAudioTracks=function(F){var B=this;F.getAudioTracks().forEach((function(F){F.onended=function(F){var G;B.logger.safe.info("Audio stream track ended: ".concat(JSON.stringify((null===(G=F.error)||void 0===G?void 0:G.name)||F))),B.event("onStreamTrackEnded").raise(B,F)},F.onmute=function(){B.logger.safe.info("Audio stream track muted"),B.event("onStreamTrackMuted").raise(B,!0)},F.onunmute=function(){B.logger.safe.info("Audio stream track unmuted"),B.event("onStreamTrackMuted").raise(B,!1)},F.muted&&B.event("onStreamTrackMuted").raise(B,!0),B.logger.safe.info("Audio track added: ".concat(JSON.stringify(F.id)))}))},MediaStreamInternal.prototype.updateGumStreamVideoTracks=function(F){var B=this,G=Q(F.getVideoTracks(),1)[0];G&&(G.onmute=function(F){B.logger.safe.error("Video stream track muted: ".concat(JSON.stringify((0,Z.scrubConstraints)(B.currentConstraints)),"; ").concat(JSON.stringify(F)))},G.onended=function(F){B.logger.safe.info("Video stream track ended: ".concat(JSON.stringify((0,Z.scrubConstraints)(B.currentConstraints)),"; ").concat(JSON.stringify((null==F?void 0:F.error.name)||F))),B.event("onStreamTrackEnded").raise(B,F)},this.hasDisplay()&&this.configProvider.config.webrtcDisplayStreamContentHint&&this.applyContentHint(G,this.configProvider.config.webrtcDisplayStreamContentHint),this.logger.safe.info("Video track added: ".concat(JSON.stringify(G.id))))},MediaStreamInternal.prototype.cacheGumStream=function(F,B){var G=this.constraintsProvider.getKey(F);this.gumStreams[G]!==B&&(this.gumStreams[G]&&(this.logger.safe.info("Stream cache hit for ".concat(G,", stopping old stream")),this.stopOneGumStream(this.gumStreams[G])),this.gumStreams[G]=B)},MediaStreamInternal.prototype.updateConstraints=function(F,B){this.currentConstraints=F.video?this.constraintsProvider.updateResolution(F,this.getResolution()):F,this.logger.safe.info("Stream constraints updated: ".concat(JSON.stringify(this.currentConstraints)))},MediaStreamInternal.prototype.applyContentHint=function(F,B){["","text","detail","motion"].indexOf(B)<0?this.logger.safe.error("Cannot apply content hint: ".concat(B)):(this.logger.safe.info("Apply content hint: ".concat(B)),F.contentHint=B)},MediaStreamInternal.prototype.startRequestCalculation=function(){this.gumStartTime=Date.now()},MediaStreamInternal.prototype.stopRequestCalculation=function(){if(0===this.gumStartTime)return 0;var F=Date.now()-this.gumStartTime;return this.gumStartTime=0,F},MediaStreamInternal.prototype.stopGumStream=function(){var F=this;return this.mediaStreamStartPromise?(this.logger.safe.info("queueing media stream stop"),this.serialQueue.add((function(){F.stopGumStreamInternal()}))):Promise.resolve()},MediaStreamInternal.prototype.stopOneGumStream=function(F){var B=this;try{F.getTracks().forEach((function(F){B.logger.safe.info("Track is stopped: ".concat(JSON.stringify(F.id))),F.onended=null,F.onmute=null,F.stop()})),this.logger.safe.info("media stream stopped")}catch(F){this.logger.safe.warn("failed to stop media stream: ".concat(te.stringifyObject(F)))}},MediaStreamInternal.prototype.stopGumStreamInternal=function(){var F=this;this.currentGumStream&&(Y(Y(Y([],Q(this.clientGumStreams),!1),Q(this.streamsDump),!1),[this.gumStreams],!1).forEach((function(B){te.forOwn(B,(function(B){F.stopOneGumStream(B)}))})),this.gumStreams={},this.clientGumStreams=[],this.streamsDump=[],this.currentGumStream=null)},MediaStreamInternal.streamGeneration=0,MediaStreamInternal}($.default);B.MediaStreamInternal=se},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.SafariSharingConstraintsProvider=B.SharingConstraintsProvider=void 0;var J=G(128),Q=G(80),Y=G(129),$=G(337),X=G(130),Z=8160,ee=15,te=function(F){function SharingConstraintsProvider(B){var G=F.call(this,B)||this;return G.initialConstraints={maxWidth:1920,minWidth:1920,maxHeight:1080,minHeight:1080,fps:15},G.maxCapabilities={maxFs:Z,maxFps:ee},G.validator=new X.VideoCapabilitiesValidator(G.logger.createChild("CV"),G.maxCapabilities),G.constraintsCalculator=new $.SharingConstraintsCalculator(G.logger.createChild("CC")),G}return z(SharingConstraintsProvider,F),SharingConstraintsProvider.prototype.createConstraintsObject=function(F){if(!F.sharing)throw new Error("Sharing constraints are not presented: ".concat(JSON.stringify(F)));var B=this.convertConstraints(F.sharing,this.initialConstraints),G=F.audio?F.audio:null;return G&&G.deviceId&&delete G.deviceId,new Q.ConstraintsObject(G,B,!1,!1,F.withOverridenStream)},SharingConstraintsProvider.prototype.generatePolicies=function(F){return[F]},SharingConstraintsProvider.prototype.calculateConstraints=function(F,B){this.logger.safe.info("Stream resolution is ".concat(JSON.stringify(B)));var G=this.validator.ensureValidity(F);return this.constraintsCalculator.calculateConstraints(G,B)},SharingConstraintsProvider}(Y.ConstraintsProviderBase);B.SharingConstraintsProvider=te;var ne=function(F){function SafariSharingConstraintsProvider(B,G){var W,z,Q,Y,$=F.call(this,B)||this,X=G.screen.width/G.screen.height;X<1&&(W=K([$.initialConstraints.maxHeight,$.initialConstraints.maxWidth],2),$.initialConstraints.maxWidth=W[0],$.initialConstraints.maxHeight=W[1],z=K([$.initialConstraints.minHeight,$.initialConstraints.minWidth],2),$.initialConstraints.minWidth=z[0],$.initialConstraints.minHeight=z[1]);var Z=(0,J.adjustResolitionToAspectRatio)({width:$.initialConstraints.maxWidth,height:$.initialConstraints.maxHeight},X);return Q=K([Z.width,Z.height],2),$.initialConstraints.maxWidth=Q[0],$.initialConstraints.maxHeight=Q[1],Z=(0,J.adjustResolitionToAspectRatio)({width:$.initialConstraints.minWidth,height:$.initialConstraints.minHeight},X),Y=K([Z.width,Z.height],2),$.initialConstraints.minWidth=Y[0],$.initialConstraints.minHeight=Y[1],$}return z(SafariSharingConstraintsProvider,F),SafariSharingConstraintsProvider}(te);B.SafariSharingConstraintsProvider=ne},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SharingConstraintsCalculator=B.ResolutionTableCalculator=void 0;var W=G(128),z=16,K=function(){function ResolutionTableCalculator(){this.MAX_SHARING_WIDTH=1920,this.MAX_SHARING_HEIGHT=1080}return ResolutionTableCalculator.prototype.getResolutionTable=function(F,B){var G=this.constraintToMaxResolution(F,B);return this.generateResolutionTable(G)},ResolutionTableCalculator.prototype.constraintToMaxResolution=function(F,B){var G=this.getPortraitOrLandscapeMaxResolution(F),z=(0,W.adjustResolitionToAspectRatio)({width:F.width,height:F.height},B),K=G.width/z.width,J=G.height/z.height,Q=Math.min(K,J);return this.resizeResolution(z,Q)},ResolutionTableCalculator.prototype.resizeResolution=function(F,B){return{width:Math.round(F.width*B),height:Math.round(F.height*B)}},ResolutionTableCalculator.prototype.getPortraitOrLandscapeMaxResolution=function(F){return F.width>F.height?{width:this.MAX_SHARING_WIDTH,height:this.MAX_SHARING_HEIGHT}:{width:this.MAX_SHARING_HEIGHT,height:this.MAX_SHARING_WIDTH}},ResolutionTableCalculator.prototype.ceilToMackroblockSize=function(F){var B=F.width,G=F.height;return{width:Math.ceil(B/z)*z,height:Math.ceil(G/z)*z}},ResolutionTableCalculator.prototype.generateResolutionTable=function(F){var B=this;return[1,2/3,1/3,1/6].map((function(G){return B.resizeResolution(F,G)})).map((function(F){return B.ceilToMackroblockSize(F)}))},ResolutionTableCalculator}();B.ResolutionTableCalculator=K;var J=function(){function SharingConstraintsCalculator(F){this.logger=F,this.FPS_TABLE=[15,7.5,3.75,1.875],this.resolutionTableCalculator=new K,this.initialAspectRatio=null}return SharingConstraintsCalculator.prototype.calculateConstraints=function(F,B){var G=this;this.initialAspectRatio||(this.initialAspectRatio=B.width/B.height);var W=this.resolutionTableCalculator.getResolutionTable(B,this.initialAspectRatio),z={resolution:W[W.length-1],fps:this.FPS_TABLE[this.FPS_TABLE.length-1]};return W.some((function(B){var W=G.getFs(B);return G.FPS_TABLE.some((function(K){var J=G.getMbps(W,K);return W<=F.maxFs&&K<=F.maxFps&&J<=F.maxMbps&&(z={resolution:B,fps:K},!0)}))}))?this.logger.safe.info("Calculated resolution: ".concat(JSON.stringify(z))):this.logger.safe.error("None of available resolutions are suitable: ".concat(JSON.stringify(W),". Fallback to: ").concat(JSON.stringify(z))),z},SharingConstraintsCalculator.prototype.getMbps=function(F,B){return F*B},SharingConstraintsCalculator.prototype.getFs=function(F){return Math.ceil(F.width/z)*Math.ceil(F.height/z)},SharingConstraintsCalculator}();B.SharingConstraintsCalculator=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.BasicConstraintsProvider=void 0;var K=G(23),J=G(28),Q=G(80),Y=G(129),$=30,X=function(F){function BasicConstraintsProvider(B,G){var W=F.call(this,G)||this;return W.configProvider=B,W.resTable=new J.default(B.config.resolutionTableOverride),W}return z(BasicConstraintsProvider,F),BasicConstraintsProvider.prototype.createConstraintsObject=function(F){var B={},G=(0,K.getBrowserInfo)().engine;void 0!==F.audioProcessingFlags&&("Chromium"===G?(B.autoGainControl=!!(1&F.audioProcessingFlags),B.echoCancellation=!!(2&F.audioProcessingFlags),B.noiseSuppression=!!(4&F.audioProcessingFlags),this.configProvider.config.useGoogPrefixAudioConstraints&&(B.googAutoGainControl=!!(1&F.audioProcessingFlags),B.googAutoGainControl2=!!(1&F.audioProcessingFlags),B.googEchoCancellation=!!(2&F.audioProcessingFlags),B.googHighpassFilter=!!(4&F.audioProcessingFlags),B.googNoiseSuppression=!!(4&F.audioProcessingFlags),B.googTypingNoiseDetection=!!(4&F.audioProcessingFlags))):"Safari"===G||"Firefox"===G?(B.autoGainControl=!!(1&F.audioProcessingFlags),B.echoCancellation=!!(2&F.audioProcessingFlags),B.noiseSuppression=!!(4&F.audioProcessingFlags)):this.logger.warn("Unsupported browser for audio processing flags ".concat(G)));var W=this.convertConstraints(F.audio,B),z=this.convertConstraints(F.video,this.initialVideoConstraints);return new Q.ConstraintsObject(W,z,F.withTimeout,F.withEffect,F.withOverridenStream)},BasicConstraintsProvider.prototype.calculateConstraints=function(F){var B=Math.min(F.maxFs,this.configProvider.config.webrtcCameraOpenFs);return{resolution:this.resTable.getResolutionByFs(B),fps:F.maxFps}},Object.defineProperty(BasicConstraintsProvider.prototype,"initialVideoConstraints",{get:function(){var F=this.resTable.getResolutionByFs(this.configProvider.config.webrtcCameraOpenFs);return{maxWidth:F.width,minWidth:F.width,maxHeight:F.height,minHeight:F.height,fps:$}},enumerable:!1,configurable:!0}),BasicConstraintsProvider}(Y.ConstraintsProviderBase);B.BasicConstraintsProvider=X},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.UnsupportedStreamProvider=B.WebRTCDisplayStreamProvider=B.WebRTCMediaStreamProvider=void 0;var K=G(23),J=G(340),Q=G(133),Y=G(18),$=G(4),X=G(1),Z=G(341),ee=G(342),te=G(343),ne=G(10),ie=function(F){function WebRTCMediaStreamProvider(B,G){var W=F.call(this,G.createChild("WebRTCProvider"))||this;return W.configProvider=B,W.timeoutId=null,void 0!==navigator.webkitGetUserMedia&&void 0!==webkitRTCPeerConnection&&"Electron"===(0,K.getBrowserInfo)().name?W.constraintsAdapter=new Z.WebKitConstraintsAdapter:navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&(W.constraintsAdapter=new ee.WebRTCConstraintsAdapter),W}return z(WebRTCMediaStreamProvider,F),WebRTCMediaStreamProvider.prototype.getStream=function(B){var G=this;if(!B.withTimeout||!this.configProvider.config.gumRequestTimeout)return F.prototype.getStream.call(this,B);var W=this.startGumRequestTimer(B),z=F.prototype.getStream.call(this,B).then((function(F){if(!G.timeoutId)throw G.stopStreamAfterTimeout(F,B),G.getMediaStreamTimeoutError(B);return G.stopGumRequestTimer(),F}));return Promise.race([W,z]).catch((function(F){throw G.stopGumRequestTimer(),F}))},WebRTCMediaStreamProvider.prototype.getMediaStreamTimeoutError=function(F){var B={name:$.default.MEDIA_ERROR.mediaStreamRequestTimedOut,message:"Media stream request timed out. Constraints: ".concat(X.stringifyObject((0,ne.scrubConstraints)(F)))};return new Q.MediaStreamErrorDecorator(B,F).getMediaError()},WebRTCMediaStreamProvider.prototype.startGumRequestTimer=function(F){var B=this;return new Promise((function(G,W){B.timeoutId=window.setTimeout((function(){B.timeoutId=null,W(B.getMediaStreamTimeoutError(F))}),B.configProvider.config.gumRequestTimeout)}))},WebRTCMediaStreamProvider.prototype.stopGumRequestTimer=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)},WebRTCMediaStreamProvider.prototype.stopStreamAfterTimeout=function(F,B){var G=this;this.logger.safe.info("Stopping media stream acquired after timeout: ".concat(JSON.stringify(F.id)," with constraints: ").concat(JSON.stringify(B)));try{F.getTracks().forEach((function(F){G.logger.safe.info("Track is stopped: ".concat(JSON.stringify(F.id))),F.stop()})),this.logger.safe.info("Media stream stopped: ".concat(F.id))}catch(F){this.logger.safe.warn("Failed to stop media stream: ".concat(X.stringifyObject(F)))}},WebRTCMediaStreamProvider}(J.GumStreamProviderBase);B.WebRTCMediaStreamProvider=ie;var re=function(F){function WebRTCDisplayStreamProvider(B){var G=F.call(this,B.createChild("WebRTCDispProvider"))||this;return G.constraintsAdapter=new te.WebRTCDisplayConstraintsAdapter,G}return z(WebRTCDisplayStreamProvider,F),WebRTCDisplayStreamProvider.isSupported=function(){return!!window.navigator.mediaDevices.getDisplayMedia},WebRTCDisplayStreamProvider.prototype.getStream=function(F){var B=this.constraintsAdapter.toGumConstraints(F);return this.logger.safe.info("Constraints to be used: ".concat(JSON.stringify(B))),Promise.resolve().then((function(){return Y.default.window.navigator.mediaDevices.getDisplayMedia(B)})).catch((function(B){throw new Q.MediaStreamErrorDecorator(B,F).getMediaError()}))},WebRTCDisplayStreamProvider}(J.GumStreamProviderBase);B.WebRTCDisplayStreamProvider=re;var oe=function(){function UnsupportedStreamProvider(F){this.detail=F}return UnsupportedStreamProvider.prototype.getStream=function(F){throw this.getError(F)},UnsupportedStreamProvider.prototype.applyConstraints=function(F,B){throw this.getError(B)},UnsupportedStreamProvider.prototype.applyConstraintsForTrack=function(F,B){throw this.getError(B)},UnsupportedStreamProvider.prototype.getError=function(F){return{type:$.default.MEDIA_ERROR.unsupportedStream,detail:this.detail,message:this.detail,isAudio:!!F.audio}},UnsupportedStreamProvider}();B.UnsupportedStreamProvider=oe},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.GumStreamProviderBase=void 0;var W=G(10),z=G(18),K=G(133),J=function(){function GumStreamProviderBase(F){this.logger=F}return GumStreamProviderBase.isSupported=function(){return!0},GumStreamProviderBase.prototype.getStream=function(F){var B=this.constraintsAdapter.toGumConstraints(F);return this.logger.safe.info("Constraints to be applied: ".concat(JSON.stringify((0,W.scrubConstraints)(B)))),new Promise((function(F,G){z.default.window.navigator.getUserMedia(B,F,G)})).catch((function(B){throw new K.MediaStreamErrorDecorator(B,F).getMediaError()}))},GumStreamProviderBase.prototype.applyConstraints=function(F,B){if(!F||!F.getVideoTracks()||!F.getVideoTracks()[0])return Promise.reject("No video tracks found");var G=F.getVideoTracks()[0];return this.applyConstraintsForTrack(G,B)},GumStreamProviderBase.prototype.applyConstraintsForTrack=function(F,B){var G=this.constraintsAdapter.toTrackConstraints(B);return F.applyConstraints?(this.logger.safe.info("Apply constraints: ".concat(JSON.stringify(G)," on ").concat(JSON.stringify(F.id))),F.applyConstraints(G).catch((function(F){throw new K.MediaStreamErrorDecorator(F,B).getMediaError()}))):Promise.reject("track.applyConstraints() is not supported")},GumStreamProviderBase}();B.GumStreamProviderBase=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.WebKitConstraintsAdapter=void 0;var W=G(1),z=G(4),K=function(){function WebKitConstraintsAdapter(){}return WebKitConstraintsAdapter.prototype.toGumConstraints=function(F){var B={};return F.audio&&(B.audio=W.deepClone(F.audio),B.audio.deviceId&&delete B.audio.deviceId,F.audio.deviceId&&F.audio.deviceId!==z.default.MEDIA_DEVICE.defaultId&&(B.audio.deviceId=F.audio.deviceId)),F.video&&(B.video={mandatory:{}},F.video.deviceId&&(B.video.mandatory.sourceId=F.video.deviceId),F.video.minWidth&&(B.video.mandatory.minWidth=F.video.minWidth),F.video.maxWidth&&(B.video.mandatory.maxWidth=F.video.maxWidth),F.video.minHeight&&(B.video.mandatory.minHeight=F.video.minHeight),F.video.maxHeight&&(B.video.mandatory.maxHeight=F.video.maxHeight),F.video.fps&&(B.video.mandatory.maxFrameRate=F.video.fps),W.isEmpty(B.video.mandatory)&&delete B.video.mandatory),B},WebKitConstraintsAdapter.prototype.toTrackConstraints=function(F){var B={};return F.video&&(F.video.minWidth&&(B.width=F.video.minWidth),F.video.minHeight&&(B.height=F.video.minHeight),F.video.fps&&(B.frameRate=F.video.fps)),B},WebKitConstraintsAdapter}();B.WebKitConstraintsAdapter=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.WebRTCConstraintsAdapter=void 0;var W=G(1),z=G(4),K=function(){function WebRTCConstraintsAdapter(){}return WebRTCConstraintsAdapter.prototype.toGumConstraints=function(F){var B={};if(F.audio&&(B.audio=W.deepClone(F.audio),B.audio.deviceId&&delete B.audio.deviceId,F.audio.deviceId&&F.audio.deviceId!==z.default.MEDIA_DEVICE.defaultId&&(B.audio.deviceId={exact:F.audio.deviceId})),F.video)for(var G in B.video={width:{},height:{},frameRate:{}},F.video.deviceId&&(B.video.deviceId={exact:F.video.deviceId}),F.video.minWidth&&(B.video.width.min=F.video.minWidth),F.video.maxWidth&&(B.video.width.max=F.video.maxWidth),F.video.minHeight&&(B.video.height.min=F.video.minHeight),F.video.maxHeight&&(B.video.height.max=F.video.maxHeight),F.video.fps&&(B.video.frameRate.max=F.video.fps,B.video.frameRate.ideal=F.video.fps),B.video)W.isEmpty(B.video[G])&&delete B.video[G];return B},WebRTCConstraintsAdapter.prototype.toTrackConstraints=function(F){var B={};return F.video&&(F.video.minWidth&&(B.width=F.video.minWidth),F.video.minHeight&&(B.height=F.video.minHeight),F.video.fps&&(B.frameRate=F.video.fps)),B},WebRTCConstraintsAdapter}();B.WebRTCConstraintsAdapter=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.WebRTCDisplayConstraintsAdapter=void 0;var W=function(){function WebRTCDisplayConstraintsAdapter(){}return WebRTCDisplayConstraintsAdapter.prototype.toGumConstraints=function(F){if(!F||!F.video)throw new Error("constraints cannot be applied: ".concat(F));var B={video:{}};return F.video.maxWidth&&(B.video.width={max:F.video.maxWidth}),F.video.maxHeight&&(B.video.height={max:F.video.maxHeight}),F.video.fps&&(B.video.frameRate=F.video.fps),F.audio&&(B.audio=!0),B},WebRTCDisplayConstraintsAdapter.prototype.toTrackConstraints=function(F){var B=navigator.mediaDevices.getSupportedConstraints();if(!B)throw new Error("Constraints are not supported by browser");var G={};return B.width&&F.video.minWidth&&(G.width=F.video.minWidth),B.height&&F.video.minHeight&&(G.height=F.video.minHeight),B.frameRate&&F.video.fps&&(G.frameRate=F.video.fps),G},WebRTCDisplayConstraintsAdapter}();B.WebRTCDisplayConstraintsAdapter=W},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.MediaStreamClient=void 0;var K=G(13),J=function(F){function MediaStreamClient(B,G,W){var z=F.call(this,W)||this;return z.mediaStream=B,z.logger=W,z.mediaStreamSubscriptions=[],z.isHold=!1,z.isMuted=z.mediaStream.getMuted(),z.isDisposed=!1,z.originalId=B.id,z.subscribeOnMediaStreamEvents(),z.update(G),z.logger.safe.info("ctor"),z.mediaType=z.mediaStream.mediaType,z}return z(MediaStreamClient,F),Object.defineProperty(MediaStreamClient.prototype,"id",{get:function(){return this.originalId},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,"parentId",{get:function(){return this.originalId},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,"rawStream",{get:function(){return this.gumStream},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,"rawTrack",{get:function(){return this.getTrackByMediaType(this.rawStream,this.mediaType)},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,"deviceId",{get:function(){return this.mediaStream.deviceId},enumerable:!1,configurable:!0}),MediaStreamClient.prototype.update=function(F){F&&(this.gumStream=F,this.enableDisableTracks())},MediaStreamClient.prototype.dispose=function(){this.isDisposed?this.logger.safe.info("already disposed"):(this.isDisposed=!0,this.logger.safe.info("dispose"),this.logger=this.logger.createChild("DISPOSED"),this.event("onStreamClientDisposing").raise(this),this.mediaStream&&(this.mediaStream.disposeClient(this),this.unsubscribeFromMediaStreamEvents(),this.mediaStream=null),this.event("onStreamClientDisposed").raise(this))},MediaStreamClient.prototype.clone=function(){var F=this.mediaStream.getClient();return this.isMuted&&F.setMuted(!0),this.isHold&&F.setHold(!0),F},MediaStreamClient.prototype.applyCapabilities=function(F){return this.mediaStream.applyCapabilities(F)},MediaStreamClient.prototype.setMuted=function(F,B){void 0===B&&(B=(0,K.generateCauseId)()),this.isMuted=F||this.mediaStream.getMuted(),this.logger.safe.info("[".concat(B,"] setMuted => ").concat(this.isMuted)),this.enableDisableTracks()},MediaStreamClient.prototype.setHold=function(F){this.isHold=F,this.enableDisableTracks()},MediaStreamClient.prototype.start=function(){return this.mediaStream.start()},MediaStreamClient.prototype.hasAudio=function(){return this.mediaStream.hasAudio()},MediaStreamClient.prototype.hasVideo=function(){return this.mediaStream.hasVideo()},MediaStreamClient.prototype.hasDisplay=function(){return this.mediaStream.hasDisplay()},MediaStreamClient.prototype.isSameStream=function(F){return this.parentId===F.parentId},MediaStreamClient.prototype.getResolution=function(){return this.mediaStream.getResolution()},MediaStreamClient.prototype.getFrameRate=function(){return this.mediaStream.getFrameRate()},MediaStreamClient.prototype.isActive=function(){return!0},MediaStreamClient.prototype.subscribeOnMediaStreamEvents=function(){var F=this;this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamStarted",(function(B,G){F.event("onStreamClientStarted").raise(F,G)}))),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamError",(function(B,G){F.event("onStreamClientError").raise(F,G)}))),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamTrackMuted",(function(B,G){F.event("onStreamClientMuted").raise(F,G)}))),this.mediaStreamSubscriptions.push(this.mediaStream.on("onStreamTrackEnded",(function(B,G){F.event("onStreamClientEnded").raise(F,G)})))},MediaStreamClient.prototype.unsubscribeFromMediaStreamEvents=function(){this.mediaStreamSubscriptions.forEach((function(F){return F.dispose()})),this.mediaStreamSubscriptions=[]},MediaStreamClient.prototype.enableDisableTracks=function(){var F=this;this.gumStream?this.gumStream.getTracks().forEach((function(B){void 0!==B.enabled&&(B.enabled=!F.isMuted&&!F.isHold,F.logger.safe.info("Track ".concat(JSON.stringify(B.id)," enabled state set to => ").concat(B.enabled)))})):this.logger.safe.warn("gumStream stream doesn't exist")},MediaStreamClient.prototype.getTrackByMediaType=function(F,B){return"Audio"===B?F.getAudioTracks()[0]:F.getVideoTracks()[0]},MediaStreamClient}(G(6).default);B.MediaStreamClient=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.SimulcastMediaStream=void 0;var Q=G(1),Y=G(10),$=G(6),X=G(127),Z=G(132),ee=G(346),te=G(81),ne=G(348),ie=function(F){function SimulcastMediaStream(B,G,W,z,K,J){var Q=F.call(this,z)||this;return Q.serialQueue=G,Q.configProvider=W,Q.videoEffectManager=K,Q.audioEffectManager=J,Q.gumRequestTime=0,Q.id=SimulcastMediaStream.streamId++,Q.logger=z.createChild("MediaStream:".concat(Q.id)),Q.mediaType=Q.getMediaType(B),Q.initialize(B),Q}return z(SimulcastMediaStream,F),Object.defineProperty(SimulcastMediaStream.prototype,"rawStream",{get:function(){return this.mediaStream},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStream.prototype,"deviceId",{get:function(){var F,B,G,W;return this.originalMediaStream?null===(W=null===(G=null===(B=null===(F=this.originalMediaStream.getTracks())||void 0===F?void 0:F[0])||void 0===B?void 0:B.getSettings)||void 0===G?void 0:G.call(B))||void 0===W?void 0:W.deviceId:null},enumerable:!1,configurable:!0}),SimulcastMediaStream.prototype.start=function(){return this.mediaStreamStartPromise||(this.mediaStreamStartPromise=this.startStream(this.currentConstraints)),this.mediaStreamStartPromise},SimulcastMediaStream.prototype.dispose=function(B){var G=this;this.event("onStreamDisposing").raise(this),this.stopMediaStream(B).catch((function(F){G.event("onStreamError").raise(G,F)})).finally((function(){G.constraintsProvider=null,G.serialQueue=null,G.configProvider=null,G.logger=G.logger.createChild("DISPOSED"),G.clientGenerationStrategy.dispose(),G.event("onStreamDisposed").raise(G),F.prototype.dispose.call(G)}))},SimulcastMediaStream.prototype.disposeClient=function(F){this.clientGenerationStrategy.disposeClient(F)},SimulcastMediaStream.prototype.getClient=function(F){return this.logger.safe.debug("getClient: ".concat(F)),this.clientGenerationStrategy.getClient()},SimulcastMediaStream.prototype.getOriginalMediaStream=function(){return this.originalMediaStream},SimulcastMediaStream.prototype.resetEffectOutputConstraints=function(F){var B;return null===(B=this.videoEffectManager)||void 0===B?void 0:B.resetOutputConstraints(F)},SimulcastMediaStream.prototype.getResolution=function(){var F=this;if(!["Video","ScreenShare","PanoramicVideo"].some((function(B){return B===F.mediaType})))return null;var B={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},G=te.getResolutionForStream(this.mediaStream,B);return G===B?this.logger.safe.error("Stream resolution is not avalable, assuming we're at ".concat(B.width,"x").concat(B.height," now")):this.logger.safe.info("Stream resolution is ".concat(G.width,"x").concat(G.height)),G},SimulcastMediaStream.prototype.getFrameRate=function(){var F=this;if(!["Video","ScreenShare","PanoramicVideo"].some((function(B){return B===F.mediaType})))return null;var B=te.getFrameRateForStream(this.mediaStream);return 0===B?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info("Stream fps is ".concat(B)),B},SimulcastMediaStream.prototype.getMediaType=function(F){if(F.sharing)return"ScreenShare";if(F.video)return"Video";if(F.audio)return"Audio";throw new Error("Media type is not defined: ".concat(JSON.stringify(F)))},SimulcastMediaStream.prototype.initialize=function(F){var B=this;this.constraintsProvider=X.ConstraintsProviderFactory.getProvider(this.mediaType,this.configProvider,this.logger),this.currentConstraints=this.constraintsProvider.createConstraintsObject(F),this.gumStreamProvider=Z.GumStreamProviderFactory.getStreamProvider(this.mediaType,this.configProvider,this.logger),this.mediaStreamRequestStrategy=ne.RequestStrategyFactory.getStrategy(this.mediaType,this.gumStreamProvider,this.serialQueue,this.logger,this.configProvider,!!this.currentConstraints.withOverridenStream),this.clientGenerationStrategy=new ee.CloneClientGeneratorStrategy(this,this.currentConstraints,this.constraintsProvider,this.gumStreamProvider,this.logger),this.clientGenerationStrategy.on("onAllClientsDisposed",(function(){return B.onAllClientsDisposed()}))},SimulcastMediaStream.prototype.onAllClientsDisposed=function(){this.logger.safe.info("All clients are disposed, disposing master stream"),this.dispose()},SimulcastMediaStream.prototype.startStream=function(F){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:return G.trys.push([0,2,,3]),[4,this.getOrCreateMediaStream(F)];case 1:return G.sent(),this.event("onStreamStarted").raise(this,this.currentConstraints),[3,3];case 2:throw B=G.sent(),this.event("onStreamError").raise(this,B),B;case 3:return[2]}}))}))},SimulcastMediaStream.prototype.getOrCreateMediaStream=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:return this.mediaStream?[2,Promise.resolve()]:(B=this.getRequestStartTimestamp(),[4,this.mediaStreamRequestStrategy.getStream(F)]);case 1:return G=W.sent(),this.gumRequestTime=this.getRequestDuration(B),[2,this.handleMediaStreamRequestSuccess(G,F)]}}))}))},SimulcastMediaStream.prototype.handleMediaStreamRequestSuccess=function(F,B){return K(this,void 0,void 0,(function(){var G,W;return J(this,(function(z){switch(z.label){case 0:return G=B.withOverridenStream&&B.withEffect&&this.configProvider.config.useRawMediaApiForVideoEffects,this.logger.safe.info("Media stream acquired: ".concat((0,Y.printMediaStream)(F)," with constraints: ").concat(JSON.stringify((0,Y.scrubConstraints)(B)))),this.originalMediaStream=F,this.subscribeToTrackEvents(this.originalMediaStream),!B.withEffect||G?[3,2]:(W=this,[4,this.getVideoEffectStream(F)]);case 1:return W.mediaStream=z.sent(),[3,3];case 2:this.mediaStream=F,z.label=3;case 3:return"Audio"===this.mediaType?[4,this.startNoiseSuppression()]:[3,5];case 4:z.sent(),z.label=5;case 5:return this.currentConstraints=B,this.applyState(this.mediaStream),this.event("onStreamAcquired").raise(this,this.gumRequestTime,"Audio"!==this.mediaType&&this.getResolution()||void 0),[2]}}))}))},SimulcastMediaStream.prototype.getVideoEffectStream=function(F){return K(this,void 0,void 0,(function(){var B,G=this;return J(this,(function(W){switch(W.label){case 0:return this.sub=this.videoEffectManager.on("onVideoStreamQualityChanged",(function(F,B){return G.onVideoStreamQualityChanged(F,B)})),[4,this.videoEffectManager.setSourceAsync(F)];case 1:return B=W.sent(),this.logger.safe.info("Media stream switched: ".concat((0,Y.printMediaStream)(F)," -> ").concat((0,Y.printMediaStream)(B))),[2,B]}}))}))},SimulcastMediaStream.prototype.subscribeToTrackEvents=function(F){var B=this,G=F?this.getTrackByMediaType(F,this.mediaType):null;G&&(G.onended=function(F){B.logger.safe.info("Track ".concat(G.id," ended: ").concat(JSON.stringify(F))),B.event("onStreamTrackEnded").raise(B,F)},G.onmute=function(){B.logger.safe.info("Track ".concat(G.id," muted")),B.event("onStreamTrackMuted").raise(B,!0)},G.onunmute=function(){B.logger.safe.info("Track ".concat(G.id," unmute")),B.event("onStreamTrackMuted").raise(B,!1)})},SimulcastMediaStream.prototype.unsubscribeFromTrackEvents=function(F){var B=F?this.getTrackByMediaType(F,this.mediaType):null;B&&(B.onended=null,B.onmute=null,B.onunmute=null)},SimulcastMediaStream.prototype.getTrackByMediaType=function(F,B){return"Audio"===B?F.getAudioTracks()[0]:F.getVideoTracks()[0]},SimulcastMediaStream.prototype.removeVideoEffectStream=function(){var F;null===(F=this.sub)||void 0===F||F.dispose(),this.videoEffectManager.removeSourceAsync(this.mediaStream)},SimulcastMediaStream.prototype.applyState=function(F){var B,G=this;null===(B=F.getAudioTracks())||void 0===B||B.forEach((function(F){return G.applyAudioState(F)}));var W=F.getVideoTracks()[0];this.applyVideoState(W)},SimulcastMediaStream.prototype.applyAudioState=function(F){F&&(this.hasNonDefaultAudioProcessingConstraints()||"ScreenShare"===this.mediaType?this.applyContentHint(F,"music"):this.configProvider.config.defaultAudioContentHint&&this.applyContentHint(F,this.configProvider.config.defaultAudioContentHint),F.muted&&this.event("onStreamTrackMuted").raise(this,!0),this.logger.safe.info("Audio track added: ".concat(JSON.stringify(F.id))))},SimulcastMediaStream.prototype.applyVideoState=function(F){F&&("ScreenShare"===this.mediaType&&this.configProvider.config.webrtcDisplayStreamContentHint&&this.applyContentHint(F,this.configProvider.config.webrtcDisplayStreamContentHint),this.logger.safe.info("Video track added: ".concat(JSON.stringify(F.id))))},SimulcastMediaStream.prototype.applyContentHint=function(F,B){this.logger.safe.info("Apply content hint: ".concat(B)),F.contentHint=B},SimulcastMediaStream.prototype.hasNonDefaultAudioProcessingConstraints=function(){var F=this.currentConstraints.audio;if(F){var B=this.configProvider.config.defaultAudioProcessingFlags,G=void 0;return void 0===F.echoCancellation&&void 0===F.autoGainControl&&void 0===F.noiseSuppression||(G=0,void 0!==F.echoCancellation&&(G+=F.echoCancellation?2:0),void 0!==F.autoGainControl&&(G+=F.autoGainControl?1:0),void 0!==F.noiseSuppression&&(G+=F.noiseSuppression?4:0)),G!==B}return!1},SimulcastMediaStream.prototype.getRequestStartTimestamp=function(){return Date.now()},SimulcastMediaStream.prototype.getRequestDuration=function(F){return 0===F?0:Date.now()-F},SimulcastMediaStream.prototype.startNoiseSuppression=function(){return K(this,void 0,void 0,(function(){var F,B;return J(this,(function(G){switch(G.label){case 0:return this.logger.safe.info("ECS keys for wasmdns are: ".concat(JSON.stringify(this.configProvider.config.wasmdns),", and audioEffectManager is ").concat(this.audioEffectManager?"defined":"undefined")),this.configProvider.config.wasmdns.enableNoiseSuppression&&this.audioEffectManager?(F=this.configProvider.mediaConfig.noiseSuppressionMode,this.logger.safe.info("Configuring the audio effect manager for Noise Suppression mode: ".concat(F)),"Auto"===F&&(F=this.configProvider.config.wasmdns.noiseSuppressionMode,this.logger.safe.info("Overriding 'Auto' with ".concat(F))),[4,this.audioEffectManager.configureEffect({audioContext:new AudioContext({latencyHint:"interactive"}),noiseSuppressionMode:F,pTime:this.configProvider.config.wasmdns.pTime,goodPerfThreshold:this.configProvider.config.wasmdns.goodPerfThreshold,poorPerfThreshold:this.configProvider.config.wasmdns.poorPerfThreshold,badPerfThreshold:this.configProvider.config.wasmdns.badPerfThreshold,perfWindowLength:this.configProvider.config.wasmdns.perfWindowLength,enableNoiseSuppression:this.configProvider.config.wasmdns.enableNoiseSuppression,backgroundMode:this.configProvider.config.wasmdns.backgroundMode})]):[3,3];case 1:return G.sent(),[4,this.audioEffectManager.setSourceAsync(this.mediaStream)];case 2:B=G.sent(),this.configProvider.config.wasmdns.backgroundMode?this.logger.safe.info("Noise suppression is running in the background."):this.mediaStream=B,G.label=3;case 3:return[2]}}))}))},SimulcastMediaStream.prototype.stopMediaStream=function(F){var B=this;return this.mediaStreamStartPromise?(this.logger.safe.info("Queueing media stream stop: ".concat(F)),this.serialQueue.add((function(){return B.stopMediaStreamInternal()}))):Promise.resolve()},SimulcastMediaStream.prototype.stopOneMediaStream=function(F){var B=this;try{F.getTracks().forEach((function(F){B.logger.safe.info("Track is stopped: ".concat(JSON.stringify(F.id))),F.stop()})),this.logger.safe.info("Media stream stopped: ".concat(F.id))}catch(F){this.logger.safe.warn("Failed to stop media stream: ".concat(Q.stringifyObject(F)))}},SimulcastMediaStream.prototype.stopMediaStreamInternal=function(){var F;"Video"===this.mediaType&&this.configProvider.config.enableVideoEffects&&this.removeVideoEffectStream(),"Audio"===this.mediaType&&(null===(F=this.audioEffectManager)||void 0===F||F.dispose()),this.mediaStream&&(this.stopOneMediaStream(this.mediaStream),this.mediaStream=null),this.originalMediaStream&&(this.stopOneMediaStream(this.originalMediaStream),this.unsubscribeFromTrackEvents(this.originalMediaStream),this.originalMediaStream=null)},SimulcastMediaStream.prototype.onVideoStreamQualityChanged=function(F,B){this.logger.safe.debug("onStreamQualityChanged: ".concat(JSON.stringify(F),"@").concat(B)),this.event("onStreamQualityChanged").raise(this,F,B)},SimulcastMediaStream.streamId=0,SimulcastMediaStream}($.default);B.SimulcastMediaStream=ie},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.CloneClientGeneratorStrategy=void 0;var K=G(6),J=G(347),Q=G(10),Y=function(F){function CloneClientGeneratorStrategy(B,G,W,z,K){var J=F.call(this,K)||this;return J.stream=B,J.constraints=G,J.constraintsProvider=W,J.gumStreamProvider=z,J.logger=K,J.clients=[],J.streams=[],J.clientId=0,J.mediaStreamSubscription=J.stream.on("onStreamAcquired",(function(){return J.onStreamAcquired()})),J}return z(CloneClientGeneratorStrategy,F),CloneClientGeneratorStrategy.prototype.getClient=function(){var F=new J.SimulcastMediaStreamClient(this.clientId++,this.stream,this.constraints,this.constraintsProvider,this.gumStreamProvider,this.logger);return this.addClient(F),F},CloneClientGeneratorStrategy.prototype.disposeClient=function(F){this.removeClient(F),this.clients.length||this.event("onAllClientsDisposed").raise()},CloneClientGeneratorStrategy.prototype.dispose=function(){var B=this;this.mediaStreamSubscription.dispose(),this.clients.length&&this.logger.safe.error("Not all clients are disposed! ".concat(JSON.stringify(this.clients.map((function(F){return F.id}))))),this.streams.forEach((function(F){return B.disposeStream(F)})),F.prototype.dispose.call(this)},CloneClientGeneratorStrategy.prototype.getOrCreateStream=function(){var F=this.streams.length?this.streams[this.streams.length-1]:this.stream.rawStream;if(!F)return null;var B=F.clone();return this.logger.safe.info("Cloned: ".concat(Q.printMediaStream(F)," -> ").concat(Q.printMediaStream(B))),this.resetStream(B),this.streams.push(B),B},CloneClientGeneratorStrategy.prototype.addClient=function(F){this.updateClient(F),this.clients.push(F)},CloneClientGeneratorStrategy.prototype.updateClient=function(F){var B=this.getOrCreateStream();B&&F.update(B)},CloneClientGeneratorStrategy.prototype.removeClient=function(F){var B=this.clients.indexOf(F);this.clients.splice(B,1)},CloneClientGeneratorStrategy.prototype.addStream=function(){var F=this;this.clients.forEach((function(B){return F.updateClient(B)}))},CloneClientGeneratorStrategy.prototype.disposeStream=function(F){var B=this;F.getTracks().forEach((function(F){B.logger.safe.info("Stopping track: ".concat(JSON.stringify(F.id))),F.stop()}))},CloneClientGeneratorStrategy.prototype.onStreamAcquired=function(){this.addStream()},CloneClientGeneratorStrategy.prototype.resetStream=function(F){var B=this;F.getTracks().forEach((function(F){B.logger.safe.info("Resetting state for track: ".concat(F.id)),F.enabled=!0}))},CloneClientGeneratorStrategy}(K.default);B.CloneClientGeneratorStrategy=Y},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.SimulcastMediaStreamClient=void 0;var Q=G(6),Y=G(81),$=G(10),X=function(F){function SimulcastMediaStreamClient(B,G,W,z,K,J){var Q=F.call(this,J)||this;return Q.id=B,Q.masterStream=G,Q.currentConstraints=W,Q.constraintsProvider=z,Q.streamProvider=K,Q.isDisposed=!1,Q.masterStreamSubscriptions=[],Q.mixerSubscriptions=[],Q.parentId=G.id,Q.logger=J.createChild("C:".concat(Q.parentId,":").concat(Q.id)),Q.subscribeOnMasterStreamEvents(),Q}return z(SimulcastMediaStreamClient,F),Object.defineProperty(SimulcastMediaStreamClient.prototype,"rawTrack",{get:function(){return this.mediaTrack},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStreamClient.prototype,"rawStream",{get:function(){return this.rawMediaStream||(this.rawMediaStream=new MediaStream([this.mediaTrack])),this.rawMediaStream},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStreamClient.prototype,"deviceId",{get:function(){return this.masterStream.deviceId},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStreamClient.prototype,"mediaType",{get:function(){return this.masterStream.mediaType},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStreamClient.prototype,"originalMediaStream",{get:function(){return this.masterStream.getOriginalMediaStream()},enumerable:!1,configurable:!0}),SimulcastMediaStreamClient.prototype.getCurrentConstraints=function(){return this.currentConstraints},SimulcastMediaStreamClient.prototype.dispose=function(B){this.isDisposed||(this.isDisposed=!0,this.logger.safe.info("dispose: ".concat(B)),this.logger=this.logger.createChild("DISPOSED"),this.event("onStreamClientDisposing").raise(this),this.mediaTrack&&(this.unsubscribeFromMediaTrackEvents(),this.mediaTrack=null),this.masterStream&&(this.unsubscribeFromMasterStreamEvents(),this.masterStream.disposeClient(this),this.masterStream=null),this.unsubscribeFromMixerTrackEvents(),F.prototype.dispose.call(this),this.event("onStreamClientDisposed").raise(this))},SimulcastMediaStreamClient.prototype.applyCapabilities=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:if(!this.mediaTrack)return[2,Promise.resolve(!1)];if(!(B=this.constraintsProvider.updateVideoConstraints(this.currentConstraints,F,this.getResolution()))||this.currentConstraints===B)return[2,Promise.resolve(!1)];W.label=1;case 1:return W.trys.push([1,3,,4]),[4,this.applyConstraints(B)];case 2:return W.sent(),this.currentConstraints=B,[2,!0];case 3:throw G=W.sent(),this.logger.safe.error("Apply constraints error: ".concat(JSON.stringify(G))),G;case 4:return[2]}}))}))},SimulcastMediaStreamClient.prototype.start=function(){return this.masterStream.start()},SimulcastMediaStreamClient.prototype.clone=function(F){return this.masterStream.getClient("streamclient: ".concat(F))},SimulcastMediaStreamClient.prototype.setMuted=function(F,B){this.isMuted=F,this.applyState(B)},SimulcastMediaStreamClient.prototype.setHold=function(F,B){this.isHold=F,this.applyState(B)},SimulcastMediaStreamClient.prototype.isSameStream=function(F){return this.parentId===F.parentId},SimulcastMediaStreamClient.prototype.getResolution=function(){var F=this;if(!["Video","ScreenShare","PanoramicVideo"].some((function(B){return B===F.mediaType})))return null;var B={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},G=Y.getResolutionForTrack(this.mediaTrack,B);return G===B?this.logger.safe.error("Stream resolution is not avalable, assuming we're at ".concat(B.width,"x").concat(B.height," now")):this.logger.safe.info("Stream resolution is ".concat(G.width,"x").concat(G.height," for track ").concat(this.mediaTrack.id)),G},SimulcastMediaStreamClient.prototype.getFrameRate=function(){var F=this;if(!["Video","ScreenShare","PanoramicVideo"].some((function(B){return B===F.mediaType})))return null;var B=Y.getFrameRateForTrack(this.mediaTrack);return 0===B?this.logger.safe.error("Stream frame rate is not avalable, returning 0"):this.logger.safe.info("Stream fps is ".concat(B)),B},SimulcastMediaStreamClient.prototype.update=function(F){F?this.mediaTrack?this.logger.safe.error("Media track is already created: ".concat(this.mediaTrack.id)):(this.mediaTrack=this.getTrackByMediaType(F,this.mediaType),this.updateTrackConstraints(),this.subscribeOnMediaTrackEvents(this.mediaTrack),this.hasMasterAudio=F&&F.getAudioTracks().length>0,this.hasMasterVideo=F&&F.getVideoTracks().length>0,this.hasMasterAudio&&this.hasMasterVideo&&(this.rawMediaStream=F),this.logger.safe.info("Updated: ".concat($.printMediaStream(F)))):this.logger.safe.error("No master media stream, skipping update")},SimulcastMediaStreamClient.prototype.updateTrackConstraints=function(){return K(this,void 0,void 0,(function(){var F,B,G;return J(this,(function(W){switch(W.label){case 0:if("ScreenShare"!==this.mediaType)return[2];if(!(F=this.masterStream.getResolution()))return[3,4];(B=this.currentConstraints.clone()).video.maxWidth=F.width,B.video.minWidth=F.width,B.video.maxHeight=F.height,B.video.minHeight=F.height,W.label=1;case 1:return W.trys.push([1,3,,4]),[4,this.applyConstraints(B)];case 2:return W.sent(),this.currentConstraints=B,[3,4];case 3:return G=W.sent(),this.logger.safe.error("Apply constraints error: ".concat(JSON.stringify(G))),[3,4];case 4:return[2]}}))}))},SimulcastMediaStreamClient.prototype.getTrackByMediaType=function(F,B){return"Audio"===B?F.getAudioTracks()[0]:F.getVideoTracks()[0]},SimulcastMediaStreamClient.prototype.applyConstraints=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this.event("onConstraintsToBeApplied").raise(this),[2,this.streamProvider.applyConstraintsForTrack(this.mediaTrack,F)]}))}))},SimulcastMediaStreamClient.prototype.applyState=function(F){this.mediaTrack&&void 0!==this.mediaTrack.enabled&&(this.mediaTrack.enabled=!this.isMuted&&!this.isHold,this.logger.safe.info("[".concat(F,"] Track ").concat(JSON.stringify(this.mediaTrack.id)," enabled state set to => ").concat(this.mediaTrack.enabled)))},SimulcastMediaStreamClient.prototype.subscribeOnMediaTrackEvents=function(F){var B=this;F.onended=function(G){B.logger.safe.info("Track ".concat(F.id," ended: ").concat(JSON.stringify(G))),B.event("onStreamClientEnded").raise(B,G)},F.onmute=function(){B.logger.safe.info("Track ".concat(F.id," muted")),B.event("onStreamClientMuted").raise(B,!0)},F.onunmute=function(){B.logger.safe.info("Track ".concat(F.id," unmuted")),B.event("onStreamClientMuted").raise(B,!1)}},SimulcastMediaStreamClient.prototype.unsubscribeFromMediaTrackEvents=function(){this.mediaTrack.onended=null,this.mediaTrack.onmute=null,this.mediaTrack.onunmute=null},SimulcastMediaStreamClient.prototype.unsubscribeFromMixerTrackEvents=function(){this.mixerSubscriptions.forEach((function(F){return F.dispose()})),this.mixerSubscriptions=[]},SimulcastMediaStreamClient.prototype.subscribeOnMasterStreamEvents=function(){var F=this;this.masterStreamSubscriptions.push(this.masterStream.on("onStreamStarted",(function(B,G){return F.event("onStreamClientStarted").raise(F,G)})),this.masterStream.on("onStreamError",(function(B,G){return F.event("onStreamClientError").raise(F,G)})),this.masterStream.on("onStreamTrackMuted",(function(B,G){return F.event("onStreamClientMuted").raise(F,G)})),this.masterStream.on("onStreamDisposing",(function(B){return F.dispose()})),this.masterStream.on("onStreamQualityChanged",(function(B,G,W){return F.event("onStreamQualityChanged").raise(F,G,W)})),this.masterStream.on("onStreamTrackEnded",(function(B,G){return F.event("onStreamClientEnded").raise(F,G)})))},SimulcastMediaStreamClient.prototype.unsubscribeFromMasterStreamEvents=function(){this.masterStreamSubscriptions.forEach((function(F){return F.dispose()})),this.masterStreamSubscriptions=[]},SimulcastMediaStreamClient.prototype.hasAudio=function(){return this.hasMasterAudio},SimulcastMediaStreamClient.prototype.hasVideo=function(){return this.hasMasterVideo},SimulcastMediaStreamClient.prototype.isActive=function(){var F,B,G;return(null===(F=this.mediaTrack)||void 0===F?void 0:F.enabled)&&!(null===(B=this.mediaTrack)||void 0===B?void 0:B.muted)&&"live"===(null===(G=this.mediaTrack)||void 0===G?void 0:G.readyState)},SimulcastMediaStreamClient.prototype.onVideoStreamQualityChanged=function(F,B){this.logger.safe.debug("onStreamQualityChanged: ".concat(JSON.stringify(F),"@").concat(B)),this.masterStream.onVideoStreamQualityChanged(F,B)},SimulcastMediaStreamClient}(Q.default);B.SimulcastMediaStreamClient=X},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.MediaStreamRequestStrategyBase=B.RequestStrategyFactory=void 0;var K=G(131),J=G(4),Q=G(10),Y=function(){function RequestStrategyFactory(){}return RequestStrategyFactory.getStrategy=function(F,B,G,W,z,K){return K?new ee(G,W):"Video"===F?new Z(B,G,W,z):new X(B,G,W)},RequestStrategyFactory}();B.RequestStrategyFactory=Y;var $=function(){function MediaStreamRequestStrategyBase(F,B,G){this.gumStreamProvider=F,this.serialQueue=B,this.logger=G}return MediaStreamRequestStrategyBase.prototype.getStream=function(F){var B=this;return this.logger.safe.info("Requesting stream with constraints: ".concat(JSON.stringify((0,Q.scrubConstraints)(F)))),this.serialQueue.add((function(){return B.request(F)}))},MediaStreamRequestStrategyBase}();B.MediaStreamRequestStrategyBase=$;var X=function(F){function SimpleRequestStrategy(B,G,W){return F.call(this,B,G,W.createChild("SimpleStrat"))||this}return z(SimpleRequestStrategy,F),SimpleRequestStrategy.prototype.request=function(F){return this.gumStreamProvider.getStream(F)},SimpleRequestStrategy}($),Z=function(F){function MultipleRequestStrategy(B,G,W,z){var J=F.call(this,B,G,W.createChild("MultStrat"))||this;return J.policyGenerator=new K.RequestPolicyGenerator(z),J}return z(MultipleRequestStrategy,F),MultipleRequestStrategy.prototype.request=function(F){var B=this.policyGenerator.getPolicies(F);return this.makeRequests(B)},MultipleRequestStrategy.prototype.makeRequests=function(F){var B=this,G=F[0];return this.logger.safe.info("Requesting media stream with policy: ".concat(JSON.stringify(G))),this.makeRequestWithPolicy(G).catch((function(G){var W=F.slice(1);if(W.length&&J.default.MEDIA_ERROR.constraintNotSatisfiedError===G.type)return B.logger.safe.warn("Could not obtain constrained media stream, will attempt weaker policy"),B.makeRequests(W);throw G}))},MultipleRequestStrategy.prototype.makeRequestWithPolicy=function(F){return this.gumStreamProvider.getStream(F)},MultipleRequestStrategy}($),ee=function(F){function CustomStreamStrategy(B,G){return F.call(this,null,B,G.createChild("WithOveriddenStreamStart"))||this}return z(CustomStreamStrategy,F),CustomStreamStrategy.prototype.request=function(F){return new Promise((function(B,G){return B(F.withOverridenStream)}))},CustomStreamStrategy}($)},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.DeviceEnumerator=void 0;var Q=G(38),Y=G(18),$=G(51),X=G(1),Z=G(350),ee=G(82),te=G(134),ne=function(F){function DeviceEnumerator(B,G){var W=F.call(this,G)||this;return W.configProvider=B,W.logger=G,W.isInitialized=new Q.SettablePromise,W.list=new te.ComposedDeviceList(W.configProvider,W.logger.createChild("DeviceList")),W.selection=new Z.DeviceSelection(W.list,W.configProvider,W.logger.createChild("DeviceSelection")),W.window=Y.default.window,W.currentPollingInterval=0,W.configProvider.userAgentConfig.on("isAudioOutputSelectionSupportedChanged",(function(){return W.enumerateDevices()})),W.configProvider.on("configUpdated",(function(){void 0!==W.configProvider.config.devices.pollingIntervalIdle&&null!==W.pollingTimer&&W.startDevicePolling(!0)})),W.configProvider.config.devices.pollingIntervalIdle&&W.configProvider.config.devices.idlePollingOnStart&&W.startDevicePolling(!0),W.subscribeForDeviceChangeEvent(),W}return z(DeviceEnumerator,F),Object.defineProperty(DeviceEnumerator.prototype,"isPollingInProgress",{get:function(){return!!this.pollingTimer},enumerable:!1,configurable:!0}),DeviceEnumerator.prototype.initialize=function(){var F=this;this.enumerateDevices().then((function(){return F.isInitialized.resolve()})).catch((function(B){return F.isInitialized.reject(B)}))},DeviceEnumerator.prototype.enumerateDevices=function(){var F;return K(this,void 0,void 0,(function(){return J(this,(function(B){if(!this.window.navigator||!this.window.navigator.mediaDevices||!this.window.navigator.mediaDevices.enumerateDevices)throw new Error("device enumeration unsupported");return null!==(F=this.enumerateDevicesPromise)&&void 0!==F||(this.enumerateDevicesPromise=this.runEnumerateDevicesAsync()),[2,this.enumerateDevicesPromise]}))}))},DeviceEnumerator.prototype.startDevicePolling=function(F){var B=this,G=F?this.configProvider.config.devices.pollingIntervalIdle:this.configProvider.config.devices.pollingIntervalActive;if(this.currentPollingInterval!==G&&this.stopDevicePolling(!0),G&&!this.pollingTimer){var pollingTask=function(){return K(B,void 0,void 0,(function(){var F;return J(this,(function(B){switch(B.label){case 0:this.currentPollingInterval=G,this.logger.safe.debug("Polling devices"),B.label=1;case 1:return B.trys.push([1,3,,4]),[4,this.enumerateDevices()];case 2:return B.sent(),this.pollingTimer=this.window.setTimeout(pollingTask,G),[3,4];case 3:throw F=B.sent(),this.pollingTimer=null,F;case 4:return[2]}}))}))};this.logger.safe.info("starting ".concat(F?"idle":"active"," device polling with interval ").concat(G,"ms")),pollingTask()}},DeviceEnumerator.prototype.stopDevicePolling=function(F){this.enumerateDevicesPromise=null,this.pollingTimer&&(this.logger.safe.info("stopping device polling"),this.window.clearTimeout(this.pollingTimer),this.pollingTimer=null,!F&&this.configProvider.config.devices.pollingIntervalIdle&&this.startDevicePolling(!0))},DeviceEnumerator.prototype.dispose=function(){F.prototype.dispose.call(this),this.logger.safe.info("disposing"),this.stopDevicePolling(!0),this.window.navigator.mediaDevices.ondevicechange=void 0},DeviceEnumerator.prototype.runEnumerateDevicesAsync=function(){return K(this,void 0,void 0,(function(){var F,B,G;return J(this,(function(W){switch(W.label){case 0:return W.trys.push([0,5,6,7]),this.configProvider.config.devices.enumerateDevicesTimeout?[4,$.timeout(this.window.navigator.mediaDevices.enumerateDevices(),this.configProvider.config.devices.enumerateDevicesTimeout,"enumerateDevices")]:[3,2];case 1:return B=W.sent(),[3,4];case 2:return[4,this.window.navigator.mediaDevices.enumerateDevices()];case 3:B=W.sent(),W.label=4;case 4:return F=B,this.list.updateDevices(F.map((function(F){return ee.createDevice(F)}))),[3,7];case 5:throw G=W.sent(),this.logger.safe.warn("error with enumerating devices: ".concat(X.stringifyObject(G))),this.event("onDeviceEnumerationfailed").raise(X.stringifyObject(G)),G;case 6:return this.enumerateDevicesPromise=null,[7];case 7:return[2]}}))}))},DeviceEnumerator.prototype.subscribeForDeviceChangeEvent=function(){var F=this;this.window.navigator.mediaDevices&&(this.window.navigator.mediaDevices.ondevicechange=function(){F.logger.safe.debug("enumerating due to ondevicechange callback"),F.enumerateDevices().catch((function(B){F.logger.safe.error("unable to enumerate ondevicechange: ".concat(X.stringifyObject(B)))}))})},DeviceEnumerator}(G(6).default);B.DeviceEnumerator=ne},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.DeviceSelection=void 0;var K=G(6),J=G(1),Q=G(10),Y=function(F){function DeviceSelection(B,G,W){var z=F.call(this,W)||this;return z.deviceList=B,z.configProvider=G,z.logger=W,z.userSelectedDevices={microphone:null,camera:null,speaker:null},z.currentlySelectedDevices={microphone:null,camera:null,speaker:null},z.deviceList.on("onDevicesChanged",(function(F){return z.onDevicesChanged(F)})),z.logger.safe.info("Initialized"),z}return z(DeviceSelection,F),Object.defineProperty(DeviceSelection.prototype,"selectedDevices",{get:function(){return J.deepClone(this.currentlySelectedDevices)},enumerable:!1,configurable:!0}),DeviceSelection.prototype.selectDevices=function(F){var B=this,G=!1;if(J.forOwn(F,(function(F,W){var z,K=B.getDeviceToSelect(W,B.deviceList.getDevicesByType(W),F);(null==K?void 0:K.guid)!==(null===(z=B.currentlySelectedDevices[W])||void 0===z?void 0:z.guid)&&(B.userSelectedDevices[W]=(null==K?void 0:K.guid)||B.userSelectedDevices[W],G=!0),B.currentlySelectedDevices[W]=K})),G){var W=J.values(this.currentlySelectedDevices).map((function(F){return JSON.stringify((0,Q.scrubDevices)(F,B.configProvider.config.devices.piiSafeWords))}));this.logger.safe.info("Changed from public interface: ".concat(W)),this.event("onSelectedDevicesChanged").raise(this.selectedDevices,!0)}},DeviceSelection.prototype.getDeviceToSelect=function(F,B,G){var W,z=this.userSelectedDevices[F];return G?W=B.find((function(F){return F.guid===G})):z&&(W=B.find((function(F){return F.guid===z}))),W||B[0]},DeviceSelection.prototype.onDevicesChanged=function(F){var B=this,G=!1;if(Object.keys(this.currentlySelectedDevices).forEach((function(W){var z,K=F.filter((function(F){return F.type===W}));if(K.length>0){var J=B.getDeviceToSelect(W,K);(null==J?void 0:J.guid)!==(null===(z=B.currentlySelectedDevices[W])||void 0===z?void 0:z.guid)&&(B.currentlySelectedDevices[W]=J,G=!0)}else B.currentlySelectedDevices[W]&&(B.currentlySelectedDevices[W]=null,G=!0)})),G){var W=J.values(this.currentlySelectedDevices).map((function(F){return JSON.stringify((0,Q.scrubDevices)(F,B.configProvider.config.devices.piiSafeWords))}));this.logger.safe.info("Changed due to device list change: ".concat(W)),this.event("onSelectedDevicesChanged").raise(this.selectedDevices,!1)}},DeviceSelection}(K.default);B.DeviceSelection=Y},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.compilePrimitiveDeviceList=void 0;var z=G(17),K=G(1),J=G(4),Q=G(82);function compilePrimitiveDeviceList(F,B,G,Y,$){var X,Z;void 0===$&&($={str:""}),$.str+="|input(".concat(B.length,")");var ee=[],te=[Y.config.devices.blacklist[F],Y.defaultConfig.devices.blacklist[F]],_loop_1=function(F){try{var G=new RegExp(F,"i");return ee=B.filter((function(B){return F&&B.label.match(G)?($.str+="|-blacklisted(".concat(B.label,")"),!1):B.deviceId!==J.default.MEDIA_DEVICE.communicationsId||($.str+="|-communications",!1)})),"break"}catch(G){$.str+="|filterError('".concat(F,"', ").concat(K.stringifyObject(G),")"),ee=B}};try{for(var ne=W(te),ie=ne.next();!ie.done;ie=ne.next()){if("break"===_loop_1(ie.value))break}}catch(F){X={error:F}}finally{try{ie&&!ie.done&&(Z=ne.return)&&Z.call(ne)}finally{if(X)throw X.error}}if(ee.length){var re=deductDefaultDevice(G,ee,$);if(re&&(re.isSystemDefault=!0,$.str+="|default(".concat(z.scrubMriOrOmit(re.guid),")")),re&&re.deviceId!==J.default.MEDIA_DEVICE.defaultId&&ee.length>1&&(ee=ee.filter((function(F){return F.deviceId!==J.default.MEDIA_DEVICE.defaultId||($.str+="|-defaultId",!1)}))),F===J.default.MEDIA_DEVICE.camera||re||($.str+="|+syntheticDefault",ee.unshift(Q.createDefaultDevice(F))),G.forEach((function(F){var B=ee.find((function(B){return B.guid===F.guid}));B&&!B.label&&F.label&&($.str+="|migrateLabel(".concat(z.scrubMriOrOmit(B.guid),")"),B.label=F.label)})),F===J.default.MEDIA_DEVICE.speaker){var oe=ee.filter((function(F){return""===F.label}));oe.length>1&&oe.length===ee.length&&(ee=re?[re]:[ee[0]],$.str+="|-filteredEmptyLabels(".concat(oe.length,")"))}}return ee}function deductDefaultDevice(F,B,G){if(1===B.length)return G.str+="|default:only",B[0];var W=B.find((function(F){return F.isSystemDefault&&F.deviceId===J.default.MEDIA_DEVICE.defaultId}));if(!W)return G.str+="|default:noSynthetic",B.find((function(F){return F.isSystemDefault}))||B[0];var Q=B.filter((function(F){return F!==W}));if(1===Q.length)return G.str+="|default:firstNonDefault",Q[0];if(""!==W.groupId){var Y=Q.filter((function(F){return F.groupId===W.groupId}));if(1===Y.length)return G.str+="|default:groupId(".concat(z.scrubMriOrOmit(Y[0].guid),")"),Y[0]}var $=Q.map((function(F){return F.label})),X=K.getMaxSubstring(W.label,$),Z=Q.find((function(F){return F.label===X}));if(Z)return G.str+="|default:label(".concat(z.scrubMriOrOmit(Z.guid),")"),Z;var ee=F.find((function(F){return F.isSystemDefault}));if(ee){var te=Q.find((function(F){return F.deviceId===ee.deviceId}));if(te)return G.str+="|default:previousList(".concat(z.scrubMriOrOmit(te.guid),")"),te}return G.str+="|default:anyOrNull",B.find((function(F){return F.isSystemDefault}))||null}B.compilePrimitiveDeviceList=compilePrimitiveDeviceList},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))},K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.compileAudioDeviceList=void 0;var J=G(17),Q=G(1),Y=G(82);function compileAudioDeviceList(F,B,G,K){void 0===G&&(G=.5),void 0===K&&(K={str:""});var J=[];if(F.length&&B.length){var Q=getGroupedPairs(F.filter((function(F){return""!==F.groupId})),B.filter((function(F){return""!==F.groupId})),K);Q.length&&(J.push.apply(J,z([],W(Q.map((function(F){return Y.createCompositeAudioDevice(F.microphone,F.speaker,createCompositeDeviceLabel(F.microphone.label,F.speaker.label))}))),!1)),K.str+="|directMatched(".concat(J.length,")"));var $=J.length;J.push.apply(J,z([],W(composeAudioDevicesFromLabels(F.filter((function(F){return!J.some((function(B){return B.micDeviceId===F.guid}))})),B.filter((function(F){return!J.some((function(B){return B.speakerDeviceId===F.guid}))})),G,K)),!1)),K.str+="|otherMatched(".concat(J.length-$,")")}return J}function getGroupedPairs(F,B,G){var Q,Y,$,X;void 0===G&&(G={str:""});var Z=new Set;try{for(var ee=K(z(z([],W(F),!1),W(B),!1)),te=ee.next();!te.done;te=ee.next()){var ne=te.value;Z.add(ne.groupId)}}catch(F){Q={error:F}}finally{try{te&&!te.done&&(Y=ee.return)&&Y.call(ee)}finally{if(Q)throw Q.error}}var ie=[],_loop_1=function(W){var z=F.filter((function(F){return F.groupId===W})),K=B.filter((function(F){return F.groupId===W}));if(z&&K)if(1===z.length&&1===K.length)ie.push({microphone:z[0],speaker:K[0]}),G.str+="|pairSimple(".concat(J.scrubMriOrOmit(z[0].guid),", ").concat(J.scrubMriOrOmit(K[0].guid),")");else if(z.length>1||K.length>1)for(var Q=getMostSimilarPair(z,K);Q;)G.str+="|pairComplex(".concat(J.scrubMriOrOmit(Q.microphone.guid),", ").concat(J.scrubMriOrOmit(Q.speaker.guid),")"),ie.push(Q),z=z.filter((function(F){return F!==Q.microphone})),K=K.filter((function(F){return F!==Q.speaker})),Q=getMostSimilarPair(z,K)};try{for(var re=K(Z.values()),oe=re.next();!oe.done;oe=re.next()){_loop_1(oe.value)}}catch(F){$={error:F}}finally{try{oe&&!oe.done&&(X=re.return)&&X.call(re)}finally{if($)throw $.error}}return ie}function getMostSimilarPair(F,B){var G,W,z,J,Y=999,$=null;if(F.length>0&&B.length>0)try{for(var X=K(F),Z=X.next();!Z.done;Z=X.next()){var ee=Z.value;try{for(var te=(z=void 0,K(B)),ne=te.next();!ne.done;ne=te.next()){var ie=ne.value,re=Q.levenshteinDistance(ee.label,ie.label);re<Y&&(Y=re,$={microphone:ee,speaker:ie})}}catch(F){z={error:F}}finally{try{ne&&!ne.done&&(J=te.return)&&J.call(te)}finally{if(z)throw z.error}}}}catch(F){G={error:F}}finally{try{Z&&!Z.done&&(W=X.return)&&W.call(X)}finally{if(G)throw G.error}}return $}function composeAudioDevicesFromLabels(F,B,G,W){var z=[];return F.length&&B.length?(F.forEach((function(F){var K=B.filter((function(B){return B.groupId===F.groupId}));if(K.length){var $=Q.getLongestCommonContiguousSubstring(F.label,K[0].label).length,X=K.sort((function(B,G){var W=Q.getLongestCommonContiguousSubstring(F.label,B.label),z=Q.getLongestCommonContiguousSubstring(F.label,G.label);return W.length>$&&($=W.length),z.length>$&&($=z.length),z.length-W.length}));if(X.length){var Z=$/F.label.length;Z>G&&(z.push(Y.createCompositeAudioDevice(F,X[0],createCompositeDeviceLabel(F.label,X[0].label))),W.str+="|lbl_matched(".concat(J.scrubMriOrOmit(F.guid)," & ").concat(J.scrubMriOrOmit(X[0].guid),", ").concat(Math.round(1e4*Z)/100,"%)"))}}else W.str+="|lbl_nocand(".concat(J.scrubMriOrOmit(F.guid),")")})),z):z}function createCompositeDeviceLabel(F,B){if(F===B)return F;var G=Q.getLongestCommonContiguousSubstring(F,B);G=G.trim().replace(/^\((.+)\)$/,"$1");var W="",z="",K=0,J=[countBraces(F),countBraces(B)];if(0===J[0]||0===J[1])return G;for(var Y=0;Y<G.length;Y++)if("("===G[Y])K++,z+=G[Y];else if(")"===G[Y]){if(!(K>0))break;K--,W+=z+=G[Y],z=""}else K>0?z+=G[Y]:W+=G[Y];var $=countBraces(W);return $!==J[0]&&$!==J[1]||(W=createCompositeDeviceLabel(G,W=W.replace(/\w+\s?\((.+)\)/,"$1"))),W.trim()}function countBraces(F){for(var B=["(",")"],G=0,_loop_2=function(W){B.some((function(B){return F[W]===B}))&&G++},W=0;W<F.length;W++)_loop_2(W);return G}B.compileAudioDeviceList=compileAudioDeviceList},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.DevicesHandle=void 0;var K=G(34),J=G(6),Q=G(1),Y=function(F){function DevicesHandle(B,G){var W=F.call(this,B)||this;return W.logger=B,W.mediaStream=G,W.subs=[],W.subscribeOnMediaStreamEvents(G),W}return z(DevicesHandle,F),DevicesHandle.prototype.acquire=function(){var F=this;return this.mediaStream?this.mediaStream.start().then((function(){return F.logger.safe.info("Stream acquired")})).catch((function(B){throw F.logger.safe.warn("Failed to acquire the stream: ".concat(Q.stringifyObject(B))),B})):Promise.reject("Disposed")},DevicesHandle.prototype.dispose=function(){this.logger.safe.info("Disposing stream"),this.unsubscribeFromMediaStreamEvents(),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null)},DevicesHandle.prototype.subscribeOnMediaStreamEvents=function(F){var B=this;this.subs=[F.on("onStreamClientStarted",(function(){return B.event("onStreamStateChanged").raise("active")})),F.on("onStreamClientMuted",(function(F,G){return B.event("onStreamStateChanged").raise(G?"inactive":"active")})),F.on("onStreamClientEnded",(function(){return B.event("onStreamStateChanged").raise("stopped")})),F.on("onStreamClientError",(function(F,G){var W=G.type===K.Constants.MEDIA_ERROR.permissionDeniedError||G.type===K.Constants.MEDIA_ERROR.sharingCancelledError;B.event("onStreamStateChanged").raise(W?"cancelled":"failed")}))]},DevicesHandle.prototype.unsubscribeFromMediaStreamEvents=function(){this.subs.forEach((function(F){return F.dispose()})),this.subs=[]},DevicesHandle}(J.default);B.DevicesHandle=Y},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},J=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var Q=G(8),Y=G(355),$=G(356),X=G(357),Z=G(1),ee=G(4),te=G(10),ne=G(366),ie=G(368),re=G(424),oe=function(){function MediaAgent(F,B,G,W,z,K,J){var Q=this;this.logger=F,this.context=B,this.configProvider=G,this.diagnostics=W,this.ufdManager=z,this.deviceManager=K,this.capabilities=J,this.activeSessions=[],this.pendingDeviceTelemetryEvents=[],this.pendingVideoEffectsTelemetryEvents=[],this.pendingAudioEffectsTelemetryEvents=[],this.callsCount=0,this.mediaConfig={},this.configProvider.on("configUpdated",(function(){return Q.configApplied()})),this.deviceManager.on("onDeviceTelemetryEvent",(function(F){return Q.onDeviceTelemetryEvent(F)})),this.deviceManager.on("onVideoEffectsTelemetryEvent",(function(F){return Q.onVideoEffectsTelemetryEvent(F)})),this.deviceManager.on("onAudioEffectsTelemetryEvent",(function(F){return Q.onAudioEffectsTelemetryEvent(F)}))}return MediaAgent.prototype.createSession=function(F,B,G){var W=this;this.configProvider.setMediaConfiguration(this.mediaConfig);var z=this.configProvider.getConfigView(G&&G.isConference),K=this.logger,J=this.diagnostics.newSession(z,B,this.logger.createChild("sessionDiagnostics")),Q={getDeviceManager:function(){return W.deviceManager},getLogger:function(){return K},getUfdManager:function(){return W.ufdManager},maContext:this.context,config:null!=G?G:{},configProvider:z,diagnostics:J.newNativeSessionDiag()},$=(z.mediaConfig.simulcastSessionEnabled?re.default:ie.default).build(Q,B,F),Z=new ne.default(z,++this.callsCount);Z.setMediaQosEnabled(!!this.mediaConfig.enableMediaQoS),Z.setPortRangeConfigured(!!this.mediaConfig.mediaPortRanges);var ee=new X.default($,B,Q,F,Z,this.configProvider,J);for(ee.on("onTerminated",(function(F){return W.onSessionTerminated(F)})),this.activeSessions.push(ee),this.configProvider.updateSessionCount(this.activeSessions.length),this.webRtcInternalsCollector=Y.default.getInstance(this.logger,z),this.webRtcInternalsCollector.updateSessionCount(this.activeSessions.length);this.pendingDeviceTelemetryEvents.length>0;)ee.registerDeviceTelemetryEvent(this.pendingDeviceTelemetryEvents.pop());for(;this.pendingVideoEffectsTelemetryEvents.length>0;)ee.registerVideoEffectsTelemetryEvent(this.pendingVideoEffectsTelemetryEvents.pop());for(;this.pendingAudioEffectsTelemetryEvents.length>0;)ee.registerAudioEffectsTelemetryEvent(this.pendingAudioEffectsTelemetryEvents.pop());return ee},MediaAgent.prototype.getDeviceManager=function(){return this.deviceManager},MediaAgent.prototype.getCapabilities=function(){return this.capabilities},MediaAgent.prototype.getScreenSharingManager=function(){return new $.ScreenSharingManager},MediaAgent.prototype.updateConfig=function(F,B,G,W){this.configProvider.updateConfig(F,B,G,W)},MediaAgent.prototype.getConfig=function(){return this.configProvider.config},MediaAgent.prototype.getConfigProvider=function(){return this.configProvider},MediaAgent.prototype.setMediaConfig=function(F){Q.merge(this.mediaConfig,F),this.diagnostics.mediaConfig=this.mediaConfig},MediaAgent.prototype.getMediaLogs=function(){return this.webRtcInternalsCollector?this.webRtcInternalsCollector.collect():Promise.resolve("")},MediaAgent.prototype.dispose=function(F){var B=this;return Promise.all(J([this.deviceManager.dispose(),this.capabilities.dispose()],K(this.activeSessions.map((function(G){return W(B,void 0,void 0,(function(){return z(this,(function(B){switch(B.label){case 0:return[4,G.terminate(F,{}).catch((function(){}))];case 1:return B.sent(),G.dispose(),[2]}}))}))}))),!1)).then((function(){}),(function(){}))},MediaAgent.prototype.configApplied=function(){window&&(this.configProvider.config.enableDevtoolsAPI?window.webMA||this.injectDevtoolsAPI():window.webMA&&delete window.webMA)},MediaAgent.prototype.injectDevtoolsAPI=function(){var F=this,B={config:{addOverride:function(B,G){return F.configProvider.setConsoleOverride(B,G)},setOverrides:function(B){return F.configProvider.setConsoleOverrides(B)},clearOverride:function(B){return F.configProvider.clearConsoleOverride(B)},clearAllOverrides:function(){return F.configProvider.clearAllConsoleOverrides()},setConstraints:function(B){return F.configProvider.platformCallConstraintsProvider.setConstraints(B)}},diagnosticsReport:this.diagnostics.reportGenerator,deviceManager:{setAudioProcessingFlags:function(B){return F.deviceManager.setAudioProcessingFlags(B)}}};window.webMA=B},MediaAgent.prototype.onDeviceTelemetryEvent=function(F){this.activeSessions.length>0?this.activeSessions.forEach((function(B){return B.registerDeviceTelemetryEvent(F)})):this.pendingDeviceTelemetryEvents.push(F)},MediaAgent.prototype.onVideoEffectsTelemetryEvent=function(F){this.activeSessions.length>0?this.activeSessions.forEach((function(B){return B.registerVideoEffectsTelemetryEvent(F)})):this.pendingVideoEffectsTelemetryEvents.push(F)},MediaAgent.prototype.onAudioEffectsTelemetryEvent=function(F){this.activeSessions.length>0?this.activeSessions.forEach((function(B){return B.registerAudioEffectsTelemetryEvent(F)})):this.pendingAudioEffectsTelemetryEvents.push(F)},MediaAgent.prototype.onSessionTerminated=function(F){Z.remove(this.activeSessions,(function(B){return B===F})),this.configProvider.updateSessionCount(this.activeSessions.length),this.webRtcInternalsCollector.updateSessionCount(this.activeSessions.length),0===this.activeSessions.length&&this.ufdManager.reset()},MediaAgent}(),ae=function(){function MediaAgentFactory(){}return MediaAgentFactory.build=function(F,B,G,W,z,K,J){return new oe(F,B,G,W,z,K,J)},MediaAgentFactory.constants=ee.default,MediaAgentFactory.helper=te,MediaAgentFactory}();B.default=ae},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.WebRtcInternalsCollector=void 0;var K=G(23),J=function(){function WebRtcInternalsCollector(F){this.extensionId="nkeimhogjdpnpccoofpliimaahmaaome",this.editorExtensionId="ncbjelpjchkpbikbpkcchkhkblodoama",this.logId="WebRTCLogs",this.connectionCount=0,this.logger=F.createChild("WebRtcInternals")}return WebRtcInternalsCollector.prototype.updateSessionCount=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){switch(B.label){case 0:return[4,this.isExtensionAvailable()];case 1:return B.sent()?0!==this.connectionCount||1!==F?[3,3]:[4,this.startLogging()]:[2];case 2:return B.sent(),[3,5];case 3:return 0!==F?[3,5]:[4,this.stopLogging()];case 4:B.sent(),B.label=5;case 5:return this.connectionCount=F,[2]}}))}))},WebRtcInternalsCollector.prototype.collect=function(){return W(this,void 0,void 0,(function(){var F=this;return z(this,(function(B){switch(B.label){case 0:return[4,this.isExtensionAvailable()];case 1:return B.sent()?this.collectPromise?[2,this.collectPromise]:[2,this.collectPromise=new Promise((function(B){return W(F,void 0,void 0,(function(){var F,G;return z(this,(function(W){switch(W.label){case 0:return W.trys.push([0,7,,8]),this.connectionCount>0?(this.logger.safe.info("Stopping logger for gathering, open connections: ".concat(this.connectionCount)),[4,this.stopLogging()]):[3,2];case 1:W.sent(),W.label=2;case 2:return[4,this.storeLogs()];case 3:return W.sent(),[4,this.gatherFromStorage()];case 4:return F=W.sent(),this.connectionCount>0?[4,this.startLogging()]:[3,6];case 5:W.sent(),W.label=6;case 6:return B(F.length>0?F.join("\r\n"):""),[3,8];case 7:return G=W.sent(),this.logger.safe.error("Error while collecting logs",G),B(JSON.stringify(G)),[3,8];case 8:return this.collectPromise=void 0,[2]}}))}))}))]:[2,""]}}))}))},WebRtcInternalsCollector.prototype.isExtensionAvailable=function(){return W(this,void 0,void 0,(function(){var F;return z(this,(function(B){switch(B.label){case 0:if(void 0!==this.isAvailable)return[3,4];B.label=1;case 1:return B.trys.push([1,3,,4]),[4,this.sendMessage(this.extensionId,{method:"isExtensionEnabled"})];case 2:return B.sent(),this.isAvailable=!0,[3,4];case 3:return F=B.sent(),this.logger.safe.warn("Extension cannot be accessed",F),this.isAvailable=!1,[3,4];case 4:return[2,this.isAvailable]}}))}))},WebRtcInternalsCollector.prototype.startLogging=function(){return W(this,void 0,void 0,(function(){var F;return z(this,(function(B){switch(B.label){case 0:return B.trys.push([0,2,,3]),[4,this.sendMessage(this.extensionId,{method:"logging.start"})];case 1:return B.sent(),this.logger.safe.info("Logging started"),[3,3];case 2:return F=B.sent(),this.logger.safe.error("Error while starting logging",F),[3,3];case 3:return[2]}}))}))},WebRtcInternalsCollector.prototype.stopLogging=function(){return W(this,void 0,void 0,(function(){var F;return z(this,(function(B){switch(B.label){case 0:return B.trys.push([0,2,,3]),[4,this.sendMessage(this.extensionId,{method:"logging.stop"})];case 1:return B.sent(),this.logger.safe.info("Logging stopped"),[3,3];case 2:return F=B.sent(),this.logger.safe.error("Error while stopping logging",F),[3,3];case 3:return[2]}}))}))},WebRtcInternalsCollector.prototype.storeLogs=function(){return W(this,void 0,void 0,(function(){var F;return z(this,(function(B){switch(B.label){case 0:return B.trys.push([0,2,,3]),[4,this.sendMessage(this.extensionId,{method:"logging.store",logId:this.logId})];case 1:return B.sent(),this.logger.safe.info("Logs stored to ".concat(this.logId)),[3,3];case 2:return F=B.sent(),this.logger.safe.error("Error while storing logs",F),[3,3];case 3:return[2]}}))}))},WebRtcInternalsCollector.prototype.gatherFromStorage=function(){return W(this,void 0,void 0,(function(){var F,B;return z(this,(function(G){switch(G.label){case 0:F=[],B={offset:0},G.label=1;case 1:return[4,this.sendMessage(this.editorExtensionId,{api:"getWebRtcLog",logId:this.logId,offset:B.offset})];case 2:B=G.sent(),F.push(B.data),this.logger.safe.info("Batch gathered with offset: ".concat(B.offset,", moreData: ").concat(B.moreData)),G.label=3;case 3:if(B.moreData)return[3,1];G.label=4;case 4:return this.logger.safe.info("Finished gathering"),[2,F]}}))}))},WebRtcInternalsCollector.prototype.sendMessage=function(F,B){return new Promise((function(G,W){var z=chrome.runtime;z.sendMessage(F,B,(function(F){if(!F||(null==F?void 0:F.error)){var K=F?JSON.stringify(F.error):z.lastError;W("sendMessage ".concat(JSON.stringify(B)," failed with error: ").concat(K))}G(F)}))}))},WebRtcInternalsCollector}();B.WebRtcInternalsCollector=J;var Q=function(){var F;function getInstance(B,G){return(null==G?void 0:G.config.enableWebRtcInternalsLogs)&&"EdgeAnaheim"===(0,K.getBrowserInfo)().name?(F||(F=new J(B)),F):(B.safe.info("WebRTC internal logging is disabled"),{collect:function(){return Promise.resolve("")},updateSessionCount:function(){return Promise.resolve()}})}return{getInstance:getInstance}}();B.default=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ScreenSharingManager=void 0;var W=function(){function SyntheticSharingSource(){}return SyntheticSharingSource.prototype.getId=function(){return 0},SyntheticSharingSource.prototype.getDeviceId=function(){return String(0)},SyntheticSharingSource.prototype.getPreviewAsync=function(F,B){return Promise.resolve(null)},SyntheticSharingSource.prototype.getDescription=function(){return"display"},SyntheticSharingSource.prototype.getType=function(){return 1},SyntheticSharingSource.prototype.getIcon=function(F,B){return Promise.resolve(null)},SyntheticSharingSource}(),z=function(){function ScreenSharingManager(){this.sharingSource=new W}return ScreenSharingManager.prototype.onScreensChanged=function(F){return{dispose:function(){}}},ScreenSharingManager.prototype.enumerateScreensAsync=function(){return Promise.resolve([this.sharingSource])},ScreenSharingManager.prototype.enumerateWindowsAsync=function(){return Promise.resolve([])},ScreenSharingManager.prototype.enumerateCamerasAsync=function(){return Promise.resolve([])},ScreenSharingManager}();B.ScreenSharingManager=z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0});var Y=G(13),$=G(4),X=G(358),Z=G(34),ee=G(359),te=G(360),ne=G(6),ie=G(361),re=G(362),oe=G(364),ae=G(365),se=G(1),ce=function(F){function Session(B,G,W,z,K,J,Q){var Y,$=this,te=W.getLogger().createChild("SessionV2",G);($=F.call(this,te)||this).context=W,$.callback=z,$.statistics=K,$.configProvider=J,$.diag=Q,$.audioStreamStates=((Y={})[Z.Constants.STREAMING_STATE.inactive]=[Z.Constants.STREAMING_STATE.active,Z.Constants.STREAMING_STATE.failed],Y[Z.Constants.STREAMING_STATE.active]=[Z.Constants.STREAMING_STATE.removed,Z.Constants.STREAMING_STATE.stopped,Z.Constants.STREAMING_STATE.failed],Y),$.mediaLegId=new ee.default,$.rejectedNegotiations=0,$.negotiationState=null,$.audioStreamState=Z.Constants.STREAMING_STATE.inactive,$.deviceManagerDisposables=[],$.logger=te,$.ufdManager=W.getUfdManager(),$.ufdManagerDisposable=$.ufdManager.on("onQualityChanged",(function(F){return $.qualityChanged(F)})),$.sessionOperationQueue=new ae.default($.logger),$.mediaLegId=new ee.default,$.diagnostics=new oe.SessionDiagnosticsWrapper($.statistics,$.diag),$.statistics.setId(G),$.diagnostics.mediaLegId=$.mediaLegId,$.diagnostics.ETag=$.configProvider.ETag,$.diagnostics.configIds=$.configProvider.ecsConfigIds,$.diagnostics.isMultiParty=!!W.config.isConference,$.recoverableErrors=$.configProvider.config.recoverableMediaErrors.split(",");var ne=$.getSessionCallbacks();return B.callbacks=ne,B.relayManagerProvider=$,$.reconnectManager=new re.default(B,W,new ie.ReconnectDiagnosticsWrapper($.statistics,$.diag?new X.ReconnectDiagnostics:void 0,$.diag),$.sessionOperationQueue,$.getReconnectManagerCallbacks(),ne,$.configProvider),$.deviceManager=$.context.getDeviceManager(),$.deviceManagerDisposables.push($.deviceManager.on("onDevicesPermissionChanged",(function(){return $.diagnostics.allowedModalities=$.getAllowedModalities()}))),$.deviceManagerDisposables.push($.deviceManager.on("onSelectedDevicesChanged",(function(){return $.deviceSelectionChanged()}))),$.deviceManagerDisposables.push($.deviceManager.on("onDevicesChanged",(function(){return $.deviceListChanged()}))),$.deviceManagerDisposables.push($.deviceManager.on("onMaxVideoSendCapabilitiesChanged",(function(F,B){return $.onMaxVideoSendCapabilitiesChanged(F,B)}))),$.statistics.setDevicesCount($.deviceManager.getDevicesCount()),$.ufdManager.applyCurrentState((function(F){return $.qualityChanged(F)})),$}return z(Session,F),Session.prototype.enableRealTimeTelemetry=function(){var F=this;this.realtimeMediaInterval||(this.logger.safe.info("realTimeTelemetry is enabled"),this.realtimeMediaInterval=window.setInterval((function(){F.getSessionCallbacks().onRealtimeTelemetryReport()}),this.configProvider.config.diagnostics.realtimeTelemetry.pollingInterval))},Session.prototype.getMediaStatsReport=function(){var F;return null===(F=this.diag)||void 0===F?void 0:F.mediaStatsReport},Session.prototype.createOfferAsync=function(F){var B=this;return this.sessionOperationQueue.queueOperation((function(){return K(B,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:this.diagnostics.negotiationStart("Offering"),W.label=1;case 1:return W.trys.push([1,3,,4]),[4,this.getCurrentSession().createOfferAsync(F)];case 2:return B=W.sent(),this.updateSelectedDevices(),B.mediaLegId=this.mediaLegId.process(B.mediaLegId),this.diagnostics.mediaLegId=this.mediaLegId,this.reconnectManager.isReconnecting()&&!this.reconnectManager.isSignalingStable()&&(this.reconnectManager.registerRetargetOutgoing(),B.newOffer=!0),[2,B];case 3:throw G=W.sent(),this.diagnostics.sessionError=G,G;case 4:return[2]}}))}))}),F)},Session.prototype.processOfferAsync=function(F,B){var G=this;return this.sessionOperationQueue.queueOperation((function(){return K(G,void 0,void 0,(function(){var G,W,z;return J(this,(function(K){switch(K.label){case 0:this.diagnostics.negotiationStart("Answering"),F.mediaLegId=this.mediaLegId.process(F.mediaLegId),K.label=1;case 1:return K.trys.push([1,7,,8]),F.newOffer?[4,this.reconnectManager.acceptReconnectStartAsync(F.escalationOccurring,B)]:[3,3];case 2:K.sent(),K.label=3;case 3:return[4,this.getCurrentSession().processOfferAsync(F,B)];case 4:return G=K.sent(),F.newOffer?[4,this.reconnectManager.acceptReconnectFinish(B)]:[3,6];case 5:return W=K.sent(),G.sharing===$.default.MEDIA_STATE.sendReceive&&(G.sharing=W.sharing===$.default.MEDIA_STATE.send?$.default.MEDIA_STATE.send:$.default.MEDIA_STATE.receive),[2,G];case 6:return[2,G];case 7:throw z=K.sent(),this.diagnostics.sessionError=z,z;case 8:return[2]}}))}))}),B)},Session.prototype.processAnswerAsync=function(F,B,G){return K(this,void 0,void 0,(function(){var W;return J(this,(function(z){switch(z.label){case 0:return z.trys.push([0,2,,3]),[4,this.getCurrentSession().processAnswerAsync(F,B,G)];case 1:return[2,z.sent()];case 2:throw W=z.sent(),this.diagnostics.sessionError=W,W;case 3:return[2]}}))}))},Session.prototype.completeNegotiationAsync=function(F){var B,G;return K(this,void 0,void 0,(function(){var W,z;return J(this,(function(K){switch(K.label){case 0:this.rejectedNegotiations=0,K.label=1;case 1:return K.trys.push([1,4,,5]),[4,this.getCurrentSession().completeNegotiationAsync(F)];case 2:return W=K.sent(),this.negotiationState=W,this.diagnostics.finalAnswerTime=Date.now(),null===(G=(B=this.diagnostics).negotiationCompleted)||void 0===G||G.call(B),[4,this.reconnectManager.onNegotiationCompletedAsync(F)];case 3:return K.sent(),this.sessionOperationQueue.completeCurrentOperation(),[2,this.negotiationState];case 4:throw z=K.sent(),this.diagnostics.sessionError=z,z;case 5:return[2]}}))}))},Session.prototype.rejectNegotiationAsync=function(F,B){return K(this,void 0,void 0,(function(){var G,W;return J(this,(function(z){switch(z.label){case 0:this.logger.safe.info("[".concat(B,"] rejectNegotiationAsync"),F),z.label=1;case 1:return z.trys.push([1,6,,7]),this.reconnectManager.isReconnecting()?[4,this.reconnectManager.onNegotiationRejection(F,B)]:[3,3];case 2:return z.sent(),this.registerNegotiationRejection(this.negotiationState),this.sessionOperationQueue.completeCurrentOperation(),[2,this.negotiationState];case 3:return[4,this.getCurrentSession().rejectNegotiationAsync(F,B,this.isRenegotiationAllowed(F.type))];case 4:return G=z.sent(),this.sessionOperationQueue.completeCurrentOperation(),this.registerNegotiationRejection(G),[2,G];case 5:return[3,7];case 6:throw W=z.sent(),this.diagnostics.sessionError=W,W;case 7:return[2]}}))}))},Session.prototype.completeEscalationAsync=function(F){return this.reconnectManager.completeReconnect(F)},Session.prototype.rejectEscalationAsync=function(F){return this.reconnectManager.rejectReconnect(F)},Session.prototype.terminate=function(F,B){return K(this,void 0,void 0,(function(){var G,W,z,K=this;return J(this,(function(J){switch(J.label){case 0:return W=(G=this.statistics).setPermissionStates,[4,this.deviceManager.getKnownPermissionStates()];case 1:return W.apply(G,[J.sent()]),this.diagnostics.terminated(B),z=function(){return K.cleanUp()},[2,this.reconnectManager.terminateAsync(F).then(z,z)]}}))}))},Session.prototype.getStatsAsync=function(F){var B;return K(this,void 0,void 0,(function(){var G=this;return J(this,(function(W){return[2,this.configProvider.config.diagnostics.useForTelemetry?null===(B=this.diag)||void 0===B?void 0:B.telemetryReport:this.getMainSession().getStatsAsync(F).then((function(F){return G.prepareStats(F)}))]}))}))},Session.prototype.getLastKnownStats=function(F){var B;return void 0===F&&(F=!1),this.configProvider.config.diagnostics.useForTelemetry?null===(B=this.diag)||void 0===B?void 0:B.telemetryReport:this.prepareStats(this.getMainSession().getLastKnownStats(F),F)},Session.prototype.getCallTechnicalInfo=function(){var F;return null===(F=this.diag)||void 0===F?void 0:F.realtimeTelemetryReport},Session.prototype.createAnswerAsync=function(F,B){return K(this,void 0,void 0,(function(){var G,W;return J(this,(function(z){switch(z.label){case 0:return z.trys.push([0,2,,3]),[4,this.getCurrentSession().createAnswerAsync(F,B)];case 1:return G=z.sent(),this.updateSelectedDevices(),G.mediaLegId=this.mediaLegId.process(G.mediaLegId),this.diagnostics.mediaLegId=this.mediaLegId,[2,G];case 2:throw W=z.sent(),this.diagnostics.sessionError=W,W;case 3:return[2]}}))}))},Session.prototype.configureModalitiesAsync=function(F,B){return se.forOwn(F,(function(B,G){B||delete F[G]})),this.reconnectManager.configureModalitiesAsync(F,B)},Session.prototype.getAllowedModalities=function(){return this.deviceManager.getAllowedModalities()},Session.prototype.createRemoteRenderer=function(F){return this.getMainSession().createRemoteRenderer(F)},Session.prototype.sendDtmf=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:return W.trys.push([0,2,,3]),[4,this.getMainSession().sendDtmf(F)];case 1:return B=W.sent(),this.diagnostics.dtmfResult=!0,[2,B];case 2:throw G=W.sent(),this.diagnostics.dtmfResult=!1,G;case 3:return[2]}}))}))},Session.prototype.canSendDtmf=function(){return this.reconnectManager.canSendDtmf()},Session.prototype.getExtensionsManager=function(){return this.reconnectManager.getExtensionsManager()},Session.prototype.muteHold=function(F,B){this.reconnectManager.muteHold(F,B)},Session.prototype.muteInputAsync=function(F){return this.diagnostics.swMute=!0,this.ufdManager.setSwMute(!0),this.reconnectManager.muteInputAsync(F)},Session.prototype.unmuteInputAsync=function(F){return this.diagnostics.swMute=!1,this.ufdManager.setSwMute(!1),this.reconnectManager.unmuteInputAsync(F)},Session.prototype.muteOutputAsync=function(F){return this.diagnostics.speakerMute=!0,this.reconnectManager.muteOutputAsync(F)},Session.prototype.unmuteOutputAsync=function(F){return this.diagnostics.speakerMute=!1,this.reconnectManager.unmuteOutputAsync(F)},Session.prototype.getAcceptedTypes=function(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()},Session.prototype.useNullAudioStreamClient=function(){this.getCurrentSession().useNullAudioStreamClient()},Session.prototype.createAudioElement=function(F){this.getCurrentSession().createAudioElement(F)},Session.prototype.getIncomingRawAudioStream=function(){return this.diagnostics.registerRawMediaAccess("audio","recv",!0),this.getCurrentSession().getIncomingRawAudioStream()},Session.prototype.deviceSelectionChanged=function(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()},Session.prototype.registerDeviceTelemetryEvent=function(F){this.getCurrentSession().onDeviceEvent(F),this.statistics.registerDeviceTelemetryEvent(F)},Session.prototype.registerVideoEffectsTelemetryEvent=function(F){this.statistics.registerVideoEffectsTelemetryEvent(F)},Session.prototype.registerAudioEffectsTelemetryEvent=function(F){this.statistics.registerAudioEffectsTelemetryEvent(F)},Session.prototype.reconnectAsync=function(F,B){return void 0===B&&(B=!1),this.reconnectManager.reconnectAsync(F,!0,B)},Session.prototype.isReconnecting=function(){return this.reconnectManager.isReconnecting()},Session.prototype.onMaxVideoSendCapabilitiesChanged=function(F,B){this.reconnectManager.getCurrentSession().onMaxVideoSendCapabilitiesChanged(F,B)},Session.prototype.getRelayManager=function(){var F;return null!==(F=this.relayManager)&&void 0!==F?F:this.relayManager=new te.default(this.context.maContext.getRelayManager(),this.diagnostics)},Session.prototype.getSessionConfig=function(){return this.reconnectManager.getCurrentSession().getSessionConfig()},Session.prototype.getLocalMediaTrackId=function(F){return this.reconnectManager.getMainSession().getLocalMediaTrackId(F)},Session.prototype.getSubscriptionManager=function(){return this.getCurrentSession().getSubscriptionManager()},Session.prototype.cleanUp=function(){this.callback=null,this.deviceManagerDisposables.forEach((function(F){return F.dispose()})),this.ufdManagerDisposable.dispose(),window.clearInterval(this.realtimeMediaInterval)},Session.prototype.updateSelectedDevices=function(){var F=this,B=this.deviceManager.getSelectedDevices(),getDeviceName=function(B){return B?F.deviceManager.getDeviceNameAsync(B).then((function(B){return se.scrubDeviceLabelPii(B,F.configProvider.config.devices.piiSafeWords)})):Promise.resolve("none")};Promise.all([getDeviceName(B.microphone),getDeviceName(B.speaker),getDeviceName(B.camera)]).then((function(B){var G=Q(B,3),W=G[0],z=G[1],K=G[2];F.statistics.setUsedDevices({microphone:W,speaker:z,camera:K})}))},Session.prototype.getCurrentSession=function(){return this.reconnectManager.getCurrentSession()},Session.prototype.getMainSession=function(){return this.reconnectManager.getMainSession()},Session.prototype.setAudioStreamState=function(F,B){this.isAudioStateValid(F)?this.raiseAudioStateChanged(F,B):this.logger.safe.error("[".concat(B,"] audio state transition is invalid: ").concat(this.audioStreamState," -> ").concat(F))},Session.prototype.isAudioStateValid=function(F){return this.audioStreamStates[this.audioStreamState].indexOf(F)>=-1},Session.prototype.raiseAudioStateChanged=function(F,B){if(this.logger.safe.info("[".concat(B,"] audio state changed to ").concat(F)),this.callback.onAudioStateChanged){var G={content:"audio",direction:"receive",stream:F};this.callback.onAudioStateChanged(G)}},Session.prototype.getReconnectManagerCallbacks=function(){var F=this;return{onSessionErrorOccurred:function(B,G){F.isNetworkMediaError(B)&&F.ufdManager.raisePendingWhitelistingUFD(),F.endCallOnFailure(B,G)}}},Session.prototype.isNetworkMediaError=function(F){return F.type===Z.Constants.MEDIA_ERROR.iceConnectionError||F.type===Z.Constants.MEDIA_ERROR.noNetworkError},Session.prototype.isRecoverableMediaError=function(F){return this.recoverableErrors.indexOf(F.type)>-1},Session.prototype.startReconnect=function(F){return void 0===F&&(F=(0,Y.generateCauseId)()),this.reconnectManager.onIceDisconnect(F)},Session.prototype.getSessionCallbacks=function(){var F=this;return this.sessionCallbacks||(this.sessionCallbacks={onTerminated:function(){F.logger.safe.warn("call onTerminated"),F.event("onTerminated").raise(F)},onSessionErrorOccurred:function(B,G){if(void 0===G&&(G=(0,Y.generateCauseId)()),F.isRecoverableMediaError(B)){if(F.reconnectManager.isReconnecting())return F.reconnectManager.onSessionErrorOccurred(B,G);if(F.getCurrentSession().isReconnectSupported())return F.startReconnect(G)}return F.endCallOnFailure(B,G),Promise.resolve()},onNegotiationRequired:function(B){return F.callback.onNegotiationRequired(B)},onAudioHwSilentChanged:function(B){F.diagnostics.hwSilent=B},onAudioStateChanged:function(B,G){F.setAudioStreamState(B,G)},onTransportConnected:function(B){void 0===B&&(B=(0,Y.generateCauseId)()),F.logger.safe.info("[".concat(B,"] Transport connectivity established")),F.ufdManager.cancelPendingWhitelistingUFD(),F.reconnectManager.onConnected(B),F.diagnostics.registerTransportConnected(),F.diagnostics.iceConnectedStateTimestamp=Date.now()},onTransportDisconnected:function(B){return void 0===B&&(B=(0,Y.generateCauseId)()),F.logger.safe.warn("[".concat(B,"] Transport connectivity lost")),F.reconnectManager.onTransportDisconnect(B),F.diagnostics.registerTransportDisconnected(),F.getCurrentSession().isReconnectSupported()&&F.configProvider.config.reconnectOnDisconnect?F.startReconnect(B):Promise.resolve()},onTransportFailed:function(){F.diagnostics.registerTransportFailed()},onTransportInitialized:function(){F.diagnostics.iceInitTime=Date.now()},onUpdateMediaDescriptions:function(B,G){return F.callback.onUpdateMediaDescriptions(B,G)},onRealtimeTelemetryReport:function(){return F.callback.onRealtimeTelemetryReport()}}),this.sessionCallbacks},Session.prototype.registerNegotiationRejection=function(F){var B,G;this.rejectedNegotiations++,null===(G=(B=this.diagnostics).negotiationRejected)||void 0===G||G.call(B),F.rollback&&this.diagnostics.registerRollbackEvent(F.rollback)},Session.prototype.isRenegotiationAllowed=function(F){return this.rejectedNegotiations<this.context.configProvider.config.renegotiationAttempts&&!this.reconnectManager.isReconnectScheduled&&(Z.Constants.RENEGOTIATION_ERROR.signaling===F||Z.Constants.RENEGOTIATION_ERROR.media===F)},Session.prototype.prepareStats=function(F,B){return void 0===B&&(B=!1),this.statistics.setDeviceList(this.deviceManager.getDeviceDescriptions(),this.deviceManager.getDeviceListDebugInfo()),this.statistics.setRelayManagerTimers(this.getRelayManager().getStats()),this.statistics.setVideoEffectStats(this.deviceManager.videoEffectManager.getStats()),this.statistics.setAudioEffectStats(this.deviceManager.audioEffectManager.getStats()),this.statistics.generateStatistics(F,this.mediaLegId,B)},Session.prototype.deviceListChanged=function(){this.deviceManager.isPollingInProgress&&this.statistics.deviceChangedByPoll(),this.statistics.devicesChanged(),this.statistics.setDevicesCount(this.deviceManager.getDevicesCount())},Session.prototype.qualityChanged=function(F){this.callback&&this.callback.onQualityChanged&&(this.diagnostics.registerQualityStateChangedEvent(F),"DeviceSpeakWhileMuted"===F.type&&(this.diagnostics.isSpeaking="Good"!==F.value),this.callback.onQualityChanged(F))},Session.prototype.endCallOnFailure=function(F,B){this.callback&&(this.callback.onSessionErrorOccurred&&this.callback.onSessionErrorOccurred(F,B),this.diagnostics.sessionError=F,this.setAudioStreamState(Z.Constants.STREAMING_STATE.failed,B))},Session}(ne.default);B.default=ce},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ReconnectDiagnostics=void 0;var W=function(){function ReconnectDiagnostics(){this.data={records:[],isReconnecting:!1,reconnectCount:{attempted:0,connected:0},retargetCount:{incoming:0,outgoing:0,completed:0,rejected:0},escalationCount:{attempted:0,completed:0,rejected:0}}}return ReconnectDiagnostics.prototype.registerReconnectAttempt=function(F){this.activeRecord&&(this.activeAttempt={direction:F,startTime:Date.now(),status:!1},this.data.isReconnecting=!0,this.activeRecord.attempts.push(this.activeAttempt))},ReconnectDiagnostics.prototype.registerReconnectAttemptStatus=function(F){"completed"===F&&(this.data.isReconnecting=!1),this.activeAttempt&&this.activeRecord&&(this.activeAttempt.endTime=Date.now(),this.activeAttempt.status="completed"===F)},ReconnectDiagnostics.prototype.registerReconnect=function(F){if(this.data.reconnectCount[F]++,this.data.isReconnecting="attempted"===F,"attempted"===F){if(this.activeRecord)return;this.activeRecord={startTime:Date.now(),attempts:[]},this.data.records.push(this.activeRecord)}else if("connected"===F){if(!this.activeRecord)return;this.activeRecord.endTime=Date.now(),this.activeRecord=void 0,this.activeAttempt=void 0}},ReconnectDiagnostics.prototype.registerRetarget=function(F){this.data.retargetCount[F]++},ReconnectDiagnostics.prototype.registerEscalation=function(F){this.data.escalationCount[F]++},ReconnectDiagnostics.prototype.getObject=function(){return this.data},ReconnectDiagnostics}();B.ReconnectDiagnostics=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(1),z=function(){function MediaLegId(){}return MediaLegId.prototype.process=function(F){return this.mediaLegId=F||this.mediaLegId||W.uniqueId().toUpperCase(),this.mediaLegId},MediaLegId}();B.default=z},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var K=function(){function RelayManagerStatisticsDecorator(F,B){this.relayManager=F,this.diagnostics=B}return RelayManagerStatisticsDecorator.prototype.initialize=function(){},RelayManagerStatisticsDecorator.prototype.queryRelaysAsync=function(F){return W(this,void 0,void 0,(function(){var B;return z(this,(function(G){switch(G.label){case 0:return[4,this.relayManager.queryRelaysAsync(F)];case 1:return(B=G.sent()).length>0&&(this.diagnostics.relay=B[0]),[2,B]}}))}))},RelayManagerStatisticsDecorator.prototype.getStats=function(){var F,B,G;return null!==(G=null===(B=(F=this.relayManager).getStats)||void 0===B?void 0:B.call(F))&&void 0!==G?G:{unavailable:"1"}},RelayManagerStatisticsDecorator}();B.default=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ReconnectDiagnosticsWrapper=void 0;var W=function(){function ReconnectDiagnosticsWrapper(F,B,G){this.stats=F,this.diag=B,G&&B&&(G.reconnect=B.getObject())}return ReconnectDiagnosticsWrapper.prototype.registerReconnectAttempt=function(F){var B;this.stats.registerReconnectAttempt(F),null===(B=this.diag)||void 0===B||B.registerReconnectAttempt(F)},ReconnectDiagnosticsWrapper.prototype.registerReconnectAttemptStatus=function(F){var B;switch(F){case"completed":this.stats.registerReconnectAttemptCompleted();break;case"rejected":this.stats.registerReconnectAttemptRejected()}null===(B=this.diag)||void 0===B||B.registerReconnectAttemptStatus(F)},ReconnectDiagnosticsWrapper.prototype.registerReconnect=function(F){var B;switch(F){case"attempted":this.stats.registerReconnectAttempted();break;case"connected":this.stats.registerReconnectConnected()}null===(B=this.diag)||void 0===B||B.registerReconnect(F)},ReconnectDiagnosticsWrapper.prototype.registerRetarget=function(F){var B;switch(F){case"completed":this.stats.registerRetargetCompleted();break;case"rejected":this.stats.registerRetargetRejected();break;case"incoming":this.stats.registerRetargetIncoming();break;case"outgoing":this.stats.registerRetargetOutgoing()}null===(B=this.diag)||void 0===B||B.registerRetarget(F)},ReconnectDiagnosticsWrapper.prototype.registerEscalation=function(F){var B;switch(F){case"attempted":this.stats.registerEscalationStart();break;case"completed":this.stats.registerEscalationCompleted();break;case"rejected":this.stats.registerEscalationRejected()}null===(B=this.diag)||void 0===B||B.registerEscalation(F)},ReconnectDiagnosticsWrapper}();B.ReconnectDiagnosticsWrapper=W},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0});var J=G(40),Q=G(1),Y=G(4),$=(G(34),G(363)),X=function(){function ReconnectManager(F,B,G,W,z,K,J){this.session=F,this.context=B,this.diagnostics=G,this.sessionOperationQueue=W,this.callback=z,this.sessionCallbacks=K,this.configProvider=J,this.wasConnected=!1,this.isDisconnected=!1,this.isReconnectConference=!1,this.escalationType=0,this._isSignalingStable=!0,this.reconnectDelayTime=0,this._isReconnectScheduled=!1,this.logger=B.getLogger().createChild("ReconnectManagerV2"),this.ufdManager=B.getUfdManager(),this.session.callbacks=K,this.reconnectManagerMessageQueue=new $.default(K)}return Object.defineProperty(ReconnectManager.prototype,"settings",{get:function(){return(this.reconnectSession||this.session).getSessionConfig().config},enumerable:!1,configurable:!0}),ReconnectManager.prototype.getCurrentSession=function(){return this.reconnectSession||this.session},ReconnectManager.prototype.getMainSession=function(){return this.session||this.reconnectSession},ReconnectManager.prototype.getReconnectSession=function(){return this.reconnectSession},ReconnectManager.prototype.onIceDisconnect=function(F){return this.logger.safe.info("[".concat(F,"] reconnect attempt after iceDisconnect error")),this.wasConnected&&this.raiseReconnectEvent("Bad",F),this.isDisconnected=!0,this.isReconnecting()?Promise.resolve():(this.diagnostics.registerReconnect("attempted"),this.reconnectAsync(F))},ReconnectManager.prototype.onTransportDisconnect=function(F){this.isDisconnected=!0,this.wasConnected&&this.raiseConnectivityLostUFD(F)},ReconnectManager.prototype.onConnected=function(F){this.isDisconnected=!1,this.logger.safe.info("[".concat(F,"] set allow UFD")),this.raiseReconnectEvent("Good",F),this.wasConnected=!0,clearTimeout(this.losingConnectivityTimer)},ReconnectManager.prototype.onNegotiationCompletedAsync=function(F){return this.logger.safe.info("[".concat(F,"] handle negotiation completed")),this.setSignalingState(!0),this.isReconnecting()&&(this.diagnostics.registerRetarget("completed"),2===this.escalationType&&this.blockCurrentSession(F)),Promise.resolve()},ReconnectManager.prototype.onSessionErrorOccurred=function(F,B){var G=this;return this.logger.safe.info("[".concat(B,"] handle session error"),Q.stringifyObject(F)),this.rejectReconnect(B).then((function(){return G.isReconnectAllowed()?G.scheduleReconnectRetry(B,!1,!1):G.callback.onSessionErrorOccurred(F,B)}))},ReconnectManager.prototype.onNegotiationRejection=function(F,B){var G=this;this.logger.safe.info("[".concat(B,"] handle negotiation rejection")),this.diagnostics.registerRetarget("rejected");var W=1===this.escalationType;return this.rejectReconnect(B).then((function(){var z=F.type===Y.default.RENEGOTIATION_ERROR.glare&&W;(F.type!==Y.default.RENEGOTIATION_ERROR.glare||W)&&(G.isRecoverableError(F.type)||z?G.scheduleReconnectRetry(B,z,W):G.onReconnectFailed(Q.stringifyObject(F),B))}))},ReconnectManager.prototype.reconnectAsync=function(F,B,G){var W=this;return void 0===B&&(B=!1),void 0===G&&(G=!1),this.logger.safe.info("[".concat(F,"] queueing reconnect, force=").concat(B,", escalation=").concat(G)),this.diagnostics.registerReconnectAttempt(G?"local escalation":"out"),this._isReconnectScheduled=!0,G&&(this.escalationType=1),this.sessionOperationQueue.queueOperation((function(){return W._isReconnectScheduled=!1,!B&&W.session&&W.session.isConnected()?(W.logger.safe.info("[".concat(F,"] old session is active reconnect")),W.isReconnecting()||W.diagnostics.registerReconnect("connected"),W.sessionOperationQueue.completeCurrentOperation(),Promise.resolve()):W.reconnectSession&&W._isSignalingStable?(W.logger.safe.info("[".concat(F,"] ongoing reconnect is in progress")),W.sessionOperationQueue.completeCurrentOperation(),Promise.resolve()):W.initReconnect(F).then((function(){return W.reconnectSession.configureModalitiesAsync(W.getConfiguredModalities(),F)})).then((function(){W.sessionOperationQueue.completeCurrentOperation()}))}),F)},ReconnectManager.prototype.acceptReconnectStartAsync=function(F,B){return this.logger.safe.info("[".concat(B,"] accepting reconnect")),this.diagnostics.registerRetarget("incoming"),F?(this.escalationType=2,this.diagnostics.registerEscalation("attempted")):(!this.isReconnecting()&&this.isDisconnected?this.diagnostics.registerReconnect("attempted"):this.isReconnecting()&&this.rejectReconnect(B),this.diagnostics.registerReconnectAttempt("in")),this.initReconnect(B)},ReconnectManager.prototype.acceptReconnectFinish=function(F){var B=this.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(B,F).then((function(){return B}))},ReconnectManager.prototype.isReconnecting=function(){return!!this.reconnectSession},ReconnectManager.prototype.isReconnectScheduled=function(){return this._isReconnectScheduled},ReconnectManager.prototype.cleanUp=function(){this.sessionCallbacks=null,this.reconnectSession=null},ReconnectManager.prototype.terminateAsync=function(F){var B;return z(this,void 0,void 0,(function(){return K(this,(function(G){switch(G.label){case 0:return G.trys.push([0,2,,3]),[4,null===(B=this.session)||void 0===B?void 0:B.terminate(F,{})];case 1:return G.sent(),[3,3];case 2:return G.sent(),[3,3];case 3:return G.trys.push([3,5,,6]),[4,this.terminateReconnectSessionAsync(F,!0)];case 4:return G.sent(),[3,6];case 5:return G.sent(),[3,6];case 6:return this.cleanUp(),[2]}}))}))},ReconnectManager.prototype.completeReconnect=function(F){return this.logger.safe.info("[".concat(F,"] completing reconnect")),2===this.escalationType&&(this.unblockCurrentSession(),this.diagnostics.registerEscalation("completed")),this.escalationType=0,this.reconnectSession&&(this.context.config.isConference=this.isReconnectConference,this.disposeActiveSession(F),this.session=this.reconnectSession,this.reconnectManagerMessageQueue.clear(),this.diagnostics.registerReconnectAttemptStatus("completed"),this._isSignalingStable||this.diagnostics.registerRetarget("completed"),this.isDisconnected&&this.diagnostics.registerReconnect("connected"),this.resetReconnectTimer(),this.reconnectDelayTime=0,this.reconnectSession=null,this.negotiationPausePromise=null,this.session.callbacks=this.sessionCallbacks||{}),Promise.resolve()},ReconnectManager.prototype.rejectReconnect=function(F){return z(this,void 0,void 0,(function(){return K(this,(function(B){switch(B.label){case 0:return this.logger.safe.info("[".concat(F,"] rejecting reconnect")),this.setSignalingState(!1),2===this.escalationType&&this.diagnostics.registerEscalation("rejected"),this.escalationType=0,this.reconnectSession?[4,this.terminateReconnectSessionAsync(F,!1)]:[3,2];case 1:B.sent(),this.diagnostics.registerReconnectAttemptStatus("rejected"),B.label=2;case 2:return this.session&&(this.reconnectManagerMessageQueue.flush(),this.session.callbacks=this.sessionCallbacks,this.unblockCurrentSession()),[2]}}))}))},ReconnectManager.prototype.configureModalitiesAsync=function(F,B){this.lastKnownConfiguredModalities=F;var G=[];return this.session&&G.push(this.session.configureModalitiesAsync(F,B)),this.reconnectSession&&G.push(this.reconnectSession.configureModalitiesAsync(F,B)),Promise.all(G).then((function(){return Promise.resolve()}))},ReconnectManager.prototype.canSendDtmf=function(){return this.getMainSession().canSendDtmf()},ReconnectManager.prototype.getExtensionsManager=function(){return this.getMainSession().getExtensionsManager()},ReconnectManager.prototype.muteHold=function(F,B){this.getMainSession().muteHold(F,B)},ReconnectManager.prototype.muteInputAsync=function(F){return this.getMainSession().muteInputAsync(F)},ReconnectManager.prototype.unmuteInputAsync=function(F){return this.getMainSession().unmuteInputAsync(F)},ReconnectManager.prototype.muteOutputAsync=function(F){return this.getMainSession().muteOutputAsync(F)},ReconnectManager.prototype.unmuteOutputAsync=function(F){return this.getMainSession().unmuteOutputAsync(F)},ReconnectManager.prototype._deviceSelectionChanged=function(){this.session&&this.session._deviceSelectionChanged(),this.reconnectSession&&this.reconnectSession._deviceSelectionChanged()},ReconnectManager.prototype.disposeActiveSession=function(F){if(this.session&&this.isReconnecting()){this.logger.safe.info("[".concat(F,"] About to dispose current session..."));var B=this.session;return this.lastKnownConfiguredModalities=this.session.getConfiguredModalities(),B.callbacks=this.reconnectManagerMessageQueue.queueCallbacks,B.move(this.reconnectSession,F),this.session=null,B.terminate(F,{},!1)}return Promise.resolve()},ReconnectManager.prototype.registerRetargetOutgoing=function(){this.diagnostics.registerRetarget("outgoing")},ReconnectManager.prototype.isSignalingStable=function(){return this._isSignalingStable},ReconnectManager.prototype.getConfiguredModalities=function(){return this.getMainSession().getConfiguredModalities()||this.lastKnownConfiguredModalities},ReconnectManager.prototype.scheduleReconnectRetry=function(F,B,G){var W=this,z=this.getReconnectDelayTime(),K="the time limit was reached";return(0,J.delay)(z).then((function(){return W.isReconnectAllowed()||B?W.reconnectAsync(F,G,G):!W.session||W.session.isFailed()?W.onReconnectFailed(K,F):void 0}))},ReconnectManager.prototype.isRecoverableError=function(F){return Y.default.RENEGOTIATION_ERROR.media===F||Y.default.RENEGOTIATION_ERROR.signaling===F},ReconnectManager.prototype.resetReconnectSession=function(F){var B=this,G=null;this.logger.safe.info("[".concat(F,"] Resetting reconnect session. Session exists: old: ").concat(!!this.session,", new: ").concat(!!this.reconnectSession)),this.isReconnectConference=0!==this.escalationType||this.context.config.isConference;var z=0!==this.escalationType||this.context.config.isConference&&this.wasConnected&&!this.isDisconnected;(G=this.getMainSession().clone(z,this.configProvider.getConfigView(z))).callbacks=W(W({},this.sessionCallbacks),{onTransportConnected:function(F){2!==B.escalationType&&B.completeReconnect(F),B.raiseReconnectEvent("Good",F),B.sessionCallbacks.onTransportConnected(F)}}),this.session&&(this.session.callbacks=W(W({},this.reconnectManagerMessageQueue.queueCallbacks),{onSessionErrorOccurred:function(F,G){return F.type!==Y.default.MEDIA_ERROR.iceConnectionError&&B.reconnectManagerMessageQueue.queueCallbacks.onSessionErrorOccurred(F,G),Promise.resolve()}})),this.reconnectSession&&(this.reconnectSession.move(G,F),this.logger.safe.info("[".concat(F,"] reconnect session still exists during reconnect clone operation")),this.terminateReconnectSessionAsync(F,!1)),this.logger.safe.info("[".concat(F,"] New session reset.")),this.reconnectSession=G},ReconnectManager.prototype.initReconnect=function(F){return this.logger.safe.info("[".concat(F,"] initiate reconnect")),this.setReconnectTimer(),this.resetReconnectSession(F),this.setSignalingState(!1),this.session?(this.blockCurrentSession(F),Promise.all([this.reconnectSession.muteInputAsync(F),this.reconnectSession.muteOutputAsync(F)]).then((function(){return Promise.resolve()}))):Promise.resolve()},ReconnectManager.prototype.blockCurrentSession=function(F){this.session.pauseNegotiations&&(this.negotiationPausePromise=this.session.pauseNegotiations(F))},ReconnectManager.prototype.unblockCurrentSession=function(){this.negotiationPausePromise&&(this.negotiationPausePromise.resolve(),this.negotiationPausePromise=null)},ReconnectManager.prototype.raiseReconnectEvent=function(F,B){this.ufdManager.signalEvent("NetworkReconnect",F,"Audio",!0,B)},ReconnectManager.prototype.terminateReconnectSessionAsync=function(F,B){return z(this,void 0,void 0,(function(){var G;return K(this,(function(z){switch(z.label){case 0:return this.reconnectSession?(G=new $.default(this.sessionCallbacks),this.reconnectSession.callbacks=W(W({},G.queueCallbacks),{onTerminated:B?this.sessionCallbacks.onTerminated:G.queueCallbacks.onTerminated}),[4,this.reconnectSession.terminate(F,{},!1)]):[3,2];case 1:z.sent(),G.clear(),this.reconnectSession=null,z.label=2;case 2:return[2]}}))}))},ReconnectManager.prototype.setReconnectTimer=function(){var F=this,B=this.wasConnected?this.settings.reconnectTimeLimit:this.settings.initialReconnectTimeLimit;B>0&&!this.reconnectTimer&&(this.reconnectTimer=window.setTimeout((function(){return F.resetReconnectTimer()}),B))},ReconnectManager.prototype.resetReconnectTimer=function(){clearTimeout(this.reconnectTimer),this.reconnectTimer=null},ReconnectManager.prototype.isReconnectAllowed=function(){return!!this.reconnectTimer},ReconnectManager.prototype.getReconnectDelayTime=function(){return 1e3*Math.min(++this.reconnectDelayTime,this.settings.maxReconnectDelayTime)},ReconnectManager.prototype.onReconnectFailed=function(F,B){this.callback.onSessionErrorOccurred({type:Y.default.MEDIA_ERROR.iceConnectionError,detail:"Reconnect failed, error - ".concat(Q.stringifyObject(F))},B)},ReconnectManager.prototype.setSignalingState=function(F){this._isSignalingStable=F},ReconnectManager.prototype.raiseConnectivityLostUFD=function(F){var B=this;-1!==this.settings.losingConnectivityTimeoutMs&&(this.losingConnectivityTimer=window.setTimeout((function(){return B.raiseReconnectEvent("Poor",F)}),this.settings.losingConnectivityTimeoutMs))},ReconnectManager}();B.default=X},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function ReconnectManagerMessageQueue(F){this.initialCallbacks=F,this.queueCallbacks={onTerminated:this.genCallback(this.initialCallbacks.onTerminated),onSessionErrorOccurred:this.genCallback(this.initialCallbacks.onSessionErrorOccurred),onNegotiationRequired:this.genCallback(this.initialCallbacks.onNegotiationRequired),onAudioStateChanged:this.genCallback(this.initialCallbacks.onAudioStateChanged),onAudioHwSilentChanged:this.genCallback(this.initialCallbacks.onAudioHwSilentChanged),onTransportDisconnected:this.genCallback(this.initialCallbacks.onTransportDisconnected),onTransportConnected:this.genCallback(this.initialCallbacks.onTransportConnected),onTransportInitialized:this.genCallback(this.initialCallbacks.onTransportInitialized),onTransportFailed:this.genCallback(this.initialCallbacks.onTransportFailed),onUpdateMediaDescriptions:this.genCallback(this.initialCallbacks.onUpdateMediaDescriptions),onRealtimeTelemetryReport:this.genCallback(this.initialCallbacks.onRealtimeTelemetryReport)},this.queue=[]}return ReconnectManagerMessageQueue.prototype.flush=function(){this.queue.forEach((function(F){F.method.apply(null,F.args)})),this.clear()},ReconnectManagerMessageQueue.prototype.clear=function(){this.queue=[]},ReconnectManagerMessageQueue.prototype.genCallback=function(F){var B=this;return function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];return B.queue.push({method:F,args:G})}},ReconnectManagerMessageQueue}();B.default=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SessionDiagnosticsWrapper=void 0;var W=function(){function SessionDiagnosticsWrapper(F,B){this.stats=F,this.diagnostics=B}return Object.defineProperty(SessionDiagnosticsWrapper.prototype,"mediaLegId",{set:function(F){this.stats.setMediaLegId(F.process()),this.diagnostics&&(this.diagnostics.mediaLegId=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"isMultiParty",{set:function(F){F&&this.stats.setMultiParty(),this.diagnostics&&(this.diagnostics.isMultiParty=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"allowedModalities",{set:function(F){this.stats.setSendModalities(F),this.diagnostics&&(this.diagnostics.allowedModalities=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"sessionError",{set:function(F){this.stats.setError(F),this.diagnostics&&(this.diagnostics.sessionError=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"finalAnswerTime",{set:function(F){this.stats.setFinalAnswerTimestamp(F),this.diagnostics&&(this.diagnostics.finalAnswerTime=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"dtmfResult",{set:function(F){this.stats.dtmfResult(F),this.diagnostics&&(this.diagnostics.dtmfResult=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"swMute",{set:function(F){this.stats.setSwMute(F),this.diagnostics&&(this.diagnostics.swMute=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"speakerMute",{set:function(F){this.stats.setSpeakerMute(F),this.diagnostics&&(this.diagnostics.speakerMute=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"hwSilent",{set:function(F){this.stats.setHwSilent(F),this.diagnostics&&(this.diagnostics.hwSilent=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"isSpeaking",{set:function(F){this.stats.setSpeakingState(F),this.diagnostics&&(this.diagnostics.isSpeaking=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"iceConnectedStateTimestamp",{set:function(F){this.stats.setIceConnectedStateTimestamp(F),this.diagnostics&&(this.diagnostics.iceConnectedStateTimestamp=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"iceInitTime",{set:function(F){this.stats.setIceInitTimestamp(F),this.diagnostics&&(this.diagnostics.iceInitTime=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"ETag",{set:function(F){this.stats.setETag(F),this.diagnostics&&(this.diagnostics.ETag=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"configIds",{set:function(F){this.stats.setConfigIds(F),this.diagnostics&&(this.diagnostics.configIds=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,"relay",{set:function(F){this.stats.setRelay(F),this.diagnostics&&(this.diagnostics.relay=F)},enumerable:!1,configurable:!0}),SessionDiagnosticsWrapper.prototype.negotiationStart=function(F){var B;switch(null===(B=this.diagnostics)||void 0===B||B.negotiationStart(F),F){case"Offering":this.stats.negotiation.offering.started();break;case"Answering":this.stats.negotiation.answering.started()}},SessionDiagnosticsWrapper.prototype.negotiationCompleted=function(){var F;this.stats.negotiation.current.completed(),null===(F=this.diagnostics)||void 0===F||F.negotiationCompleted()},SessionDiagnosticsWrapper.prototype.negotiationRejected=function(){var F;this.stats.negotiation.current.rejected(),null===(F=this.diagnostics)||void 0===F||F.negotiationRejected()},SessionDiagnosticsWrapper.prototype.registerTransportConnected=function(){var F;this.stats.registerTransportConnected(),null===(F=this.diagnostics)||void 0===F||F.registerTransportConnected()},SessionDiagnosticsWrapper.prototype.registerTransportDisconnected=function(){var F;this.stats.registerTransportDisconnected(),null===(F=this.diagnostics)||void 0===F||F.registerTransportDisconnected()},SessionDiagnosticsWrapper.prototype.registerTransportFailed=function(){var F;this.stats.registerTransportFailed(),null===(F=this.diagnostics)||void 0===F||F.registerTransportFailed()},SessionDiagnosticsWrapper.prototype.registerRollbackEvent=function(F){var B;this.stats.registerRollbackEvent(F),null===(B=this.diagnostics)||void 0===B||B.registerRollbackEvent(F)},SessionDiagnosticsWrapper.prototype.registerRawMediaAccess=function(F,B,G){var W;"send"===B?this.stats.registerSetInputRawMedia(G):this.stats.registerOutputRawMediaAccess(),null===(W=this.diagnostics)||void 0===W||W.registerRawMediaAccess(F,B,G)},SessionDiagnosticsWrapper.prototype.registerQualityStateChangedEvent=function(F){var B;this.stats.registerQualityStateChangedEvent(F),null===(B=this.diagnostics)||void 0===B||B.registerQualityStateChangedEvent(F)},SessionDiagnosticsWrapper.prototype.terminated=function(F){var B;this.stats.terminated(F),null===(B=this.diagnostics)||void 0===B||B.terminated(F)},SessionDiagnosticsWrapper}();B.SessionDiagnosticsWrapper=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(13),z=G(33),K=G(38),J=function(){function SessionOperationQueue(F){this.logger=F,this.operationQueue=null,this.currentOperationDeferred=null,this.operationQueue=new z.PromiseQueue(this.logger)}return SessionOperationQueue.prototype.queueOperation=function(F,B){var G=this;void 0===B&&(B=(0,W.generateCauseId)()),this.logger.safe.info("[".concat(B,"] queueing operation"));var z=new K.SettablePromise,J=this.operationQueue.add((function(){return G.currentOperationDeferred=z,F()}),B);return this.operationQueue.add(z,B),J},SessionOperationQueue.prototype.completeCurrentOperation=function(){this.currentOperationDeferred&&(this.logger.safe.info("completing operation"),this.currentOperationDeferred.resolve())},SessionOperationQueue}();B.default=J},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0});var z=G(50),K=G(1),J=G(134),Q=G(10),Y=G(34),$=G(27),X=G(367),Z=function(){function StopWatch(){this.startTime=0,this.elapsed=0,this._count=0}return Object.defineProperty(StopWatch.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),StopWatch.prototype.start=function(){this.startTime||(this.startTime=Date.now(),this._count++)},StopWatch.prototype.stop=function(){this.startTime&&(this.elapsed+=Date.now()-this.startTime,this.startTime=0)},StopWatch.prototype.isRunning=function(){return!!this.startTime},StopWatch.prototype.getElapsed=function(){return this.startTime?this.elapsed+Date.now()-this.startTime:this.elapsed},StopWatch}(),ee=function(){function QualityEventStats(F){void 0===F&&(F="Good"),this.stopWatches=[],this.currentLevel=F,this.getStopWatch(F).start()}return QualityEventStats.prototype.updateLevel=function(F){this.currentLevel!==F&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=F,this.getStopWatch(this.currentLevel).start())},QualityEventStats.prototype.getCount=function(F){var B=this.stopWatches[F];return B?B.count:0},QualityEventStats.prototype.getElapsed=function(F){var B=this.stopWatches[F];return B?B.getElapsed():0},QualityEventStats.prototype.getStopWatch=function(F){var B=this.stopWatches[F];return B||(B=new Z,this.stopWatches[F]=B),B},QualityEventStats}(),te=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\:[0-9]{2,5})?$/),ne=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/),ie=RegExp(/^\[(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\](\:[0-9]{2,5})$/),re=function(){function SessionStatistics(F,B){var G=this;this.configProvider=F,this.callNumber=B,this.negotiation={offering:this.offering(),answering:this.answering(),current:this.current()},this.creationTime=Date.now(),this.negotiationCount=0,this.initialNegotiationCompleted=!1,this.multiParty=!1,this.noIceCandidatesGoodEventCount=0,this.noIceCandidatesBadEventCount=0,this.noRelayIceCandidatesGoodEventCount=0,this.noRelayIceCandidatesBadEventCount=0,this.cameraInUseBadEventCount=0,this.cameraInUseGoodEventCount=0,this.microphoneInUseBadEventCount=0,this.microphoneInUseGoodEventCount=0,this.cameraFreezeStartEventCount=0,this.cameraFreezeEndEventCount=0,this.networkRecv=new ee,this.networkSend=new ee,this.retargetIncomingCount=0,this.retargetOutgoingCount=0,this.retargetCompletedCount=0,this.retargetRejectedCount=0,this.reconnectAttemptedCount=0,this.reconnectConnectedCount=0,this.escalationAttemptedCount=0,this.escalationCompletedCount=0,this.escalationRejectedCount=0,this.duration=0,this.terminationReason={},this.terminationTime=0,this.sessionId="0",this.rejectedNegotiationCount=0,this.mediaError={type:"none",detail:"none"},this.incompatibleOffer=!1,this.dtmfSuccess=0,this.dtmfFailure=0,this.relay=null,this.relayManagerTimers=null,this.allowedAudioSend=!0,this.allowedVideoSend=!0,this.allowedScreensharingSend=!0,this.iceInitTime=0,this.finalAnswerTime=0,this.iceConnectedStateTime=0,this.usedDevices=null,this.deviceSelectionChangeCount=0,this.devicesChangeCount=0,this.devicesPollChangeCount=0,this.mute=new Z,this.osMute=new Z,this.hwSilent=new Z,this.isSpeaking=new Z,this.swMute=new Z,this.speakerMute=new Z,this.deviceTelemetryEvents=[],this.videoEffectsTelemetryEvents=new z.SlidingWindow(this.configProvider.config.effectsTelemetryBufferSize),this.audioEffectsTelemetryEvents=new z.SlidingWindow(this.configProvider.config.effectsTelemetryBufferSize),this.devicesCount=null,this.reconnectStats=new X.default(this.creationTime),this.transportDisconnected=!1,this.transportReconnectedCount=0,this.ufds=[],this.mediaQosEnabled=!1,this.portRangeConfigured=!1,this.rollbackNegotiation=[],this.rawOutputAudioAccess={attempt:0,timer:new Z},this.rawInputAudioOverride={attempt:0,timer:new Z},this.connectionEffectiveTypeSeries=new z.SlidingWindow(this.configProvider.config.navConnectionNumSamplesToCollect),this.connectionRttSeries=new z.SlidingWindow(this.configProvider.config.navConnectionNumSamplesToCollect),this.connectionDownlinkSeries=new z.SlidingWindow(this.configProvider.config.navConnectionNumSamplesToCollect),this.navigatorConnectionInterval=setInterval((function(){var F=null===navigator||void 0===navigator?void 0:navigator.connection;F&&("number"==typeof F.downlink&&G.connectionDownlinkSeries.add(F.downlink),"number"==typeof F.rtt&&G.connectionRttSeries.add(F.rtt),"number"==typeof F.effectiveType&&G.connectionEffectiveTypeSeries.add(F.effectiveType))}),this.configProvider.config.navConnectionPollingInterval)}return SessionStatistics.prototype.terminated=function(F){this.terminationReason=(0,K.deepClone)(F),this.terminationTime=Date.now(),this.duration=this.terminationTime-this.creationTime,this.osMute.stop(),this.swMute.stop(),this.hwSilent.stop(),this.isSpeaking.stop(),this.mute.stop(),this.speakerMute.stop(),this.rawInputAudioOverride.timer.stop(),this.rawOutputAudioAccess.timer.stop(),clearInterval(this.navigatorConnectionInterval)},SessionStatistics.prototype.setMultiParty=function(){this.multiParty=!0},SessionStatistics.prototype.updateCommonMute=function(){this.swMute.isRunning()||this.osMute.isRunning()?this.mute.start():this.swMute.isRunning()||this.osMute.isRunning()||this.mute.stop()},SessionStatistics.prototype.setDeviceList=function(F,B){var G=this;this.deviceList=F.map((function(F){return{label:(0,K.scrubDeviceLabelPii)(F.label,G.configProvider.config.devices.piiSafeWords),kind:F.kind}})),B&&(this.deviceDebugStrings=(0,K.deepClone)(B))},SessionStatistics.prototype.setPermissionStates=function(F){this.permissionStates=F},SessionStatistics.prototype.setSwMute=function(F){F?this.swMute.start():this.swMute.stop(),this.updateCommonMute()},SessionStatistics.prototype.setSpeakerMute=function(F){F?this.speakerMute.start():this.speakerMute.stop()},SessionStatistics.prototype.setHwSilent=function(F){F?this.hwSilent.start():this.hwSilent.stop()},SessionStatistics.prototype.setSpeakingState=function(F){F?this.isSpeaking.start():this.isSpeaking.stop()},SessionStatistics.prototype.setETag=function(F){this.ETag=F},SessionStatistics.prototype.setConfigIds=function(F){this.configIds=F},SessionStatistics.prototype.setVideoEffectStats=function(F){F&&this.videoEffectsTelemetryEvents.add(F)},SessionStatistics.prototype.setAudioEffectStats=function(F){F&&this.audioEffectsTelemetryEvents.add(F)},SessionStatistics.prototype.registerQualityStateChangedEvent=function(F){switch(F.type){case"NoNetwork":"Good"===F.value?this.noIceCandidatesGoodEventCount++:this.noIceCandidatesBadEventCount++;break;case"NetworkRelaysNotReachable":"Good"===F.value?this.noRelayIceCandidatesGoodEventCount++:this.noRelayIceCandidatesBadEventCount++;break;case"DeviceCaptureNotFunctioning":"Good"===F.value?this.microphoneInUseGoodEventCount++:this.microphoneInUseBadEventCount++;break;case"VideoCapturerDeviceStartFailed":"Good"===F.value?this.cameraInUseGoodEventCount++:this.cameraInUseBadEventCount++;break;case"DeviceCaptureMute":"Audio"===F.mediaType&&("Bad"===F.value?this.osMute.start():this.osMute.stop(),this.updateCommonMute());break;case"NetworkRecvQuality":this.networkRecv.updateLevel(F.value);break;case"NetworkSendQuality":this.networkSend.updateLevel(F.value);break;case"VideoCaptureDeviceFreeze":"Good"===F.value?this.cameraFreezeEndEventCount++:this.cameraFreezeStartEventCount++}"DeviceSpeakWhileMuted"!==F.type&&this.ufds.push(W(W({},F),{timestamp:Date.now()-this.creationTime})),this.ufds.length>this.configProvider.config.maxStoredUFDCount&&this.ufds.shift()},SessionStatistics.prototype.registerRetargetIncoming=function(){this.retargetIncomingCount++},SessionStatistics.prototype.registerRetargetOutgoing=function(){this.retargetOutgoingCount++},SessionStatistics.prototype.registerRetargetCompleted=function(){this.retargetCompletedCount++},SessionStatistics.prototype.registerRetargetRejected=function(){this.retargetRejectedCount++},SessionStatistics.prototype.registerEscalationStart=function(){this.escalationAttemptedCount++},SessionStatistics.prototype.registerEscalationCompleted=function(){this.escalationCompletedCount++},SessionStatistics.prototype.registerEscalationRejected=function(){this.escalationRejectedCount++},SessionStatistics.prototype.registerRollbackEvent=function(F){F&&this.rollbackNegotiation.push({type:F.type,attempt:this.rollbackNegotiation.length+1,error:F.error?F.error:""})},SessionStatistics.prototype.registerReconnectAttempted=function(){this.reconnectAttemptedCount++,this.reconnectStats.onReconnectStart()},SessionStatistics.prototype.registerReconnectConnected=function(){this.reconnectConnectedCount++,this.reconnectStats.onReconnectConnected()},SessionStatistics.prototype.registerDeviceTelemetryEvent=function(F){F.timestamp=F.timestamp-this.creationTime,this.deviceTelemetryEvents.push(F)},SessionStatistics.prototype.registerVideoEffectsTelemetryEvent=function(F){F&&(F.timestamp=F.timestamp-this.creationTime,this.videoEffectsTelemetryEvents.add(F))},SessionStatistics.prototype.registerAudioEffectsTelemetryEvent=function(F){F&&(F.timestamp=F.timestamp-this.creationTime,this.audioEffectsTelemetryEvents.add(F))},SessionStatistics.prototype.registerReconnectAttempt=function(F){this.reconnectStats.onReconnectAttempt(F)},SessionStatistics.prototype.registerReconnectAttemptCompleted=function(){this.reconnectStats.onReconnectCompleted()},SessionStatistics.prototype.registerReconnectAttemptRejected=function(){this.reconnectStats.onReconnectRejected()},SessionStatistics.prototype.setMediaLegId=function(F){this.mediaLegId=F},SessionStatistics.prototype.setId=function(F){this.sessionId=F},SessionStatistics.prototype.setError=function(F){F.type===Y.Constants.MEDIA_ERROR.incompatibleOffer&&(this.incompatibleOffer=!0),this.mediaError.type=F.type||Y.Constants.MEDIA_ERROR.internalError,this.mediaError.detail=F.detail||F.toString()},SessionStatistics.prototype.setRelay=function(F){this.relay={address:F.addresses.join(),expires:F.expires,realm:F.realm,credentials:!(!F.username||!F.password),ports:[F.udpPort?"udp:".concat(F.udpPort):"",F.tcpPort?"tcp:".concat(F.tcpPort):"",F.tlsPort?"tls:".concat(F.tlsPort):""].join(","),fqdns:F.fqdns?F.fqdns.join():"none"}},SessionStatistics.prototype.setRelayManagerTimers=function(F){this.relayManagerTimers=F},SessionStatistics.prototype.setSendModalities=function(F){this.allowedAudioSend=F.audio.some((function(F){return(0,Q.hasSendDirectionality)(F)})),this.allowedVideoSend=F.video.some((function(F){return(0,Q.hasSendDirectionality)(F)})),this.allowedScreensharingSend=F.sharing.some((function(F){return(0,Q.hasSendDirectionality)(F)}))},SessionStatistics.prototype.setIceInitTimestamp=function(F){this.iceInitTime||(this.iceInitTime=F)},SessionStatistics.prototype.setFinalAnswerTimestamp=function(F){this.finalAnswerTime||(this.finalAnswerTime=F)},SessionStatistics.prototype.setIceConnectedStateTimestamp=function(F){this.iceConnectedStateTime||(this.iceConnectedStateTime=F)},SessionStatistics.prototype.dtmfResult=function(F){F?++this.dtmfSuccess:++this.dtmfFailure},SessionStatistics.prototype.setUsedDevices=function(F){this.usedDevices&&JSON.stringify(F)!==JSON.stringify(this.usedDevices)&&this.deviceSelectionChangeCount++,this.usedDevices=F},SessionStatistics.prototype.setDevicesCount=function(F){this.devicesCount=F},SessionStatistics.prototype.setMediaQosEnabled=function(F){this.mediaQosEnabled=F},SessionStatistics.prototype.setPortRangeConfigured=function(F){this.portRangeConfigured=F},SessionStatistics.prototype.devicesChanged=function(){this.devicesChangeCount++},SessionStatistics.prototype.deviceChangedByPoll=function(){this.devicesPollChangeCount++},SessionStatistics.prototype.registerOutputRawMediaAccess=function(){this.rawOutputAudioAccess.attempt++,this.rawOutputAudioAccess.timer.start()},SessionStatistics.prototype.registerSetInputRawMedia=function(F){this.rawInputAudioOverride.attempt++,F?this.rawInputAudioOverride.timer.start():this.rawInputAudioOverride.timer.stop()},SessionStatistics.prototype.getReport=function(){var F,B=this.usedDevices||{microphone:"none",speaker:"none",camera:"none"};return{RawOutputAudioAccessDurationRatio:this.getDurationRatio(this.rawOutputAudioAccess.timer.getElapsed()),RawOutputAudioAccessAttempted:this.rawOutputAudioAccess.attempt,RawInputAudioOverrideDurationRatio:this.getDurationRatio(this.rawInputAudioOverride.timer.getElapsed()),RawInputAudioOverrideAttempted:this.rawInputAudioOverride.attempt,SessionId:this.sessionId,CallNumber:this.callNumber,NoIceCandidatesBadEventCount:this.noIceCandidatesBadEventCount,NoIceCandidatesGoodEventCount:this.noIceCandidatesGoodEventCount,NoRelayIceCandidatesBadEventCount:this.noRelayIceCandidatesBadEventCount,NoRelayIceCandidatesGoodEventCount:this.noRelayIceCandidatesGoodEventCount,CameraInUseBadEventCount:this.cameraInUseBadEventCount,CameraInUseGoodEventCount:this.cameraInUseGoodEventCount,MicrophoneInUseBadEventCount:this.microphoneInUseBadEventCount,MicrophoneInUseGoodEventCount:this.microphoneInUseGoodEventCount,CameraFreezeStartEventCount:this.cameraFreezeStartEventCount,CameraFreezeEndEventCount:this.cameraFreezeEndEventCount,RetargetIncomingCount:this.retargetIncomingCount,RetargetOutgoingCount:this.retargetOutgoingCount,RetargetCompletedCount:this.retargetCompletedCount,RetargetRejectedCount:this.retargetRejectedCount,ReconnectAttemptedCount:this.reconnectAttemptedCount,ReconnectConnectedCount:this.reconnectConnectedCount,EscalationAttemptedCount:this.escalationAttemptedCount,EscalationCompletedCount:this.escalationCompletedCount,EscalationRejectedCount:this.escalationRejectedCount,CreationTime:this.getHpTimeFromMillis(this.creationTime),InitTime:this.getHpTimeFromMillis(this.creationTime),TerminationTime:this.getHpTimeFromMillis(this.terminationTime),CallDuration:this.getHpTimeFromMillis(this.getCurrentDuration()),InitialNegotiationType:this.initialNegotiationType||"none",InitialNegotiationCompleted:this.initialNegotiationCompleted,NegotiationCount:this.negotiationCount,RejectedNegotiationCount:this.rejectedNegotiationCount,MediaLegId:this.mediaLegId,MultiParty:this.multiParty,ErrorType:this.mediaError.type,ErrorDetail:this.mediaError.detail,TerminationReason:this.terminationReason,IncompatibleOffer:this.incompatibleOffer,DtmfSuccess:this.dtmfSuccess,DtmfFailure:this.dtmfFailure,Relay:this.relay?JSON.stringify(this.relay):"none",RelayManager:this.relayManagerTimers?JSON.stringify(this.relayManagerTimers):"none",AllowedAudioSend:this.allowedAudioSend,AllowedVideoSend:this.allowedVideoSend,AllowedScreensharingSend:this.allowedScreensharingSend,IceInitTime:this.getHpTimeFromMillis(this.iceInitTime),FinalAnswerTime:this.getHpTimeFromMillis(this.finalAnswerTime),IceConnectedStateTime:this.getHpTimeFromMillis(this.iceConnectedStateTime),UsedMicrophone:B.microphone,UsedSpeaker:B.speaker,UsedCamera:B.camera,DeviceSelectionChangeCount:this.deviceSelectionChangeCount,DevicesChangeCount:this.devicesChangeCount,DevicesPollChangeCount:this.devicesPollChangeCount,DevicesCount:this.devicesCount?JSON.stringify(this.devicesCount):"none",ETag:this.ETag||"",ConfigIds:this.configIds?Array.isArray(this.configIds)?this.configIds.join(","):this.configIds:"",CallMutedRatio:this.getDurationRatio(this.mute.getElapsed()),CallOsMuted:this.getHpTimeFromMillis(this.osMute.getElapsed()),CallHwSilent:this.getHpTimeFromMillis(this.hwSilent.getElapsed()),CallSwMuted:this.getHpTimeFromMillis(this.swMute.getElapsed()),CallSpeakerMuted:this.getHpTimeFromMillis(this.speakerMute.getElapsed()),CallIsSpeaking:this.getHpTimeFromMillis(this.isSpeaking.getElapsed()),NetworkRecvGood:this.networkRecv.getCount("Good")-1,NetworkRecvPoor:this.networkRecv.getCount("Poor"),NetworkRecvBad:this.networkRecv.getCount("Bad"),NetworkSendGood:this.networkSend.getCount("Good")-1,NetworkSendPoor:this.networkSend.getCount("Poor"),NetworkSendBad:this.networkSend.getCount("Bad"),NetworkRecvGoodRatio:this.getDurationRatio(this.networkRecv.getElapsed("Good")),NetworkRecvPoorRatio:this.getDurationRatio(this.networkRecv.getElapsed("Poor")),NetworkRecvBadRatio:this.getDurationRatio(this.networkRecv.getElapsed("Bad")),NetworkSendGoodRatio:this.getDurationRatio(this.networkSend.getElapsed("Good")),NetworkSendPoorRatio:this.getDurationRatio(this.networkSend.getElapsed("Poor")),NetworkSendBadRatio:this.getDurationRatio(this.networkSend.getElapsed("Bad")),DeviceEvents:JSON.stringify(this.deviceTelemetryEvents),DeviceList:JSON.stringify(this.deviceList),DeviceListDebug:JSON.stringify(this.deviceDebugStrings),VideoEffects:JSON.stringify(this.videoEffectsTelemetryEvents.items),AudioEffects:JSON.stringify(this.audioEffectsTelemetryEvents.items),PermissionStates:JSON.stringify(this.permissionStates),ReconnectAttempts:this.reconnectStats.getReport(),ReconnectInProgress:this.reconnectStats.isReconnecting(),TransportReconnectedCount:this.transportReconnectedCount,UFDs:JSON.stringify(this.ufds),MediaQosEnabled:this.mediaQosEnabled,PortRangeConfigured:this.portRangeConfigured,RollbackNegotiation:JSON.stringify(this.rollbackNegotiation),hardwareConcurrency:$.UserAgentConfig.hardwareConcurrency,GPUName:$.UserAgentConfig.unmaskedGlRenderer,Connection_Downlink:(0,K.sampleseries)(this.connectionDownlinkSeries.items,(function(F){return F})),Connection_EffectiveType:(0,K.sampleseries)(this.connectionEffectiveTypeSeries.items,(function(F){return F})),Connection_Rtt:(0,K.sampleseries)(this.connectionRttSeries.items,(function(F){return F})),Connection_SaveData:null===(F=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===F?void 0:F.saveData}},SessionStatistics.prototype.generateStatistics=function(F,B,G){var W=this;if(void 0===G&&(G=!1),this.setMediaLegId(B.process()),"WebRtcMediaStats"!==F.type)throw new Error("Unknown stats type - ".concat(F.type));if(G){var z=this.deviceTelemetryEvents.length;this.deviceTelemetryEvents.splice(0,z-1),this.deviceDebugStrings=J.EmptyDeviceDebugStrings,this.audioEffectsTelemetryEvents.clear()}return F.data.metrics=this.getReport(),(0,K.forOwnRec)(F.data,(function(F,B,G){G[B]=W.addPiiToStatsValue(F)})),F},SessionStatistics.prototype.registerTransportConnected=function(){this.transportDisconnected&&(this.transportDisconnected=!1,this.transportReconnectedCount++)},SessionStatistics.prototype.registerTransportDisconnected=function(){this.transportDisconnected=!0},SessionStatistics.prototype.registerTransportFailed=function(){this.transportDisconnected=!1},SessionStatistics.prototype.resetError=function(){this.setError({type:"none",detail:"none"})},SessionStatistics.prototype.addPiiToStatsValue=function(F){var B=0;return te.test(F)?B=13:(ne.test(F)||ie.test(F))&&(B=4),{type:B,value:F,__VALUE__:!0}},SessionStatistics.prototype.offering=function(){var F=this;return{started:function(){F.currentNegotiationType="Offering",F.negotiationStarted()}}},SessionStatistics.prototype.answering=function(){var F=this;return{started:function(){F.currentNegotiationType="Answering",F.negotiationStarted()}}},SessionStatistics.prototype.negotiationStarted=function(){this.initialNegotiationType=this.initialNegotiationType||this.currentNegotiationType,++this.negotiationCount},SessionStatistics.prototype.current=function(){var F=this;return{completed:function(){F.initialNegotiationCompleted=!0,F.resetError()},rejected:function(){++F.rejectedNegotiationCount}}},SessionStatistics.prototype.getDurationRatio=function(F){var B=this.getCurrentDuration();return F/(0!==B?B:1)},SessionStatistics.prototype.getCurrentDuration=function(){return this.duration>0?this.duration:Date.now()-this.creationTime},SessionStatistics.prototype.getHpTimeFromMillis=function(F){return 1e4*F},SessionStatistics}();B.default=re},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function ReconnectStatistics(F){this.creationTime=F,this.records=[],this.activeRecord=null,this.activeAttempt=null,this.reconnectState=!1}return ReconnectStatistics.prototype.getReport=function(){return this.records.length?JSON.stringify(this.records):""},ReconnectStatistics.prototype.isReconnecting=function(){return this.reconnectState},ReconnectStatistics.prototype.onReconnectStart=function(){this.reconnectState=!0,this.activeRecord||(this.activeRecord={attempts:[],endTime:null,startTime:Date.now()-this.creationTime},this.records.push(this.activeRecord))},ReconnectStatistics.prototype.onReconnectAttempt=function(F){if(!this.activeRecord)return null;this.activeAttempt={direction:F,status:!1,endTime:null,startTime:this.getTimestamp()},this.reconnectState=!0,this.activeRecord.attempts.push(this.activeAttempt)},ReconnectStatistics.prototype.onReconnectConnected=function(){if(!this.activeRecord)return null;this.reconnectState=!1,this.activeRecord.endTime=this.getTimestamp(),this.activeRecord=this.activeAttempt=null},ReconnectStatistics.prototype.onReconnectCompleted=function(){this.reconnectState=!1,this.resolveReconnectAttempt(!0)},ReconnectStatistics.prototype.onReconnectRejected=function(){this.resolveReconnectAttempt(!1)},ReconnectStatistics.prototype.resolveReconnectAttempt=function(F){this.activeAttempt&&this.activeRecord&&(this.activeAttempt.status=F,this.activeAttempt.endTime=this.getTimestamp())},ReconnectStatistics.prototype.getTimestamp=function(){return Date.now()-this.creationTime-this.activeRecord.startTime},ReconnectStatistics}();B.default=W},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},J=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},Q=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0});var Y=G(13),$=G(51),X=G(135),Z=G(33),ee=G(79),te=G(28),ne=G(38),ie=G(83),re=G(52),oe=G(136),ae=G(137),se=G(1),ce=G(4),le=G(84),de=G(139),ue=G(10),pe=G(140),he=G(146),ge=G(149),fe=G(150),me=G(152),ve=G(153),ye=G(155),Se=G(156),_e=G(157),Ce=G(158),Te=G(159),Ee=G(160),be=G(161),Ie=0,Ae=function(){function WebRtcSession(F,B,G){var W,z=this;this.context=F,this.callId=B,this.callback=G,this.callbacks={},this.multiParty=this.context.config&&this.context.config.isConference,this.configProvider=this.context.configProvider,this.logger=this.context.getLogger().createChild("webrtc-".concat(++Ie)),this.deviceManager=this.context.getDeviceManager(),this.webrtcAdapter=he.default.build({global:this.context.maContext,configProvider:this.configProvider}),this.iceHostCandidateOnly=this.multiParty&&se.getFrom("iceHostCandidateOnly",this.context.config,this.configProvider.config),this.mediaManager=new fe.default({logger:this.logger,configProvider:this.configProvider,numVideoChannels:this.multiParty&&this.configProvider.config.numVideoChannelsGvc||1,unifiedPlanEnabled:!1,useSimulcast:!1}),this.resolutionTable=new te.default(this.configProvider.config.resolutionTableOverride),this.sessionDescription=Ee.SessionDescriptionFactory.build({sdpTransform:new this.webrtcAdapter.SdpTransform(this.context),mediaManager:this.mediaManager,logger:this.logger,configProvider:this.configProvider,configuration:this.getStreamTransformConfiguration()}),this.allowedMediaContentType=se.getFrom("webrtcAllowedMediaContentType",this.context.config,this.configProvider.config).concat(),this.receiveStreamCollection=new oe.default({streamAdded:function(F){return z.streamAdded(F)},streamRemoved:function(F){return z.streamRemoved(F)}}),this.stats=new pe.StatisticsPoller(this.logger.createChild("stats"),this.configProvider,void 0,this.mediaManager,this.multiParty),this.scalingEnabled=this.multiParty?this.configProvider.config.webrtcMultiPartyVideoScaling:this.configProvider.config.webrtcVideoScaling,this.maxResolution=this.multiParty?this.resolutionTable.getResolutionByFs(this.configProvider.config.webrtcMultipartyMaxScalingFs):this.resolutionTable.getResolutionByFs(this.configProvider.config.webrtcMaxScalingFs),this.qualityManager=new ve.default(this.logger.createChild("qm"),{scalingEnabled:this.scalingEnabled,cooldownTimeout:this.configProvider.config.webrtcResolutionManagerCooldownTimeout,retryDelay:this.configProvider.config.webrtcResolutionManagerRetryDelay,maxResolution:this.maxResolution,customBwEstimationEnabled:!0,sendBandwidthNotificationsEnabled:this.multiParty&&this.configProvider.config.webrtcSendBandwidthNotificationsEnabled},{onReceiveCapabilitiesChanged:function(F,B,G){return z.applyCapabilitiesForModality(F,B,G)},onSendBandwidthChanged:function(F){return z.onSendBandwidthChanged(F)}},this.stats,void 0,this.configProvider),this.localVideoStreamWatcher=new _e.LocalVideoStreamWatcher(this.stats,this.logger,this.configProvider),this.activeSpeakerManager=new X.ActiveSpeakerManager(this.callback.onContributingSourcesChanged,this.callback.onDominantSpeakerChanged,this.logger.createChild("ActiveSpeakerManager")),this.contributingSources=new ge.ContributingSourcesHandler({activeSpeakerManager:this.activeSpeakerManager,logger:this.logger,configProvider:this.configProvider,provider:function(){if(!z.peerConnection)return[];if(z.peerConnection.getReceivers&&z.multiParty){var F=z.peerConnection.getReceivers().filter((function(F){return"audio"===F.track.kind}))[0];if(!F)return[];if(F.getContributingSources)return F.getContributingSources()}}}),this.passiveModalities=this.context.config.passiveModalities,this.senders={},this.negotiationQueue=new Z.PromiseQueue(this.logger),this.negotiationEmulator=new me.default(this.logger.createChild("negotiationEmulator"),this.webrtcAdapter,this.sessionDescription,this.negotiationQueue,this.mediaManager),this.extensionsManager=this.setupExtensionsManager(),this.toBeCalledAfterConnected=[],this.iceTransportPolicy=this.configProvider.config.iceTransportPolicyForced||this.context.config.iceTransportPolicy||ce.default.ICE_TRANSPORT_POLICY.all,this.isMuteHold=!1,this.peerConnection=null,this.mediaStreams=new Map,this.doAudioMute=this.context.config.muted,this.iceCandidatesDeferred=new ne.SettablePromise,this.relayCandidateGathered=!1,this.iceCandidatesTimer=null,this.triggerRenegotiationFlag=!1,this.canTriggerRenegotiation=!0,this.noIceCandidates=!1,this.noRelayIceCandidates=!1,this.forceMediaStreamUpdate=!1,this.negotiatedModalities={},this.iceDisconnectedTimer=null,this.statisticsReport=Promise.resolve({}),this.terminated=!1,this.initiator=!1,this.streamsChangedListener=null,this.dtmfSender=Te.default.build({logger:this.logger,configProvider:this.configProvider}),this.mediaContentType=se.getFrom("webrtcMediaContentType",this.context.config,this.configProvider.config),this.streamsChangedNotificationScheduled=!1,this.subscriptionManager=new ae.SubscriptionManager(this.logger.createChild("subs"),this.configProvider,{getStreams:function(){return z.getStreams()},setOnStreamsChangedHandler:function(F){return z.onStreamsChanged(F)}}),this.remoteVideoResolutionManager=new ye.RemoteVideoResolutionManager(this.logger.createChild("rvrm"),this.multiParty,new te.default(this.configProvider.config.recvResolutionTableOverride),this.configProvider,this.mediaManager),this.remoteVideoManager=new Se.RemoteVideoManager(this.logger.createChild("RemoteVideoManager"),this.configProvider,this.stats,void 0,this.remoteVideoResolutionManager,this.context.maContext.domOverrides),this.hwSilent=!1,this.configuredModalitiesPromise=Promise.resolve(),this.negotiationCompletedPromise=new ne.SettablePromise,this.ssrcGenerator=new ie.SsrcGenerator,this.ssrcs=((W={}).Audio=this.getSsrcRangeForMediaType("Audio"),W.Video=this.getSsrcRangeForMediaType("Video"),W.ScreenShare=this.getSsrcRangeForMediaType("ScreenShare"),W),this.forceKeyFramePromise=null,this.ufdManager=F.getUfdManager(),this.stats.on("onStatisticsChanged",(function(F){z.updateQualityLevels(F)})),this.negotiationCompletedPromise.promise.catch((function(){})),this.negotiationCompletedPromise.reject("placeholder"),this.remoteVideoResolutionManager.on("onNegotiationRequired",(function(){return z.triggerRenegotiation(!0)})),this.remoteVideoResolutionManager.on("onSourceRequestRequired",(function(F,B,G,W){return z.requestSource(F,B,G,W)})),this.setSubsForSubscriptionManager(),this.localVideoStreamWatcher.on("onVideoCaptureFreeze",(function(F){z.isConnected()&&z.ufdManager.signalEvent("VideoCaptureDeviceFreeze",F?"Bad":"Good","Video")})),this.configProvider.mediaConfig.maxBandwidthInKbps&&this.stats.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.createAudioRenderer(),this.scalingEnabled&&this.onOptimalVideoReceiversCountChanged(this.configProvider.config.nonEstimatedDefaultVideoReceiversCount)}return Object.defineProperty(WebRtcSession.prototype,"audioStream",{get:function(){return this.mediaStreams.get("Audio")},enumerable:!1,configurable:!0}),Object.defineProperty(WebRtcSession.prototype,"videoStream",{get:function(){return this.mediaStreams.get("Video")},enumerable:!1,configurable:!0}),Object.defineProperty(WebRtcSession.prototype,"displayStream",{get:function(){return this.mediaStreams.get("ScreenShare")},enumerable:!1,configurable:!0}),WebRtcSession.prototype.useNullAudioStreamClient=function(){},WebRtcSession.prototype.getIncomingRawAudioStream=function(){return null},WebRtcSession.prototype.getAcceptedTypes=function(){return this.allowedMediaContentType},WebRtcSession.prototype.clone=function(F){void 0===F&&(F=!1);var B=se.shallowClone(this.context);B.config=se.shallowClone(this.context.config),B.config.webrtcMediaContentType=this.mediaContentType,B.config.webrtcAllowedMediaContentType=this.allowedMediaContentType,F?B.config.isConference=!0:(B.config.iceHostCandidateOnly=!1,this.configProvider.config.waitForRelayOnReconnect&&(B.config.webrtcIceGatheringTimeoutIncreased=!0));var G=new WebRtcSession(B,this.callId,this.callback);return this.relayManagerProvider&&(G.relayManagerProvider=this.relayManagerProvider),G.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,G},WebRtcSession.prototype.setInternals=function(F){var B=this;if(F.extensionsManager&&this.extensionsManager){var G=F.extensionsManager.getExtension(ce.default.EXTENSION_TYPE.videoStreamControl);G&&G.getOptions()&&this.extensionsManager.configureExtension(ce.default.EXTENSION_TYPE.videoStreamControl,G.getOptions())}F.subscriptionManager&&(this.subscriptionManager&&this.subscriptionManager.dispose(),this.subscriptionManager=F.subscriptionManager,this.subscriptionManager.setStreamProvider({getStreams:function(){return B.getStreams()},setOnStreamsChangedHandler:function(F){return B.onStreamsChanged(F)}}),this.setSubsForSubscriptionManager(),this.subscriptionManager.reriseSubscribeEvents(),this.notifyStreamsChanged()),F.audioRenderer&&(F.audioRenderer.play(this.audioRenderer.getStream()),this.audioRenderer=F.audioRenderer),F.remoteVideoManager&&F.remoteVideoManager.moveRenderers(this.remoteVideoManager)},WebRtcSession.prototype.setSubsForSubscriptionManager=function(){var F=this;this.subscriptionManagerSubs=[this.subscriptionManager.on("onTrackIdsChanged",(function(B){return F.stats.setSubscribedTrackIds(B)})),this.subscriptionManager.on("onTrackSsrcChanged",(function(B){return F.stats.setSubscribedTrackSsrc(B)})),this.subscriptionManager.on("onSubscriptionChanged",(function(B,G,W,z,K,J){return F.stats.addSubscriptionEvent(B,G,W,z,null,K,J)})),this.subscriptionManager.on("onSubscriptionFailed",(function(B,G,W,z,K){return F.stats.addSubscriptionEvent(B,G,W,z,K)}))]},WebRtcSession.prototype.move=function(F,B){F.setInternals({subscriptionManager:this.subscriptionManager,extensionsManager:this.extensionsManager,audioRenderer:this.audioRenderer,remoteVideoManager:this.remoteVideoManager}),F.muteHold(this.isMuteHold,B),this.doAudioMute?F.muteInputAsync(B):F.unmuteInputAsync(B),this.subscriptionManager=null,this.audioRenderer=null,this.callbacks.onTerminated=null},WebRtcSession.prototype.setMute=function(F,B,G){this.logger.safe.info("[".concat(G,"] call setMuteAsync with mute state ").concat(B,", audio stream exists: ").concat(!!this.audioStream)),"Audio"===F&&this.audioStream?this.audioStream.setMuted(B,G):"Video"===F&&this.videoStream?this.videoStream.setMuted(B,G):"ScreenShare"===F&&this.displayStream&&this.displayStream.setMuted(B,G),this.updateQualityLevels(this.stats.getLastStatistics())},WebRtcSession.prototype.configureModalitiesAsync=function(F,B){var G=this,W=this.configuredModalitiesPromise.then((function(){if(!F||!F.audio&&!F.video&&!F.sharing)throw new Error("Invalid parameters! ".concat(JSON.stringify(F)));var W=!G.configuredModalities||!ue.areNegotiatedDirectionsFulfilled(F,G.negotiatedModalities);return G.configuredModalities=F,G.logger.safe.info("[".concat(B,"] configure modalities"),"audio: ".concat(F.audio),"video: ".concat(F.video),"sharing: ".concat(F.sharing),"peerconnection: ".concat(!!G.peerConnection),"pc.signalingState: ".concat(G.peerConnection?G.peerConnection.signalingState:"-"),"needNewRenegotiation: ".concat(W)),W&&G.triggerRenegotiation(!1,B),G.configuredModalities}));return this.configuredModalitiesPromise=W.catch((function(F){G.logger.safe.warn("[".concat(B,"] Error during configuring modalities: ").concat(se.stringifyObject(F)))})).then((function(){})),W.then((function(){}))},WebRtcSession.prototype.getConfiguredModalities=function(){return this.configuredModalities},WebRtcSession.prototype.getSubscriptionManager=function(){return null},WebRtcSession.prototype.createAudioElement=function(F){},WebRtcSession.prototype.createOfferAsync=function(F){var B=this,G=this.negotiationQueue.add((function(){return new Promise((function(G){B.logger.safe.info("[".concat(F,"] create [offer] configured: ").concat(JSON.stringify(B.configuredModalities))),B.initiator=!0,B.throwIfModalitiesNotConfigured("no configured modalities to create offer for"),B.canTriggerRenegotiation=!1,B.negotiatingModalities=ue.excludePassiveModalities(B.configuredModalities,B.passiveModalities,B.offeredModalities),B.offeredModalities=B.negotiatingModalities,B.configProvider.config.webrtcNegotiateDisabledDataModality&&!B.offeredModalities[ce.default.MODALITY.data]&&B.multiParty&&(B.offeredModalities[ce.default.MODALITY.data]=ce.default.MEDIA_STATE.inactive),ue.isOnHold(B.offeredModalities)&&!se.isEmpty(B.negotiatedModalities)&&Object.keys(B.offeredModalities).forEach((function(F){void 0===B.negotiatedModalities[F]&&delete B.offeredModalities[F]})),G(B.updatePeerConnectionStreamsAsync(B.offeredModalities,!0,!0,F).then((function(){var G=B.createNegotiationConstraints(B.offeredModalities);return B.logger.safe.info("[".concat(F,"] create [offer] offered: ").concat(JSON.stringify(B.offeredModalities)," constraints: ").concat(JSON.stringify(G))),B.peerConnection.createOffer(G)})).then((function(G){B.logger.unsafe.debug("[".concat(F,"] create [offer] offer from peer connection"),"sdp:",G.sdp);var W=B.sessionDescription.createLocalOffer(G.sdp);B.hasIceCandidates(W)||B.resetCandidateGathering(F),B.stats.startWaitingForStreamStart(B.offeredModalities);var z=new B.webrtcAdapter.RTCSessionDescription({sdp:W.toLocal(),type:"offer"});return B.setupIceGatheringTimeout(F),Promise.all([B.peerConnection.setLocalDescription(z),B.iceCandidatesDeferred.promise])})).then((function(){var G=B.sessionDescription.createLocalOffer(B.peerConnection.localDescription.sdp);G.updateModalities(B.offeredModalities),B.checkIceCandidates(G);var W=G.toOffer();B.logger.unsafe.debug("CREATE OFFER","sdp:",W);var z={blob:W,contentType:B.mediaContentType};return""===B.configProvider.config.webrtcRequiredFeatures||B.multiParty||(z.requiredFeatures=B.configProvider.config.webrtcRequiredFeatures),B.configProvider.countryCode&&(z.clientLocation=B.configProvider.countryCode),B.doRetargetIfNeeded(z,G,F),z})))}))}),F);return this.resetNegotiationQueue(F),G},WebRtcSession.prototype.processOfferAsync=function(F,B){var G=this,W=this.negotiationQueue.add((function(){return new Promise((function(W){var z=F.blob;if(G.logger.unsafe.debug("[".concat(B,"] process [offer]"),"sdp:",z),G.configProvider.config.webrtcCompareContentTypeInOffer&&(se.throwIfNotSupported(F.contentType,G.allowedMediaContentType),G.mediaContentType=F.contentType),F.requiredFeatures){var K=G.configProvider.config.webrtcRejectedFeatures.split(","),J=F.requiredFeatures.split(",");se.throwIfFeatureNotSupported(J,K)}G.initiator=!1,G.offeredDescription=G.sessionDescription.createRemoteOffer(z),G.canTriggerRenegotiation=!1,G.offeredModalities=ue.invertModalities(G.offeredDescription.getModalities()),G.peerConnection||(G.context.configProvider.mediaConfig.isTransportUnbundled?G.context.configProvider.mediaConfig.isTransportUnbundled=G.offeredDescription.couldBeUnbundled():G.context.configProvider.mediaConfig.isTransportUnbundled=G.offeredDescription.isUnbundled());var Q=Promise.resolve(G.offeredModalities);if(ue.hasSendDirectionality(G.offeredModalities.video)||ue.hasReceiveDirectionality(G.offeredModalities.video)||ue.hasSendDirectionality(G.offeredModalities.sharing)||ue.hasReceiveDirectionality(G.offeredModalities.sharing)){var Y=G.offeredDescription.getVideoCodecs();Q=G.webrtcAdapter.RTCRtpReceiver.getCapabilities("video").then((function(F){if(!F.codecs.some((function(F){return Y.some((function(B){return F.mimeType===B}))}))){G.logger.safe.warn("[".concat(B,"] offer doesn't contain any supported video codecs"));var W=se.shallowClone(G.offeredModalities);return W.video=void 0,W.sharing=void 0,W}return G.offeredModalities})).catch((function(F){return G.logger.safe.error("[".concat(B,"] failed to get video capability ").concat(se.stringifyObject(F))),G.offeredModalities}))}W(Q.then((function(F){return G.logger.safe.info("[".concat(B,"] process [offer] offered: ").concat(JSON.stringify(G.offeredModalities)," acceptable: ").concat(JSON.stringify(F))),F})))}))}),B);return this.resetNegotiationQueue(B),W},WebRtcSession.prototype.createAnswerAsync=function(F,B){var G=this;return new Promise((function(W){if(F)W({blob:"",contentType:G.mediaContentType});else{G.logger.safe.info("[".concat(B,"] create [answer] offered: ").concat(JSON.stringify(G.offeredModalities)," configured: ").concat(JSON.stringify(G.configuredModalities))),G.throwIfModalitiesNotConfigured("no configured modalities to create answer for"),G.negotiatingModalities=ue.excludePassiveModalities(G.configuredModalities,G.passiveModalities,G.offeredModalities);var z=ue.negotiateModalities(G.offeredModalities,G.negotiatingModalities),K=G.offeredDescription.clone();W(G.updatePeerConnectionStreamsAsync(z,!0,!1,B).then((function(){return G.handleCodecSwitchUnsupported(B)})).then((function(){var F=G.offeredDescription.toRemote(z);G.mediaManager.updateMediaEntitiesWithLocalTracks(),G.registerMediaSources();var W=new G.webrtcAdapter.RTCSessionDescription({sdp:F,type:"offer"});return G.updateDescriptor(W,K),G.logger.unsafe.info("[".concat(B,"] create [answer] set remote description"),"negotiated:",z,"sdp:",W.sdp),G.peerConnection.setRemoteDescription(W)})).then((function(){return G.callbacks.onTransportInitialized&&G.callbacks.onTransportInitialized(),G.updatePeerConnectionStreamsAsync(z,!1,!0,B)})).then((function(){return G.handleSharingRecvCapabilities(K),G.handleVideoRecvCapabilities(K)})).then((function(){return G.peerConnection.createAnswer()})).then((function(F){G.logger.unsafe.debug("[".concat(B,"] create [answer] answer from peer connection"),"sdp:",F.sdp);var W=G.sessionDescription.createLocalAnswer(F.sdp);G.hasIceCandidates(W)||G.resetCandidateGathering(B),G.stats.startWaitingForStreamStart(z);var K=new G.webrtcAdapter.RTCSessionDescription({sdp:W.toLocal(),type:"answer"});return G.setupIceGatheringTimeout(B),Promise.all([G.peerConnection.setLocalDescription(K),G.iceCandidatesDeferred.promise])})).then((function(){var F=G.sessionDescription.createLocalAnswer(G.peerConnection.localDescription.sdp);F.updateModalities(z),G.checkIceCandidates(F);var W=F.toAnswer();z=F.getModalities(),ue.areNegotiatedDirectionsAcceptable(G.configuredModalities,G.negotiatingModalities,z)||G.triggerRenegotiation(!0,B),G.setNegotiatedModalities(z),G.stats.sessionInfo.setBweType(F.getBweType()),G.logger.unsafe.debug("CREATE ANSWER","sdp:",W);var K={blob:W,contentType:G.mediaContentType};return G.configProvider.countryCode&&(K.clientLocation=G.configProvider.countryCode),K})))}}))},WebRtcSession.prototype.processAnswerAsync=function(F,B,G){var W=this,z=F.blob;if(this.logger.unsafe.debug(G?"PROCESS PRANSWER":"PROCESS ANSWER","sdp:",z),G)return this.logger.safe.info("[".concat(B,"] process [pranswer] ignored")),Promise.resolve();this.mediaContentType=F.contentType,-1===this.allowedMediaContentType.indexOf(this.mediaContentType)&&this.allowedMediaContentType.push(this.mediaContentType);var K=this.sessionDescription.createRemoteAnswer(z),J=K.clone(),Q=ue.invertModalities(K.getModalities());this.setNegotiatedModalities(Q);var Y=K.toRemote(this.negotiatedModalities);this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.registerMediaSources(),this.stats.sessionInfo.setBweType(K.getBweType());var $=new this.webrtcAdapter.RTCSessionDescription({sdp:Y,type:"answer"});return this.updateDescriptor($,J),this.logger.unsafe.info("[".concat(B,"] process [answer] set remote description"),"negotiated:",this.negotiatedModalities,"sdp:",$.sdp),this.peerConnection.setRemoteDescription($).then((function(){return W.callbacks.onTransportInitialized&&W.callbacks.onTransportInitialized(),W.negotiatedModalities})).then((function(){return W.handleSharingRecvCapabilities(J),W.handleVideoRecvCapabilities(J)})).then((function(F){F&&W.triggerRenegotiation(!0,B)}))},WebRtcSession.prototype.completeNegotiationAsync=function(F){var B=this;return new Promise((function(G){B.mediaManager.commit();var W=ue.excludePassiveModalities(B.configuredModalities,B.passiveModalities,B.offeredModalities),z=B.forceMediaStreamUpdate&&!ue.isOnHold(B.negotiatedModalities)||!ue.areNegotiatedDirectionsAcceptable(W,B.negotiatingModalities,B.negotiatedModalities)||B.triggerRenegotiationFlag,K=!z;B.canTriggerRenegotiation=!0,B.logger.safe.info("[".concat(F,"] negotiation completed isComplete: ").concat(K," configured: ").concat(JSON.stringify(B.configuredModalities)," negotiating: ").concat(JSON.stringify(B.negotiatingModalities)," offered: ").concat(JSON.stringify(B.offeredModalities)," negotiated: ").concat(JSON.stringify(B.negotiatedModalities))),z&&B.triggerRenegotiation(!1,F),B.negotiationCompletedPromise.resolve(),G({isComplete:K,activeModalities:B.negotiatedModalities,offeredModalities:B.offeredModalities,attemptedModalities:B.negotiatingModalities,configuredModalities:B.configuredModalities,initiator:B.initiator})}))},WebRtcSession.prototype.rejectNegotiationAsync=function(F,B,G){var W=this;return void 0===G&&(G=!1),Promise.resolve().then((function(){if(W.mediaManager.rollback(),W.logger.safe.warn("[".concat(B,"] negotiation rejected isComplete: ").concat(!G," error: ").concat(se.stringifyObject(F)," configured: ").concat(JSON.stringify(W.configuredModalities)," negotiating: ").concat(JSON.stringify(W.negotiatingModalities)," offered: ").concat(JSON.stringify(W.offeredModalities)," negotiated: ").concat(JSON.stringify(W.negotiatedModalities))),W.peerConnection){if("have-local-offer"===W.peerConnection.signalingState)return W.logger.safe.info("[".concat(B,"] rolling back local description")),W.configProvider.config.webrtcHandleRollback?(W.logger.safe.info("[".concat(B,"] rolling back using local renegotiation")),W.negotiationEmulator.renegotiateNow().then((function(){W.logger.safe.info("[".concat(B,"] rolling back using local complete"))}))):W.peerConnection.setLocalDescription(new W.webrtcAdapter.RTCSessionDescription({type:"rollback"}));W.logger.safe.error("[".concat(B,"] cannot rollback local description in currrent state: ").concat(W.peerConnection.signalingState))}})).then((function(){W.canTriggerRenegotiation=!0,W.negotiationCompletedPromise.reject("negotiation rejected"),W.getAddedMediaTypes(W.negotiatedModalities,W.negotiatingModalities).forEach((function(F){W.removeTrackByMediaType(F),W.disposeStreamByMediaType(F)})),W.registerLocalStreams()})).then((function(){return G&&(W.logger.safe.info("[".concat(B,"] retrying failed negotiation")),W.triggerRenegotiation(!1,B)),{isComplete:!G,activeModalities:W.negotiatedModalities,offeredModalities:W.offeredModalities,attemptedModalities:W.negotiatingModalities,configuredModalities:W.configuredModalities,initiator:W.initiator}}))},WebRtcSession.prototype.createRemoteRenderer=function(F){return this.remoteVideoManager.createRenderer(F,this.subscriptionManager,this.logger)},WebRtcSession.prototype.getStatsAsync=function(F){var B=this;return this.terminated||(this.statisticsReport=this.statisticsReport.then((function(){return B.stats.getReport(F)})).catch((function(F){return B.logger.safe.error("getting statistics should never fail: ".concat(F.error)),F.partialReport}))),this.statisticsReport},WebRtcSession.prototype.getLastKnownStats=function(F){return void 0===F&&(F=!1),this.stats.getLastKnownReport(!1,F)},WebRtcSession.prototype.isReconnectSupported=function(){return this.configProvider.config.enableReconnectChrome},WebRtcSession.prototype.muteHold=function(F,B){var G,W,z=this;this.isMuteHold=F;var K=[ce.default.MODALITY.audio,ce.default.MODALITY.video,ce.default.MODALITY.sharing].filter((function(F){return ue.hasSendDirectionality(z.negotiatedModalities[F])&&(F!==ce.default.MODALITY.audio||!z.doAudioMute)}));try{for(var Q=J(K),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;this.setMute(ue.modalityToMediaType($),F,B)}}catch(F){G={error:F}}finally{try{Y&&!Y.done&&(W=Q.return)&&W.call(Q)}finally{if(G)throw G.error}}},WebRtcSession.prototype.muteInputAsync=function(F){return z(this,void 0,void 0,(function(){return K(this,(function(B){return this.doAudioMute=!0,this.setMute("Audio",!0,F),[2]}))}))},WebRtcSession.prototype.unmuteInputAsync=function(F){return z(this,void 0,void 0,(function(){return K(this,(function(B){return this.doAudioMute=!1,this.setMute("Audio",!1,F),[2]}))}))},WebRtcSession.prototype.muteOutputAsync=function(F){return this.audioRenderer.setMuted(!0,F),Promise.resolve()},WebRtcSession.prototype.unmuteOutputAsync=function(F){return this.audioRenderer.setMuted(!1,F),Promise.resolve()},WebRtcSession.prototype.sendDtmf=function(F){return this.dtmfSender.sendDtmf(this.peerConnection,F)},WebRtcSession.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.peerConnection)},WebRtcSession.prototype.pauseNegotiations=function(F){var B=this;void 0===F&&(F=(0,Y.generateCauseId)());var G=new ne.SettablePromise;return this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){B.setNegotiationPromise(G,F)})),G},WebRtcSession.prototype.getExtensionsManager=function(){return this.extensionsManager},WebRtcSession.prototype.onDeviceEvent=function(F){this.stats.onDeviceEvent(F)},WebRtcSession.prototype._deviceSelectionChanged=function(){this.peerConnection&&(this.audioRenderer&&this.audioRenderer.getStream()&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),ue.isOnHold(this.negotiatedModalities)||(this.forceMediaStreamUpdate=!0,this.triggerRenegotiation(!0)))},WebRtcSession.prototype.terminate=function(F,B,G){return void 0===G&&(G=!0),z(this,void 0,void 0,(function(){var B;return K(this,(function(W){switch(W.label){case 0:this.logger.safe.info("[".concat(F,"] terminate")),this.stats.setTerminated(),this.canTriggerRenegotiation=!1,this.cleanUp(F),W.label=1;case 1:return W.trys.push([1,4,5,6]),G?[4,this.getStatsAsync(!1)]:[3,3];case 2:W.sent(),W.label=3;case 3:return[3,6];case 4:return B=W.sent(),this.logger.safe.error("[".concat(F,"] Error while gathering stats ").concat(se.stringifyObject(B))),[3,6];case 5:return this.stats.dispose(),this.terminated=!0,[7];case 6:return[2]}}))}))},WebRtcSession.prototype.cleanUp=function(F){this.activeSpeakerManager.dispose(),this.negotiationQueue.dispose(),this.negotiationCompletedPromise.reject("webRtcSession cleanUp"),this.localVideoStreamWatcher.dispose(),this.remoteVideoManager.dispose(),this.resetPeerConnection(F),this.subscriptionManagerSubs.forEach((function(F){return F.dispose()})),this.subscriptionManager&&this.subscriptionManager.dispose(),this.clearIceDisconnectedTimer(),this.extensionsManager&&this.extensionsManager.dispose(),this.callbacks.onTerminated&&this.callbacks.onTerminated(this)},WebRtcSession.prototype.resetPeerConnection=function(F){this.logger.safe.info("[".concat(F,"] reset peer connection")),this.audioRenderer&&this.audioRenderer.dispose(),this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.peerConnection&&this.peerConnection.close(),this.toBeCalledAfterConnected=[],this.disposeStreams(),this.peerConnection=null,this.contributingSources.stopPolling(),this.negotiationEmulator.configure(null),this.peerConnectionPromise=null,this.resetCandidateGathering(F),this.canTriggerRenegotiation=!0,this.negotiatedModalities={}},WebRtcSession.prototype.resetNegotiationQueue=function(F){void 0===F&&(F=(0,Y.generateCauseId)()),this.negotiationCompletedPromise.reject("promise expired"),this.setNegotiationPromise(new ne.SettablePromise,F)},WebRtcSession.prototype.setNegotiationPromise=function(F,B){void 0===B&&(B=(0,Y.generateCauseId)()),this.terminated||(this.negotiationCompletedPromise=F,this.negotiationQueue.add(this.negotiationCompletedPromise,B))},WebRtcSession.prototype.setupExtensionsManager=function(){var F=new de.default(this.logger.createChild("ExtMgr"));return F.addExtension(ce.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:this.logger,callback:this.activeSpeakerManager.onDominantSpeakerHistoryChanged.bind(this.activeSpeakerManager)}),F.addExtension(ce.default.EXTENSION_TYPE.videoStreamControl,{logger:this.logger,negotiationEmulator:this.negotiationEmulator,qualityManager:this.qualityManager,configProvider:this.configProvider,statisticsGatherer:this.stats}),F},WebRtcSession.prototype.updateQualityLevels=function(F){if(F){this.hwSilent!==F.audioHwSilent&&(this.hwSilent=F.audioHwSilent,this.callbacks.onAudioHwSilentChanged&&this.callbacks.onAudioHwSilentChanged(this.hwSilent)),this.ufdManager.signalEvent("NetworkRecvQuality",F.networkRecvLevel),this.ufdManager.signalEvent("NetworkSendQuality",F.networkSendLevel);var B=!(!F.isSpeaking||!this.doAudioMute);this.ufdManager.signalEvent("DeviceSpeakWhileMuted",B?"Bad":"Good")}},WebRtcSession.prototype.triggerRenegotiation=function(F,B){void 0===B&&(B=(0,Y.generateCauseId)()),this.canTriggerRenegotiation?(this.canTriggerRenegotiation=!1,this.triggerRenegotiationFlag=!1,this.logger.safe.info("[".concat(B,"] triggering renegotiation")),this.mediaManager.backup(),this.callbacks.onNegotiationRequired&&this.callbacks.onNegotiationRequired(B)):F&&(this.logger.safe.info("[".concat(B,"] renegotiation postponed")),this.triggerRenegotiationFlag=!0)},WebRtcSession.prototype.throwIfModalitiesNotConfigured=function(F){if(!this.configuredModalities)throw new Error(F)},WebRtcSession.prototype.addTrack=function(F,B,G){if(F){var W=this.modalityByMediaType(G);if(this.logger.safe.info("add media track kind: ".concat(F.kind," id: ").concat(F.id)),this.senders[W])throw new Error("track already created, modality:"+W+", kind:"+F.kind+", id:"+F.id);"closed"!==this.peerConnection.iceConnectionState&&(this.senders[W]=this.peerConnection.addTrack(F,B))}},WebRtcSession.prototype.registerMediaSources=function(){var F=this,B=[];if(this.mediaStreams.forEach((function(G,W){var z={sourceId:F.getSourceIdForStream(G),defaultSSRC:F.ssrcs[W].min,modality:F.modalityByMediaType(W)};B.push(z)})),this.qualityManager.updateRegisteredSources(B),this.videoStream){var G=this.videoStream.getResolution();this.qualityManager.setCurrentResolution(new te.ResolutionInfo(G.width,G.height))}},WebRtcSession.prototype.updateStream=function(F,B){var G=this;return F.start().then((function(){try{var W=G.mediaStreams.get(B);if(W&&F.isSameStream(W))return F.dispose(),null;if(G.updateSsrcRangeForMediaType(B),G.removeTrackByMediaType(B),G.disposeStreamByMediaType(B),!G.peerConnection)return F.dispose(),null;if(G.addTrack(F.rawTrack,F.rawStream,B),F.onApplyConstraints=function(W){G.removeTrackByMediaType(B),W.then((function(){G.addTrack(F.rawTrack,F.rawStream,B),G.registerLocalStreams(),G.mediaManager.updateMediaEntitiesWithLocalTracks()}))},G.mediaStreams.set(B,F),"Video"===B){var z=[G.getMediaTrackInfo(B)];G.localVideoStreamWatcher.startWatching(z)}}catch(W){throw G.removeTrackByMediaType(B),G.disposeStreamByMediaType(B),F.dispose(),W}}))},WebRtcSession.prototype.getSourceIdForStream=function(F){var B=F.rawStream.getTracks()[0].id,G=this.mediaManager.getMediaEntityByLocalTrackId(B);return G?(this.logger.safe.info("Media entity found: ".concat(JSON.stringify(G.getXSourceStreamId()))),G.getXSourceStreamId()):(this.logger.safe.error("Media entity is not found for stream: ".concat(JSON.stringify(B))),0)},WebRtcSession.prototype.updatePeerConnectionStreamsAsync=function(F,B,G,W){var z=this,K=ue.hasSendDirectionality(this.negotiatedModalities.audio),J=ue.hasSendDirectionality(this.negotiatedModalities.video),Q=ue.hasSendDirectionality(this.negotiatedModalities.sharing),Y=ue.isOnHold(this.negotiatedModalities),$=ue.hasSendDirectionality(F.audio),X=ue.hasSendDirectionality(F.video),Z=ue.hasSendDirectionality(F.sharing),ee=ue.isOnHold(F);return Y||ee||(this.stats.onSendersChanged("Audio",$),this.stats.onSendersChanged("Video",X),this.stats.onSendersChanged("ScreenShare",Z)),this.assurePeerConnectionAsync(W).then((function(){if(z.logger.safe.info("updatePeerConnectionStreamsAsync","pc state",z.peerConnection.signalingState,"hold","[",Y,"->",ee,"]","audio","[",K,"->",$,"]","video","[",J,"->",X,"]","sharing","[",Q,"->",Z,"]"),Y!==ee){if(z.videoStream&&z.videoStream.setHold(ee),z.audioStream&&z.audioStream.setHold(ee),z.displayStream&&z.displayStream.setHold(ee),ee)return;if(!ee&&z.audioStream){z.removeTrackByMediaType("Audio");var F=z.audioStream.clone();z.audioStream.dispose(),z.mediaStreams.set("Audio",F),z.addTrack(z.audioStream.rawStream.getAudioTracks()[0],z.audioStream.rawStream,"Audio")}}if((K!==$||J!==X||Q!==Z||z.forceMediaStreamUpdate)&&(G&&(z.forceMediaStreamUpdate=!1),B&&(z.logger.safe.info("not using any media(track api) track, remove all senders"),$||(z.removeTrackByMediaType("Audio"),z.disposeStreamByMediaType("Audio")),G&&X||(z.removeTrackByMediaType("Video"),z.disposeStreamByMediaType("Video")),G&&Z||(z.removeTrackByMediaType("ScreenShare"),z.disposeStreamByMediaType("ScreenShare"))),G)){var W=[];if(X){var te=z.deviceManager.getVideoStream(!1);W.push(z.updateStream(te,"Video"))}if(Z){te=z.deviceManager.getDisplayStream(!1);W.push(z.updateStream(te,"ScreenShare"))}if($){te=z.deviceManager.getAudioStream(!1);W.push(z.updateStream(te,"Audio").then((function(){z.audioStream.setMuted(z.doAudioMute)})))}return Promise.all(W).then((function(){return z.registerLocalStreams()}))}}))},WebRtcSession.prototype.getMediaTrackInfo=function(F){var B=this.modalityByMediaType(F),G=this.mediaStreams.get(F).rawStream.getTracks()[0].id;return G||this.logger.safe.error("No media track for modality found: ".concat(B)),{trackId:G,modality:B}},WebRtcSession.prototype.getSsrcRangeForMediaType=function(F){var B={min:1,max:1};switch(F){case"Audio":return this.ssrcGenerator.nextAudioStreamSsrc();case"Video":case"ScreenShare":return this.ssrcGenerator.nextVideoStreamSsrc();default:return B}},WebRtcSession.prototype.updateSsrcRangeForMediaType=function(F){"Video"!==F&&"ScreenShare"!==F||(this.ssrcs[F]=this.ssrcGenerator.nextVideoStreamSsrc())},WebRtcSession.prototype.getStreamTransformConfiguration=function(){return{unifiedPlanEnabled:!1,addPrefixForMsid:this.configProvider.config.addPrefixForMsidInSdp}},WebRtcSession.prototype.registerLocalStreams=function(){var F=this,B=[];this.mediaStreams.forEach((function(G,W){B.push(F.getMediaTrackInfo(W))})),this.mediaManager.setLocalTracksInfo(B)},WebRtcSession.prototype.handleVideoRecvCapabilities=function(F){if(this.configProvider.config.enableLocalVideoConstraints&&ue.hasReceiveDirectionality(F.getModalities().video)){if(this.videoStream){var B=F.getVideoRecvCapabilities();if(!B)return this.logger.safe.error("No fmt params found for video modality"),Promise.resolve(!1);var G=this.generateReceiveCapabilities(B,this.videoStream);this.qualityManager.setMaxCapabilities([G])}this.logger.safe.error("remote endpoint didn't specify video receive capability")}return Promise.resolve(!1)},WebRtcSession.prototype.handleSharingRecvCapabilities=function(F){if(this.configProvider.config.enableLocalVideoConstraints&&ue.hasReceiveDirectionality(F.getModalities().sharing)&&this.displayStream){var B=F.getSharingRecvCapabilities();if(!B)return void this.logger.safe.error("No fmt params found for sharing modality");var G=this.generateReceiveCapabilities(B,this.displayStream);this.qualityManager.setMaxCapabilities([G])}},WebRtcSession.prototype.generateReceiveCapabilities=function(F,B){var G=W({ssrc:0,rid:"0",keyframe:!1},F),z={causeId:(0,Y.generateCauseId)(),isSimulcast:!1,sourceId:this.getSourceIdForStream(B),capabilities:[G]};return this.logger.safe.info("Generated receive capabilities for stream ".concat(B.id,": ").concat(JSON.stringify(z))),z},WebRtcSession.prototype.updateDescriptor=function(F,B){var G=B.getVideoRecvCapabilities(),W={sourceId:0,streamMsid:0,bandwidth:0};if(G&&this.videoStream&&!this.displayStream&&(W.sourceId=this.getSourceIdForStream(this.videoStream),W.streamMsid=this.videoStream.id,W.bandwidth=G.maxBr?G.maxBr:Number.MAX_VALUE),W.bandwidth>0){W.bandwidth=Math.floor(W.bandwidth/1200);var z=new le.BandwidthControlModifier(this.logger.createChild("rembModifier"),this.qualityManager,this.resolutionTable,this.configProvider);z.setControlItem(W),z.modifyDescriptor(F)}},WebRtcSession.prototype.removeTrackByMediaType=function(F){return this.removeTracksByModality(this.modalityByMediaType(F))},WebRtcSession.prototype.modalityByMediaType=function(F){switch(F){case"Audio":return ce.default.MODALITY.audio;case"Video":return ce.default.MODALITY.video;case"ScreenShare":return ce.default.MODALITY.sharing;default:throw new Error("Modality is not defined for media type: ".concat(F))}},WebRtcSession.prototype.removeTracksByModality=function(F){var B=this;this.forceKeyFramePromise&&"sharing"===F?this.forceKeyFramePromise.then((function(){B.removeTracksByModality(F)})):F in this.senders&&(this.logger.safe.info("remove sender track kind: ".concat(this.senders[F].track.kind," track id: ").concat(this.senders[F].track.id)),"closed"!==this.peerConnection.iceConnectionState&&this.peerConnection.removeTrack(this.senders[F]),delete this.senders[F])},WebRtcSession.prototype.handleCodecSwitchUnsupported=function(F){var B=this;return this.offeredDescription.isCodecSwitchSupported()?Promise.resolve():this.webrtcAdapter.RTCRtpReceiver.getCapabilities(ce.default.MEDIA_TYPE.audio).then((function(F){var G=F.codecs.map((function(F){return F.mimeType}));B.offeredDescription.usePrimaryAudioCodecOnly(G)})).catch((function(G){B.logger.safe.error("[".concat(F,"] failed to set primary codec based on audio capability ").concat(se.stringifyObject(G)))}))},WebRtcSession.prototype.disposeStreamByMediaType=function(F){var B=this.mediaStreams.get(F);B&&(this.mediaStreams.delete(F),B.dispose(),"Video"===F&&this.localVideoStreamWatcher.stopWatching())},WebRtcSession.prototype.disposeStreams=function(){var F=this;this.mediaStreams.forEach((function(B,G){return F.disposeStreamByMediaType(G)}))},WebRtcSession.prototype.assurePeerConnectionAsync=function(F){var B=this;if(!this.peerConnectionPromise){if(!this.relayManagerProvider)throw new Error("relay manager provider is not set!");this.logger.safe.info("fetching relay details from RelayManager...");var G={relayType:"turn",isRemoteClientLync:this.context.config.isRemoteClientLync};this.peerConnectionPromise=this.relayManagerProvider.getRelayManager().queryRelaysAsync(G).then((function(G){if(B.terminated)throw new Error("session already disposed");var W={optional:[]},z=(0,be.createIceServers)(G,B.configProvider.config),K=B.configureCrypto(W);B.configureCpuThreshold(W),B.logger.safe.info("create peer connection");var J=B.context.configProvider.mediaConfig.isTransportUnbundled?"balanced":"max-bundle",$=B.peerConnection=new B.webrtcAdapter.RTCPeerConnection({iceServers:z,rtcpMuxPolicy:"require",iceTransportPolicy:B.iceTransportPolicy,bundlePolicy:J,sdpSemantics:"plan-b",audioPortRange:B.configProvider.mediaConfig.audioPortRange,videoPortRange:B.configProvider.mediaConfig.videoPortRange,enableDtlsSrtp:1===K,offerExtmapAllowMixed:!1},W);B.negotiationEmulator.configure($),B.stats.initialize($),B.stats.sessionInfo.setIceServers(z),B.stats.sessionInfo.setIceTransportPolicy(B.iceTransportPolicy),B.stats.sessionInfo.setBundlePolicy(J),B.webrtcAdapter.RTCRtpReceiver.getCapabilities("video").then((function(F){return B.stats.setH264AvailableProfiles(F)})),B.contributingSources.startPolling(),$.onnegotiationneeded=function(){B.logger.safe.info("onnegotiationneeded signalingState: ".concat($.signalingState))},$.onsignalingstatechange=function(){B.stats.sessionInfo.setSignalingConnectionState($.signalingState),B.logger.safe.info("onsignalingstatechange signalingState: ".concat($.signalingState))},$.onicecandidateerror=function(F){var G=Q([F.address,F.port],2),W=G[0],z=G[1];B.logger.safe.warn("On ICE candidate error ".concat(F.url," | ").concat(W,":").concat(z,": code ").concat(F.errorCode,": ").concat(F.errorText)),B.isConnected()&&!B.iceCandidatesDeferred.isPending||B.stats.addIceCandidateError({address:W,port:+z,url:F.url,errorCode:F.errorCode,errorText:F.errorText})};var onAddStream=function(F){if(!B.isConnected())return B.logger.safe.info("onaddstream handling postponed till PC is connected"),void B.toBeCalledAfterConnected.push((function(){return onAddStream(F)}));var G=F.stream;B.logger.safe.info("onaddstream stream: ".concat(G.id));var W=B.mediaManager.getMediaEntityByRemoteStreamId(G.id);if(W||(B.logger.safe.info("cannot find media entity with stream id ".concat(G.id," trying to fallback")),G.getAudioTracks()[0]&&(W=B.mediaManager.getMediaEntitiesByModality(ce.default.MODALITY.audio)[0])),W){var z=B.createReceiveStream(G,W);B.receiveStreamCollection.add(z)}else B.logger.safe.error("could not find media entity for an added stream: ".concat(G.id))};$.onaddstream=onAddStream,$.ontrack=function(F){B.logger.safe.info("ontrack track: ".concat(F.track))};var onRemoveStream=function(F){if(!B.isConnected())return B.logger.safe.info("onremovestream handling postponed till PC is connected"),void B.toBeCalledAfterConnected.push((function(){return onRemoveStream(F)}));B.logger.safe.info("onremovestream stream: ".concat(F.stream)),B.receiveStreamCollection.remove(F.stream.id)};$.onremovestream=onRemoveStream,$.onicecandidate=function(G){var W=G.candidate;if(W){var K=ue.parseCandidateString(W.candidate);B.logger.safe.info("[".concat(F,"] onicecandidate candidate: prio:").concat(K.priority," type:").concat(K.type," port:").concat(K.port)),B.logger.unsafe.info("[".concat(F,"] candidate details: ").concat(W.candidate)),!B.relayCandidateGathered&&W.candidate.indexOf("typ relay")>-1&&(B.stats.sessionInfo.setRelayCandidateInfo({priority:W.priority||W.candidate.split(" ")[3],time:Date.now()-B.iceRelayCandidatesGatherStartTime}),B.relayCandidateGathered=!0)}else B.logger.safe.info("[".concat(F,"] onicecandidate candidate: null"));if(B.iceCandidatesDeferred.isPending){var J=!B.initiator||!B.context.config.webrtcIceGatheringTimeoutIncreased,Q=B.iceHostCandidateOnly||0===z.length;if(!W&&J||Q){W&&B.logger.safe.info("[".concat(F,"] Not waiting for ICE candidates, hoping that host/prflx is enough")),B.logger.safe.info("[".concat(F,"] Is connected:"),B.isConnected(),$.iceConnectionState,$.signalingState);var Y=!0;if(B.context.configProvider.mediaConfig.isTransportUnbundled&&W)Y=B.sessionDescription.createLocalOffer(B.peerConnection.localDescription.sdp).hasUnbundledIceCandidates();Y&&B.completeCandidateGathering(F)}else if(B.relayCandidateGathered){Y=!0;if(B.context.configProvider.mediaConfig.isTransportUnbundled)Y=B.sessionDescription.createLocalOffer(B.peerConnection.localDescription.sdp).hasUnbundledRelayIceCandidates();Y&&(B.stats.clearIceCandidateErrors(),B.completeCandidateGathering(F))}}},$.onicegatheringstatechange=function(){B.logger.safe.info("onicegatheringstatechange iceGatheringState: ".concat($.iceGatheringState))},$.oniceconnectionstatechange=function(){var F=(0,Y.generateCauseId)();if(!B.terminated){if(B.stats.sessionInfo.setIceConnectionState($.iceConnectionState),B.logger.safe.info("[".concat(F,"] oniceconnectionstatechange iceConnectionState: ").concat($.iceConnectionState," pc.signalingState: ").concat($.signalingState)),"connected"===$.iceConnectionState||"completed"===$.iceConnectionState)B.onTransportConnected(F);else if("failed"===$.iceConnectionState){if(B.iceCandidatesDeferred.isPending)return B.logger.safe.info("[".concat(F,"] ice failed while gathering candidates, suppressing error")),void B.completeCandidateGathering(F);B.raiseError({type:ce.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"},F),B.configProvider.config.webrtcCloseAfterIceFailure&&$.close(),B.onTransportFailed()}"disconnected"===$.iceConnectionState?(B.onTransportDisconnected(F),B.startIceDisconnectedTimer(F)):B.clearIceDisconnectedTimer()}}}))}return this.peerConnectionPromise},WebRtcSession.prototype.configureCrypto=function(F){var B=!1,G=ue.preferSdesSrtp(this.context);if(this.offeredDescription){var W=this.offeredDescription.getSrtpInfo();this.stats.sessionInfo.setOfferedSrtpInfo(W),B=!W.dtls||W.sdes&&G}else B=G;return B&&(this.logger.safe.info("configuring peer connection to use sdes"),F.optional.push({DtlsSrtpKeyAgreement:!1})),this.stats.sessionInfo.setNegotiatedSrtpInfo({dtls:!B,sdes:!!B}),B?0:1},WebRtcSession.prototype.configureCpuThreshold=function(F){this.configProvider.config.webrtcNativeCpuOveruseDisabled&&this.multiParty&&F.optional.push({googCpuOveruseDetection:!1})},WebRtcSession.prototype.completeCandidateGathering=function(F){this.iceCandidatesDeferred.isPending&&(this.logger.safe.info("[".concat(F,"] ICE candidates gathered completely")),this.iceCandidatesDeferred.resolve())},WebRtcSession.prototype.onTransportConnected=function(F){if(this.logger.safe.info("[".concat(F,"] audio transport connected")),this.stats.clearIceCandidateErrors(),!this.terminated){for(;this.toBeCalledAfterConnected.length;)this.toBeCalledAfterConnected.shift()();this.callbacks.onAudioStateChanged(ce.default.STREAMING_STATE.active,F),this.callbacks.onTransportConnected&&this.callbacks.onTransportConnected(F)}},WebRtcSession.prototype.onTransportDisconnected=function(F){this.callbacks.onTransportDisconnected&&this.callbacks.onTransportDisconnected(F)},WebRtcSession.prototype.onTransportFailed=function(){this.callbacks.onTransportFailed&&this.callbacks.onTransportFailed()},WebRtcSession.prototype.startIceDisconnectedTimer=function(F){var B=this;this.configProvider.config.iceDisconnectedTimeoutMs&&(this.iceDisconnectedTimer=setTimeout((function(){B.logger.safe.error("[".concat(F,"] ice disconnected for ").concat(B.configProvider.config.iceDisconnectedTimeoutMs,"ms. Raise CONSTANTS.MEDIAthis._ERROR.iceConnectionError")),B.raiseError({type:ce.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},F)}),this.configProvider.config.iceDisconnectedTimeoutMs))},WebRtcSession.prototype.clearIceDisconnectedTimer=function(){this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null)},WebRtcSession.prototype.raiseError=function(F,B){void 0===B&&(B=(0,Y.generateCauseId)()),this.logger.safe.error("[".concat(B,"] Media error occurred type: ").concat(F.type," detail: ").concat(F.detail)),this.callbacks.onSessionErrorOccurred&&this.callbacks.onSessionErrorOccurred(F,B)},WebRtcSession.prototype.createNegotiationConstraints=function(F){function canReceive(F){return!!F&&(ue.hasReceiveDirectionality(F)||"inactive"===F)}return{offerToReceiveAudio:canReceive(F.audio),offerToReceiveVideo:canReceive(F.video)||canReceive(F.sharing)}},WebRtcSession.prototype.resetCandidateGathering=function(F){this.logger.safe.info("[".concat(F,"] reset candidate gathering")),this.iceCandidatesDeferred.promise.then((function(){}),(function(){})),this.iceCandidatesDeferred.reject(new Error("reset candidate gathering")),this.iceCandidatesDeferred=new ne.SettablePromise},WebRtcSession.prototype.checkIceCandidates=function(F){var B=this.hasIceCandidates(F);if(B===this.noIceCandidates&&(this.noIceCandidates=!this.noIceCandidates,this.ufdManager.signalEvent("NoNetwork",this.noIceCandidates?"Bad":"Good"),this.noIceCandidates))throw{type:ce.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};if(B){var G=this.hasRelayIceCandidates(F);if(G===this.noRelayIceCandidates){if(!G&&("connected"===this.peerConnection.iceConnectionState||"completed"===this.peerConnection.iceConnectionState))return;this.noRelayIceCandidates=!this.noRelayIceCandidates,this.ufdManager.signalEvent("NetworkRelaysNotReachable",this.noRelayIceCandidates?"Bad":"Good")}}},WebRtcSession.prototype.hasIceCandidates=function(F){return this.configProvider.mediaConfig.isTransportUnbundled?F.hasUnbundledIceCandidates():F.hasIceCandidates()},WebRtcSession.prototype.hasRelayIceCandidates=function(F){return this.configProvider.mediaConfig.isTransportUnbundled?F.hasUnbundledRelayIceCandidates():F.hasRelayIceCandidates()},WebRtcSession.prototype.doRetargetIfNeeded=function(F,B,G){var W=B.isIceRestart();this.logger.safe.info("[".concat(G,"] ICE restart: ").concat(W)),this.context.configProvider.mediaConfig.isTransportUnbundled&&this.offeredDescription&&this.offeredDescription.isMSRTC()&&W&&!this.multiParty&&B.getSrtpInfo().sdes&&(F.newOffer=!0)},WebRtcSession.prototype.getAddedMediaTypes=function(F,B){F||(F={}),B||(B={});var G=[];return isModalityAdded(F.audio,B.audio)&&G.push("Audio"),isModalityAdded(F.video,B.video)&&G.push("Video"),isModalityAdded(F.sharing,B.sharing)&&G.push("ScreenShare"),G},WebRtcSession.prototype.applyCapabilitiesForModality=function(F,B,G){return F===ce.default.MODALITY.video?this.applyCapabilitiesForVideo(B,G[0]):F===ce.default.MODALITY.sharing?this.applyCapabilitiesForSharing(B,G[0]):Promise.resolve(!1)},WebRtcSession.prototype.applyCapabilitiesForSharing=function(F,B){var G=this;return this.displayStream?this.applyCapabilities(this.displayStream,B).then((function(W){return G.stats.onMaxCapabilitiesApplied({causeId:F,modality:ce.default.MODALITY.sharing,capabilities:[B]}),G.configProvider.config.webrtcAllowRestoreKeyframe?G.forceKeyframe(G.senders[ce.default.MODALITY.sharing]).then((function(){return W})):Promise.resolve(W)})):(this.logger.safe.info("".concat(JSON.stringify(B)," is ignored as no sharing stream is sent, no renegotiation")),Promise.resolve(!1))},WebRtcSession.prototype.forceKeyframe=function(F){var B=this;if(!F)return this.logger.safe.error("forceKeyframe: No sender available for sharing"),null;if(this.forceKeyFramePromise)return this.logger.safe.warn("forceKeyframe: already in progress"),this.forceKeyFramePromise;this.logger.safe.info("Restoring keyframe");var G=F.track;return this.forceKeyFramePromise=F.replaceTrack(null).then((function(){return F.replaceTrack(G)})).then((function(){B.forceKeyFramePromise=null,B.logger.safe.info("Restoring keyframe finished")})).catch((function(F){B.forceKeyFramePromise=null,B.logger.safe.error("Restoring keyframe failed: ".concat(F)),delete B.senders[ce.default.MODALITY.sharing]})),this.forceKeyFramePromise},WebRtcSession.prototype.applyCapabilitiesForVideo=function(F,B){return this.negotiationCompletedPromise.isPending?(this.logger.safe.info("##### Renegotiation is in progress, no local resolution switch for now #####"),this.negotiationCompletedPromise.promise.then((function(){return Promise.resolve(!1)}))):this.videoStream?this.scheduleApplyCapabilities(this.videoStream,F,B):(this.logger.safe.info("".concat(JSON.stringify(B)," is ignored as no video is sent, no renegotiation")),Promise.resolve(!0))},WebRtcSession.prototype.scheduleApplyCapabilities=function(F,B,G){var W=this;this.logger.safe.info("Queueing local renegotiation...");var z=!1;return this.negotiationQueue.add((function(){return W.logger.safe.info("############# LOCAL RENEGOTIATION START #############"),W.applyCapabilities(F,G).then((function(){W.stats.onMaxCapabilitiesApplied({causeId:B,modality:ce.default.MODALITY.video,capabilities:[G]}),z=!0}))}),B),this.negotiationEmulator.renegotiate().then((function(){return W.logger.safe.info("############# LOCAL RENEGOTIATION END. RESULT: ".concat(z,"  #############")),z}))},WebRtcSession.prototype.applyCapabilities=function(F,B){return F?(this.logger.safe.info("Changing resolution to ".concat(JSON.stringify(B))),F.applyCapabilities(B)):(this.logger.safe.info("Resolution ".concat(JSON.stringify(B)," ignored, no stream is being sent")),Promise.resolve(!1))},WebRtcSession.prototype.onOptimalVideoReceiversCountChanged=function(F){this.callback.onOptimalVideoReceiversCountChanged&&this.callback.onOptimalVideoReceiversCountChanged(F)},WebRtcSession.prototype.onSendBandwidthChanged=function(F){return z(this,void 0,void 0,(function(){var B,G,W=this;return K(this,(function(z){return this.isConnected()?(B=this.extensionsManager.getExtension(ce.default.EXTENSION_TYPE.videoStreamControl),0===(G=this.mediaManager.getMediaEntities().filter((function(F){return[ce.default.MODALITY.video,ce.default.MODALITY.sharing].indexOf(F.getModality())>-1})).filter((function(F){return F.isEnabled()})).map((function(F){return F.getMid()}))).length?[2]:[2,B.sendBandwidthInfo(G,F).then((function(){W.stats.setReportedSendBandwidth(F)}))]):[2]}))}))},WebRtcSession.prototype.getStreams=function(){return this.receiveStreamCollection.getStreams()},WebRtcSession.prototype.onStreamsChanged=function(F){this.streamsChangedListener=F},WebRtcSession.prototype.notifyStreamsChanged=function(){var F=this;this.logger.safe.info("Scheduling stream changed notification: ".concat(this.streamsChangedNotificationScheduled)),this.streamsChangedNotificationScheduled||this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){F.streamsChangedNotificationScheduled=!1,F.streamsChangedListener&&F.streamsChangedListener()}))},WebRtcSession.prototype.streamAdded=function(F){ce.default.MODALITY.audio===F.getModality()&&(this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),this.audioRenderer.play(F.getMediaStream())),this.notifyStreamsChanged()},WebRtcSession.prototype.streamRemoved=function(F){ce.default.MODALITY.audio===F.getModality()&&this.audioRenderer.getStream()===F.getMediaStream()&&this.audioRenderer.stop(),this.notifyStreamsChanged()},WebRtcSession.prototype.setNegotiatedModalities=function(F){this.negotiatedModalities=F,this.stats.sessionInfo.setNegotiatedModalities(F)},WebRtcSession.prototype.setupIceGatheringTimeout=function(F){var B=this;this.iceRelayCandidatesGatherStartTime=Date.now();var G=this.context.config.webrtcIceGatheringTimeoutIncreased?this.configProvider.config.relayWaitSaneTimeoutMs:this.configProvider.config.webrtcIceGatheringTimeoutMs;if(G){this.iceCandidatesTimer>0&&clearTimeout(this.iceCandidatesTimer);var W=this.iceCandidatesDeferred;this.iceCandidatesTimer=setTimeout((function(){B.iceCandidatesTimer=0,W.isPending&&(B.logger.safe.warn("[".concat(F,"] ICE candidates gathering terminated due to timeout ").concat(G)),W.resolve())}),G)}},WebRtcSession.prototype.createAudioRenderer=function(){this.audioRenderer=new ee.default(this.logger.createChild("AudioRenderer"),this.configProvider),this.context.maContext.domOverrides.onMediaElementAdded&&this.audioRenderer.on("onAudioElementAdded",this.context.maContext.domOverrides.onMediaElementAdded),this.context.maContext.domOverrides.onMediaElementRemoved&&this.audioRenderer.on("onAudioElementRemoved",this.context.maContext.domOverrides.onMediaElementRemoved)},WebRtcSession.prototype.isConnected=function(){var F=this.peerConnection;return F&&("connected"===F.iceConnectionState||"completed"===F.iceConnectionState)},WebRtcSession.prototype.isFailed=function(){return this.peerConnection&&("failed"===this.peerConnection.iceConnectionState||"closed"===this.peerConnection.iceConnectionState)},WebRtcSession.prototype.createReceiveStream=function(F,B){var G=this,W=this.configProvider.config.addFmtpToInitialSubscription?B.getVideoCapabilities():null,z=this.configProvider.config.useMultiviewLimitsOnInitialRequest&&B.getModality()!==ce.default.MODALITY.sharing?function(){return G.remoteVideoManager.getMaxAllowedVideoFS()}:null;return new Ce.default(F,null,B.getModality(),+B.getXSourceStreamId(),this,W,z)},WebRtcSession.prototype.requestSource=function(F,B,G,W){var z=this;return this.multiParty?!this.isMuteHold&&this.negotiatedModalities[F]!==ce.default.MEDIA_STATE.inactive||G===re.MediaSourceIdentifiers.SourceNone?this.negotiationCompletedPromise.isPending?this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){return z.requestSource(F,B,G,W)})):Promise.resolve().then((function(){return z.extensionsManager.getExtension(ce.default.EXTENSION_TYPE.videoStreamControl).sendSourceRequest(B,G,W)})):$.delay(10).then((function(){return z.requestSource(F,B,G,W)})):Promise.resolve()},WebRtcSession.prototype.onMaxVideoSendCapabilitiesChanged=function(F,B){},WebRtcSession.prototype.getSessionConfig=function(){return this.configProvider},WebRtcSession}();function isModalityAdded(F,B){return!ue.hasSendDirectionality(F)&&ue.hasSendDirectionality(B)}B.default={build:function(F,B,G){return new Ae(F,B,G)}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MsSdpTransform=void 0;var W=G(4),z=G(370),K=G(371),J=G(372),Q=G(10),Y={audio:"main-audio",video:"main-video"},$=function(){function MsSdpTransform(F,B){this.context=F,this.mediaManager=B,this.logger=this.context.logger,this.candidateTransform=z.default.build(),this.streamTransform=new J.SsrcTransform(this.context.configuration),this.rtcpTransform=K.default.build()}return MsSdpTransform.prototype.toMsSdp=function(F,B){var G=this;return F.msidSemantic={semantic:"WMS",token:"*"},F.media.forEach((function(z,K){if(z.protocol=W.default.PROFILES.rtpSavp,z.label=z.label||G.getLabel(z.type),0===z.port){for(var J in z)z.hasOwnProperty(J)&&["type","port","protocol","payloads"].indexOf(J)<0&&delete z[J];z.payloads="34"}var Q=G.getSsrcRangeForIndex(z.direction,K);G.streamTransform.toMsSdp(z,Q),z.crypto&&z.crypto.forEach((function(F){F.config+="|2^31"})),0!==z.port&&F.fingerprint&&(z.fingerprint=F.fingerprint),G.candidateTransform.toMsSdp(z,F),G.rtcpTransform.toMsSdp(z,B),z.invalid&&(G.logger.unsafe.error("Unknown SDP attributes! ".concat(JSON.stringify(z.invalid))),delete z.invalid),G.transformExtensions(z,!1),0!==z.port&&(z.type===W.default.MEDIA_TYPE.audio&&G.context.configProvider.config.webrtcAudioChannelSignalingFeedback?z.signalingFbXMessage={payload:"*",param:G.context.configProvider.config.webrtcAudioChannelSignalingFeedback}:z.type===W.default.MEDIA_TYPE.video&&G.context.configProvider.config.webrtcVideoChannelSignalingFeedback&&(z.signalingFbXMessage={payload:"*",param:G.context.configProvider.config.webrtcVideoChannelSignalingFeedback}))})),delete F.fingerprint,F},MsSdpTransform.prototype.fromMsSdp=function(F,B){for(var G=F.media.length-1;G>=0;--G){var W=F.media[G];if((W.ssrcs&&W.ssrcs[0]||W.xSsrcRange)&&(F.msidSemantic={semantic:"WMS",token:"*"}),0!==W.port){if(this.streamTransform.fromMsSdp(W),delete W.cryptoscale,W.fingerprint&&(!this.isOffer(B)||this.context.configProvider.config.disableIncomingDtlsRoleOverride&&W.setup||(W.setup="actpass")),W.crypto)for(var z=W.crypto.length-1;z>=0;--z){var K=W.crypto[z];K.config.match(/.*\|\d+:\d+/)?W.crypto.splice(z,1):K.config=K.config.replace(/(.*)\|2\^\d+/,"$1")}W.remoteCandidates&&(delete W.candidates,delete W.xCandidatesIpv6,delete W.remoteCandidates),this.candidateTransform.fromMsSdp(W),W.rtcpFbXMessage&&delete W.rtcpFbXMessage,W.invalid&&this.logger.unsafe.info("Unknown SDP attributes! ".concat(JSON.stringify(W.invalid))),this.transformExtensions(W,!0)}else W.direction||(W.direction="inactive")}return F},MsSdpTransform.prototype.transformExtensions=function(F,B){var G=[{name:W.default.ABS_SEND_TIME.EXT_URI,encoded:W.default.ABS_SEND_TIME.MSSDP_ENCODED_URI},{name:W.default.TRANSPORT_CC.EXT_URI,encoded:W.default.TRANSPORT_CC.MSSDP_ENCODED_URI}];F.ext&&F.ext.forEach((function(F){G.some((function(G){var W=B?G.encoded:G.name,z=B?G.name:G.encoded;return W===F.uri&&(F.uri=z,!0)}))}))},MsSdpTransform.prototype.isOffer=function(F){return"offer"===F},MsSdpTransform.prototype.getLabel=function(F){return Y.hasOwnProperty(F)&&Y[F]||"undefined"},MsSdpTransform.prototype.getSsrcRangeForIndex=function(F,B){var G=this.mediaManager.getMediaEntities()[B],W=null==G?void 0:G.getSimulcastContext();return Q.hasSendDirectionality(F)&&W?W.getSsrcRange():0},MsSdpTransform}();B.MsSdpTransform=$},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(39);function CandidateTransform(){var F=[{jsep:"active",msSdp:"tcp-act"},{jsep:"passive",msSdp:"tcp-pass"},{jsep:"so",msSdp:"tcp-so"}];function transformBundle(F,B){if(F.port&&!F.candidates.length){var G=(0,W.getBundle)(B);G&&(F.port=G.port,F.connection=G.connection)}}function transformCandidate(F,B){delete F.generation,delete F["network-id"],delete F["network-cost"],F.transport.match(/tcp/i)&&transformTcpCandidate(F,B)}function transformTcpCandidate(B,G){F.some((function(F){if(G){if(F.msSdp===B.transport.toLowerCase())return B.transport="tcp",B.tcptype=F.jsep,!0}else if(B.tcptype&&F.jsep===B.tcptype.toLowerCase())return B.transport=F.msSdp,delete B.tcptype,!0;return!1}))}function isDefault(F,B,G){var W=B.connection||G.connection,isSame=function(F,B,G){return F.port===G&&F.ip===B};return!!W&&(1===F.component?isSame(F,W.ip,B.port):!!B.rtcp&&isSame(F,B.rtcp.ip||W.ip,B.rtcp.port))}this.fromMsSdp=function(F){F.candidates=F.candidates||[],F.xCandidatesIpv6&&(F.xCandidatesIpv6.forEach((function(B){F.candidates.push(B)})),delete F.xCandidatesIpv6),F.candidates.forEach((function(F){transformCandidate(F,!0)}))},this.toMsSdp=function(F,B){F.candidates=F.candidates||[],F.candidates.sort((function(G,W){return G.foundation!==W.foundation?G.foundation-W.foundation:G.component!==W.component?G.component-W.component:+isDefault(W,F,B)-+isDefault(G,F,B)})),F.candidates=F.candidates.filter((function(B,G){transformCandidate(B,!1);var W=F.candidates[G-1];return!W||W.component!==B.component||W.foundation!==B.foundation})),transformBundle(F,B)}}B.default={build:function(){return new CandidateTransform}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function RtcpTransform(){}return RtcpTransform.prototype.toMsSdp=function(F,B){"offer"===B?F.rtcp&&(F.rtcp={port:F.port}):delete F.rtcp},RtcpTransform}();B.default={build:function(){return new W}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SsrcTransform=void 0;var W=G(1),z=G(4),K=G(373),J=[{label:z.default.MEDIA_LABEL.audio,id:K.default.STREAM_ID.audio},{label:z.default.MEDIA_LABEL.video,id:K.default.STREAM_ID.video},{label:z.default.MEDIA_LABEL.sharing,id:K.default.STREAM_ID.sharing}].reduce((function(F,B){return F[B.label]=B.id,F}),{}),Q=W.uniqueId(),Y=function(){function SsrcTransform(F){this.configuration=F}return SsrcTransform.prototype.fromMsSdp=function(F){var B=this;if(0!==F.port){var G="-";if(!this.isRecvOnly(F)||this.configuration.unifiedPlanEnabled){if(F.msid){F.ssrcs&&1===F.ssrcs.length&&(this.addStream(F,F.ssrcs[0].id,F.ssrcs[0].value,F.msid),F.ssrcs.shift());var W=F.msid.split(" ");(this.configuration.addPrefixForMsid||W[0]===G)&&(F.msid=this.getMsidValue(W[0],W[1]||W[0],F.label))}if(F.ssrcs)this.updateMsids(F.ssrcs,(function(W,z){return B.configuration.addPrefixForMsid||W===G?B.getMsidValue(W,z,F.label):"".concat(W," ").concat(z)}));else{var z=this.getFlowSsrcs(F);z.length>0?z.forEach((function(G){B.addStream(F,G,Q,B.getMsidValue(z[0],z[0],F.label))})):F.xSsrcRange&&this.addStream(F,F.xSsrcRange.ssrcMin,Q,this.getMsidValue(F.xSsrcRange.ssrcMin,F.xSsrcRange.ssrcMin,F.label))}}delete F.xSsrcRange}},SsrcTransform.prototype.toMsSdp=function(F,B){var G;0!==F.port&&(F.ssrcs&&F.ssrcs[0]&&(G=F.ssrcs[0].id),void 0!==G&&(F.xSsrcRange={ssrcMin:G,ssrcMax:G+B}))},SsrcTransform.prototype.getFlowSsrcs=function(F){var B;if(F.ssrcGroups&&F.type===z.default.MEDIA_TYPE.video&&(F.ssrcGroups.some((function(F){return"FID"===F.semantics&&(B=F,!0)})),B))return B.ssrcs.split(" ").map((function(F){return+F}));return[]},SsrcTransform.prototype.addStream=function(F,B,G,W){F.ssrcs=F.ssrcs||[],F.ssrcs.push({attribute:"cname",id:B,value:G}),F.ssrcs.push({attribute:"msid",id:B,value:W})},SsrcTransform.prototype.updateMsids=function(F,B){F.filter((function(F){return"msid"===F.attribute})).forEach((function(F){var G=F.value.split(" ");F.value=B(G[0],G[1]||G[0])}))},SsrcTransform.prototype.getMsidValue=function(F,B,G){var W=this.getMsidPrefix(G);return W+F+" "+W+B},SsrcTransform.prototype.getMsidPrefix=function(F){return J[F]?J[F]+K.default.STREAM_ID_DELIMITER:""},SsrcTransform.prototype.isRecvOnly=function(F){return"recvonly"===F.direction},SsrcTransform}();B.SsrcTransform=Y},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.default={STREAM_ID:{audio:"mainAudio",video:"mainVideo",sharing:"applicationsharingVideo"},STREAM_ID_DELIMITER:"-"}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(4),z=G(375),K=G(377),J=G(378),Q=function(){function ExtensionFactory(){}return ExtensionFactory.getExtension=function(F){switch(F){case W.default.EXTENSION_TYPE.dominantSpeakerHistory:return new K.default;case W.default.EXTENSION_TYPE.videoStreamControl:return new J.default;case W.default.EXTENSION_TYPE.optimalVideoCount:return new z.default;default:throw new Error("Extension of type ".concat(F," is not found"))}},ExtensionFactory}();B.default=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(4),J=G(376),Q=function(F){function OptimalVideoCountExtension(){var B=F.call(this,K.default.EXTENSION_TYPE.optimalVideoCount)||this;return B.callback=null,B}return z(OptimalVideoCountExtension,F),OptimalVideoCountExtension.prototype.initialize=function(B){var G=this;F.prototype.initialize.call(this,B),this.extensionManagerSubscription=this.manager.on("onBandwidthMessage",(function(F){return G.onBandwidthMessage(F)})),this.callback=B.callback,this.statisticsGatherer=B.statisticsGatherer,this.diagnostics=B.diagnostics,this.optimalCountCalculator=new J.OptimalReceiversCountCalculator(B.configProvider.config,B.logger.createChild("OptVideoCnt")),this.optimalCountCalculator.on("onOptimalReceiversCountChanged",(function(F){var B,W,z;null===(B=G.statisticsGatherer)||void 0===B||B.addOptimalVideoCountReport(F),null===(W=G.diagnostics)||void 0===W||W.addOptimalVideoCountReport(F),null===(z=G.callback)||void 0===z||z.call(G,F)}))},OptimalVideoCountExtension.prototype.configure=function(){var F;null===(F=this.optimalCountCalculator)||void 0===F||F.start()},OptimalVideoCountExtension.prototype.dispose=function(){var B;F.prototype.dispose.call(this),this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null,this.callback=null,null===(B=this.optimalCountCalculator)||void 0===B||B.dispose()},OptimalVideoCountExtension.prototype.onBandwidthMessage=function(F){var B,G,W;null===(B=this.statisticsGatherer)||void 0===B||B.addReportedReceiveBandwidth(F.bw),null===(G=this.diagnostics)||void 0===G||G.addReportedReceiveBandwidth(F.bw),null===(W=this.optimalCountCalculator)||void 0===W||W.processEstimatedBandwidth(F.bw)},OptimalVideoCountExtension}(G(85).ExtensionBase);B.default=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.OptimalReceiversCountCalculator=void 0;var K=G(6),J=G(1),Q=function(F){function OptimalReceiversCountCalculator(B,G){var W=F.call(this,G)||this;return W.settings=B,W.logger=G,W.bandwidthEstimationAvailable=!1,W.slidingWindow=[],W.optimalReceiversCount=0,W.lastReported=0,W.totalSamples=0,W.isStarted=!1,W.timer=-1,W}return z(OptimalReceiversCountCalculator,F),OptimalReceiversCountCalculator.prototype.start=function(){this.isStarted=!0},OptimalReceiversCountCalculator.prototype.dispose=function(){F.prototype.dispose.call(this),-1!==this.timer&&(window.clearTimeout(this.timer),this.timer=-1)},OptimalReceiversCountCalculator.prototype.processEstimatedBandwidth=function(F){this.bandwidth=F,this.processOptimalReceiversCount()},OptimalReceiversCountCalculator.prototype.sample=function(F){if(this.slidingWindow.length>=this.settings.ovcSlidingWindowSamples?this.slidingWindow.shift():this.slidingWindow.length===this.settings.ovcSlidingWindowSamples-1&&(this.slidingWindow=this.slidingWindow.map((function(){return F}))),this.slidingWindow.push(F),this.slidingWindow.length>=this.settings.ovcSlidingWindowSamples){var B=this.slidingWindow.slice().sort(),G=J.average(B);return B[B.length-1]-(B[B.length-1]-G*(1-this.settings.ovcSlidingWindowPercentile))}return F},OptimalReceiversCountCalculator.prototype.processOptimalReceiversCount=function(){this.bandwidthEstimationAvailable||(this.bandwidthEstimationAvailable=this.isStarted&&this.bandwidth>0&&(this.totalSamples++>=this.settings.ovcIgnoreFirstSamples||Math.floor(this.bandwidth)/this.settings.ovcBandwidthPerVideoReceiver>=this.settings.nonEstimatedDefaultVideoReceiversCount));var F=this.settings.nonEstimatedDefaultVideoReceiversCount;this.bandwidthEstimationAvailable&&(F=Math.floor(this.sample(this.bandwidth)/this.settings.ovcBandwidthPerVideoReceiver)),F=Math.min(F,this.settings.ovcMaxCount),this.optimalReceiversCount!==Math.max(F,1)&&(F?this.logger.safe.info("optimal video receivers count changed to ".concat(F)):(this.logger.safe.warn("there is not enough bandwidth even for a single video receiver"),F=1),this.optimalReceiversCount=F,this.reportWhenElapsed())},OptimalReceiversCountCalculator.prototype.reportWhenElapsed=function(){-1===this.timer&&(this.logger.safe.info("reporting optimal video receivers count: ".concat(this.optimalReceiversCount)),this.event("onOptimalReceiversCountChanged").raise(this.optimalReceiversCount),this.lastReported=this.optimalReceiversCount,this.setupTimer())},OptimalReceiversCountCalculator.prototype.setupTimer=function(){var F=this;this.settings.ovcReportingTimoutMs&&-1===this.timer&&(this.timer=window.setTimeout((function(){F.timer=-1,F.lastReported!==F.optimalReceiversCount&&F.reportWhenElapsed()}),this.settings.ovcReportingTimoutMs))},OptimalReceiversCountCalculator}(K.default);B.OptimalReceiversCountCalculator=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(4),J=function(F){function DominantSpeakerHistoryExtension(){var B=F.call(this,K.default.EXTENSION_TYPE.dominantSpeakerHistory)||this;return B.callback=null,B}return z(DominantSpeakerHistoryExtension,F),DominantSpeakerHistoryExtension.prototype.initialize=function(B){var G=this;F.prototype.initialize.call(this,B),this.extensionManagerSubscription=this.manager.on("onDominantHistoryMessage",(function(F){return G.onDominantHistoryMessage(F)})),B&&B.callback&&(this.callback=B.callback)},DominantSpeakerHistoryExtension.prototype.dispose=function(){this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null,this.callback=null,F.prototype.dispose.call(this)},DominantSpeakerHistoryExtension.prototype.onDominantHistoryMessage=function(F){this.callback&&this.callback(F.previousDominantSpeakerHistory,!0)},DominantSpeakerHistoryExtension}(G(85).ExtensionBase);B.default=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(4),J=G(85),Q=G(379),Y=G(380),$=function(F){function MediaStreamControlExtension(){var B=F.call(this,K.default.EXTENSION_TYPE.videoStreamControl)||this;return B.messageGenerator=new Y.MediaControlMessageGenerator,B}return z(MediaStreamControlExtension,F),MediaStreamControlExtension.prototype.initialize=function(B){F.prototype.initialize.call(this,B),this.subscribeListeners(),this.sourceRequester=new Y.SourceRequester(B.logger),this.streamConfigurationHandler=new Q.MediaStreamConfigurationHandler(B.logger,B.negotiationEmulator,B.qualityManager,B.diagnostics,B.configProvider,B.statisticsGatherer)},MediaStreamControlExtension.prototype.configure=function(B){F.prototype.configure.call(this,B),this.sourceRequester.configure(B)},MediaStreamControlExtension.prototype.sendSourceRequest=function(F,B,G){var W=this.messageGenerator.getVideoControlMessage(F,B,G);return this.sourceRequester.sendMessage(1,W)},MediaStreamControlExtension.prototype.sendBandwidthInfo=function(F,B){var G=this.messageGenerator.getBandwidthInfoMessage(F,B);return this.sourceRequester.sendMessage(0,G)},MediaStreamControlExtension.prototype.sendMaxVideoSendCapabilities=function(F,B){var G=this.messageGenerator.getMaxVideoSendCapabilitiesMessage(F,B);return this.sourceRequester.sendMessage(0,G)},MediaStreamControlExtension.prototype.dispose=function(){this.unsubscribeListeners(),this.streamConfigurationHandler&&(this.streamConfigurationHandler.dispose(),this.streamConfigurationHandler=null),this.sourceRequester&&(this.sourceRequester.dispose(),this.sourceRequester=null),F.prototype.dispose.call(this)},MediaStreamControlExtension.prototype.onMediaStreamControlMessage=function(F){this.streamConfigurationHandler.handleMessage(F)},MediaStreamControlExtension.prototype.subscribeListeners=function(){var F=this;this.extensionManagerSubscription=this.manager.on("onMediaStreamControlMessage",(function(B){return F.onMediaStreamControlMessage(B)}))},MediaStreamControlExtension.prototype.unsubscribeListeners=function(){this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null},MediaStreamControlExtension}(J.ExtensionBase);B.default=$},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MediaStreamConfigurationHandler=void 0;var W=G(47),z=G(28),K=G(4),J=G(84),Q=function(){function MediaStreamConfigurationHandler(F,B,G,W,K,Q){this.logger=F,this.emulator=B,this.qualityManager=G,this.diagnostics=W,this.configProvider=K,this.statsGatherer=Q,this.previousSequenceNumber=-1,this.modifiers=this.configProvider.mediaConfig.simulcastSessionEnabled?[]:[new J.BandwidthControlModifier(this.logger.createChild("rembModifier"),this.qualityManager,new z.default(this.configProvider.config.resolutionTableOverride),this.configProvider)]}return MediaStreamConfigurationHandler.prototype.dispose=function(){this.cleanupDevToolsInjector(),this.modifiers&&(this.modifiers.forEach((function(F){return F.dispose()})),this.modifiers=null),this.emulator=null,this.logger=null},MediaStreamConfigurationHandler.prototype.handleMessage=function(F){var B,G;if(F.sequenceNumber<this.previousSequenceNumber)return this.statsGatherer.addVideoControlMessage(!0),null===(B=this.diagnostics)||void 0===B||B.addVideoControlMessage(!0),this.logger.safe.info("Discarded old media stream control message (".concat(JSON.stringify(F),")")),Promise.resolve();this.statsGatherer.addVideoControlMessage(),null===(G=this.diagnostics)||void 0===G||G.addVideoControlMessage(),this.configProvider.config.enableDevtoolsAPI&&this.injectFmtpHandler(F);var W={controlVideoStreaming:F};return this.previousSequenceNumber=F.sequenceNumber,this.configureResolution(W),this.modifiers.length?(this.modifiers.forEach((function(F){return F.setVideoControlMessage(W)})),this.emulator.renegotiate(this.modifiers)):Promise.resolve()},MediaStreamConfigurationHandler.prototype.configureResolution=function(F){this.logger.safe.info("Signaling FMTP: ".concat(JSON.stringify(F.controlVideoStreaming)));var B=String(F.controlVideoStreaming.sequenceNumber),G=F.controlVideoStreaming.controlInfo[0].fmtParamsList,W=F.controlVideoStreaming.controlInfo[0].fmtParams,z=[{causeId:B,isSimulcast:!!G,capabilities:G&&this.configProvider.config.webrtcFmtParamListSupported?this.parseFmtParamsList(G):[this.parseFmtParams(W)],sourceId:+F.controlVideoStreaming.controlInfo[0].sourceId}];this.qualityManager.setMaxCapabilities(z)},MediaStreamConfigurationHandler.prototype.parseFmtParamsList=function(F){var B=this;return F.map((function(F){return B.parseFmtParams(F)}))},MediaStreamConfigurationHandler.prototype.parseFmtParams=function(F){var B=W.default.build(F);return{maxFs:+B.get(K.default.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+B.get(K.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:+B.get(K.default.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*+B.get(K.default.VIDEO_CAPABILITIES.MAX_BR_PATH),ssrc:+B.get(K.default.VIDEO_CAPABILITIES.SSRC_PATH),rid:B.get(K.default.VIDEO_CAPABILITIES.RID_PATH),keyframe:this.shouldGenerateKeyFrame(B),vlaDebug:B.get(K.default.VIDEO_CAPABILITIES.VLA_DEBUG)}},MediaStreamConfigurationHandler.prototype.shouldGenerateKeyFrame=function(F){return F.get(K.default.VIDEO_CAPABILITIES.KEYFRAME_PATH)?!!+F.get(K.default.VIDEO_CAPABILITIES.KEYFRAME_PATH):this.configProvider.config.webrtcAllowRestoreKeyframe},MediaStreamConfigurationHandler.prototype.injectFmtpHandler=function(F){var B=window;B&&B.webMA&&(B.webMA.fmtp||(B.webMA.fmtp={handleMessage:this.handleMessage.bind(this)}),B.webMA.fmtp.lastFmtp=F)},MediaStreamConfigurationHandler.prototype.cleanupDevToolsInjector=function(){var F=window;F&&F.webMA&&delete F.webMA.fmtp},MediaStreamConfigurationHandler}();B.MediaStreamConfigurationHandler=Q},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.SourceRequester=B.MediaControlMessageGenerator=void 0;var K=G(4),J=function(){function MediaControlMessageGenerator(){this.sequence=0}return MediaControlMessageGenerator.prototype.getVideoControlMessage=function(F,B,G){var W={controlVideoStreaming:{sequenceNumber:++this.sequence,globalTimeStamp:(new Date).toString(),controlInfo:[{control:"start",sourceId:B,streamMsid:F}]}};return G&&(W.controlVideoStreaming.controlInfo[0].fmtParams=G),W},MediaControlMessageGenerator.prototype.getBandwidthInfoMessage=function(F,B){return{applyChannelParameters:{multiChannelParameter:{mids:F,mediaParameter:JSON.stringify({remoteUplinkBWE:{bw:B.toString()}})}}}},MediaControlMessageGenerator.prototype.getMaxVideoSendCapabilitiesMessage=function(F,B){var G;function ceilToMacroblock(F){var B=16;return Math.ceil(F/B)*B}var W=((G={})[K.default.VIDEO_CAPABILITIES.MAX_FS_PATH]=B.maxFs,G[K.default.VIDEO_CAPABILITIES.MAX_FPS_PATH]=B.maxFps,G[K.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH]=B.maxMbps,G[K.default.VIDEO_CAPABILITIES.MAX_WIDTH]=ceilToMacroblock(B.maxWidth),G[K.default.VIDEO_CAPABILITIES.MAX_HEIGHT]=ceilToMacroblock(B.maxHeight),G);return{applyChannelParameters:{multiChannelParameter:{mids:F,mediaParameter:JSON.stringify({maxVideoSendCapabilities:{caps:W}})}}}},MediaControlMessageGenerator}();B.MediaControlMessageGenerator=J;var Q=function(){function SourceRequester(F){this.logger=F}return SourceRequester.prototype.dispose=function(){this.sender=null},SourceRequester.prototype.configure=function(F){this.sender=F.sender},SourceRequester.prototype.sendMessage=function(F,B){return W(this,void 0,void 0,(function(){return z(this,(function(G){return this.checkConfigured()?(this.logger.safe.info("sending video control message: ".concat(JSON.stringify(B))),[2,this.sender.send(F,B)]):(this.logger.safe.warn("extension not configured with sender"),[2,null])}))}))},SourceRequester.prototype.checkConfigured=function(){return!!this.sender},SourceRequester}();B.SourceRequester=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.StatisticsGathererV2=void 0;var W=G(1),z=G(10),K=G(382),J=function(){function StatisticsGathererV2(F,B,G,W){this.logger=F,this.configProvider=B,this.diagnostics=G,this.mediaManager=W,this.webrtcStats=new K.WebrtcStatisticsV2(this.configProvider,this.diagnostics),this.ssrcToRecvTrackMap=new Map}return StatisticsGathererV2.prototype.processRawReport=function(F){this.diagnostics.latestRawReport=F;var B={loopTime:-1,fetchTime:-1,convertTime:-1,processingTime:-1,updateTime:-1,legacyProcessingTime:-1};try{var G=W.hptime(),z=G,K=this.convertStatsReport(F);return K.perfCounters=B,G=W.hptime(),B.convertTime=G-z,z=G,this.webrtcStats.processStats(K),this.diagnostics.addStatsReport(K),G=W.hptime(),B.processingTime=G-z,K}catch(F){var J=W.stringifyObject(F);return this.logger.safe.error("Error processing raw stats: ".concat(J)),void this.diagnostics.addStatsError("StatisticsGatherer:processRawReport",J)}},StatisticsGathererV2.prototype.setSsrcTrackPair=function(F,B){null===B?this.ssrcToRecvTrackMap.delete(F):this.ssrcToRecvTrackMap.set(F,B)},StatisticsGathererV2.prototype.convertStatsReport=function(F){var B=this,G={transports:this.processTransportStats(F)},W="";F["peer-connection"]&&(Object.keys(F["peer-connection"]).forEach((function(F){""===W?W=F:(B.logger.safe.error("Unexpected second peer connection stats id ".concat(F,", also found ").concat(W)),B.diagnostics.addStatsError("StatisticsGatherer","Unexpected second peer connection stats"))})),G.peerConnection=F["peer-connection"][W]);var z=this.mediaManager.getMediaEntities(),getEntityByRemoteSSRC=function(F){return z.find((function(B){return B.getRemoteSsrc()===F}))},getEntityByRemoteTrack=function(F){return void 0!==F?z.find((function(B){return B.getRemoteTrackId()===F})):void 0},getEntityByLocalSSRC=function(F,B){return z.find((function(G){var W;return G.getLocalSsrc()===F&&(!B||(null===(W=G.getSimulcastContext())||void 0===W?void 0:W.activeRids.map(String).some((function(F){return F===B}))))}))},getEntityByLocalTrack=function(F,B){return F?z.find((function(G){var W;return G.getLocalTrackId()===F&&(!B||(null===(W=G.getSimulcastContext())||void 0===W?void 0:W.activeRids.map(String).some((function(F){return F===B}))))})):void 0},getRequestedCapabilitiesBySsrc=function(F,G){var W=B.diagnostics.getObjectRef().qualityManager;return"video"===F?null==W?void 0:W.currentVideoSsrcRequestedCapabilities["".concat(G)]:"sharing"===F?null==W?void 0:W.currentSharingSsrcRequestedCapabilities["".concat(G)]:void 0},getAppliedCapabilitiesBySsrc=function(F,G){var W=B.diagnostics.getObjectRef().qualityManager;return"video"===F?null==W?void 0:W.currentVideoSsrcAppliedCapabilities["".concat(G)]:"sharing"===F?null==W?void 0:W.currentSharingSsrcAppliedCapabilities["".concat(G)]:void 0},getRendererDiagnosticsByTrack=function(F){var G;return null===(G=B.diagnostics.getObjectRef().remoteVideoManager)||void 0===G?void 0:G.renderers.find((function(B){return B.trackId===F}))};return this.appendSendMediaStats(F,G,getEntityByLocalSSRC,getEntityByLocalTrack,getRequestedCapabilitiesBySsrc,getAppliedCapabilitiesBySsrc),this.appendRecvMediaStats(F,G,getEntityByRemoteSSRC,getEntityByRemoteTrack,getRendererDiagnosticsByTrack),F["data-channel"]&&(G.data=F["data-channel"]),G},StatisticsGathererV2.prototype.processTransportStats=function(F){if(F.transport){var B={};for(var G in F.transport){var z=F.transport[G];if(B[G]=W.shallowClone(z),z.selectedCandidatePairId)(K=W.shallowClone(F["candidate-pair"][z.selectedCandidatePairId])).localCandidate=F["local-candidate"][K.localCandidateId],K.remoteCandidate=F["remote-candidate"][K.remoteCandidateId],B[G].selectedCandidatePair=K;z.localCertificateId&&F.certificate&&(B[G].localCertificate=F.certificate[z.localCertificateId]),z.remoteCertificateId&&F.certificate&&(B[G].remoteCertificate=F.certificate[z.remoteCertificateId])}return B}if(F["candidate-pair"]){B={};for(var G in F["candidate-pair"]){var K;(K=W.shallowClone(F["candidate-pair"][G])).selected&&(K.localCandidate=F["local-candidate"][K.localCandidateId],K.remoteCandidate=F["remote-candidate"][K.remoteCandidateId],B.faketransport={id:"faketransport",timestamp:K.timestamp,type:"transport",selectedCandidatePair:K,selectedCandidatePairId:K.id})}return B}},StatisticsGathererV2.prototype.appendSendMediaStats=function(F,B,G,W,K,J){var Q,Y,$,X,Z,ee,te,ne;for(var ie in F["outbound-rtp"]){var re=F["outbound-rtp"][ie],oe={outboundRTP:re};re.codecId&&F.codec&&(oe.codec=F.codec[re.codecId]),Object.defineProperty(oe,"transport",{value:B.transports[null!==(Q=re.transportId)&&void 0!==Q?Q:"faketransport"],configurable:!1,enumerable:!1}),re.remoteId&&F["remote-inbound-rtp"]&&(oe.remoteInboundRTP=F["remote-inbound-rtp"][re.remoteId]),re.mediaSourceId&&F["media-source"]&&(oe.mediaSource=F["media-source"][re.mediaSourceId]),re.trackId&&F.track&&(oe.track=F.track[re.trackId]);var ae=null!==(Z=W(null!==($=null===(Y=oe.track)||void 0===Y?void 0:Y.trackIdentifier)&&void 0!==$?$:null===(X=oe.mediaSource)||void 0===X?void 0:X.trackIdentifier,re.rid))&&void 0!==Z?Z:G(re.ssrc,re.rid);if(ae){oe.mediaEntity=ae.serialize();var se="video"===re.kind&&oe.track?"sharing"===(null==ae?void 0:ae.getModality())?"sharing":"video":re.kind;if(z.hasSendDirectionality(null===(ee=this.diagnostics.getObjectRef().activeModalities)||void 0===ee?void 0:ee[se])){if("video"===re.kind){var ce=null!==(te=K(se,re.ssrc))&&void 0!==te?te:K(se,0);ce&&(oe.requestedCapabilities=ce);var le=null!==(ne=J(se,re.ssrc))&&void 0!==ne?ne:J(se,0);le&&(oe.appliedCapabilities=le)}B[se]||(B[se]={}),B[se].send||(B[se].send=[]),B[se].send.push(oe)}}}},StatisticsGathererV2.prototype.appendRecvMediaStats=function(F,B,G,W,K){var J,Q,Y,$,X,Z,ee,te=null===(J=this.diagnostics.getObjectRef().subscriptionManager)||void 0===J?void 0:J.subscribedTrackIds,_loop_1=function(J){var ie=F["inbound-rtp"][J],re={inboundRTP:ie};ie.codecId&&F.codec&&(re.codec=F.codec[ie.codecId]),B.transports[null!==(Q=ie.transportId)&&void 0!==Q?Q:"faketransport"]&&Object.defineProperty(re,"transport",{value:B.transports[null!==(Y=ie.transportId)&&void 0!==Y?Y:"faketransport"],configurable:!1,enumerable:!1}),ie.remoteId&&F["remote-outbound-rtp"]&&(re.remoteOutboundRTP=F["remote-outbound-rtp"][ie.remoteId]);var oe=ne.ssrcToRecvTrackMap.get(ie.ssrc);if(ie.trackId||oe){ie.trackId&&F.track?re.track=F.track[ie.trackId]:oe&&(re.track={id:"ssrcToTrackId",kind:ie.kind,timestamp:ie.timestamp,type:"track",trackIdentifier:oe});var ae=K(null===($=re.track)||void 0===$?void 0:$.trackIdentifier);ae&&(re.renderer=ae)}if("video"===ie.kind&&!te.some((function(F){var B;return F&&F===(null===(B=re.track)||void 0===B?void 0:B.trackIdentifier)})))return"continue";var se=null!==(Z=W(null===(X=re.track)||void 0===X?void 0:X.trackIdentifier))&&void 0!==Z?Z:G(ie.ssrc);if(!se)return"continue";re.mediaEntity=se.serialize();var ce="video"===ie.kind&&re.track?"sharing"===(null==se?void 0:se.getModality())?"sharing":"video":ie.kind;if(!z.hasReceiveDirectionality(null===(ee=ne.diagnostics.getObjectRef().activeModalities)||void 0===ee?void 0:ee[ce]))return"continue";B[ce]||(B[ce]={}),B[ce].recv||(B[ce].recv=[]),B[ce].recv.push(re)},ne=this;for(var ie in F["inbound-rtp"])_loop_1(ie)},StatisticsGathererV2}();B.StatisticsGathererV2=J},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.WebrtcStatisticsV2=void 0;var z=G(383),K=G(384),J=G(385),Q=G(65),Y=G(1),$=function(){function WebrtcStatisticsV2(F,B){this.configProvider=F,this.diagnostics=B,this.transportStatsProcessor=new J.TransportStatsProcessor(this.diagnostics,this.configProvider),this.audioStatsProcessor=new z.AudioStatsProcessor(this.diagnostics),this.videoStatsProcessor=new K.VideoStatsProcessor(this.diagnostics),this.sharingStatsProcessor=new K.VideoStatsProcessor(this.diagnostics),this.statsAggregators={audio:{recv:new z.AudioRecvStatsAggregator,send:new z.AudioSendStatsAggregator(this.diagnostics)},video:{recv:new K.VideoRecvStatsAggregator,send:new K.VideoSendStatsAggregator(this.diagnostics)},sharing:{recv:new K.VideoRecvStatsAggregator,send:new K.VideoSendStatsAggregator(this.diagnostics)}},this.aggregatedModalityStats={},this.recvVideoStreamsCounter=new Q.ModeCounter,this.multiviewData={},this.multiviewStats=[],this.diagnostics.aggregatedStatsRef=this.aggregatedModalityStats,this.diagnostics.multiViewStatsRef=this.multiviewStats}return WebrtcStatisticsV2.prototype.processStats=function(F){var B,G,W,z;this.transportStatsProcessor.processStats(F.transports),this.audioStatsProcessor.processStats(F.audio),this.videoStatsProcessor.processStats(F.video),this.sharingStatsProcessor.processStats(F.sharing),this.recvVideoStreamsCounter.captureSample(null===(G=null===(B=F.video)||void 0===B?void 0:B.recv)||void 0===G?void 0:G.length),this.diagnostics.recvVideoStreamsCount={min:this.recvVideoStreamsCounter.min,max:this.recvVideoStreamsCounter.max,mode:this.recvVideoStreamsCounter.mode};try{this.processAggregated(F)}catch(F){this.diagnostics.addStatsError("webrtcStatistics:processAggregated",Y.stringifyObject(F))}try{this.processMultiview(null!==(z=null===(W=F.video)||void 0===W?void 0:W.recv)&&void 0!==z?z:[])}catch(F){this.diagnostics.addStatsError("webrtcStatistics:processMultiview",Y.stringifyObject(F))}try{var K=null===navigator||void 0===navigator?void 0:navigator.connection;K&&this.diagnostics.addNetworkInfo({downlink:K.downlink,rtt:K.rtt,effectiveType:K.effectiveType,saveData:K.saveData})}catch(F){this.diagnostics.addStatsError("webrtcStatistics:processStats(networkInfo)",Y.stringifyObject(F))}},WebrtcStatisticsV2.prototype.processMultiview=function(F){var B,G,z,K,J,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce=new Set;try{for(var le=W(F),de=le.next();!de.done;de=le.next()){var ue=de.value;ce.add(ue.inboundRTP.id);var pe=this.multiviewData[ue.inboundRTP.id];pe?pe.stats.duration++:(pe={bitrateAverager:new Q.ArithmeticAverager,jitterAverager:new Q.ArithmeticAverager,frameRateAverager:new Q.ArithmeticAverager,freezeHistogram:new Q.HistogramCollector,resolutionDurations:new Q.SampleDurationTracker,isRenderingEvents:[],stats:{ssrc:ue.inboundRTP.ssrc,startTime:Date.now(),duration:0}},Y.arrayPushFixedSize(this.multiviewStats,pe.stats,this.configProvider.config.diagnostics.collectionLimits.numMultiViewStats),this.multiviewData[ue.inboundRTP.id]=pe),pe.bitrateAverager.captureSample(null===(X=ue.extensions)||void 0===X?void 0:X.bitrate),pe.jitterAverager.captureSample(1e3*(null!==(Z=ue.inboundRTP.jitter)&&void 0!==Z?Z:0)),pe.frameRateAverager.captureSample(ue.inboundRTP.framesPerSecond),pe.freezeHistogram.active=0===(null===(ee=ue.extensions)||void 0===ee?void 0:ee.frameRateDecoded)&&ue.inboundRTP.framesPerSecond>0||0===ue.inboundRTP.framesPerSecond,ue.inboundRTP.frameWidth&&ue.inboundRTP.frameHeight&&pe.resolutionDurations.captureSample("".concat(ue.inboundRTP.frameWidth,"x").concat(ue.inboundRTP.frameHeight));var he=null!==(ne=null===(te=ue.renderer)||void 0===te?void 0:te.isRendering)&&void 0!==ne&&ne;(!pe.isRenderingEvents.length&&he||pe.isRenderingEvents.length&&Y.getLast(pe.isRenderingEvents).isRendering!==he)&&Y.arrayPushFixedSize(pe.isRenderingEvents,{isRendering:he,ts:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numIsRenderingEvents),pe.stats.frameRateAvg=Y.round(pe.frameRateAverager.avg),pe.stats.bitrateAvg=Y.round(pe.bitrateAverager.avg,0),pe.stats.bitrateMax=Y.round(pe.bitrateAverager.maxSample,0),pe.stats.freezeHistogram=pe.freezeHistogram.counts,pe.stats.freezeTimestamps=pe.freezeHistogram.timestamps,pe.stats.avgFreezeDuration=Y.round(pe.freezeHistogram.avgDuration),pe.stats.totalFreezeDuration=pe.freezeHistogram.totalDuration,pe.stats.ongoingFreeze=pe.freezeHistogram.active,pe.stats.numResolutionSwitches=pe.resolutionDurations.changeCount,pe.stats.rendererSize="".concat(null===(re=null===(ie=ue.renderer)||void 0===ie?void 0:ie.rendererSize)||void 0===re?void 0:re.width,"x").concat(null===(ae=null===(oe=ue.renderer)||void 0===oe?void 0:oe.rendererSize)||void 0===ae?void 0:ae.height),pe.stats.resolutionDurations=pe.resolutionDurations.durations,pe.stats.timeToFirstFrame=null===(se=ue.renderer)||void 0===se?void 0:se.timeToFirstFrame,pe.stats.isRenderingEvents=pe.isRenderingEvents}}catch(F){B={error:F}}finally{try{de&&!de.done&&(G=le.return)&&G.call(le)}finally{if(B)throw B.error}}var ge=[];try{for(var fe=W(Object.keys(this.multiviewData)),me=fe.next();!me.done;me=fe.next()){var ve=me.value;ce.has(ve)||ge.push(ve)}}catch(F){z={error:F}}finally{try{me&&!me.done&&(K=fe.return)&&K.call(fe)}finally{if(z)throw z.error}}try{for(var ye=W(ge),Se=ye.next();!Se.done;Se=ye.next()){ve=Se.value;delete this.multiviewData[ve]}}catch(F){J={error:F}}finally{try{Se&&!Se.done&&($=ye.return)&&$.call(ye)}finally{if(J)throw J.error}}},WebrtcStatisticsV2.prototype.processAggregated=function(F){var B,G;try{for(var z=W(["audio","video","sharing"]),K=z.next();!K.done;K=z.next()){var J=K.value;if(F[J])for(var Q in F[J])this.processAggregatedModality(F,J,Q)}}catch(F){B={error:F}}finally{try{K&&!K.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}},WebrtcStatisticsV2.prototype.processAggregatedModality=function(F,B,G){var W,z,K,J,Q,Y,$,X=null!==(K=null===(z=null===(W=F[B])||void 0===W?void 0:W[G])||void 0===z?void 0:z.length)&&void 0!==K?K:0;X>0&&(null!==(J=(Y=this.aggregatedModalityStats)[B])&&void 0!==J||(Y[B]={}),null!==(Q=($=this.aggregatedModalityStats[B])[G])&&void 0!==Q||($[G]=[]),X>1&&("audio"===B||"sharing"===B)&&this.diagnostics.addStatsError("webrtcStatistics:processAggregatedModality","Multiple ".concat(B," ").concat(G," streams: ").concat(X)),this.statsAggregators[B][G].processSample(F[B][G],this.aggregatedModalityStats[B][G]))},WebrtcStatisticsV2}();B.WebrtcStatisticsV2=$},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.AudioSendStatsAggregator=B.AudioRecvStatsAggregator=B.AudioStatsProcessor=void 0;var z=G(65),K=G(1),J=function(){function AudioStatsProcessor(F){this.diagnostics=F,this.recvExtenders=new Map,this.sendExtenders=new Map}return AudioStatsProcessor.prototype.processStats=function(F){var B,G,z,J,Y,X;if(F){if(F.recv)try{for(var Z=W(F.recv),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value;try{var ne=null!==(Y=this.recvExtenders.get(te.inboundRTP.id))&&void 0!==Y?Y:new Q;this.recvExtenders.set(te.inboundRTP.id,ne),ne.processSample(te)}catch(F){this.diagnostics.addStatsError("AudioStatsProcessor:recv",K.stringifyObject(F))}}}catch(F){B={error:F}}finally{try{ee&&!ee.done&&(G=Z.return)&&G.call(Z)}finally{if(B)throw B.error}}if(F.send)try{for(var ie=W(F.send),re=ie.next();!re.done;re=ie.next()){te=re.value;try{ne=null!==(X=this.sendExtenders.get(te.outboundRTP.id))&&void 0!==X?X:new $;this.sendExtenders.set(te.outboundRTP.id,ne),ne.processSample(te)}catch(F){this.diagnostics.addStatsError("AudioStatsProcessor:send",K.stringifyObject(F))}}}catch(F){z={error:F}}finally{try{re&&!re.done&&(J=ie.return)&&J.call(ie)}finally{if(z)throw z.error}}}},AudioStatsProcessor}();B.AudioStatsProcessor=J;var Q=function(){function AudioRecvStatsExtender(){this.duration=0,this.lossRateCalculator=new z.NormalizedLossRateCalculator,this.lossRateAverager=new z.ArithmeticAverager,this.bytesReceivedDiff=new z.LastSampleDelta,this.packetsDelta=new z.LastSampleDelta,this.packetsLostDelta=new z.LastSampleDelta,this.jitterBufferAverager=new z.ArithmeticAverager,this.jitterAverager=new z.ArithmeticAverager,this.jitterBufferDelayAverager=new z.ArithmeticAverager,this.bitrateAverager=new z.ArithmeticAverager,this.healedRatioAverager=new z.ArithmeticAverager}return AudioRecvStatsExtender.prototype.processSample=function(F){var B=this.lossRateCalculator.calculate(F.inboundRTP.packetsReceived,F.inboundRTP.packetsLost);this.lossRateAverager.captureSample(B),this.bytesReceivedDiff.captureSample(F.inboundRTP.bytesReceived);var G=this.bytesReceivedDiff.delta,W=G?8*G:void 0;this.bitrateAverager.captureSample(W),this.packetsDelta.captureSample(F.inboundRTP.packetsReceived),this.packetsLostDelta.captureSample(F.inboundRTP.packetsLost);var z=F.inboundRTP.jitterBufferEmittedCount&&K.round(F.inboundRTP.jitterBufferDelay/F.inboundRTP.jitterBufferEmittedCount*1e3,0);this.jitterBufferAverager.captureSample(z&&1e3*z),this.jitterAverager.captureSample(1e3*F.inboundRTP.jitter),this.jitterBufferDelayAverager.captureSample(1e3*F.inboundRTP.jitterBufferDelay);var J=F.inboundRTP.totalSamplesReceived&&K.round((F.inboundRTP.concealedSamples-F.inboundRTP.silentConcealedSamples)/F.inboundRTP.totalSamplesReceived);this.healedRatioAverager.captureSample(J),F.extensions={lossRate:B,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,healedRatio:J,healedRatioAvg:K.round(this.healedRatioAverager.avg),healedRatioMax:this.healedRatioAverager.maxSample,jitterBufferMs:z,avgJitterBufferSize:K.round(this.jitterBufferAverager.avg),jitterMs:K.round(this.jitterAverager.avg),jitterBufferDelayMs:K.round(this.jitterBufferDelayAverager.avg),bitrate:W||0,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0)},this.duration++},AudioRecvStatsExtender}(),Y=function(){function AudioRecvStatsAggregator(){this.duration=0,this.lossRateAverager=new z.ArithmeticAverager,this.bitrateAverager=new z.ArithmeticAverager,this.jitterAverager=new z.ArithmeticAverager}return AudioRecvStatsAggregator.prototype.processSample=function(F,B){var G,W=F[0],z={inboundRTP:W.inboundRTP};W.transport&&Object.defineProperty(z,"transport",{value:W.transport,configurable:!1,enumerable:!1}),W.codec&&(z.codec=W.codec),W.track&&(z.track=W.track),W.remoteOutboundRTP&&(z.remoteOutboundRTP=W.remoteOutboundRTP),W.extensions&&(this.lossRateAverager.captureSample(W.extensions.lossRate),this.bitrateAverager.captureSample(W.extensions.bitrate),this.jitterAverager.captureSample(1e3*(null!==(G=W.inboundRTP.jitter)&&void 0!==G?G:0)),z.extensions={lossRate:W.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:W.extensions.packetsPerSecond,packetsLostPerSecond:W.extensions.packetsLostPerSecond,duration:this.duration,bitrate:W.extensions.bitrate,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0),avgJitterBufferSize:K.round(this.jitterAverager.avg),jitterBufferMs:W.extensions.jitterBufferMs,healedRatio:W.extensions.healedRatio,healedRatioAvg:W.extensions.healedRatioAvg,healedRatioMax:W.extensions.healedRatioMax},this.duration++),B.push(z)},AudioRecvStatsAggregator}();B.AudioRecvStatsAggregator=Y;var $=function(){function AudioSendStatsExtender(){this.duration=0,this.lossRateCalculator=new z.NormalizedLossRateCalculator,this.lossRateAverager=new z.ArithmeticAverager,this.packetsDelta=new z.LastSampleDelta,this.packetsLostDelta=new z.LastSampleDelta,this.bytesSendDiff=new z.LastSampleDelta,this.rttAverager=new z.ArithmeticAverager,this.bitrateAverager=new z.ArithmeticAverager}return AudioSendStatsExtender.prototype.processSample=function(F){var B,G,W,z,J,Q=this.lossRateCalculator.calculate(null===(B=F.remoteInboundRTP)||void 0===B?void 0:B.packetsReceived,null===(G=F.remoteInboundRTP)||void 0===G?void 0:G.packetsLost);this.lossRateAverager.captureSample(Q),this.packetsDelta.captureSample(F.outboundRTP.packetsSent),this.packetsLostDelta.captureSample(null===(W=F.remoteInboundRTP)||void 0===W?void 0:W.packetsLost),this.bytesSendDiff.captureSample(F.outboundRTP.bytesSent);var Y=this.bytesSendDiff.delta,$=Y?8*Y:void 0;this.bitrateAverager.captureSample($),this.rttAverager.captureSample(1e3*(null!==(J=null===(z=F.remoteInboundRTP)||void 0===z?void 0:z.roundTripTime)&&void 0!==J?J:0)),F.extensions={lossRate:Q,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,rttAvg:K.round(this.rttAverager.avg),rttMax:K.round(this.rttAverager.maxSample),bitrate:$||0,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0)},this.duration++},AudioSendStatsExtender}(),X=function(){function AudioSendStatsAggregator(F){this.diagnostics=F,this.duration=0,this.lossRateAverager=new z.ArithmeticAverager,this.bitrateAverager=new z.ArithmeticAverager,this.rttAverager=new z.ArithmeticAverager}return AudioSendStatsAggregator.prototype.processSample=function(F,B){var G,W=F[0],z={outboundRTP:W.outboundRTP};W.transport&&Object.defineProperty(z,"transport",{value:W.transport,configurable:!1,enumerable:!1}),W.codec&&(z.codec=W.codec),W.track&&(z.track=W.track),W.mediaSource&&(z.mediaSource=W.mediaSource),W.remoteInboundRTP&&(z.remoteInboundRTP=W.remoteInboundRTP),W.extensions&&(this.lossRateAverager.captureSample(W.extensions.lossRate),this.bitrateAverager.captureSample(W.extensions.bitrate),this.rttAverager.captureSample(null===(G=W.remoteInboundRTP)||void 0===G?void 0:G.roundTripTime),z.extensions={lossRate:W.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:W.extensions.packetsPerSecond,packetsLostPerSecond:W.extensions.packetsLostPerSecond,duration:this.duration,bitrate:W.extensions.bitrate,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0),rttAvg:K.round(this.rttAverager.avg),rttMax:K.round(this.rttAverager.maxSample),rawInputVolume:this.diagnostics.audioLevel},this.duration++),B.push(z)},AudioSendStatsAggregator}();B.AudioSendStatsAggregator=X},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.VideoSendStatsAggregator=B.VideoRecvStatsAggregator=B.VideoStatsProcessor=void 0;var K=G(1),J=G(65),Q=function(){function VideoStatsProcessor(F){this.diagnostics=F,this.recvExtenders=new Map,this.sendExtenders=new Map}return VideoStatsProcessor.prototype.processStats=function(F){var B,G,W,J,Q,$;if(F){if(F.send)try{for(var Z=z(F.send),ee=Z.next();!ee.done;ee=Z.next()){var te=ee.value;try{var ne=null!==(Q=this.sendExtenders.get(te.outboundRTP.id))&&void 0!==Q?Q:new X;this.sendExtenders.set(te.outboundRTP.id,ne),ne.processSample(te)}catch(F){this.diagnostics.addStatsError("VideoStatsProcessor:send",K.stringifyObject(F))}}}catch(F){B={error:F}}finally{try{ee&&!ee.done&&(G=Z.return)&&G.call(Z)}finally{if(B)throw B.error}}if(F.recv)try{for(var ie=z(F.recv),re=ie.next();!re.done;re=ie.next()){te=re.value;try{ne=null!==($=this.recvExtenders.get(te.inboundRTP.id))&&void 0!==$?$:new Y;this.recvExtenders.set(te.inboundRTP.id,ne),ne.processSample(te)}catch(F){this.diagnostics.addStatsError("VideoStatsProcessor:recv",K.stringifyObject(F))}}}catch(F){W={error:F}}finally{try{re&&!re.done&&(J=ie.return)&&J.call(ie)}finally{if(W)throw W.error}}}},VideoStatsProcessor}();B.VideoStatsProcessor=Q;var Y=function(){function VideoRecvStatsExtender(){this.duration=0,this.lossRateCalculator=new J.NormalizedLossRateCalculator,this.lossRateAverager=new J.ArithmeticAverager,this.bytesReceivedDelta=new J.LastSampleDelta,this.framesDecodedDelta=new J.LastSampleDelta,this.trackFramesDelta=new J.LastSampleDelta,this.packetsDelta=new J.LastSampleDelta,this.packetsLostDelta=new J.LastSampleDelta,this.frameRateAverager=new J.ArithmeticAverager,this.jitterAverager=new J.ArithmeticAverager,this.bitrateAverager=new J.ArithmeticAverager,this.freezeHistogram=new J.HistogramCollector,this.harmonicDecodedFps=new J.SelfWeightedHarmonicMeanCalculator,this.resolutionDurations=new J.SampleDurationTracker}return VideoRecvStatsExtender.prototype.processSample=function(F){var B,G,W,z=this.lossRateCalculator.calculate(F.inboundRTP.packetsReceived,F.inboundRTP.packetsLost);this.lossRateAverager.captureSample(z),this.framesDecodedDelta.captureSample(F.inboundRTP.framesDecoded),this.trackFramesDelta.captureSample(null===(B=F.track)||void 0===B?void 0:B.framesReceived),this.packetsDelta.captureSample(F.inboundRTP.packetsReceived),this.packetsLostDelta.captureSample(F.inboundRTP.packetsLost);var J=this.framesDecodedDelta.delta||0,Q=F.inboundRTP.framesPerSecond;this.harmonicDecodedFps.captureSample(J),this.freezeHistogram.active=-1!==(null===(G=F.renderer)||void 0===G?void 0:G.timeToFirstFrame)&&(0===J&&Q>0||!Q),this.frameRateAverager.captureSample(null!=Q?Q:J),this.bytesReceivedDelta.captureSample(F.inboundRTP.bytesReceived);var Y=this.bytesReceivedDelta.delta,$=Y?8*Y:void 0;this.bitrateAverager.captureSample($);var X=F.inboundRTP.jitterBufferEmittedCount&&K.round((null!==(W=F.inboundRTP.jitterBufferDelay)&&void 0!==W?W:0)/F.inboundRTP.jitterBufferEmittedCount*1e3);this.jitterAverager.captureSample(X&&1e3*X),F.inboundRTP.frameWidth&&F.inboundRTP.frameHeight&&this.resolutionDurations.captureSample("".concat(F.inboundRTP.frameWidth,"x").concat(F.inboundRTP.frameHeight)),F.extensions={lossRate:z,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,frameRateDecoded:J,trackRecvFps:this.trackFramesDelta.delta,avgFrameRate:K.round(this.frameRateAverager.avg),fpsHarmonicAverage:K.round(this.harmonicDecodedFps.harmonicMean),jitterBufferMs:X,avgJitterBufferSize:K.round(this.jitterAverager.avg),bitrate:$||0,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0),isFrozen:this.freezeHistogram.active,numFreezes:this.freezeHistogram.numEvents,avgFreezeDuration:K.round(this.freezeHistogram.avgDuration),longestFreeze:this.freezeHistogram.longestDuration,totalFreezeDuration:this.freezeHistogram.totalDuration,freezeCountHistogram:this.freezeHistogram.counts,freezeTimestampsHistogram:this.freezeHistogram.timestamps,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios},this.duration++},VideoRecvStatsExtender}(),$=function(){function VideoRecvStatsAggregator(){this.duration=0,this.lossRateAverager=new J.ArithmeticAverager,this.bitrateAverager=new J.ArithmeticAverager,this.jitterAverager=new J.ArithmeticAverager,this.frameRateAverager=new J.ArithmeticAverager,this.freezeHistogram=new J.HistogramCollector,this.harmonicDecodedFps=new J.SelfWeightedHarmonicMeanCalculator,this.resolutionDurations=new J.SampleDurationTracker}return VideoRecvStatsAggregator.prototype.processSample=function(F,B){var G,W,z,J=F.sort((function(F,B){return B.inboundRTP.frameHeight-F.inboundRTP.frameHeight}))[0],Q={inboundRTP:J.inboundRTP};J.transport&&Object.defineProperty(Q,"transport",{value:J.transport,configurable:!1,enumerable:!1}),J.codec&&(Q.codec=J.codec),J.track&&(Q.track=J.track),J.remoteOutboundRTP&&(Q.remoteOutboundRTP=J.remoteOutboundRTP),this.harmonicDecodedFps.captureSample(J.extensions.frameRateDecoded),J.extensions&&(this.lossRateAverager.captureSample(J.extensions.lossRate),this.bitrateAverager.captureSample(J.extensions.bitrate),this.jitterAverager.captureSample(1e3*(null!==(G=J.inboundRTP.jitter)&&void 0!==G?G:0)),this.frameRateAverager.captureSample(null!==(W=J.inboundRTP.framesPerSecond)&&void 0!==W?W:J.extensions.frameRateDecoded),this.freezeHistogram.active=-1!==(null===(z=J.renderer)||void 0===z?void 0:z.timeToFirstFrame)&&(0===J.extensions.frameRateDecoded&&J.inboundRTP.framesPerSecond>0||0===J.inboundRTP.framesPerSecond),J.inboundRTP.frameWidth&&J.inboundRTP.frameHeight&&this.resolutionDurations.captureSample("".concat(J.inboundRTP.frameWidth,"x").concat(J.inboundRTP.frameHeight)),Q.extensions={lossRate:J.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:J.extensions.packetsPerSecond,packetsLostPerSecond:J.extensions.packetsLostPerSecond,duration:this.duration,frameRateDecoded:J.extensions.frameRateDecoded,trackRecvFps:J.extensions.trackRecvFps,avgFrameRate:K.round(this.frameRateAverager.avg),fpsHarmonicAverage:K.round(this.harmonicDecodedFps.harmonicMean),avgJitterBufferSize:K.round(this.jitterAverager.avg),jitterBufferMs:J.extensions.jitterBufferMs,bitrate:J.extensions.bitrate,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0),isFrozen:this.freezeHistogram.active,numFreezes:this.freezeHistogram.numEvents,avgFreezeDuration:K.round(this.freezeHistogram.avgDuration),longestFreeze:this.freezeHistogram.longestDuration,totalFreezeDuration:this.freezeHistogram.totalDuration,freezeCountHistogram:this.freezeHistogram.counts,freezeTimestampsHistogram:this.freezeHistogram.timestamps,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios},this.duration++),B.push(Q)},VideoRecvStatsAggregator}();B.VideoRecvStatsAggregator=$;var X=function(){function VideoSendStatsExtender(){this.duration=0,this.lossRateCalculator=new J.NormalizedLossRateCalculator,this.lossRateAverager=new J.ArithmeticAverager,this.captureFreezeIntervalsCount=0,this.bytesSendDelta=new J.LastSampleDelta,this.encodedFramesDelta=new J.LastSampleDelta,this.packetsDelta=new J.LastSampleDelta,this.packetsLostDelta=new J.LastSampleDelta,this.frameRateAverager=new J.ArithmeticAverager,this.captureFpsAverager=new J.ArithmeticAverager,this.rttAverager=new J.ArithmeticAverager,this.bitrateAverager=new J.ArithmeticAverager,this.resolutionDurations=new J.SampleDurationTracker,this.harmonicEncodedFps=new J.SelfWeightedHarmonicMeanCalculator,this.fsOvershoot=new J.OvershootTracker,this.fpsOvershoot=new J.OvershootTracker(1),this.brOvershoot=new J.OvershootTracker}return VideoSendStatsExtender.prototype.processSample=function(F){var B,G,J,Q,Y,$,X,Z,ee,te,ne,ie,re=this.lossRateCalculator.calculate(null===(X=F.remoteInboundRTP)||void 0===X?void 0:X.packetsReceived,null===(Z=F.remoteInboundRTP)||void 0===Z?void 0:Z.packetsLost);this.lossRateAverager.captureSample(re),this.packetsDelta.captureSample(F.outboundRTP.packetsSent),this.packetsLostDelta.captureSample(null===(ee=F.remoteInboundRTP)||void 0===ee?void 0:ee.packetsLost),this.bytesSendDelta.captureSample(F.outboundRTP.bytesSent);var oe=this.bytesSendDelta.delta,ae=oe?8*oe:void 0;this.bitrateAverager.captureSample(ae),this.rttAverager.captureSample(null===(te=F.remoteInboundRTP)||void 0===te?void 0:te.roundTripTime),this.encodedFramesDelta.captureSample(F.outboundRTP.framesEncoded),this.harmonicEncodedFps.captureSample(this.encodedFramesDelta.delta),this.frameRateAverager.captureSample(F.outboundRTP.framesPerSecond);var se=null===(ne=F.mediaSource)||void 0===ne?void 0:ne.framesPerSecond;this.captureFpsAverager.captureSample(se),0===se&&void 0!==this.lastCaptureFramerate&&this.lastCaptureFramerate>0&&this.captureFreezeIntervalsCount++,this.lastCaptureFramerate=se,F.outboundRTP.frameWidth&&F.outboundRTP.frameHeight&&this.resolutionDurations.captureSample("".concat(F.outboundRTP.frameWidth,"x").concat(F.outboundRTP.frameHeight));var ce=null!==(ie=F.appliedCapabilities)&&void 0!==ie?ie:F.requestedCapabilities;ce&&(void 0!==F.outboundRTP.frameHeight&&void 0!==F.outboundRTP.frameWidth&&this.fsOvershoot.captureSample(F.outboundRTP.frameHeight/16*(F.outboundRTP.frameWidth/16),ce.maxFs),void 0!==F.outboundRTP.framesPerSecond&&this.fpsOvershoot.captureSample(F.outboundRTP.framesPerSecond,ce.maxFps),ce.maxBr&&this.brOvershoot.captureSample(ae,ce.maxBr));var le=[];try{for(var de=z(this.fsOvershoot.events),ue=de.next();!ue.done;ue=de.next()){var pe=ue.value;le.push(W(W({},pe),{overshootType:"fs"}))}}catch(F){B={error:F}}finally{try{ue&&!ue.done&&(G=de.return)&&G.call(de)}finally{if(B)throw B.error}}try{for(var he=z(this.fpsOvershoot.events),ge=he.next();!ge.done;ge=he.next()){pe=ge.value;le.push(W(W({},pe),{overshootType:"fps"}))}}catch(F){J={error:F}}finally{try{ge&&!ge.done&&(Q=he.return)&&Q.call(he)}finally{if(J)throw J.error}}try{for(var fe=z(this.brOvershoot.events),me=fe.next();!me.done;me=fe.next()){pe=me.value;le.push(W(W({},pe),{overshootType:"br"}))}}catch(F){Y={error:F}}finally{try{me&&!me.done&&($=fe.return)&&$.call(fe)}finally{if(Y)throw Y.error}}le.sort((function(F,B){return F.timestamp-B.timestamp})),F.extensions={lossRate:re,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:this.packetsDelta.delta,packetsLostPerSecond:this.packetsLostDelta.delta,duration:this.duration,frameRateEncoded:this.encodedFramesDelta.delta,frameRateAvg:K.round(this.frameRateAverager.avg),captureFramerateAvg:K.round(this.captureFpsAverager.avg),fpsHarmonicAverage:K.round(this.harmonicEncodedFps.harmonicMean),qpAvg:K.round(F.outboundRTP.qpSum/F.outboundRTP.framesSent),rttAvg:K.round(this.rttAverager.avg),bitrate:ae||0,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0),captureFreezeIntervalsCount:this.captureFreezeIntervalsCount,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios,isFsOvershooting:this.fsOvershoot.isOvershooting,isFpsOvershooting:this.fpsOvershoot.isOvershooting,isBrOvershooting:this.brOvershoot.isOvershooting,totalFsOvershootDuration:this.fsOvershoot.totalDuration,totalFpsOvershootDuration:this.fpsOvershoot.totalDuration,totalBrOvershootDuration:this.brOvershoot.totalDuration,overshootEvents:le},this.duration++},VideoSendStatsExtender}(),Z=function(){function VideoSendStatsAggregator(F){this.diagnostics=F,this.duration=0,this.lossRateAverager=new J.ArithmeticAverager,this.bitrateAverager=new J.ArithmeticAverager,this.sendBWEAverager=new J.ArithmeticAverager,this.rttAverager=new J.ArithmeticAverager,this.framerateAverager=new J.ArithmeticAverager,this.captureFpsAverager=new J.ArithmeticAverager,this.captureFreezeIntervalsCount=0,this.lastCaptureFps=void 0,this.resolutionDurations=new J.SampleDurationTracker,this.fsOvershoot=new J.OvershootTracker,this.fpsOvershoot=new J.OvershootTracker(1),this.brOvershoot=new J.OvershootTracker,this.harmonicEncodedFps=new J.SelfWeightedHarmonicMeanCalculator}return VideoSendStatsAggregator.prototype.processSample=function(F,B){var G,J,Q,Y,$,X,Z,ee,te,ne,ie,re;F.length>1&&F.sort((function(F,B){var G,W,z=null!==(G=F.appliedCapabilities)&&void 0!==G?G:F.requestedCapabilities,K=null!==(W=B.appliedCapabilities)&&void 0!==W?W:B.requestedCapabilities;return(null==z?void 0:z.maxMbps)&&(null==K?void 0:K.maxMbps)?K.maxMbps-z.maxMbps:0}));var oe=F[0],ae={outboundRTP:oe.outboundRTP};if(oe.transport&&Object.defineProperty(ae,"transport",{value:oe.transport,configurable:!1,enumerable:!1}),oe.codec&&(ae.codec=oe.codec),oe.track&&(ae.track=oe.track),oe.mediaSource&&(ae.mediaSource=oe.mediaSource),oe.remoteInboundRTP&&(ae.remoteInboundRTP=oe.remoteInboundRTP),oe.extensions){this.lossRateAverager.captureSample(oe.extensions.lossRate),this.bitrateAverager.captureSample(oe.extensions.bitrate),this.sendBWEAverager.captureSample(null===(ee=null===(Z=oe.transport)||void 0===Z?void 0:Z.selectedCandidatePair)||void 0===ee?void 0:ee.availableOutgoingBitrate),this.rttAverager.captureSample(null===(te=oe.remoteInboundRTP)||void 0===te?void 0:te.roundTripTime),this.framerateAverager.captureSample(oe.outboundRTP.framesPerSecond);var se=null===(ne=oe.mediaSource)||void 0===ne?void 0:ne.framesPerSecond;this.captureFpsAverager.captureSample(se),0===se&&void 0!==this.lastCaptureFps&&this.lastCaptureFps>0&&this.captureFreezeIntervalsCount++,oe.outboundRTP.frameWidth&&oe.outboundRTP.frameHeight&&this.resolutionDurations.captureSample("".concat(oe.outboundRTP.frameWidth,"x").concat(oe.outboundRTP.frameHeight));var ce=null!==(ie=oe.appliedCapabilities)&&void 0!==ie?ie:oe.requestedCapabilities;ce&&(void 0!==oe.outboundRTP.frameHeight&&void 0!==oe.outboundRTP.frameWidth&&this.fsOvershoot.captureSample(oe.outboundRTP.frameHeight/16*(oe.outboundRTP.frameWidth/16),ce.maxFs),void 0!==oe.outboundRTP.framesPerSecond&&this.fpsOvershoot.captureSample(oe.outboundRTP.framesPerSecond,ce.maxFps),ce.maxBr&&this.brOvershoot.captureSample(null===(re=oe.extensions)||void 0===re?void 0:re.bitrate,ce.maxBr)),this.harmonicEncodedFps.captureSample(oe.extensions.frameRateEncoded);var le=[];try{for(var de=z(this.fsOvershoot.events),ue=de.next();!ue.done;ue=de.next()){var pe=ue.value;le.push(W(W({},pe),{overshootType:"fs"}))}}catch(F){G={error:F}}finally{try{ue&&!ue.done&&(J=de.return)&&J.call(de)}finally{if(G)throw G.error}}try{for(var he=z(this.fpsOvershoot.events),ge=he.next();!ge.done;ge=he.next()){pe=ge.value;le.push(W(W({},pe),{overshootType:"fps"}))}}catch(F){Q={error:F}}finally{try{ge&&!ge.done&&(Y=he.return)&&Y.call(he)}finally{if(Q)throw Q.error}}try{for(var fe=z(this.brOvershoot.events),me=fe.next();!me.done;me=fe.next()){pe=me.value;le.push(W(W({},pe),{overshootType:"br"}))}}catch(F){$={error:F}}finally{try{me&&!me.done&&(X=fe.return)&&X.call(fe)}finally{if($)throw $.error}}le.sort((function(F,B){return F.timestamp-B.timestamp})),ae.extensions={lossRate:oe.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,packetsPerSecond:oe.extensions.packetsPerSecond,packetsLostPerSecond:oe.extensions.packetsLostPerSecond,duration:this.duration,frameRateEncoded:oe.extensions.frameRateEncoded,frameRateAvg:K.round(this.framerateAverager.avg),captureFramerateAvg:K.round(this.captureFpsAverager.avg),fpsHarmonicAverage:K.round(this.harmonicEncodedFps.harmonicMean),qpAvg:K.round(oe.outboundRTP.qpSum/oe.outboundRTP.framesSent),rttAvg:K.round(this.rttAverager.avg),bitrate:oe.extensions.bitrate,bitrateAvg:K.round(this.bitrateAverager.avg,0),bitrateMax:K.round(this.bitrateAverager.maxSample,0),bweAvg:K.round(this.sendBWEAverager.avg,0),captureFreezeIntervalsCount:this.captureFreezeIntervalsCount,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios,cameraOpenResolution:this.diagnostics.deviceManager.latestCameraOpenResolution,isFsOvershooting:this.fsOvershoot.isOvershooting,isFpsOvershooting:this.fpsOvershoot.isOvershooting,isBrOvershooting:this.brOvershoot.isOvershooting,totalFsOvershootDuration:this.fsOvershoot.totalDuration,totalFpsOvershootDuration:this.fpsOvershoot.totalDuration,totalBrOvershootDuration:this.brOvershoot.totalDuration,overshootEvents:le},this.duration++}B.push(ae)},VideoSendStatsAggregator}();B.VideoSendStatsAggregator=Z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.TransportStatsProcessor=void 0;var W=G(65),z=G(1),K=function(){function TransportStatsProcessor(F,B){this.diagnostics=F,this.configProvider=B,this.extenders=new Map}return TransportStatsProcessor.prototype.processStats=function(F){var B;for(var G in F)try{var W=F[G],K=null!==(B=this.extenders.get(W.id))&&void 0!==B?B:new J(this.configProvider);this.extenders.set(W.id,K),K.processSample(W)}catch(F){this.diagnostics.addStatsError("TransportStatsProcessor",z.stringifyObject(F))}},TransportStatsProcessor}();B.TransportStatsProcessor=K;var J=function(){function TransportStatsExtender(F){this.configProvider=F,this.bwJumpsHistogramCollector=new W.HistogramCollector,this.sendBWEAverager=new W.ArithmeticAverager,this.recvBWEAverager=new W.ArithmeticAverager,this.sendBW=new W.LastSampleDelta,this.recvBW=new W.LastSampleDelta,this.sendBWAverager=new W.ArithmeticAverager,this.recvBWAverager=new W.ArithmeticAverager}return TransportStatsExtender.prototype.processSample=function(F){var B,G,W,K,J;this.sendBWEAverager.captureSample(null===(B=F.selectedCandidatePair)||void 0===B?void 0:B.availableOutgoingBitrate),this.recvBWEAverager.captureSample(null===(G=F.selectedCandidatePair)||void 0===G?void 0:G.availableIncomingBitrate),this.sendBW.captureSample(null===(W=F.selectedCandidatePair)||void 0===W?void 0:W.bytesSent),this.recvBW.captureSample(null===(K=F.selectedCandidatePair)||void 0===K?void 0:K.bytesReceived);var Q=this.sendBW.delta,Y=this.recvBW.delta,$=Q?8*Q:void 0,X=Y?8*Y:void 0;this.sendBWAverager.captureSample($),this.recvBWAverager.captureSample(X);var Z=null===(J=F.selectedCandidatePair)||void 0===J?void 0:J.availableOutgoingBitrate;Z&&(this.bwJumpsHistogramCollector.active=this.bwJumpsHistogramCollector.active&&Z<this.configProvider.config.webrtcBWJumpUpperLimit||Z<this.configProvider.config.webrtcBWJumpLowerLimit),F.extensions={sendBWEAvg:z.round(this.sendBWEAverager.avg,0),sendBWEMax:z.round(this.sendBWEAverager.maxSample,0),recvBWEAvg:z.round(this.recvBWEAverager.avg,0),recvBWEMax:z.round(this.recvBWEAverager.maxSample,0),sendBitrate:$,recvBitrate:X,sendBWAvg:z.round(this.sendBWAverager.avg,0),sendBWMax:z.round(this.sendBWAverager.maxSample,0),recvBWAvg:z.round(this.recvBWAverager.avg,0),recvBWMax:z.round(this.recvBWAverager.maxSample,0),bwJumpsHistogram:this.bwJumpsHistogramCollector.counts}},TransportStatsExtender}()},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var K=G(1),J=function(){function StatsDict(){this.googCandidatePair={},this.ssrc={},this.googComponent={},this.VideoBwe={bweforvideo:{}}}return StatsDict}(),Q=function(){function LegacyStatisticsMapper(){this.statistics=new J,this.statsDiffMap=new Map,this.ssrcTrackMap=new Map}return LegacyStatisticsMapper.prototype.build=function(F){return this.statistics=new J,this.constructGoogCandidatePair(F),this.constructGoogSsrc(F),this.constructGoogComponent(F),this.constructDataChannel(F),this.constructVideoBwe(F),this.statistics},LegacyStatisticsMapper.prototype.setSsrcTrackPair=function(F,B){null===B?this.ssrcTrackMap.delete(F):this.ssrcTrackMap.set(F,B)},LegacyStatisticsMapper.prototype.constructGoogSsrc=function(F){var B=this,G={};if(F.hasOwnProperty("outbound-rtp")){var W=F["outbound-rtp"];Object.keys(W).forEach((function(z){var K="ssrc_".concat(W[z].ssrc,"_send"),J=B.constructSendSsrc(F,W[z]);G[K]=J}))}if(F.hasOwnProperty("inbound-rtp")){var z=F["inbound-rtp"];Object.keys(z).forEach((function(W){var K="ssrc_".concat(z[W].ssrc,"_recv"),J=B.constructRecvSsrc(F,z[W]);G[K]=J}))}this.statistics.ssrc=G},LegacyStatisticsMapper.prototype.constructSendSsrc=function(F,B){var G,z,J=B.trackId?F.track[B.trackId]:null,Q=B.mediaSourceId?F["media-source"][B.mediaSourceId]:null,Y=this.getRemoteInboundRtp(F,B.ssrc),$="ssrc_".concat(B.ssrc,"_send"),X=null!==(z=null!==(G=null==Q?void 0:Q.trackIdentifier)&&void 0!==G?G:null==J?void 0:J.trackIdentifier)&&void 0!==z?z:this.ssrcTrackMap.get(B.ssrc),Z={id:$,ssrc:B.ssrc,mediaType:B.mediaType,bytesSent:B.bytesSent,bytesSentDiff:this.calculateDiff($,B.bytesSent,4),packetsSent:B.packetsSent,packetsLost:null==Y?void 0:Y.packetsLost,jitter:null==Y?void 0:Y.jitter,googRtt:this.getRtt(Y),googCodecName:this.getCodec(F,B.codecId),transportId:B.transportId,googTrackId:X};return"audio"===B.mediaType&&(Z=W(W({},Z),this.constructAudioSendSsrc(B,Q))),"video"===B.mediaType&&(Z=W(W({},Z),this.constructVideoSendSsrc(B,Q,$,J))),K.removeUndefinedFields(Z)},LegacyStatisticsMapper.prototype.constructAudioSendSsrc=function(F,B){return{audioInputLevel:null==B?void 0:B.audioLevel,totalAudioEnergy:null==B?void 0:B.totalAudioEnergy,fecPacketsSent:F.fecPacketsSent}},LegacyStatisticsMapper.prototype.constructVideoSendSsrc=function(F,B,G,W){var z,K,J,Q;return{framesEncoded:F.framesEncoded,googFrameRateEncoded:this.calculateDiff(G,F.framesEncoded,2),googFrameRateSent:this.calculateDiff(G,null!==(z=F.framesSent)&&void 0!==z?z:null==W?void 0:W.framesSent,1),googFrameRateInput:null==B?void 0:B.framesPerSecond,googFrameHeightSent:null!==(K=F.frameHeight)&&void 0!==K?K:null==W?void 0:W.frameHeight,googFrameWidthSent:null!==(J=F.frameWidth)&&void 0!==J?J:null==W?void 0:W.frameWidth,googFrameHeightInput:null==B?void 0:B.height,googFrameWidthInput:null==B?void 0:B.width,hugeFramesSent:null!==(Q=F.hugeFramesSent)&&void 0!==Q?Q:null==W?void 0:W.hugeFramesSent,keyFramesEncoded:F.keyFramesEncoded,qpSum:F.qpSum,qp:this.calculateDiff(G,F.qpSum,8),googPlisReceived:F.pliCount,googFirsReceived:F.firCount,googNacksReceived:F.nackCount,qualityLimitationDurations:F.qualityLimitationDurations,qualityLimitationReason:F.qualityLimitationReason,qualityLimitationResolutionChanges:F.qualityLimitationResolutionChanges,codecImplementationName:F.encoderImplementation,rid:F.rid,encodeTime:F.totalEncodeTime&&Math.round(1e3*this.calculateDiff(G,F.totalEncodeTime,6))}},LegacyStatisticsMapper.prototype.constructRecvSsrc=function(F,B){var G,z=B.trackId?F.track[B.trackId]:null,J="ssrc_".concat(B.ssrc,"_recv"),Q=null!==(G=null==z?void 0:z.trackIdentifier)&&void 0!==G?G:this.ssrcTrackMap.get(B.ssrc),Y={id:J,ssrc:B.ssrc,mediaType:B.mediaType,bytesReceived:B.bytesReceived,bytesReceivedDiff:this.calculateDiff(J,B.bytesReceived,5),packetsReceived:B.packetsReceived,packetsLost:B.packetsLost,jitter:B.jitter,googJitterBufferMs:B.jitterBufferEmittedCount&&Math.round(B.jitterBufferDelay/B.jitterBufferEmittedCount*1e3),googCodecName:this.getCodec(F,B.codecId),googTrackId:Q,transportId:B.transportId};return"audio"===B.mediaType&&(Y=W(W({},Y),this.constructAudioRecvSsrc(B,z))),"video"===B.mediaType&&(Y=W(W({},Y),this.constructVideoRecvSsrc(B,J,z))),K.removeUndefinedFields(Y)},LegacyStatisticsMapper.prototype.constructAudioRecvSsrc=function(F,B){var G,W;return{audioOutputLevel:null!==(G=F.audioLevel)&&void 0!==G?G:null==B?void 0:B.audioLevel,totalAudioEnergy:null!==(W=F.totalAudioEnergy)&&void 0!==W?W:null==B?void 0:B.totalAudioEnergy,concealedSamples:F.concealedSamples,silentConcealedSamples:F.silentConcealedSamples,totalSamplesReceived:F.totalSamplesReceived,healedRatio:F.totalSamplesReceived&&(F.concealedSamples-F.silentConcealedSamples)/F.totalSamplesReceived,fecPacketsReceived:F.fecPacketsReceived,fecPacketsDiscarded:F.fecPacketsDiscarded}},LegacyStatisticsMapper.prototype.constructVideoRecvSsrc=function(F,B,G){var W,z,K;return{framesDecoded:F.framesDecoded,googFrameRateDecoded:this.calculateDiff(B,F.framesDecoded,3),googFrameRateReceived:this.calculateDiff(B,null!==(W=F.framesReceived)&&void 0!==W?W:null==G?void 0:G.framesReceived,0),googFrameHeightReceived:null!==(z=F.frameHeight)&&void 0!==z?z:null==G?void 0:G.frameHeight,googFrameWidthReceived:null!==(K=F.frameWidth)&&void 0!==K?K:null==G?void 0:G.frameWidth,keyFramesDecoded:F.keyFramesDecoded,googPlisSent:F.pliCount,googFirsSent:F.firCount,googNacksSent:F.nackCount,codecImplementationName:F.decoderImplementation,decodeTime:F.totalDecodeTime&&Math.round(1e3*this.calculateDiff(B,F.totalDecodeTime,7))}},LegacyStatisticsMapper.prototype.constructGoogCandidatePair=function(F){var B=this,G=F["candidate-pair"];G&&Object.keys(G).forEach((function(W){var z=B.constructPair(F,G[W]);B.statistics.googCandidatePair[z.id]=z}))},LegacyStatisticsMapper.prototype.constructPair=function(F,B){var G=F["local-candidate"][B.localCandidateId],W=F["remote-candidate"][B.remoteCandidateId],z={bytesReceived:B.bytesReceived,bytesSent:B.bytesSent,googTransportType:G.protocol,googRtt:B.currentRoundTripTime?Math.round(1e3*B.currentRoundTripTime):void 0,googLocalAddress:"".concat(G.ip?G.ip:G.address,":").concat(G.port),googLocalCandidateType:G.candidateType,localRelayProtocol:G.relayProtocol,localNetworkType:G.networkType,googRemoteAddress:"".concat(W.ip?W.ip:W.address,":").concat(W.port),googRemoteCandidateType:W.candidateType,googActiveConnection:B.nominated,requestsReceived:B.requestsReceived,requestsSent:B.requestsSent,responsesReceived:B.responsesReceived,responsesSent:B.responsesSent,consentRequestsSent:B.consentRequestsSent,id:B.id,remoteCandidateId:B.remoteCandidateId,localCandidateId:B.localCandidateId,googWritable:B.writable};return K.removeUndefinedFields(z)},LegacyStatisticsMapper.prototype.constructGoogComponent=function(F){var B=this;F.transport&&Object.keys(F.transport).forEach((function(G){B.statistics.googComponent[G]={id:G,selectedCandidatePairId:F.transport[G].selectedCandidatePairId}}))},LegacyStatisticsMapper.prototype.constructDataChannel=function(F){if(F.hasOwnProperty("data-channel")){var B=F["data-channel"];this.statistics.data=Object.keys(B).map((function(F){var G=B[F];return{bytesReceived:G.bytesReceived,bytesSent:G.bytesSent,dataChannelIdentifier:G.dataChannelIdentifier,label:G.label,messagesReceived:G.messagesReceived,messagesSent:G.messagesSent,protocol:G.protocol,state:G.state,timestamp:G.timestamp,type:G.type}}))}},LegacyStatisticsMapper.prototype.constructVideoBwe=function(F){var B=F["outbound-rtp"],G=F["candidate-pair"];if(B&&G){var W=null;if(Object.keys(B).forEach((function(G){"video"===B[G].mediaType&&F.transport&&!W&&(W=F.transport[B[G].transportId])})),W&&G[W.selectedCandidatePairId]){var z={googAvailableSendBandwidth:G[W.selectedCandidatePairId].availableOutgoingBitrate,googAvailableReceiveBandwidth:G[W.selectedCandidatePairId].availableIncomingBitrate};this.statistics.VideoBwe.bweforvideo=K.removeUndefinedFields(z)}}},LegacyStatisticsMapper.prototype.getRemoteInboundRtp=function(F,B){var G,W,K=F["remote-inbound-rtp"];if(K)try{for(var J=z(Object.keys(K)),Q=J.next();!Q.done;Q=J.next()){var Y=Q.value;if(K[Y].ssrc===B)return K[Y]}}catch(F){G={error:F}}finally{try{Q&&!Q.done&&(W=J.return)&&W.call(J)}finally{if(G)throw G.error}}},LegacyStatisticsMapper.prototype.getRtt=function(F){var B=null==F?void 0:F.roundTripTime;return B?Math.round(1e3*B):void 0},LegacyStatisticsMapper.prototype.getCodec=function(F,B){if(B&&F.codec&&F.codec[B])return F.codec[B].mimeType.split("/")[1]},LegacyStatisticsMapper.prototype.calculateDiff=function(F,B,G){if(void 0!==B){var W=B,z=this.statsDiffMap.has(F)?this.statsDiffMap.get(F):new Map;if(z.has(G)){var K=z.get(G);K<=B&&(W=B-K)}return z.set(G,B),this.statsDiffMap.set(F,z),isNaN(W)?void 0:W}},LegacyStatisticsMapper}();B.default=Q},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0});var z=G(1);function getSrtpReport(F){var B="";return F.dtls&&(B+="dtls"),F.sdes&&(B+="sdes"),B}var K=function(){function SessionInfo(){this.info={OfferedSrtp:"none",NegotiatedSrtp:"none",IceConnectionState:"none",IceConnectionStatePrevious:"none",SignalingState:"none",SignalingStatePrevious:"none",RelayCandidate:"none",IceTransportPolicy:"none",IceServers:"none",FakeIceCandidate:!1,BweType:"none",SdpSemantics:"none",BundlePolicy:"none",IPAddress:"none",ReflexiveLocalIP:"none",NumberOfInterfaces:0}}return SessionInfo.prototype.setCandidateDetails=function(F){"host"===F.type&&"udp"===F.protocol?this.setIPAddressInfo(F.ip):"srflx"===F.type&&this.setReflexiveLocalIP(F.ip)},SessionInfo.prototype.setOfferedModalities=function(F){this.offeredModalities=F,this.activeModalities=F},SessionInfo.prototype.setNegotiatedModalities=function(F){this.negotiatedModalities=F,this.activeModalities=F},SessionInfo.prototype.setNegotiatedSrtpInfo=function(F){this.info.NegotiatedSrtp=getSrtpReport(F)},SessionInfo.prototype.setOfferedSrtpInfo=function(F){this.info.OfferedSrtp=getSrtpReport(F)},SessionInfo.prototype.setIceConnectionState=function(F){this.info.IceConnectionStatePrevious=this.info.IceConnectionState,this.info.IceConnectionState=F},SessionInfo.prototype.setSignalingConnectionState=function(F){this.info.SignalingStatePrevious=this.info.SignalingState,this.info.SignalingState=F},SessionInfo.prototype.setRelayCandidateInfo=function(F){this.info.RelayCandidate=JSON.stringify(F)},SessionInfo.prototype.fillExtensionInfo=function(F){z.assign(F,this.info)},SessionInfo.prototype.setIceTransportPolicy=function(F){this.info.IceTransportPolicy=F},SessionInfo.prototype.setIceServers=function(F){var B=F.map((function(F){var B=W({},F);return B.username&&(B.username="true"),B.credential&&(B.credential="true"),B}));this.info.IceServers=JSON.stringify(B)},SessionInfo.prototype.setFakeIceCandidate=function(F){this.info.FakeIceCandidate=F},SessionInfo.prototype.setBweType=function(F){"Unknown"!==F&&(this.info.BweType=F)},SessionInfo.prototype.setSdpSemantics=function(F){this.info.SdpSemantics=F},SessionInfo.prototype.setBundlePolicy=function(F){this.info.BundlePolicy=F},SessionInfo.prototype.setIPAddressInfo=function(F){this.info.NumberOfInterfaces+=1,"none"===this.info.IPAddress&&(this.info.IPAddress=F)},SessionInfo.prototype.setReflexiveLocalIP=function(F){"none"===this.info.ReflexiveLocalIP&&(this.info.ReflexiveLocalIP=F)},SessionInfo}();B.default=K},function(F,B,G){var W=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},z=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},J=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},Q=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var Y=G(8),$=G(1),X=G(4),Z=G(10),ee=G(389),te=G(390),ne=G(391),ie=G(144),re=G(392),oe=G(394),ae=G(145),se=G(407),ce=["googFrameHeightReceived","googFrameWidthReceived","googFrameHeightSent","googFrameWidthSent","googFrameRateInput","googFrameRateSent","googNacksSent","googNacksReceived","googPlisSent","googPlisReceived","googFirsSent","googFirsReceived","framesDecoded","googFrameRateDecoded","googFrameRateReceived","framesEncoded","packetsLost","packetsSent","packetsReceived","bytesReceived","bytesSent","googEncodeUsagePercent","audioInputLevel","audioOutputLevel","googDecodingCTN","googDecodingPLC","keyFramesEncoded","keyFramesDecoded","googRtt","concealedSamples","silentConcealedSamples","totalSamplesReceived","healedRatio","googJitterBufferMs","qpSum","fecPacketsReceived","fecPacketsDiscarded","fecPacketsSent"],le=["bytesSent","bytesReceived","googRtt","packetsSent","requestsSent","consentRequestsSent","responsesSent","requestsReceived","responsesReceived"],de=["googAvailableReceiveBandwidth","googAvailableSendBandwidth","googTransmitBitrate"];function catchStatsErrors(F,B,G){var W=G.value;G.value=function(){for(var F=[],G=0;G<arguments.length;G++)F[G]=arguments[G];try{return W.apply(this,F)}catch(F){this.processStatsError(B,F)}}}var ue=10,pe=function(){function WebrtcStatistics(F,B,G,W,z,K){this.logger=F,this.sessionInfo=B,this.configProvider=G,this.mediaManager=W,this.multiparty=z,this.newStatsApi=K,this.statsErrors=[],this.subscribedTrackIds=[],this.iceCandidateErrors=[],this.terminated=!1,this.hwSilent=!1,this.isSpeaking=!1,this.networkSendLevel="Good",this.networkRecvLevel="Good",this.audioTelemetry=new te.default(this.configProvider),this.cameraOpenResolution={width:0,height:0},this.streamSenderStarted={},this.totalVideoControlMessages=0,this.outOfOrderVideoControlMessages=0,this.subscribedTrackSsrc=[],this.multiViewVideoTelemetry={},this.h264AvailableProfiles=[],this.timeToFirstFrame={},this.missedInitialPreferredResolution={},this.MSIDs=new Set,this.MSIDsPairs={},this.extensions={WebRTCStats:{},AudioTransportRecvBitrate:0,AudioTransportSendBitrate:0,AudioPayloadSendBitrate:0,AudioPayloadRecvBitrate:0,VideoPayloadSendBitrate:0,VideoPayloadRecvBitrate:0,TimerAudioTransportRecvBitrate:0,TimerAudioTransportSendBitrate:0,TimerAudioPayloadRecvBitrate:0,TimerAudioPayloadSendBitrate:0,TimerVideoPayloadRecvBitrate:0,TimerVideoPayloadSendBitrate:0,StartTime:Date.now(),EndTime:Date.now(),Audio_recv_jitterBufferAvgSize:0,Audio_recv_jitterMax:0,Audio_send_rttAvg:0,Audio_send_rttMax:0,MaxSessionBandwidth:0,Video_recv_MSIDs:[]},this.report={type:"WebRtcMediaStats",data:{Extensions:this.extensions}},this.lastSSRCs=new Map,this.videoTelemetry=new ae.default(this.extensions.StartTime,this.configProvider,this.logger.createChild("Video"),"Video"),this.sharingTelemetry=new ae.default(this.extensions.StartTime,this.configProvider,this.logger.createChild("Sharing"),"ScreenShare"),this.dataTelemetry=new ie.WebRTCDataTelemetry,this.bandwidthTelemetry=new ne.WebRTCBandwidthTelemetry(this.configProvider.config.webrtcBWJumpLowerLimit,this.configProvider.config.webrtcBWJumpUpperLimit),this.stabilizationTelemetry=new oe.WebrtcStabilizationTelemetry(this.configProvider.config.webrtcBWStabilizationSlidingWindowSize,this.configProvider.config.webrtcBWStabilizationMaxDeviation,this.configProvider.config.webrtcBWStabilizationMinBandwidth),this.storedRecordsNumber=Number(this.configProvider.config.webrtcStatStoredRecordsNumber),this.hwSilentDetectionDuration=Number(this.configProvider.config.webrtcStatHwSilentDetectionDuration),this.hwSilentDetectionLevel=Number(this.configProvider.config.webrtcStatHwSilentDetectionLevel),this.audioHealedRatioTelemetry=new ee.default(this.configProvider.config.webrtcStatNetworkDetectionDuration),this.networkQualityTelemetry=new re.default(this.configProvider,this.newStatsApi,this.audioHealedRatioTelemetry),this.speakingWhileMutedBadDuration=Number(this.configProvider.config.webrtcSpeakingWhileMutedBadDuration),this.speakingWhileMutedDetectionLevel=Number(this.configProvider.config.webrtcSpeakingWhileMutedDetectionLevel),this.videoDelayTimePeriod=this.configProvider.config.webrtcVideoDelayThreshold,this.maxStoredPreferredResolutions=this.configProvider.config.maxStoredPreferredResolutionCount,this.simulcastVideo=new se.default(this.logger.createChild("simulcastVideo"),this.configProvider),this.simulcastSharing=new se.default(this.logger.createChild("simulcastSharing"),this.configProvider)}return Object.defineProperty(WebrtcStatistics.prototype,"currentVideoRecvTrackId",{get:function(){var F;return null===(F=this.extensions.WebRTCStats.ssrc_video_recv)||void 0===F?void 0:F.googTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(WebrtcStatistics.prototype,"currentSharingRecvTrackId",{get:function(){var F;return null===(F=this.extensions.WebRTCStats.ssrc_sharing_recv)||void 0===F?void 0:F.googTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(WebrtcStatistics.prototype,"isMultiViewVideoTelemetry",{get:function(){return Object.getOwnPropertyNames(this.multiViewVideoTelemetry).length>0},enumerable:!1,configurable:!0}),WebrtcStatistics.prototype.onDeviceEvent=function(F){if("stream_acquired"===F.eventType){var B=F.payload;"Video"===B.mediaType&&(this.cameraOpenResolution=B.resolution)}},WebrtcStatistics.prototype.onMaxCapabilitiesRequested=function(F){(F.modality===X.default.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesRequested(F),(F.modality===X.default.MODALITY.video?this.simulcastVideo:this.simulcastSharing).setMaxCapabilities(F,!1)},WebrtcStatistics.prototype.onMaxCapabilitiesApplied=function(F){(F.modality===X.default.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesApplied(F),(F.modality===X.default.MODALITY.video?this.simulcastVideo:this.simulcastSharing).setMaxCapabilities(F,!0)},WebrtcStatistics.prototype.setSubscribedTrackIds=function(F){this.subscribedTrackIds=F||[]},WebrtcStatistics.prototype.setSubscribedTrackSsrc=function(F){this.subscribedTrackSsrc=F||[]},WebrtcStatistics.prototype.addSubscriptionEvent=function(F,B,G,W,z,K,J){var Q={evt:F,ts:Date.now()-this.extensions.StartTime,msi:G,localMsi:W,duration:K};z&&(Q.error=$.stringifyObject(z));var Y=this.getHandlerForModality(B);if(Y.addSubscriptionEvent(Q),J&&this.setMSIDsPair(G,W,J),1===F||3===F){var X=1===F;Y.startStopRecvDataGathering(X)}},WebrtcStatistics.prototype.setMSIDsPair=function(F,B,G){var W="ssrc_".concat(G.replace(/\D/g,""),"_recv");this.MSIDsPairs[W]={msi:F,localMsi:B}},WebrtcStatistics.prototype.getHandlerForModality=function(F){switch(F){case X.default.MODALITY.video:return this.videoTelemetry;case X.default.MODALITY.sharing:return this.sharingTelemetry;default:throw new Error("Handler not found for modality: ".concat(F))}},WebrtcStatistics.prototype.setTerminated=function(){this.extensions.EndTime=(new Date).getTime(),this.terminated=!0},WebrtcStatistics.prototype.startWaitingForStreamStart=function(F,B){this.streamStartDetection||this.sessionInfo.setOfferedModalities(F),this.streamStartDetection=!0},WebrtcStatistics.prototype.recordDataChannelProtocolEvent=function(F){this.dataTelemetry.recordDataChannelProtocolEvent(F)},WebrtcStatistics.prototype.setSessionDataChannelState=function(F){this.dataTelemetry.setSessionDataChannelState(F)},WebrtcStatistics.prototype.recordDataChannelCreationFailure=function(F){this.dataTelemetry.recordDataChannelCreationFailure(F)},WebrtcStatistics.prototype.processStatsDict=function(F){var B,G;if(this.processSimulcastStats(F),this.constructWebRtcReportForSingleStream(this.extensions.WebRTCStats,F),this.streamStartDetection&&(this.setStartTime(this.sessionInfo.offeredModalities)||this.terminated)&&(this.streamStartDetection=!1),Object.keys(this.missedInitialPreferredResolution).length>0&&(this.currentVideoRecvTrackId||this.currentSharingRecvTrackId)&&this.setMissedInitialPreferredResolution(),this.constructWebRTCDataReport(this.extensions.WebRTCStats,F),this.calculateHwSilentState(),this.calculateSpeakingState(),this.setHealedRatioSamples(),this.calculateNetworkRecvQualityLevel(),this.calculateNetworkSendQualityLevel(),this.sessionInfo.activeModalities&&(this.processBandwidthStats(),this.processAudioStats(),this.processVideoStatsRecv(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_recv,!0),this.processVideoStatsSend(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_send),this.processSharingStats(),this.processStreamsCounters()),this.configProvider.config.enableMultiViewStats){var W=this.extensions.WebRTCStats[X.default.MULTIPLE_RECV_STREAMS]?this.extensions.WebRTCStats[X.default.MULTIPLE_RECV_STREAMS]:{};this.constructWebRtcReportForMultipleStreams(W,F);try{for(var z=K(Object.keys(W)),J=z.next();!J.done;J=z.next()){var Q=J.value,Y=W[Q];this.processVideoStatsRecv(this.multiViewVideoTelemetry[Q],Y)}}catch(F){B={error:F}}finally{try{J&&!J.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}this.extensions.WebRTCStats[X.default.MULTIPLE_RECV_STREAMS]=W}this.extensions.WebRTCStats.statsErrors=JSON.stringify(this.statsErrors)},WebrtcStatistics.prototype.setTimeToFirstFrame=function(F,B){B in this.timeToFirstFrame||(this.timeToFirstFrame[B]=F)},WebrtcStatistics.prototype.getCurrentTimeToFirstFrame=function(F){return this.timeToFirstFrame[F]?this.timeToFirstFrame[F]:-1},WebrtcStatistics.prototype.getVideoTelemetryBySsrc=function(F){var B;return this.extensions.WebRTCStats.ssrc_video_recv&&this.extensions.WebRTCStats.ssrc_video_recv.id===F?B=this.videoTelemetry:this.extensions.WebRTCStats.ssrc_sharing_recv&&this.extensions.WebRTCStats.ssrc_sharing_recv.id===F?B=this.sharingTelemetry:this.isMultiViewVideoTelemetry&&!B&&(B=this.multiViewVideoTelemetry[F]),B},WebrtcStatistics.prototype.getIsRendering=function(F){var B=this.getVideoTelemetryBySsrc(F);return B?B.getIsRendering():void 0},WebrtcStatistics.prototype.setFreezeDuration=function(F,B){var G,W;try{for(var z=K(Object.keys(this.multiViewVideoTelemetry)),J=z.next();!J.done;J=z.next()){var Q=J.value;this.multiViewVideoTelemetry[Q].trackId===B&&this.isSubscribed(B)&&this.multiViewVideoTelemetry[Q].setRecvTotalFreezeDurationMs(F)}}catch(F){G={error:F}}finally{try{J&&!J.done&&(W=z.return)&&W.call(z)}finally{if(G)throw G.error}}this.currentSharingRecvTrackId===B&&this.isSubscribed(B)&&this.sharingTelemetry.setRecvTotalFreezeDurationMs(F),this.currentVideoRecvTrackId===B&&this.isSubscribed(B)&&this.videoTelemetry.setRecvTotalFreezeDurationMs(F)},WebrtcStatistics.prototype.addVideoControlMessage=function(F){this.totalVideoControlMessages++,F&&this.outOfOrderVideoControlMessages++},WebrtcStatistics.prototype.setStreamSenderStarted=function(F,B){this.streamSenderStarted[F]=B},WebrtcStatistics.prototype.addReportedReceiveBandwidth=function(F){this.limitCaptureAmount(this.extensions,"ReportedReceiveBandwidth",F)},WebrtcStatistics.prototype.addOptimalVideoCountReport=function(F){this.limitCaptureAmount(this.extensions,"OptimalVideoCount",JSON.stringify({count:F,ts:Date.now()-this.extensions.StartTime}))},WebrtcStatistics.prototype.setHealedRatioSamples=function(){var F,B,G,W,z,K,J,Q,Y;this.audioHealedRatioTelemetry.captureHealedRatioSamples(null===(G=null===(B=null===(F=this.extensions)||void 0===F?void 0:F.WebRTCStats)||void 0===B?void 0:B.ssrc_audio_recv)||void 0===G?void 0:G.concealedSamples,null===(K=null===(z=null===(W=this.extensions)||void 0===W?void 0:W.WebRTCStats)||void 0===z?void 0:z.ssrc_audio_recv)||void 0===K?void 0:K.silentConcealedSamples,null===(Y=null===(Q=null===(J=this.extensions)||void 0===J?void 0:J.WebRTCStats)||void 0===Q?void 0:Q.ssrc_audio_recv)||void 0===Y?void 0:Y.totalSamplesReceived)},WebrtcStatistics.prototype.processSimulcastStats=function(F){this.simulcastVideo.processStats(F),this.simulcastSharing.processStats(F)},WebrtcStatistics.prototype.processBandwidthStats=function(){var F,B=null===(F=this.extensions.WebRTCStats.bweStat)||void 0===F?void 0:F.googAvailableSendBandwidth;if(B){var G=this.streamSenderStarted.Video||this.streamSenderStarted.ScreenShare;this.bandwidthTelemetry.recordSendBandwidth(B[B.length-1]),this.stabilizationTelemetry.processSendBandwidth(parseInt(B[B.length-1]),this.sessionInfo.activeModalities,G)}},WebrtcStatistics.prototype.processAudioStats=function(){var F,B,G,W,z;if(this.extensions.WebRTCStats.ssrc_audio_send&&this.limitCaptureAmount(this.extensions,"Audio_send_RawInputVolume",this.audioTelemetry.getInputLevel("Audio")),void 0!==(null===(F=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===F?void 0:F.googJitterBufferMs)&&this.audioTelemetry.captureJitterBuffer((0,Y.last)(this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs)),void 0!==(null===(B=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===B?void 0:B.packetsLost)&&(null===(G=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===G?void 0:G.packetsReceived)&&this.audioTelemetry.capturePacketsLostAndPacketsReceived((0,Y.last)(this.extensions.WebRTCStats.ssrc_audio_recv.packetsLost),(0,Y.last)(this.extensions.WebRTCStats.ssrc_audio_recv.packetsReceived)),void 0!==(null===(W=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===W?void 0:W.jitter)&&this.audioTelemetry.captureJitterMax(this.extensions.WebRTCStats.ssrc_audio_recv.jitter),null===(z=this.extensions.WebRTCStats.ssrc_audio_send)||void 0===z?void 0:z.googRtt){var K=this.extensions.WebRTCStats.ssrc_audio_send.googRtt;this.audioTelemetry.captureRtt(K[K.length-1])}},WebrtcStatistics.prototype.stopGatheringIfNeeded=function(F,B,G,W){var z="".concat(B).concat(G);W!==this.lastSSRCs.get(z)&&(this.lastSSRCs.set(z,W),B===X.default.MEDIA_DIRECTION.SEND?F.stopSendGathering():F.stopRecvGathering())},WebrtcStatistics.prototype.setKeyFrameData=function(F,B){var G={kfEncoded:this.getLastSampleInt(B.keyFramesEncoded),fir:this.getLastSampleInt(B.googFirsReceived),pli:this.getLastSampleInt(B.googPlisReceived)};F.setKeyFrameData(G)},WebrtcStatistics.prototype.processVideoStatsSend=function(F,B){B&&Z.hasSendDirectionality(this.sessionInfo.activeModalities.video)?(this.stopGatheringIfNeeded(F,X.default.MEDIA_DIRECTION.SEND,"Video",B.ssrc),this.setKeyFrameData(F,B),F.captureMediaData(X.default.MEDIA_DIRECTION.SEND,B.googFrameRateSent,B.framesEncoded),F.captureFrameRate(B.googFrameRateInput),F.analyzeDelay(this.videoDelayTimePeriod,B.googAvgEncodeMs),F.captureQpData(X.default.MEDIA_DIRECTION.SEND,B.qpSum,B.framesEncoded),F.captureBitrateSample(X.default.MEDIA_DIRECTION.SEND,this.getLastSampleInt(B.bytesSent)),F.detectCaptureFreeze(B.googFrameRateInput),F.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth),F.setCurrentParameters(parseInt(B.ssrc),{width:this.getLastSampleInt(B.googFrameWidthSent),height:this.getLastSampleInt(B.googFrameHeightSent)},this.getLastSampleInt(B.googFrameRateSent)),F.setQualityLimitationReason(B.qualityLimitationReason)):F.isSendGathering()&&(F.stopSendGathering(),this.lastSSRCs.delete("".concat(X.default.MEDIA_DIRECTION.SEND,"Video")))},WebrtcStatistics.prototype.processVideoStatsRecv=function(F,B,G){var W,z;void 0===G&&(G=!1),B&&Z.hasReceiveDirectionality(this.sessionInfo.activeModalities.video)&&this.videoTelemetry.isRecvDataGatheringEnabled?(G&&this.stopGatheringIfNeeded(F,X.default.MEDIA_DIRECTION.RECV,"Video",B.ssrc),F.trackId=B.googTrackId,F.gatherRecvFreezeData(B.googFrameRateDecoded,B.googFrameRateReceived,this.getLastSampleInt(B.bytesReceived)),F.captureMediaData(X.default.MEDIA_DIRECTION.RECV,B.googFrameRateReceived,B.googFrameRateDecoded),F.captureTimeToFirstFrame(this.getCurrentTimeToFirstFrame(B.googTrackId)),F.captureQpData(X.default.MEDIA_DIRECTION.RECV,B.qpSum,B.framesDecoded),F.captureBitrateSample(X.default.MEDIA_DIRECTION.RECV,this.getLastSampleInt(B.bytesReceived)),F.captureResolutionSample({width:this.getLastSampleInt(B.googFrameWidthReceived),height:this.getLastSampleInt(B.googFrameHeightReceived)}),(null===(W=this.extensions.WebRTCStats.ssrc_video_recv)||void 0===W?void 0:W.packetsLost)&&(null===(z=this.extensions.WebRTCStats.ssrc_video_recv)||void 0===z?void 0:z.packetsReceived)&&this.videoTelemetry.capturePacketsLostAndPacketsReceved((0,Y.last)(this.extensions.WebRTCStats.ssrc_video_recv.packetsLost),(0,Y.last)(this.extensions.WebRTCStats.ssrc_video_recv.packetsReceived))):G&&this.lastSSRCs.delete("".concat(X.default.MEDIA_DIRECTION.RECV,"Video"))},WebrtcStatistics.prototype.processSharingStats=function(){var F=this.extensions.WebRTCStats.ssrc_sharing_send,B=this.extensions.WebRTCStats.ssrc_sharing_recv;F&&Z.hasSendDirectionality(this.sessionInfo.activeModalities.sharing)?(this.stopGatheringIfNeeded(this.sharingTelemetry,X.default.MEDIA_DIRECTION.SEND,"Sharing",F.ssrc),this.setKeyFrameData(this.sharingTelemetry,F),this.sharingTelemetry.captureMediaData(X.default.MEDIA_DIRECTION.SEND,F.googFrameRateSent,F.framesEncoded),this.sharingTelemetry.captureFrameRate(F.googFrameRateInput),this.sharingTelemetry.analyzeDelay(this.videoDelayTimePeriod,F.googAvgEncodeMs),this.sharingTelemetry.captureQpData(X.default.MEDIA_DIRECTION.SEND,F.qpSum,F.framesEncoded),this.sharingTelemetry.captureBitrateSample(X.default.MEDIA_DIRECTION.SEND,this.getLastSampleInt(F.bytesSent)),this.sharingTelemetry.detectCaptureFreeze(F.googFrameRateInput),this.sharingTelemetry.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth),this.sharingTelemetry.setCurrentParameters(parseInt(F.ssrc),{width:this.getLastSampleInt(F.googFrameWidthSent),height:this.getLastSampleInt(F.googFrameHeightSent)},this.getLastSampleInt(F.googFrameRateSent)),this.limitCaptureAmount(this.extensions,"Sharing_send_RawInputVolume",this.audioTelemetry.getInputLevel("ScreenShare"))):this.sharingTelemetry.isSendGathering()&&(this.sharingTelemetry.stopSendGathering(),this.lastSSRCs.delete("".concat(X.default.MEDIA_DIRECTION.SEND,"Sharing"))),B&&Z.hasReceiveDirectionality(this.sessionInfo.activeModalities.sharing)&&this.sharingTelemetry.isRecvDataGatheringEnabled?(this.stopGatheringIfNeeded(this.sharingTelemetry,X.default.MEDIA_DIRECTION.RECV,"Sharing",B.ssrc),this.sharingTelemetry.trackId=B.googTrackId,this.sharingTelemetry.gatherRecvFreezeData(B.googFrameRateDecoded,B.googFrameRateReceived),this.sharingTelemetry.captureMediaData(X.default.MEDIA_DIRECTION.RECV,B.googFrameRateReceived,B.googFrameRateDecoded),this.sharingTelemetry.captureTimeToFirstFrame(this.getCurrentTimeToFirstFrame(B.googTrackId)),this.sharingTelemetry.captureQpData(X.default.MEDIA_DIRECTION.RECV,B.qpSum,B.framesDecoded),this.sharingTelemetry.captureBitrateSample(X.default.MEDIA_DIRECTION.RECV,this.getLastSampleInt(B.bytesReceived)),this.sharingTelemetry.captureResolutionSample({width:this.getLastSampleInt(B.googFrameWidthReceived),height:this.getLastSampleInt(B.googFrameHeightReceived)})):this.lastSSRCs.delete("".concat(X.default.MEDIA_DIRECTION.RECV,"Sharing"))},WebrtcStatistics.prototype.processStreamsCounters=function(){var F=this.extensions.WebRTCStats.recvCounters;F&&(this.videoTelemetry.countRecvStreams(F[X.default.MODALITY.video]),this.sharingTelemetry.countRecvStreams(F[X.default.MODALITY.sharing]))},WebrtcStatistics.prototype.setMissedInitialPreferredResolution=function(){var F=this;$.forOwn(this.missedInitialPreferredResolution,(function(B,G){F.setPreferredResolution(G,B)})),this.missedInitialPreferredResolution={}},WebrtcStatistics.prototype.setPreferredResolution=function(F,B,G){if((G===X.default.MEDIA_TYPE.video&&!this.currentVideoRecvTrackId||G===X.default.MEDIA_TYPE.sharing&&!this.currentSharingRecvTrackId)&&(this.missedInitialPreferredResolution[F]=B),this.currentVideoRecvTrackId===F&&this.videoTelemetry.capturePreferredResolution(B,this.maxStoredPreferredResolutions),this.currentSharingRecvTrackId===F&&this.sharingTelemetry.capturePreferredResolution(B,this.maxStoredPreferredResolutions),this.isMultiViewVideoTelemetry){var W=this.multiViewVideoTelemetry[this.getSsrcIdFromMultipleVideoStream(F)];W&&W.capturePreferredResolution(B,this.maxStoredPreferredResolutions)}},WebrtcStatistics.prototype.setIsRendering=function(F,B,G){var W;B===X.default.MEDIA_TYPE.video&&this.videoTelemetry.setIsRendering(F),B===X.default.MEDIA_TYPE.sharing&&this.sharingTelemetry.setIsRendering(F),this.isMultiViewVideoTelemetry&&(null===(W=this.multiViewVideoTelemetry[this.getSsrcIdFromMultipleVideoStream(G)])||void 0===W||W.setIsRendering(F))},WebrtcStatistics.prototype.setReportedSendBandwidth=function(F){this.extensions.ReportedSendBWMax||this.extensions.ReportedSendBWMin?F>this.extensions.ReportedSendBWMax?this.extensions.ReportedSendBWMax=F:F<this.extensions.ReportedSendBWMin&&(this.extensions.ReportedSendBWMin=F):(this.extensions.ReportedSendBWMax=F,this.extensions.ReportedSendBWMin=F)},WebrtcStatistics.prototype.setMaxSessionBandwidth=function(F){this.extensions.MaxSessionBandwidth=F},WebrtcStatistics.prototype.isSubscribed=function(F,B){var G=this.subscribedTrackIds.some((function(B){return B===F}));return!G&&this.configProvider.config.subscribeToSsrcForVideo&&(G=this.subscribedTrackSsrc.some((function(F){return F==="".concat(B)}))),G||!this.multiparty&&this.configProvider.config.subscribeToSsrcForVideo},WebrtcStatistics.prototype.getReport=function(F,B){var G,W,z,J,Q=this;void 0===F&&(F=!1),void 0===B&&(B=!1);try{B&&this.resetPairValues(),F||(this.videoTelemetry.stopDataGathering(),this.sharingTelemetry.stopDataGathering());var Y=this.videoTelemetry.getTotalDuration(X.default.MEDIA_DIRECTION.RECV),Z=this.videoTelemetry.getTotalDuration(X.default.MEDIA_DIRECTION.SEND),ee=this.sharingTelemetry.getTotalDuration(X.default.MEDIA_DIRECTION.RECV),te=this.sharingTelemetry.getTotalDuration(X.default.MEDIA_DIRECTION.SEND);if(Y>=0&&($.forOwn(this.videoTelemetry.getReport(X.default.MEDIA_DIRECTION.RECV,"Video_recv_",F,B),(function(F,B){return Q.extensions[B]=F})),!$.isEmpty(this.multiViewVideoTelemetry))){var ne=[],_loop_1=function(G){var W={id:G};$.forOwn(ie.multiViewVideoTelemetry[G].getReport(X.default.MEDIA_DIRECTION.RECV,"Video",F,B),(function(F,B){void 0!==F&&(W[B]=F)})),ne.push(W)},ie=this;try{for(var re=K(Object.keys(this.multiViewVideoTelemetry)),oe=re.next();!oe.done;oe=re.next()){_loop_1(oe.value)}}catch(F){G={error:F}}finally{try{oe&&!oe.done&&(W=re.return)&&W.call(re)}finally{if(G)throw G.error}}this.extensions[X.default.MULTIPLE_RECV_STREAMS]=JSON.stringify(ne)}ee>=0&&$.forOwn(this.sharingTelemetry.getReport(X.default.MEDIA_DIRECTION.RECV,"Sharing_recv_",F,B),(function(F,B){return Q.extensions[B]=F})),Z>=0&&($.forOwn(this.videoTelemetry.getReport(X.default.MEDIA_DIRECTION.SEND,"Video_send_",F,B),(function(F,B){return Q.extensions[B]=F})),this.extensions.Bandwidth_jumpsHistogram=JSON.stringify(this.bandwidthTelemetry.getReport()),this.extensions.Bandwidth_stabilizationTime=JSON.stringify(this.stabilizationTelemetry.getReport(!0)),this.extensions.Video_send_CameraOpenWidth=this.cameraOpenResolution.width,this.extensions.Video_send_CameraOpenHeight=this.cameraOpenResolution.height),te>=0&&$.forOwn(this.sharingTelemetry.getReport(X.default.MEDIA_DIRECTION.SEND,"Sharing_send_",F,B),(function(F,B){return Q.extensions[B]=F})),$.forOwn(this.dataTelemetry.getReport("Data_"),(function(F,B){return Q.extensions[B]=F})),F||B||(this.simulcastVideo.finish(),this.extensions.Video_send_Simulcast=JSON.stringify(this.simulcastVideo.collectedSessions),this.simulcastSharing.finish(),this.extensions.Sharing_send_Simulcast=JSON.stringify(this.simulcastSharing.collectedSessions)),this.iceCandidateErrors.length>0&&(this.extensions.iceCandidateErrors=JSON.stringify(this.iceCandidateErrors)),this.extensions.Audio_recv_jitterBufferAvgSize=this.audioTelemetry.getAvgJitterBuffer(),this.extensions.Audio_recv_packetsLostRateMax=this.audioTelemetry.getPacketsLostRateMax(),this.extensions.Audio_recv_jitterMax=this.audioTelemetry.getJitterMax(),this.extensions.Video_SubscriptionEvents=B?"":JSON.stringify(this.videoTelemetry.getSubscriptionEvents()),this.extensions.Sharing_SubscriptionEvents=B?"":JSON.stringify(this.sharingTelemetry.getSubscriptionEvents()),this.extensions.Audio_recv_healedRatioMax=this.audioHealedRatioTelemetry.getHealedRatioMax(),this.extensions.Audio_recv_healedRatioAvg=this.audioHealedRatioTelemetry.getHealedRatioAvg(),this.extensions.Audio_recv_packetsLostAvg=this.audioTelemetry.getAvgPacketsLost(),this.extensions.Audio_send_rttAvg=this.audioTelemetry.getAvgRtt(),this.extensions.Audio_send_rttMax=this.audioTelemetry.getMaxRtt();try{for(var ae=K(Object.keys(this.extensions)),se=ae.next();!se.done;se=ae.next()){var ce=se.value;void 0===this.extensions[ce]&&delete this.extensions[ce]}}catch(F){z={error:F}}finally{try{se&&!se.done&&(J=ae.return)&&J.call(ae)}finally{if(z)throw z.error}}return delete this.extensions.WebRTCStats[X.default.MULTIPLE_RECV_STREAMS],this.sessionInfo.fillExtensionInfo(this.extensions),Object.keys(this.extensions.WebRTCStats).length>0&&!this.extensions.WebRTCStats.hasStatsError&&this.calculateAverages(),this.extensions.H264_available_profiles=this.h264AvailableProfiles.join(),this.extensions.Video_recv_MSIDs=Array.from(this.MSIDs),this.totalVideoControlMessages>0&&(this.extensions.totalVideoControlMessages=this.totalVideoControlMessages,this.extensions.outOfOrderVideoControlMessages=this.outOfOrderVideoControlMessages),$.deepClone(this.report)}catch(F){throw this.processStatsError("Report",F),{error:F,partialReport:$.deepClone(this.report)}}},WebrtcStatistics.prototype.getAudioHwSilent=function(){return this.hwSilent},WebrtcStatistics.prototype.getSpeakingState=function(){return this.isSpeaking},WebrtcStatistics.prototype.getNetworkSendLevel=function(){return this.networkSendLevel},WebrtcStatistics.prototype.getNetworkRecvLevel=function(){return this.networkRecvLevel},WebrtcStatistics.prototype.addIceCandidateError=function(F){this.iceCandidateErrors.push(F)},WebrtcStatistics.prototype.clearIceCandidateErrors=function(){this.iceCandidateErrors=[]},WebrtcStatistics.prototype.addH264AvailableProfiles=function(F){this.h264AvailableProfiles=Q([],J(new Set(this.h264AvailableProfiles.concat(F))),!1)},WebrtcStatistics.prototype.updateSendStream=function(F,B){this.audioTelemetry.updateSendStream(F,B)},WebrtcStatistics.prototype.resetPairValues=function(){var F=this;Object.keys(this.extensions.WebRTCStats).forEach((function(B){delete F.extensions.WebRTCStats[B].pair}))},WebrtcStatistics.prototype.limitCaptureAmount=function(F,B,G){void 0!==G&&(F[B]=Array.isArray(F[B])?F[B]:[],F[B].push(G),F[B].length>this.storedRecordsNumber&&F[B].shift())},WebrtcStatistics.prototype.setStartTime=function(F){var B=this.extensions.WebRTCStats;if(!B.ssrc_audio_send||!B.ssrc_audio_recv)return!1;var setupCounter=function(F,B){return!F||B&&-1===B?B:(new Date).getTime()};return this.extensions.TimerAudioPayloadRecvBitrate=Z.hasReceiveDirectionality(F.audio)?setupCounter(B.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioPayloadRecvBitrate):-1,this.extensions.TimerAudioPayloadSendBitrate=Z.hasSendDirectionality(F.audio)?setupCounter(B.ssrc_audio_send.bytesSent,this.extensions.TimerAudioPayloadSendBitrate):-1,this.extensions.TimerAudioTransportRecvBitrate=Z.hasReceiveDirectionality(F.audio)?setupCounter(B.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioTransportRecvBitrate):-1,this.extensions.TimerAudioTransportSendBitrate=Z.hasSendDirectionality(F.audio)?setupCounter(B.ssrc_audio_send.bytesSent,this.extensions.TimerAudioTransportSendBitrate):-1,!(!B.ssrc_video_send||!B.ssrc_video_recv)&&(this.extensions.TimerVideoPayloadRecvBitrate=Z.hasReceiveDirectionality(F.video)?setupCounter(B.ssrc_video_recv.bytesReceived,this.extensions.TimerVideoPayloadRecvBitrate):-1,this.extensions.TimerVideoPayloadSendBitrate=Z.hasSendDirectionality(F.video)?setupCounter(B.ssrc_video_send.bytesSent,this.extensions.TimerVideoSendBitrate):-1,!!(this.extensions.TimerVideoPayloadRecvBitrate&&this.extensions.TimerVideoPayloadSendBitrate&&this.extensions.TimerAudioPayloadRecvBitrate&&this.extensions.TimerAudioPayloadSendBitrate&&this.extensions.TimerAudioTransportRecvBitrate&&this.extensions.TimerAudioTransportSendBitrate))},WebrtcStatistics.prototype.calculateAverages=function(){var F=this,B=this.extensions.EndTime,doTheCalc=function(F,G){return F&&B-G>0&&0!==G&&-1!==G?Math.round(8*F/(B-G)):0},getCounter=function(B){var G=B.split(".").reduce((function(F,B){return null==F?F:F[B]}),F.extensions.WebRTCStats);return Array.isArray(G)?G[G.length-1]:G};this.extensions.AudioPayloadRecvBitrate=doTheCalc(getCounter("ssrc_audio_recv.bytesReceived"),this.extensions.TimerAudioPayloadRecvBitrate),this.extensions.AudioPayloadSendBitrate=doTheCalc(getCounter("ssrc_audio_send.bytesSent"),this.extensions.TimerAudioPayloadSendBitrate),this.extensions.VideoPayloadRecvBitrate=doTheCalc(getCounter("ssrc_video_recv.bytesReceived"),this.extensions.TimerVideoPayloadRecvBitrate),this.extensions.VideoPayloadSendBitrate=doTheCalc(getCounter("ssrc_video_send.bytesSent"),this.extensions.TimerVideoPayloadSendBitrate),this.extensions.AudioTransportRecvBitrate=doTheCalc(getCounter("ssrc_audio_send.pair.bytesReceived"),this.extensions.TimerAudioTransportRecvBitrate),this.extensions.AudioTransportSendBitrate=doTheCalc(getCounter("ssrc_audio_send.pair.bytesSent"),this.extensions.TimerAudioTransportSendBitrate)},WebrtcStatistics.prototype.addFilteredFields=function(F,B,G){for(var W in void 0===G&&(G=[]),B)if(B.hasOwnProperty(W)&&"type"!==W)if(-1!==G.indexOf(W)){var z=F[W]||[];z.push(this.formatFields(B,W)),z.length>this.storedRecordsNumber&&z.shift(),F[W]||(F[W]=z)}else F[W]=B[W]},WebrtcStatistics.prototype.formatFields=function(F,B){var G=F[B];switch(B){case"audioInputLevel":case"audioOutputLevel":return this.newStatsApi?Math.floor(65535*G):2*G;case"googJitterBufferMs":return parseInt(G);case"healedRatio":return $.round(parseFloat(G),this.configProvider.config.healedRatioPrecision);default:return G}},WebrtcStatistics.prototype.processSource=function(F,B,G){var W,z;if(this.addFilteredFields(F,B,ce),B.transportId){var K=null===(W=G.googComponent)||void 0===W?void 0:W[B.transportId];if(F.transport||(F.transport={}),!K)return;if(this.addFilteredFields(F.transport,K),K.selectedCandidatePairId){var J=null===(z=G.googCandidatePair)||void 0===z?void 0:z[K.selectedCandidatePairId];if(F.pair||(F.pair={}),!J)return;this.addFilteredFields(F.pair,J,le)}}},WebrtcStatistics.prototype.getWebrtcReport=function(F,B,G,W){var z=F.ssrc[G],K=W?z.id.replace(/[0-9]+/,W):z.id;B[K]?z.ssrc!==B[K].ssrc&&(K.endsWith("video_send")?this.videoTelemetry.stopSendGathering():K.endsWith("video_recv")?this.videoTelemetry.stopRecvGathering():K.endsWith("sharing_send")?this.sharingTelemetry.stopSendGathering():K.endsWith("sharing_recv")&&this.sharingTelemetry.stopRecvGathering()):B[K]={},this.processSource(B[K],z,F)},WebrtcStatistics.prototype.constructWebRTCDataReport=function(F,B){if(B.data&&B.data.length){var G=B.data.sort((function(F,B){return B.timestamp-F.timestamp})),W=G.find((function(F){return"open"===F.state}));F.data=W||G[0]}},WebrtcStatistics.prototype.constructWebRtcReportForSingleStream=function(F,B){var G,W=this;if(B.ssrc){var z=this.selectSsrcsToCollect(B.ssrc);F.recvCounters=z.recvCounters,delete z.recvCounters,delete z.multiRecv,$.forOwn(z,(function(G){$.forOwn(G,(function(G,z){W.getWebrtcReport(B,F,G,z)}))})),(null===(G=B.VideoBwe)||void 0===G?void 0:G.bweforvideo)&&(F.bweStat||(F.bweStat={}),this.addFilteredFields(F.bweStat,B.VideoBwe.bweforvideo,de))}},WebrtcStatistics.prototype.constructWebRtcReportForMultipleStreams=function(F,B){var G=this;B.ssrc&&this.selectSsrcsToCollect(B.ssrc).multiRecv.forEach((function(W){return G.getWebrtcReport(B,F,W)}))},WebrtcStatistics.prototype.getMediaType=function(F,B){var G,W=B?B.getModality():F.mediaType;return(null===(G=F.googTrackId)||void 0===G?void 0:G.match("applicationsharing"))&&W!==X.default.MEDIA_TYPE.sharing&&(W=X.default.MEDIA_TYPE.sharing),W},WebrtcStatistics.prototype.selectSsrcsToCollect=function(F){var B,G,W=this,z={send:{},recv:{},recvCounters:{video:0,sharing:0},multiRecv:[]};if(!this.sessionInfo.activeModalities)return z;var J=[];try{for(var Q=K(Object.keys(F)),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value,ee=F[$],te=ee.googTrackId;if(te||ee.mediaType===X.default.MEDIA_TYPE.audio){var ne=this.getMediaEntity(te,ee),ie=this.getMediaType(ee,ne),re=null==ne?void 0:ne.getXSourceStreamId();if($.endsWith("send"))switch(ie){case X.default.MEDIA_TYPE.audio:Z.hasSendDirectionality(this.sessionInfo.activeModalities.audio)&&(z.send.audio=$);break;case X.default.MEDIA_TYPE.video:if(this.extensions.Video_send_SourceId=re,this.simulcastVideo.highestFidelitySSRC){this.simulcastVideo.highestFidelitySSRC===ee.ssrc&&(z.send.video=$);break}!this.streamSenderStarted.Video||!Z.hasSendDirectionality(this.sessionInfo.activeModalities.video)||(null==ne?void 0:ne.getLocalTrackId())!==ee.googTrackId&&(!this.configProvider.config.statsAllowAnyVideoSendTrack||z.send.video)||ee.rid&&"1"!==ee.rid||(z.send.video=$);break;case X.default.MEDIA_TYPE.sharing:if(this.simulcastSharing.highestFidelitySSRC){this.simulcastSharing.highestFidelitySSRC===ee.ssrc&&(z.send.sharing=$);break}this.streamSenderStarted.ScreenShare&&Z.hasSendDirectionality(this.sessionInfo.activeModalities.sharing)&&(null==ne?void 0:ne.getLocalTrackId())===ee.googTrackId&&(z.send.sharing=$);break;default:this.logger.warn("Unknown media type '".concat(ie,"'"))}else if($.endsWith("recv"))switch(ie){case X.default.MEDIA_TYPE.audio:Z.hasReceiveDirectionality(this.sessionInfo.activeModalities.audio)&&(z.recv.audio=$);break;case X.default.MEDIA_TYPE.video:void 0!==re&&this.MSIDs.add(re),this.isSubscribed(ee.googTrackId,ee.ssrc)&&Z.hasReceiveDirectionality(this.sessionInfo.activeModalities.video)&&(J.push(ee),+ee.googFrameRateReceived>0&&z.recvCounters[X.default.MODALITY.video]++);break;case X.default.MEDIA_TYPE.sharing:this.isSubscribed(ee.googTrackId,ee.ssrc)&&Z.hasReceiveDirectionality(this.sessionInfo.activeModalities.sharing)&&(z.recv.sharing=$,+ee.googFrameRateReceived>0&&z.recvCounters[X.default.MODALITY.sharing]++);break;default:this.logger.warn("Unknown media type '".concat(ie,"'"))}}}}catch(F){B={error:F}}finally{try{Y&&!Y.done&&(G=Q.return)&&G.call(Q)}finally{if(B)throw B.error}}if(J.length>0){var oe=(J=J.sort((function(F,B){return+B.googFrameHeightReceived-+F.googFrameHeightReceived}))).find((function(F){return F.mediaType===X.default.MEDIA_TYPE.video}));oe&&(z.recv.video=oe.id),this.multiparty&&this.configProvider.config.enableMultiViewStats&&(z.multiRecv=J.map((function(F){return F.id})),z.multiRecv.forEach((function(F){var B,G;W.multiViewVideoTelemetry[F]||(W.multiViewVideoTelemetry[F]=new ae.default(W.extensions.StartTime,W.configProvider,W.logger.createChild("Video[".concat(F,"]"),"Video")),W.multiViewVideoTelemetry[F].setMsi(null===(B=W.MSIDsPairs[F])||void 0===B?void 0:B.msi),W.multiViewVideoTelemetry[F].setLocalMsi(null===(G=W.MSIDsPairs[F])||void 0===G?void 0:G.localMsi))})))}return z},WebrtcStatistics.prototype.getMediaEntityForTrack=function(F){return F&&this.mediaManager.getMediaEntities().find((function(B){return B.getLocalTrackId()===F||B.getRemoteTrackId()===F}))},WebrtcStatistics.prototype.getMediaEntityByRemoteSsrc=function(F){return F&&this.mediaManager.getMediaEntities().find((function(B){return B.getRemoteSsrc()===+F}))},WebrtcStatistics.prototype.getMediaEntity=function(F,B){var G="".concat(B.ssrc),W=B.id,z=this.getMediaEntityForTrack(F);return!z&&this.configProvider.config.subscribeToSsrcForVideo&&W.endsWith("recv")&&(z=this.getMediaEntityByRemoteSsrc(G)),z},WebrtcStatistics.prototype.calculateHwSilentState=function(){var F,B=null===(F=this.extensions.WebRTCStats.ssrc_audio_send)||void 0===F?void 0:F.audioInputLevel;if(B&&!(B.length<2*this.hwSilentDetectionDuration)){for(var G=!0,W=B.length-this.hwSilentDetectionDuration-1;W<B.length;W++)if(B[W]>this.hwSilentDetectionLevel){G=!1;break}this.hwSilent!==G&&(this.hwSilent=G,this.logger.safe.info("HW silent changed to ".concat(this.hwSilent)))}},WebrtcStatistics.prototype.calculateSpeakingState=function(){var F,B=this.newStatsApi&&this.configProvider.config.useAudioAnalyzer?this.extensions.Audio_send_RawInputVolume:null===(F=this.extensions.WebRTCStats.ssrc_audio_send)||void 0===F?void 0:F.audioInputLevel;if(B&&!(B.length<=this.speakingWhileMutedBadDuration)){for(var G=!1,W=B.length-this.speakingWhileMutedBadDuration;W<B.length;W++)if(B[W]>this.speakingWhileMutedDetectionLevel){G=!0;break}this.isSpeaking=G}},WebrtcStatistics.prototype.calculateNetworkRecvQualityLevel=function(){var F,B,G,W,z;this.configProvider.config.enableNetworkRecvQualityUFD&&this.extensions.WebRTCStats.ssrc_audio_recv&&(this.networkRecvLevel=this.networkQualityTelemetry.calculateNetworkRecvQualityLevel({googDecodingCTN:null!==(F=this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingCTN)&&void 0!==F?F:[],googDecodingPLC:null!==(B=this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingPLC)&&void 0!==B?B:[],concealedSamples:null!==(G=this.extensions.WebRTCStats.ssrc_audio_recv.concealedSamples)&&void 0!==G?G:[],silentConcealedSamples:null!==(W=this.extensions.WebRTCStats.ssrc_audio_recv.silentConcealedSamples)&&void 0!==W?W:[],totalSamplesReceived:null!==(z=this.extensions.WebRTCStats.ssrc_audio_recv.totalSamplesReceived)&&void 0!==z?z:[],oldNetworkLevel:this.networkRecvLevel}))},WebrtcStatistics.prototype.calculateNetworkSendQualityLevel=function(){this.configProvider.config.enableNetworkSendQualityUFD&&this.extensions.WebRTCStats.ssrc_audio_send&&(this.networkSendLevel=this.networkQualityTelemetry.calculateNetworkSendQualityLevel(this.extensions.WebRTCStats.ssrc_audio_send.packetsSent,this.extensions.WebRTCStats.ssrc_audio_send.packetsLost,this.extensions.WebRTCStats.ssrc_audio_send.jitter,this.networkSendLevel))},WebrtcStatistics.prototype.processStatsError=function(F,B){var G=$.stringifyObject(B);this.logger.safe.error("webrtcStatistics error [".concat(F,"]: ").concat(G));var W=this.statsErrors.find((function(B){return B.error===G&&B.origin===F}));W?W.count++:this.statsErrors.push({origin:F,error:G,count:1}),this.statsErrors.length>ue&&this.statsErrors.splice(1)},WebrtcStatistics.prototype.getLastSampleInt=function(F){return"number"==typeof F?F:F&&parseInt(F[F.length-1])||0},WebrtcStatistics.prototype.getSsrcIdFromMultipleVideoStream=function(F){var B,G=this.extensions.WebRTCStats[X.default.MULTIPLE_RECV_STREAMS]||{};for(var W in G){var z=G[W];if(z&&z.googTrackId===F){B=W;break}}return B},W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"onDeviceEvent",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"onMaxCapabilitiesRequested",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"onMaxCapabilitiesApplied",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Number,String,Number,Number,Error,Number,String]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"addSubscriptionEvent",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processSimulcastStats",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processBandwidthStats",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processAudioStats",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[ae.default,Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processVideoStatsSend",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[ae.default,Object,Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processVideoStatsRecv",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processSharingStats",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processStreamsCounters",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"setMissedInitialPreferredResolution",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[String,Object,String]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"setPreferredResolution",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Boolean,String,String]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"setIsRendering",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Number]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"setReportedSendBandwidth",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Number]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"setMaxSessionBandwidth",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Boolean)],WebrtcStatistics.prototype,"setStartTime",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"calculateAverages",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object,Object,Array]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"addFilteredFields",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object,String]),z("design:returntype",Object)],WebrtcStatistics.prototype,"formatFields",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object,Object,Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"processSource",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object,Object,String,String]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"getWebrtcReport",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object,Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"constructWebRTCDataReport",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object,Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"constructWebRtcReportForSingleStream",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object,Object]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"constructWebRtcReportForMultipleStreams",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Object)],WebrtcStatistics.prototype,"selectSsrcsToCollect",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"calculateHwSilentState",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"calculateSpeakingState",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"calculateNetworkRecvQualityLevel",null),W([catchStatsErrors,z("design:type",Function),z("design:paramtypes",[]),z("design:returntype",void 0)],WebrtcStatistics.prototype,"calculateNetworkSendQualityLevel",null),WebrtcStatistics}();B.default=pe},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(8),z=function(){function WebRTCAudioHealedRatioTelemetry(F){this.networkDetectionDuration=F,this.healedRatio=0,this.healedRatioMax=0,this.healedRatioDuration=0,this.healedRatioTotal=0,this.totalSamplesReceivedDiff=0}return WebRTCAudioHealedRatioTelemetry.prototype.captureHealedRatioSamples=function(F,B,G){!F||!B||!G||F.length<=this.networkDetectionDuration||B.length<=this.networkDetectionDuration||G.length<=this.networkDetectionDuration||this.setHealedRatioPerDuration(F,B,G)},WebRTCAudioHealedRatioTelemetry.prototype.getHealedRatioMax=function(){return this.healedRatioMax},WebRTCAudioHealedRatioTelemetry.prototype.getHealedRatioAvg=function(){return this.healedRatioDuration?this.healedRatioTotal/this.healedRatioDuration:0},WebRTCAudioHealedRatioTelemetry.prototype.getHealedRatio=function(){return this.healedRatio},WebRTCAudioHealedRatioTelemetry.prototype.getTotalSamplesReceivedDiff=function(){return this.totalSamplesReceivedDiff},WebRTCAudioHealedRatioTelemetry.prototype.setHealedRatioPerDuration=function(F,B,G){var z=-1-this.networkDetectionDuration,K=Math.max((0,W.last)(F)-(0,W.nth)(F,z),0),J=Math.max((0,W.last)(B)-(0,W.nth)(B,z),0);this.totalSamplesReceivedDiff=Math.max((0,W.last)(G)-(0,W.nth)(G,z),0),0!==this.totalSamplesReceivedDiff&&(this.healedRatio=(K-J)/this.totalSamplesReceivedDiff,this.healedRatioDuration++,this.healedRatioTotal+=this.healedRatio,this.healedRatioMax=Math.max(this.healedRatioMax,this.healedRatio))},WebRTCAudioHealedRatioTelemetry}();B.default=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(142),z=G(1),K=G(4),J=G(143),Q=function(){function WebRTCAudioTelemetry(F){this.configProvider=F,this.audioAnalyzers=new Map,this.jitterDuration=0,this.jitterBufferTotal=0,this.rttDuration=0,this.rttTotal=0,this.rttMax=0,this.jitterMax=0,this.webrtcAudioPacketLossRate=new J.default(F.config.minPacketsReceivedToCalculatePacketLossRate)}return WebRTCAudioTelemetry.prototype.captureJitterBuffer=function(F){this.jitterDuration+=K.default.TIME_INTERVAL.SEC_1,this.jitterBufferTotal+=F},WebRTCAudioTelemetry.prototype.captureJitterMax=function(F){this.jitterMax=Math.max(F,this.jitterMax)},WebRTCAudioTelemetry.prototype.getAvgJitterBuffer=function(){return this.jitterDuration?Math.round(this.jitterBufferTotal/this.jitterDuration):0},WebRTCAudioTelemetry.prototype.capturePacketsLostAndPacketsReceived=function(F,B){this.webrtcAudioPacketLossRate.capturePacketsLostAndPacketsReceived(F,B)},WebRTCAudioTelemetry.prototype.getPacketsLostRateMax=function(){return this.webrtcAudioPacketLossRate.getPacketsLostRateMax()},WebRTCAudioTelemetry.prototype.getAvgPacketsLost=function(){return this.webrtcAudioPacketLossRate.getAvgPacketsLost()},WebRTCAudioTelemetry.prototype.captureRtt=function(F){if(null!==F){var B=parseInt(F);this.rttDuration+=K.default.TIME_INTERVAL.SEC_1,this.rttTotal+=B,this.rttMax=Math.max(this.rttMax,B)}},WebRTCAudioTelemetry.prototype.getAvgRtt=function(){return this.rttDuration?z.round(this.rttTotal/this.rttDuration,3):0},WebRTCAudioTelemetry.prototype.getMaxRtt=function(){return this.rttMax},WebRTCAudioTelemetry.prototype.getJitterMax=function(){return this.jitterMax},WebRTCAudioTelemetry.prototype.updateSendStream=function(F,B){var G;if(this.configProvider.config.useAudioAnalyzer){var z=this.audioAnalyzers.get(B);z&&(z.dispose(),this.audioAnalyzers.delete(B)),(null===(G=null==F?void 0:F.rawStream)||void 0===G?void 0:G.getAudioTracks().length)&&this.audioAnalyzers.set(B,new W.AudioStreamAnalyzer(F.rawStream))}},WebRTCAudioTelemetry.prototype.getInputLevel=function(F){var B=this.audioAnalyzers.get(F);return null==B?void 0:B.getInputLevel()},WebRTCAudioTelemetry}();B.default=Q},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.WebRTCBandwidthTelemetry=void 0;var z=G(4),K=G(1),J=function(){function WebRTCBandwidthTelemetry(F,B){var G=this;this.dropBadBandwidth=F,this.dropGoodBandwidth=B,this.dropDurationCounts={},Object.keys(z.default.HISTOGRAM_BATCH).forEach((function(F){G.dropDurationCounts[F]=0}))}return WebRTCBandwidthTelemetry.prototype.recordSendBandwidth=function(F){this.currentDropDuration&&F<this.dropGoodBandwidth||F<this.dropBadBandwidth?this.initiateDrop():this.currentDropDuration&&F>this.dropGoodBandwidth&&this.recoverDrop()},WebRTCBandwidthTelemetry.prototype.getReport=function(){var F=K.shallowClone(this.dropDurationCounts);return this.currentDropDuration&&(F.ongoingDuration=this.currentDropDuration),F},WebRTCBandwidthTelemetry.prototype.initiateDrop=function(){this.currentDropDuration?this.currentDropDuration++:this.currentDropDuration=1},WebRTCBandwidthTelemetry.prototype.recoverDrop=function(){var F,B;try{for(var G=W(Object.keys(z.default.HISTOGRAM_BATCH)),K=G.next();!K.done;K=G.next()){var J=K.value;if(this.currentDropDuration<=z.default.HISTOGRAM_BATCH[J]){this.dropDurationCounts[J]+=1,this.currentDropDuration=0;break}}}catch(B){F={error:B}}finally{try{K&&!K.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}},WebRTCBandwidthTelemetry}();B.WebRTCBandwidthTelemetry=J},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0});var z=G(8),K=G(50),J=G(393),Q=function(){function WebRTCNetworkQualityTelemetry(F,B,G){this.configProvider=F,this.newStatsApi=B,this.webrtcHealedRatio=G,this.jitterData=new K.SlidingWindow(this.configProvider.config.webrtcJitterWindowSize),this.packetsLostData=new K.SlidingWindow(this.configProvider.config.webrtcLossRateWindowSize);var W=Number(this.configProvider.config.webrtcStatNetworkDetectionHysteresis);this.networkDetectionBadLevelHigh=Number(this.configProvider.config.webrtcStatNetworkDetectionBadLevel)+W/2,this.networkDetectionBadLevelLow=this.networkDetectionBadLevelHigh-W,this.networkDetectionGoodLevelHigh=Number(this.configProvider.config.webrtcStatNetworkDetectionGoodLevel)+W/2,this.networkDetectionGoodLevelLow=this.networkDetectionGoodLevelHigh-W,this.jitterStateProcessor=new J.UfdTwoStateEventProcessor(F.config.webrtcJitterLowThreshold,F.config.webrtcJitterHighThreshold,!0,F.config.webrtcJitterSticknessTime),this.lossRateStateProcessor=new J.UfdTwoStateEventProcessor(F.config.webrtcLossRateLowThreshold,F.config.webrtcLossRateHighThreshold,!0,F.config.webrtcLossRateSticknessTime)}return WebRTCNetworkQualityTelemetry.prototype.calculateNetworkSendQualityLevel=function(F,B,G,K){if(!F||!B)return K;if(F.length<2||B.length<2||(0,z.last)(F)<this.configProvider.config.webrtcMinPacketsSentForNetworkSendQuality)return K;var J=Date.now(),Q=this.getLatestSendQuality(G,this.jitterData,this.jitterStateProcessor,J,K),Y=W(F.slice(-2),2),$=Y[0],X=Y[1],Z=W(B.slice(-2),2),ee=Z[0],te=Z[1],ne=this.getAverageLossRate(X,$,te,ee),ie=this.getLatestSendQuality(ne,this.packetsLostData,this.lossRateStateProcessor,J,K);return"Good"===Q&&"Good"===ie?"Good":"Bad"},WebRTCNetworkQualityTelemetry.prototype.calculateNetworkRecvQualityLevel=function(F){if(this.newStatsApi){var B=F;return this.calculateNetworkRecvQualityLevelNewStatsApi(B.concealedSamples,B.silentConcealedSamples,B.totalSamplesReceived,B.oldNetworkLevel)}var G=F;return this.calculateNetworkRecvQualityLevelLegacyStatsApi(G.googDecodingCTN,G.googDecodingPLC,G.oldNetworkLevel)},WebRTCNetworkQualityTelemetry.prototype.calculateNetworkRecvQualityLevelLegacyStatsApi=function(F,B,G){var W=this.configProvider.config.webrtcStatNetworkDetectionDuration;if(!F||!B||F.length<2*W)return G;for(var z=F.length-1-W,K=F[F.length-1];z>=0&&K-F[z]<100*W;)z--;if(z<0)return G;var J=K-F[z],Q=B[B.length-1]-B[z];if(J<=0)return G;var Y=Q/J;return this.getRecvQuality(Y,G)},WebRTCNetworkQualityTelemetry.prototype.calculateNetworkRecvQualityLevelNewStatsApi=function(F,B,G,W){var K=this.configProvider.config.webrtcStatNetworkDetectionDuration;return!F||F.length<=K||!B||B.length<=K||!G||G.length<=K||(0,z.last)(G)<this.configProvider.config.webrtcMinAudioSamplesRecvForNetworkRecvQuality||0===this.webrtcHealedRatio.getTotalSamplesReceivedDiff()?W:this.getRecvQuality(this.webrtcHealedRatio.getHealedRatio(),W)},WebRTCNetworkQualityTelemetry.prototype.getRecvQuality=function(F,B){return F<this.networkDetectionGoodLevelLow?"Good":F<this.networkDetectionGoodLevelHigh?"Good"===B?"Good":"Poor":F<this.networkDetectionBadLevelLow?"Poor":F<this.networkDetectionBadLevelHigh?"Bad"===B?"Bad":"Poor":"Bad"},WebRTCNetworkQualityTelemetry.prototype.getLatestSendQuality=function(F,B,G,W,K){if(B.add(F),B.isFull){var J=(0,z.mean)(B.items);return G.onSample(J,W)}return K},WebRTCNetworkQualityTelemetry.prototype.getAverageLossRate=function(F,B,G,W){var z=F-B,K=G-W;return z>0&&K>0?K/z:0},WebRTCNetworkQualityTelemetry}();B.default=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.UfdTwoStateEventProcessor=void 0;var W=function(){function UfdTwoStateEventProcessor(F,B,G,W){this.lowThreshold=F,this.highThreshold=B,this.isLowerBetter=G,this.curInLowerRange=G,this.stateTracker=new z(W)}return UfdTwoStateEventProcessor.prototype.onSample=function(F,B){var G=this.curInLowerRange;this.curInLowerRange?F>this.highThreshold&&(G=!1):F<this.lowThreshold&&(G=!0);var W=this.stateTracker.onNewState(this.getQuality(G),B);return W!==this.getQuality(this.curInLowerRange)&&(this.curInLowerRange=G),W},UfdTwoStateEventProcessor.prototype.getQuality=function(F){return F===this.isLowerBetter?"Good":"Bad"},UfdTwoStateEventProcessor}();B.UfdTwoStateEventProcessor=W;var z=function(){function UfdTwoStateTracker(F){this.sticknessTime=F}return UfdTwoStateTracker.prototype.onNewState=function(F,B){return"Good"!==F&&"Bad"!==F?this.curState:0===this.sticknessTime?F:F===this.curState?(this.stickTimerStarted=0,this.curState):("Bad"===this.curState?0===this.stickTimerStarted?this.stickTimerStarted=B:B-this.stickTimerStarted>this.sticknessTime&&(this.curState=F,this.stickTimerStarted=0):(this.curState=F,this.stickTimerStarted=0),this.curState)},UfdTwoStateTracker}()},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.WebrtcStabilizationTelemetry=void 0;var W=G(50),z=G(1),K=G(4),J=G(10),Q=function(){function WebrtcStabilizationTelemetry(F,B,G){this.slidingWindowSize=F,this.maxDeviation=B,this.minBandwidth=G,this.slidingWindow=new W.SlidingWindow(this.slidingWindowSize),this.currentModality=null,this.previousModality=null,this.inProcess=!1}return WebrtcStabilizationTelemetry.prototype.processSendBandwidth=function(F,B,G){this.currentModality?this.handleStopEvent(B,G):this.handleStartEvent(B,G),this.inProcess&&(this.stabilizationTime++,this.slidingWindow.add(F),this.inProcess=!this.slidingWindow.isFull||!this.isBandwidthStable())},WebrtcStabilizationTelemetry.prototype.getReport=function(F){if(void 0===F&&(F=!1),void 0!==this.stabilizationTime)return{time:this.inProcess?this.stabilizationTime:Math.max(this.stabilizationTime-this.slidingWindowSize,0),bandwidth:F?(0,z.round)(this.averageBandwidth,2):this.averageBandwidth,finished:!this.inProcess,modality:this.previousModality}},WebrtcStabilizationTelemetry.prototype.handleStartEvent=function(F,B){this.currentModality=this.GetModalityString(F),B&&this.currentModality&&!this.previousModality&&(this.previousModality=this.currentModality,this.stabilizationTime=0,this.slidingWindow.clear(),this.inProcess=!0)},WebrtcStabilizationTelemetry.prototype.handleStopEvent=function(F,B){B&&((0,J.hasSendDirectionality)(F.video)||(0,J.hasSendDirectionality)(F.sharing))||(this.currentModality=null,this.inProcess=!1)},WebrtcStabilizationTelemetry.prototype.GetModalityString=function(F){return[(0,J.hasSendDirectionality)(F.video)?K.default.MODALITY.video:null,(0,J.hasSendDirectionality)(F.sharing)?K.default.MODALITY.sharing:null].filter(Boolean).join(", ")},WebrtcStabilizationTelemetry.prototype.isBandwidthStable=function(){if(this.averageBandwidth=(0,z.average)(this.slidingWindow.items),this.averageBandwidth<this.minBandwidth)return!1;var F=this.averageBandwidth*this.maxDeviation,B=this.averageBandwidth-F,G=this.averageBandwidth+F;return this.slidingWindow.items.every((function(F){return(0,z.isInRange)(F,B,G)}))},WebrtcStabilizationTelemetry}();B.WebrtcStabilizationTelemetry=Q},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},K=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.WebRTCQualityLimitationTelemetry=void 0;var J=function(){function WebRTCQualityLimitationTelemetry(F){this.configProvider=F,this.qualityLimitationReasonEvents=[]}return WebRTCQualityLimitationTelemetry.prototype.setQualityLimitationReason=function(F){this.lastQualityLimitationReason!==F&&this.qualityLimitationReasonEvents.push({event:F,startTime:Date.now(),endTime:Date.now()}),this.qualityLimitationReasonEvents.length>this.configProvider.config.maxStoredQualityLimitationReasonEvents&&this.qualityLimitationReasonEvents.shift(),this.lastQualityLimitationReason=F},WebRTCQualityLimitationTelemetry.prototype.getQualityLimitationReasonEvents=function(){var F=this;return this.qualityLimitationReasonEvents.reduce((function(B,G,J){var Q,Y;return"none"===G.event?B:K(K([],z(B),!1),[W(W({},G),{endTime:null!==(Y=null===(Q=F.qualityLimitationReasonEvents[J+1])||void 0===Q?void 0:Q.startTime)&&void 0!==Y?Y:Date.now()})],!1)}),[])},WebRTCQualityLimitationTelemetry}();B.WebRTCQualityLimitationTelemetry=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(4),z=function(){function WebRTCVideoBitrateTelemetry(){var F;this.bitrateData=((F={})[W.default.MEDIA_DIRECTION.SEND]={lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0,allocateBW:0,allocateBWSamples:0},F[W.default.MEDIA_DIRECTION.RECV]={lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0},F)}return WebRTCVideoBitrateTelemetry.prototype.captureSample=function(F,B){var G=Date.now()/1e3;if(0!==this.bitrateData[F].lastTimestamp&&B>this.bitrateData[F].lastBytes){var W=G-this.bitrateData[F].lastTimestamp,z=8*(B-this.bitrateData[F].lastBytes)/W;this.onBitrateSample(F,z)}this.bitrateData[F].lastTimestamp=G,this.bitrateData[F].lastBytes=B},WebRTCVideoBitrateTelemetry.prototype.getMax=function(F){return Math.round(this.bitrateData[F].maxSample)},WebRTCVideoBitrateTelemetry.prototype.getAvg=function(F){return 0===this.bitrateData[F].nSamples?0:Math.round(this.bitrateData[F].bitrateTotal/this.bitrateData[F].nSamples)},WebRTCVideoBitrateTelemetry.prototype.stopCapture=function(F){this.bitrateData[F].lastBytes=0,this.bitrateData[F].lastTimestamp=0},WebRTCVideoBitrateTelemetry.prototype.onBitrateSample=function(F,B){B>this.bitrateData[F].maxSample&&(this.bitrateData[F].maxSample=B),this.bitrateData[F].bitrateTotal+=B,this.bitrateData[F].nSamples++},WebRTCVideoBitrateTelemetry.prototype.captureAllocateBandwidth=function(F){if(F){var B=parseInt(F[F.length-1]);this.bitrateData[W.default.MEDIA_DIRECTION.SEND].allocateBW+=B,this.bitrateData[W.default.MEDIA_DIRECTION.SEND].allocateBWSamples+=1}},WebRTCVideoBitrateTelemetry.prototype.getAllocateBandwidthAvg=function(){var F=this.bitrateData[W.default.MEDIA_DIRECTION.SEND].allocateBW,B=this.bitrateData[W.default.MEDIA_DIRECTION.SEND].allocateBWSamples;if(F>0&&B>0)return Math.floor(F/B)},WebRTCVideoBitrateTelemetry}();B.default=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.CapabilitiesApplicationSequence=void 0;var W=function(){function CapabilitiesApplicationSequence(F,B){this.maxAppliedCapabilitiesCount=B,this.events=[],this.events.push({eventType:"req",timestamp:Date.now(),capabilities:F.capabilities,isSimulcast:F.isSimulcastEnabled})}return CapabilitiesApplicationSequence.prototype.setMaxCapabilitiesApplied=function(F){this.events.push({eventType:"app",timestamp:Date.now(),capabilities:F.capabilities,error:F.error||"none"}),this.maxAppliedCapabilitiesCount&&this.events.length>this.maxAppliedCapabilitiesCount+1&&this.events.splice(1,1)},CapabilitiesApplicationSequence.prototype.getEvents=function(){return this.events},CapabilitiesApplicationSequence}();B.CapabilitiesApplicationSequence=W;var z=function(){function WebRTCVideoMaxCapabilitiesTelemetry(F,B){this.configProvider=F,this.logger=B,this.events=[]}return WebRTCVideoMaxCapabilitiesTelemetry.prototype.setMaxCapabilitesRequested=function(F){var B=new W(F,this.configProvider.config.webrtcLastAppliedVideoCapabilitiesCount);this.events.push({causeId:F.causeId,seq:B}),this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.length>this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.shift()},WebRTCVideoMaxCapabilitiesTelemetry.prototype.setMaxCapabilitesApplied=function(F){var B=this.events.find((function(B){return B.causeId===F.causeId}));B?B.seq.setMaxCapabilitiesApplied(F):this.logger.safe.warn("Requested capabilities with id ".concat(F.causeId," not found"))},WebRTCVideoMaxCapabilitiesTelemetry.prototype.getEvents=function(){var F=[];return this.events.forEach((function(B){F.push({causeId:B.causeId,events:B.seq.getEvents()})})),F},WebRTCVideoMaxCapabilitiesTelemetry}();B.default=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(4),z=function(){function WebRTCVideoDelayTelemetry(){this.delayCur=[],this.delayTotal=0,this.delayEventCount=0}return WebRTCVideoDelayTelemetry.prototype.analyzeDelay=function(F,B){if(B&&""!==B){this.delayCur.length===F&&this.delayCur.shift();var G=parseInt(B);this.delayCur.push(G),this.delayTotal+=G,this.delayEventCount+=W.default.TIME_INTERVAL.SEC_1}},WebRTCVideoDelayTelemetry.prototype.getDelayCur=function(){if(this.delayCur.length>0){var F=this.delayCur.reduce((function(F,B){return F+B}))/this.delayCur.length;return F<0?0:F}},WebRTCVideoDelayTelemetry.prototype.getDelayAvg=function(){if(this.delayEventCount>0&&this.delayTotal>0){var F=this.delayTotal/this.delayEventCount;return F<0?0:F}},WebRTCVideoDelayTelemetry}();B.default=z},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0});var z=G(4),K=function(){function WebRTCVideoFreezeTelemetry(F,B){var G=this;this.configProvider=F,this.startTime=B,this.recvTotalFreezeDuration=-1,this.recvFreezeDurations=[],this.recvFreezeIsOngoing=!1,this.recvCurrentFreezeDuration=0,this.recvFreezeCount=0,this.receiveFreezeDurationCounts={},this.longestRecvFreezeDuration=0,this.sendCameraFreezeIntervalsCount=0,this.previousInputFrame=0,this.recvCurrentFreezeStartTimestamp=0,this.receiveFreezeDurationTimestamps={},this.finalFreezeIsOngoing=!1,this.finalRecvCurrentFreezeDuration=0,this.mediaStarted=!1,this.lastBytesRecv=0,this.currentLowBitrateDuration=0,Object.keys(z.default.HISTOGRAM_BATCH).forEach((function(F){G.receiveFreezeDurationCounts[F]=0,G.receiveFreezeDurationTimestamps[F]=[]}))}return WebRTCVideoFreezeTelemetry.prototype.gatherFreezeData=function(F){var B=F.frameRateDecoded,G=F.frameRateRecv,W=F.bytesReceived,K=F.mediaType;if(void 0!==W&&"ScreenShare"!==K&&this.configProvider.config.isBytesRecvUsedInIsRenderingCalculation&&!this.configProvider.config.isRenderingBasedOnRawStatistics&&this.calculateBitrate(W),B){var J=parseInt(B[B.length-1],10),Q=(null==G?void 0:G.length)>0?parseInt(G[G.length-1],10):void 0;-1===this.recvTotalFreezeDuration&&(this.recvTotalFreezeDuration=0),J>0&&(this.mediaStarted=!0),0!==J&&0!==Q||!this.mediaStarted?J>0&&(void 0===Q||Q>0)&&this.recvFreezeIsOngoing&&this.stopRecvDataGathering(!1):(this.recvFreezeIsOngoing||(this.recvCurrentFreezeStartTimestamp=Date.now()-this.startTime),this.recvFreezeIsOngoing=!0,this.recvCurrentFreezeDuration+=z.default.TIME_INTERVAL.SEC_1,this.recvTotalFreezeDuration+=z.default.TIME_INTERVAL.SEC_1)}},WebRTCVideoFreezeTelemetry.prototype.getIsRendering=function(F){return this.recvCurrentFreezeDuration<F&&this.currentLowBitrateDuration<F&&this.mediaStarted},WebRTCVideoFreezeTelemetry.prototype.detectCaptureFreeze=function(F){if(F){var B=parseInt(F[F.length-1],10);this.previousInputFrame>0&&0===B&&(this.sendCameraFreezeIntervalsCount+=1),this.previousInputFrame=B}},WebRTCVideoFreezeTelemetry.prototype.getSendCameraFreezeIntervals=function(){return this.sendCameraFreezeIntervalsCount>0?this.sendCameraFreezeIntervalsCount:void 0},WebRTCVideoFreezeTelemetry.prototype.stopRecvDataGathering=function(F){void 0===F&&(F=!0),this.finalFreezeIsOngoing=this.recvFreezeIsOngoing,this.recvFreezeIsOngoing=!1,F&&(this.mediaStarted=!1),this.recvCurrentFreezeDuration>0&&(this.populateLongestRecvFreezeDuration(),this.populateRecvFreezeDurationCounts(),this.recvFreezeDurations.push(this.recvCurrentFreezeDuration),this.recvFreezeCount+=1),this.finalRecvCurrentFreezeDuration=this.recvCurrentFreezeDuration,this.recvCurrentFreezeDuration=0},WebRTCVideoFreezeTelemetry.prototype.getRecvFreezeDurationCounts=function(){return this.recvFreezeCount>0?JSON.stringify(this.receiveFreezeDurationCounts):void 0},WebRTCVideoFreezeTelemetry.prototype.getRecvFreezeDurationTimestamps=function(F){var B=this;if(0!==this.recvFreezeCount){var G={};return Object.keys(this.receiveFreezeDurationTimestamps).forEach((function(W){var z=B.receiveFreezeDurationTimestamps[W].length;G[W]=z>F?B.receiveFreezeDurationTimestamps[W].slice(z-F):B.receiveFreezeDurationTimestamps[W]})),JSON.stringify(G)}},WebRTCVideoFreezeTelemetry.prototype.getRecvFreezeIsOngoing=function(F){return this.finalRecvCurrentFreezeDuration>=F&&this.finalFreezeIsOngoing},WebRTCVideoFreezeTelemetry.prototype.getRecvTotalFreezeDuration=function(){return this.recvTotalFreezeDuration>=0?this.recvTotalFreezeDuration:void 0},WebRTCVideoFreezeTelemetry.prototype.getRecvAvgFreezeDuration=function(){if(this.recvTotalFreezeDuration>0&&this.recvFreezeCount>0)return this.recvTotalFreezeDuration/this.recvFreezeCount},WebRTCVideoFreezeTelemetry.prototype.getLongestRecvFreezeDuration=function(){return this.longestRecvFreezeDuration>0?this.longestRecvFreezeDuration:void 0},WebRTCVideoFreezeTelemetry.prototype.populateRecvFreezeDurationCounts=function(){var F,B;try{for(var G=W(Object.keys(z.default.HISTOGRAM_BATCH)),K=G.next();!K.done;K=G.next()){var J=K.value;if(this.recvCurrentFreezeDuration<=z.default.HISTOGRAM_BATCH[J]){this.receiveFreezeDurationCounts[J]+=1,this.receiveFreezeDurationTimestamps[J].push(this.recvCurrentFreezeStartTimestamp);break}}}catch(B){F={error:B}}finally{try{K&&!K.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}this.recvCurrentFreezeStartTimestamp=0},WebRTCVideoFreezeTelemetry.prototype.populateLongestRecvFreezeDuration=function(){this.recvCurrentFreezeDuration>this.longestRecvFreezeDuration&&(this.longestRecvFreezeDuration=this.recvCurrentFreezeDuration)},WebRTCVideoFreezeTelemetry.prototype.calculateBitrate=function(F){var B=125,G=(F-this.lastBytesRecv)/B;this.lastBytesRecv=F,G<this.configProvider.config.notRenderingLowBitrateThreshold?this.currentLowBitrateDuration++:this.currentLowBitrateDuration=0},WebRTCVideoFreezeTelemetry}();B.default=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(4),z=function(){function WebRTCVideoGeneralTelemetry(){var F;this.mediaData=((F={})[W.default.MEDIA_DIRECTION.SEND]={totalMediaDuration:-1,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0},F[W.default.MEDIA_DIRECTION.RECV]={totalMediaDuration:-1,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0,lastDecodedFrameTime:-1,fpsHarmonicAverageSumDecFrameDeltaTs:0,fpsHarmonicAverageSumSquareDecFrameDeltaTs:0},F),this.gatheringSendData=!1}return WebRTCVideoGeneralTelemetry.prototype.captureMediaData=function(F,B,G){var z=this.mediaData[F];if(F===W.default.MEDIA_DIRECTION.SEND&&(this.gatheringSendData=!0),B){var K=parseInt(B[B.length-1],10);z.totalFrameCount+=K}if(G){-1===z.totalMediaDuration&&(z.totalMediaDuration=0);var J=parseInt(G[G.length-1],10);z.mediaStarted||J>0&&(z.mediaStarted=!0,z.mediaStartTimestamp=new Date)}if(F===W.default.MEDIA_DIRECTION.RECV){J=G&&parseInt(G[G.length-1],10);var Q=Date.now();if(z.lastDecodedFrameTime<0&&(z.lastDecodedFrameTime=Q-1e3),J>0){var Y=(Q-z.lastDecodedFrameTime)/J;z.fpsHarmonicAverageSumDecFrameDeltaTs+=Y,z.fpsHarmonicAverageSumSquareDecFrameDeltaTs+=Y*Y,z.lastDecodedFrameTime=Q}}z.mediaStarted&&(z.totalMediaDuration+=W.default.TIME_INTERVAL.SEC_1)},WebRTCVideoGeneralTelemetry.prototype.captureFrameRate=function(F){var B=this.mediaData[W.default.MEDIA_DIRECTION.SEND];if(F){var G=parseInt(F[F.length-1],10);B.cameraFrameRate+=G}},WebRTCVideoGeneralTelemetry.prototype.stopRecvDataGathering=function(){var F=this.mediaData[W.default.MEDIA_DIRECTION.RECV],B=(new Date).getTime();F.timeSinceLastDecode=F.totalMediaDuration>0?Math.round((B-F.mediaStartTimestamp.getTime())/1e3):0,F.mediaStarted=!1},WebRTCVideoGeneralTelemetry.prototype.isGatheringSendData=function(){return this.gatheringSendData},WebRTCVideoGeneralTelemetry.prototype.stopSendDataGathering=function(){var F=this.mediaData[W.default.MEDIA_DIRECTION.SEND],B=new Date;F.timeSinceLastDecode=F.totalMediaDuration>0?Math.round((B.getTime()-F.mediaStartTimestamp.getTime())/1e3):0,this.gatheringSendData=!1,F.mediaStarted=!1},WebRTCVideoGeneralTelemetry.prototype.getAvgFrameRate=function(F){var B=this.mediaData[F];if(B.totalMediaDuration>0&&B.totalFrameCount>0)return B.totalFrameCount/B.totalMediaDuration},WebRTCVideoGeneralTelemetry.prototype.getTotalDuration=function(F){var B=this.mediaData[F];return B.totalMediaDuration>=0?B.totalMediaDuration:void 0},WebRTCVideoGeneralTelemetry.prototype.getRecvFpsHarmonicAverage=function(){var F=this.mediaData[W.default.MEDIA_DIRECTION.RECV];return F.fpsHarmonicAverageSumSquareDecFrameDeltaTs>0?1e3*F.fpsHarmonicAverageSumDecFrameDeltaTs/F.fpsHarmonicAverageSumSquareDecFrameDeltaTs:void 0},WebRTCVideoGeneralTelemetry.prototype.getTimeSinceLastDecode=function(F){var B=this.mediaData[F];return B.timeSinceLastDecode>0?B.timeSinceLastDecode:void 0},WebRTCVideoGeneralTelemetry.prototype.getSendCameraFramerate=function(){var F=this.mediaData[W.default.MEDIA_DIRECTION.SEND];if(F.totalMediaDuration>0)return F.cameraFrameRate/F.totalMediaDuration},WebRTCVideoGeneralTelemetry}();B.default=z},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.KeyFrameEventHistBuilder=B.WebRTCVideoKeyFrameMonitor=void 0;var z=G(4),K=function(){function WebRTCVideoKeyFrameMonitor(F,B){this.configProvider=F,this.logger=B,this.statsBuilder=new J(this.configProvider),this.lastUnansweredRequestReason="None",this.previousKeyFrameData={kfEncoded:0,fir:0,pli:0}}return WebRTCVideoKeyFrameMonitor.prototype.dispose=function(){this.lastUnansweredRequestTimestamp=null,this.lastUnansweredRequestReason="None"},WebRTCVideoKeyFrameMonitor.prototype.setKeyFrameRequested=function(F){this.lastUnansweredRequestTimestamp||(this.lastUnansweredRequestTimestamp=Date.now(),this.lastUnansweredRequestReason=F,this.logger.safe.debug("Key frame requested for reason: ".concat(F)))},WebRTCVideoKeyFrameMonitor.prototype.setKeyFrameData=function(F){var B=this.getReasonIfKeyFrameRequested(F);"None"!==B&&this.setKeyFrameRequested(B),this.setKeyFramesEncoded(F.kfEncoded),this.previousKeyFrameData=F},WebRTCVideoKeyFrameMonitor.prototype.flush=function(){this.previousKeyFrameData={kfEncoded:0,fir:0,pli:0},this.setKeyFrameSent()},WebRTCVideoKeyFrameMonitor.prototype.getStats=function(){return this.flush(),this.statsBuilder.getStats()},WebRTCVideoKeyFrameMonitor.prototype.getKeyFrameLongestDelay=function(){return this.statsBuilder.keyFrameLongestDelay},WebRTCVideoKeyFrameMonitor.prototype.getReasonIfKeyFrameRequested=function(F){return F.fir-this.previousKeyFrameData.fir>0?"FIR":F.pli-this.previousKeyFrameData.pli>0?"PLI":"None"},WebRTCVideoKeyFrameMonitor.prototype.setKeyFramesEncoded=function(F){F-this.previousKeyFrameData.kfEncoded>0&&this.setKeyFrameSent()},WebRTCVideoKeyFrameMonitor.prototype.setKeyFrameSent=function(){if("None"!==this.lastUnansweredRequestReason){var F={timestamp:this.lastUnansweredRequestTimestamp,reason:this.lastUnansweredRequestReason,duration:(Date.now()-this.lastUnansweredRequestTimestamp)/1e3};F.duration>=1&&(this.statsBuilder.append(F),this.statsBuilder.keyFrameLongestDelay=F.duration,this.logger.safe.debug("Key frame sent ".concat(JSON.stringify(F)))),this.lastUnansweredRequestTimestamp=null,this.lastUnansweredRequestReason="None"}},WebRTCVideoKeyFrameMonitor}();B.WebRTCVideoKeyFrameMonitor=K;var J=function(){function KeyFrameEventHistBuilder(F){var B=this;this.configProvider=F,this.hist={},this.timestamps={},this.currentKeyFrameLongestDelay=0,Object.keys(z.default.HISTOGRAM_BATCH).forEach((function(F){B.hist[F]=0,B.timestamps[F]=[]}))}return Object.defineProperty(KeyFrameEventHistBuilder.prototype,"keyFrameLongestDelay",{get:function(){return this.currentKeyFrameLongestDelay},set:function(F){this.currentKeyFrameLongestDelay<F&&(this.currentKeyFrameLongestDelay=F)},enumerable:!1,configurable:!0}),KeyFrameEventHistBuilder.prototype.append=function(F){var B,G;try{for(var K=W(Object.keys(z.default.HISTOGRAM_BATCH)),J=K.next();!J.done;J=K.next()){var Q=J.value;if(F.duration<=z.default.HISTOGRAM_BATCH[Q]){this.hist[Q]+=1,this.timestamps[Q].push(F.timestamp),this.timestamps[Q].length>this.configProvider.config.maxKeyFrameTimestampsInBucket&&this.timestamps[Q].shift();break}}}catch(F){B={error:F}}finally{try{J&&!J.done&&(G=K.return)&&G.call(K)}finally{if(B)throw B.error}}},KeyFrameEventHistBuilder.prototype.getStats=function(){return{hist:this.hist,ts:this.timestamps}},KeyFrameEventHistBuilder}();B.KeyFrameEventHistBuilder=J},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var K=G(1),J={fs:0,fps:1},Q=function(){function WebRTCVideoOvershootTelemetry(F){this.logger=F,this.allowed=new Map,this.lastParams=new Map,this.currentEvents=new Map,this.finishedEvents=[]}return WebRTCVideoOvershootTelemetry.prototype.setMaxCapabilities=function(F){var B=this;F.forEach((function(F){if(F.ssrc||0===F.ssrc){B.finishIfActive(F.ssrc),B.allowed.set(F.ssrc,{fs:F.maxFs+J.fs,fps:F.maxFps+J.fps});var G=B.lastParams.get(F.ssrc);G&&B.setCurrentParams(F.ssrc,G.fs,G.fps)}}))},WebRTCVideoOvershootTelemetry.prototype.setCurrentParams=function(F,B,G){this.lastParams.set(F,{fs:B,fps:G});var W=this.getAllowedParams(F);W&&(B>W.fs||G>W.fps)?(this.captureOvershoot(F,G,W.fps,"fps"),this.captureOvershoot(F,B,W.fs,"fs")):W&&this.finishIfActive(F)},WebRTCVideoOvershootTelemetry.prototype.flush=function(){var F=this;this.currentEvents.forEach((function(B,G){return F.finishIfActive(G)}))},WebRTCVideoOvershootTelemetry.prototype.getEvents=function(){var F=z([],W(K.deepClone(this.finishedEvents)),!1),B=Date.now();return this.currentEvents.forEach((function(G){return G.forEach((function(G){return F.push({ssrc:G.ssrc,timestamp:G.timestamp,duration:B-G.timestamp,overshootType:G.overshootType,amount:G.amount})}))})),F},WebRTCVideoOvershootTelemetry.prototype.captureOvershoot=function(F,B,G,W){var z=this.currentEvents.get(F)||[],K=z.findIndex((function(F){return F.overshootType===W})),Q=z[K],Y=B-G,$=J[W];Y<=$&&Q?(Q.duration=Date.now()-Q.timestamp,this.finishedEvents.push(Q),this.logger.debug("stopped overshooting ".concat(W," by ").concat(Q.amount)),z.splice(K,1)):Y>$&&!Q?(this.logger.safe.info("overshooting ".concat(W," by ").concat(B-G)),z.push({ssrc:F,timestamp:Date.now(),duration:-1,overshootType:W,amount:{min:Y,max:Y}})):Y>$&&Q&&(Q.amount={min:Math.min(Q.amount.min,Y),max:Math.max(Q.amount.max,Y)}),z.length?this.currentEvents.set(F,z):this.currentEvents.has(F)&&this.currentEvents.delete(F)},WebRTCVideoOvershootTelemetry.prototype.getAllowedParams=function(F){var B=this.allowed.get(F);return B||this.allowed.get(0)},WebRTCVideoOvershootTelemetry.prototype.finishIfActive=function(F){var B=this,G=this.currentEvents.get(F);if(G){var W=Date.now();G.forEach((function(F){F.duration=W-F.timestamp,B.finishedEvents.push(F),B.logger.debug("finished overshooting ".concat(F.overshootType," by ").concat(F.amount))})),this.currentEvents.delete(F)}},WebRTCVideoOvershootTelemetry}();B.default=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(4),z=function(){function WebRTCVideoQPEvents(){var F;this.qpData=((F={})[W.default.MEDIA_DIRECTION.SEND]={frames:0,qpSum:0},F[W.default.MEDIA_DIRECTION.RECV]={frames:0,qpSum:0},F)}return WebRTCVideoQPEvents.prototype.captureQpData=function(F,B,G){var W=this.qpData[F];if(G&&G.length>0){var z=parseInt(G[G.length-1],10);z>0&&(W.frames=z)}if(B){var K=parseInt(B,10);K>0&&(W.qpSum=K)}},WebRTCVideoQPEvents.prototype.getQpAverage=function(F){var B=this.qpData[F];if(B.qpSum>0&&B.frames>0)return B.qpSum/B.frames},WebRTCVideoQPEvents}();B.default=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(1),z=function(){function WebRTCVideoResolutionTelemetry(){this.resolutionChangedCount=0,this.resDurations={},this.preferredResolutionDurations={},this.preferredResolutions=[]}return Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,"resolutionSwitchCount",{get:function(){return this.resolutionChangedCount},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,"resolutionDurationRatios",{get:function(){return this.countResolutionDurationRatio(this.resDurations)},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,"preferredResolutionDurationRatios",{get:function(){return this.countResolutionDurationRatio(this.preferredResolutionDurations)},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,"preferredResolution",{get:function(){return this.preferredResolutions},enumerable:!1,configurable:!0}),WebRTCVideoResolutionTelemetry.prototype.captureSample=function(F){F&&F.width&&F.height&&(this.isResolutionChanged(this.lastResolution,F)&&this.resolutionChanged(F),this.updateResolutionDuration(this.getResolutionKey(F),this.resDurations)),this.lastPreferredResolution&&this.updatePreferredResolutionDurations()},WebRTCVideoResolutionTelemetry.prototype.capturePreferredResolution=function(F,B){var G=this.getResolutionKey(F);this.preferredResolution.includes(G)||(this.preferredResolutions.length>=B&&this.preferredResolutions.shift(),this.preferredResolutions.push(G)),this.isResolutionChanged(this.lastPreferredResolution,F)&&(this.preferredResolutionChanged(F),this.updatePreferredResolutionDurations())},WebRTCVideoResolutionTelemetry.prototype.getResolutionKey=function(F){return"".concat(F.width,"x").concat(F.height)},WebRTCVideoResolutionTelemetry.prototype.isResolutionChanged=function(F,B){return!F||F.width!==B.width||F.height!==B.height},WebRTCVideoResolutionTelemetry.prototype.countResolutionDurationRatio=function(F){var B={},G=0;for(var z in F)G+=F[z];for(var z in F)B[z]=(0,W.round)(F[z]/G*100,2);return B},WebRTCVideoResolutionTelemetry.prototype.updatePreferredResolutionDurations=function(){this.updateResolutionDuration(this.getResolutionKey(this.lastPreferredResolution),this.preferredResolutionDurations)},WebRTCVideoResolutionTelemetry.prototype.updateResolutionDuration=function(F,B){B[F]||(B[F]=0),B[F]++},WebRTCVideoResolutionTelemetry.prototype.preferredResolutionChanged=function(F){this.lastPreferredResolution=F},WebRTCVideoResolutionTelemetry.prototype.resolutionChanged=function(F){this.lastResolution=F,this.resolutionChangedCount++},WebRTCVideoResolutionTelemetry}();B.default=z},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var K=function(){function WebRTCVideoStreamsCounters(){this.streamsTimers={}}return WebRTCVideoStreamsCounters.prototype.countRecvStreams=function(F){var B="".concat(F);this.streamsTimers.hasOwnProperty(B)||(this.streamsTimers[B]=0),this.streamsTimers[B]++},WebRTCVideoStreamsCounters.prototype.getStreamCounts=function(){var F=this,B={min:void 0,max:void 0,mode:void 0},G=Object.keys(this.streamsTimers).map(Number);return 0===G.length||1===G.length&&0===G[0]||(B.min=Math.min.apply(Math,z([],W(G.filter((function(F){return F>0}))),!1)),B.max=Math.max.apply(Math,z([],W(G),!1)),B.mode=G.reduce((function(B,G){return F.streamsTimers[G]>F.streamsTimers[B]?G:B}),G[0])),B},WebRTCVideoStreamsCounters}();B.default=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function WebRTCVideoSubscriptionEvents(F){this.configProvider=F,this.subscriptionEvents=[]}return WebRTCVideoSubscriptionEvents.prototype.addSubscriptionEvent=function(F){this.subscriptionEvents.length>this.configProvider.config.webrtcSubscriptionEventLimit&&this.subscriptionEvents.shift(),this.subscriptionEvents.push(F)},WebRTCVideoSubscriptionEvents.prototype.getSubscriptionEvents=function(){return this.subscriptionEvents.length>0?{events:this.subscriptionEvents}:void 0},WebRTCVideoSubscriptionEvents}();B.default=W},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0});var J=G(4),Q=G(1),Y=G(145),$=Symbol("mslbase"),X=Symbol("mslsamples"),Z=function(){function SimulcastStatistics(F,B){this.logger=F,this.configProvider=B,this.currentLayouts={},this.collectedModalitySessions=[],this.startTimestamp=Date.now()}return Object.defineProperty(SimulcastStatistics.prototype,"collectedSessions",{get:function(){return this.collectedModalitySessions},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastStatistics.prototype,"highestFidelitySSRC",{get:function(){if(this.currentModalitySession){var F;for(var B in this.currentLayouts)F=this.getHigherFidelitySSRC(B,F);return parseInt(F)}},enumerable:!1,configurable:!0}),SimulcastStatistics.prototype.processStats=function(F){var B,G=this,W=Object.values(null!==(B=F.ssrc)&&void 0!==B?B:{}).filter((function(F){var B;return F.rid&&F.ssrc&&F.googFrameHeightInput&&(null===(B=G.lastMaxCapabilitiesEvent)||void 0===B?void 0:B.capabilities.some((function(B){return B.rid===F.rid})))})),z=new Map(W.map((function(F){return["".concat(F.ssrc),F.rid]})));for(var K in this.currentLayouts)z.has(K)||this.collectLayout(K);!this.currentModalitySession&&z.size>0&&(this.currentModalitySession={timestamp:Date.now()-this.startTimestamp,duration:0,numLayouts:0,layouts:[]},this.logger.safe.info("Modality session started")),W.forEach((function(F){G.currentLayouts["".concat(F.ssrc)]||G.addLayout(F)})),0===z.size&&this.currentModalitySession&&this.collectSession(),W.forEach((function(F){return G.processLayoutData(F)}))},SimulcastStatistics.prototype.setMaxCapabilities=function(F,B){var G,K;if(this.lastMaxCapabilitiesEvent=F,Object.keys(this.currentLayouts).length){var _loop_1=function(G){var z=Object.values(J.currentLayouts).find((function(F){return F.rid===G.rid}));z&&(B?(Q.arrayPushFixedSize(z.fmtp,W(W({},G),{timestamp:Date.now()-J.startTimestamp-J.currentModalitySession.timestamp-z.timestamp,causeId:F.causeId}),J.configProvider.config.simulcastTelemetryNumFMTP),z.gatherer.setMaxCapabilitesApplied(F)):z.gatherer.setMaxCapabilitesRequested(F),z.gatherer.setMaxCapabilitiesOvershoot([G]),z.gatherer.setKeyFrameRequested(G.keyframe))},J=this;try{for(var Y=z(F.capabilities),$=Y.next();!$.done;$=Y.next()){_loop_1($.value)}}catch(F){G={error:F}}finally{try{$&&!$.done&&(K=Y.return)&&K.call(Y)}finally{if(G)throw G.error}}}},SimulcastStatistics.prototype.finish=function(){for(var F in this.logger.safe.info("Finishing statistics gathering"),this.currentLayouts)this.collectLayout(F);this.currentModalitySession&&this.collectSession()},SimulcastStatistics.prototype.addLayout=function(F){var B,G,z,K="".concat(F.ssrc),J=F.rid,Q=null===(G=this.lastMaxCapabilitiesEvent)||void 0===G?void 0:G.capabilities.find((function(F){return F.rid===J}));this.logger.safe.info("Adding layout for ssrc ".concat(K," rid ").concat(J));var Z=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp,ee=new Y.default(Z,this.configProvider,this.logger.createChild("Telemetry#".concat(K)));this.currentLayouts[K]=((B={ssrc:F.ssrc,rid:J,fmtp:[W(W({},Q),{timestamp:Z,causeId:null===(z=this.lastMaxCapabilitiesEvent)||void 0===z?void 0:z.causeId})],timestamp:Z,duration:0,gatherer:ee})[$]={firCount:F.googFirsReceived,nackCount:F.googNacksReceived,pliCount:F.googPlisReceived,framesEncoded:F.framesEncoded,bytesSent:F.bytesSent,packetsSent:F.packetsSent,packetsLost:F.packetsLost,qpSum:F.qpSum},B[X]={firCount:[],nackCount:[],pliCount:[],framesEncoded:[],bytesSent:[],packetsSent:[],packetsLost:[],qpSum:[],frameHeightInput:[],frameHeightSent:[],frameRateInput:[],frameRateSent:[]},B),ee.setMaxCapabilitiesOvershoot([Q]),ee.setKeyFrameRequested(Q.keyframe),this.currentModalitySession.numLayouts++},SimulcastStatistics.prototype.processLayoutData=function(F){var B="".concat(F.ssrc),G=this.currentLayouts[B];this.processMediaStats(G,F),G.gatherer.captureMediaData(J.default.MEDIA_DIRECTION.SEND,[String(F.googFrameRateSent)],[String(F.framesEncoded)]),G.gatherer.captureFrameRate([String(F.googFrameRateInput)]),G.gatherer.captureQpData(J.default.MEDIA_DIRECTION.SEND,String(F.qpSum),[String(F.framesEncoded)]),G.gatherer.captureBitrateSample(J.default.MEDIA_DIRECTION.SEND,F.bytesSent),G.gatherer.detectCaptureFreeze([String(F.googFrameRateInput)]),G.gatherer.setCurrentParameters(F.ssrc,{width:F.googFrameWidthSent,height:F.googFrameHeightSent},F.googFrameRateSent);var W={kfEncoded:parseInt(String(F.keyFramesEncoded)),fir:parseInt(String(F.googFirsReceived)),pli:parseInt(String(F.googPlisReceived))};G.gatherer.setKeyFrameData(W)},SimulcastStatistics.prototype.processMediaStats=function(F,B){var G=F[$],W=B.googFirsReceived-G.firCount,z=B.googNacksReceived-G.nackCount,K=B.googPlisReceived-G.pliCount,J=B.framesEncoded-G.framesEncoded,Y=B.bytesSent-G.bytesSent,Z=B.packetsSent-G.packetsSent,ee=B.packetsLost-G.packetsLost,te=B.qpSum-G.qpSum,ne=F[X],ie=this.configProvider.config.webrtcStatStoredRecordsNumber;Q.arrayPushFixedSize(ne.firCount,W,ie),Q.arrayPushFixedSize(ne.nackCount,z,ie),Q.arrayPushFixedSize(ne.pliCount,K,ie),Q.arrayPushFixedSize(ne.framesEncoded,J,ie),Q.arrayPushFixedSize(ne.bytesSent,Y,ie),Q.arrayPushFixedSize(ne.packetsSent,Z,ie),Q.arrayPushFixedSize(ne.packetsLost,ee,ie),Q.arrayPushFixedSize(ne.qpSum,te,ie),Q.arrayPushFixedSize(ne.frameHeightInput,B.googFrameHeightInput,ie),Q.arrayPushFixedSize(ne.frameHeightSent,B.googFrameHeightSent,ie),Q.arrayPushFixedSize(ne.frameRateInput,B.googFrameRateInput,ie),Q.arrayPushFixedSize(ne.frameRateSent,B.googFrameRateSent,ie)},SimulcastStatistics.prototype.collectLayout=function(F){this.logger.safe.info("Collecting layout for ssrc ".concat(F)),this.currentLayouts[F].duration=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp-this.currentLayouts[F].timestamp,this.currentLayouts[F].gatherer.isSendGathering()&&this.currentLayouts[F].gatherer.stopSendGathering();var B=this.currentLayouts[F].gatherer.getReport(J.default.MEDIA_DIRECTION.SEND,"",!1);for(var G in B)this.currentLayouts[F][G]=B[G];for(var G in this.currentLayouts[F][X])this.currentLayouts[F][G]=Q.sampleseries(this.currentLayouts[F][X][G],(function(F){return F}));delete this.currentLayouts[F].gatherer,Q.arrayPushFixedSize(this.currentModalitySession.layouts,this.currentLayouts[F],this.configProvider.config.simulcastTelemetryLayoutsPerSession),delete this.currentLayouts[F]},SimulcastStatistics.prototype.collectSession=function(){for(var F in this.logger.safe.info("Collecting session"),this.currentLayouts)this.collectLayout(F);this.currentModalitySession.duration=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp,Q.arrayPushFixedSize(this.collectedModalitySessions,this.currentModalitySession,this.configProvider.config.simulcastTelemetryNumModalitySessions),this.currentModalitySession=void 0,this.lastMaxCapabilitiesEvent=void 0},SimulcastStatistics.prototype.getHigherFidelitySSRC=function(F,B){var G,W;if(!F||!B)return F||B;var z=K(this.currentLayouts[F].fmtp.slice(-1),1)[0],J=K(this.currentLayouts[B].fmtp.slice(-1),1)[0];return(null!==(G=null==z?void 0:z.maxMbps)&&void 0!==G?G:0)>0&&(null!==(W=null==J?void 0:J.maxMbps)&&void 0!==W?W:0)>0?z.maxMbps>J.maxMbps?F:B:F||B},SimulcastStatistics}();B.default=Z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(18),z=G(409),K=G(147),J=G(411),Q=function(){function UnifiedPlanAdapter(F){this.RTCPeerConnection=W.default.window.RTCPeerConnection,this.RTCSessionDescription=J.SessionDescriptionAdapter,this.SdpTransform=z.UnifiedPlanSdpTransform,this.RTCRtpReceiver=K.default.build(F)}return UnifiedPlanAdapter}();B.default=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.UnifiedPlanSdpTransform=void 0;var W=G(1),z=G(410),K=function(){function UnifiedPlanSdpTransform(F){this.context=F,this.cname=W.uniqueId()}return UnifiedPlanSdpTransform.prototype.toLocal=function(F,B,G){return this.modify({sdpSource:0,sdpType:G},F,B)},UnifiedPlanSdpTransform.prototype.toOffer=function(F,B,G){return this.modify({sdpSource:1,sdpType:"offer"},F,B,G)},UnifiedPlanSdpTransform.prototype.toAnswer=function(F,B,G){return this.modify({sdpSource:1,sdpType:"answer"},F,B,G)},UnifiedPlanSdpTransform.prototype.toRemote=function(F,B,G,W){return this.modify({sdpSource:2,sdpType:W},F,B,G)},UnifiedPlanSdpTransform.prototype.modify=function(F,B,G,K){var J=new z.SdpModifiersChainBuilder(this.context,G,K,this.cname).build(F),Q=W.deepClone(B);return J.modify(Q),Q},UnifiedPlanSdpTransform}();B.UnifiedPlanSdpTransform=K},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.SdpModifiersChainBuilder=void 0;var z=G(64),K=function(){function SdpModifiersChain(F){this.modifierList=F}return SdpModifiersChain.prototype.modify=function(F){var B,G;try{for(var z=W(this.modifierList),K=z.next();!K.done;K=z.next()){K.value.modify(F)}}catch(F){B={error:F}}finally{try{K&&!K.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}},SdpModifiersChain}(),J=function(){function SdpModifiersChainBuilder(F,B,G,W){this.context=F,this.mediaManager=B,this.modalities=G,this.cname=W}return SdpModifiersChainBuilder.prototype.build=function(F){switch(F.sdpSource){case 0:return new K([new z.InjectH264SpsPpsIdrInKeyframe(this.context.configProvider),new z.RemoveExtmapAllowMixed(this.context.configProvider),new z.AddVLAHeaderExtension(this.mediaManager,this.context.configProvider),new z.AddMsidFixup(this.mediaManager),new z.FilterCodecs(this.mediaManager,this.context.configProvider,F.sdpType)]);case 2:return new K([new z.DisabledMediaFixup(this.mediaManager,this.modalities),new z.RemoveMsRTCAttributes,new z.RollbackEntitiesFixup(this.mediaManager,!0),new z.NoBundleInAnswerFixup(this.context.configProvider,this.mediaManager),new z.SendOnlyModalityFixup(this.modalities),new z.NoAudioFixup,new z.ComfortNoiseFixup,new z.G722Fixup,new z.InOpusEnforcedFmtp(this.context.configProvider),new z.RemoveH264ParamsModifier(this.context.configProvider),new z.InSdpReceiveSsrcFixup,new z.IncomingSrtpFixup(this.context),new z.SimulcastFromMsSDPMediaFixup(this.mediaManager),new z.AddExtmapAllowMixed(this.context.configProvider),new z.ExtUriNormalizer,new z.RemoveNonAdvVLADecoratorExtension(this.context.configProvider),new z.RemoveVLAHeaderExtension(this.context.configProvider),new z.RemoveLabelsModifier,new z.InSdpBandwidthModifier(this.mediaManager,this.modalities,this.context.configProvider),new z.IncomingDataModalityFixup(this.context),new z.PartialIceRestartFixup(this.context.configProvider),new z.AddVideoOrientationExtension(this.context.configProvider),new z.FilterCodecs(this.mediaManager,this.context.configProvider,F.sdpType),new z.InjectTransportCCAudio(this.context.configProvider,this.context.getLogger()),new z.BundleGroupModifier(this.context.configProvider)]);case 1:return new K([new z.OutgoingDataModalityFixup(this.context,this.modalities.data),new z.RollbackEntitiesFixup(this.mediaManager,!1),new z.OutSdpBandwidthModifier(this.context.configProvider),new z.DisabledMediaFixup(this.mediaManager,this.modalities),new z.AddLabelsModifier(this.mediaManager),new z.ComfortNoiseFixup,new z.OutgoingDtlsRoleModifier(this.mediaManager,"offer"===F.sdpType,this.context.configProvider),new z.SimulcastToMsSDPMediaFixup(this.mediaManager,this.context.getLogger()),new z.AddNonAdvVLADecoratorExtension(this.context.configProvider),new z.OutSdpReceiveSsrcFixup(this.context.config.isConference,this.cname),new z.IceRestartChecker(this.mediaManager),new z.ExtensionsFixup,new z.RemoveH264SpsPpsIdrInKeyframe(this.context.configProvider),new z.RemoveVideoOrientationExtension(this.context.configProvider),new z.BundleGroupModifier(this.context.configProvider)])}},SdpModifiersChainBuilder}();B.SdpModifiersChainBuilder=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SessionDescriptionAdapter=void 0;var W=G(18),z=function(){function SessionDescriptionAdapter(F){this.originalDescription=new W.default.window.RTCSessionDescription(F)}return Object.defineProperty(SessionDescriptionAdapter.prototype,"sdp",{get:function(){return this.originalDescription.sdp},set:function(F){this.originalDescription=new W.default.window.RTCSessionDescription({sdp:F,type:this.originalDescription.type})},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDescriptionAdapter.prototype,"type",{get:function(){return this.originalDescription.type},set:function(F){this.originalDescription=new W.default.window.RTCSessionDescription({sdp:this.originalDescription.sdp,type:F})},enumerable:!1,configurable:!0}),SessionDescriptionAdapter.prototype.toJSON=function(){return this.originalDescription.toJSON()},SessionDescriptionAdapter}();B.SessionDescriptionAdapter=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.WebkitAdapter=void 0;var W=G(413),z=G(147),K=G(414),J=G(148),Q=function(){function WebkitAdapter(F){var B=F.configProvider.config.useSdpCapabilities;this.RTCRtpReceiver=z.default.build(F,B),this.SdpTransform=W.WebkitSdpTransform,this.RTCPeerConnection=K.default.build(this.RTCRtpReceiver),this.RTCSessionDescription=J.default.build()}return WebkitAdapter}();B.WebkitAdapter=Q},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.WebkitSdpTransform=void 0;var K=G(1),J=G(4),Q=G(10),Y=G(39),$=G(64),X=101,Z=[48e3,32e3,24e3,16e3,12e3],ee=function(){function WebkitSdpTransform(F){this.context=F,this.cname=K.uniqueId(),this.dataMedia={type:J.default.MEDIA_TYPE.data,protocol:J.default.PROFILES.rtpSavp,port:0},this.configProvider=F.configProvider,this.logger=F.getLogger().createChild("WebkitSdpTrans")}return WebkitSdpTransform.prototype.fixTelephoneEvent=function(F){var B;return Z.forEach((function(B){Y.removeCodec(F,{codec:"telephone-event",rate:B})})),Y.updatePayload(F,X,999),Y.forOneCodec(F,{name:"telephone-event",rate:8e3},(function(F){return B=F.rtp.payload,F.rtp.payload=X,F})),Y.updatePayload(F,999,B||X),B},WebkitSdpTransform.prototype.toLocal=function(F,B,G){var W,z=this,J=B.isEmpty(),Z=K.deepClone(F);return Z.media.forEach((function(F){if("audio"===F.type)J&&(W=z.fixTelephoneEvent(F)),fixComfortNoise(F);else{W&&Y.updatePayload(F,X,W);var K=B.getLocalSsrcs().get(Y.getModality(F));z.enforceFixedSsrc(F,K)}var $=Q.getAllowedCodecs(z.configProvider,F.type);"offer"===G&&filterCodecs(F,$,J,z.logger)})),new $.InjectH264SpsPpsIdrInKeyframe(this.configProvider).modify(Z),delete Z.extmapAllowMixed,Z},WebkitSdpTransform.prototype.toOffer=function(F,B,G){return this.fromNative(F,B,G,!0)},WebkitSdpTransform.prototype.toAnswer=function(F,B,G){return this.fromNative(F,B,G,!1)},WebkitSdpTransform.prototype.toRemote=function(F,B,G,W){var z,$,X=K.deepClone(F),Z=this.configProvider.mediaConfig.maxBandwidthInKbps;X.bandwidth&&(!Z||Z>F.bandwidth[0].limit)&&(Z=F.bandwidth[0].limit),X.media.forEach((function(F,G){B.getMediaEntity(G).isDisabled()&&F.type!==J.default.MEDIA_TYPE.audio&&(F.port=0)}));var ee=getBundle(X);if(!ee){var te=!1;X.media.forEach((function(F,G){var W=B.getMediaEntity(G);!te&&W.isEnabled()?(F.mid=W.getMid(),te=!0):(W.disable(),F.port=0)})),te&&(X.groups||(X.groups=[]),ee={type:"BUNDLE"},X.groups.push(ee))}X.media.forEach((function(F){var B=Y.getModality(F);G[B]===J.default.MEDIA_STATE.send&&(F.direction&&F.direction.toLowerCase()===J.default.MEDIA_STATE.receive||(F.direction=J.default.MEDIA_STATE.receive))}));var ne=X.media.filter((function(F){return F.type===J.default.MEDIA_TYPE.video}));if(ne.length>0){var ie=ne.filter((function(F){return 0!==F.port}));if(ie.length>0){($=K.deepClone(ie[0])).bandwidth&&delete $.bandwidth;var re=this.configProvider.config.audioBandwidthInKbps?this.configProvider.config.audioBandwidthInKbps:0;Z&&Z-re>0&&($.bandwidth=[{limit:Z-re,type:"AS"}]),$.mid="video",$.direction=null,delete $.label,$.ssrcs=[],$.ssrcGroups=[],delete $.msid,ie.forEach((function(F){F.ssrcs&&($.ssrcs=$.ssrcs.concat(F.ssrcs)),F.ssrcGroups&&($.ssrcGroups=$.ssrcGroups.concat(F.ssrcGroups)),$.direction=mergeDirections($.direction,F.direction||J.default.MEDIA_STATE.sendReceive)})),removeUnifiedPlanExtensions($)}else $=disabledMedia(J.default.MEDIA_TYPE.video,void 0,ne[0].protocol,ne[0].payloads)}var oe=X.media.find((function(F){return F.type===J.default.MEDIA_TYPE.audio}));if(oe)if(0!==oe.port)(z=K.deepClone(oe)).mid="audio",delete z.label,removeG722Codec(z),fixComfortNoise(z),removeUnifiedPlanExtensions(z);else{z=disabledMedia(J.default.MEDIA_TYPE.audio,void 0,oe.protocol,oe.payloads);var ae=X.media.find((function(F){return!!F.iceUfrag}));ae&&(z.port=9,z.direction="inactive",z.mid="audio",z.iceUfrag=ae.iceUfrag,z.icePwd=ae.icePwd,z.rtcpMux="rtcp-mux",ae.crypto&&(z.crypto=ae.crypto),ae.fingerprint&&(z.fingerprint=ae.fingerprint,z.setup=ae.setup),z.rtp=[{payload:0,codec:"PCMU",rate:8e3}],z.payloads="0")}X.media.forEach((function(F,B){F.type===J.default.MEDIA_TYPE.data&&(F.type=J.default.MEDIA_TYPE.dataChannel,F.payloads=J.default.PAYLOAD_TYPE.DATA_CHANNEL,F.protocol=J.default.PROFILES.udpDtlsSctp,F.mid="data",delete F.xDataProtocol,delete F.direction,0===F.port&&(X.media[B]=disabledMedia(F.type,void 0,F.protocol,F.payloads)))}));var se=Q.allowDataChannel(this.context)?X.media.find((function(F){return F.type===J.default.MEDIA_TYPE.dataChannel})):null;X.media=[z,$,se].filter((function(F){return F})),B.getMediaEntities()[0].getModality()!==J.default.MODALITY.audio&&X.media.reverse();var ce=Q.preferSdesSrtp(this.context),le=Q.getSrtpInfo(F);return X.media.forEach((function(F){F.type!==J.default.MEDIA_TYPE.dataChannel&&(!ce&&F.fingerprint&&F.crypto&&delete F.crypto,F.protocol=!le.dtls||le.sdes&&ce?J.default.PROFILES.rtpSavpf:J.default.PROFILES.udpTlsRtpSavpf)})),"offer"===W&&(filterCodecs(z,this.configProvider.config.allowedAudioCodecs,!1,this.logger),filterCodecs($,this.configProvider.config.allowedVideoCodecs,!1,this.logger)),fixBundling(X,this.configProvider.mediaConfig.isTransportUnbundled),X},WebkitSdpTransform.prototype.splitMedia=function(F,B,G,Q,$){var X=this,Z=F.getMid(),ee=F.getModality(),te=K.deepClone(B);if(te.label=Y.getLabelForModality(ee),te.direction=Q,te.mid=Z,te.ssrcs=[],te.ssrcGroups=[],F.getModality()===J.default.MODALITY.data)return te.type=J.default.MEDIA_TYPE.data,te.payloads=J.default.PAYLOAD_TYPE.X_DATA,te;var ne=G.filter((function(F){return F.modality===ee}));if(ne&&ne.length){var ie=[];B.ssrcs&&(ne.forEach((function(F){var G=B.ssrcs.filter((function(B){return"msid"===B.attribute&&F.trackId===getTrackId(B.value)})).map((function(F){return F.id}));ie.push.apply(ie,z([],W(G),!1))})),te.ssrcs=B.ssrcs.filter((function(F){return ie.indexOf(F.id)>-1})),te.ssrcs.forEach((function(F){"cname"===F.attribute&&(F.value=X.cname)}))),B.ssrcGroups&&(te.ssrcGroups=B.ssrcGroups.filter((function(F){return F.ssrcs.split(" ").find((function(F){return ie.indexOf(+F)>-1}))})))}else{if(Q===J.default.MEDIA_STATE.send||Q===J.default.MEDIA_STATE.sendReceive)return disabledMedia(B.type,Y.getLabelForModality(ee),B.protocol,B.payloads);Q!==J.default.MEDIA_STATE.receive&&Q!==J.default.MEDIA_STATE.inactive||($[B.type].ssrcs&&$[B.type].ssrcs[0]?te.ssrcs=[{id:$[B.type].ssrcs[0].id,attribute:"cname",value:this.cname}]:B.type===J.default.MEDIA_TYPE.audio?te.ssrcs=[{id:4195875351,attribute:"cname",value:this.cname}]:B.type===J.default.MEDIA_TYPE.video&&(te.ssrcs=[{id:1,attribute:"cname",value:this.cname}]))}return te},WebkitSdpTransform.prototype.fromNative=function(F,B,G,W){var z=this,Q=K.deepClone(F),X=this.configProvider.mediaConfig.maxBandwidthInKbps;X&&(Q.bandwidth=[{limit:X,type:"CT"}]),new $.RemoveH264SpsPpsIdrInKeyframe(this.configProvider).modify(Q);var Z=Q.media.find((function(F){return F.type===J.default.MEDIA_TYPE.audio})),ee=Q.media.find((function(F){return F.type===J.default.MEDIA_TYPE.video})),te=Q.media.find((function(F){return F.type===J.default.MEDIA_TYPE.dataChannel})),ne={};ne[J.default.MODALITY.audio]=Z,ne[J.default.MODALITY.video]=ee,ne[J.default.MODALITY.sharing]=ee,ne[J.default.MODALITY.data]=te||this.dataMedia;var ie={};ie[J.default.MEDIA_TYPE.audio]=Z,ie[J.default.MEDIA_TYPE.video]=ee,ie[J.default.MEDIA_TYPE.data]=te||this.dataMedia;var re={};return re[J.default.MODALITY.audio]=B.getMediaEntitiesByModality(J.default.MODALITY.audio)[0],re[J.default.MODALITY.video]=B.getMediaEntitiesByModality(J.default.MODALITY.video)[0],re[J.default.MODALITY.sharing]=B.getMediaEntitiesByModality(J.default.MODALITY.sharing)[0],re[J.default.MODALITY.data]=B.getMediaEntitiesByModality(J.default.MODALITY.data)[0],Q.media=[],B.getMediaEntities().forEach((function(F){var K,$=G[F.getModality()];!F.isEnabled()||0===ne[F.getModality()].port||F!==re[F.getModality()]&&$===J.default.MEDIA_STATE.send?(K=disabledMedia(F.getType(),Y.getLabelForModality(F.getModality()),ne[F.getModality()].protocol,ne[F.getModality()].payloads),ne[F.getModality()].payloads===J.default.PAYLOAD_TYPE.DATA_CHANNEL&&(K.payloads=J.default.PAYLOAD_TYPE.DATA_CHANNEL)):($!==J.default.MEDIA_STATE.inactive&&F!==re[F.getModality()]&&($=J.default.MEDIA_STATE.receive),K=z.splitMedia(F,ne[F.getModality()],B.getLocalTracksInfo(),$,ie),F!==re[F.getModality()]&&(K.candidates=[]));var X=ne[F.getModality()].setup;X&&("actpass"!==X?F.setExtension("setup",X):W&&void 0!==F.getExtension("setup")&&(K.setup="actpass"!==F.getExtension("setup")?F.getExtension("setup"):X));var Z=ne[F.getModality()].iceUfrag,ee=F.getExtension("iceUfrag");F.setExtension("iceRestart",!!Z&&!!ee&&ee!==Z),F.setExtension("iceUfrag",Z),0===K.port&&F.disable(),Q.media.push(K)})),new $.OutgoingDataModalityFixup(this.context,G.data).modify(Q),fixBundling(Q,this.configProvider.mediaConfig.isTransportUnbundled),Q},WebkitSdpTransform.prototype.enforceFixedSsrc=function(F,B){var G=this,W=-1;if(F.ssrcs){var z=[];if(F.ssrcs.forEach((function(F){"msid"===F.attribute&&z.push({ssrc:F.id,trackId:getTrackId(F.value)})})),F.ssrcs.forEach((function(F){"cname"===F.attribute&&W++,B&&(F.id=G.getVideoSSRC(W,B))})),F.ssrcGroups){var K=F.ssrcs.filter((function(F){return"cname"===F.attribute})).map((function(F){return F.id}));F.ssrcGroups.forEach((function(F,B){F.ssrcs=[K[2*B],K[2*B+1]].join(" ")}))}}},WebkitSdpTransform.prototype.getVideoSSRC=function(F,B){return F%2==1?B+50:B},WebkitSdpTransform}();function removeG722Codec(F){Y.removeCodec(F,{codec:"g722",rate:8e3,encoding:2})}function removeUnifiedPlanExtensions(F){var B=new Set(["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"]);F.ext&&(F.ext=F.ext.filter((function(F){return!B.has(F.uri)})))}function fixComfortNoise(F){Y.removeCodec(F,{codec:"CN",rate:16e3})}function getBundle(F){return F.groups?F.groups.find((function(F){return"BUNDLE"===F.type})):null}function fixBundling(F,B){var G,W=null===(G=F.groups)||void 0===G?void 0:G.findIndex((function(F){return"BUNDLE"===F.type})),z=F.groups?F.groups[W]:void 0;z&&(B?(z.mids=F.media.filter((function(F){return F.type===J.default.MEDIA_TYPE.video})).map((function(F){return F.mid})).filter((function(F){return F})).join(" "),z.mids||delete F.groups[W]):z.mids=F.media.map((function(F){return F.mid})).filter((function(F){return F})).join(" "))}function disabledMedia(F,B,G,W){return{type:F,port:0,label:B,payloads:W,protocol:G}}function getTrackId(F){return F.split(" ")[1]}function mergeDirections(F,B){return F===J.default.MEDIA_STATE.sendReceive||B===J.default.MEDIA_STATE.sendReceive?J.default.MEDIA_STATE.sendReceive:F===B?F:F&&B&&F!==B?J.default.MEDIA_STATE.sendReceive:F||B}function filterCodecs(F,B,G,W){if(B.length&&(null==F?void 0:F.port)){var z=Q.convertToCodecInfo(B);Y.filterCodecs(F,z,G,W)}}B.WebkitSdpTransform=ee},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(46),z=G(47),K=G(18),J=G(1),Q=G(39),Y=G(148),$=[{name:"telephone-event",rate:8e3},{name:"cn",rate:16e3}];function PeerConnection(F){var B=[],G=Y.default.build(),X=[].slice.apply(arguments);X.splice(0,1,null),overrideSetting("iceTransportPolicy","iceTransports");var Z=new(Function.prototype.bind.apply(K.default.window.webkitRTCPeerConnection,X));function overrideSetting(F,B){X[1]&&X[1][F]&&(X[1][B]=X[1][F])}function shim(){shimPromises(),shimSetRemoteDescription(),shimCreateAnswer(),shimCreateOffer(),shimSenders()}function shimPromises(){[{name:"createOffer",reverseArgs:!0},"createAnswer","setRemoteDescription","setLocalDescription"].forEach((function(F){var B=F.name||F,G=Z[B];Z[B]=function(){var B=arguments;return new Promise((function(W,z){var K=[W,z];B.length>0&&K.splice(F.reverseArgs?K.length:0,0,B[0]),G.apply(Z,K)}))}}))}function Sender(F,B){var G;Object.defineProperty(this,"dtmf",{get:function(){return"audio"===F.kind?G=G||Z.createDTMFSender(F):null}}),this.track=F,this._stream=B}function shimSenders(){Z.getSenders&&Z.addTrack&&Z.removeTrack||(Z.getSenders=function(){return B.slice()},Z.addTrack=function(F,G){if(!F||!G)throw new Error("both media track and stream need to be provided");Z.getLocalStreams().some((function(F){return F.id===G.id}))||Z.addStream(G);var W=B.find((function(B){return B.track.id===F.id}));return W||(W=new Sender(F,G),B.push(W)),W},Z.removeTrack=function(F){Z.getLocalStreams().filter((function(B){return B.id===F._stream.id})).forEach((function(F){Z.removeStream(F)})),J.remove(B,(function(B){return B===F}))})}function shimCreateOffer(){var F=Z.createOffer;Z.createOffer=function(B){var G=arguments;return B&&B.offerToReceiveVideo>1&&(B.offerToReceiveVideo=1),F.apply(Z,G)}}function shimSetRemoteDescription(){["createOffer","createAnswer","setLocalDescription"].forEach((function(B){var G=Z[B];Z[B]=function(){var B=arguments;return F.getCapabilities("video").then((function(){return G.apply(G,B)}))}}));var B=Z.setRemoteDescription;Z.setRemoteDescription=function(G){return F.getCapabilities("video").then((function(F){var z=F.codecs,K=W.parse(G.sdp);return K.media.forEach((function(F){"video"===F.type&&(F.rtp.some((function(F){return z.some((function(B){return F.codec.toLowerCase()===B.mimeType}))}))?suppressH264FormatParameters(F):F.port=0);if(!hasDtls(F)){var B=Q.getBundle(K);B?F.crypto=B.crypto:F.port||K.media.some((function(B){return!!B.port&&(F.crypto=B.crypto,!0)}))}})),G.sdp=W.write(K),B(G)}))}}function shimCreateAnswer(){var F=Z.createAnswer;Z.createAnswer=function(){var B=arguments;return F.apply(Z,B).then((function(F){if(!Z.localDescription||!Z.localDescription.sdp)return F;var B=W.parse(Z.localDescription.sdp),z=[];if(B.media.forEach((function(F){$.forEach((function(B){Q.forOneCodec(F,B,(function(F){z.push(F)}))}))})),z.length){var K=W.parse(F.sdp),J=!1;K.media.forEach((function(F){z.forEach((function(B){Q.forOneCodec(F,{name:B.rtp.codec,rate:B.rtp.rate},(function(F){F.rtp.payload!==B.rtp.payload&&(F.rtp.payload=B.rtp.payload,J=!0)}))}))})),J&&(F=new G({type:F.type,sdp:W.write(K)}))}return F}))}}function suppressH264FormatParameters(F){Q.forOneCodec(F,{name:"h264",rate:9e4},(function(F){if(F.fmtp){var B=z.default.build(),G=z.default.build(F.fmtp.config);["level-asymmetry-allowed","packetization-mode","profile-level-id"].forEach((function(F){if(G.contains(F)){var W=G.get(F);"profile-level-id"===F&&(W="42C02A"),B.setIfMissing(F,W)}})),F.fmtp.config=B.toString()}}))}function hasDtls(F){return"RTP/SAVPF"!==F.protocol}return shim(),Z}B.default={build:function(F){return PeerConnection.bind(null,F)}}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MBPS_VALUES=void 0;var W=G(4),z=G(47),K=G(1);B.MBPS_VALUES=[2812,4218,8437,16875,33750,67500,108e3,135e3,198e3,244800,27e4,352500,52e4];var J=function(){function VideoCapabilities(F,B,G){this.initialMaxFS=F,this.initialMaxFPS=B,this.h264SubscribeProfile=G,this.maxFS=F,this.maxFPS=B}return VideoCapabilities.prototype.setMaxFS=function(F,B){return!(this.maxFS===F||(this.maxFS=F,!B))&&(B(this),!0)},VideoCapabilities.prototype.getMaxFS=function(){return this.maxFS},VideoCapabilities.prototype.getMaxFPS=function(){return this.maxFPS},VideoCapabilities.prototype.getMaxMBPS=function(){return this.calculateMbps(this.maxFS,this.maxFPS)},VideoCapabilities.prototype.calculateMbps=function(F,G){var W=F*G/100;return K.getClosestValue(B.MBPS_VALUES,W,!0)},VideoCapabilities.prototype.resetToInitial=function(){this.maxFS=this.initialMaxFS,this.maxFPS=this.initialMaxFPS},VideoCapabilities.prototype.buildFmtp=function(){var F=z.default.build();return F.setIfMissing(W.default.VIDEO_CAPABILITIES.MAX_FS_PATH,this.getMaxFS().toString()),F.setIfMissing(W.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH,this.getMaxMBPS().toString()),F.setIfMissing(W.default.VIDEO_CAPABILITIES.MAX_FPS_PATH,this.getMaxFPS().toString()),this.h264SubscribeProfile&&F.setIfMissing("profile-level-id",this.h264SubscribeProfile),F.toString()},VideoCapabilities}();B.default=J},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},K=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},J=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},Q=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.AdaptiveCapablitiesHandler=void 0;var Y=G(33),$=G(53),X=G(130),Z=G(1),ee=G(4),te=G(417),ne=function(){function AdaptiveCapablitiesHandler(F,B,G,W,z,K,J){this.listener=F,this.statisticsGatherer=B,this.diagnostics=G,this.logger=W,this.configProvider=z,this.isSimulcastEnabled=J,this.serialQueue=new Y.PromiseQueue(this.logger),this.modality=ee.default.MODALITY.video;var Q=K.maxResolution?{maxFs:K.maxResolution.fs}:null;this.validator=new X.VideoCapabilitiesValidator(this.logger.createChild("CapsValidator"),Q),this.resolutionManager=new te.ResolutionManager(K,this,this.statisticsGatherer,this.logger.createChild("rm"),z)}return AdaptiveCapablitiesHandler.prototype.setMaxCapabilities=function(F,B){var G;return J(this,void 0,void 0,(function(){var z,K;return Q(this,(function(J){switch(J.label){case 0:return z={modality:this.modality,causeId:F,capabilities:B,isSimulcastEnabled:this.isSimulcastEnabled},this.statisticsGatherer.onMaxCapabilitiesRequested(z),null===(G=this.diagnostics)||void 0===G||G.onMaxCapabilitiesRequested(z),this.causeId=F,K=this.validator.ensureValidity(B[0]),this.streamSenderParams=W(W({},B[0]),K),this.resolutionManager.setMaxResolution(this.streamSenderParams.maxFs),this.configProvider.mediaConfig.simulcastSessionEnabled?[4,this.applyCapabilities(this.getParamsToApply())]:[3,2];case 1:J.sent(),J.label=2;case 2:return[2]}}))}))},AdaptiveCapablitiesHandler.prototype.resetCurrentResolution=function(){this.resolutionManager.resetCurrentResolution()},AdaptiveCapablitiesHandler.prototype.getCurrentResolution=function(){return this.resolutionManager.getCurrentResolution()},AdaptiveCapablitiesHandler.prototype.setCurrentResolution=function(F){this.resolutionManager.setCurrentResolution(F)},AdaptiveCapablitiesHandler.prototype.onResolutionChanged=function(F){return J(this,void 0,void 0,(function(){return Q(this,(function(B){return[2,this.applyCapabilities(this.getParamsToApply(F))]}))}))},AdaptiveCapablitiesHandler.prototype.dispose=function(){this.resolutionManager.dispose(),this.resolutionManager=null},AdaptiveCapablitiesHandler.prototype.applyCapabilities=function(F){return J(this,void 0,void 0,(function(){return Q(this,(function(B){return F?this.lastAppliedSenderParams===F?(this.logger.safe.info("Capabilities already applied: ".concat(JSON.stringify(F))),[2,!0]):(this.logger.safe.info("Capabilities to apply: ".concat(JSON.stringify(F))),this.lastAppliedSenderParams=F,[2,this.listener.onReceiveCapabilitiesChanged(this.modality,this.causeId,[F])]):(this.logger.safe.error("Send capabilities are not set. Cannot apply constraints"),[2,!1])}))}))},AdaptiveCapablitiesHandler.prototype.getParamsToApply=function(F){if(!this.streamSenderParams)return null;var B=F||this.resolutionManager.getCurrentResolution();if(!B||this.streamSenderParams.maxFs<=B)return this.streamSenderParams;var G=Z.shallowClone(this.streamSenderParams);return G.maxFs=B,G},z([(0,$.sequentialize)(),K("design:type",Function),K("design:paramtypes",[Object]),K("design:returntype",Promise)],AdaptiveCapablitiesHandler.prototype,"applyCapabilities",null),AdaptiveCapablitiesHandler}();B.AdaptiveCapablitiesHandler=ne},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.ResolutionManager=void 0;var W=G(28),z=15e3,K=5e3,J=function(){function ResolutionManager(F,B,G,z,K){var J=this;this.settings=F,this.listener=B,this.statsGatherer=G,this.logger=z,this.lastSendBW=0,this.coolingDown=!1,this.cooldownTimer=null,this.cooldownEnd=0,this.active=!1,this.resolutionTable=new W.default(K.config.resolutionTableOverride),this.maxResolution=this.settings.maxResolution,this.settings.scalingEnabled?(this.active=!0,this.statsSubscription=this.statsGatherer.on("onStatisticsChanged",(function(F){return J.onStatisticsChanged(F)}))):this.logger.safe.info("Resolution management disabled: no resolution management for 1x1 calls")}return ResolutionManager.prototype.dispose=function(){this.currentResolution=null,this.pendingResolution=null,this.maxResolution=null,this.listener=null,this.active=!1,clearTimeout(this.cooldownTimer),this.cooldownTimer=null,this.statsSubscription&&(this.statsSubscription.dispose(),this.statsSubscription=null),this.statsGatherer=null,this.listener=null},ResolutionManager.prototype.setMaxResolution=function(F){var B=this.resolutionTable.getResolutionByFs(F);B!==this.maxResolution&&(this.logger.safe.info("Setting max resolution: ".concat(B)),this.maxResolution=B,this.lastSendBW&&this.processEstimatedBandwidth(this.lastSendBW))},ResolutionManager.prototype.resetCurrentResolution=function(){this.currentResolution=null},ResolutionManager.prototype.getCurrentResolution=function(){return this.currentResolution&&this.currentResolution.fs},ResolutionManager.prototype.setCurrentResolution=function(F){this.currentResolution=F},ResolutionManager.prototype.applyRes=function(F){var B=this;this.pendingResolution=F,this.coolingDown&&(!this.currentResolution||F.fs>this.currentResolution.fs)||(this.coolingDown=!0,this.logger.safe.info("Changing resolution to ".concat(F)),this.listener&&this.listener.onResolutionChanged(F.fs).then((function(G){G?(F===B.pendingResolution&&(B.pendingResolution=null),B.coolingDown&&!B.currentResolution&&(B.coolingDown=!1),B.currentResolution=F,B.cooldown()):(B.logger.safe.info("Unable to apply resolution at the moment"),B.cooldown(K))})).catch((function(F){B.logger.safe.error("Error while applying new resolution: ".concat(JSON.stringify(F))),B.pendingResolution=null})))},ResolutionManager.prototype.cooldown=function(F){var B=this;void 0===F&&(F=z),!this.active||this.coolingDown&&this.cooldownEnd-Date.now()>z||(this.cooldownTimer&&clearTimeout(this.cooldownTimer),this.coolingDown=!0,this.cooldownEnd=Date.now()+z,this.cooldownTimer=setTimeout((function(){B.logger.safe.debug("Resolution changer cooled down"),B.coolingDown=!1,B.cooldownTimer=null,B.pendingResolution?B.proposeResolution(B.pendingResolution):B.processEstimatedBandwidth(B.lastSendBW)}),F))},ResolutionManager.prototype.proposeResolution=function(F){var B=F;this.maxResolution&&this.maxResolution.fs<B.fs&&(B=this.maxResolution),this.currentResolution&&B.fs===this.currentResolution.fs||this.applyRes(B)},ResolutionManager.prototype.processEstimatedBandwidth=function(F){var B=this.resolutionTable.getResolutionForBitrate(F),G=B.lowRes,W=B.highRes,z=F<this.lastSendBW?W:G;F<this.lastSendBW&&z&&this.currentResolution&&this.currentResolution.fs<z.fs||(z&&this.proposeResolution(z),this.lastSendBW=F)},ResolutionManager.prototype.onStatisticsChanged=function(F){var B=F.estimatedSendBandwidth;B!==this.lastSendBW&&(this.logger.safe.debug("Send BW: ".concat(B)),this.processEstimatedBandwidth(B))},ResolutionManager}();B.ResolutionManager=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.DirectCapabilitiesHandler=void 0;var W=function(){function DirectCapabilitiesHandler(F,B,G,W,z){this.modality=F,this.listener=B,this.statisticsGatherer=G,this.diagnostics=W,this.isSimulcastEnabled=z}return DirectCapabilitiesHandler.prototype.setMaxCapabilities=function(F,B){var G,W={modality:this.modality,causeId:F,capabilities:B,isSimulcastEnabled:this.isSimulcastEnabled};this.statisticsGatherer.onMaxCapabilitiesRequested(W),null===(G=this.diagnostics)||void 0===G||G.onMaxCapabilitiesRequested(W),this.listener.onReceiveCapabilitiesChanged(this.modality,F,B)},DirectCapabilitiesHandler.prototype.dispose=function(){},DirectCapabilitiesHandler.prototype.resetCurrentResolution=function(){},DirectCapabilitiesHandler.prototype.getCurrentResolution=function(){return null},DirectCapabilitiesHandler.prototype.setCurrentResolution=function(F){},DirectCapabilitiesHandler}();B.DirectCapabilitiesHandler=W},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.RemoteVideoRenderer=void 0;var K=G(1),J=G(4),Q=G(52),Y=G(420),$=G(125),X=G(421),Z=G(126),ee=G(422),te=function(F){function RemoteVideoRenderer(B,G,W,z,K){var J=F.call(this,K,B.createChild("remote"))||this;return J.configProvider=G,J.diagnostics=W,J.subscriptionManager=z,J.disposed=!1,J.currentIsRendering=!1,J.configProvider.config.freezeIntervalFrequency&&(J.freezeTracker=new X.VideoFreezeTracker(J.getVideoElement(),J.configProvider,J.getTimeToFirstFrame.bind(J)),J.freezeTracker.on("onFreezeEnded",(function(F){var B;null===(B=J.diagnostics)||void 0===B||B.addFreezeDuration(F),J.event("onFreezeEnded").raise(F)})),J.diagnostics&&J.on("onVideoStarted",(function(F){var B;J.diagnostics.timeToFirstFrame=F,null===(B=J.sizeTracker)||void 0===B||B.triggerVideoElementSizeChange()}))),J.configProvider.config.isRenderingBasedOnRawStatistics&&(J.isRenderingTracker=new Y.IsRenderingTracker(J.configProvider,J.getModality.bind(J)),J.isRenderingChangedSubscription=J.isRenderingTracker.on("onIsRenderingChanged",(function(F){J.setIsRendering(F)}))),J.overlayStats=(0,$.createRemoteRendererStatsOverlay)(J.configProvider.config.showStatsInCall,K,J),J}return z(RemoteVideoRenderer,F),RemoteVideoRenderer.prototype.getEndOfTheFreeze=function(){var F;return null===(F=this.freezeTracker)||void 0===F?void 0:F.getEndOfTheFreeze()},RemoteVideoRenderer.prototype.setIsRendering=function(F){this.currentIsRendering!==F&&(this.currentIsRendering=F,this.captureIsRenderingEvent(F))},RemoteVideoRenderer.prototype.captureRawStatistics=function(F){var B;this.configProvider.config.isRenderingBasedOnRawStatistics&&(null===(B=this.isRenderingTracker)||void 0===B||B.captureRawStatistics(F)),-1!==F.id.indexOf("_recv")&&this.overlayStats.setStats(F)},RemoteVideoRenderer.prototype.subscribeVideoAsync=function(F,B){var G=this;return new Promise((function(W,z){G.modality=B?J.default.MODALITY.sharing:J.default.MODALITY.video,G.diagnostics&&(G.diagnostics.msi=F,G.diagnostics.modality=G.modality),G.trackElementSizeChange(),G.unsubscribe();var Q=G.subscriptionManager.subscribeVideo(G.modality,F);G.subscription=Q,G.logger.safe.info("subscribing renderer to type: ".concat(Q.modality," msi: ").concat(Q.msi)),Q.setOnMediaStreamChangedHandler((function(F){var B,z=G.getMediaStream();G.attachMediaStream(F);var K=G.getTrackId();K&&G.diagnostics&&(G.diagnostics.trackId=K),G.logger.safe.info("subscribed renderer to type: ".concat(Q.modality," msi: ").concat(Q.msi," on stream #").concat(F?F.id:"none")),F&&z!==F&&(null===(B=G.sizeTracker)||void 0===B||B.triggerVideoElementSizeChange()),W()})),Q.setOnErrorHandler((function(F){G.logger.safe.error("failed to subscribe renderer ".concat(K.stringifyObject(F))),z(F)}))}))},RemoteVideoRenderer.prototype.dispose=function(){var B,G,W,z;this.disposed?this.logger.safe.warn("renderer already disposed"):(this.disposed=!0,this.logger.safe.info("disposing"),this.unsubscribe(),this.captureIsRenderingEvent(!1),null===(B=this.sizeTracker)||void 0===B||B.dispose(),null===(G=this.freezeTracker)||void 0===G||G.dispose(),null===(W=this.isRenderingChangedSubscription)||void 0===W||W.dispose(),this.overlayStats.dispose(),null===(z=this.diagnostics)||void 0===z||z.dispose(),this.event("onRendererDisposed").raise(this),F.prototype.dispose.call(this))},RemoteVideoRenderer.prototype.getModality=function(){return this.modality},RemoteVideoRenderer.prototype.getMsi=function(){var F,B;return null!==(B=null===(F=this.subscription)||void 0===F?void 0:F.msi)&&void 0!==B?B:Q.MediaSourceIdentifiers.SourceNone},RemoteVideoRenderer.prototype.getLocalMsi=function(){var F;return null===(F=this.subscription)||void 0===F?void 0:F.localMsi},RemoteVideoRenderer.prototype.getCurrentResolution=function(){var F;return null!==(F=this.resolution)&&void 0!==F?F:{width:0,height:0}},RemoteVideoRenderer.prototype.unsubscribeNow=function(){var F;null===(F=this.subscription)||void 0===F||F.unsubscribe(),this.subscription=null},RemoteVideoRenderer.prototype.trackElementSizeChange=function(){var F=this,B=this.modality===J.default.MODALITY.sharing,G=B?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMin:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMin,W=B?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMax:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMax;G&&W?(this.sizeTracker=new ee.VideoSizeTracker(this.getVideoElement(),G,W,this.configProvider.config.enableDevicePixelRatio),this.sizeTracker.changed((function(){return F.onSizeTrackerChanged()}))):this.logger.safe.info("skipping video size tracking")},RemoteVideoRenderer.prototype.onSizeTrackerChanged=function(){this.resolution={width:this.sizeTracker.width,height:this.sizeTracker.height},this.logger.safe.info("video renderer size changed to ".concat(this.resolution.width,"x").concat(this.resolution.height)),this.diagnostics&&(this.diagnostics.rendererSize=this.resolution),this.event("onRendererSizeChanged").raise(this,this.resolution)},RemoteVideoRenderer.prototype.unsubscribe=function(){var F;null===(F=this.subscription)||void 0===F||F.dispose(),this.subscription=null},RemoteVideoRenderer.prototype.captureIsRenderingEvent=function(F){this.diagnostics&&(this.diagnostics.isRendering=F),this.event("onIsRenderingChanged").raise(F,this.getModality(),this.getTrackId())},RemoteVideoRenderer}(Z.VideoRendererBase);B.RemoteVideoRenderer=te},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.IsRenderingTracker=void 0;var K=G(4),J=function(F){function IsRenderingTracker(B,G){var W=F.call(this)||this;return W.configProvider=B,W.getModality=G,W.isRendering=!1,W.currentFreezeDuration=0,W.mediaStarted=!1,W.lastBytesRecv=0,W.currentLowBitrateDuration=0,W}return z(IsRenderingTracker,F),IsRenderingTracker.prototype.captureRawStatistics=function(F){var B=F.googFrameRateDecoded,G=F.googFrameRateReceived,W=F.bytesReceived;void 0!==W&&this.getModality()!==K.default.MODALITY.sharing&&this.configProvider.config.isBytesRecvUsedInIsRenderingCalculation&&this.calculateBitrate(W),B>0&&(this.mediaStarted=!0),0===B||0===G?this.currentFreezeDuration+=K.default.TIME_INTERVAL.SEC_1:B>0&&(void 0===G||G>0)&&(this.currentFreezeDuration=0);var z=this.configProvider.config.notRenderingTimeInterval[this.getModality()];this.setIsRendering(z)},IsRenderingTracker.prototype.calculateBitrate=function(F){var B=125,G=(F-this.lastBytesRecv)/B;this.lastBytesRecv=F,G<this.configProvider.config.notRenderingLowBitrateThreshold?this.currentLowBitrateDuration++:this.currentLowBitrateDuration=0},IsRenderingTracker.prototype.setIsRendering=function(F){var B=this.currentFreezeDuration<F&&this.currentLowBitrateDuration<F&&this.mediaStarted;B!==this.isRendering&&(this.isRendering=B,this.event("onIsRenderingChanged").raise(this.isRendering))},IsRenderingTracker}(G(6).default);B.IsRenderingTracker=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.VideoFreezeTracker=void 0;var K=function(F){function VideoFreezeTracker(B,G,W){var z=F.call(this)||this;return z.videoElement=B,z.configProvider=G,z.getTimeToFirstFrame=W,z.prevCurrentTime=0,z.prevDecodedFrameCount=0,z.prevTimestamp=Date.now(),z.currentFreezeDuration=0,z.freezeDurationTimer=window.setInterval((function(){z.calcFreezeDurationMs()}),z.configProvider.config.freezeIntervalFrequency),z}return z(VideoFreezeTracker,F),VideoFreezeTracker.prototype.calcFreezeDurationMs=function(){var F=this.videoElement.currentTime,B=F===this.prevCurrentTime,G=this.videoElement.webkitDecodedFrameCount,W=void 0===G||G===this.prevDecodedFrameCount;if(this.prevCurrentTime=F,this.prevDecodedFrameCount=G,-1!==this.getTimeToFirstFrame())if(B&&W){var z=Date.now();this.currentFreezeDuration+=z-this.prevTimestamp,this.prevTimestamp=z}else{if(this.currentFreezeDuration>this.configProvider.config.freezeMinDuration){var K=this.calcFreeze();this.event("onFreezeEnded").raise(K)}this.currentFreezeDuration=0}this.prevTimestamp=Date.now()},VideoFreezeTracker.prototype.getEndOfTheFreeze=function(){var F=0;return this.currentFreezeDuration>0&&(F=this.calcFreeze(),this.currentFreezeDuration=0),F},VideoFreezeTracker.prototype.dispose=function(){var F=this.getEndOfTheFreeze();this.event("onFreezeEnded").raise(F),clearInterval(this.freezeDurationTimer)},VideoFreezeTracker.prototype.calcFreeze=function(){var F=Date.now()-this.prevTimestamp;return this.currentFreezeDuration+F},VideoFreezeTracker}(G(6).default);B.VideoFreezeTracker=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.VideoSizeTracker=void 0;var K=G(6),J=G(18),Q=function(F){function VideoSizeTracker(B,G,W,z){var K=F.call(this)||this;return K.videoElement=B,K.minInterval=G,K.maxInterval=W,K.window=J.default.window,K.devicePixelRatio=z&&window.devicePixelRatio||1,K.originalVideoElementSize={width:B.offsetWidth,height:B.offsetHeight},K.initializeSizeTracking(),K}return z(VideoSizeTracker,F),Object.defineProperty(VideoSizeTracker.prototype,"width",{get:function(){return this.originalVideoElementSize.width*this.devicePixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(VideoSizeTracker.prototype,"height",{get:function(){return this.originalVideoElementSize.height*this.devicePixelRatio},enumerable:!1,configurable:!0}),VideoSizeTracker.prototype.initializeSizeTracking=function(){var F=this,B=Math.floor(Math.random()*Math.abs(this.maxInterval-this.minInterval))+this.minInterval;this.elementSizeTrackingRef=this.window.setInterval((function(){F.videoElementSizeChanged()&&(F.saveCurrentVideoElementSize(),F.raiseChanged())}),B)},VideoSizeTracker.prototype.triggerVideoElementSizeChange=function(){this.originalVideoElementSize.height&&this.originalVideoElementSize.width&&this.raiseChanged()},VideoSizeTracker.prototype.dispose=function(){this.elementSizeTrackingRef&&this.window.clearInterval(this.elementSizeTrackingRef)},VideoSizeTracker.prototype.videoElementSizeChanged=function(){return this.originalVideoElementSize.width!==this.videoElement.offsetWidth||this.originalVideoElementSize.height!==this.videoElement.offsetHeight},VideoSizeTracker.prototype.saveCurrentVideoElementSize=function(){this.originalVideoElementSize.width=this.videoElement.offsetWidth,this.originalVideoElementSize.height=this.videoElement.offsetHeight},VideoSizeTracker}(K.default);B.VideoSizeTracker=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.DTMFQueue=void 0;var W=function(){function DTMFQueue(F){this.queue=[],this.logger=F}return DTMFQueue.prototype.cleanup=function(){this.queue.forEach((function(F){F.reject({notSent:F.tones})})),this.queue=[]},DTMFQueue.prototype.waitForNotification=function(F){var B=this;return F?(this.logger.unsafe.info("sending dtmf tones: ",F),new Promise((function(G,W){B.queue.push({tones:F,resolve:G,reject:W})}))):Promise.reject(new Error("invalid input"))},DTMFQueue.prototype.toneSent=function(F){this.queue[0]&&(F===this.queue[0].tones[0]?(this.queue[0].tones=this.queue[0].tones.substr(1),""===this.queue[0].tones&&(this.queue[0].resolve(),this.queue.shift())):(this.queue[0].reject(new Error("sent tone does not match: expected '".concat(this.queue[0].tones[0],"' got '").concat(F,"'"))),this.queue.shift(),this.toneSent(F)))},DTMFQueue}();B.DTMFQueue=W},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},J=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0});var Q=G(13),Y=G(51),$=G(135),X=G(33),Z=G(79),ee=G(28),te=G(38),ne=G(52),ie=G(136),re=G(137),oe=G(1),ae=G(4),se=G(84),ce=G(139),le=G(10),de=G(146),ue=G(149),pe=G(425),he=G(426),ge=G(152),fe=G(153),me=G(155),ve=G(156),ye=G(429),Se=G(162),_e=G(158),Ce=G(431),Te=G(159),Ee=G(160),be=G(161),Ie=G(432),Ae=G(433),Re=G(447),Pe=G(140),Oe=G(448),Me=G(449),we=G(119),De=0,Ne=function(){function WebRtcSession2(F,B,G){var W,z,K,J,Q=this;this.context=F,this.callId=B,this.callback=G,this.callbacks={},this.multiParty=null===(W=this.context.config)||void 0===W?void 0:W.isConference,this.configProvider=this.context.configProvider,this.logger=this.context.getLogger().createChild("webrtc2-".concat(++De)),this.deviceManager=this.context.getDeviceManager(),this.unifiedPlanEnabled=this.configProvider.config.webrtcUnifiedPlanEnabled,this.webrtcAdapter=de.default.build({global:this.context.maContext,configProvider:this.configProvider,unifiedPlanEnabled:this.unifiedPlanEnabled}),this.iceHostCandidateOnly=this.multiParty&&oe.getFrom("iceHostCandidateOnly",this.context.config,this.configProvider.config),this.mediaManager=he.MediaManagerFactory.build({logger:this.logger,configProvider:this.configProvider,numVideoChannels:this.multiParty&&this.configProvider.config.numVideoChannelsGvc||1,unifiedPlanEnabled:this.unifiedPlanEnabled,useSimulcast:this.multiParty}),this.sessionDescription=Ee.SessionDescriptionFactory.build({sdpTransform:new this.webrtcAdapter.SdpTransform(this.context),mediaManager:this.mediaManager,logger:this.logger,configProvider:this.configProvider,configuration:this.getStreamTransformConfiguration()}),this.allowedMediaContentType=oe.getFrom("webrtcAllowedMediaContentType",this.context.config,this.configProvider.config).concat(),this.receiveStreamCollection=new ie.default({streamAdded:function(F){return Q.streamAdded(F)},streamRemoved:function(F){return Q.streamRemoved(F)}}),this.diagnostics=this.context.diagnostics,this.qmDiagnostics=null===(z=this.diagnostics)||void 0===z?void 0:z.newQualityManagerDiagnostics(),this.statsGatherer=new Pe.StatisticsPoller(this.logger.createChild("stats"),this.configProvider,this.diagnostics,this.mediaManager,this.multiParty),this.scalingEnabled=this.multiParty?this.configProvider.config.webrtcMultiPartyVideoScaling:this.configProvider.config.webrtcVideoScaling,this.qualityManager=new fe.default(this.logger.createChild("qm"),{scalingEnabled:this.scalingEnabled,customBwEstimationEnabled:!(this.multiParty&&!this.configProvider.config.webrtcEnabledCustomBwEstimationForVideo),sendBandwidthNotificationsEnabled:this.multiParty&&this.configProvider.config.webrtcSendBandwidthNotificationsEnabled},this,this.statsGatherer,this.qmDiagnostics,this.configProvider),this.activeSpeakerManager=new $.ActiveSpeakerManager(this.callback.onContributingSourcesChanged,this.callback.onDominantSpeakerChanged,this.logger.createChild("ActiveSpeakerManager")),this.contributingSources=new ue.ContributingSourcesHandler({activeSpeakerManager:this.activeSpeakerManager,logger:this.logger,configProvider:this.configProvider,provider:function(){if(!Q.peerConnection)return[];if(Q.peerConnection.getReceivers&&Q.multiParty){var F=Q.peerConnection.getReceivers().filter((function(F){return"audio"===F.track.kind}))[0];if(!F)return[];if(F.getContributingSources)return F.getContributingSources()}}}),this.passiveModalities=this.context.config.passiveModalities,this.negotiationQueue=new X.PromiseQueue(this.logger),this.negotiationEmulator=new ge.default(this.logger.createChild("negotiationEmulator"),this.webrtcAdapter,this.sessionDescription,this.negotiationQueue,this.mediaManager),this.extensionsManager=this.setupExtensionsManager(),this.wasConnected=!1,this.toBeCalledAfterConnected=[],this.iceTransportPolicy=this.configProvider.config.iceTransportPolicyForced||this.context.config.iceTransportPolicy||ae.default.ICE_TRANSPORT_POLICY.all,this.peerConnection=null,this.doAudioMute=this.context.config.muted,this.iceCandidatesDeferred=new te.SettablePromise,this.iceCandidatesTimer=null,this.relayCandidateGathered=!1,this.iceCandidateReceived=!1,this.triggerRenegotiationFlag=!1,this.canTriggerRenegotiation=!0,this.noIceCandidates=!1,this.noRelayIceCandidates=!1,this.forceMediaStreamUpdate=!1,this.negotiatedModalities={},this.iceDisconnectedTimer=null,this.statisticsReport=Promise.resolve({}),this.terminated=!1,this.initiator=!1,this.streamsChangedListener=null,this.dtmfSender=Te.default.build({logger:this.logger,configProvider:this.configProvider}),this.mediaContentType=oe.getFrom("webrtcMediaContentType",this.context.config,this.configProvider.config),this.streamsChangedNotificationScheduled=!1,this.subscriptionManager=new re.SubscriptionManager(this.logger.createChild("subs"),this.configProvider,{getStreams:function(){return Q.receiveStreamCollection.getStreams()},setOnStreamsChangedHandler:function(F){return Q.streamsChangedListener=F}},null===(K=this.diagnostics)||void 0===K?void 0:K.newSubscriptionManagerDiagnostics()),this.remoteVideoResolutionManager=new me.RemoteVideoResolutionManager(this.logger.createChild("rvrm"),this.multiParty,new ee.default(this.configProvider.config.recvResolutionTableOverride),this.configProvider,this.mediaManager),this.remoteVideoManager=new ve.RemoteVideoManager(this.logger.createChild("RemoteVideoManager"),this.configProvider,this.statsGatherer,null===(J=this.diagnostics)||void 0===J?void 0:J.newRemoteVideoManagerDiagnostics(),this.remoteVideoResolutionManager,this.context.maContext.domOverrides),this.transceiverManager=null,this.encStreamsManager=new Ie.EncodedStreamsManager(this.configProvider),this.streamSendersManager=new Ae.StreamSendersManager(this.mediaManager,this.logger.createChild("SSM"),this.deviceManager,this.configProvider,this.statsGatherer,this.qmDiagnostics,this.multiParty,this.encStreamsManager),this.hwSilent=!1,this.configuredModalitiesPromise=Promise.resolve(),this.negotiationCompletedPromise=new te.SettablePromise,this.transportStateProvider=null,this.isMuteHold=!1,this.rawIncomingAudioStreamManager=new we.RawIncomingAudioStreamManager(this.logger.createChild("rawIncomingAudioStream")),this.useNullAudioStream=!1,this.ufdManager=F.getUfdManager(),this.statsGatherer.on("onStatisticsChanged",(function(F){Q.updateQualityLevels(F)})),this.negotiationCompletedPromise.promise.catch((function(){})),this.negotiationCompletedPromise.reject("placeholder"),this.remoteVideoResolutionManager.on("onNegotiationRequired",(function(){return Q.triggerRenegotiation(!0)})),this.remoteVideoResolutionManager.on("onSourceRequestRequired",(function(F,B,G,W){return Q.requestSource(F,B,G,W)})),this.setSubsForSubscriptionManager(),this.setSubsForStreamManagerEvents(),this.configProvider.mediaConfig.maxBandwidthInKbps&&(this.statsGatherer.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.diagnostics&&(this.diagnostics.maxSessionBandwidth=this.configProvider.mediaConfig.maxBandwidthInKbps)),this.createAudioRenderer(),this.dmSub=this.deviceManager.on("onLocalRendererStarted",(function(F){return F.setStatsProvider(Q.statsGatherer)})),this.configProvider.config.enableActiveSpeakerBasedDSH&&this.activeSpeakerManager.setStrategy(new Me.DSHGeneratingStrategy({configProvider:this.configProvider})),this.scalingEnabled&&this.onOptimalVideoReceiversCountChanged(this.configProvider.config.nonEstimatedDefaultVideoReceiversCount)}return WebRtcSession2.prototype.getAcceptedTypes=function(){return this.allowedMediaContentType},WebRtcSession2.prototype.clone=function(F,B){var G,W=oe.shallowClone(this.context);W.config=oe.shallowClone(this.context.config),W.config.webrtcMediaContentType=this.mediaContentType,W.config.webrtcAllowedMediaContentType=this.allowedMediaContentType,W.configProvider=B,W.diagnostics=null===(G=this.context.diagnostics)||void 0===G?void 0:G.newNativeSession(!1),F?W.config.isConference=!0:(W.config.iceHostCandidateOnly=!1,this.configProvider.config.waitForRelayOnReconnect&&(W.config.webrtcIceGatheringTimeoutIncreased=!0));var z=new WebRtcSession2(W,this.callId,this.callback);return this.useNullAudioStream&&z.useNullAudioStreamClient(),this.relayManagerProvider&&(z.relayManagerProvider=this.relayManagerProvider),z.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,z},WebRtcSession2.prototype.setInternals=function(F,B){var G,W,z,K,J=this;if(this.logger.safe.info("[".concat(B,"] Setting internals from previous session")),null===(G=this.diagnostics)||void 0===G||G.commitNativeSession(),F.extensionsManager&&this.extensionsManager){var Q=F.extensionsManager.getExtension(ae.default.EXTENSION_TYPE.videoStreamControl);(null==Q?void 0:Q.getOptions())&&this.extensionsManager.configureExtension(ae.default.EXTENSION_TYPE.videoStreamControl,Q.getOptions())}F.subscriptionManager&&(null===(W=this.subscriptionManager)||void 0===W||W.dispose(),this.subscriptionManager=F.subscriptionManager,this.subscriptionManager.setDiagnostics(null===(z=this.diagnostics)||void 0===z?void 0:z.newSubscriptionManagerDiagnostics()),this.subscriptionManager.setStreamProvider({getStreams:function(){return J.receiveStreamCollection.getStreams()},setOnStreamsChangedHandler:function(F){return J.streamsChangedListener=F}}),this.setSubsForSubscriptionManager(),this.subscriptionManager.reriseSubscribeEvents(),this.notifyStreamsChanged()),F.audioRenderer&&(F.audioRenderer.play(this.audioRenderer.getStream()),this.audioRenderer=F.audioRenderer),null===(K=F.remoteVideoManager)||void 0===K||K.moveRenderers(this.remoteVideoManager),F.rawIncomingAudioStreamManager&&(this.rawIncomingAudioStreamManager=F.rawIncomingAudioStreamManager)},WebRtcSession2.prototype.setSubsForSubscriptionManager=function(){var F=this;this.subscriptionManagerSubs=[this.subscriptionManager.on("onTrackIdsChanged",(function(B){return F.statsGatherer.setSubscribedTrackIds(B)})),this.subscriptionManager.on("onTrackSsrcChanged",(function(B){return F.statsGatherer.setSubscribedTrackSsrc(B)})),this.subscriptionManager.on("onSubscriptionChanged",(function(B,G,W,z,K,J){if(2===B){var Q=F.extensionsManager.getExtension(ae.default.EXTENSION_TYPE.optimalVideoCount);null==Q||Q.configure({})}F.statsGatherer.addSubscriptionEvent(B,G,W,z,null,K,J)})),this.subscriptionManager.on("onSubscriptionFailed",(function(B,G,W,z,K){return F.statsGatherer.addSubscriptionEvent(B,G,W,z,K)}))]},WebRtcSession2.prototype.setSubsForStreamManagerEvents=function(){var F=this;this.streamSendersManager.on("onSendStreamChanged",(function(B,G){var W;F.statsGatherer.updateSendStream(B,G),(null==B?void 0:B.hasAudio())&&(null===(W=F.diagnostics)||void 0===W||W.setAudioSendStream(B,G))})),this.streamSendersManager.on("onVideoCaptureFreeze",(function(B){F.isConnected()&&F.ufdManager.signalEvent("VideoCaptureDeviceFreeze",B?"Bad":"Good","Video")}))},WebRtcSession2.prototype.move=function(F,B){this.logger.safe.info("[".concat(B,"] moving to new session")),F.setInternals({subscriptionManager:this.subscriptionManager,extensionsManager:this.extensionsManager,audioRenderer:this.audioRenderer,remoteVideoManager:this.remoteVideoManager,rawIncomingAudioStreamManager:this.rawIncomingAudioStreamManager},B),F.muteHold(this.isMuteHold,B),this.doAudioMute?F.muteInputAsync(B):F.unmuteInputAsync(B),this.subscriptionManager=null,this.audioRenderer=null,this.rawIncomingAudioStreamManager=null,this.callbacks.onTerminated=null},WebRtcSession2.prototype.setMute=function(F,B,G){this.logger.safe.info("[".concat(G,"] call setMute for ").concat(F," with mute state ").concat(B)),this.streamSendersManager.setMuted(F,B,G),this.updateQualityLevels(this.statsGatherer.getLastStatistics())},WebRtcSession2.prototype.configureModalitiesAsync=function(F,B){var G=this,getPendingPromise=function(){return W(G,void 0,void 0,(function(){var G,W,K;return z(this,(function(z){switch(z.label){case 0:return[4,this.configuredModalitiesPromise];case 1:if(z.sent(),!F||!F.audio&&!F.video&&!F.sharing)throw new Error("Invalid parameters! ".concat(JSON.stringify(F)));return G=oe.shallowClone(F),W=oe.shallowClone(this.negotiatedModalities),this.configProvider.config.alwaysNegotiateDataChannel&&(delete G.data,delete W.data),K=!this.configuredModalities||!le.areNegotiatedDirectionsFulfilled(G,W),this.configuredModalities=F,this.logger.safe.info("[".concat(B,"] configure modalities"),"audio: ".concat(F.audio),"video: ".concat(F.video),"sharing: ".concat(F.sharing),"data: ".concat(F.data),"peerconnection: ".concat(!!this.peerConnection),"pc.signalingState: ".concat(this.peerConnection?this.peerConnection.signalingState:"-"),"needNewRenegotiation: ".concat(K)),K?!this.configProvider.config.enableReinviteless||oe.isEmpty(this.negotiatedModalities)||le.isOnHold(this.negotiatedModalities)||le.isOnHold(this.configuredModalities)?[3,3]:[4,this.updateSendStreamsReinviteless(B)]:[3,6];case 2:return z.sent(),[3,6];case 3:return!this.configProvider.config.removeSendersOnConfigureModalities||le.isOnHold(this.configuredModalities)?[3,5]:[4,this.streamSendersManager.update(this.configuredModalities,!0,B)];case 4:z.sent(),z.label=5;case 5:this.triggerRenegotiation(!1,B),z.label=6;case 6:return[2]}}))}))},K=getPendingPromise();return this.configuredModalitiesPromise=K.catch((function(F){G.logger.safe.warn("[".concat(B,"] Error during configuring modalities: ").concat(oe.stringifyObject(F)))})),K},WebRtcSession2.prototype.getConfiguredModalities=function(){return this.configuredModalities},WebRtcSession2.prototype.createAudioElement=function(F){this.audioRenderer.assureAudioElement(F)},WebRtcSession2.prototype.useNullAudioStreamClient=function(){this.useNullAudioStream=!0,this.streamSendersManager.useNullAudioStreamClient()},WebRtcSession2.prototype.createOfferAsync=function(F){var B=this,G=this.negotiationQueue.add((function(){return new Promise((function(G){B.logger.safe.info("[".concat(F,"] create [offer] configured: ").concat(JSON.stringify(B.configuredModalities))),B.initiator=!0,B.throwIfModalitiesNotConfigured("no configured modalities to create offer for"),B.canTriggerRenegotiation=!1,B.negotiatingModalities=le.excludePassiveModalities(B.configuredModalities,B.passiveModalities,B.offeredModalities),G(B.assurePeerConnectionAsync(F).then((function(){return B.logger.safe.info("[".concat(F,"] updatePeerConnectionStreamsAsync, pc state: ").concat(JSON.stringify(B.peerConnection.signalingState))),le.isOnHold(B.negotiatingModalities)&&!oe.isEmpty(B.negotiatedModalities)&&Object.keys(B.negotiatingModalities).forEach((function(F){void 0===B.negotiatedModalities[F]&&delete B.negotiatingModalities[F]})),B.transceiverManager&&B.transceiverManager.assureTransceivers(B.negotiatingModalities),B.assureStreamsAndDataChannel(B.negotiatingModalities,F)})).then((function(G){B.offeredModalities=G,!le.allowDataChannel(B.context)&&B.configProvider.config.webrtcNegotiateDisabledDataModality&&!B.offeredModalities[ae.default.MODALITY.data]&&B.multiParty&&(B.offeredModalities[ae.default.MODALITY.data]=ae.default.MEDIA_STATE.inactive);var W=B.transceiverManager?{}:B.createNegotiationConstraints(B.offeredModalities);return B.logger.safe.info("[".concat(F,"] create [offer] offered: ").concat(JSON.stringify(B.offeredModalities)," constraints: ").concat(JSON.stringify(W))),B.peerConnection.createOffer(W)})).then((function(G){B.logger.unsafe.debug("[".concat(F,"] create [offer] offer from peer connection, sdp: ").concat(G.sdp));var W=B.sessionDescription.createLocalOffer(G.sdp);B.hasIceCandidates(W)||B.resetCandidateGathering(F),B.statsGatherer.startWaitingForStreamStart(B.offeredModalities);var z=new B.webrtcAdapter.RTCSessionDescription({sdp:W.toLocal(),type:"offer"});return B.setupIceGatheringTimeout(F),Promise.all([B.peerConnection.setLocalDescription(z),B.iceCandidatesDeferred.promise])})).then((function(){var G=B.sessionDescription.createLocalOffer(B.peerConnection.localDescription.sdp);B.fixLocalDescription(G),G.updateModalities(B.offeredModalities),B.checkIceCandidates(G);var W=G.toOffer();B.logger.unsafe.debug("[".concat(F,"] CREATE OFFER"),"sdp:",W);var z={blob:W,contentType:B.mediaContentType};return""===B.configProvider.mediaConfig.webrtcRequiredFeatures||B.multiParty||(z.requiredFeatures=B.configProvider.mediaConfig.webrtcRequiredFeatures),B.configProvider.countryCode&&(z.clientLocation=B.configProvider.countryCode),B.mediaManager.getMediaEntities().forEach((function(F){F.setExtension("midApplied",!0)})),B.doRetargetIfNeeded(z,G,F),B.configProvider.config.enableReinviteless&&(z.mediaDescriptions=B.getMediaDescriptions(B.offeredModalities)),B.setBWSeed(z),z})))}))}),F);return this.resetNegotiationQueue(F),G},WebRtcSession2.prototype.processOfferAsync=function(F,B){var G=this,W=this.negotiationQueue.add((function(){return new Promise((function(W){var z=F.blob;if(G.logger.unsafe.debug("[".concat(B,"] process [offer]"),"sdp:",z),G.configProvider.config.webrtcCompareContentTypeInOffer&&(oe.throwIfNotSupported(F.contentType,G.allowedMediaContentType),G.mediaContentType=F.contentType),F.requiredFeatures){var K=G.configProvider.mediaConfig.webrtcRejectedFeatures.split(","),J=F.requiredFeatures.split(",");oe.throwIfFeatureNotSupported(J,K)}G.initiator=!1,G.offeredDescription=G.sessionDescription.createRemoteOffer(z),G.canTriggerRenegotiation=!1,G.offeredModalities=le.invertModalities(G.offeredDescription.getModalities()),G.peerConnection||(G.context.configProvider.mediaConfig.isTransportUnbundled?G.context.configProvider.mediaConfig.isTransportUnbundled=G.offeredDescription.couldBeUnbundled():G.context.configProvider.mediaConfig.isTransportUnbundled=G.offeredDescription.isUnbundled());var Q=Promise.resolve(G.offeredModalities);if(le.hasSendDirectionality(G.offeredModalities.video)||le.hasReceiveDirectionality(G.offeredModalities.video)||le.hasSendDirectionality(G.offeredModalities.sharing)||le.hasReceiveDirectionality(G.offeredModalities.sharing)){var Y=G.offeredDescription.getVideoCodecs();Q=G.webrtcAdapter.RTCRtpReceiver.getCapabilities("video").then((function(F){if(!F.codecs.some((function(F){return Y.some((function(B){return F.mimeType===B}))}))){G.logger.safe.warn("[".concat(B,"] offer doesn't contain any supported video codecs"));var W=oe.shallowClone(G.offeredModalities);return W.video=void 0,W.sharing=void 0,W}return G.offeredModalities})).catch((function(F){return G.logger.safe.error("[".concat(B,"] failed to get video capability ").concat(oe.stringifyObject(F))),G.offeredModalities}))}(!le.allowDataChannel(G.context)&&(le.hasSendDirectionality(G.offeredModalities.data)||le.hasReceiveDirectionality(G.offeredModalities.data))||G.dataChannel&&"Failed"===G.dataChannel.state)&&(Q=Q.then((function(F){G.logger.safe.info("[".concat(B,"] Supressing data modality as data channel is not possible"));var W=oe.shallowClone(F);return delete W.data,W}))),W(Q.then((function(F){return G.logger.safe.info("[".concat(B,"] process [offer] offered: ").concat(JSON.stringify(G.offeredModalities)," acceptable: ").concat(JSON.stringify(F))),F})))}))}),B);return this.resetNegotiationQueue(B),W},WebRtcSession2.prototype.createAnswerAsync=function(F,B){var G=this;return new Promise((function(K){if(F)K({blob:"",contentType:G.mediaContentType});else{G.logger.safe.info("[".concat(B,"] create [answer] offered: ").concat(JSON.stringify(G.offeredModalities)," configured: ").concat(JSON.stringify(G.configuredModalities))),G.throwIfModalitiesNotConfigured("no configured modalities to create answer for"),G.negotiatingModalities=le.excludePassiveModalities(G.configuredModalities,G.passiveModalities,G.offeredModalities);var J=null,Q=G.offeredDescription.clone();K(G.assurePeerConnectionAsync(B).then((function(){return G.logger.safe.info("[".concat(B,"] updatePeerConnectionStreamsAsync, pc state: ").concat(JSON.stringify(G.peerConnection.signalingState))),J=le.negotiateModalities(G.offeredModalities,G.negotiatingModalities),G.handleCodecSwitchUnsupported(B)})).then((function(){var F=G.offeredDescription.toRemote(J);return G.logger.unsafe.info("[".concat(B,"] create [answer] set remote description', 'negotiated:"),J,"sdp:",F),G.peerConnection.setRemoteDescription(new G.webrtcAdapter.RTCSessionDescription({sdp:F,type:"offer"}))})).then((function(){return G.transceiverManager&&G.transceiverManager.syncTransceivers(J),G.mediaManager.getMediaEntities().forEach((function(F){F.setExtension("midApplied",!0)})),G.assureStreamsAndDataChannel(J,B)})).then((function(){return G.mediaManager.updateMediaEntitiesWithLocalTracks(),G.configProvider.config.mapSsrcToTrackForStats&&G.statsGatherer.updateStatsWithLocalSsrcTrackInfo(),G.callbacks.onTransportInitialized&&G.callbacks.onTransportInitialized(),G.peerConnection.createAnswer()})).then((function(F){G.logger.unsafe.debug("[".concat(B,"] create [answer] answer from peer connection"),"sdp:",F.sdp);var W=G.sessionDescription.createLocalAnswer(F.sdp);G.hasIceCandidates(W)||G.resetCandidateGathering(B),G.statsGatherer.startWaitingForStreamStart(J);var z=new G.webrtcAdapter.RTCSessionDescription({sdp:W.toLocal(),type:"answer"});return G.setupIceGatheringTimeout(B),G.logger.unsafe.debug("[".concat(B,"] create [answer] answer set local description"),"sdp:",z.sdp),Promise.all([G.peerConnection.setLocalDescription(z),G.iceCandidatesDeferred.promise])})).then((function(){return W(G,void 0,void 0,(function(){var F,G,W,K;return z(this,(function(z){switch(z.label){case 0:return F=this.sessionDescription.createLocalAnswer(this.peerConnection.localDescription.sdp),this.fixLocalDescription(F),F.updateModalities(J),this.checkIceCandidates(F),G=F.toAnswer(),[4,this.streamSendersManager.activate()];case 1:return z.sent(),W=this.streamSendersManager.getLocalMediaSources(),this.qualityManager.updateRegisteredSources(W),this.applyReceiveCapabilities(Q.getRecvCapabilities()),J=F.getModalities(),this.configProvider.config.enableReinviteless&&(J=le.removeChangedSendDirection(this.negotiatingModalities,J)),le.areNegotiatedDirectionsAcceptable(this.configuredModalities,this.negotiatingModalities,J)||this.triggerRenegotiation(!0,B),this.setNegotiatedModalities(J),this.statsGatherer.sessionInfo.setBweType(F.getBweType()),this.diagnostics&&(this.diagnostics.bweType=F.getBweType()),this.logger.unsafe.debug("[".concat(B,"] CREATE ANSWER"),"sdp:",G),K={blob:G,contentType:this.mediaContentType},this.configProvider.countryCode&&(K.clientLocation=this.configProvider.countryCode),this.configProvider.config.enableReinviteless&&(K.mediaDescriptions=this.getMediaDescriptions(J)),this.setBWSeed(K),[2,K]}}))}))})))}}))},WebRtcSession2.prototype.processAnswerAsync=function(F,B,G,K){return W(this,void 0,void 0,(function(){var W,K,J,Q,Y,$,X;return z(this,(function(z){switch(z.label){case 0:return W=F.blob,this.logger.unsafe.debug("[".concat(B,G?"] PROCESS PRANSWER":"] PROCESS ANSWER"),"sdp:",W),K=G?"pranswer":"answer",G&&(!le.allowProvisionalAnswer(this.context)||"have-local-offer"!==this.peerConnection.signalingState)?(this.logger.safe.info("[".concat(B,"] process [").concat(K,"] ignored")),[2,Promise.resolve()]):(J=this.sessionDescription.createRemoteAnswer(W),Q=le.invertModalities(J.getModalities()),this.configProvider.config.enableReinviteless&&(Q=le.removeChangedSendDirection(this.offeredModalities,Q)),Y=J.clone(),$=J.toRemote(Q),this.logger.unsafe.info("[".concat(B,"] process [").concat(K,"] set remote description"),"negotiated:",Q,"sdp:",$),G?[3,2]:(this.mediaContentType=F.contentType,-1===this.allowedMediaContentType.indexOf(this.mediaContentType)&&this.allowedMediaContentType.push(this.mediaContentType),[4,this.assureStreamsAndDataChannel(Q,B)]));case 1:z.sent(),this.setNegotiatedModalities(Q),this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.configProvider.config.mapSsrcToTrackForStats&&this.statsGatherer.updateStatsWithLocalSsrcTrackInfo(),X=this.streamSendersManager.getLocalMediaSources(),this.qualityManager.updateRegisteredSources(X),this.statsGatherer.sessionInfo.setBweType(J.getBweType()),this.diagnostics&&(this.diagnostics.bweType=J.getBweType()),z.label=2;case 2:return[4,this.peerConnection.setRemoteDescription(new this.webrtcAdapter.RTCSessionDescription({sdp:$,type:K}))];case 3:return z.sent(),G?[2]:[4,this.streamSendersManager.activate()];case 4:return z.sent(),this.applyReceiveCapabilities(Y.getRecvCapabilities()),this.callbacks.onTransportInitialized&&this.callbacks.onTransportInitialized(),this.transceiverManager&&this.transceiverManager.syncTransceivers(Q),[2]}}))}))},WebRtcSession2.prototype.completeNegotiationAsync=function(F){var B=this;return new Promise((function(G){var W,z;B.mediaManager.commit();var J=le.excludePassiveModalities(B.configuredModalities,B.passiveModalities,B.offeredModalities),Q=B.forceMediaStreamUpdate&&!le.isOnHold(B.negotiatedModalities)||!le.areNegotiatedDirectionsAcceptable(J,B.negotiatingModalities,B.negotiatedModalities)||B.triggerRenegotiationFlag,Y=!Q;B.canTriggerRenegotiation=!0,B.logger.safe.info("[".concat(F,"] negotiation completed isComplete: ").concat(Y," configured: ").concat(JSON.stringify(B.configuredModalities)," negotiating: ").concat(JSON.stringify(B.negotiatingModalities)," offered: ").concat(JSON.stringify(B.offeredModalities)," negotiated: ").concat(JSON.stringify(B.negotiatedModalities))),Q&&B.triggerRenegotiation(!1,F),B.negotiationCompletedPromise.resolve();var $={isComplete:Y,activeModalities:B.negotiatedModalities,offeredModalities:B.offeredModalities,attemptedModalities:B.negotiatingModalities,configuredModalities:B.configuredModalities,initiator:B.initiator};try{for(var X=K(B.deviceManager.getLocalVideoRenderers()),Z=X.next();!Z.done;Z=X.next()){Z.value.setStatsProvider(B.statsGatherer)}}catch(F){W={error:F}}finally{try{Z&&!Z.done&&(z=X.return)&&z.call(X)}finally{if(W)throw W.error}}G($)}))},WebRtcSession2.prototype.rejectNegotiationAsync=function(F,B,G){return void 0===G&&(G=!1),W(this,void 0,void 0,(function(){var W,K,J,Q;return z(this,(function(z){switch(z.label){case 0:return this.mediaManager.rollback(),this.logger.safe.warn("[".concat(B,"] negotiation rejected isComplete: ").concat(!G," error: ").concat(oe.stringifyObject(F)," configured: ").concat(JSON.stringify(this.configuredModalities)," negotiating: ").concat(JSON.stringify(this.negotiatingModalities)," offered: ").concat(JSON.stringify(this.offeredModalities)," negotiated: ").concat(JSON.stringify(this.negotiatedModalities))),K=this.getModalitiesForRollback(B),this.transceiverManager&&this.transceiverManager.syncTransceivers(K),[4,this.assureStreamsAndDataChannel(K,B)];case 1:if(z.sent(),!this.peerConnection)return[3,10];if("have-local-offer"!==this.peerConnection.signalingState)return[3,9];W={},this.logger.safe.info("[".concat(B,"] rolling back local description")),z.label=2;case 2:return z.trys.push([2,7,,8]),this.isRollbackSupported&&!this.configProvider.config.webrtcHandleRollback?[3,4]:(W.type="LocalRN",this.logger.safe.info("[".concat(B,"] rolling back using local renegotiation")),J=[],this.unifiedPlanEnabled&&J.push(new se.MediaRollbackModifier(this.peerConnection,this.configProvider,this.logger)),[4,this.negotiationEmulator.renegotiate(J,!0)]);case 3:return z.sent(),this.logger.safe.info("[".concat(B,"] rolling back using local complete")),[3,6];case 4:return this.logger.safe.info("[".concat(B,"] rolling back using rollback")),W.type="Rollback",[4,this.peerConnection.setLocalDescription({type:"rollback"})];case 5:z.sent(),z.label=6;case 6:return[3,8];case 7:return Q=z.sent(),this.logger.safe.error(Q),W.error=Q,[3,8];case 8:return[3,10];case 9:this.logger.safe.error("[".concat(B,"] cannot rollback local description in currrent state: ").concat(this.peerConnection.signalingState)),z.label=10;case 10:return this.canTriggerRenegotiation=!0,this.negotiationCompletedPromise.reject("negotiation rejected"),G&&(this.logger.safe.info("[".concat(B,"] retrying failed negotiation")),this.triggerRenegotiation(!1,B)),[2,{isComplete:!G,activeModalities:K,offeredModalities:this.offeredModalities,attemptedModalities:this.negotiatingModalities,configuredModalities:this.configuredModalities,initiator:this.initiator,rollback:W}]}}))}))},WebRtcSession2.prototype.createRemoteRenderer=function(F){return this.remoteVideoManager.createRenderer(F,this.subscriptionManager,this.logger)},WebRtcSession2.prototype.getStatsAsync=function(F){var B=this;return this.statsGatherer&&!this.statsGatherer.isDisposed&&(this.statisticsReport=this.statisticsReport.then((function(){return B.statsGatherer.getReport(F)})).catch((function(F){return B.logger.safe.error("getting statistics should never fail: ".concat(F.error)),F.partialReport}))),this.statisticsReport},WebRtcSession2.prototype.getLastKnownStats=function(F){return this.statsGatherer.getLastKnownReport(!1,F)},WebRtcSession2.prototype.isReconnectSupported=function(){return this.configProvider.config.enableReconnectChrome},WebRtcSession2.prototype.muteHold=function(F,B){var G,W,z=this;this.logger.safe.info("[".concat(B,"] set muteHold state ").concat(F)),this.isMuteHold=F;var J=[ae.default.MODALITY.audio,ae.default.MODALITY.video,ae.default.MODALITY.sharing].filter((function(F){return le.hasSendDirectionality(z.negotiatedModalities[F])&&(F!==ae.default.MODALITY.audio||!z.doAudioMute)}));try{for(var Q=K(J),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value;this.setMute(le.modalityToMediaType($),F,B)}}catch(F){G={error:F}}finally{try{Y&&!Y.done&&(W=Q.return)&&W.call(Q)}finally{if(G)throw G.error}}},WebRtcSession2.prototype.muteInputAsync=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){return this.doAudioMute=!0,this.setMute("Audio",!0,F),[2]}))}))},WebRtcSession2.prototype.unmuteInputAsync=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){return this.doAudioMute=!1,this.setMute("Audio",!1,F),[2]}))}))},WebRtcSession2.prototype.muteOutputAsync=function(F){return this.audioRenderer.setMuted(!0,F)},WebRtcSession2.prototype.unmuteOutputAsync=function(F){return this.audioRenderer.setMuted(!1,F)},WebRtcSession2.prototype.sendDtmf=function(F){return this.dtmfSender.sendDtmf(this.peerConnection,F)},WebRtcSession2.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.peerConnection)},WebRtcSession2.prototype.pauseNegotiations=function(F){var B=this;void 0===F&&(F=(0,Q.generateCauseId)());var G=new te.SettablePromise;return this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){B.setNegotiationPromise(G,F)})),G},WebRtcSession2.prototype.getExtensionsManager=function(){return this.extensionsManager},WebRtcSession2.prototype.onDeviceEvent=function(F){this.statsGatherer.onDeviceEvent(F)},WebRtcSession2.prototype._deviceSelectionChanged=function(){this.peerConnection&&this.audioRenderer&&this.audioRenderer.getStream()&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId())},WebRtcSession2.prototype.terminate=function(F,B,G){var K;return void 0===G&&(G=!0),W(this,void 0,void 0,(function(){var B;return z(this,(function(W){switch(W.label){case 0:this.logger.safe.info("[".concat(F,"] terminate")),this.statsGatherer.setTerminated(),null===(K=this.diagnostics)||void 0===K||K.terminate(),this.terminated=!0,this.canTriggerRenegotiation=!1,this.cleanUp(F),W.label=1;case 1:return W.trys.push([1,4,5,6]),G?[4,this.getStatsAsync(!1)]:[3,3];case 2:W.sent(),W.label=3;case 3:return[3,6];case 4:return B=W.sent(),this.logger.safe.error("[".concat(F,"] Error while gathering stats ").concat(oe.stringifyObject(B))),[3,6];case 5:return this.statsGatherer.dispose(),[7];case 6:return[2]}}))}))},WebRtcSession2.prototype.getIncomingRawAudioStream=function(){var F=this.audioRenderer.getStream();return this.rawIncomingAudioStreamManager.createIRawStreamClient(F)},WebRtcSession2.prototype.cleanUp=function(F){var B;this.activeSpeakerManager.dispose(),this.negotiationQueue.dispose(),null===(B=this.rawIncomingAudioStreamManager)||void 0===B||B.dispose(),this.negotiationCompletedPromise.reject("webRtcSession cleanUp"),this.remoteVideoManager.dispose(),this.dataChannel&&(this.dataChannel.dispose(),this.dataChannel=null),this.resetPeerConnection(F),this.subscriptionManagerSubs.forEach((function(F){return F.dispose()})),this.subscriptionManager&&this.subscriptionManager.dispose(),this.dmSub.dispose(),this.clearIceDisconnectedTimer(),this.extensionsManager&&this.extensionsManager.dispose(),this.callbacks.onTerminated&&this.callbacks.onTerminated(this)},WebRtcSession2.prototype.resetPeerConnection=function(F){this.logger.safe.info("[".concat(F,"] reset peer connection")),this.contributingSources.stopPolling(),this.qualityManager&&(this.qualityManager.dispose(),this.qualityManager=null),this.audioRenderer&&this.audioRenderer.dispose(),this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.streamSendersManager&&(this.streamSendersManager.dispose(),this.streamSendersManager=null),this.transceiverManager=null,this.encStreamsManager.dispose(),this.receiveStreamCollection.clear(),this.transportStateProvider&&(this.transportStateProvider.dispose(),this.transportStateProvider=null),this.peerConnection&&this.peerConnection.close(),this.toBeCalledAfterConnected=[],this.peerConnection=null,this.negotiationEmulator.configure(null),this.peerConnectionPromise=null,this.resetCandidateGathering(F),this.canTriggerRenegotiation=!0,this.negotiatedModalities={}},WebRtcSession2.prototype.resetNegotiationQueue=function(F){this.negotiationCompletedPromise.reject("promise expired"),this.setNegotiationPromise(new te.SettablePromise,F)},WebRtcSession2.prototype.setNegotiationPromise=function(F,B){void 0===B&&(B=(0,Q.generateCauseId)()),this.terminated||(this.negotiationCompletedPromise=F,this.negotiationQueue.add(this.negotiationCompletedPromise,B))},WebRtcSession2.prototype.setupExtensionsManager=function(){var F=this,B=new ce.default(this.logger.createChild("ExtMgr"));return B.addExtension(ae.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:this.logger,callback:this.activeSpeakerManager.onDominantSpeakerHistoryChanged.bind(this.activeSpeakerManager)}),B.addExtension(ae.default.EXTENSION_TYPE.videoStreamControl,{logger:this.logger,negotiationEmulator:this.negotiationEmulator,qualityManager:this.qualityManager,diagnostics:this.qmDiagnostics,configProvider:this.configProvider,statisticsGatherer:this.statsGatherer}),this.scalingEnabled&&B.addExtension(ae.default.EXTENSION_TYPE.optimalVideoCount,{logger:this.logger,callback:function(B){return F.onOptimalVideoReceiversCountChanged(B)},statisticsGatherer:this.statsGatherer,diagnostics:this.diagnostics,configProvider:this.configProvider}),B},WebRtcSession2.prototype.updateQualityLevels=function(F){if(F){this.hwSilent!==F.audioHwSilent&&(this.hwSilent=F.audioHwSilent,this.callbacks.onAudioHwSilentChanged&&this.callbacks.onAudioHwSilentChanged(this.hwSilent)),this.ufdManager.signalEvent("NetworkRecvQuality",F.networkRecvLevel),this.ufdManager.signalEvent("NetworkSendQuality",this.doAudioMute?"Good":F.networkSendLevel);var B=!(!F.isSpeaking||!this.doAudioMute);this.ufdManager.signalEvent("DeviceSpeakWhileMuted",B?"Bad":"Good")}},WebRtcSession2.prototype.triggerRenegotiation=function(F,B){void 0===B&&(B=(0,Q.generateCauseId)()),this.canTriggerRenegotiation?(this.canTriggerRenegotiation=!1,this.triggerRenegotiationFlag=!1,this.logger.safe.info("[".concat(B,"] triggering renegotiation")),this.mediaManager.backup(),this.callbacks.onNegotiationRequired&&this.callbacks.onNegotiationRequired(B)):F&&(this.logger.safe.info("[".concat(B,"] renegotiation postponed")),this.triggerRenegotiationFlag=!0)},WebRtcSession2.prototype.throwIfModalitiesNotConfigured=function(F){if(!this.configuredModalities)throw new Error(F)},WebRtcSession2.prototype.handleCodecSwitchUnsupported=function(F){var B=this;return this.offeredDescription.isCodecSwitchSupported()?Promise.resolve():this.webrtcAdapter.RTCRtpReceiver.getCapabilities(ae.default.MEDIA_TYPE.audio).then((function(F){var G=F.codecs.map((function(F){return F.mimeType}));B.offeredDescription.usePrimaryAudioCodecOnly(G)})).catch((function(G){B.logger.safe.error("[".concat(F,"] failed to set primary codec based on audio capability ").concat(oe.stringifyObject(G)))}))},WebRtcSession2.prototype.assurePeerConnectionAsync=function(F){var B=this;if(!this.peerConnectionPromise){if(!this.relayManagerProvider)throw new Error("relay manager provider is not set!");this.logger.safe.info("[".concat(F,"] fetching relay details from RelayManager..."));var G={relayType:"turn",isRemoteClientLync:this.context.config.isRemoteClientLync};this.peerConnectionPromise=this.relayManagerProvider.getRelayManager().queryRelaysAsync(G).then((function(G){return W(B,void 0,void 0,(function(){var B,W,K,Y,$,X,Z,ee,te,ne=this;return z(this,(function(z){if(this.terminated)throw new Error("session already disposed");return B={optional:[]},W=(0,be.createIceServers)(G,this.configProvider.config),K=this.configureCrypto(B),this.configureCpuThreshold(B),this.logger.safe.info("create peer connection"),Y=this.unifiedPlanEnabled?"unified-plan":"plan-b",$=this.context.configProvider.mediaConfig.isTransportUnbundled?"balanced":"max-bundle",X=this.peerConnection=new this.webrtcAdapter.RTCPeerConnection({iceServers:W,rtcpMuxPolicy:"require",iceTransportPolicy:this.iceTransportPolicy,iceCandidatePoolSize:this.configProvider.config.iceCandidatePoolSize,bundlePolicy:$,sdpSemantics:Y,audioPortRange:this.configProvider.mediaConfig.audioPortRange,videoPortRange:this.configProvider.mediaConfig.videoPortRange,enableDtlsSrtp:1===K,encodedInsertableStreams:!!this.configProvider.config.useInsertableStreams},B),this.isRollbackSupported=1===K&&this.unifiedPlanEnabled&&this.context.configProvider.userAgentConfig.isBrowserRollbackSupported,this.negotiationEmulator.configure(X),this.statsGatherer.initialize(X),this.statsGatherer.sessionInfo.setIceServers(W),this.statsGatherer.sessionInfo.setIceTransportPolicy(this.iceTransportPolicy),this.statsGatherer.sessionInfo.setSdpSemantics(Y),this.statsGatherer.sessionInfo.setBundlePolicy($),this.diagnostics&&(this.diagnostics.iceServers=W,this.diagnostics.iceTransportPolicy=this.iceTransportPolicy,this.diagnostics.sdpSemantics=Y,this.diagnostics.bundlePolicy=$),this.checkVideoCodecsSupport(),this.contributingSources.startPolling(),X.onnegotiationneeded=function(){ne.logger.safe.info("onnegotiationneeded signalingState: ".concat(X.signalingState))},X.onsignalingstatechange=function(){ne.statsGatherer.sessionInfo.setSignalingConnectionState(X.signalingState),ne.diagnostics&&(ne.diagnostics.signalingConnectionState=X.signalingState),ne.logger.safe.info("onsignalingstatechange signalingState: ".concat(X.signalingState)),ne.transportStateProvider&&ne.transportStateProvider.subscribeForDtlsTransportState()},X.onicecandidateerror=function(F){var B,G=J([F.address,F.port],2),W=G[0],z=G[1];if(ne.logger.safe.warn("On ICE candidate error ".concat(F.url," | ").concat(W,":").concat(z,": code ").concat(F.errorCode,": ").concat(F.errorText)),!ne.isConnected()||ne.iceCandidatesDeferred.isPending){var K={address:W,port:+z,url:F.url,errorCode:F.errorCode,errorText:F.errorText};ne.statsGatherer.addIceCandidateError(K),null===(B=ne.diagnostics)||void 0===B||B.addIceCandidateError(K)}},Z=function(F){var B=F.track,G=F.receiver,W=F.transceiver,z=F.streams[0],K=z||new MediaStream([B]);if(!ne.isConnected())return ne.logger.safe.info("ontrack handling postponed till PC is connected"),void ne.toBeCalledAfterConnected.push((function(){return Z(F)}));if(ne.logger.safe.info("ontrack track ".concat(B.id,", stream: ").concat(null==K?void 0:K.id,", transceiver=").concat(null==W?void 0:W.mid)),K&&K.active&&"stopped"!==(null==W?void 0:W.currentDirection)&&!(null==W?void 0:W.stopped)){var J=ne.mediaManager.getMediaEntityByRemoteStreamId(K.id);if(J||(ne.logger.safe.info("cannot find media entity with stream id ".concat(K.id," trying to fallback")),K.getAudioTracks()[0]&&(J=ne.mediaManager.getMediaEntitiesByModality(ae.default.MODALITY.audio)[0])),J){var Q=ne.createReceiveStream(K,G,B,J);ne.unifiedPlanEnabled&&(J.setRemoteTrackId(B.id),ne.addReceiveStreamTransforms(G,J.getModality())),ne.receiveStreamCollection.add(Q)}else ne.logger.safe.error("could not find media entity for an added stream: ".concat(K.id))}else ne.logger.safe.info("ontrack ignore non active stream")},X.onaddstream=function(F){ne.logger.safe.info("onaddstream stream: ".concat(F.stream.id))},X.ontrack=Z,ee=function(F){if(!ne.isConnected())return ne.logger.safe.info("onremovestream handling postponed till PC is connected"),void ne.toBeCalledAfterConnected.push((function(){return ee(F)}));ne.logger.safe.info("onremovestream stream: ".concat(F.stream)),ne.receiveStreamCollection.remove(F.stream.id)},X.onremovestream=ee,X.onicecandidate=function(B){var G,z,K,J=B.candidate;if(J){var Q=le.parseCandidateString(J.candidate);if(ne.logger.safe.info("[".concat(F,"] onicecandidate candidate: component:").concat(Q.component," protocol:").concat(Q.protocol," prio:").concat(Q.priority," type:").concat(Q.type," port:").concat(Q.port)),ne.logger.unsafe.info("[".concat(F,"] candidate details: ").concat(J.candidate)),"1"!==Q.component)return;if(ne.iceCandidateReceived=!0,ne.statsGatherer.sessionInfo.setCandidateDetails(Q),null===(G=ne.diagnostics)||void 0===G||G.setCandidateDetails(Q),!ne.relayCandidateGathered&&J.candidate.indexOf("typ relay")>-1){var Y={priority:(null===(z=J.priority)||void 0===z?void 0:z.toString())||Q.priority,time:Date.now()-ne.iceRelayCandidatesGatherStartTime};ne.statsGatherer.sessionInfo.setRelayCandidateInfo(Y),ne.diagnostics&&(ne.diagnostics.relayCandidateInfo=Y),ne.relayCandidateGathered=!0}}else ne.logger.safe.info("[".concat(F,"] onicecandidate candidate: null"));if(ne.iceCandidatesDeferred.isPending){var $=!ne.initiator||!ne.context.config.webrtcIceGatheringTimeoutIncreased,Z=ne.iceHostCandidateOnly||0===W.length;if(!J&&$||Z){J&&ne.logger.safe.info("[".concat(F,"] Not waiting for ICE candidates, hoping that host/prflx is enough")),ne.logger.safe.info("[".concat(F,"] Is connected:"),ne.isConnected(),X.iceConnectionState,X.signalingState);var ee=!0;if(ne.context.configProvider.mediaConfig.isTransportUnbundled&&J)ee=ne.sessionDescription.createLocalOffer(X.localDescription.sdp).hasUnbundledIceCandidates();ee&&ne.completeCandidateGathering(F)}else if(ne.relayCandidateGathered){ee=!0;if(ne.context.configProvider.mediaConfig.isTransportUnbundled)ee=ne.sessionDescription.createLocalOffer(X.localDescription.sdp).hasUnbundledRelayIceCandidates();ee&&(ne.statsGatherer.clearIceCandidateErrors(),null===(K=ne.diagnostics)||void 0===K||K.clearIceCandidateErrors(),ne.completeCandidateGathering(F))}}},X.onicegatheringstatechange=function(){ne.logger.safe.info("onicegatheringstatechange iceGatheringState: ".concat(X.iceGatheringState))},te=function(B){if(!ne.terminated){var G=ne.wasConnected?(0,Q.generateCauseId)():F,W=ne.lastTransportConnectionState;if(ne.lastTransportConnectionState=B,ne.statsGatherer.sessionInfo.setIceConnectionState(B),ne.diagnostics&&(ne.diagnostics.iceConnectionState=B),"connected"===B||"completed"===B)ne.onTransportConnected(G);else if("failed"===B||"closed"===B&&"failed"!==W){if(ne.iceCandidatesDeferred.isPending)return ne.logger.safe.info("[".concat(G,"] ice failed while gathering candidates, suppressing error")),void ne.completeCandidateGathering(G);ne.raiseError({type:ae.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport failed"},G),ne.configProvider.config.webrtcCloseAfterIceFailure&&X.close(),ne.onTransportFailed()}"disconnected"===B?(ne.onTransportDisconnected(G),ne.startIceDisconnectedTimer(G)):ne.clearIceDisconnectedTimer()}},this.transportStateProvider=new Re.TransportStateProvider(X,K,this.logger,this.configProvider,(function(F){return te(F)})),[2]}))}))})).then((function(){B.unifiedPlanEnabled&&(B.transceiverManager=new Ce.default(B.logger,B.peerConnection,B.mediaManager,B.context)),B.streamSendersManager.registerMediaConnection(pe.default.build(B.peerConnection,B.transceiverManager)),le.allowDataChannel(B.context)&&!B.dataChannel&&(B.dataChannel=new ye.SessionDataChannel(B.peerConnection,B.statsGatherer,B.logger),B.callback.onDataChannelUpdated(B.dataChannel))}))}return this.peerConnectionPromise},WebRtcSession2.prototype.configureCrypto=function(F){var B=!1,G=le.preferSdesSrtp(this.context);if(this.offeredDescription){var W=this.offeredDescription.getSrtpInfo();this.statsGatherer.sessionInfo.setOfferedSrtpInfo(W),this.diagnostics&&(this.diagnostics.offeredSrtp=W),B=!W.dtls||W.sdes&&G}else B=G;B&&(this.logger.safe.info("configuring peer connection to use sdes"),F.optional.push({DtlsSrtpKeyAgreement:!1}));var z={dtls:!B,sdes:!!B};return this.statsGatherer.sessionInfo.setNegotiatedSrtpInfo(z),this.diagnostics&&(this.diagnostics.negotiatedSrtp=z),B?0:1},WebRtcSession2.prototype.configureCpuThreshold=function(F){this.configProvider.config.webrtcNativeCpuOveruseDisabled&&this.multiParty&&F.optional.push({googCpuOveruseDetection:!1})},WebRtcSession2.prototype.completeCandidateGathering=function(F){this.iceCandidatesDeferred.isPending&&(this.logger.safe.info("[".concat(F,"] ICE candidates gathered completely")),this.iceCandidatesDeferred.resolve())},WebRtcSession2.prototype.onTransportConnected=function(F){var B;if(this.logger.safe.info("[".concat(F,"] audio transport connected")),this.statsGatherer.clearIceCandidateErrors(),null===(B=this.diagnostics)||void 0===B||B.clearIceCandidateErrors(),!this.terminated){for(this.wasConnected=!0;this.toBeCalledAfterConnected.length;)this.toBeCalledAfterConnected.shift()();this.callbacks.onAudioStateChanged(ae.default.STREAMING_STATE.active,F),this.callbacks.onTransportConnected&&this.callbacks.onTransportConnected(F)}},WebRtcSession2.prototype.onTransportDisconnected=function(F){this.callbacks.onTransportDisconnected&&this.callbacks.onTransportDisconnected(F)},WebRtcSession2.prototype.onTransportFailed=function(){this.callbacks.onTransportFailed&&this.callbacks.onTransportFailed()},WebRtcSession2.prototype.startIceDisconnectedTimer=function(F){var B=this;this.configProvider.config.iceDisconnectedTimeoutMs&&(this.iceDisconnectedTimer=setTimeout((function(){B.logger.safe.error("[".concat(F,"] ice disconnected for ").concat(B.configProvider.config.iceDisconnectedTimeoutMs,"ms. Raise ").concat(ae.default.MEDIA_ERROR.iceConnectionError)),B.raiseError({type:ae.default.MEDIA_ERROR.iceConnectionError,detail:"ice transport disconnected"},F)}),this.configProvider.config.iceDisconnectedTimeoutMs))},WebRtcSession2.prototype.clearIceDisconnectedTimer=function(){this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null)},WebRtcSession2.prototype.raiseError=function(F,B){void 0===B&&(B=(0,Q.generateCauseId)()),this.logger.safe.error("[".concat(B,"] Media error occurred type: ").concat(F.type," detail: ").concat(F.detail)),this.callbacks.onSessionErrorOccurred&&this.callbacks.onSessionErrorOccurred(F,B)},WebRtcSession2.prototype.createNegotiationConstraints=function(F){function canReceive(F){return!!F&&(le.hasReceiveDirectionality(F)||"inactive"===F)}return{offerToReceiveAudio:canReceive(F.audio),offerToReceiveVideo:canReceive(F.video)||canReceive(F.sharing)}},WebRtcSession2.prototype.resetCandidateGathering=function(F){this.logger.safe.info("[".concat(F,"] reset candidate gathering")),this.iceCandidatesDeferred.promise.then((function(){}),(function(){})),this.iceCandidatesDeferred.reject(new Error("reset candidate gathering")),this.iceCandidatesDeferred=new te.SettablePromise,this.iceCandidateReceived=!1},WebRtcSession2.prototype.checkIceCandidates=function(F){var B=this.hasIceCandidates(F);if(B===this.noIceCandidates&&(this.noIceCandidates=!this.noIceCandidates,this.ufdManager.signalEvent("NoNetwork",this.noIceCandidates?"Bad":"Good"),this.noIceCandidates))throw{type:ae.default.MEDIA_ERROR.noNetworkError,detail:"no ice candidates"};if(B){var G=this.hasRelayIceCandidates(F);if(G===this.noRelayIceCandidates){if(!G&&("connected"===this.peerConnection.iceConnectionState||"completed"===this.peerConnection.iceConnectionState))return;this.noRelayIceCandidates=!this.noRelayIceCandidates,this.ufdManager.signalEvent("NetworkRelaysNotReachable",this.noRelayIceCandidates?"Bad":"Good")}}},WebRtcSession2.prototype.hasIceCandidates=function(F){return this.configProvider.mediaConfig.isTransportUnbundled?F.hasUnbundledIceCandidates():F.hasIceCandidates()},WebRtcSession2.prototype.hasRelayIceCandidates=function(F){return this.configProvider.mediaConfig.isTransportUnbundled?F.hasUnbundledRelayIceCandidates():F.hasRelayIceCandidates()},WebRtcSession2.prototype.doRetargetIfNeeded=function(F,B,G){var W=B.isIceRestart();this.logger.safe.info("[".concat(G,"] ICE restart: ").concat(W)),this.context.configProvider.mediaConfig.isTransportUnbundled&&this.offeredDescription&&this.offeredDescription.isMSRTC()&&W&&!this.multiParty&&B.getSrtpInfo().sdes&&(F.newOffer=!0)},WebRtcSession2.prototype.notifyStreamsChanged=function(){var F=this;this.logger.safe.info("Scheduling stream changed notification: ".concat(this.streamsChangedNotificationScheduled)),this.streamsChangedNotificationScheduled||this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){F.streamsChangedNotificationScheduled=!1,F.streamsChangedListener&&F.streamsChangedListener()}))},WebRtcSession2.prototype.streamAdded=function(F){return W(this,void 0,void 0,(function(){var B,G;return z(this,(function(W){switch(W.label){case 0:return ae.default.MODALITY.audio!==F.getModality()?[3,3]:(B=F.getMediaStream(),[4,this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId())]);case 1:return W.sent(),[4,this.audioRenderer.play(B)];case 2:W.sent(),this.rawIncomingAudioStreamManager.streamChanged(B),W.label=3;case 3:return this.configProvider.config.mapSsrcToTrackForStats&&(G=this.mediaManager.getMediaEntityByRemoteStreamId(F.getMediaStream().id),this.statsGatherer.setSsrcTrackPair(G.getRemoteSsrc(),G.getRemoteTrackId())),this.notifyStreamsChanged(),[2]}}))}))},WebRtcSession2.prototype.streamRemoved=function(F){ae.default.MODALITY.audio===F.getModality()&&this.audioRenderer.getStream()===F.getMediaStream()&&(this.audioRenderer.stop(),this.rawIncomingAudioStreamManager.streamChanged(null)),this.clearReceiveStreamTransforms(F.getReceiver()),F.dispose(),this.notifyStreamsChanged()},WebRtcSession2.prototype.setNegotiatedModalities=function(F){this.negotiatedModalities=F,this.statsGatherer.sessionInfo.setNegotiatedModalities(F),this.diagnostics&&(this.diagnostics.negotiatedModalities=F)},WebRtcSession2.prototype.setupIceGatheringTimeout=function(F){var B=this;this.iceRelayCandidatesGatherStartTime=Date.now();var G=this.context.config.webrtcIceGatheringTimeoutIncreased?this.configProvider.config.relayWaitSaneTimeoutMs:this.configProvider.config.webrtcIceGatheringTimeoutMs;if(G){this.iceCandidatesTimer>0&&clearTimeout(this.iceCandidatesTimer);var W=this.iceCandidatesDeferred;this.iceCandidatesTimer=setTimeout((function(){B.iceCandidatesTimer=0,W.isPending&&(B.logger.safe.warn("[".concat(F,"] ICE candidates gathering terminated due to timeout ").concat(G)),W.resolve())}),G)}},WebRtcSession2.prototype.isConnected=function(){return this.peerConnection&&("connected"===this.lastTransportConnectionState||"completed"===this.lastTransportConnectionState)},WebRtcSession2.prototype.isFailed=function(){return this.peerConnection&&("failed"===this.lastTransportConnectionState||"closed"===this.lastTransportConnectionState)},WebRtcSession2.prototype.isIceConnected=function(){var F,B;return"connected"===(null===(F=this.peerConnection)||void 0===F?void 0:F.iceConnectionState)||"completed"===(null===(B=this.peerConnection)||void 0===B?void 0:B.iceConnectionState)},WebRtcSession2.prototype.createReceiveStream=function(F,B,G,W){var z=this,K=this.configProvider.config.addFmtpToInitialSubscription?W.getVideoCapabilities():null,J=this.configProvider.config.useMultiviewLimitsOnInitialRequest&&W.getModality()!==ae.default.MODALITY.sharing?function(){return z.remoteVideoManager.getMaxAllowedVideoFS()}:null,Q=new _e.default(F,B,W.getModality(),+W.getXSourceStreamId(),this,K,J);return this.unifiedPlanEnabled?new Oe.default(Q,G,this.receiveStreamCollection,this.logger.createChild("RecvStream"),this.configProvider.config):Q},WebRtcSession2.prototype.requestSource=function(F,B,G,W){var z=this;if(!this.multiParty)return Promise.resolve();if((this.isMuteHold||this.negotiatedModalities[F]===ae.default.MEDIA_STATE.inactive)&&G!==ne.MediaSourceIdentifiers.SourceNone)return Y.delay(10).then((function(){return z.requestSource(F,B,G,W)}));if(this.negotiationCompletedPromise.isPending)return this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){return z.requestSource(F,B,G,W)}));if(!this.isConnected()){this.logger.safe.info("requestSource is postponed till transport is connected");var K=Y.defer();return this.toBeCalledAfterConnected.push((function(){return K.resolve()})),K.promise.then((function(){return z.requestSource(F,B,G,W)}))}return Promise.resolve().then((function(){return z.extensionsManager.getExtension(ae.default.EXTENSION_TYPE.videoStreamControl).sendSourceRequest(B,G,W)}))},WebRtcSession2.prototype.assureStreamsAndDataChannel=function(F,B){return W(this,void 0,void 0,(function(){var G;return z(this,(function(W){switch(W.label){case 0:return this.logger.safe.info("[".concat(B,"] assureStreamsAndDataChannel "),this.negotiatedModalities,"offered",this.offeredModalities," mod ",F),this.dataChannel&&this.dataChannel.updateDataModalityState(F.data),[4,this.configureHold(this.negotiatedModalities,F,B)];case 1:return W.sent()?(this.logger.safe.info("[".concat(B,"] Hold is configured. Not updating streams")),[2,F]):[4,this.streamSendersManager.update(F,!1,B)];case 2:return G=W.sent(),this.dataChannel&&F.data&&(G.data=F.data),[2,G]}}))}))},WebRtcSession2.prototype.configureHold=function(F,B,G){return W(this,void 0,void 0,(function(){var W,K;return z(this,(function(z){switch(z.label){case 0:return W=le.isOnHold(F),K=le.isOnHold(B),W===K?[3,2]:[4,this.streamSendersManager.setHold(K,G)];case 1:z.sent(),z.label=2;case 2:return[2,K]}}))}))},WebRtcSession2.prototype.getStreamTransformConfiguration=function(){return{unifiedPlanEnabled:this.unifiedPlanEnabled,addPrefixForMsid:this.configProvider.config.addPrefixForMsidInSdp}},WebRtcSession2.prototype.applyReceiveCapabilities=function(F){this.multiParty||this.qualityManager.setMaxCapabilities(F)},WebRtcSession2.prototype.onReceiveCapabilitiesChanged=function(F,B,G){return W(this,void 0,void 0,(function(){return z(this,(function(W){switch(W.label){case 0:if(!this.streamSendersManager)return[2,!1];W.label=1;case 1:return W.trys.push([1,3,,4]),[4,this.streamSendersManager.applyCapabilities(B,F,G)];case 2:return W.sent(),[2,!0];case 3:return W.sent(),[2,!1];case 4:return[2]}}))}))},WebRtcSession2.prototype.onOptimalVideoReceiversCountChanged=function(F){this.callback.onOptimalVideoReceiversCountChanged&&this.callback.onOptimalVideoReceiversCountChanged(F)},WebRtcSession2.prototype.onSendBandwidthChanged=function(F){return W(this,void 0,void 0,(function(){var B,G,W=this;return z(this,(function(z){return this.isConnected()?(B=this.extensionsManager.getExtension(ae.default.EXTENSION_TYPE.videoStreamControl),0===(G=this.mediaManager.getMediaEntities().filter((function(F){return[ae.default.MODALITY.video,ae.default.MODALITY.sharing].indexOf(F.getModality())>-1})).filter((function(F){return F.isEnabled()})).map((function(F){return F.getMid()}))).length?[2]:[2,B.sendBandwidthInfo(G,F).then((function(){W.statsGatherer.setReportedSendBandwidth(F),W.diagnostics&&(W.diagnostics.reportedSendBandwidth=F)}))]):[2]}))}))},WebRtcSession2.prototype.onMaxVideoSendCapabilitiesChanged=function(F,B){var G=this;if("Video"===F&&this.configProvider.config.maxSendVideoCapabilitiesReportingForVideoEnabled||"ScreenShare"===F&&this.configProvider.config.maxSendVideoCapabilitiesReportingForSharingEnabled)return this.isConnected()?void this.notifyMaxVideoCapabilitiesChanged(F,B):(this.logger.safe.info("sendMaxVideoSendCapabilities is postponed till transport is connected"),void this.toBeCalledAfterConnected.push((function(){return G.notifyMaxVideoCapabilitiesChanged(F,B)})))},WebRtcSession2.prototype.notifyMaxVideoCapabilitiesChanged=function(F,B){var G=this.extensionsManager.getExtension(ae.default.EXTENSION_TYPE.videoStreamControl),W=le.mediaTypeToModality(F),z=this.mediaManager.getMediaEntitiesByModality(W)[0];if(z){var K=z.getMid();G.sendMaxVideoSendCapabilities([K],B)}},WebRtcSession2.prototype.createAudioRenderer=function(){this.audioRenderer=new Z.default(this.logger.createChild("AudioRenderer"),this.configProvider),this.context.maContext.domOverrides.onMediaElementAdded&&this.audioRenderer.on("onAudioElementAdded",this.context.maContext.domOverrides.onMediaElementAdded),this.context.maContext.domOverrides.onMediaElementRemoved&&this.audioRenderer.on("onAudioElementRemoved",this.context.maContext.domOverrides.onMediaElementRemoved)},WebRtcSession2.prototype.getModalitiesForRollback=function(F){var B=le.removeChangedSendDirection(this.negotiatedModalities,this.negotiatingModalities);return this.logger.safe.debug("[".concat(F,"] configured modalities for rollback: ").concat(JSON.stringify(B))),B},WebRtcSession2.prototype.fixLocalDescription=function(F){this.configProvider.config.insertFakeCandidateIfNeeded&&(this.iceCandidateReceived||!this.iceCandidateReceived&&this.isIceConnected())&&F.insertFakeCandidateIfNeeded(this.statsGatherer.sessionInfo,this.diagnostics),this.unifiedPlanEnabled&&F.fixDataModality()},WebRtcSession2.prototype.getSessionConfig=function(){return this.configProvider},WebRtcSession2.prototype.getLocalMediaTrackId=function(F){var B=this.mediaManager.getLocalTracksInfo(),G=le.mediaTypeToModality(F),W=B.find((function(F){return F.modality===G}));return W?W.trackId:null},WebRtcSession2.prototype.addReceiveStreamTransforms=function(F,B){var G,W=this.encStreamsManager.getOrCreateStreamTransformer(F);W&&B!==ae.default.MODALITY.audio&&(null===(G=this.configProvider.config.useInsertableStreams)||void 0===G?void 0:G.videoStreamAnalyzer)&&W.addTransform(new Se.VideoStreamAnalyzer(this.logger.createChild("RecvStreamAnalyzer [".concat(B,"/").concat(F.track.id,"]"))))},WebRtcSession2.prototype.clearReceiveStreamTransforms=function(F){var B=this.encStreamsManager.getStreamTransformer(F);null==B||B.clearTransforms()},WebRtcSession2.prototype.checkVideoCodecsSupport=function(){var F;return W(this,void 0,void 0,(function(){var B,G,W,J,Q,Y,$;return z(this,(function(z){switch(z.label){case 0:return[4,this.webrtcAdapter.RTCRtpReceiver.getCapabilities("video")];case 1:B=z.sent(),this.statsGatherer.setH264AvailableProfiles(B),this.diagnostics&&(this.diagnostics.videoCapabilities=B),G=new Set((null===(F=null==B?void 0:B.codecs)||void 0===F?void 0:F.map((function(F){return F.mimeType.toLocaleLowerCase()})))||[]);try{for(W=K(this.configProvider.config.requiredVideoCodecs),J=W.next();!J.done;J=W.next())if(Q=J.value,!G.has(Q)){this.ufdManager.signalEvent("NoRequiredVideoCodecs","Bad","Video");break}}catch(F){Y={error:F}}finally{try{J&&!J.done&&($=W.return)&&$.call(W)}finally{if(Y)throw Y.error}}return[2]}}))}))},WebRtcSession2.prototype.getMediaDescriptions=function(F){var B,G,W,z;if(le.isOnHold(F))return{};var Q=[];try{for(var Y=K([ae.default.MODALITY.video,ae.default.MODALITY.sharing]),$=Y.next();!$.done;$=Y.next()){var X=$.value;try{for(var Z=(W=void 0,K(this.mediaManager.getMediaEntitiesByModality(X).entries())),ee=Z.next();!ee.done;ee=Z.next()){var te=J(ee.value,2),ne=te[0],ie={mid:te[1].getMid(),direction:0===ne?F[X]:ae.default.MEDIA_STATE.receive};Q.push(ie)}}catch(F){W={error:F}}finally{try{ee&&!ee.done&&(z=Z.return)&&z.call(Z)}finally{if(W)throw W.error}}}}catch(F){B={error:F}}finally{try{$&&!$.done&&(G=Y.return)&&G.call(Y)}finally{if(B)throw B.error}}return{descriptions:Q}},WebRtcSession2.prototype.updateSendStreamsReinviteless=function(F){return W(this,void 0,void 0,(function(){var B,G;return z(this,(function(W){switch(W.label){case 0:return[4,this.assureStreamsAndDataChannel(this.configuredModalities,F)];case 1:return B=W.sent(),this.setNegotiatedModalities(B),G=this.getMediaDescriptions(B),this.callbacks.onUpdateMediaDescriptions&&this.callbacks.onUpdateMediaDescriptions(G,F),[2]}}))}))},WebRtcSession2.prototype.setBWSeed=function(F){this.configProvider.config.setBWSeed&&(F.applyChannelParameters={multiChannelParameter:{mids:["*"],mediaParameter:JSON.stringify({sendSideBWSeed:{seedValueBitsPerSec:this.configProvider.config.defaultBWSeed}})}})},WebRtcSession2.prototype.getSubscriptionManager=function(){return this.subscriptionManager},WebRtcSession2}();B.default={build:function(F,B,G){return new Ne(F,B,G)}}},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.MediaConnection=void 0;var K=function(){function MediaConnection(F){this.peerConnection=F}return Object.defineProperty(MediaConnection.prototype,"connectionState",{get:function(){return this.peerConnection.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(MediaConnection.prototype,"pc",{get:function(){return this.peerConnection},enumerable:!1,configurable:!0}),MediaConnection.prototype.createSender=function(F,B,G){return W(this,void 0,void 0,(function(){return z(this,(function(G){return[2,this.peerConnection.addTrack(F,B)]}))}))},MediaConnection.prototype.removeSender=function(F){this.peerConnection.removeTrack(F)},MediaConnection}();B.MediaConnection=K;var J=function(){function TranscieverBasedConnection(F,B){this.peerConnection=F,this.tranceiverManager=B}return Object.defineProperty(TranscieverBasedConnection.prototype,"connectionState",{get:function(){return this.peerConnection.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(TranscieverBasedConnection.prototype,"pc",{get:function(){return this.peerConnection},enumerable:!1,configurable:!0}),TranscieverBasedConnection.prototype.createSender=function(F,B,G){return W(this,void 0,void 0,(function(){return z(this,(function(W){return[2,this.tranceiverManager.createSender(F,B,G)]}))}))},TranscieverBasedConnection.prototype.removeSender=function(F){return this.tranceiverManager.removeSender(F)},TranscieverBasedConnection}(),Q=function(){function MediaConnectionFactory(){}return MediaConnectionFactory.build=function(F,B){return B?new J(F,B):new K(F)},MediaConnectionFactory}();B.default=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MediaManagerFactory=void 0;var W=G(150),z=G(427),K=function(){function MediaManagerFactory(){}return MediaManagerFactory.build=function(F){return F.unifiedPlanEnabled?new z.default(F):new W.default(F)},MediaManagerFactory}();B.MediaManagerFactory=K},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(83),z=G(4),K=G(10),J=G(428),Q=G(151),Y=G(39),$={toffset:"toffset","abs-send-time":"abs-send-time","video-orientation":"video-orientation","draft-holmer-rmcat-transport-wide-cc-extensions-01":"transport-cc","video-content-type":"video-content-type","video-timing":"video-timing","color-space":"color-space","video-layers-allocation00":"vla",mid:"mid","rtp-stream-id":"rid","repaired-rtp-stream-id":"rrid","fast_bandwidth_feedback#version_3":"fast_bandwidth_feedback#version_3","frame-counters-gvc":"frame-counters-gvc"},X=function(){function MediaManager2(F){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.ssrcGenerator=new W.SsrcGenerator,this.logger=F.logger.createChild("MM2"),this.configProvider=F.configProvider,this.useSimulcast=F.useSimulcast}return MediaManager2.prototype.fromOffer=function(F,B,G){var W=this;void 0===G&&(G=!1),this.updateMediaEntitiesFromModel(F,G),this.updateSharingEntity(!!B.sharing),F.media.forEach((function(F){var B=W.getMediaEntityByMid(F.mid);B&&W.saveLocalSsrc(B,F)}))},MediaManager2.prototype.fromRemote=function(F,B){var G=this;this.updateMediaEntitiesFromModel(F,!1),F.media.forEach((function(F,B){var W=G.getMediaEntityByMid(F.mid);if(W){G.saveRemoteMsid(W,F),G.saveRemoteSsrc(W,F),G.saveRtpHeaderExtensions(W,F);var z=F.xSourceStreamId||G.generateSourceStreamId(B);W.setXSourceStreamId(z)}}))},MediaManager2.prototype.isEmpty=function(){return 0===this.mediaEntities.length},MediaManager2.prototype.createMediaEntity=function(F,B){var G=Q.default.create(this.configProvider,F,B);return this.useSimulcast&&!this.mediaEntities.find((function(B){return B.getModality()===F}))&&this.setSimulcastContext(G),this.mediaEntities.push(G),G},MediaManager2.prototype.getMediaEntities=function(){return this.mediaEntities},MediaManager2.prototype.getMediaEntity=function(F){return this.mediaEntities[F]},MediaManager2.prototype.getMediaEntityByMid=function(F){return this.mediaEntities.find((function(B){return B.getMid()===F}))},MediaManager2.prototype.getMediaEntitiesByModality=function(F){return this.mediaEntities.filter((function(B){return B.getModality()===F}))},MediaManager2.prototype.getMediaEntitiesByMediaType=function(F){var B=K.modalityToMediaType(F);return this.getMediaEntitiesByModality(B)},MediaManager2.prototype.getMediaEntityByRemoteStreamId=function(F){return this.mediaEntities.find((function(B){return B.getRemoteStreamId()===F}))},MediaManager2.prototype.getMediaEntityByLocalTrackId=function(F){return this.mediaEntities.find((function(B){return B.getLocalTrackId()===F}))},MediaManager2.prototype.getMediaEntityByXSourceStreamId=function(F){return this.mediaEntities.find((function(B){return B.getXSourceStreamId()===F}))},MediaManager2.prototype.reset=function(){this.mediaEntities=[]},MediaManager2.prototype.syncModalities=function(F,B,G){void 0===G&&(G=!1),this.fromOffer(F,B,G)},MediaManager2.prototype.setLocalTracksInfo=function(F){this.mediaTracks=F},MediaManager2.prototype.getLocalTracksInfo=function(){return this.mediaTracks},MediaManager2.prototype.backup=function(){var F=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach((function(B){F.mediaEntitiesBackup.push(B.clone())}))},MediaManager2.prototype.commit=function(){this.mediaEntitiesBackup=[],this.mediaEntities.forEach((function(F){F.setExtension("unnegotiatedModality",!1)}))},MediaManager2.prototype.rollback=function(){var F=this;this.mediaEntitiesBackup.length&&this.mediaEntities.forEach((function(B,G){F.mediaEntitiesBackup[G]?F.mediaEntities[G]=F.mediaEntitiesBackup[G]:(B.disable(),B.setExtension("rollback",!0))}))},MediaManager2.prototype.updateMediaEntitiesWithLocalTracks=function(){var F=this;this.mediaTracks&&(this.mediaEntities.forEach((function(F){return F.setLocalTrackId(null)})),this.mediaTracks.forEach((function(B){var G=F.getMediaEntitiesByModality(B.modality)[0];G?G.setLocalTrackId(B.trackId):F.logger.safe.error("Media entity is not found for modality: ".concat(JSON.stringify(B.modality)))})))},MediaManager2.prototype.updateMediaEntitiesWithActivityState=function(F,B){this.logger.safe.debug("Updating activity indexes for ".concat(F," to ").concat(JSON.stringify(B)));var G=K.mediaTypeToModality(F),W=this.getMediaEntitiesByModality(G)[0];if(W){var z=W.getSimulcastContext();z&&(z.activeRids=B)}else this.logger.safe.error("Media entity is not found for modality: ".concat(JSON.stringify(G)))},MediaManager2.prototype.saveRtpHeaderExtensions=function(F,B){var G,W=this,z=null===(G=B.ext)||void 0===G?void 0:G.map((function(F){return W.getHeaderExtension(F)}));this.logger.debug("RTP header ext: ".concat(JSON.stringify(z))),F.setRtpHeaderExtensions(z)},MediaManager2.prototype.getHeaderExtension=function(F){var B="unknown";return Object.entries($).forEach((function(G){var W=G[0],z=G[1];F.uri.includes(W)&&(B=z)})),{headerType:B,value:F.value}},MediaManager2.prototype.saveRemoteMsid=function(F,B){if(0===B.port)F.setRemoteStreamId(null);else if(B.msid)F.setRemoteStreamId(B.msid.split(" ")[0]);else if(B.ssrcs){var G=B.ssrcs.find((function(F){return"msid"===F.attribute}));G?F.setRemoteStreamId(G.value.split(" ")[0]):this.logger.safe.warn("No ssrc msid for media of type ".concat(B.type," with mid ").concat(B.mid))}},MediaManager2.prototype.saveRemoteSsrc=function(F,B){var G;if(null===(G=B.ssrcs)||void 0===G?void 0:G.length){var W=B.ssrcs[0];F.setRemoteSsrc(W.id)}},MediaManager2.prototype.saveLocalSsrc=function(F,B){var G,W,z=null===(W=null===(G=B.ssrcs)||void 0===G?void 0:G[0])||void 0===W?void 0:W.id;if(K.hasSendDirectionality(B.direction)){var J=z||F.getLocalSsrc()||this.ssrcGenerator.nextVideoStreamSsrc().min;F.setLocalSsrc(J)}else F.setLocalSsrc(z)},MediaManager2.prototype.updateMediaEntitiesFromModel=function(F,B){var G=this;F.media.forEach((function(F,W){G.mediaEntities[W]?0===F.port?G.mediaEntities[W].disable():G.mediaEntities[W].update(G.mediaEntities[W].getModality(),F.mid||G.mediaEntities[W].getMid()):B||G.createMediaEntity((0,Y.getModality)(F),F.mid||W.toString())}))},MediaManager2.prototype.updateSharingEntity=function(F){if(F&&!this.getMediaEntitiesByModality(z.default.MODALITY.sharing).length){var B=this.getMediaEntitiesByModality(z.default.MODALITY.video).pop();B.update(z.default.MODALITY.sharing,B.getMid())}},MediaManager2.prototype.setSimulcastContext=function(F){if(F&&!F.getSimulcastContext()){var B=new J.SimulcastDataContext(F,this.logger.createChild("SimContext:".concat(F.getModality())),this.configProvider);F.setSimulcastContext(B)}},MediaManager2.prototype.generateSourceStreamId=function(F){return F+10},MediaManager2}();B.default=X},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.SimulcastDataContext=void 0;var W=G(8),z=G(10),K=function(){function SimulcastDataContext(F,B,G){this.mediaEntity=F,this.logger=B,this.configProvider=G,this.activeRids=[],this.isLocalDescSet=!1,this.enabledLocally=!1,this.enabledRemotely=!1;var W=z.modalityToMediaType(this.mediaEntity.getModality());this.config=z.getSimulcastConfigForMediaType(W,this.configProvider),this.config?this.logger.safe.debug("Adding simulcast info to ".concat(F.getModality()," with mid: ").concat(F.getMid(),", config: ").concat(JSON.stringify(this.config))):this.logger.safe.debug("Simulast is disabled for ".concat(F.getModality()))}return Object.defineProperty(SimulcastDataContext.prototype,"ridList",{get:function(){return this.config?(0,W.times)(this.config.layerScaleFactors.length,(function(F){return F+1})):[]},enumerable:!1,configurable:!0}),SimulcastDataContext.prototype.localDescriptionIsApplied=function(){this.isLocalDescSet=!0},SimulcastDataContext.prototype.enableInLocalDesc=function(){this.enabledLocally=!0},SimulcastDataContext.prototype.shouldBeEnabledInLocalDesc=function(){return!!this.config&&(this.config.enableLocally||this.enabledRemotely)},SimulcastDataContext.prototype.enableInRemoteDesc=function(){this.enabledRemotely=!0},SimulcastDataContext.prototype.shouldBeEnabledInRemoteDesc=function(){return!!this.config&&(this.enabledLocally||this.config.allowEnableRemotely&&this.isMidRidHeaderExtPresented()&&!this.isLocalDescSet)},SimulcastDataContext.prototype.shouldUseSimulcast=function(){return this.shouldBeEnabledInLocalDesc()},SimulcastDataContext.prototype.getSsrcRange=function(){return this.shouldUseSimulcast()?99:0},SimulcastDataContext.prototype.isMidRidHeaderExtPresented=function(){var F=this.mediaEntity.getRtpHeaderExtensions();return null==F?void 0:F.some((function(F){return"mid"===F.headerType||"rid"===F.headerType||"rrid"===F.headerType}))},SimulcastDataContext}();B.SimulcastDataContext=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.SessionDataChannel=void 0;var K=G(6),J=G(1),Q=G(4),Y=G(430),$=G(13),X="main-channel",Z=function(F){function SessionDataChannel(B,G,W){var z=this,K=W.createChild("PluginlessDataChannel");return(z=F.call(this,K)||this).pc=B,z.statsGatherer=G,z._state="Inactive",z.logger=K,z.subscribeOnDatachannel(),z}return z(SessionDataChannel,F),Object.defineProperty(SessionDataChannel.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),SessionDataChannel.prototype.getDataChannel=function(F){if(!this.dataChannel){this.logger.safe.info("[".concat(F,"] creating new dataChannel"));try{var B={};this.dataChannel=new Y.WebRtcDataChannel(this.pc.createDataChannel(X,B),this.statsGatherer,this.logger),this.subscribeForDataChannelEvents()}catch(B){return this.logger.safe.error("[".concat(F,"] createDataChannel failed: ").concat(J.stringifyObject(B))),this.statsGatherer.recordDataChannelCreationFailure(B),this.setState("Failed"),null}}return this.dataChannel},SessionDataChannel.prototype.updateDataModalityState=function(F){"Failed"!==this._state&&(F===Q.default.MEDIA_STATE.sendReceive?this.setState("Active"):F===Q.default.MEDIA_STATE.inactive&&this.setState("Inactive"))},SessionDataChannel.prototype.dispose=function(){this.stopDataChannel(),this.pc=null,F.prototype.dispose.call(this)},SessionDataChannel.prototype.subscribeOnDatachannel=function(){var F=this;this.pc.ondatachannel=function(B){F.onDataChannel(B.channel)}},SessionDataChannel.prototype.onDataChannel=function(F){this.logger.safe.info("onDataChannel id=".concat(F.id," label=").concat(F.label)),F.id%2==0?this.dataChannel?(this.logger.safe.info("Found existing data channel, replacing"),this.dataChannel.setDataChannel(F)):(this.dataChannel=new Y.WebRtcDataChannel(F,this.statsGatherer,this.logger),this.subscribeForDataChannelEvents()):this.logger.safe.info("onDataChannel ignoring id ".concat(F.id))},SessionDataChannel.prototype.subscribeForDataChannelEvents=function(){var F=this;this.dataChannel.on("onStateChanged",(function(){"Closed"===F.dataChannel.state&&(F.stopDataChannel(),F.setState("Inactive"))}))},SessionDataChannel.prototype.setState=function(F){if(this._state!==F){this.statsGatherer.setSessionDataChannelState(F);var B=(0,$.generateCauseId)();this._state=F,this.logger.safe.info("[".concat(B,"] SessionDataChannelState changed, state=").concat(this._state)),"Inactive"===this._state?this.stopDataChannel():"Active"===this._state&&this.getDataChannel(B),this.event("onStateChanged").raise(this._state)}},SessionDataChannel.prototype.stopDataChannel=function(){this.dataChannel&&(this.logger.safe.info("stopDataChannel"),this.dataChannel.dispose(),this.dataChannel=null)},SessionDataChannel}(K.default);B.SessionDataChannel=Z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.WebRtcDataChannel=void 0;var J=G(6),Q=G(1),Y=G(144),$=function(){function Depacketizer(F,B,G){this.dataId=F,this.statsGatherer=B,this.logger=G,this.pendingFragments=[]}return Depacketizer.prototype.depacketize=function(F){var B,G,W=new DataView(F.buffer),z=63&W.getUint8(2);if(z!==this.dataId)throw new Error("Invalid packet dataId: ".concat(this.dataId," !== ").concat(z));var J=11,Q=((15&W.getUint8(0))<<8)+W.getUint8(1),$=128&W.getUint8(2),X=W.getUint16(3),Z=W.getUint8(5),ee=W.getUint32(6),te=W.getUint8(10);if(void 0!==this.nextSeqNum&&this.nextSeqNum!==X&&this.statsGatherer.recordDataChannelProtocolEvent({direction:"recv",state:Y.DataChannelProtocolEventState.OUT_OF_ORDER,dataId:z}),$){this.pendingFragments.length&&this.logger.warn("Unfinished message: dataId: ".concat(this.dataId," seqNum: ").concat(X)),this.remainingPackets=Z,this.pendingFragments=[],this.sourceId=ee,this.recipients=[];for(var ne=0;ne<te;ne++){var ie=W.getUint32(J+4*ne);this.recipients.push(ie)}}else{if(this.statsGatherer.recordDataChannelProtocolEvent({direction:"recv",state:Y.DataChannelProtocolEventState.FRAGMENTED,dataId:z}),0===this.pendingFragments.length)return this.logger.safe.error("No start flag dataId: ".concat(this.dataId," seqNum: ").concat(X)),this.statsGatherer.recordDataChannelProtocolEvent({direction:"recv",state:Y.DataChannelProtocolEventState.DISMISSED,dataId:z}),null;if(this.nextSeqNum!==X)return this.logger.safe.error("Invalid sequence number: dataId: ".concat(this.dataId," seqNum: ").concat(X)),this.statsGatherer.recordDataChannelProtocolEvent({direction:"recv",state:Y.DataChannelProtocolEventState.DISMISSED,dataId:z}),null;this.remainingPackets-=1,this.remainingPackets!==Z&&this.logger.warn("Invalid remainingPackets: dataId: ".concat(this.dataId," remainingPackets: ").concat(Z," !== ").concat(this.remainingPackets))}if(this.nextSeqNum=X+1&65535,this.pendingFragments.push(F.slice(Q)),0===this.remainingPackets){var re=this.pendingFragments.reduce((function(F,B){return F+B.length}),0),oe=new Uint8Array(re),ae=0;try{for(var se=K(this.pendingFragments),ce=se.next();!ce.done;ce=se.next()){var le=ce.value;oe.set(le,ae),ae+=le.length}}catch(F){B={error:F}}finally{try{ce&&!ce.done&&(G=se.return)&&G.call(se)}finally{if(B)throw B.error}}return this.pendingFragments=[],{dataId:this.dataId,sourceId:this.sourceId,data:oe,recipients:this.recipients}}return null},Depacketizer}(),X=function(){function Packetizer(F){this.seqNum=0,this.dataId=F}return Packetizer.prototype.packetize=function(F){if(F.dataId!==this.dataId)throw new Error("Invalid dataId: ".concat(this.dataId," !== ").concat(F.dataId));var B=11,G=B+4*F.recipients.length,W=new Uint8Array(F.data.length+G),z=new DataView(W.buffer);z.setUint8(0,16+(G>>8)),z.setUint8(1,255&G),z.setUint8(2,128|63&F.dataId),z.setUint16(3,this.seqNum),z.setUint8(5,0),z.setUint32(6,F.sourceId),z.setUint8(10,F.recipients.length);for(var K=0;K<F.recipients.length;K++)z.setUint32(B+4*K,F.recipients[K]);return W.set(F.data,G),this.seqNum+=1,[W]},Packetizer}(),Z=function(F){function WebRtcDataChannel(B,G,W){var z=F.call(this)||this;return z.dataChannel=B,z.statsGatherer=G,z.stateInternal="Created",z.packetizers=new Map,z.depacketizers=new Map,z.label=B.label,z.logger=W.createChild("[WebRtcDataChannel ".concat(z.label,"]")),z.subscribeOnDataChannelEvents(),z}return z(WebRtcDataChannel,F),Object.defineProperty(WebRtcDataChannel.prototype,"state",{get:function(){return this.stateInternal},enumerable:!1,configurable:!0}),WebRtcDataChannel.prototype.setDataChannel=function(F){this.dataChannel&&(this.logger.info("Replacing internal data channel ".concat(this.label,":").concat(this.dataChannel.id," with ").concat(F.label,":").concat(F.id)),this.unsubscribeOnDataChannelEvents(),this.dataChannel.close()),this.dataChannel=F,this.subscribeOnDataChannelEvents()},WebRtcDataChannel.prototype.dispose=function(){this.logger.info("dispose"),this.dataChannel&&(this.logger.info("dataChannel.close ".concat(this.dataChannel.id)),this.dataChannel.close(),this.dataChannel=null,this.setState("Destroyed"),F.prototype.dispose.call(this))},WebRtcDataChannel.prototype.sendMessage=function(F,B,G,W){var z=this;void 0===W&&(W=[]);try{this.packetizers.has(F)||this.packetizers.set(F,new X(F)),this.packetizers.get(F).packetize({dataId:F,sourceId:B,data:G,recipients:W}).forEach((function(F){z.dataChannel.send(F)})),this.statsGatherer.recordDataChannelProtocolEvent({direction:"send",state:Y.DataChannelProtocolEventState.PARSE_SUCCESS,dataId:F})}catch(B){this.logger.unsafe.warn("Failed to send or construct protocol message: ".concat(Q.stringifyObject(B))),this.statsGatherer.recordDataChannelProtocolEvent({direction:"send",state:Y.DataChannelProtocolEventState.PARSE_FAIL,dataId:F})}},WebRtcDataChannel.prototype.subscribeOnDataChannelEvents=function(){var F=this;this.dataChannel.binaryType="arraybuffer",this.dataChannel.onmessage=function(B){var G=new Uint8Array(B.data),W=63&G[2];try{F.depacketizers.has(W)||F.depacketizers.set(W,new $(W,F.statsGatherer,F.logger));var z=F.depacketizers.get(W).depacketize(G);z&&(F.statsGatherer.recordDataChannelProtocolEvent({direction:"recv",state:Y.DataChannelProtocolEventState.PARSE_SUCCESS,dataId:W}),F.event("onmessage").raise(W,z.sourceId,z.data))}catch(B){F.logger.unsafe.warn("Failed to parse incoming message: ".concat(Q.stringifyObject(B))),F.statsGatherer.recordDataChannelProtocolEvent({direction:"recv",state:Y.DataChannelProtocolEventState.PARSE_FAIL,dataId:W})}},this.dataChannel.onerror=function(B){var G,W=null==B?void 0:B.target;F.logger.safe.warn("onerror: label:".concat(W.label," id:").concat(W.id," ").concat(Q.stringifyObject(null!==(G=null==B?void 0:B.error)&&void 0!==G?G:B)," "))},"open"===this.dataChannel.readyState&&this.dataChannel.id%2==0&&(this.logger.safe.info("readyState is already 'open' label:".concat(this.dataChannel.label," id:").concat(this.dataChannel.id)),this.setState("Connected")),this.dataChannel.onopen=function(B){var G=B.target;F.logger.safe.info("onopen label:".concat(G.label," id:").concat(G.id)),G.id%2==0&&F.setState("Connected")},this.dataChannel.onclose=function(B){var G=B.target;F.logger.safe.info("onclose label:".concat(G.label," id:").concat(G.id)),F.setState("Closed")},this.dataChannel.onclosing=function(B){var G=B.target;F.logger.safe.debug("onclosing label:".concat(G.label," id:").concat(G.id)),F.setState("Closed")}},WebRtcDataChannel.prototype.unsubscribeOnDataChannelEvents=function(){this.dataChannel.onmessage=null,this.dataChannel.onerror=null,this.dataChannel.onopen=null,this.dataChannel.onclose=null,this.dataChannel.onclosing=null,this.dataChannel.onbufferedamountlow=null},WebRtcDataChannel.prototype.setState=function(F){this.stateInternal=F,this.event("onStateChanged").raise()},WebRtcDataChannel}(J.default);B.WebRtcDataChannel=Z},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},J=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},Q=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var Y=G(8),$=G(18),X=G(4),Z=G(10),ee=G(27),te=[X.default.MODALITY.audio,X.default.MODALITY.video,X.default.MODALITY.sharing],ne=function(){function TransceiverManager(F,B,G,W){this.peerConnection=B,this.mediaManager=G,this.entityTransceiverMap=new Map,this.logger=F.createChild("TM"),this.configProvider=W.configProvider,this.isMultiparty=W.config.isConference,this.isPstnCall=W.config.isPstnCall,this.isParkedCall=W.config.isParkedCall,this.numVideoChannels=this.isMultiparty&&this.configProvider.config.numVideoChannelsGvc||1}return TransceiverManager.prototype.getTransceivers=function(){return this.peerConnection.getTransceivers().filter(isActiveTransceiver)},TransceiverManager.prototype.assureTransceivers=function(F){this.assureNegotiatedOrder(),this.addModalities(F),this.logTransceiversInfo("assureTransceivers"),this.setDirections(F)},TransceiverManager.prototype.syncTransceivers=function(F){this.syncWithMediaEntities(),this.setDirections(F)},TransceiverManager.prototype.assureNegotiatedOrder=function(){var F=this,B=this.getTransceivers();this.mediaManager.getMediaEntities().forEach((function(G){-1!==te.indexOf(G.getModality())&&(isActiveTransceiverInPc(F.entityTransceiverMap.get(G),B)||F.createTransceiverForEntity(G))}))},TransceiverManager.prototype.addModalities=function(F){var B,G,W=this;this.isMultiparty||!this.mediaManager.isEmpty()||this.isPstnCall||(F.video=F.video||"inactive",F.sharing=F.sharing||"inactive"),this.configProvider.config.webrctRemoveVideoModalitiesForPstn&&this.isPstnCall&&!this.isParkedCall&&(delete F.video,delete F.sharing);var _loop_1=function(B){if(z.mediaManager.getMediaEntities().find((function(F){return B===F.getModality()}))||!F[B])return"continue";var G=B===X.default.MODALITY.video?z.numVideoChannels:1;Y.times(G,(function(){W.createTransceiverForEntity(W.mediaManager.createMediaEntity(B))}))},z=this;try{for(var J=K(te),Q=J.next();!Q.done;Q=J.next()){_loop_1(Q.value)}}catch(F){B={error:F}}finally{try{Q&&!Q.done&&(G=J.return)&&G.call(J)}finally{if(B)throw B.error}}},TransceiverManager.prototype.createTransceiverForEntity=function(F){var B=F.getModality();this.logger.safe.info("createTransceiver: modality=".concat(B));var G=B===X.default.MODALITY.audio?X.default.MEDIA_TYPE.audio:X.default.MEDIA_TYPE.video,W=F.getSimulcastContext(),z=this.createTransceiver(G,W);this.setCodecPreferences(z,G,!0),this.entityTransceiverMap.set(F,z),F.setExtension("unnegotiatedModality",!0)},TransceiverManager.prototype.setCodecPreferences=function(F,B,G){var W,z,Y,X,te=Z.getAllowedCodecs(this.configProvider,B);if((null==te?void 0:te.length)&&ee.UserAgentConfig.hasCapabilitiesApi()&&!this.configProvider.config.filterCodecsInSdp){var ne=$.default.window.RTCRtpReceiver.getCapabilities(B);if(ne){var ie=[];if(G){var _loop_2=function(F){var B=ne.codecs.filter((function(B){return isCodecsMatch(F,B)}));ie.push.apply(ie,Q([],J(B),!1))};try{for(var re=K(te),oe=re.next();!oe.done;oe=re.next()){_loop_2(oe.value)}}catch(F){W={error:F}}finally{try{oe&&!oe.done&&(z=re.return)&&z.call(re)}finally{if(W)throw W.error}}}else{var _loop_3=function(F){te.some((function(B){return isCodecsMatch(B,F)}))&&ie.push(F)};try{for(var ae=K(ne.codecs),se=ae.next();!se.done;se=ae.next()){_loop_3(se.value)}}catch(F){Y={error:F}}finally{try{se&&!se.done&&(X=ae.return)&&X.call(ae)}finally{if(Y)throw Y.error}}}ie.length&&F.setCodecPreferences&&F.setCodecPreferences(ie)}}},TransceiverManager.prototype.createSender=function(F,B,G){return W(this,void 0,void 0,(function(){var W;return z(this,(function(z){switch(z.label){case 0:return[4,this.assosiateTrackWithTransceiver(F,B,G)];case 1:if(!(W=z.sent()))throw new Error("Transceiver for modality=".concat(G," is not found"));return W.direction=G===X.default.MODALITY.sharing?X.default.MEDIA_STATE.send:X.default.MEDIA_STATE.sendReceive,this.logger.safe.info("Replace track completed direction:".concat(W.direction," for transceiver mid=").concat(W.mid)),[2,W.sender]}}))}))},TransceiverManager.prototype.removeSender=function(F){var B,G,W=this.getTransceivers().find((function(B){return B.sender===F}));if(!W)throw new Error("Transceiver for sender with track=".concat(null===(B=F.track)||void 0===B?void 0:B.id," is not found"));this.logger.safe.info("Remove sender with track=".concat(null===(G=F.track)||void 0===G?void 0:G.id," for transceiver mid=").concat(W.mid)),this.peerConnection.removeTrack(F)},TransceiverManager.prototype.createTransceiver=function(F,B){var G={direction:"inactive"};return this.addSimulcastEnvelopeIfNeeded(G,B),this.peerConnection.addTransceiver(F,G)},TransceiverManager.prototype.addSimulcastEnvelopeIfNeeded=function(F,B){var G=this;(null==B?void 0:B.shouldUseSimulcast())&&(F.sendEncodings=Y.times(B.config.layerScaleFactors.length,(function(F){var W="".concat(B.ridList[F]),z=B.config.layerScaleFactors[F];return G.logger.safe.debug("Added layer ".concat(F," with rid: ").concat(W," SF: ").concat(z)),{rid:W,scaleResolutionDownBy:z}})))},TransceiverManager.prototype.assosiateTrackWithTransceiver=function(F,B,G){return W(this,void 0,void 0,(function(){var W,K;return z(this,(function(z){switch(z.label){case 0:if(!(W=this.findAvailableTransceiverToSend(G)))return[3,5];this.logger.safe.info("Associate track=".concat(null==F?void 0:F.id," (").concat(G,") with existing transceiver mid=").concat(W.mid)),z.label=1;case 1:return z.trys.push([1,3,,4]),[4,W.sender.replaceTrack(F)];case 2:return z.sent(),this.configProvider.config.useSetStreamsForSender&&W.sender.setStreams&&W.sender.setStreams(B),[3,4];case 3:throw K=z.sent(),this.logger.safe.error("replaceTrack failed, err ".concat(JSON.stringify(K))),K;case 4:return[2,W];case 5:return[2,null]}}))}))},TransceiverManager.prototype.syncWithMediaEntities=function(){var F=this,B=this.getTransceivers();this.mediaManager.getMediaEntities().forEach((function(G){var W=F.entityTransceiverMap.get(G);W=isActiveTransceiverInPc(W,B)?W:B.find((function(F){return F.mid===G.getMid()})),F.entityTransceiverMap.set(G,W)})),this.logTransceiversInfo("syncWithMediaEntities")},TransceiverManager.prototype.getTransceiversByModality=function(F){var B=this;return this.mediaManager.getMediaEntitiesByModality(F).map((function(F){return B.entityTransceiverMap.get(F)})).filter(isActiveTransceiver)},TransceiverManager.prototype.setDirections=function(F){var B,G,W=this.configProvider.config.enableReinviteless&&!Z.isOnHold(F),_loop_4=function(B){z.getTransceiversByModality(B).forEach((function(G,z){if(W&&B!==X.default.MODALITY.audio)G.direction="sendrecv";else{var K=F[B]||X.default.MEDIA_STATE.inactive;G.direction=0===z?K:removeSendDirectionality(K)}}))},z=this;try{for(var J=K(te),Q=J.next();!Q.done;Q=J.next()){_loop_4(Q.value)}}catch(F){B={error:F}}finally{try{Q&&!Q.done&&(G=J.return)&&G.call(J)}finally{if(B)throw B.error}}this.logTransceiversInfo("setDirections")},TransceiverManager.prototype.findAvailableTransceiverToSend=function(F){var B=this.mediaManager.getMediaEntitiesByModality(F)[0];return this.entityTransceiverMap.get(B)},TransceiverManager.prototype.logTransceiversInfo=function(F){var B,G,W="".concat(F,": transceivers details:");try{for(var z=K(te),J=z.next();!J.done;J=z.next()){var Q=J.value,Y=this.getTransceiversByModality(Q);W+=" ".concat(Q,"(").concat(Y.length,") [").concat(Y.map((function(F){return"mid=".concat(F.mid,", direction=").concat(F.direction)})).join(";"),"]")}}catch(F){B={error:F}}finally{try{J&&!J.done&&(G=z.return)&&G.call(z)}finally{if(B)throw B.error}}this.logger.safe.debug(W)},TransceiverManager}();function isCodecsMatch(F,B){return!(!Y.isUndefined(F.channels)&&F.channels!==B.channels)&&(!(!Y.isUndefined(F.clockRate)&&F.clockRate!==B.clockRate)&&(!(!Y.isUndefined(F.mimeType)&&F.mimeType.toLowerCase()!==B.mimeType.toLowerCase())&&!(!Y.isUndefined(F.sdpFmtpLine)&&-1===B.sdpFmtpLine.toLowerCase().indexOf(F.sdpFmtpLine.toLowerCase()))))}function removeSendDirectionality(F){var B=F;return Z.hasSendDirectionality(F)&&(B=Z.removeSendDirectionality(F)),B||X.default.MEDIA_STATE.inactive}function isActiveTransceiver(F){return F&&"stopped"!==F.direction&&!F.stopped}function isActiveTransceiverInPc(F,B){return isActiveTransceiver(F)&&-1!==B.indexOf(F)}B.default=ne},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.EncodedStreamsManager=void 0;var z=function(){function EncodedStreamsManager(F){var B;this.configProvider=F,this.transformersMap=new Map,(null===(B=this.configProvider.config.useInsertableStreams)||void 0===B?void 0:B.useWorker)&&(this.worker=new Worker("app_modules/skype-calling-pluginless/stream-transform-worker.bundle.js"))}return EncodedStreamsManager.prototype.getStreamTransformer=function(F){return this.transformersMap.get(F)},EncodedStreamsManager.prototype.getOrCreateStreamTransformer=function(F){if(!this.configProvider.config.useInsertableStreams||!F.createEncodedStreams)return null;if(this.transformersMap.has(F))return this.transformersMap.get(F);var B=F.createEncodedStreams(),G=this.worker?new J(this.worker,B):new K(B);return this.transformersMap.set(F,G),G},EncodedStreamsManager.prototype.dispose=function(){var F,B,G;try{for(var z=W(this.transformersMap.values()),K=z.next();!K.done;K=z.next()){K.value.clearTransforms()}}catch(B){F={error:B}}finally{try{K&&!K.done&&(B=z.return)&&B.call(z)}finally{if(F)throw F.error}}this.transformersMap.clear(),null===(G=this.worker)||void 0===G||G.terminate()},EncodedStreamsManager}();B.EncodedStreamsManager=z;var K=function(){function EncodedStreamTransformer(F){var B=this;this.transforms=[];var G=new TransformStream({transform:function(F,G){return B.transform(F,G)}});F.readable.pipeThrough(G).pipeTo(F.writable)}return EncodedStreamTransformer.prototype.addTransform=function(F){this.transforms.push(F)},EncodedStreamTransformer.prototype.clearTransforms=function(){this.transforms=[]},EncodedStreamTransformer.prototype.transform=function(F,B){var G,z,K=F;try{for(var J=W(this.transforms),Q=J.next();!Q.done;Q=J.next()){K=Q.value.transform(F)}}catch(F){G={error:F}}finally{try{Q&&!Q.done&&(z=J.return)&&z.call(J)}finally{if(G)throw G.error}}K&&B.enqueue(K)},EncodedStreamTransformer}(),J=function(){function WorkerEncodedStreamTransformer(F,B){this.worker=F,this.transforms=[];var G=B.readable,W=B.writable;this.worker.postMessage({readable:G,writable:W},[G,W])}return WorkerEncodedStreamTransformer.prototype.addTransform=function(F){this.transforms.push(F)},WorkerEncodedStreamTransformer.prototype.clearTransforms=function(){this.transforms=[]},WorkerEncodedStreamTransformer}()},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},Y=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))},$=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.StreamSendersManager=void 0;var X=G(6),Z=G(33),ee=G(434),te=G(1),ne=G(4),ie=G(10),re=G(157),oe=G(435),ae=G(441),se=G(163),ce=function(F){function StreamSendersManager(B,G,W,z,K,J,Q,Y){var $,X=F.call(this,G)||this;return X.mediaManager=B,X.logger=G,X.configProvider=z,X.statisticsGatherer=K,X.diagnostics=J,X.isMultiparty=Q,X.encStreamsManager=Y,X.senders=new Map,X.previousMediaModalitites=(($={}).Audio=!1,$.Video=!1,$.ScreenShare=!1,$),X.serialQueue=new Z.PromiseQueue(X.logger),X.muted=new Map([["Audio",!1],["Video",!1]]),X.subs=new Map,X.senderId=0,X.streamsProvider=new ee.SessionStreamsProvider(W,X.serialQueue,X.logger.createChild("StreamsProvider")),X.subscribeToStreamProviderEvents(),X.localVideoStreamWatcher=new re.LocalVideoStreamWatcher(K,X.logger,X.configProvider),X.subscribeToStreamWatcherEvents(),X.configProvider.config.useMediaQualityController&&(X.mediaQualityController=new oe.MediaQualityController(X.statisticsGatherer,X.configProvider,X.logger.createChild("MQC")),X.mediaQualityController.on("onLayoutsUpdated",(function(F){return X.updateLayouts(F)}))),X}return z(StreamSendersManager,F),StreamSendersManager.prototype.dispose=function(){var B,G=this;this.senders.forEach((function(F,B){G.event("onSendStreamChanged").raise(null,B),F.dispose()})),this.senders.clear(),this.subs.forEach((function(F){return F.forEach((function(F){return F.dispose()}))})),this.subs.clear(),this.mediaConnection=null,this.unsubscribeFromStreamProviderEvents(),this.streamsProvider.stop(),this.streamsProvider=null,this.localVideoStreamWatcher.dispose(),this.localVideoStreamWatcher=null,this.mediaManager=null,this.logger=null,null===(B=this.mediaQualityController)||void 0===B||B.dispose(),this.mediaQualityController=null,F.prototype.dispose.call(this)},StreamSendersManager.prototype.registerMediaConnection=function(F){this.mediaConnection=F},StreamSendersManager.prototype.useNullAudioStreamClient=function(){this.streamsProvider.useNullAudioStreamClient()},StreamSendersManager.prototype.update=function(F,B,G){return K(this,void 0,void 0,(function(){var W,z;return J(this,(function(K){switch(K.label){case 0:return W=ie.getSendMediaModalities(F),[4,this.updateStreams(W,B)];case 1:return z=K.sent(),[4,this.updateSenders()];case 2:return K.sent(),this.applyMuteState(G,!0),this.setAndUpdateLocalTracksInfo(!1),this.previousMediaModalitites=te.shallowClone(z),[2,ie.mergeSendModalities(F,this.previousMediaModalitites)]}}))}))},StreamSendersManager.prototype.activate=function(){return K(this,void 0,void 0,(function(){var F=this;return J(this,(function(B){switch(B.label){case 0:return[4,Promise.all(Y([],Q(this.senders.values()),!1).map((function(B){return K(F,void 0,void 0,(function(){return J(this,(function(F){return[2,B.activate()]}))}))})))];case 1:return B.sent(),[2]}}))}))},StreamSendersManager.prototype.applyCapabilities=function(F,B,G){return K(this,void 0,void 0,(function(){var W,z;return J(this,(function(K){return this.logger.safe.info("[".concat(F,"] Applying incoming ").concat(B," FMTP: ").concat(JSON.stringify(G))),W=ie.modalityToMediaType(B),this.lastCauseId=F,z=G,this.mediaQualityController&&(this.mediaQualityController.addReceiver(W,G),z=this.mediaQualityController.getLayouts(W)),[2,this.updateParameters(F,W,z)]}))}))},StreamSendersManager.prototype.getLocalMediaSources=function(){var F=this,B=this.getTracksInfo(),G=[];return B.forEach((function(B){G.some((function(F){return F.modality===B.modality}))||G.push({sourceId:F.getSourceIdForTrack(B),modality:B.modality})})),G},StreamSendersManager.prototype.setMuted=function(F,B,G){this.muted.set(F,B),this.applyMuteState(G,!1)},StreamSendersManager.prototype.setHold=function(F,B){return K(this,void 0,void 0,(function(){var G=this;return J(this,(function(W){switch(W.label){case 0:return[4,Promise.all(Y([],Q(this.senders.values()),!1).map((function(W){return K(G,void 0,void 0,(function(){return J(this,(function(G){return[2,W.setHold(F,B)]}))}))})))];case 1:return W.sent(),[2]}}))}))},StreamSendersManager.prototype.updateParameters=function(F,B,G){var W,z;return K(this,void 0,void 0,(function(){var K,Q;return J(this,(function(J){switch(J.label){case 0:return J.trys.push([0,2,,3]),[4,this.applyCapabilitiesForMediaType(B,G)];case 1:return J.sent(),this.logger.safe.debug("[".concat(F,"] Capabilities completed")),Q={modality:ie.mediaTypeToModality(B),causeId:F,capabilities:G},this.statisticsGatherer.onMaxCapabilitiesApplied(Q),null===(W=this.diagnostics)||void 0===W||W.onMaxCapabilitiesApplied(Q),[3,3];case 2:return K=J.sent(),this.logger.safe.error("[".concat(F,"] Error applying capabilities ").concat(te.stringifyObject(K))),Q={modality:ie.mediaTypeToModality(B),causeId:F,capabilities:G,error:K},this.statisticsGatherer.onMaxCapabilitiesApplied(Q),null===(z=this.diagnostics)||void 0===z||z.onMaxCapabilitiesApplied(Q),[3,3];case 3:return[2]}}))}))},StreamSendersManager.prototype.applyCapabilitiesForMediaType=function(F,B){return K(this,void 0,void 0,(function(){var G;return J(this,(function(W){return(G=this.senders.get(F))?[2,G.updateParameters(B)]:(this.logger.safe.info("[".concat(this.lastCauseId,"] Capabilities ignored ").concat(JSON.stringify(B)," ignored, no sender for media type ").concat(JSON.stringify(F))),[2])}))}))},StreamSendersManager.prototype.applyMuteState=function(F,B){var G,W;try{for(var z=$(this.muted),K=z.next();!K.done;K=z.next()){var J=Q(K.value,2),Y=J[0],X=J[1];this.senders.get(Y)&&this.senders.get(Y).setMuted(X,F,B)}}catch(F){G={error:F}}finally{try{K&&!K.done&&(W=z.return)&&W.call(z)}finally{if(G)throw G.error}}},StreamSendersManager.prototype.setAndUpdateLocalTracksInfo=function(F){var B=this.getTracksInfo();this.mediaManager.setLocalTracksInfo(B),F&&(this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.configProvider.config.mapSsrcToTrackForStats&&this.statisticsGatherer.updateStatsWithLocalSsrcTrackInfo())},StreamSendersManager.prototype.getTracksInfo=function(){var F=[];return this.senders.forEach((function(B){F.push(B.getTrackInfo())})),F},StreamSendersManager.prototype.updateStreams=function(F,B){return K(this,void 0,void 0,(function(){var G;return J(this,(function(W){switch(W.label){case 0:return[4,this.streamsProvider.update(F,B)];case 1:return G=W.sent(),this.logger.safe.info("Streams updated, modalities requested: ".concat(JSON.stringify(F),", result: ").concat(JSON.stringify(G))),[2,G]}}))}))},StreamSendersManager.prototype.updateSenders=function(){return K(this,void 0,void 0,(function(){var F,B=this;return J(this,(function(G){switch(G.label){case 0:return[4,this.streamsProvider.ensureUpdateCompleted()];case 1:return G.sent(),F=ie.sendStreamsToModalities(this.streamsProvider.streams),[4,Promise.all(te.keys(F).map((function(G){return K(B,void 0,void 0,(function(){var B,W,z;return J(this,(function(K){switch(K.label){case 0:return B=F[G],W=this.previousMediaModalitites[G],B===W?(this.logger.safe.info("Sender for mediaType: ".concat(JSON.stringify(G)," are not changed. enabled=").concat(B)),[2]):B?[3,2]:(this.logger.safe.info("Removing sender for mediaType: ".concat(JSON.stringify(G))),[4,this.removeSender(G)]);case 1:return K.sent(),[2];case 2:return z=this.streamsProvider.streams[G],[4,this.createAndStartSender(z,G)];case 3:return K.sent(),this.logger.safe.info("Sender for mediaType: ".concat(JSON.stringify(G)," is added")),[4,this.addAudioSharingStream(z)];case 4:return K.sent(),this.event("onSendStreamChanged").raise(z,G),[2]}}))}))})))];case 2:return G.sent(),this.logger.safe.info("Senders updated"),[2]}}))}))},StreamSendersManager.prototype.createAndStartSender=function(F,B){var G=this;if(this.senders.get(B))throw new Error("Sender already created, modality: ".concat(JSON.stringify(B)));var W=this.mediaManager.getMediaEntitiesByModality(ie.mediaTypeToModality(B))[0],z=null==W?void 0:W.getSimulcastContext(),K="Audio"===B||!this.isMultiparty||!!(null==z?void 0:z.shouldUseSimulcast()),J=new ae.SimulcastStreamSender(this.mediaConnection,F,new MediaStream,B,this.serialQueue,this.logger.createChild("Sender_".concat(JSON.stringify(B),":").concat(this.senderId++)),this.configProvider,K,this.encStreamsManager,z);this.senders.set(B,J);var Q=[J.on("onSendersChanged",(function(F,B){return G.onSenderStateChanged(F,B)})),J.on("onNewStreamNeeded",(function(){return G.streamsProvider.requestStreamUpdate(B,!0)}))];return this.subs.set(J,Q),J.start()},StreamSendersManager.prototype.removeSender=function(F){var B;return K(this,void 0,void 0,(function(){var G;return J(this,(function(W){switch(W.label){case 0:return this.senders.has(F)?(this.event("onSendStreamChanged").raise(null,F),[4,(G=this.senders.get(F)).dispose()]):[3,2];case 1:W.sent(),this.senders.delete(F),this.subs.get(G).forEach((function(F){return F.dispose()})),this.subs.delete(G),this.logger.safe.info("Removed sender with mediaType: ".concat(JSON.stringify(F))),W.label=2;case 2:return null===(B=this.mediaQualityController)||void 0===B||B.removeReceiver(F),[2]}}))}))},StreamSendersManager.prototype.updateLayouts=function(F){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){return B=this.mediaQualityController.getLayouts(F),this.logger.safe.debug("Update layouts for ".concat(F,": ").concat(JSON.stringify(B))),[2,this.updateParameters(this.lastCauseId,F,B)]}))}))},StreamSendersManager.prototype.getSourceIdForTrack=function(F){var B=F.trackId,G=this.mediaManager.getMediaEntityByLocalTrackId(B);return G?(this.logger.safe.info("Media entity found: ".concat(JSON.stringify(G.getXSourceStreamId()))),G.getXSourceStreamId()):(this.logger.safe.error("Media entity is not found for stream: ".concat(JSON.stringify(B))),0)},StreamSendersManager.prototype.subscribeToStreamProviderEvents=function(){var F=this;this.streamProviderSubscriptions=[this.streamsProvider.on("onStreamAdded",(function(B){return F.onStreamUpdated(B,!1)})),this.streamsProvider.on("onStreamUpdated",(function(B){return F.onStreamUpdated(B,!0)}))]},StreamSendersManager.prototype.unsubscribeFromStreamProviderEvents=function(){this.streamProviderSubscriptions.forEach((function(F){return F.dispose()})),this.streamProviderSubscriptions=null},StreamSendersManager.prototype.subscribeToStreamWatcherEvents=function(){var F=this;this.localVideoStreamWatcher.on("onVideoCaptureFreeze",(function(B){F.event("onVideoCaptureFreeze").raise(B)}))},StreamSendersManager.prototype.onStreamUpdated=function(F,B){return K(this,void 0,void 0,(function(){var G;return J(this,(function(W){switch(W.label){case 0:return this.senders.has(F)?((G=this.streamsProvider.streams[F])||(this.logger.safe.info("Stream is missing for mediaType: ".concat(F,", using fake stream...")),G=new se.NullStreamClient(F,this.logger.createChild("NullStreamClient"))),this.event("onSendStreamChanged").raise(G,F),[4,this.senders.get(F).updateStream(G)]):(this.logger.safe.warn("Sender with media type ".concat(F," does not exist, do not update media stream")),[2]);case 1:return W.sent(),this.setAndUpdateLocalTracksInfo(B),[2]}}))}))},StreamSendersManager.prototype.onSenderStateChanged=function(F,B){if(this.mediaManager&&this.mediaManager.updateMediaEntitiesWithActivityState(F.mediaType,F.getActiveStreamIndexes()),this.statisticsGatherer.onSendersChanged(F.mediaType,B),"Video"===F.mediaType)if(B){var G=this.getTracksInfo().filter((function(F){return F.modality===ne.default.MODALITY.video}));this.localVideoStreamWatcher.startWatching(G)}else this.localVideoStreamWatcher.stopWatching()},StreamSendersManager.prototype.addAudioSharingStream=function(F){var B;return K(this,void 0,void 0,(function(){return J(this,(function(G){switch(G.label){case 0:return"ScreenShare"===F.mediaType&&F.hasAudio()?[4,null===(B=this.senders.get("Audio"))||void 0===B?void 0:B.addAdditionalStream(F)]:[3,2];case 1:G.sent(),G.label=2;case 2:return[2]}}))}))},StreamSendersManager}(X.default);B.StreamSendersManager=ce},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},J=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},Q=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},Y=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.SessionStreamsProvider=void 0;var $=G(8),X=G(6),Z=G(34),ee=G(163),te=G(53),ne=G(1),ie=function(F){function SessionStreamsProvider(B,G,W){var z,K=F.call(this,W)||this;return K.deviceManager=B,K.serialQueue=G,K.logger=W,K.mediaStreams=((z={}).Audio=null,z.Video=null,z.ScreenShare=null,z),K.streamSubscriptions=new Map,K.deviceManagerSubscriptions=[],K.isNullAudioStream=!1,K}return z(SessionStreamsProvider,F),Object.defineProperty(SessionStreamsProvider.prototype,"currentMediaTypes",{get:function(){var F=this;return ne.keys(this.streams).filter((function(B){return!!F.streams[B]}))},enumerable:!1,configurable:!0}),Object.defineProperty(SessionStreamsProvider.prototype,"streams",{get:function(){return this.mediaStreams},enumerable:!1,configurable:!0}),SessionStreamsProvider.prototype.useNullAudioStreamClient=function(){this.isNullAudioStream=!0},SessionStreamsProvider.prototype.update=function(F,B){return Q(this,void 0,void 0,(function(){var G;return Y(this,(function(W){switch(W.label){case 0:return G=ne.keys(F).filter((function(B){return F[B]})),ne.deepEqual(G,this.currentMediaTypes)?(this.logger.safe.info("Requested modalities have not changed. Do nothing"),[2,Z.Helper.sendStreamsToModalities(this.streams)]):(this.logger.safe.info("Starting media session with modalities: ".concat(JSON.stringify(F))),[4,this.updateStreams(G,B)]);case 1:return W.sent(),this.subscribeOnDeviceManagerEvents(this.deviceManager),[2,Z.Helper.sendStreamsToModalities(this.streams)]}}))}))},SessionStreamsProvider.prototype.stop=function(){return Q(this,void 0,void 0,(function(){var F=this;return Y(this,(function(B){return this.logger.safe.info("Stopping streams"),this.unsubscribeFromDeviceManagerEvents(),ne.keys(this.mediaStreams).forEach((function(B){return F.removeStreamByType(B)})),[2]}))}))},SessionStreamsProvider.prototype.ensureUpdateCompleted=function(){return Q(this,void 0,void 0,(function(){return Y(this,(function(F){return this.logger.safe.debug("streams updated"),[2]}))}))},SessionStreamsProvider.prototype.dispose=function(){this.stop(),F.prototype.dispose.call(this)},SessionStreamsProvider.prototype.updateStreams=function(F,B){return Q(this,void 0,void 0,(function(){var G,W,z,K,J,X=this;return Y(this,(function(Z){switch(Z.label){case 0:return G=this.getAvailableMediaTypes(),W=$.intersection(F,G),z=ne.keys(this.mediaStreams).filter((function(F){return X.mediaStreams[F]})),K=B?[]:ne.subtractFrom(W,z),J=ne.subtractFrom(z,W),this.logger.safe.info("Adding media streams for types: ".concat(JSON.stringify(K))),[4,Promise.all(K.map((function(F){return Q(X,void 0,void 0,(function(){return Y(this,(function(B){switch(B.label){case 0:return[4,this.addStream(F,!1)];case 1:return B.sent(),this.mediaStreams[F]&&this.event("onStreamAdded").raise(F),[2]}}))}))})))];case 1:return Z.sent(),this.logger.safe.info("Removing media streams for types: ".concat(JSON.stringify(J))),J.forEach((function(F){X.event("onStreamRemoving").raise(F),X.removeStreamByType(F)})),[2]}}))}))},SessionStreamsProvider.prototype.getAvailableMediaTypes=function(){var F=this.deviceManager.getSelectedDevices(),B=[];return F.microphone&&B.push("Audio"),F.camera&&B.push("Video"),B.push("ScreenShare"),B},SessionStreamsProvider.prototype.addStream=function(F,B){return Q(this,void 0,void 0,(function(){var G,W;return Y(this,(function(z){switch(z.label){case 0:if(this.mediaStreams[F])return this.logger.safe.warn("Stream with type: ".concat(F," is already registered")),[2];G=this.getStream(F,B),this.subscribeOnMediaStreamEvents(G),z.label=1;case 1:return z.trys.push([1,3,,4]),[4,G.start()];case 2:return z.sent(),[3,4];case 3:return W=z.sent(),this.logger.safe.error("Media stream request error: ".concat(JSON.stringify(W))),this.event("onStreamError").raise(F,W),[2];case 4:return this.mediaStreams[F]=G,[2]}}))}))},SessionStreamsProvider.prototype.removeStreamByType=function(F){var B=this.mediaStreams[F];B?(this.unsubscribeFromMediaStreamEvents(B),B.dispose(),this.mediaStreams[F]=null):this.logger.safe.warn("Stream with type: ".concat(F," is not registered"))},SessionStreamsProvider.prototype.updateStream=function(F,B){return Q(this,void 0,void 0,(function(){return Y(this,(function(G){switch(G.label){case 0:return this.removeStreamByType(F),[4,this.addStream(F,B)];case 1:return G.sent(),this.event("onStreamUpdated").raise(F),[2]}}))}))},SessionStreamsProvider.prototype.subscribeOnMediaStreamEvents=function(F){var B=this;if(!this.streamSubscriptions.has(F)){var G=[];G.push(F.on("onStreamClientError",(function(F,G){return B.onStreamError(F,G)}))),G.push(F.on("onStreamClientDisposing",(function(F){return B.onStreamDisposing(F)}))),this.streamSubscriptions.set(F,G)}},SessionStreamsProvider.prototype.unsubscribeFromMediaStreamEvents=function(F){this.streamSubscriptions.has(F)&&(this.streamSubscriptions.get(F).forEach((function(F){return F.dispose()})),this.streamSubscriptions.delete(F))},SessionStreamsProvider.prototype.getStream=function(F,B){var G=this.mediaStreams[F];return G?(this.logger.safe.info("Stream exists with id: ".concat(G.id,", type: ").concat(F)),G):this.getStreamByMediaType(F,B)},SessionStreamsProvider.prototype.getStreamByMediaType=function(F,B){switch(F){case"Audio":return this.isNullAudioStream?new ee.NullStreamClient("Audio",this.logger.createChild("NullStreamClient")):this.deviceManager.getAudioStream(B,"sessionStream");case"Video":return this.deviceManager.getVideoStream(B,"sessionStream");case"ScreenShare":return this.deviceManager.getDisplayStream(!!this.streams.Audio,"sessionStream");default:throw new Error("Media type is not supported: ".concat(F))}},SessionStreamsProvider.prototype.getMediaTypeForStream=function(F){var B=this,G=Object.keys(this.mediaStreams).find((function(G){return B.mediaStreams[G]===F}));return G||this.logger.safe.error("Media type is not found for stream: ".concat(ne.stringifyObject(F))),G},SessionStreamsProvider.prototype.subscribeOnDeviceManagerEvents=function(F){var B=this;0===this.deviceManagerSubscriptions.length&&(this.deviceManagerSubscriptions.push(F.on("onSelectedDevicesChanged",(function(F,G){return B.onSelectedDevicesChanged(F,G)}))),this.deviceManagerSubscriptions.push(F.on("onStreamUpdateRequested",(function(F){return B.requestStreamUpdate(F,!1)}))))},SessionStreamsProvider.prototype.unsubscribeFromDeviceManagerEvents=function(){0!==this.deviceManagerSubscriptions.length&&(this.deviceManagerSubscriptions.forEach((function(F){return F.dispose()})),this.deviceManagerSubscriptions=[])},SessionStreamsProvider.prototype.getMediaTypesToUpdate=function(F,B){var G=[];return this.currentMediaTypes.some((function(F){return"Audio"===F}))&&F.microphone&&F.microphone!==B.microphone&&G.push("Audio"),this.currentMediaTypes.some((function(F){return"Video"===F}))&&F.camera&&F.camera!==B.camera&&G.push("Video"),G},SessionStreamsProvider.prototype.removeStream=function(F){var B=this.getMediaTypeForStream(F);this.removeStreamByType(B)},SessionStreamsProvider.prototype.onSelectedDevicesChanged=function(F,B){return Q(this,void 0,void 0,(function(){var G,W=this;return Y(this,(function(z){switch(z.label){case 0:return G=this.getMediaTypesToUpdate(F,B),this.logger.safe.info("Media types to update: ".concat(JSON.stringify(G))),[4,Promise.all(G.map((function(F){return W.updateStream(F,!1)})))];case 1:return z.sent(),[2]}}))}))},SessionStreamsProvider.prototype.requestStreamUpdate=function(F,B){return Q(this,void 0,void 0,(function(){return Y(this,(function(G){return this.currentMediaTypes.some((function(B){return B===F}))?[2,this.updateStream(F,B)]:(this.logger.safe.debug("Stream with media type: ".concat(F," is not active. Do nothing")),[2])}))}))},SessionStreamsProvider.prototype.onStreamError=function(F,B){this.removeStream(F)},SessionStreamsProvider.prototype.onStreamDisposing=function(F){this.removeStream(F)},K([(0,te.sequentialize)(),J("design:type",Function),J("design:paramtypes",[Object,Boolean]),J("design:returntype",Promise)],SessionStreamsProvider.prototype,"update",null),K([(0,te.sequentialize)(),J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],SessionStreamsProvider.prototype,"stop",null),K([(0,te.sequentialize)(),J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],SessionStreamsProvider.prototype,"ensureUpdateCompleted",null),K([(0,te.sequentialize)(),J("design:type",Function),J("design:paramtypes",[Object,Object]),J("design:returntype",Promise)],SessionStreamsProvider.prototype,"onSelectedDevicesChanged",null),K([(0,te.sequentialize)(),J("design:type",Function),J("design:paramtypes",[String,Boolean]),J("design:returntype",Promise)],SessionStreamsProvider.prototype,"requestStreamUpdate",null),SessionStreamsProvider}(X.default);B.SessionStreamsProvider=ie},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},J=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J};Object.defineProperty(B,"__esModule",{value:!0}),B.MediaQualityController=void 0;var Q=G(6),Y=G(436),$=G(154),X=G(437),Z=function(F){function MediaQualityController(B,G,W){var z=F.call(this,W)||this;return z.statisticsGatherer=B,z.configProvider=G,z.logger=W,z.bandwidthAllocator=null,z.bandwidthCalculator=new $.SendBandwidthCalculator(z.configProvider,z.statisticsGatherer,z.logger.createChild("SendBandwidthCalculator")),z.layoutProviders=new Map,z.bandwidthAllocator=(0,Y.createBandwidthAllocatorPerMediaType)(z.logger,z.configProvider),z.bandwidthCalculator.on("onSendBandwidthChanged",(function(F){return z.bandwidthAllocator.setAvailableBandwidth(F)})),z.bandwidthAllocator.on("onBandwidthDistributionUpdated",(function(){return z.updateBandwidthDistribution()})),z}return z(MediaQualityController,F),MediaQualityController.prototype.dispose=function(){var B,G;null===(B=this.bandwidthCalculator)||void 0===B||B.dispose(),this.bandwidthCalculator=null,null===(G=this.bandwidthAllocator)||void 0===G||G.dispose(),this.bandwidthAllocator=null,this.layoutProviders.forEach((function(F){return F.dispose()})),this.layoutProviders.clear(),this.layoutProviders=null,F.prototype.dispose.call(this)},MediaQualityController.prototype.addReceiver=function(F,B){this.logger.safe.debug("Set receiver max capabilities for ".concat(F,": ").concat(JSON.stringify(B))),this.configureProviders(F,B.length);var G=B.map((function(F){return F.maxBr})).reduce((function(F,B){return F+B}));this.bandwidthAllocator.addReceiverCapabilty(F,G),this.layoutProviders.get(F).setLayouts(B)},MediaQualityController.prototype.removeReceiver=function(F){var B;this.logger.safe.debug("Removing receiver for ".concat(F)),this.bandwidthAllocator.removeReceiver(F),null===(B=this.layoutProviders.get(F))||void 0===B||B.dispose(),this.layoutProviders.delete(F)},MediaQualityController.prototype.getLayouts=function(F){return this.layoutProviders.get(F).getLayouts()},MediaQualityController.prototype.configureProviders=function(F,B){if(!this.layoutProviders.has(F)){var G=this.createProvider(F);this.layoutProviders.set(F,G)}this.layoutProviders.get(F).configure(B)},MediaQualityController.prototype.createProvider=function(F){var B=this,G=new X.LayoutGenerator(this.configProvider,this.logger.createChild("LG:".concat(F)));return G.on("onLayoutsChanged",(function(){var W=G.getLayouts();B.logger.safe.debug("New layouts generated: ".concat(JSON.stringify(W))),B.event("onLayoutsUpdated").raise(F)})),G},MediaQualityController.prototype.updateBandwidthDistribution=function(){var F,B,G,W=this.bandwidthAllocator.getLayouts();try{for(var z=K(Object.entries(W)),Q=z.next();!Q.done;Q=z.next()){var Y=J(Q.value,2),$=Y[0],X=Y[1];null===(G=this.layoutProviders.get($))||void 0===G||G.setAvailableBandwidth(X)}}catch(B){F={error:B}}finally{try{Q&&!Q.done&&(B=z.return)&&B.call(z)}finally{if(F)throw F.error}}},MediaQualityController}(Q.default);B.MediaQualityController=Z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.BandwidthAllocator=B.createBandwidthAllocatorPerMediaType=void 0;var J=G(8),Q=G(6),Y=G(1),$=[5e4,1e6,15e5,2e6,25e5,375e4,4e6],X=[7e4,2e5,4e5,8e5,15e5,2499990,25e5];function createBandwidthAllocatorPerMediaType(F,B){var G=new Z(F.createChild("BandwidthAllocator"));return G.setLadder("ScreenShare",B.config.sharingBitrateLadderOverride||$),G.setLadder("Video",B.config.videoBitrateLadderOverride||X),G}B.createBandwidthAllocatorPerMediaType=createBandwidthAllocatorPerMediaType;var Z=function(F){function BandwidthAllocator(B){var G=F.call(this,B)||this;return G.logger=B,G.availableBandwidth=0,G.receivers=new Map,G.currentLayout={},G.ladders={},G}return z(BandwidthAllocator,F),BandwidthAllocator.prototype.setAvailableBandwidth=function(F){this.availableBandwidth=F,this.logger.safe.debug("Total available bandwidth updated: ".concat(F)),this.updateLayoutAndNotify()},BandwidthAllocator.prototype.addReceiverCapabilty=function(F,B){this.logger.safe.debug("Receiver maxBr set: ".concat(F,"/").concat(B)),this.receivers.set(F,B),this.updateLayoutAndNotify()},BandwidthAllocator.prototype.removeReceiver=function(F){this.logger.safe.debug("Receiver maxBr removed: ".concat(F)),this.receivers.delete(F),this.updateLayoutAndNotify()},BandwidthAllocator.prototype.getLayouts=function(){return this.currentLayout},BandwidthAllocator.prototype.setLadder=function(F,B){this.ladders[F]=B},BandwidthAllocator.prototype.updateLayoutAndNotify=function(){var F=this.generateLayouts();J.isEqual(F,this.currentLayout)||(this.currentLayout=F,this.logger.safe.debug("Bandwidth distribution updated: ".concat((0,Y.stringifyObject)(F))),this.event("onBandwidthDistributionUpdated").raise())},BandwidthAllocator.prototype.generateLayouts=function(){var F,B,G,W,z={},J={};try{for(var Q=K(Object.keys(this.ladders)),Y=Q.next();!Y.done;Y=Q.next()){var $=Y.value,X=this.receivers.get($);X&&(J[$]=X||Number.MAX_SAFE_INTEGER,z[$]=0)}}catch(B){F={error:B}}finally{try{Y&&!Y.done&&(B=Q.return)&&B.call(Q)}finally{if(F)throw F.error}}for(var Z=this.availableBandwidth,ee=0,runLoop=function(){var F,B;if(!Z)return!1;try{for(var G=K(Object.values(J)),W=G.next();!W.done;W=G.next()){if(W.value)return!0}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}return!1};runLoop();){try{for(var te=(G=void 0,K(Object.keys(z))),ne=te.next();!ne.done;ne=te.next()){$=ne.value;var ie=this.ladders[$],re=ie[ee]||ie[ie.length-1];re=Math.min(re,Z,J[$]),z[$]+=re,Z-=re,J[$]-=re}}catch(F){G={error:F}}finally{try{ne&&!ne.done&&(W=te.return)&&W.call(te)}finally{if(G)throw G.error}}ee++}return z},BandwidthAllocator}(Q.default);B.BandwidthAllocator=Z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.LayoutGenerator=void 0;var K=G(6),J=G(438),Q=G(439),Y=G(1),$=function(F){function LayoutGenerator(B,G){var W=F.call(this,G)||this;return W.configProvider=B,W.logger=G,W.shouldBeControlled=!1,W.deferredOperation=new J.InitiallyDeferredOperation((function(){return W.updateStrategy()}),W.configProvider.config.layoutControlTimeout,W.logger.createChild("DeferredOperation")),W.strategy=W.createStrategy(W.shouldBeControlled),W}return z(LayoutGenerator,F),LayoutGenerator.prototype.configure=function(F){var B=this.isBWEControlNeeded(F);this.shouldBeControlled!==B&&(this.shouldBeControlled=B,this.deferredOperation.invoke(this.shouldBeControlled))},LayoutGenerator.prototype.setLayouts=function(F){(0,Y.deepEqual)(this.latestLayouts,F)?this.logger.safe.debug("Layouts are not changed. Skipping update"):(this.latestLayouts=F,this.strategy.setLayouts(this.latestLayouts))},LayoutGenerator.prototype.setAvailableBandwidth=function(F){this.strategy.setAvailableBandwidth(F),this.latestBandwidth=F},LayoutGenerator.prototype.getLayouts=function(){return this.strategy.getLayouts()},LayoutGenerator.prototype.dispose=function(){this.strategy.dispose(),this.strategy=null,F.prototype.dispose.call(this)},LayoutGenerator.prototype.updateStrategy=function(){var F=this;this.strategy.dispose(),this.strategy=this.createStrategy(this.shouldBeControlled),this.strategy.on("onLayoutsChanged",(function(){return F.event("onLayoutsChanged").raise()})),this.latestBandwidth&&this.strategy.setAvailableBandwidth(this.latestBandwidth),this.latestLayouts&&this.strategy.setLayouts(this.latestLayouts)},LayoutGenerator.prototype.isBWEControlNeeded=function(F){return F>1},LayoutGenerator.prototype.createStrategy=function(F){return F?new Q.BWEControlledStrategy(this.configProvider,this.logger.createChild("BWEControlledStrategy")):new Q.NoControlStrategy(this.logger.createChild("NoControlStrategy"))},LayoutGenerator}(K.default);B.LayoutGenerator=$},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.InitiallyDeferredOperation=void 0;var W=G(51),z=function(){function InitiallyDeferredOperation(F,B,G){var W=this;this.timeout=B,this.logger=G,this.isFirstTimeDeferred=!0,this.internalCallback=function(B){W.logger.safe.debug("Trigger reason: ".concat(B)),F()}}return InitiallyDeferredOperation.prototype.invoke=function(F){if(this.logger.safe.debug("Schedule shouldDefer: ".concat(F)),this.createTimerIfNeeded(F),this.timer)return F?this.startTimer():this.stopTimerAndTrigger();this.internalCallback("request")},InitiallyDeferredOperation.prototype.startTimer=function(){this.timer.isActive||(this.timer.start(this.timeout),this.logger.safe.debug("Timer started for : ".concat(this.timeout,"ms")))},InitiallyDeferredOperation.prototype.stopTimer=function(){this.timer.isActive&&(this.timer.stop(),this.logger.safe.debug("Timer stopped"))},InitiallyDeferredOperation.prototype.stopTimerAndTrigger=function(){this.stopTimer(),this.internalCallback("request")},InitiallyDeferredOperation.prototype.createTimerIfNeeded=function(F){var B=this;F&&this.isFirstTimeDeferred&&(this.isFirstTimeDeferred=!1,this.timer=new W.Timer((function(){B.internalCallback("timeout"),B.timer=null})))},InitiallyDeferredOperation}();B.InitiallyDeferredOperation=z},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.NoControlStrategy=B.BWEControlledStrategy=void 0;var J=G(6),Q=G(440),Y=G(1),$=1e8,X=function(F){function BWEControlledStrategy(B,G){var W=F.call(this,G)||this;return W.configProvider=B,W.logger=G,W.totalBandwidth=$,W.resolutionManager=new Q.BWEControlledResolutionManager(W.logger.createChild("BWEControlledResolutionManager"),W.configProvider),W.logger.safe.debug("Created"),W}return z(BWEControlledStrategy,F),BWEControlledStrategy.prototype.dispose=function(){this.logger.safe.debug("Disposed"),this.resolutionManager=null,F.prototype.dispose.call(this)},BWEControlledStrategy.prototype.setAvailableBandwidth=function(F){this.logger.safe.debug("Set available bandwidth: ".concat(F)),this.totalBandwidth=F,this.inputLayouts?(this.recalculateLayouts(),this.checkForChangesAndNotify()):this.logger.safe.debug("Layouts are not set. Skip update")},BWEControlledStrategy.prototype.setLayouts=function(F){2===F.length?(this.logger.safe.debug("Set layouts: ".concat(JSON.stringify(F))),this.inputLayouts=this.getPrioritizedLayouts(F),this.recalculateLayouts(),this.checkForChangesAndNotify()):this.logger.safe.warn("Incorrect number of layouts! ".concat(JSON.stringify(F)))},BWEControlledStrategy.prototype.getLayouts=function(){return this.hiFiLayout?[this.loFiLayout,this.hiFiLayout]:[this.loFiLayout]},BWEControlledStrategy.prototype.getHighLayoutBandwidth=function(F){var B,G=(null===(B=this.inputLayouts)||void 0===B?void 0:B[0].maxBr)||0,W=Math.max(F-G,0);return this.logger.safe.debug("Setting available bandwidth for layouts. High: ".concat(W,", low: ").concat(G||"not set",", total: ").concat(F)),W},BWEControlledStrategy.prototype.recalculateLayouts=function(){var F=this.hiFiLayout,B=this.getHighLayoutBandwidth(this.totalBandwidth);this.resolutionManager.setAvailableBandwidth(B),this.resolutionManager.setMaxFrameSize(this.inputLayouts[1].maxFs),this.loFiLayout=this.getMinimalLayoutParams(this.inputLayouts),this.hiFiLayout=this.getHighLayoutParams(this.inputLayouts,B,this.loFiLayout),this.loFiLayout=this.adjustLowLayoutBasedOnHighLayout(this.hiFiLayout,this.loFiLayout,F)},BWEControlledStrategy.prototype.adjustLowLayoutBasedOnHighLayout=function(F,B,G){return this.configProvider.config.useMediaQualityControllerForceKeyFrame&&!F&&G&&(this.logger.safe.debug("Forcing kayframe on low layout due to disabling high layout"),B.keyframe=!0),F?(B.maxBr===F.maxBr&&B.maxBr--,B):B},BWEControlledStrategy.prototype.getPrioritizedLayouts=function(F){return F.sort((function(F,B){return F.maxFs-B.maxFs?F.maxFs-B.maxFs:F.maxFps-B.maxFps}))},BWEControlledStrategy.prototype.getHighLayoutParams=function(F,B,G){var W=F[1];if(W.maxBr<=B)return this.logger.safe.debug("High layout bandwidth suits requested caps. Applying as-is: ".concat(JSON.stringify(W))),W;var z=K(K({},F[1]),{maxFs:this.resolutionManager.getFrameSize(),maxBr:Math.min(B,F[1].maxBr),maxFps:F[1].maxFps}),J=z.maxBr<G.maxBr||z.maxFs<G.maxFs||z.maxFs===G.maxFs&&z.maxFps<=G.maxFps,Q="Potential high layout: ".concat(JSON.stringify(z));return!this.hiFiLayout&&J?(this.logger.safe.debug("High layout is already disabled. Do nothing. ".concat(Q)),null):this.hiFiLayout&&J?(this.logger.safe.debug("High layout gets disabled. ".concat(Q)),null):(this.hiFiLayout&&Y.deepEqual(z,this.hiFiLayout)?this.logger.safe.debug("High layout has not been changed. Do nothing. ".concat(Q)):this.hiFiLayout?this.logger.safe.debug("High layout updated. ".concat(Q)):this.logger.safe.debug("High layout enabled. ".concat(Q)),z)},BWEControlledStrategy.prototype.getMinimalLayoutParams=function(F){return K(K({},F[0]),{maxBr:Math.min(F[0].maxBr,F[1].maxBr),maxFps:Math.min(F[0].maxFps,F[1].maxFps),maxFs:Math.min(F[0].maxFs,F[1].maxFs)})},BWEControlledStrategy.prototype.checkForChangesAndNotify=function(){var F=this.getLayouts();Y.deepEqual(this.outputLayouts,F)?this.logger.safe.debug("Layout has not changed, skip update"):(this.outputLayouts=F,this.event("onLayoutsChanged").raise())},BWEControlledStrategy}(J.default);B.BWEControlledStrategy=X;var Z=function(F){function NoControlStrategy(B){var G=F.call(this,B)||this;return G.logger=B,G.logger.safe.debug("Created"),G}return z(NoControlStrategy,F),NoControlStrategy.prototype.dispose=function(){this.logger.safe.debug("Disposed"),F.prototype.dispose.call(this)},NoControlStrategy.prototype.setAvailableBandwidth=function(F){this.logger.safe.debug("Available bandwidth updated ".concat(F))},NoControlStrategy.prototype.setLayouts=function(F){this.layouts=F},NoControlStrategy.prototype.getLayouts=function(){return this.layouts},NoControlStrategy}(J.default);B.NoControlStrategy=Z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.BWEControlledResolutionManager=void 0;var W=G(28),z=function(){function BWEControlledResolutionManager(F,B){this.logger=F,this.configProvider=B,this.resolutionTable=new W.default(this.configProvider.config.resolutionTableOverride),this.currentFrameSize=this.resolutionTable.initialResolution.fs}return BWEControlledResolutionManager.prototype.setAvailableBandwidth=function(F){F!==this.lastSendBW&&(this.logger.safe.debug("Available bandwidth updated ".concat(F)),this.processEstimatedBandwidth(F))},BWEControlledResolutionManager.prototype.setMaxFrameSize=function(F){F!==this.maxFrameSize?(this.maxFrameSize=F,this.lastSendBW?(this.logger.safe.debug("Setting max frame size: ".concat(F)),this.processEstimatedBandwidth(this.lastSendBW)):this.logger.safe.debug("Last send bwe is not defined. Do nothing")):this.logger.safe.debug("Max frame size did not change. Do nothing, maxFs: ".concat(F))},BWEControlledResolutionManager.prototype.getFrameSize=function(){return this.currentFrameSize},BWEControlledResolutionManager.prototype.processEstimatedBandwidth=function(F){if(0===F)return this.lastSendBW=0,void this.proposeResolution(0);var B=this.resolutionTable.getResolutionForBitrate(F),G=B.lowRes,W=B.highRes,z=F<this.lastSendBW?W.fs:G.fs;F<this.lastSendBW&&this.currentFrameSize<z||(z&&this.proposeResolution(z),this.lastSendBW=F)},BWEControlledResolutionManager.prototype.proposeResolution=function(F){var B=this.maxFrameSize?Math.min(F,this.maxFrameSize):F;B!==this.currentFrameSize&&(this.currentFrameSize=B,this.logger.safe.debug("Proposed new frame size: ".concat(B," based on bandwidth: ").concat(this.lastSendBW)))},BWEControlledResolutionManager}();B.BWEControlledResolutionManager=z},function(F,B,G){var W,z,K=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),J=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},Q=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},Y=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},$=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.SimulcastStreamSender=void 0;var X=G(6),Z=G(53),ee=G(1),te=G(442),ne=G(443),ie=G(444),re=G(10),oe=function(F){function SimulcastStreamSender(B,G,W,z,K,J,Q,Y,$,X){var Z=F.call(this)||this;return Z.mediaConnection=B,Z.mainStream=G,Z.contextStream=W,Z.mediaType=z,Z.serialQueue=K,Z.logger=J,Z.configProvider=Q,Z.isAlwaysActive=Y,Z.encStreamsManager=$,Z.simulcastContext=X,Z.isMuted=!1,Z.isHold=!1,Z.previousParameters=[],Z.state=new ne.StateMachine(SimulcastStreamSender.transitionStates,"NotStarted",Z.logger),Z.pendingStream=null,Z.subscribeOnQualityUpdates(Z.mainStream),Z}return K(SimulcastStreamSender,F),SimulcastStreamSender.prototype.start=function(){return Y(this,void 0,void 0,(function(){return $(this,(function(F){switch(F.label){case 0:return this.state.setState("Started")?(this.sender=this.createSenderModel(),[4,this.sender.init()]):[2];case 1:return F.sent(),this.configProvider.config.deactiveAudioSender&&"Audio"===this.mediaType?[4,this.sender.stop()]:[3,3];case 2:F.sent(),F.label=3;case 3:return this.subscribeForSenderEvents(),this.capabilitiesManager=this.getCapabilitiesManager(this.simulcastContext),[2]}}))}))},SimulcastStreamSender.prototype.activate=function(){return Y(this,void 0,void 0,(function(){return $(this,(function(F){switch(F.label){case 0:return this.state.setState("Active")?this.pendingStream?[4,this.updateStreamInternal(this.pendingStream)]:[3,2]:[2];case 1:F.sent(),this.pendingStream=null,F.label=2;case 2:return!this.isAlwaysActive||this.isMuted||"Audio"!==this.mediaType?[3,4]:[4,this.sender.start()];case 3:F.sent(),F.label=4;case 4:return this.isAlwaysActive?(this.event("onSendersChanged").raise(this,!0),this.logger.safe.info("Sender set to always active. Do not stopping"),[2]):[2,this.capabilitiesManager.stopSenders()]}}))}))},SimulcastStreamSender.prototype.updateStream=function(F){return this.updateStreamInternal(F)},SimulcastStreamSender.prototype.addAdditionalStream=function(F){return Y(this,void 0,void 0,(function(){return $(this,(function(B){return[2,this.sender.addAdditionalStream(F)]}))}))},SimulcastStreamSender.prototype.updateParameters=function(F){return Y(this,void 0,void 0,(function(){return $(this,(function(B){switch(B.label){case 0:return this.state.isCurrentStateMatchedWith("Active")?[4,this.capabilitiesManager.setCapabilities(F)]:[2];case 1:return B.sent(),ee.compareArraysBy(this.previousParameters,F,(function(F,B){return F.ssrc===B.ssrc}))||(this.previousParameters=F,this.event("onSendersChanged").raise(this,!0)),[2]}}))}))},SimulcastStreamSender.prototype.dispose=function(){return Y(this,void 0,void 0,(function(){return $(this,(function(B){switch(B.label){case 0:return this.state.setState("Disposed")?(this.logger.safe.info("Disposing"),[4,this.sender.dispose()]):[2];case 1:return B.sent(),this.unsubscribeFromQualityEvents(),this.mainStream.dispose(),this.mainStream=null,this.pendingStream&&this.pendingStream.dispose(),this.pendingStream=null,this.sender=null,this.contextStream=null,this.event("onSendersChanged").raise(this,!1),F.prototype.dispose.call(this),[2]}}))}))},SimulcastStreamSender.prototype.setHold=function(F,B){return Y(this,void 0,void 0,(function(){return $(this,(function(G){return this.isHold===F?(this.logger.safe.info("[".concat(B,"] Already in hold=").concat(F," state")),[2]):(this.logger.safe.info("[".concat(B,"] Setting hold to: ").concat(F)),this.isHold=F,[2,this.sender.setHold(F,B)])}))}))},SimulcastStreamSender.prototype.setMuted=function(F,B,G){this.logger.safe.info("[".concat(B,"] Setting muted to: ").concat(F)),this.isMuted=F,this.sender.setMuted(this.isMuted,B,G),!this.isMuted&&"Audio"===this.mediaType&&this.state.isCurrentStateMatchedWith("Active")&&this.sender.start()},SimulcastStreamSender.prototype.getActiveStreamIndexes=function(){return this.sender?this.sender.getActiveStreamIndexes():[]},SimulcastStreamSender.prototype.getTrackInfo=function(){return{modality:re.mediaTypeToModality(this.mediaType),trackId:this.sender.trackId}},SimulcastStreamSender.prototype.createSenderModel=function(){return new ie.StreamSender(this.mediaConnection,this.mainStream,this.contextStream,this.logger.createChild("Sender"),this.configProvider,this.encStreamsManager)},SimulcastStreamSender.prototype.subscribeForSenderEvents=function(){var F=this;this.sender.on("onNewStreamNeeded",(function(){return F.event("onNewStreamNeeded").raise()}))},SimulcastStreamSender.prototype.getCapabilitiesManager=function(F){return(null==F?void 0:F.shouldUseSimulcast())?new te.SimulcastCapabilitiesManager(this.sender.rtpSender,this.mainStream.getResolution(),F.config.layerScaleFactors.length,this.logger.createChild("SimCapMgr"),this.configProvider):new te.SinglecastCapabilitiesManager(this.sender,this.logger.createChild("SnglCapMgr"))},SimulcastStreamSender.prototype.updateStreamInternal=function(F){return Y(this,void 0,void 0,(function(){return $(this,(function(B){switch(B.label){case 0:return this.state.isCurrentStateMatchedWith("Active")?this.mainStream===F?(this.logger.safe.info("Stream has not been changed. Skipping update"),[2]):(this.logger.safe.debug("Switching streams: ".concat(this.mainStream.parentId,":").concat(this.mainStream.id," -> ").concat(F.parentId,":").concat(F.id)),this.unsubscribeFromQualityEvents(),this.mainStream.dispose(),this.mainStream=F,this.subscribeOnQualityUpdates(this.mainStream),[4,this.sender.setMainStream(this.mainStream)]):(this.logger.safe.info("Postponing stream update until sender is activated"),this.setPendingStream(F),[2]);case 1:return B.sent(),this.capabilitiesManager.updateStreamQualityParams(this.mainStream.getResolution(),this.mainStream.getFrameRate()),[2]}}))}))},SimulcastStreamSender.prototype.setPendingStream=function(F){var B=this;this.pendingStream=F;var G=F.on("onStreamClientDisposing",(function(){B.pendingStream===F&&(B.pendingStream=null,G.dispose())}))},SimulcastStreamSender.prototype.subscribeOnQualityUpdates=function(F){var B=this;this.sub=F.on("onStreamQualityChanged",(function(F,G,W){return B.capabilitiesManager.updateStreamQualityParams(G,W)}))},SimulcastStreamSender.prototype.unsubscribeFromQualityEvents=function(){var F;null===(F=this.sub)||void 0===F||F.dispose(),this.sub=null},SimulcastStreamSender.transitionStates=((z={}).NotStarted=["Started","Disposed"],z.Started=["Active","Disposed"],z.Active=["NotStarted","Disposed"],z.Disposed=[],z),J([(0,Z.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],SimulcastStreamSender.prototype,"start",null),J([(0,Z.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],SimulcastStreamSender.prototype,"activate",null),J([(0,Z.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],SimulcastStreamSender.prototype,"updateStream",null),J([(0,Z.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],SimulcastStreamSender.prototype,"addAdditionalStream",null),J([(0,Z.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Array]),Q("design:returntype",Promise)],SimulcastStreamSender.prototype,"updateParameters",null),J([(0,Z.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],SimulcastStreamSender.prototype,"dispose",null),J([(0,Z.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Boolean,String]),Q("design:returntype",Promise)],SimulcastStreamSender.prototype,"setHold",null),SimulcastStreamSender}(X.default);B.SimulcastStreamSender=oe},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.SinglecastCapabilitiesManager=B.SimulcastCapabilitiesManager=void 0;var K=G(1),J=G(28),Q=function(){function SimulcastCapabilitiesManager(F,B,G,W,z){this.sender=F,this.initialResolution=B,this.maxSimulcastLayerCount=G,this.logger=W,this.configProvider=z,this.resTable=new J.default(this.configProvider.config.resolutionTableOverride)}return SimulcastCapabilitiesManager.prototype.setCapabilities=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){switch(B.label){case 0:return K.deepEqual(this.currentCapabilities,F)?(this.logger.safe.info("Capabilties already applied: ".concat(JSON.stringify(F),". Do nothing")),[2]):(this.currentCapabilities=K.deepClone(F),[4,this.generateKeyFrameIfNeeded(F)]);case 1:return B.sent(),[2,this.applyCapabilities(F)]}}))}))},SimulcastCapabilitiesManager.prototype.updateStreamQualityParams=function(F,B){return W(this,void 0,void 0,(function(){return z(this,(function(G){return!F||K.deepEqual(this.initialResolution,F)?(this.logger.safe.debug("Resolution is not defined or same: ".concat(JSON.stringify(F),"@").concat(B)),[2]):(this.logger.safe.debug("Stream params changed: ".concat(JSON.stringify(F),"@").concat(B)),this.initialResolution=F,[2,this.applyCapabilities(this.currentCapabilities)])}))}))},SimulcastCapabilitiesManager.prototype.stopSenders=function(){return W(this,void 0,void 0,(function(){return z(this,(function(F){return this.logger.safe.info("Stopping senders."),[2,this.deactivateSenders()]}))}))},SimulcastCapabilitiesManager.prototype.getScaleFactor=function(F){var B=this.resTable.getResolutionByFs(F),G=this.initialResolution,W=Math.min(G.width,G.height)/B.height;return this.logger.safe.debug("Scale factor is taken from resolution: ".concat(JSON.stringify(G)," and new Fs: ").concat(F," as ").concat(W)),W<1&&(this.logger.safe.error("Scale factor cannot be less than 1! Limiting to 1"),W=1),W},SimulcastCapabilitiesManager.prototype.deactivateSenders=function(){var F=this.sender.getParameters();return F.encodings.forEach((function(F){return F.active=!1})),this.logger.safe.info("Stopping senders. Encoding params to set: ".concat(JSON.stringify(F.encodings))),this.sender.setParameters(F)},SimulcastCapabilitiesManager.prototype.generateKeyFrameIfNeeded=function(F){return W(this,void 0,void 0,(function(){var B,G,W,K=this;return z(this,(function(z){return B=this.sender.getParameters(),G=[],F.forEach((function(F){var W=K.getEncondingIndexForRid(F.rid,B.encodings),z=B.encodings[W];F.keyframe&&z.active?(K.logger.safe.info("Keyframe is needed for encoder with index ".concat(W)),G.push(W)):K.logger.safe.info("Keyframe is not needed for index ".concat(W," because encoding is active: ").concat(z.active," or KF is requested: ").concat(F.keyframe))})),0===G.length?(this.logger.safe.info("No keyframes needed. Skipping"),[2]):(W=this.getParamsForKeyFrame(B,G),this.logger.safe.info("Applying keyframe encoding params new: ".concat(JSON.stringify(W.encodings),", old: ").concat(JSON.stringify(B.encodings))),[2,this.sender.setParameters(W)])}))}))},SimulcastCapabilitiesManager.prototype.applyCapabilities=function(F){return W(this,void 0,void 0,(function(){var B,G,W=this;return z(this,(function(z){return F?(B=this.sender.getParameters(),G=K.deepClone(B),F.forEach((function(F){var G=W.getEncondingIndexForRid(F.rid,B.encodings);W.updateEncodingsWithCaps(B.encodings[G],F)})),this.updateActiveStates(B,F),this.logger.safe.info("Encoding params new: ".concat(JSON.stringify(B.encodings),", old: ").concat(JSON.stringify(G.encodings))),[2,this.sender.setParameters(B)]):(this.logger.safe.info("Capabilities are not set. Do nothing"),[2])}))}))},SimulcastCapabilitiesManager.prototype.getEncondingIndexForRid=function(F,B){if(!F)return this.logger.safe.error("No RID found in incoming params. Returning index 0"),0;var G=B.findIndex((function(B){return B.rid===F}));return G<0||G-1>this.maxSimulcastLayerCount?(this.logger.safe.error("Incorrect index deduced from requested RID. Returning index 0"),0):G},SimulcastCapabilitiesManager.prototype.updateEncodingsWithCaps=function(F,B){F?(F.maxBitrate=B.maxBr,F.scaleResolutionDownBy=this.getScaleFactor(B.maxFs),F.maxFramerate=B.maxFps):this.logger.safe.error("SenderParams does not exist for caps: ".concat(JSON.stringify(B)))},SimulcastCapabilitiesManager.prototype.updateActiveStates=function(F,B){var G=this,W=F.encodings.map((function(F){return F.rid})),z=W.filter((function(F){return B.some((function(B){return F===B.rid}))})),J=K.subtractFrom(W,z);z.forEach((function(B){return G.changeEncodingState(F,B,!0)})),J.forEach((function(B){return G.changeEncodingState(F,B,!1)}))},SimulcastCapabilitiesManager.prototype.changeEncodingState=function(F,B,G){var W=F.encodings.find((function(F){return F.rid===B}));W?W.active=G:this.logger.safe.error("Encoding not found for RID: ".concat(B))},SimulcastCapabilitiesManager.prototype.getParamsForKeyFrame=function(F,B){var G=this,W=K.deepClone(F);return B.forEach((function(F){W.encodings[F].active&&W.encodings[F].scaleResolutionDownBy&&(W.encodings[F]=G.getEncodingParamsForKeyFrame(W.encodings[F]))})),W},SimulcastCapabilitiesManager.prototype.getEncodingParamsForKeyFrame=function(F){var B=K.deepClone(F);return B.scaleResolutionDownBy&&(B.scaleResolutionDownBy=1.1*F.scaleResolutionDownBy),B},SimulcastCapabilitiesManager}();B.SimulcastCapabilitiesManager=Q;var Y=function(){function SinglecastCapabilitiesManager(F,B){this.sender=F,this.logger=B}return SinglecastCapabilitiesManager.prototype.setCapabilities=function(F){return W(this,void 0,void 0,(function(){return z(this,(function(B){switch(B.label){case 0:return 0===F.length||1!==F.length?(this.logger.safe.error("Incorrect number of sender params!"),[2]):[4,this.sender.setParameters(F[0])];case 1:return B.sent(),[4,this.sender.start()];case 2:return B.sent(),[2]}}))}))},SinglecastCapabilitiesManager.prototype.updateStreamQualityParams=function(F,B){return this.sender.updateStreamQualityParams(F,B)},SinglecastCapabilitiesManager.prototype.stopSenders=function(){return W(this,void 0,void 0,(function(){return z(this,(function(F){switch(F.label){case 0:return[4,this.sender.stop()];case 1:return F.sent(),[2]}}))}))},SinglecastCapabilitiesManager}();B.SinglecastCapabilitiesManager=Y},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.StateMachine=void 0;var W=function(){function StateMachine(F,B,G){this.transitionStates=F,this.logger=G,this.stateInternal=B}return Object.defineProperty(StateMachine.prototype,"state",{get:function(){return this.stateInternal},enumerable:!1,configurable:!0}),StateMachine.prototype.isDestinationStateValid=function(F){return this.transitionStates[this.stateInternal].indexOf(F)>-1},StateMachine.prototype.setState=function(F){return this.isDestinationStateValid(F)?(this.stateInternal=F,!0):(this.logger.safe.info("Invalid state transition ".concat(this.stateInternal," -> ").concat(F)),!1)},StateMachine.prototype.isCurrentStateMatchedWith=function(F){return this.stateInternal===F||(this.logger.safe.info("State does not match. Current: ".concat(this.stateInternal," required: ").concat(F)),!1)},StateMachine}();B.StateMachine=W},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.StreamSender=void 0;var Q=G(8),Y=G(6),$=G(445),X=G(28),Z=G(446),ee=G(1),te=G(10),ne=G(162),ie=function(F){function StreamSender(B,G,W,z,K,J){var Q=F.call(this)||this;return Q.mediaConnection=B,Q.contextStream=W,Q.logger=z,Q.configProvider=K,Q.encStreamsManager=J,Q.isActive=!1,Q.isMuted=!1,Q.resolutionTable=new X.default(Q.configProvider.config.resolutionTableOverride),Q.configProvider.config.renderThroughCanvas&&(Q.videoThroughCanvas=new $.VideoThroughCanvas(Q.logger.createChild("videoThroughCanvas"))),Q.stream=G.clone("streamSender ctor"),Q.streamResolution=Q.stream.getResolution(),Q}return z(StreamSender,F),Object.defineProperty(StreamSender.prototype,"rtpSender",{get:function(){return this.sender},enumerable:!1,configurable:!0}),Object.defineProperty(StreamSender.prototype,"trackId",{get:function(){var F=this.rawTrack;return null==F?void 0:F.id},enumerable:!1,configurable:!0}),Object.defineProperty(StreamSender.prototype,"rawTrack",{get:function(){var F;return(null===(F=this.audioMixer)||void 0===F?void 0:F.getDestinationTrack())||this.stream.rawTrack},enumerable:!1,configurable:!0}),Object.defineProperty(StreamSender.prototype,"canvasedRawTrack",{get:function(){var F,B;return this.configProvider.config.renderThroughCanvas?"Video"!==this.stream.mediaType?this.rawTrack:null!==(B=null===(F=this.videoThroughCanvas)||void 0===F?void 0:F.modify(this.rawTrack))&&void 0!==B?B:this.rawTrack:this.rawTrack},enumerable:!1,configurable:!0}),StreamSender.prototype.init=function(){return K(this,void 0,void 0,(function(){var F;return J(this,(function(B){switch(B.label){case 0:return F=this,[4,this.createSender()];case 1:return F.sender=B.sent(),this.isActive=!0,this.addStreamTransforms(),[2]}}))}))},StreamSender.prototype.start=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.isActive?(this.logger.safe.info("Already active. Do nothing"),[2]):(this.logger.safe.info("Starting"),this.isActive=!0,[4,this.wakeSender()]);case 1:return F.sent(),this.params?[4,this.applyParams(this.params)]:[3,3];case 2:F.sent(),F.label=3;case 3:return this.logger.safe.info("Started"),[2]}}))}))},StreamSender.prototype.stop=function(){return K(this,void 0,void 0,(function(){var F;return J(this,(function(B){switch(B.label){case 0:return this.isActive?(this.logger.safe.info("Stopping"),this.isActive=!1,"Audio"===this.stream.mediaType?[3,2]:(F=this.configProvider.config.webrtcDisabledSenderBitrate,[4,this.applyBitrate(F,!1)])):(this.logger.safe.info("Already stopped. Do nothing"),[2]);case 1:B.sent(),B.label=2;case 2:return[4,this.sleepSender()];case 3:return B.sent(),this.logger.safe.info("Stopped"),[2]}}))}))},StreamSender.prototype.setMuted=function(F,B,G){var W;this.isMuted=F,this.stream.setMuted(F,B),F&&this.audioMixer&&1!==this.audioMixer.numberOfStreams||null===(W=this.audioMuteTransform)||void 0===W||W.mute(F),!this.configProvider.config.requestNewStreamOnUnmute||F||G||this.stream.isActive()||this.event("onNewStreamNeeded").raise()},StreamSender.prototype.setHold=function(F,B){return K(this,void 0,void 0,(function(){return J(this,(function(G){return[2,this.activateSender(!F,B)]}))}))},StreamSender.prototype.setMainStream=function(F){var B,G;return K(this,void 0,void 0,(function(){var W;return J(this,(function(z){switch(z.label){case 0:return this.stream.dispose(),this.stream=F.clone("streamSender setMainStream"),this.streamResolution=this.stream.getResolution(),this.stream.setMuted(this.isMuted),this.params?[4,this.applyCapabilities(this.params)]:[3,2];case 1:z.sent(),z.label=2;case 2:return null===(B=this.audioMixer)||void 0===B||B.addSourceStream(this.stream),this.isActive?(W=null===(G=this.rawTrack)||void 0===G?void 0:G.id,this.logger.safe.info("Replace sender with track: ".concat(W)),[4,this.sender.replaceTrack(this.canvasedRawTrack)]):[3,4];case 3:z.sent(),this.logger.safe.info("Replace completed"),z.label=4;case 4:return[2]}}))}))},StreamSender.prototype.addAdditionalStream=function(F){var B,G;return K(this,void 0,void 0,(function(){return J(this,(function(W){return this.audioMixer||this.logger.safe.error("addAdditionalStream is called when audioMixer is not created. Main stream type is ".concat(this.stream.mediaType,".")),null===(B=this.audioMixer)||void 0===B||B.addSourceStream(F),null===(G=this.audioMuteTransform)||void 0===G||G.mute(!1),[2]}))}))},StreamSender.prototype.setParameters=function(F,B){return void 0===B&&(B=!1),K(this,void 0,void 0,(function(){return J(this,(function(G){return B||this.params!==F?(this.params=F,this.isActive?[2,this.applyParams(this.params)]:(this.logger.safe.info("Sender is not active, preserving params"),[2])):[2]}))}))},StreamSender.prototype.dispose=function(){var B;return K(this,void 0,void 0,(function(){return J(this,(function(G){switch(G.label){case 0:return F.prototype.dispose.call(this),this.clearStreamTransforms(),[4,this.disposeSender()];case 1:return G.sent(),this.sender=null,this.stream.dispose(),this.stream=null,this.isActive=!1,null===(B=this.videoThroughCanvas)||void 0===B||B.dispose(),[2]}}))}))},StreamSender.prototype.getActiveStreamIndexes=function(){return this.getSenderParameters().encodings.filter((function(F){return F.active})).map((function(F){return+F.rid}))},StreamSender.prototype.updateStreamQualityParams=function(F,B){return K(this,void 0,void 0,(function(){return J(this,(function(G){return this.configProvider.config.useSetParametersToApplyCapabilities?F?(this.logger.safe.debug("Stream resolution has changed to ".concat(JSON.stringify(F),"@").concat(B,", re-applying send parameters")),this.streamResolution=F,this.params?[2,this.setParameters(this.params,!0)]:(this.logger.safe.debug("Params are not yet set, do nothing"),[2])):(this.logger.safe.debug("Resolution is not defined: ".concat(JSON.stringify(F),"@").concat(B)),[2]):[2]}))}))},StreamSender.prototype.applyParams=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){switch(B.label){case 0:return this.logger.safe.info("Applying params: ".concat(JSON.stringify(F))),[4,this.applyCapabilities(F)];case 1:return B.sent(),[4,this.applyBitrate(F.maxBr)];case 2:return B.sent(),this.params.keyframe?[4,this.forceKeyframe()]:[3,4];case 3:B.sent(),B.label=4;case 4:return[2]}}))}))},StreamSender.prototype.applyBitrate=function(F,B){void 0===B&&(B=!0);var G=B?this.getAdjustedBitrate(F):F;return this.setEncodingParameters({maxBitrate:G},"applyBitrate")},StreamSender.prototype.getAdjustedBitrate=function(F){var B=F||0;if("Video"===this.stream.mediaType){var G=this.resolutionTable.getResolutionRecord(this.streamResolution.width,this.streamResolution.height);B=Math.min(B||G.maxBitrate,G.maxBitrate)}return B},StreamSender.prototype.activateSender=function(F,B){return K(this,void 0,void 0,(function(){return J(this,(function(G){switch(G.label){case 0:return[4,this.setEncodingParameters({active:F},"activateSender")];case 1:return G.sent(),this.logger.safe.info("[".concat(B,"] Active state applied isActive = ").concat(F)),[2]}}))}))},StreamSender.prototype.forceKeyframe=function(){return K(this,void 0,void 0,(function(){var F;return J(this,(function(B){switch(B.label){case 0:return this.sender?this.sender.track?(this.logger.safe.info("Restoring keyframe starting"),F=this.getSenderParameters().encodings[0].scaleResolutionDownBy||1,[4,this.setEncodingParameters({scaleResolutionDownBy:F*this.configProvider.config.forceKeyFrameV2ScaleFactor},"forceKeyframe start")]):(this.logger.safe.info("Sender track does not exist, not restoring keyframe"),[2]):(this.logger.safe.error("No sender available"),[2,null]);case 1:return B.sent(),[4,this.setEncodingParameters({scaleResolutionDownBy:F},"forceKeyframe end")];case 2:return B.sent(),this.logger.safe.info("Restoring keyframe finished"),[2]}}))}))},StreamSender.prototype.disposeSender=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){if("closed"!==this.mediaConnection.connectionState){this.logger.safe.info("Removing sender from pc");try{this.mediaConnection.removeSender(this.sender)}catch(F){this.logger.safe.warn("Error removing sender: ".concat(ee.stringifyObject(F)))}}else this.logger.safe.info("Not removing sender from pc, connectionState: ".concat(this.mediaConnection.connectionState,", track exists: ").concat(!!this.sender.track));return[2]}))}))},StreamSender.prototype.createSender=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){return this.setupAudioMixer(),[2,this.mediaConnection.createSender(this.canvasedRawTrack,this.contextStream,te.mediaTypeToModality(this.stream.mediaType))]}))}))},StreamSender.prototype.wakeSender=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.logger.safe.info("Wake started"),[4,this.sender.replaceTrack(this.canvasedRawTrack)];case 1:return F.sent(),this.logger.safe.info("Wake completed"),[2]}}))}))},StreamSender.prototype.sleepSender=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return this.logger.safe.info("Sleep started"),[4,this.sender.replaceTrack(null)];case 1:return F.sent(),this.logger.safe.info("Sleep completed"),[2]}}))}))},StreamSender.prototype.addStreamTransforms=function(){var F,B,G=this.encStreamsManager.getOrCreateStreamTransformer(this.sender);G&&("Audio"===this.stream.mediaType?(null===(F=this.configProvider.config.useInsertableStreams)||void 0===F?void 0:F.audioExtendedMute)&&(this.audioMuteTransform=new ne.AudioMuteTransform(this.logger.createChild("SendAudioPayload")),G.addTransform(this.audioMuteTransform)):(null===(B=this.configProvider.config.useInsertableStreams)||void 0===B?void 0:B.videoStreamAnalyzer)&&G.addTransform(new ne.VideoStreamAnalyzer(this.logger.createChild("SendStreamAnalyzer [".concat(this.stream.mediaType,"]")))))},StreamSender.prototype.clearStreamTransforms=function(){var F=this.encStreamsManager.getStreamTransformer(this.sender);null==F||F.clearTransforms()},StreamSender.prototype.setupAudioMixer=function(){"Audio"===this.stream.mediaType&&this.configProvider.config.enableAudioSharing&&(this.audioMixer=new Z.AudioMixer(this.logger.createChild("AudioMixer")),this.audioMixer.addSourceStream(this.stream))},StreamSender.prototype.getSenderParameters=function(){var F,B=this.sender.getParameters();return(null===(F=B.encodings)||void 0===F?void 0:F.length)||(B.encodings=[{}]),B},StreamSender.prototype.setEncodingParameters=function(F,B,G){return void 0===G&&(G=!1),K(this,void 0,void 0,(function(){var W,z;return J(this,(function(K){switch(K.label){case 0:W=this.getSenderParameters(),Q.merge(W.encodings[0],F),0===W.encodings[0].maxBitrate&&(this.configProvider.config.setParametersMaxBitrateUndefined?W.encodings[0].maxBitrate=void 0:delete W.encodings[0].maxBitrate),K.label=1;case 1:return K.trys.push([1,3,,4]),[4,this.sender.setParameters(W)];case 2:return K.sent(),this.logger.safe.info("".concat(B,": Parameters applied for sender: ").concat(JSON.stringify(W.encodings[0]))),[3,4];case 3:if(z=K.sent(),this.logger.safe.error("".concat(B,": setParameters failed: ").concat(ee.stringifyObject(z),", parameters ").concat(JSON.stringify(W.encodings[0]))),G)throw z;return[3,4];case 4:return[2]}}))}))},StreamSender.prototype.applyCapabilities=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){switch(B.label){case 0:return this.configProvider.config.useSetParametersToApplyCapabilities?[4,this.setEncodingParameters({scaleResolutionDownBy:this.getScaleFactor(F.maxFs),maxFramerate:F.maxFps},"applyCapabilities",!0)]:[3,2];case 1:return B.sent(),[3,4];case 2:return[4,this.stream.applyCapabilities(F)];case 3:B.sent(),B.label=4;case 4:return[2]}}))}))},StreamSender.prototype.getScaleFactor=function(F){var B=this.resolutionTable.getResolutionByFs(F),G=this.streamResolution,W=G.width,z=G.height,K=Math.min(W,z)/B.height;return this.logger.safe.debug("Current stream resolution: ".concat(W,"x").concat(z,", scale factor: ").concat(K)),K<1?(this.logger.safe.warn("Resolution scale factor is less than 1: ".concat(K)),1):K},StreamSender}(Y.default);B.StreamSender=ie},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.VideoThroughCanvas=void 0;var W=function(){function VideoThroughCanvas(F,B){void 0===B&&(B=document.body);var G=this;this.logger=F,this.parentElement=B,this.container=this.createContainerElement(),this.video=this.createVideoElement(),this.canvas=this.createCanvasElement(),this.context=this.canvas.getContext("2d"),this.medaiQuery=window.matchMedia("(orientation: portrait)"),this.isPortrait=this.medaiQuery.matches,this.captureFrameRate=30,this.mediaQueryChangeListener=function(F){G.isPortrait=F.matches},this.container.append(this.video,this.canvas),this.parentElement.prepend(this.container),this.medaiQuery.addEventListener("change",this.mediaQueryChangeListener)}return VideoThroughCanvas.prototype.modify=function(F){var B=this;this.logger.safe.info("modify()"),this.clearAnimationFrames(),this.disposeStream(),this.stream=this.canvas.captureStream(this.captureFrameRate),this.video.srcObject=new MediaStream([F]),this.video.play();var G=F.getSettings(),W=0,z=0,requestFrame=function(){G=F.getSettings();var K=B.isPortrait?Math.min(G.width,G.height):Math.max(G.width,G.height),J=B.isPortrait?Math.max(G.width,G.height):Math.min(G.width,G.height);W===K&&z===J||(B.canvas.width=K,B.canvas.height=J,W=K,z=J),B.context.drawImage(B.video,0,0,K,J),B.animationFrame=requestAnimationFrame(requestFrame)};return this.animationFrame=requestAnimationFrame(requestFrame),this.stream.getVideoTracks()[0]},VideoThroughCanvas.prototype.dispose=function(){this.logger.safe.info("dispose()"),this.clearAnimationFrames(),this.disposeStream(),this.container.parentElement.removeChild(this.container),this.medaiQuery.removeEventListener("change",this.mediaQueryChangeListener)},VideoThroughCanvas.prototype.disposeStream=function(){this.stream&&(this.stream.getTracks().forEach((function(F){return F.stop()})),this.stream=void 0)},VideoThroughCanvas.prototype.createContainerElement=function(){var F=document.createElement("div");return F.style.opacity="0",F.style.position="fixed",F.style.zIndex="-2147483648",F.style.pointerEvents="none",F.style.top="0",F.style.left="0",F.style.bottom="0",F.style.right="0",F},VideoThroughCanvas.prototype.createVideoElement=function(){var F=document.createElement("video");return F.setAttribute("muted",""),F.setAttribute("playsinline",""),F.setAttribute("autoplay",""),F.style.top="0",F.style.left="0",F},VideoThroughCanvas.prototype.createCanvasElement=function(){var F=document.createElement("canvas");return F.style.right="0",F.style.bottom="0",F},VideoThroughCanvas.prototype.clearAnimationFrames=function(){this.logger.safe.info("clearAnimationFrames()"),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0)},VideoThroughCanvas}();B.VideoThroughCanvas=W},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.AudioMixer=void 0;var J=G(18),Q=function(F){function AudioMixer(B){var G=F.call(this,B)||this;return G.logger=B,G.audioContext=new J.default.window.AudioContext,G.destination=G.audioContext.createMediaStreamDestination(),G.streamNodeMap=new Map,G.logger.safe.info("Destination stream: ".concat(G.destination.stream.id,", track: ").concat(G.getDestinationTrack().id)),G.subscribeOnMediaTrackEvents(G.getDestinationTrack()),G}return z(AudioMixer,F),Object.defineProperty(AudioMixer.prototype,"numberOfStreams",{get:function(){return this.streamNodeMap.size},enumerable:!1,configurable:!0}),AudioMixer.prototype.addSourceStream=function(F){var B=this;if(F.rawStream&&!this.streamNodeMap.has(F.rawStream)){var G=F.on("onStreamClientDisposing",(function(){B.removeSourceStream(F.rawStream),G.dispose()}));this.logger.safe.info("Add stream: ".concat(F.rawStream.id,", track: ").concat(getTrack(F.rawStream).id)),this.addStream(F.rawStream,F.mediaType)}},AudioMixer.prototype.getDestinationTrack=function(){return getTrack(this.destination.stream)},AudioMixer.prototype.dispose=function(){var B,G;F.prototype.dispose.call(this),this.unsubscribeFromMediaTrackEvents(this.getDestinationTrack());try{for(var W=K(this.streamNodeMap.keys()),z=W.next();!z.done;z=W.next()){var J=z.value;this.removeSourceStream(J)}}catch(F){B={error:F}}finally{try{z&&!z.done&&(G=W.return)&&G.call(W)}finally{if(B)throw B.error}}},AudioMixer.prototype.addStream=function(F,B){void 0===B&&(B="Audio");var G=this.audioContext.createMediaStreamSource(F);G.connect(this.destination),this.streamNodeMap.set(F,{mediaType:B,sourceNode:G})},AudioMixer.prototype.removeSourceStream=function(F){var B=this.streamNodeMap.get(F);B&&(this.logger.safe.info("Remove stream: ".concat(F.id,", track: ").concat(getTrack(F).id)),B.sourceNode.disconnect(),this.streamNodeMap.delete(F))},AudioMixer.prototype.subscribeOnMediaTrackEvents=function(F){var B=this;F.onended=function(G){B.logger.safe.info("Track ".concat(F.id," ended: ").concat(JSON.stringify(G)))},F.onmute=function(){B.logger.safe.info("Track ".concat(F.id," muted"))},F.onunmute=function(){B.logger.safe.info("Track ".concat(F.id," unmuted"))}},AudioMixer.prototype.unsubscribeFromMediaTrackEvents=function(F){F.onended=null,F.onmute=null,F.onunmute=null},AudioMixer}(G(6).default);function getTrack(F){return F.getAudioTracks()[0]}B.AudioMixer=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.TransportStateProvider=void 0;var W=function(){function TransportStateProvider(F,B,G,W,z){this.pc=F,this.cryptoMethod=B,this.logger=G,this.configProvider=W,this.stateChangedCallback=z,this.logger=G.createChild("TransportStateProvider"),this.subscribeForConnectionState()}return Object.defineProperty(TransportStateProvider.prototype,"hasPcConnectionState",{get:function(){return"connectionState"in this.pc&&this.configProvider.config.useConnectionState},enumerable:!1,configurable:!0}),TransportStateProvider.prototype.subscribeForConnectionState=function(){var F=this;this.pc.oniceconnectionstatechange=function(){F.logger.safe.info("RTCPeerConnection oniceconnectionstatechange iceConnectionState: ".concat(F.pc.iceConnectionState," pc.signalingState: ").concat(F.pc.signalingState)),F.shouldRaise(0)&&F.stateChangedCallback(F.pc.iceConnectionState)},1===this.cryptoMethod&&this.hasPcConnectionState&&(this.pc.onconnectionstatechange=function(){F.logger.safe.info("RTCPeerConnection onconnectionStatechange connectionState: ".concat(F.pc.connectionState," pc.signalingState: ").concat(F.pc.signalingState)),F.shouldRaise(1)&&F.stateChangedCallback(F.pc.connectionState)})},TransportStateProvider.prototype.subscribeForDtlsTransportState=function(){var F=this;if(this.configProvider.config.useDtlsTrasportConnectionCheck&&!this.transport&&1===this.cryptoMethod&&!this.hasPcConnectionState){var B=this.pc.getReceivers().find((function(F){return!!F.transport}));this.transport=B&&B.transport,this.transport&&(this.transport.onstatechange=function(){F.logger.safe.info("RTCDtlsTransport onstatechange state: ".concat(F.transport.state," pc.signalingState: ").concat(F.pc.signalingState)),F.shouldRaise(2)&&F.stateChangedCallback(F.transport.state)})}},TransportStateProvider.prototype.dispose=function(){this.pc.oniceconnectionstatechange=null,this.transport&&(this.transport.onstatechange=null,this.transport=null),this.pc.onconnectionstatechange&&(this.pc.onconnectionstatechange=null),this.pc=null,this.stateChangedCallback=null},TransportStateProvider.prototype.shouldRaise=function(F){var B;switch(F){case 2:if(1!==this.cryptoMethod)throw new Error("DTLS transport is used with cryptoMethod=".concat(this.cryptoMethod));return!this.configProvider.config.ignoreClosedDtlsTransportState||"closed"!==this.transport.state;case 1:return 1===this.cryptoMethod&&!this.transport;case 0:return!(!this.configProvider.config.ignoreClosedDtlsTransportState||!this.transport||"closed"!==this.pc.iceConnectionState)||(0===this.cryptoMethod||!this.transport&&!this.hasPcConnectionState||this.transport&&"disconnected"===this.pc.iceConnectionState||"connected"===(null===(B=this.transport)||void 0===B?void 0:B.state)&&"connected"===this.pc.iceConnectionState);default:return this.logger.safe.error("unknown StateMethod=".concat(F)),!1}},TransportStateProvider}();B.TransportStateProvider=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function WebRtcReceiveStreamStateDecorator(F,B,G,W,z){this.recvStream=F,this.mainTrack=B,this.receiveStreamCollection=G,this.logger=W,this.settings=z,this.removeOtherTracks(B),this.subscribeOnStreamEvents()}return Object.defineProperty(WebRtcReceiveStreamStateDecorator.prototype,"stream",{get:function(){return this.recvStream.getMediaStream()},enumerable:!1,configurable:!0}),WebRtcReceiveStreamStateDecorator.prototype.dispose=function(){this.unsubscribeFromStreamEvents(),this.receiveStreamCollection=null,this.mainTrack=null,this.recvStream.dispose()},WebRtcReceiveStreamStateDecorator.prototype.getId=function(){return this.recvStream.getId()},WebRtcReceiveStreamStateDecorator.prototype.getModality=function(){return this.recvStream.getModality()},WebRtcReceiveStreamStateDecorator.prototype.getMsi=function(){return this.recvStream.getMsi()},WebRtcReceiveStreamStateDecorator.prototype.getMediaStream=function(){return this.stream},WebRtcReceiveStreamStateDecorator.prototype.getReceiver=function(){return this.recvStream.getReceiver()},WebRtcReceiveStreamStateDecorator.prototype.requestSource=function(F){return this.recvStream.requestSource(F)},WebRtcReceiveStreamStateDecorator.prototype.getSourceStreamId=function(){return this.recvStream.getSourceStreamId()},WebRtcReceiveStreamStateDecorator.prototype.removeOtherTracks=function(F){var B=this;this.settings.onAddTrackRemoveOtherTracks&&this.stream.getTracks().forEach((function(G){G.id!==F.id&&B.stream.removeTrack(G)}))},WebRtcReceiveStreamStateDecorator.prototype.subscribeOnStreamEvents=function(){var F=this,logEvent=function(B){return F.logger.safe.info("".concat(B," track: ").concat(F.mainTrack.id,", stream: ").concat(F.stream.id))};this.stream.onremovetrack=function(){logEvent("onremovetrack"),F.receiveStreamCollection.remove(F.stream.id)},this.mainTrack.onended=function(){logEvent("onended"),F.settings.removeRecvStreamOnEnded&&F.receiveStreamCollection.remove(F.stream.id)},this.mainTrack.onmute=function(){return logEvent("onmute")},this.mainTrack.onunmute=function(){return logEvent("onunmute")}},WebRtcReceiveStreamStateDecorator.prototype.unsubscribeFromStreamEvents=function(){this.stream.onremovetrack=null,this.mainTrack.onended=null,this.mainTrack.onmute=null,this.mainTrack.onunmute=null},WebRtcReceiveStreamStateDecorator}();B.default=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.DSHGeneratingStrategy=void 0;var W=G(1),z=function(){function Source(F){this.startTimestamp=0,this.totalTime=0,this.lastActiveTime=0,this.id=F}return Source}(),K=function(){function DSHGeneratingStrategy(F){this.speakersHistory=[],this.sources=[],this.configProvider=F.configProvider,this.ping=this.setupTimer()}return DSHGeneratingStrategy.prototype.setSources=function(F){var B=this;void 0===F&&(F=[]);var G=F.map(this.getOrCreateSource.bind(this)),W=this.excludeSources(this.sources,G);G.forEach((function(F){B.isAlreadyActive(F)||B.updateSourceTimestamp(F),B.updateSourceLastActiveTime(F)})),W.forEach((function(F){B.updateTotalTime(F),B.resetStartTimestamp(F)})),this.ping||(this.ping=this.setupTimer())},DSHGeneratingStrategy.prototype.setOnDominantSpeakerChanged=function(F){this.callback=F},DSHGeneratingStrategy.prototype.dispose=function(){this.clearTimer(),this.sources=null,this.callback=null},DSHGeneratingStrategy.prototype.excludeSources=function(F,B){return F.filter((function(F){return!B.some((function(B){return F.id===B.id}))}))},DSHGeneratingStrategy.prototype.trigger=function(){if(this.hasAnyoneSpoken()){var byActivity=function(F,B){return B.totalTime-F.totalTime||B.lastActiveTime-F.lastActiveTime},toSourceId=function(F){return F.id},F=this.sources.map(this.updateTotalTime).sort(byActivity).map(toSourceId).slice(0,this.configProvider.config.ovcMaxCount);F.length&&!W.deepEqual(this.speakersHistory,F)&&(this.speakersHistory=F,this.callback&&this.callback(this.speakersHistory,!1)),this.sources.map(this.resetTotalTime).filter(this.isAlreadyActive).forEach(this.updateSourceTimestamp)}else this.clearTimer()},DSHGeneratingStrategy.prototype.isAlreadyActive=function(F){return!!F.startTimestamp},DSHGeneratingStrategy.prototype.setupTimer=function(){return window.setInterval(this.trigger.bind(this),this.configProvider.config.activeSpeaker.timeToPromote)},DSHGeneratingStrategy.prototype.clearTimer=function(){this.ping&&(clearInterval(this.ping),this.ping=null)},DSHGeneratingStrategy.prototype.getOrCreateSource=function(F){if(this.isExist(F))return this.sourceById(F);var B=new z(F);return this.sources.push(B),B},DSHGeneratingStrategy.prototype.isExist=function(F){return this.sources.some((function(B){return F===B.id}))},DSHGeneratingStrategy.prototype.hasAnyoneSpoken=function(){return this.sources.some((function(F){return 0!==F.startTimestamp||0!==F.totalTime}))},DSHGeneratingStrategy.prototype.sourceById=function(F){return this.sources.find((function(B){return F===B.id}))},DSHGeneratingStrategy.prototype.updateSourceTimestamp=function(F){F.startTimestamp=Date.now()},DSHGeneratingStrategy.prototype.updateSourceLastActiveTime=function(F){F.lastActiveTime=Date.now()},DSHGeneratingStrategy.prototype.updateTotalTime=function(F){return F.startTimestamp&&(F.totalTime+=Date.now()-F.startTimestamp),F},DSHGeneratingStrategy.prototype.resetStartTimestamp=function(F){return F.startTimestamp=0,F},DSHGeneratingStrategy.prototype.resetTotalTime=function(F){return F.totalTime=0,F},DSHGeneratingStrategy}();B.DSHGeneratingStrategy=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)},J=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},Q=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},Y=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},$=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.AudioEffectManager=void 0;var X=G(6),Z=G(33),ee=G(53),te=G(1),ne=G(164),ie=function(F){function AudioEffectManager(B,G,W,z){var K,J,Q,Y=F.call(this,z)||this;return Y.wasmdnsProvider=B,Y.wasmaecProvider=G,Y.configProvider=W,Y.logger=z,Y.serialQueue=new Z.PromiseQueue(Y.logger),Y.statistics=new ne.EffectStatistics(Y.configProvider.config.effectsTelemetryBufferSize),Y.currentEffect="Off",Y.currentEffectProvider="WasmDns",Y.currentEffectCapability=0,Y.userNoiseSuppressionMode=0,Y.noiseSuppressionModeToAudioEffectMapping=((K={}).Off=0,K.Auto=1,K.Low=2,K.High=3,K),Y.audioEffectToWasmDnsEffectMapping=((J={})[0]="Off",J[3]="Deep NS",J[2]="Classic NS",J),Y.noiseSuppressionModeToWasmDnsEffectMapping=((Q={}).Off="Off",Q.High="Deep NS",Q.Low="Classic NS",Q),Y.userNoiseSuppressionMode=Y.noiseSuppressionModeToAudioEffectMapping[Y.configProvider.mediaConfig.noiseSuppressionMode],Y}return z(AudioEffectManager,F),AudioEffectManager.prototype.configureEffect=function(F){return Y(this,void 0,void 0,(function(){var B,G,W;return $(this,(function(z){switch(z.label){case 0:return this.statistics.clearErrors(),this.dnsProvider?[3,2]:(this.logger.safe.debug("Initializing DNS provider ..."),B=this,[4,this.initializeAudioEffectProvider(3)]);case 1:B.dnsProvider=z.sent(),z.label=2;case 2:return this.aecProvider?[3,4]:(this.logger.safe.debug("Initializing AEC provider ..."),G=this,[4,this.initializeAudioEffectProvider(2)]);case 3:G.aecProvider=z.sent(),z.label=4;case 4:if(!F.audioContext)return this.notifyError("FailedToInitialize","Unable to configure audio effects: no audio context specified."),[2];F.noiseSuppressionMode||(this.logger.safe.debug("configureEffect was called without a noiseSuppressionMode. Using noiseSuppressionMode from config provider ..."),F.noiseSuppressionMode=this.configProvider.mediaConfig.noiseSuppressionMode),this.currentEffect=this.noiseSuppressionModeToWasmDnsEffectMapping[F.noiseSuppressionMode],this.logger.safe.debug("currentEffect is ".concat(this.currentEffect)),z.label=5;case 5:return z.trys.push([5,8,,9]),this.logger.safe.debug("Configuring audio effect for DNS ..."),[4,this.dnsProvider.configureEffect(F)];case 6:return z.sent(),this.logger.safe.debug("Configuring audio effect for AEC ..."),[4,this.aecProvider.configureEffect(F)];case 7:return z.sent(),this.logger.safe.debug("The audio effects were configured as follows: ".concat(te.stringifyObject(F))),[3,9];case 8:return W=z.sent(),this.notifyError("FailedToInitialize","Audio effect provider configuration failed (".concat(W,"), while trying to use this configuration: ").concat(te.stringifyObject(F),".")),[3,9];case 9:return[2]}}))}))},AudioEffectManager.prototype.setSourceAsync=function(F){return Y(this,void 0,void 0,(function(){var B,G,W=this;return $(this,(function(z){switch(z.label){case 0:if(this.logger.safe.debug("Set source: ".concat(F?F.id:"no stream",", this.currentEffect = ").concat(this.currentEffect)),!this.dnsProvider||!this.aecProvider)return this.statistics.setError("FailedToInitialize","setSourceAsync: audio effect provider not initialized (".concat(this.dnsProvider?"AEC":"DNS",").")),this.logger.safe.warn("Unable to configure audio effects: audio effect provider not initialized (".concat(this.dnsProvider?"AEC":"DNS",").")),[2,F];this.effectProviderSubs=[this.dnsProvider.on("onEffectStopped",(function(){return W.notifyAboutLastSessionStats()})),this.dnsProvider.on("onErrorNotified",(function(F){return W.notifyError("WasmDnsProccessorError",F)})),this.aecProvider.on("onErrorNotified",(function(F){return W.notifyError("WasmAecProccessorError",F)}))],B=F,z.label=1;case 1:return z.trys.push([1,3,,4]),[4,this.dnsProvider.setSourceAsync(F)];case 2:return B=z.sent(),[3,4];case 3:return G=z.sent(),this.notifyError("WasmDnsProccessorError","setSourceAsync: Failed to asynchronously set source for DNS (".concat(G,")")),[3,4];case 4:try{return[2,this.aecProvider.setSourceAsync(B)]}catch(F){return this.notifyError("WasmAecProccessorError","setSourceAsync: Failed to asynchronously set source for AEC (".concat(F,")")),[2,B]}return[2]}}))}))},AudioEffectManager.prototype.setEffectAsync=function(F){return Y(this,void 0,void 0,(function(){var B,G;return $(this,(function(W){switch(W.label){case 0:if(B=this.getWasmDnsEffect(F),this.logger.safe.debug("Set effect: ".concat(F," (").concat(B,")")),!B)throw this.notifyError("WasmDnsProccessorError","setEffectAsync: Audio effect with type '".concat(F,"' is not supported")),new Error("Audio effect with type '".concat(F,"' is not supported"));if(this.userNoiseSuppressionMode=F,!this.dnsProvider||!this.aecProvider)return this.notifyError("FailedToInitialize","setEffectAsync: Audio effects provider not initialized (".concat(this.dnsProvider?"AEC":"DNS",").")),this.logger.safe.debug("Audio effects provider not initialized (".concat(this.dnsProvider?"AEC":"DNS",").")),[2];W.label=1;case 1:switch(W.trys.push([1,12,,13]),this.currentEffect=this.audioEffectToWasmDnsEffectMapping[F],this.logger.safe.debug("currentEffect is ".concat(this.currentEffect)),this.currentEffectProvider="WasmDns",B){case"Deep NS":return[3,2];case"Off":return[3,5]}return[3,8];case 2:return[4,this.dnsProvider.setEffectAsync(B)];case 3:return W.sent(),[4,this.aecProvider.setEffectAsync("Off")];case 4:return W.sent(),[3,11];case 5:return[4,this.dnsProvider.setEffectAsync(B)];case 6:return W.sent(),[4,this.aecProvider.setEffectAsync(B)];case 7:return W.sent(),[3,11];case 8:return this.currentEffectProvider="WasmAec",[4,this.aecProvider.setEffectAsync(B)];case 9:return W.sent(),[4,this.dnsProvider.setEffectAsync("Off")];case 10:W.sent(),W.label=11;case 11:return[3,13];case 12:throw G=W.sent(),this.notifyError("WasmDns"===this.currentEffectProvider?"WasmDnsProccessorError":"WasmAecProccessorError","setEffectAsync: Failed to apply '".concat(B,"' audio effect, error: ").concat(te.stringifyObject(G))),G;case 13:return[2]}}))}))},AudioEffectManager.prototype.dispose=function(){var B,G,W;return Y(this,void 0,void 0,(function(){return $(this,(function(z){try{null===(B=this.dnsProvider)||void 0===B||B.dispose(),null===(G=this.aecProvider)||void 0===G||G.dispose(),null===(W=this.effectProviderSubs)||void 0===W||W.forEach((function(F){return F.dispose()})),this.effectProviderSubs=null,F.prototype.dispose.call(this),this.logger.safe.debug("The audio effects provider was disposed.")}catch(F){this.logger.safe.error("dispose: Failed to dispose the audio effects provider (".concat(F,")"))}return[2]}))}))},AudioEffectManager.prototype.getEffectsCapability=function(){return Y(this,void 0,void 0,(function(){return $(this,(function(F){return this.currentEffectCapability=0,this.configProvider.config.wasmdns.enableNoiseSuppression&&(this.currentEffectCapability|=2,this.currentEffectCapability|=3),[2,this.currentEffectCapability]}))}))},AudioEffectManager.prototype.getVersion=function(){var F,B,G,W,z="WasmDns ".concat(null!==(B=null===(F=this.dnsProvider)||void 0===F?void 0:F.getVersion())&&void 0!==B?B:"Unknown"),K="WasmAec ".concat(null!==(W=null===(G=this.aecProvider)||void 0===G?void 0:G.getVersion())&&void 0!==W?W:"Unknown");return"".concat(z," / ").concat(K)},AudioEffectManager.prototype.getStats=function(){var F;this.dnsProvider&&this.wasmaecProvider||this.statistics.setError("FailedToInitialize","getStats: Unable to get stats from uninitialized audio effect provider (".concat(this.dnsProvider?"AEC":"DNS",")."));var B=null===(F=this.dnsProvider)||void 0===F?void 0:F.getStats();return B||(this.statistics.setError("FailedToInitialize","getStats: Empty stats from DNS provider."),B={}),B.userNoiseSuppressionMethod=this.userNoiseSuppressionMode,K({timestamp:Date.now()},this.createTelemetryEvent(B))},AudioEffectManager.prototype.getWasmDnsEffect=function(F){return this.audioEffectToWasmDnsEffectMapping[F]},AudioEffectManager.prototype.initializeAudioEffectProvider=function(F){return Y(this,void 0,void 0,(function(){var B,G,W;return $(this,(function(z){switch(z.label){case 0:if(3===F&&!this.wasmdnsProvider)return this.statistics.setError("FailedToInitialize","initializeAudioEffectProvider: WasmDns package not available."),this.logger.safe.warn("WasmDns package not available."),[2,null];if(2===F&&!this.wasmaecProvider)return this.statistics.setError("FailedToInitialize","initializeAudioEffectProvider: WasmAec package not available."),this.logger.safe.warn("WasmAec package not available."),[2,null];switch(F){case 3:case 0:this.currentEffectProvider="WasmDns";break;default:this.currentEffectProvider="WasmAec"}this.statistics.startLoadTimer(),z.label=1;case 1:return z.trys.push([1,6,,7]),"WasmDns"!==this.currentEffectProvider?[3,3]:[4,this.wasmdnsProvider.getAudioEffectProvider()];case 2:return G=z.sent(),[3,5];case 3:return[4,this.wasmaecProvider.getAudioEffectProvider()];case 4:G=z.sent(),z.label=5;case 5:return B=G,[3,7];case 6:return W=z.sent(),this.logger.safe.warn("initializeAudioEffectProvider: Failed to initialize ".concat(this.currentEffectProvider," audio effect provider (").concat(W,")")),this.statistics.setError("FailedToInitialize","initializeAudioEffectProvider: Failed to initialize ".concat(this.currentEffectProvider," audio effect provider (").concat(W,")")),[3,7];case 7:return this.statistics.stopLoadTimer(),B?(this.logger.safe.debug("".concat(this.currentEffectProvider," v").concat(B.getVersion&&B.getVersion()," initialized!")),[2,B]):(this.logger.safe.warn("Failed to initialize ".concat(this.currentEffectProvider," audio effect provider.")),[2,null])}}))}))},AudioEffectManager.prototype.createTelemetryEvent=function(F){return this.logger.safe.debug("Telemetry report: ".concat(JSON.stringify(F)," under version ").concat(this.getVersion(),", and capability is ").concat(this.currentEffectCapability)),{payload:K(K({audioEffectsCapability:this.currentEffectCapability,version:this.getVersion()},this.statistics.getReport()),F)}},AudioEffectManager.prototype.notifyError=function(F,B){this.statistics.setError(F,B),this.notifyAboutLastSessionStats()},AudioEffectManager.prototype.notifyAboutLastSessionStats=function(){var F=this.getStats();this.event("onAudioEffectTelemetryEvent").raise(F)},J([(0,ee.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],AudioEffectManager.prototype,"configureEffect",null),J([(0,ee.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],AudioEffectManager.prototype,"setSourceAsync",null),J([(0,ee.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Number]),Q("design:returntype",Promise)],AudioEffectManager.prototype,"setEffectAsync",null),J([(0,ee.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],AudioEffectManager.prototype,"dispose",null),AudioEffectManager}(X.default);B.AudioEffectManager=ie},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)},J=this&&this.__decorate||function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},Q=this&&this.__metadata||function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},Y=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},$=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},X=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.VideoEffectManager=void 0;var Z=G(6),ee=G(33),te=G(53),ne=G(1),ie=G(452),re=G(164),oe=function(F){function VideoEffectManager(B,G,W){var z,K=F.call(this,W)||this;return K.webcvProvider=B,K.configProvider=G,K.logger=W,K.serialQueue=new ee.PromiseQueue(K.logger),K.videoEffectToWebCVEffectMapping=((z={})[0]="off",z[1]="blur",z[16]="replacement",z),K.effectType=0,K.isPortrait=!1,K.statistics=new re.EffectStatistics(K.configProvider.config.effectsTelemetryBufferSize),K.processorType="Webgl2",K}return z(VideoEffectManager,F),Object.defineProperty(VideoEffectManager.prototype,"isEffectEnabled",{get:function(){return 0!==this.effectType},enumerable:!1,configurable:!0}),VideoEffectManager.prototype.init=function(){return Y(this,void 0,void 0,(function(){var F,B;return $(this,(function(G){switch(G.label){case 0:if(this.effectProvider)return[2];this.logger.safe.debug("Init"),G.label=1;case 1:return G.trys.push([1,3,,4]),F=this,[4,this.initializeVideoEffectProvider()];case 2:return F.effectProvider=G.sent(),[3,4];case 3:throw B=G.sent(),this.notifyError("FailedToInitialize","Initialization failed, error:".concat(ne.stringifyObject(B))),B;case 4:return[2]}}))}))},VideoEffectManager.prototype.dispose=function(){return Y(this,void 0,void 0,(function(){return $(this,(function(B){switch(B.label){case 0:return this.logger.safe.debug("Dispose"),this.effectProvider&&(this.effectProviderSubs.forEach((function(F){return F.dispose()})),this.effectProviderSubs=null),this.effectProvider?[4,this.effectProvider.disposeAsync()]:[3,2];case 1:B.sent(),B.label=2;case 2:return F.prototype.dispose.call(this),[2]}}))}))},VideoEffectManager.prototype.configure=function(F){return Y(this,void 0,void 0,(function(){return $(this,(function(B){return this.logger.safe.debug("Set config: ".concat(JSON.stringify(F))),this.effectConfig={backgroundImageUrl:F.imagePath,headers:F.headers},this.effectProvider?[2,this.effectProvider.configureEffect(this.effectConfig)]:(this.logger.safe.debug("WebCV is not initialized. Do nothing"),[2])}))}))},VideoEffectManager.prototype.setEffectAsync=function(F){return Y(this,void 0,void 0,(function(){var B,G;return $(this,(function(W){switch(W.label){case 0:return this.shouldApplyEffect(F)?this.effectProvider?[3,2]:(this.logger.safe.debug("Initializing effect provider"),[4,this.init()]):(this.logger.safe.debug("Effect ".concat(this.effectType," is already set")),[2]);case 1:W.sent(),W.label=2;case 2:if(this.logger.safe.debug("Set effect: ".concat(F)),!(B=this.getWebCVEffect(F)))throw new Error("Effect with type ".concat(F," is not supported"));if(this.shouldCollectStats(F)&&this.notifyAboutLastSessionStats(),this.effectType=F,!this.effectProvider)return this.logger.safe.debug("WebCV is not initialized. Do nothing"),[2];W.label=3;case 3:return W.trys.push([3,5,,7]),[4,this.effectProvider.setEffectAsync(B)];case 4:return W.sent(),[3,7];case 5:return G=W.sent(),[4,this.handleFailedProcessing()];case 6:throw W.sent(),this.notifyError("FailedToInitialize","Failed to apply ".concat(B,", error:").concat(ne.stringifyObject(G))),G;case 7:return[2]}}))}))},VideoEffectManager.prototype.setSourceAsync=function(F){return Y(this,void 0,void 0,(function(){var B,G,W;return $(this,(function(z){switch(z.label){case 0:if(this.logger.safe.debug("Set source: ".concat(F?F.id:"no stream")),!this.effectProvider)return this.logger.safe.debug("WebCV is not initialized. Do nothing"),[2,F];F.getTracks().length>0&&(B=F.getVideoTracks()[0].getSettings(),this.isPortrait=B.height>B.width),G=F,z.label=1;case 1:return z.trys.push([1,3,,5]),[4,this.effectProvider.setSourceAsync(F)];case 2:return G=z.sent(),[3,5];case 3:return W=z.sent(),[4,this.handleFailedProcessing()];case 4:return z.sent(),this.notifyError("FailedToInitialize","Failed to set source, error:".concat(ne.stringifyObject(W))),[3,5];case 5:return[2,G]}}))}))},VideoEffectManager.prototype.removeSourceAsync=function(F){return Y(this,void 0,void 0,(function(){return $(this,(function(B){return this.logger.safe.debug("Remove source: ".concat(F?F.id:"no stream")),this.effectProvider?[2,this.effectProvider.removeSourceAsync(F)]:(this.logger.safe.debug("WebCV is not initialized. Do nothing"),[2])}))}))},VideoEffectManager.prototype.getEffectsCapability=function(){return Y(this,void 0,void 0,(function(){var F,B,G,W,z,K,J,Q;return $(this,(function(Y){switch(Y.label){case 0:return F=0,[4,this.getCapability()];case 1:B=Y.sent(),this.logger.safe.debug("Get capabilty with return: ".concat(JSON.stringify(B)));try{for(G=X(B),W=G.next();!W.done;W=G.next()){if(z=W.value,!(K=this.getVideoEffectType(z)))throw new Error("Cannot convert WebCV effect to VideoEffect ".concat(z));F|=K}}catch(F){J={error:F}}finally{try{W&&!W.done&&(Q=G.return)&&Q.call(G)}finally{if(J)throw J.error}}return[2,F]}}))}))},VideoEffectManager.prototype.getStats=function(){if(this.effectProvider){var F=this.effectProvider.getStats(),B=this.statistics.getReport();if(F||B.error.length)return K({timestamp:Date.now()},this.createTelemetryEvent(F,B))}},VideoEffectManager.prototype.getVersion=function(){var F,B,G;return null!==(G=null===(B=null===(F=this.effectProvider)||void 0===F?void 0:F.getVersion)||void 0===B?void 0:B.call(F))&&void 0!==G?G:"Unknown"},VideoEffectManager.prototype.resetOutputConstraints=function(F){var B,G;return Y(this,void 0,void 0,(function(){var W;return $(this,(function(z){return this.effectProvider&&F.video?(W=K({},this.configProvider.config.webcv.qualityConfig),this.isPortrait?W.outputResolution=null!==(B=F.video.maxWidth)&&void 0!==B?B:W.outputResolution:W.outputResolution=null!==(G=F.video.maxHeight)&&void 0!==G?G:W.outputResolution,W.outputFps.max=F.video.fps,[2,this.effectProvider.configureStreamProcessor(W)]):[2]}))}))},VideoEffectManager.prototype.createTelemetryEvent=function(F,B){return{payload:K(K(K({version:this.getVersion()},B),F),{isWasmEnabled:"Wasm"===this.processorType})}},VideoEffectManager.prototype.notifyError=function(F,B){this.statistics.setError(F,B),this.notifyAboutLastSessionStats()},VideoEffectManager.prototype.notifyAboutLastSessionStats=function(){var F=this.getStats();F&&this.event("onVideoEffectTelementyEvent").raise(F)},VideoEffectManager.prototype.initializeVideoEffectProvider=function(){var F;return Y(this,void 0,void 0,(function(){var B,G,W=this;return $(this,(function(z){switch(z.label){case 0:return this.webcvProvider?(this.statistics.startLoadTimer(),[4,this.webcvProvider.getVideoEffectProvider()]):(this.logger.safe.debug("WebCV provider is not set"),[2,null]);case 1:return B=z.sent(),this.statistics.stopLoadTimer(),B?(this.logger.safe.debug("WebCV v".concat(null===(F=B.getVersion)||void 0===F?void 0:F.call(B)," is initialized")),[4,this.webcvProvider.getModelConfig()]):(this.statistics.setError("FailedToInitialize"),this.logger.safe.warn("WebCV is not initialized"),[2,null]);case 2:return G=z.sent(),[4,B.configureModel(G)];case 3:return z.sent(),[4,B.configure(K(K({},this.configProvider.config.webcv),{processorType:this.processorType}))];case 4:return z.sent(),this.effectConfig?[4,B.configureEffect(this.effectConfig)]:[3,6];case 5:z.sent(),z.label=6;case 6:return this.effectProviderSubs=[B.on("onEffectApplied",(function(){return W.event("onMediaStreamUpdateRequested").raise("Video")})),B.on("onEffectStopped",(function(){return W.notifyAboutLastSessionStats()})),B.on("onVideoEffectQualityChanged",(function(F){return W.event("onVideoEffectQualityChanged").raise(F)})),B.on("onVideoStreamQualityChanged",(function(F){return W.event("onVideoStreamQualityChanged").raise(F.resolution,F.fps)})),B.on("onCapabilitiesChanged",(function(){return W.event("onVideoEffectCapabilitiesChanged").raise()})),B.on("onFirstFrameProcessed",(function(){return W.onPreheatCompleted()})),B.on("onErrorNotified",(function(F){return W.notifyError("WebcvProccessorError",F)}))],[2,B]}}))}))},VideoEffectManager.prototype.getCapability=function(){return Y(this,void 0,void 0,(function(){var F,B;return $(this,(function(G){return this.configProvider.config.enableVideoEffects?this.webcvProvider?(F=new ie.CapabilityChecker(this.configProvider,this.statistics,this.logger.createChild("CapabilityChecker")),B=["off"],F.isWasmEffectSupported()?(B=["off","blur","replacement"],this.processorType="Wasm"):F.isWebgl2EffectSupported()&&(B=["off","blur","replacement"],this.processorType="Webgl2"),[2,this.effectProvider?this.effectProvider.getCapability():B]):(this.logger.debug("WebCVProvider is not configured"),[2,["off"]]):(this.logger.debug("Video effects disabled"),[2,["off"]])}))}))},VideoEffectManager.prototype.getWebCVEffect=function(F){return this.videoEffectToWebCVEffectMapping[F]},VideoEffectManager.prototype.getVideoEffectType=function(F){var B=this;return ne.keys(this.videoEffectToWebCVEffectMapping).find((function(G){return B.videoEffectToWebCVEffectMapping[G]===F}))},VideoEffectManager.prototype.onPreheatCompleted=function(){this.event("onVideoEffectApplied").raise(),this.logger.safe.debug("onVideoEffectApplied event raised")},VideoEffectManager.prototype.handleFailedProcessing=function(){return Y(this,void 0,void 0,(function(){var F;return $(this,(function(B){switch(B.label){case 0:this.effectType=0,B.label=1;case 1:return B.trys.push([1,3,,4]),[4,this.effectProvider.setEffectAsync("off")];case 2:return B.sent(),[3,4];case 3:return F=B.sent(),this.notifyError("WebcvProccessorError","Failed to handle error state, error:".concat(ne.stringifyObject(F))),[3,4];case 4:return[2]}}))}))},VideoEffectManager.prototype.shouldApplyEffect=function(F){return this.effectType!==F},VideoEffectManager.prototype.shouldCollectStats=function(F){return 0!==this.effectType&&0!==F&&this.effectType!==F},J([(0,te.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],VideoEffectManager.prototype,"init",null),J([(0,te.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],VideoEffectManager.prototype,"dispose",null),J([(0,te.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],VideoEffectManager.prototype,"configure",null),J([(0,te.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],VideoEffectManager.prototype,"setSourceAsync",null),J([(0,te.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[Object]),Q("design:returntype",Promise)],VideoEffectManager.prototype,"removeSourceAsync",null),J([(0,te.sequentialize)(),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],VideoEffectManager.prototype,"getEffectsCapability",null),VideoEffectManager}(Z.default);B.VideoEffectManager=oe},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.CapabilityChecker=void 0;var W=G(1),z=G(27),K=function(){function CapabilityChecker(F,B,G){this.configProvider=F,this.statistics=B,this.logger=G}return CapabilityChecker.prototype.isWasmEffectSupported=function(){return this.configProvider.config.webcv.useWasmEffects?!!window.MediaStreamTrackProcessor||(this.logger.info("wasmEffects disabled, insertable streams are not supported"),!1):(this.logger.info("wasmEffects disabled by feature flag"),!1)},CapabilityChecker.prototype.isWebgl2EffectSupported=function(){return this.isCurrentRendererSupported()&&this.isWebGL2Supported()},CapabilityChecker.prototype.isCurrentRendererSupported=function(){var F=this.configProvider.config.webcv.webGLUnsupportedRenderers,B=!1,G=z.UserAgentConfig.unmaskedGlRenderer;return G&&!F.some((function(F){return F===G}))?B=!0:(this.statistics.setError("RendererIsNotSupported","Blacklisted from ".concat(JSON.stringify(F))),this.logger.info("Unsupported renderer: ".concat((0,W.stringifyObject)(G)))),B},CapabilityChecker.prototype.isWebGL2Supported=function(){try{var F=document.createElement("canvas").getContext("webgl2");if(!F)return this.statistics.setError("WebGL2IsNotSupported"),this.logger.info("WebGL2 context is not supported"),!1;var B=F.getSupportedExtensions(),G=this.configProvider.config.webcv.webGLRequiredExtensions.filter((function(F){return!B.includes(F)}));if(G.length>0)return this.statistics.setError("WebGL2RequiredExtensionsNotSupported","Required WebGL2 extensions not supported."),this.logger.info("Unsupported WebGL2 extensions: ".concat((0,W.stringifyObject)(G))),!1}catch(F){return this.statistics.setError("WebGL2IsNotSupported","Error: ".concat((0,W.stringifyObject)(F))),this.logger.error("isWebGL2Supported: ".concat((0,W.stringifyObject)(F))),!1}return!0},CapabilityChecker}();B.CapabilityChecker=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.PermissionManager=void 0;var Q=G(6),Y=G(18),$=G(1),X=G(4),Z=G(27),ee=[X.default.MEDIA_STATE.inactive,X.default.MEDIA_STATE.receive,X.default.MEDIA_STATE.send,X.default.MEDIA_STATE.sendReceive],te=[X.default.MEDIA_STATE.inactive,X.default.MEDIA_STATE.receive],ne=function(F){function PermissionManager(B,G,W){var z=F.call(this,W)||this;return z.configProvider=B,z.deviceManager=G,z.logger=W,z.currentState={microphone:"unknown",camera:"unknown"},z.lastGum={audio:!1,video:!1},z.registeredTrackers=new Set,z.window=Y.default.window,z.permittedModalities={audio:ee,video:ee,sharing:ee},z.initialize(),z}return z(PermissionManager,F),PermissionManager.prototype.initialize=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){switch(F.label){case 0:return!Z.UserAgentConfig.hasPermissionsApi()||"unknown"!==this.currentState.microphone&&"unknown"!==this.currentState.camera?[3,3]:(this.logger.safe.info("Initializing"),[4,this.registerPermissionTracker("microphone")]);case 1:return F.sent(),[4,this.registerPermissionTracker("camera")];case 2:return F.sent(),[3,4];case 3:"unknown"!==this.currentState.microphone&&"unknown"!==this.currentState.camera||this.logger.safe.warn("Permissions API is not supported in this browser. Microphone: ".concat(this.currentState.microphone,", camera: ").concat(this.currentState.camera)),F.label=4;case 4:return[2]}}))}))},PermissionManager.prototype.getPermissionState=function(F){return this.currentState[F]||"unknown"},PermissionManager.prototype.isPermissionKnown=function(F){var B=this.getPermissionState(F);return"unknown"!==B&&"prompt"!==B},Object.defineProperty(PermissionManager.prototype,"browserPermittedModalities",{get:function(){return this.permittedModalities},enumerable:!1,configurable:!0}),Object.defineProperty(PermissionManager.prototype,"knownPermissionStates",{get:function(){return $.deepClone(this.currentState)},enumerable:!1,configurable:!0}),PermissionManager.prototype.update=function(F,B){var G=this,W=$.deepClone(B);F.audio||delete W.audio,F.video||delete W.video;var z=$.deepClone(this.permittedModalities);$.forOwn(W,(function(F,B){G.permittedModalities[B]=F?ee:te})),$.deepEqual(z,this.permittedModalities)||this.event("onDevicesPermissionChanged").raise()},PermissionManager.prototype.askDevicePermission=function(F){return K(this,void 0,void 0,(function(){var B,G,W,z,Q,Y,X,Z=this;return J(this,(function(te){switch(te.label){case 0:if(B=F?$.deepClone(F):{audio:!0,video:this.deviceManager.hasCamera()},this.configProvider.config.permissions.rememberNegative&&(B.audio=B.audio&&this.permittedModalities.audio===ee,B.video=B.video&&this.permittedModalities.video===ee),B.sharing)throw new Error("askDevicePermission does not support sharing constraints.");return G={audio:!1,video:!1},this.lastGum={audio:!1,video:!1},W=function(G,W,z){return K(Z,void 0,void 0,(function(){var K;return J(this,(function(J){switch(J.label){case 0:return K={audio:!!G.audio,video:!!G.video,sharing:!0},!(this.configProvider.config.permissions.adpRequestAVLast&&B.audio&&B.video)||this.lastGum.audio&&this.lastGum.video?[3,2]:(this.logger.safe.info("Prompting for audio and video to ensure omnibar state"),[4,this.askDevicePermissionPrompt({audio:!0,video:!0},!1)]);case 1:J.sent(),J.label=2;case 2:return this.update(B,K),this.deviceManager.raiseTelemetryEvent("ask_device_permission",{constraints:F,resultConstraints:G,error:z,reason:W}),[2,K]}}))}))},[4,this.initialize()];case 1:return te.sent(),z=this.getPermissionState("microphone"),Q=this.getPermissionState("camera"),this.logger.safe.info("Permission state { audio: ".concat(z,", video: ").concat(Q," }")),!this.configProvider.config.permissions.useNegativeInAdp||B.audio&&"denied"!==z||B.video&&"denied"!==Q?this.configProvider.config.permissions.usePositiveInAdp&&(!B.audio||B.audio&&"granted"===z)&&(!B.video||B.video&&"granted"===Q)?[2,W(B,"navigator_permissions_granted")]:[3,2]:[2,W(G,"navigator_permissions_denied")];case 2:return te.trys.push([2,4,,5]),Y=W,[4,this.askDevicePermissionPrompt(B,this.configProvider.config.permissions.adpFallback)];case 3:return[2,Y.apply(void 0,[te.sent(),"stream_acquisition"])];case 4:return X=te.sent(),[2,W(G,"stream_acquisition",X)];case 5:return[2]}}))}))},PermissionManager.prototype.askDevicePermissionPrompt=function(F,B){return void 0===B&&(B=!0),K(this,void 0,void 0,(function(){var G,W,z,K,Q,Y,X;return J(this,(function(J){switch(J.label){case 0:G={audio:!1,video:!1},J.label=1;case 1:return J.trys.push([1,4,,16]),(W=this.deviceManager.getMediaStream(F))?(this.lastGum=$.deepClone(F),[4,W.start()]):[3,3];case 2:J.sent(),G.audio=W.hasAudio(),G.video=W.hasVideo(),this.disposeLater(W),J.label=3;case 3:return[2,G];case 4:if(z=J.sent(),!(F.audio&&F.video&&B))return[3,14];J.label=5;case 5:return J.trys.push([5,8,,9]),K=G,(Q=this.configProvider.config.permissions.adpFallbackVideo)?[4,this.askDevicePermissionPrompt({video:!0})]:[3,7];case 6:Q=J.sent().video,J.label=7;case 7:return K.video=Q,[3,9];case 8:return J.sent(),[3,9];case 9:return J.trys.push([9,12,,13]),Y=G,(X=this.configProvider.config.permissions.adpFallbackAudio)?[4,this.askDevicePermissionPrompt({audio:!0})]:[3,11];case 10:X=J.sent().audio,J.label=11;case 11:return Y.audio=X,[3,13];case 12:return J.sent(),[3,13];case 13:return[3,15];case 14:if(B)throw z;J.label=15;case 15:return[2,G];case 16:return[2]}}))}))},PermissionManager.prototype.disposeLater=function(F){setTimeout((function(){F.dispose()}),this.configProvider.config.mediaStreamHoldInterval)},PermissionManager.prototype.registerPermissionTracker=function(F){return K(this,void 0,void 0,(function(){var B,G,W=this;return J(this,(function(z){switch(z.label){case 0:if(this.registeredTrackers.has(F))return[2];z.label=1;case 1:return z.trys.push([1,3,,4]),[4,this.window.navigator.permissions.query({name:F})];case 2:return B=z.sent(),this.handlePermissionStateChanged(F,B.state),B.onchange=function(){return W.handlePermissionStateChanged(F,B.state)},this.registeredTrackers.add(F),[3,4];case 3:return G=z.sent(),this.logger.safe.error("Error querying permissions for ".concat(F,": ").concat($.stringifyObject(G))),[3,4];case 4:return[2]}}))}))},PermissionManager.prototype.handlePermissionStateChanged=function(F,B){this.logger.safe.info("Permission state for ".concat(F," changed ").concat(this.currentState[F]," -> ").concat(B)),this.currentState[F]=B,this.deviceManager.raiseTelemetryEvent("permissions_state_changed",this.knownPermissionStates),this.deviceManager.handlePermissionStateChange()},PermissionManager}(Q.default);B.PermissionManager=ne},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.DeviceManagerDiagnostics=void 0;var W=G(1),z=function(){function DeviceManagerDiagnostics(F){this.configProvider=F,this.data={deviceList:[],deviceSelectionChangeCount:0,deviceSelectionChangeCountFromInterface:0,permissionStates:{microphone:"unknown",camera:"unknown"},devicesCount:{microphone:0,camera:0,speaker:0,compositeAudio:0},devicesChangeCount:0,devicesPollChangeCount:0,deviceTelemetryEvents:[],videoEffectsEvents:[],audioEffectsEvents:[]}}return Object.defineProperty(DeviceManagerDiagnostics.prototype,"permissionStates",{set:function(F){this.data.permissionStates=F},enumerable:!1,configurable:!0}),DeviceManagerDiagnostics.prototype.setSelectedDevices=function(F,B){var G,z,K,J={microphone:W.scrubDeviceLabelPii(null===(G=F.microphone)||void 0===G?void 0:G.label,this.configProvider.config.devices.piiSafeWords),camera:W.scrubDeviceLabelPii(null===(z=F.camera)||void 0===z?void 0:z.label,this.configProvider.config.devices.piiSafeWords),speaker:W.scrubDeviceLabelPii(null===(K=F.speaker)||void 0===K?void 0:K.label,this.configProvider.config.devices.piiSafeWords)};this.data.usedDevices&&(this.data.deviceSelectionChangeCount++,B&&this.data.deviceSelectionChangeCountFromInterface++),this.data.usedDevices=J},DeviceManagerDiagnostics.prototype.setDeviceList=function(F,B,G){var z=this;this.data.deviceList=F.map((function(F){return{label:W.scrubDeviceLabelPii(F.label,z.configProvider.config.devices.piiSafeWords),kind:F.type}})),G&&(this.data.deviceDebugStrings=W.deepClone(G)),this.data.devicesCount.microphone=F.filter((function(F){return"microphone"===F.type})).length,this.data.devicesCount.camera=F.filter((function(F){return"camera"===F.type})).length,this.data.devicesCount.speaker=F.filter((function(F){return"speaker"===F.type})).length,this.data.devicesCount.compositeAudio=F.filter((function(F){return"compositeAudio"===F.type})).length,this.data.devicesChangeCount++,B&&this.data.devicesPollChangeCount++},DeviceManagerDiagnostics.prototype.registerDeviceTelemetryEvent=function(F){if("stream_acquired"===F.eventType){var B=F.payload;"Video"===B.mediaType&&(this.data.latestCameraOpenResolution=B.resolution)}W.arrayPushFixedSize(this.data.deviceTelemetryEvents,F,this.configProvider.config.diagnostics.collectionLimits.numDeviceEvents)},DeviceManagerDiagnostics.prototype.registerVideoEffectsEvent=function(F){W.arrayPushFixedSize(this.data.videoEffectsEvents,F,this.configProvider.config.diagnostics.collectionLimits.numVideoEffectsEvents)},DeviceManagerDiagnostics.prototype.registerAudioEffectsEvent=function(F){W.arrayPushFixedSize(this.data.audioEffectsEvents,F,this.configProvider.config.diagnostics.collectionLimits.numAudioEffectsEvents)},DeviceManagerDiagnostics.prototype.getObjectRef=function(){return this.data},DeviceManagerDiagnostics}();B.DeviceManagerDiagnostics=z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.MediaAgentDiagnostics=void 0;var W=G(456),z=G(1),K=G(460),J=G(27),Q=G(23),Y=function(){function MediaAgentDiagnostics(F,B){var G=this;this.configProvider=F,this.deviceManagerDiagnostics=B,this.root={creationTime:Date.now(),numTotalSessions:0,deviceManager:this.deviceManagerDiagnostics.getObjectRef(),configuration:{stackConfig:this.configProvider.stackConfig,defaultConfig:this.configProvider.defaultConfig,mediaConfig:{},userAgentConfig:{isAudioOutputSelectionSupported:this.configProvider.userAgentConfig.isAudioOutputSelectionSupported,isBrowserRollbackSupported:this.configProvider.userAgentConfig.isBrowserRollbackSupported,hardwareConcurrency:this.configProvider.userAgentConfig.hardwareConcurrency,unmaskedGlRenderer:this.configProvider.userAgentConfig.unmaskedGlRenderer,hasMediaApi:J.UserAgentConfig.hasMediaApi(),hasCapabilitiesApi:J.UserAgentConfig.hasCapabilitiesApi(),hasUnifiedPlanSupport:void 0},consoleOverrides:this.configProvider.consoleOverrides,fullConfig:z.deepClone(this.configProvider.config),ecsConfigUpdates:[]},browserInfo:(0,Q.getBrowserInfo)(),sessions:[]},this.diagnosticsReport=new K.DiagnosticsReport(this.root,this.configProvider),this.configProvider.on("newConfigReceived",(function(F,B,W){G.root.configuration.ecsConfigUpdates.push({timestamp:Date.now(),etag:B,configIds:W,config:F})})),this.configProvider.on("configUpdated",(function(){G.root.configuration.consoleOverrides=G.configProvider.consoleOverrides,G.root.configuration.fullConfig=z.deepClone(G.configProvider.config)}))}return Object.defineProperty(MediaAgentDiagnostics.prototype,"reportGenerator",{get:function(){return this.diagnosticsReport},enumerable:!1,configurable:!0}),Object.defineProperty(MediaAgentDiagnostics.prototype,"rootRef",{get:function(){return this.root},enumerable:!1,configurable:!0}),Object.defineProperty(MediaAgentDiagnostics.prototype,"mediaConfig",{set:function(F){this.root.configuration.mediaConfig=F},enumerable:!1,configurable:!0}),MediaAgentDiagnostics.prototype.newSession=function(F,B,G){this.root.configuration.userAgentConfig.hasUnifiedPlanSupport=this.configProvider.mediaConfig.simulcastSessionEnabled;var K=new W.SessionDiagnostics(G,F,this.diagnosticsReport,this.root.deviceManager,++this.root.numTotalSessions,B);return z.arrayPushFixedSize(this.root.sessions,K.getObjectRef(),this.configProvider.config.diagnostics.collectionLimits.numSessions),K},MediaAgentDiagnostics}();B.MediaAgentDiagnostics=Y},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.SessionDiagnostics=void 0;var z=G(1),K=G(10),J=G(457),Q=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:[0-9]{2,5})?$/),Y=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/),$=RegExp(/^\[(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\](:[0-9]{2,5})$/),X=function(){function SessionDiagnostics(F,B,G,W,K,J){var Q=this;this.logger=F,this.configProvider=B,this.diagnosticsReport=G,this.dmDiagnostics=W,this.data={creationTime:Date.now(),callNumber:0,sessionId:"unknown",isMultiParty:!1,dtmfSuccessCount:0,dtmfFailureCount:0,iceInitTime:0,iceConnectedStateTime:0,negotiationCount:0,rejectedNegotiationCount:0,initialNegotiationCompleted:!1,finalAnswerTime:0,transportReconnectedCount:0,rollbackNegotiation:[],allowedAudioSend:!0,allowedVideoSend:!0,allowedScreensharingSend:!0,noIceCandidatesEventCount:{good:0,bad:0},noRelayIceCandidatesEventCount:{good:0,bad:0},microphoneInUseEventCount:{good:0,bad:0},cameraInUseEventCount:{good:0,bad:0},cameraFreezeEventCount:{start:0,end:0},rawMedia:{audio:{recv:{numAttempts:0,durationRatio:0},send:{numAttempts:0,durationRatio:0}}},ufds:[],statsErrors:[],nativeSessions:[],isOngoing:!1,duration:0,callMutedRatio:0,callOsMuted:0,callHwSilent:0,callSwMuted:0,callSpeakerMuted:0,callIsSpeaking:0,networkRecvUFD:void 0,networkSendUFD:void 0,deviceManager:void 0,relayTimers:void 0},this.transportDisconnected=!1,this.commonMuteTracker=new ee,this.swMuteTracker=new ee,this.osMuteTracker=new ee,this.speakerMuteTracker=new ee,this.hwSilentTracker=new ee,this.isSpeakingTracker=new ee,this.networkRecv=new te,this.networkSend=new te,this.rawMediaTimers={audio:{send:new ee,recv:new ee}},this.dmFragmenter=new Z(this.dmDiagnostics),this.data.callNumber=K,this.data.sessionId=J,z.addGetterFields(this.data,{isOngoing:function(){return void 0===Q.data.terminationTime},duration:function(){return Q.data.isOngoing?Date.now()-Q.data.creationTime:Q.data.terminationTime-Q.data.creationTime},callMutedRatio:function(){return getDurationRatio(Q.commonMuteTracker.elapsed,Q.data.duration)},callOsMuted:function(){return Q.osMuteTracker.elapsed},callHwSilent:function(){return Q.hwSilentTracker.elapsed},callSwMuted:function(){return Q.swMuteTracker.elapsed},callSpeakerMuted:function(){return Q.speakerMuteTracker.elapsed},callIsSpeaking:function(){return Q.isSpeakingTracker.elapsed},networkRecvUFD:function(){return{good:Q.networkRecv.getCount("Good"),poor:Q.networkRecv.getCount("Poor"),bad:Q.networkRecv.getCount("Bad"),goodRatio:getDurationRatio(Q.networkRecv.getElapsed("Good"),Q.data.duration),poorRatio:getDurationRatio(Q.networkRecv.getElapsed("Poor"),Q.data.duration),badRatio:getDurationRatio(Q.networkRecv.getElapsed("Bad"),Q.data.duration)}},networkSendUFD:function(){return{good:Q.networkSend.getCount("Good"),poor:Q.networkSend.getCount("Poor"),bad:Q.networkSend.getCount("Bad"),goodRatio:getDurationRatio(Q.networkSend.getElapsed("Good"),Q.data.duration),poorRatio:getDurationRatio(Q.networkSend.getElapsed("Poor"),Q.data.duration),badRatio:getDurationRatio(Q.networkSend.getElapsed("Bad"),Q.data.duration)}},deviceManager:function(){return Q.dmFragmenter.getFragment(Q.dmDiagnostics)},relayTimers:function(){var F;return null===(F=Q.relayManagerTimers)||void 0===F?void 0:F.getStats()}}),z.addGetterFields(this.data.rawMedia.audio.recv,{durationRatio:function(){return getDurationRatio(Q.rawMediaTimers.audio.recv.elapsed,Q.data.duration)}}),z.addGetterFields(this.data.rawMedia.audio.send,{durationRatio:function(){return getDurationRatio(Q.rawMediaTimers.audio.send.elapsed,Q.data.duration)}})}return Object.defineProperty(SessionDiagnostics.prototype,"telemetryReport",{get:function(){var F=this,B=this.diagnosticsReport.getSessionTelemetry(this.data.sessionId);return z.forOwnRec(B,(function(B,G,W){W[G]=F.addPiiToStatsValue(B)})),{type:"WebRtcMediaStats",data:B}},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"mediaStatsReport",{get:function(){return this.diagnosticsReport.getMediaSessionStats(this.data.sessionId)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"realtimeTelemetryReport",{get:function(){return this.diagnosticsReport.getRealtimeTelemetry(this.data.sessionId)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"relayManager",{set:function(F){this.relayManagerTimers=F},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"isMultiParty",{set:function(F){this.data.isMultiParty=F},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"mediaLegId",{set:function(F){this.data.mediaLegId=F.process()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"ETag",{set:function(F){this.data.ETag=F},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"configIds",{set:function(F){this.data.configIds=F},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"reconnect",{set:function(F){this.data.reconnect=F},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"relay",{set:function(F){this.data.relay={address:F.addresses.join(),expires:F.expires,realm:F.realm,credentials:!(!F.username||!F.password),ports:[F.udpPort?"udp:".concat(F.udpPort):"",F.tcpPort?"tcp:".concat(F.tcpPort):"",F.tlsPort?"tls:".concat(F.tlsPort):""].join(","),fqdns:F.fqdns?F.fqdns.join():"none"}},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"sessionError",{set:function(F){this.data.error=F},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"dtmfResult",{set:function(F){F?this.data.dtmfSuccessCount++:this.data.dtmfFailureCount++},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"swMute",{set:function(F){F?this.swMuteTracker.start():this.swMuteTracker.stop(),this.updateCommonMute()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"speakerMute",{set:function(F){F?this.speakerMuteTracker.start():this.speakerMuteTracker.stop()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"hwSilent",{set:function(F){F?this.hwSilentTracker.start():this.hwSilentTracker.stop()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"isSpeaking",{set:function(F){F?this.isSpeakingTracker.start():this.isSpeakingTracker.stop()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"iceInitTime",{set:function(F){this.data.iceInitTime||(this.data.iceInitTime=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"finalAnswerTime",{set:function(F){var B,G;null!==(B=(G=this.data).finalAnswerTime)&&void 0!==B||(G.finalAnswerTime=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"iceConnectedStateTimestamp",{set:function(F){this.data.iceConnectedStateTime||(this.data.iceConnectedStateTime=F)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,"allowedModalities",{set:function(F){this.data.allowedAudioSend=F.audio.some((function(F){return K.hasSendDirectionality(F)})),this.data.allowedVideoSend=F.video.some((function(F){return K.hasSendDirectionality(F)})),this.data.allowedScreensharingSend=F.sharing.some((function(F){return K.hasSendDirectionality(F)}))},enumerable:!1,configurable:!0}),SessionDiagnostics.prototype.negotiationStart=function(F){var B,G;null!==(B=(G=this.data).initialNegotiationType)&&void 0!==B||(G.initialNegotiationType=F),this.data.negotiationCount++},SessionDiagnostics.prototype.negotiationCompleted=function(){this.data.initialNegotiationCompleted=!0,this.data.error=void 0},SessionDiagnostics.prototype.negotiationRejected=function(){this.data.rejectedNegotiationCount++},SessionDiagnostics.prototype.registerRollbackEvent=function(F){this.data.rollbackNegotiation.push({type:F.type,attempt:this.data.rollbackNegotiation.length+1,error:F.error})},SessionDiagnostics.prototype.registerRawMediaAccess=function(F,B,G){var W,z,K=null===(W=this.data.rawMedia[F])||void 0===W?void 0:W[B];if(K){K.numAttempts++;var J=null===(z=this.rawMediaTimers[F])||void 0===z?void 0:z[B];G?null==J||J.start():null==J||J.stop()}},SessionDiagnostics.prototype.registerQualityStateChangedEvent=function(F){switch(F.type){case"NoNetwork":"Good"===F.value?this.data.noIceCandidatesEventCount.good++:this.data.noIceCandidatesEventCount.bad++;break;case"NetworkRelaysNotReachable":"Good"===F.value?this.data.noRelayIceCandidatesEventCount.good++:this.data.noRelayIceCandidatesEventCount.bad++;break;case"DeviceCaptureNotFunctioning":"Good"===F.value?this.data.microphoneInUseEventCount.good++:this.data.microphoneInUseEventCount.bad++;break;case"VideoCapturerDeviceStartFailed":"Good"===F.value?this.data.cameraInUseEventCount.good++:this.data.cameraInUseEventCount.bad++;break;case"DeviceCaptureMute":"Bad"===F.value?this.osMuteTracker.start():this.osMuteTracker.stop(),this.updateCommonMute();break;case"NetworkRecvQuality":this.networkRecv.updateLevel(F.value);break;case"NetworkSendQuality":this.networkSend.updateLevel(F.value);break;case"VideoCaptureDeviceFreeze":"Good"===F.value?this.data.cameraFreezeEventCount.end++:this.data.cameraFreezeEventCount.start++}"DeviceSpeakWhileMuted"!==F.type&&z.arrayPushFixedSize(this.data.ufds,W(W({},F),{timestamp:Date.now()}),this.configProvider.config.diagnostics.collectionLimits.numUFDs)},SessionDiagnostics.prototype.registerTransportConnected=function(){this.transportDisconnected&&(this.transportDisconnected=!1,this.data.transportReconnectedCount++)},SessionDiagnostics.prototype.registerTransportDisconnected=function(){this.transportDisconnected=!0},SessionDiagnostics.prototype.registerTransportFailed=function(){this.transportDisconnected=!1},SessionDiagnostics.prototype.terminated=function(F){this.data.terminationReason=z.deepClone(F),this.data.terminationTime=Date.now(),this.swMuteTracker.stop(),this.speakerMuteTracker.stop(),this.hwSilentTracker.stop(),this.isSpeakingTracker.stop(),this.dmFragmenter.terminated(this.dmDiagnostics)},SessionDiagnostics.prototype.addStatsError=function(F,B){var G,W=this.data.statsErrors.find((function(G){return G.error===B&&G.origin===F}));this.logger.safe.error("Stats error from '".concat(F,"': ").concat(B," (").concat(null!==(G=null==W?void 0:W.count)&&void 0!==G?G:1,")")),W?W.count++:z.arrayPushFixedSize(this.data.statsErrors,{origin:F,error:B,count:1},this.configProvider.config.diagnostics.collectionLimits.numStatsErrors)},SessionDiagnostics.prototype.newNativeSessionDiag=function(F){var B,G=this;return void 0===F&&(F=!0),B=new J.NativeSessionDiagnostics(this.configProvider,this.dmDiagnostics,(function(F,B){return G.addStatsError(F,B)}),(function(F){return G.newNativeSessionDiag(F)}),(function(){return G.pushNativeSessionDiag(B.getObjectRef())})),F&&z.arrayPushFixedSize(this.data.nativeSessions,B.getObjectRef(),this.configProvider.config.diagnostics.collectionLimits.numNativeSessions),B},SessionDiagnostics.prototype.pushNativeSessionDiag=function(F){z.arrayPushFixedSize(this.data.nativeSessions,F,this.configProvider.config.diagnostics.collectionLimits.numNativeSessions)},SessionDiagnostics.prototype.getObjectRef=function(){return this.data},SessionDiagnostics.prototype.addPiiToStatsValue=function(F){var B=0;return Q.test(F)?B=13:(Y.test(F)||$.test(F))&&(B=4),{type:B,value:F,__VALUE__:!0}},SessionDiagnostics.prototype.updateCommonMute=function(){this.swMuteTracker.isRunning||this.osMuteTracker.isRunning?this.commonMuteTracker.start():this.swMuteTracker.isRunning||this.osMuteTracker.isRunning||this.commonMuteTracker.stop()},SessionDiagnostics}();B.SessionDiagnostics=X;var Z=function(){function DeviceManagerFragmenter(F){this.fragmentBase=this.sanitizeDiagnostics(F)}return DeviceManagerFragmenter.prototype.getFragment=function(F){var B,G=null!==(B=this.fragmentTerminated)&&void 0!==B?B:F;return{devicesChangeCount:G.devicesChangeCount-this.fragmentBase.devicesChangeCount,deviceSelectionChangeCount:G.deviceSelectionChangeCount-this.fragmentBase.deviceSelectionChangeCount,deviceSelectionChangeCountFromInterface:G.deviceSelectionChangeCountFromInterface-this.fragmentBase.deviceSelectionChangeCountFromInterface,devicesPollChangeCount:G.devicesPollChangeCount-this.fragmentBase.devicesPollChangeCount}},DeviceManagerFragmenter.prototype.terminated=function(F){this.fragmentTerminated=this.sanitizeDiagnostics(F)},DeviceManagerFragmenter.prototype.sanitizeDiagnostics=function(F){return{devicesChangeCount:F.devicesChangeCount,deviceSelectionChangeCount:F.deviceSelectionChangeCount,deviceSelectionChangeCountFromInterface:F.deviceSelectionChangeCountFromInterface,devicesPollChangeCount:F.devicesPollChangeCount}},DeviceManagerFragmenter}(),ee=function(){function StopWatch(){this.startTime=0,this.elapsedInternal=0,this.countInternal=0}return Object.defineProperty(StopWatch.prototype,"isRunning",{get:function(){return!!this.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(StopWatch.prototype,"elapsed",{get:function(){return this.startTime?this.elapsedInternal+Date.now()-this.startTime:this.elapsedInternal},enumerable:!1,configurable:!0}),Object.defineProperty(StopWatch.prototype,"count",{get:function(){return this.countInternal},enumerable:!1,configurable:!0}),StopWatch.prototype.start=function(){this.startTime||(this.startTime=Date.now(),this.countInternal++)},StopWatch.prototype.stop=function(){this.startTime&&(this.elapsedInternal+=Date.now()-this.startTime,this.startTime=0)},StopWatch}(),te=function(){function QualityEventTracker(){this.currentLevel="Good",this.stopWatches={},this.getStopWatch(this.currentLevel).start()}return QualityEventTracker.prototype.updateLevel=function(F){this.currentLevel!==F&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=F,this.getStopWatch(this.currentLevel).start())},QualityEventTracker.prototype.getCount=function(F){var B=this.stopWatches[F];return B?B.count:0},QualityEventTracker.prototype.getElapsed=function(F){var B=this.stopWatches[F];return B?B.elapsed:0},QualityEventTracker.prototype.getStopWatch=function(F){var B=this.stopWatches[F];return B||(B=new ee,this.stopWatches[F]=B),B},QualityEventTracker}();function getDurationRatio(F,B){return F/(0!==B?B:1)}},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},K=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.NativeSessionDiagnostics=void 0;var J=G(138),Q=G(458),Y=G(459),$=G(1),X=G(142),Z=/profile-level-id=(.{6})/,ee=function(){function NativeSessionDiagnostics(F,B,G,W,z){var K=this;this.configProvider=F,this.dmDiagnostics=B,this.addSessionStatsError=G,this.newNativeSession=W,this.commitNativeSession=z,this.data={startTime:Date.now(),duration:0,offeredSrtp:"unknown",negotiatedSrtp:"unknown",iceConnectionState:"none",iceConnectionStatePrevious:"none",signalingState:"none",signalingStatePrevious:"none",relayCandidate:"none",iceTransportPolicy:"none",iceServers:"none",fakeIceCandidate:!1,bweType:"Unknown",sdpSemantics:"none",bundlePolicy:"none",iceCandidateErrors:[],H264Profiles:[],numInterfaces:0,statsReports:[],aggregatedModalityStats:{},multiViewStats:[],networkInfo:[],statsErrors:[],recvVideoStreamCount:{min:0,max:0,mode:0},reportedReceiveBandwidth:[],optimalVideoCount:[]},$.addGetterFields(this.data,{duration:function(){return K.data.endTime?K.data.endTime-K.data.startTime:Date.now()-K.data.startTime}})}return Object.defineProperty(NativeSessionDiagnostics.prototype,"deviceManager",{get:function(){return this.dmDiagnostics},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"audioLevel",{get:function(){var F;return null===(F=this.analyzer)||void 0===F?void 0:F.getInputLevel()},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"sharingAudioLevel",{get:function(){var F;return null===(F=this.analyzerSharing)||void 0===F?void 0:F.getInputLevel()},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"offeredModalities",{set:function(F){this.data.offeredModalities=F,this.data.activeModalities=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"negotiatedModalities",{set:function(F){this.data.negotiatedModalities=F,this.data.activeModalities=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"offeredSrtp",{set:function(F){this.data.offeredSrtp=getSrtpReport(F)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"negotiatedSrtp",{set:function(F){this.data.negotiatedSrtp=getSrtpReport(F)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"iceConnectionState",{set:function(F){this.data.iceConnectionStatePrevious=this.data.iceConnectionState,this.data.iceConnectionState=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"signalingConnectionState",{set:function(F){this.data.signalingStatePrevious=this.data.signalingState,this.data.signalingState=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"relayCandidateInfo",{set:function(F){this.data.relayCandidate=JSON.stringify(F)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"iceTransportPolicy",{set:function(F){this.data.iceTransportPolicy=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"iceServers",{set:function(F){var B=F.map((function(F){var B=W({},F);return B.username&&(B.username="true"),B.credential&&(B.credential="true"),B}));this.data.iceServers=JSON.stringify(B)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"fakeIceCandidate",{set:function(F){this.data.fakeIceCandidate=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"bweType",{set:function(F){this.data.bweType=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"sdpSemantics",{set:function(F){this.data.sdpSemantics=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"bundlePolicy",{set:function(F){this.data.bundlePolicy=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"latestRawReport",{set:function(F){this.data.latestRawReport=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"recvVideoStreamsCount",{set:function(F){this.data.recvVideoStreamCount=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"aggregatedStatsRef",{set:function(F){this.data.aggregatedModalityStats=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"multiViewStatsRef",{set:function(F){this.data.multiViewStats=F},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"videoCapabilities",{set:function(F){if(null==F?void 0:F.codecs){var B=[];F.codecs.forEach((function(F){var G;if("h264"===F.mimeType&&F.sdpFmtpLine){var W=null===(G=Z.exec(F.sdpFmtpLine))||void 0===G?void 0:G[1];W&&B.push(W)}})),this.data.H264Profiles=K([],z(new Set(this.data.H264Profiles.concat(B))),!1)}},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"reportedSendBandwidth",{set:function(F){this.data.reportedSendBandwidth=F,(!this.data.reportedSendBandwidthMin||this.data.reportedSendBandwidthMin>F)&&(this.data.reportedSendBandwidthMin=F),(!this.data.reportedSendBandwidthMax||this.data.reportedSendBandwidthMax<F)&&(this.data.reportedSendBandwidthMax=F)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,"maxSessionBandwidth",{set:function(F){this.data.maxSessionBandwidth=F},enumerable:!1,configurable:!0}),NativeSessionDiagnostics.prototype.setCandidateDetails=function(F){"host"===F.type&&"udp"===F.protocol?(this.data.numInterfaces++,this.data.IPAddress||(this.data.IPAddress=F.ip)):"srflx"!==F.type||this.data.reflexiveLocalIP||(this.data.reflexiveLocalIP=F.ip)},NativeSessionDiagnostics.prototype.setAudioSendStream=function(F,B){var G,W;if(this.configProvider.config.useAudioAnalyzer){var z=new X.AudioStreamAnalyzer(F.rawStream);"ScreenShare"===B&&F.hasAudio()?(null===(G=this.analyzerSharing)||void 0===G||G.dispose(),this.analyzerSharing=z):"Audio"===B&&(null===(W=this.analyzer)||void 0===W||W.dispose(),this.analyzer=z)}},NativeSessionDiagnostics.prototype.addNetworkInfo=function(F){$.arrayPushFixedSize(this.data.networkInfo,F,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples)},NativeSessionDiagnostics.prototype.addIceCandidateError=function(F){this.data.iceCandidateErrors.push(F)},NativeSessionDiagnostics.prototype.clearIceCandidateErrors=function(){this.data.iceCandidateErrors=[]},NativeSessionDiagnostics.prototype.addReportedReceiveBandwidth=function(F){$.arrayPushFixedSize(this.data.reportedReceiveBandwidth,F,this.configProvider.config.diagnostics.collectionLimits.numAggregatedSamples)},NativeSessionDiagnostics.prototype.addOptimalVideoCountReport=function(F){$.arrayPushFixedSize(this.data.optimalVideoCount,{count:F,ts:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numAggregatedSamples)},NativeSessionDiagnostics.prototype.addStatsReport=function(F){$.arrayPushFixedSize(this.data.statsReports,F,this.configProvider.config.diagnostics.collectionLimits.numStatsReports)},NativeSessionDiagnostics.prototype.addStatsError=function(F,B){var G=this.data.statsErrors.find((function(G){return G.error===B&&G.origin===F}));G?G.count++:$.arrayPushFixedSize(this.data.statsErrors,{origin:F,error:B,count:1},this.configProvider.config.diagnostics.collectionLimits.numStatsErrors),this.addSessionStatsError("nativeSession:".concat(F),B)},NativeSessionDiagnostics.prototype.terminate=function(){this.data.endTime=Date.now()},NativeSessionDiagnostics.prototype.newQualityManagerDiagnostics=function(){var F=this,B=new Q.QualityManagerDiagnostics(this.configProvider,(function(B,G){return F.addStatsError("qualityManagerDiagnostics:".concat(B),G)}));return this.data.qualityManager=B.getObjectRef(),B},NativeSessionDiagnostics.prototype.newRemoteVideoManagerDiagnostics=function(){var F=new Y.RemoteVideoManagerDiagnostics(this.configProvider);return this.data.remoteVideoManager=F.getObjectRef(),F},NativeSessionDiagnostics.prototype.newSubscriptionManagerDiagnostics=function(){var F=this,B=new J.SubscriptionManagerDiagnostics(this.configProvider,(function(B){return F.addStatsError("subscriptionManagerDiagnostics",B)}));return this.data.subscriptionManager=B.getObjectRef(),B},NativeSessionDiagnostics.prototype.getObjectRef=function(){return this.data},NativeSessionDiagnostics}();function getSrtpReport(F){var B="";return F.dtls&&(B+="dtls"),F.sdes&&(B+="sdes"),B}B.NativeSessionDiagnostics=ee},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.QualityManagerDiagnostics=void 0;var z=G(4),K=G(1),J=function(){function QualityManagerDiagnostics(F,B){this.configProvider=F,this.addStatsError=B,this.data={videoMaxCapabilitiesEvents:[],sharingMaxCapabilitiesEvents:[],currentVideoSsrcRequestedCapabilities:{},currentVideoSsrcAppliedCapabilities:{},currentSharingSsrcRequestedCapabilities:{},currentSharingSsrcAppliedCapabilities:{},numVideoControlMessages:0,numOutOfOrderVideoControlMessages:0}}return QualityManagerDiagnostics.prototype.onMaxCapabilitiesRequested=function(F){var B,G,J,Q,Y,$,X,Z={causeId:F.causeId,events:[{eventType:"req",timestamp:Date.now(),capabilities:F.capabilities,isSimulcast:F.isSimulcastEnabled}]};try{if(F.modality===z.default.MODALITY.video){K.arrayPushFixedSize(this.data.videoMaxCapabilitiesEvents,Z,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesRequested);try{for(var ee=W(F.capabilities),te=ee.next();!te.done;te=ee.next()){var ne=te.value;this.data.currentVideoSsrcRequestedCapabilities["".concat(null!==(Y=ne.ssrc)&&void 0!==Y?Y:0)]=ne}}catch(F){B={error:F}}finally{try{te&&!te.done&&(G=ee.return)&&G.call(ee)}finally{if(B)throw B.error}}}else if(F.modality===z.default.MODALITY.sharing){K.arrayPushFixedSize(this.data.sharingMaxCapabilitiesEvents,Z,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesRequested);try{for(var ie=W(F.capabilities),re=ie.next();!re.done;re=ie.next()){ne=re.value;this.data.currentSharingSsrcRequestedCapabilities["".concat(null!==($=ne.ssrc)&&void 0!==$?$:0)]=ne}}catch(F){J={error:F}}finally{try{re&&!re.done&&(Q=ie.return)&&Q.call(ie)}finally{if(J)throw J.error}}}}catch(F){null===(X=this.addStatsError)||void 0===X||X.call(this,"onMaxCapabilitiesRequested",K.stringifyObject(F))}},QualityManagerDiagnostics.prototype.onMaxCapabilitiesApplied=function(F){var B,G,J,Q,Y,$,X;try{var Z=this.getEventForCause(F.modality,F.causeId);if(Z&&K.arrayPushFixedSize(Z.events,{eventType:"app",timestamp:Date.now(),capabilities:F.capabilities,error:F.error||"none"},this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesApplied,1),F.modality===z.default.MODALITY.video)try{for(var ee=W(F.capabilities),te=ee.next();!te.done;te=ee.next()){var ne=te.value;this.data.currentVideoSsrcAppliedCapabilities["".concat(null!==(Y=ne.ssrc)&&void 0!==Y?Y:0)]=ne}}catch(F){B={error:F}}finally{try{te&&!te.done&&(G=ee.return)&&G.call(ee)}finally{if(B)throw B.error}}else if(F.modality===z.default.MODALITY.sharing)try{for(var ie=W(F.capabilities),re=ie.next();!re.done;re=ie.next()){ne=re.value;this.data.currentSharingSsrcAppliedCapabilities["".concat(null!==($=ne.ssrc)&&void 0!==$?$:0)]=ne}}catch(F){J={error:F}}finally{try{re&&!re.done&&(Q=ie.return)&&Q.call(ie)}finally{if(J)throw J.error}}}catch(F){null===(X=this.addStatsError)||void 0===X||X.call(this,"onMaxCapabilitiesApplied",K.stringifyObject(F))}},QualityManagerDiagnostics.prototype.addVideoControlMessage=function(F){void 0===F&&(F=!1),this.data.numVideoControlMessages++,F&&this.data.numOutOfOrderVideoControlMessages++},QualityManagerDiagnostics.prototype.getObjectRef=function(){return this.data},QualityManagerDiagnostics.prototype.getEventForCause=function(F,B){return(F===z.default.MODALITY.video?this.data.videoMaxCapabilitiesEvents:this.data.sharingMaxCapabilitiesEvents).find((function(F){return F.causeId===B}))},QualityManagerDiagnostics}();B.QualityManagerDiagnostics=J},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.RemoteVideoRendererDiagnostics=B.RemoteVideoManagerDiagnostics=void 0;var K=G(6),J=G(34),Q=G(1),Y=function(){function RemoteVideoManagerDiagnostics(F){this.configProvider=F,this.data={renderers:[],firstTimeToFirstFrameVideo:-1,firstTimeToFirstFrameSharing:-1,isRenderingEvents:{video:[],sharing:[]},preferredResolution:{video:void 0,sharing:void 0}}}return RemoteVideoManagerDiagnostics.prototype.setTimeToFirstFrame=function(F,B){-1!==F&&(B===J.Constants.MODALITY.video&&-1===this.data.firstTimeToFirstFrameVideo?this.data.firstTimeToFirstFrameVideo=F:B===J.Constants.MODALITY.sharing&&-1===this.data.firstTimeToFirstFrameSharing&&(this.data.firstTimeToFirstFrameSharing=F))},RemoteVideoManagerDiagnostics.prototype.setIsRendering=function(F,B){this.data.isRenderingEvents[B]&&(0,Q.arrayPushFixedSize)(this.data.isRenderingEvents[B],{isRendering:F,ts:Date.now()},this.configProvider.config.diagnostics.collectionLimits.numIsRenderingEvents)},RemoteVideoManagerDiagnostics.prototype.setPreferredResolution=function(F,B){(F.width||F.height)&&(this.data.preferredResolution[B]=F)},RemoteVideoManagerDiagnostics.prototype.newRendererDiagnostics=function(){var F=this,B=new $(this),G=B.on("onDisposed",(function(){F.removeDeadRenderers(),G.dispose()}));return this.data.renderers.push(B.getObjectRef()),B},RemoteVideoManagerDiagnostics.prototype.getObjectRef=function(){return this.data},RemoteVideoManagerDiagnostics.prototype.removeDeadRenderers=function(){this.data.renderers=this.data.renderers.filter((function(F){return F.alive}))},RemoteVideoManagerDiagnostics}();B.RemoteVideoManagerDiagnostics=Y;var $=function(F){function RemoteVideoRendererDiagnostics(B){var G=F.call(this)||this;return G.managerDiagnostics=B,G.isAlive=!0,G.data={alive:!0,totalFreezeDuration:0,isRendering:!1,timeToFirstFrame:-1},delete G.data.alive,Object.defineProperty(G.data,"alive",{get:function(){return G.isAlive},enumerable:!1,configurable:!1}),G}return z(RemoteVideoRendererDiagnostics,F),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,"trackId",{set:function(F){this.data.trackId=F},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,"rendererSize",{set:function(F){this.data.rendererSize=F,F.toString=function(){return"".concat(F.width,"x").concat(F.height)},this.managerDiagnostics.setPreferredResolution(F,this.data.modality)},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,"msi",{set:function(F){this.data.msi=F},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,"modality",{set:function(F){this.data.modality=F},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,"isRendering",{set:function(F){this.data.isRendering=F,this.managerDiagnostics.setIsRendering(F,this.data.modality)},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,"timeToFirstFrame",{set:function(F){this.data.timeToFirstFrame=F,this.managerDiagnostics.setTimeToFirstFrame(F,this.data.modality)},enumerable:!1,configurable:!0}),RemoteVideoRendererDiagnostics.prototype.addFreezeDuration=function(F){this.data.totalFreezeDuration+=F},RemoteVideoRendererDiagnostics.prototype.dispose=function(){this.isAlive=!1,this.event("onDisposed").raise()},RemoteVideoRendererDiagnostics.prototype.getObjectRef=function(){return this.data},RemoteVideoRendererDiagnostics}(K.default);B.RemoteVideoRendererDiagnostics=$},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.DiagnosticsReport=void 0;var W=G(1),z=G(461),K=G(462),J=G(465),Q=G(466),Y=function(){function DiagnosticsReport(F,B){this.rootRef=F,this.configProvider=B}return Object.defineProperty(DiagnosticsReport.prototype,"rootCopy",{get:function(){return W.deepClone(this.rootRef)},enumerable:!1,configurable:!0}),Object.defineProperty(DiagnosticsReport.prototype,"rawRootRef",{get:function(){return this.rootRef},enumerable:!1,configurable:!0}),DiagnosticsReport.prototype.getSessionTelemetry=function(F){var B,G=this.rootRef.sessions.find((function(B){return B.sessionId===F}));if(G){var J=W.hptime(),Q=G.callNumber>1?this.rootRef.sessions.find((function(F){return G.callNumber-1===F.callNumber})):void 0,Y=null!==(B=null==Q?void 0:Q.terminationTime)&&void 0!==B?B:0,$=G.nativeSessions[G.nativeSessions.length-1],X={metrics:(0,z.compileMetricsTelemetryReport)(G,Y,this.rootRef,this.configProvider),Extensions:(0,K.compileExtensionsTelemetryReport)($,this.configProvider,G.statsErrors)};return X.metrics.ReportGenerationTimeMs=W.round(W.hptime()-J),X}},DiagnosticsReport.prototype.getRealtimeTelemetry=function(F){var B=this.rootRef.sessions.find((function(B){return B.sessionId===F})),G=B.nativeSessions[B.nativeSessions.length-1],W=this.configProvider.config.diagnostics.realtimeTelemetry.pollingInterval,z=G.statsReports.slice(G.statsReports.length-W);return(0,J.compileRealtimeTelemetryReport)(z)},DiagnosticsReport.prototype.getMediaSessionStats=function(F){var B,G=this.rootRef.sessions.find((function(B){return B.sessionId===F}));if(G){var W=G.callNumber>1?this.rootRef.sessions.find((function(F){return G.callNumber-1===F.callNumber})):void 0,z=null!==(B=null==W?void 0:W.terminationTime)&&void 0!==B?B:0,K=G.nativeSessions[G.nativeSessions.length-1],J=(null==K?void 0:K.statsReports.length)?K.statsReports[K.statsReports.length-1]:void 0,Y=J?(0,Q.compileMediaStatsReport)(J):void 0;return Y&&(Y.extensions=(0,Q.compileMediaStatsReportExtensions)(K,this.configProvider),Y.metrics=(0,Q.compileMediaStatsReportMetrics)(G,z,this.rootRef)),Y}},DiagnosticsReport}();B.DiagnosticsReport=Y},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.compileMetricsTelemetryReport=void 0;var W=G(1),z=G(34);function compileMetricsTelemetryReport(F,B,G,K){var J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve;return W.removeUndefinedFields({MediaLegId:F.mediaLegId,CreationTime:getHpTimeFromMillis(F.creationTime),CallNumber:F.callNumber,SessionId:F.sessionId,MultiParty:F.isMultiParty,ErrorType:null!==(Q=null===(J=F.error)||void 0===J?void 0:J.type)&&void 0!==Q?Q:"none",ErrorDetail:null!==($=null===(Y=F.error)||void 0===Y?void 0:Y.detail)&&void 0!==$?$:"none",IncompatibleOffer:(null===(X=F.error)||void 0===X?void 0:X.type)===z.Constants.MEDIA_ERROR.incompatibleOffer,TerminationTime:getHpTimeFromMillis(F.terminationTime),TerminationReason_code:null===(Z=F.terminationReason)||void 0===Z?void 0:Z.code,TerminationReason_subCode:null===(ee=F.terminationReason)||void 0===ee?void 0:ee.subCode,TerminationReason_phrase:null===(te=F.terminationReason)||void 0===te?void 0:te.phrase,TerminationReason_remoteTerminated:null===(ne=F.terminationReason)||void 0===ne?void 0:ne.remoteTerminated,TerminationReason_clientReasonPhrase:null===(ie=F.terminationReason)||void 0===ie?void 0:ie.clientReasonPhrase,TerminationReason_clientReasonSubCode:null===(re=F.terminationReason)||void 0===re?void 0:re.clientReasonSubCode,CallDuration:getHpTimeFromMillis(F.duration),IceInitTime:getHpTimeFromMillis(F.iceInitTime),IceConnectedStateTime:getHpTimeFromMillis(F.iceConnectedStateTime),NegotiationCount:F.negotiationCount,RejectedNegotiationCount:F.rejectedNegotiationCount,InitialNegotiationCompleted:F.initialNegotiationCompleted,InitialNegotiationType:F.initialNegotiationType,FinalAnswerTime:getHpTimeFromMillis(F.finalAnswerTime),TransportReconnectedCount:F.transportReconnectedCount,RollbackNegotiation:JSON.stringify(F.rollbackNegotiation),Relay:F.relay?JSON.stringify(F.relay):void 0,AllowedAudioSend:F.allowedAudioSend,AllowedVideoSend:F.allowedVideoSend,AllowedScreensharingSend:F.allowedScreensharingSend,RelayManager:JSON.stringify(F.relayTimers),CallMutedRatio:getHpTimeFromMillis(F.callMutedRatio),CallOsMuted:getHpTimeFromMillis(F.callOsMuted),CallHwSilent:getHpTimeFromMillis(F.callHwSilent),CallSwMuted:getHpTimeFromMillis(F.callSwMuted),CallSpeakerMuted:getHpTimeFromMillis(F.callSpeakerMuted),CallIsSpeaking:getHpTimeFromMillis(F.callIsSpeaking),DtmfSuccess:F.dtmfSuccessCount,DtmfFailure:F.dtmfFailureCount,ReconnectInProgress:null===(oe=F.reconnect)||void 0===oe?void 0:oe.isReconnecting,RetargetIncomingCount:null===(ae=F.reconnect)||void 0===ae?void 0:ae.retargetCount.incoming,RetargetOutgoingCount:null===(se=F.reconnect)||void 0===se?void 0:se.retargetCount.outgoing,RetargetCompletedCount:null===(ce=F.reconnect)||void 0===ce?void 0:ce.retargetCount.completed,RetargetRejectedCount:null===(le=F.reconnect)||void 0===le?void 0:le.retargetCount.rejected,EscalationAttemptedCount:null===(de=F.reconnect)||void 0===de?void 0:de.escalationCount.attempted,EscalationCompletedCount:null===(ue=F.reconnect)||void 0===ue?void 0:ue.escalationCount.completed,EscalationRejectedCount:null===(pe=F.reconnect)||void 0===pe?void 0:pe.escalationCount.rejected,ReconnectAttemptedCount:null===(he=F.reconnect)||void 0===he?void 0:he.reconnectCount.attempted,ReconnectConnectedCount:null===(ge=F.reconnect)||void 0===ge?void 0:ge.reconnectCount.connected,NoIceCandidatesGoodEventCount:F.noIceCandidatesEventCount.good,NoIceCandidatesBadEventCount:F.noIceCandidatesEventCount.bad,NoRelayIceCandidatesGoodEventCount:F.noRelayIceCandidatesEventCount.good,NoRelayIceCandidatesBadEventCount:F.noRelayIceCandidatesEventCount.bad,MicrophoneInUseGoodEventCount:F.microphoneInUseEventCount.good,MicrophoneInUseBadEventCount:F.microphoneInUseEventCount.bad,CameraInUseGoodEventCount:F.cameraInUseEventCount.good,CameraInUseBadEventCount:F.cameraInUseEventCount.bad,CameraFreezeStartEventCount:F.cameraFreezeEventCount.start,CameraFreezeEndEventCount:F.cameraFreezeEventCount.end,NetworkRecvGood:F.networkRecvUFD.good,NetworkRecvGoodRatio:F.networkRecvUFD.goodRatio,NetworkRecvPoor:F.networkRecvUFD.poor,NetworkRecvPoorRatio:F.networkRecvUFD.poorRatio,NetworkRecvBad:F.networkRecvUFD.bad,NetworkRecvBadRatio:F.networkRecvUFD.badRatio,NetworkSendGood:F.networkSendUFD.good,NetworkSendGoodRatio:F.networkSendUFD.goodRatio,NetworkSendPoor:F.networkSendUFD.poor,NetworkSendPoorRatio:F.networkSendUFD.poorRatio,NetworkSendBad:F.networkSendUFD.bad,NetworkSendBadRatio:F.networkSendUFD.badRatio,RawOutputAudioAccessAttempted:F.rawMedia.audio.recv.numAttempts,RawOutputAudioAccessDurationRatio:F.rawMedia.audio.recv.durationRatio,RawInputAudioOverrideAttempted:F.rawMedia.audio.send.numAttempts,RawInputAudioOverrideDurationRatio:F.rawMedia.audio.send.durationRatio,UFDs:JSON.stringify(W.rebaseTime(W.limitArraySize(F.ufds,K.config.diagnostics.telemetryLimits.numUFDs),"timestamp",F.creationTime)),MediaQosEnabled:null!==(me=null===(fe=G.configuration.mediaConfig)||void 0===fe?void 0:fe.enableMediaQoS)&&void 0!==me&&me,PortRangeConfigured:!!(null===(ve=G.configuration.mediaConfig)||void 0===ve?void 0:ve.mediaPortRanges),hardwareConcurrency:navigator.hardwareConcurrency,ETag:F.ETag,ConfigIds:F.configIds,PermissionStates:JSON.stringify(G.deviceManager.permissionStates),DeviceList:JSON.stringify(G.deviceManager.deviceList),DeviceListDebug:JSON.stringify(G.deviceManager.deviceDebugStrings),DevicesChangeCount:F.deviceManager.devicesChangeCount,DevicesPollChangeCount:F.deviceManager.devicesPollChangeCount,DeviceSelectionChangeCount:F.deviceManager.deviceSelectionChangeCount,DeviceSelectionChangeFromInterfaceCount:F.deviceManager.deviceSelectionChangeCountFromInterface,DevicesCount:JSON.stringify(G.deviceManager.devicesCount),UsedMicrophone:G.deviceManager.usedDevices.microphone,UsedSpeaker:G.deviceManager.usedDevices.speaker,UsedCamera:G.deviceManager.usedDevices.camera,DeviceEvents:JSON.stringify(W.rebaseTime(G.deviceManager.deviceTelemetryEvents.filter((function(F){return F.timestamp>B})),"timestamp",F.creationTime)),VideoEffects:JSON.stringify(W.rebaseTime(G.deviceManager.videoEffectsEvents.filter((function(F){return F.timestamp>B})),"timestamp",F.creationTime)),AudioEffects:JSON.stringify(W.rebaseTime(G.deviceManager.audioEffectsEvents.filter((function(F){return F.timestamp>B})),"timestamp",F.creationTime))})}function getHpTimeFromMillis(F){return 1e4*F}B.compileMetricsTelemetryReport=compileMetricsTelemetryReport},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.compileExtensionsTelemetryReport=void 0;var W=G(1),z=G(463),K=G(464);function compileExtensionsTelemetryReport(F,B,G){var J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Te,Ee,be,Ie,Ae,Re,Pe,Oe,Me,we,De,Ne,Le,ke,Fe,xe,Ue,je,Be,He,Ve,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e,Xe,Ze,et,tt,nt,it,rt,ot,at,st,ct,lt,dt,ut,pt,ht,gt,ft,mt,vt,yt,St,_t,Ct,Tt,Et,bt,It,At,Rt,Pt,Ot,Mt,wt,Dt,Nt=F.aggregatedModalityStats,Lt=W.getLast(null===(J=Nt.audio)||void 0===J?void 0:J.recv),kt=W.getLast(null===(Q=Nt.audio)||void 0===Q?void 0:Q.send),Ft=W.getLast(null===(Y=Nt.video)||void 0===Y?void 0:Y.recv),xt=W.getLast(null===($=Nt.video)||void 0===$?void 0:$.send),Ut=W.getLast(null===(X=Nt.sharing)||void 0===X?void 0:X.recv),jt=W.getLast(null===(Z=Nt.sharing)||void 0===Z?void 0:Z.send),Bt=F.qualityManager&&W.limitArraySize(W.deepClone(F.qualityManager.videoMaxCapabilitiesEvents).map((function(G){return W.rebaseTime(W.limitArraySize(G.events,B.config.diagnostics.telemetryLimits.numCapabilitiesApplied,1),"timestamp",F.startTime)})),B.config.diagnostics.telemetryLimits.numCapabilitiesRequested),Ht=F.qualityManager&&W.limitArraySize(W.deepClone(F.qualityManager.sharingMaxCapabilitiesEvents).map((function(G){return W.rebaseTime(W.limitArraySize(G.events,B.config.diagnostics.telemetryLimits.numCapabilitiesApplied,1),"timestamp",F.startTime)})),B.config.diagnostics.telemetryLimits.numCapabilitiesRequested);return W.removeUndefinedFields({BundlePolicy:F.bundlePolicy,FakeIceCandidate:F.fakeIceCandidate,H264_available_profiles:JSON.stringify(F.H264Profiles),IceConnectionState:F.iceConnectionState,IceConnectionStatePrevious:F.iceConnectionStatePrevious,IceServers:F.iceServers,IceTransportPolicy:F.iceTransportPolicy,NegotiatedSrtp:JSON.stringify(F.negotiatedSrtp),OfferedSrtp:JSON.stringify(F.offeredSrtp),RelayCandidate:F.relayCandidate,SdpSemantics:F.sdpSemantics,iceCandidateErrors:JSON.stringify(F.iceCandidateErrors),SignalingState:F.signalingState,SignalingStatePrevious:F.signalingStatePrevious,WebRTCStats_statsErrors:JSON.stringify(G),MaxSessionBandwidth:F.maxSessionBandwidth,totalVideoControlMessages:null===(ee=F.qualityManager)||void 0===ee?void 0:ee.numVideoControlMessages,outOfOrderVideoControlMessages:null===(te=F.qualityManager)||void 0===te?void 0:te.numOutOfOrderVideoControlMessages,Connection:W.removeUndefinedFields({DownLink:W.sampleseries(F.networkInfo,(function(F){return F.downlink})),EffectiveType:W.sampleseries(F.networkInfo,(function(F){return F.effectiveType})),Rtt:W.sampleseries(F.networkInfo,(function(F){return F.rtt})),SaveData:null===(ne=W.getLast(F.networkInfo))||void 0===ne?void 0:ne.saveData}),IPAddress:null!==(ie=F.IPAddress)&&void 0!==ie?ie:"none",ReflexiveLocalIP:null!==(re=F.reflexiveLocalIP)&&void 0!==re?re:"none",NumberOfInterfaces:F.numInterfaces,StartTime:F.startTime,EndTime:F.endTime,AudioTransportRecvBitrate:null===(ae=null===(oe=null==Lt?void 0:Lt.transport)||void 0===oe?void 0:oe.extensions)||void 0===ae?void 0:ae.recvBWAvg,AudioTransportSendBitrate:null===(ce=null===(se=null==Lt?void 0:Lt.transport)||void 0===se?void 0:se.extensions)||void 0===ce?void 0:ce.sendBWAvg,AudioPayloadRecvBitrate:null===(le=null==Lt?void 0:Lt.extensions)||void 0===le?void 0:le.bitrateAvg,AudioPayloadSendBitrate:null===(de=null==kt?void 0:kt.extensions)||void 0===de?void 0:de.bitrateAvg,VideoPayloadRecvBitrate:null===(ue=null==Ft?void 0:Ft.extensions)||void 0===ue?void 0:ue.bitrateAvg,VideoPayloadSendBitrate:null===(pe=null==xt?void 0:xt.extensions)||void 0===pe?void 0:pe.bitrateAvg,WebRTCStats_bweStat_googAvailableReceiveBandwidth:null!==(ge=W.sampleseries(null===(he=Nt.video)||void 0===he?void 0:he.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableIncomingBitrate})))&&void 0!==ge?ge:W.sampleseries(null===(fe=Nt.video)||void 0===fe?void 0:fe.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableIncomingBitrate})),WebRTCStats_bweStat_googAvailableSendBandwidth:null!==(ve=W.sampleseries(null===(me=Nt.video)||void 0===me?void 0:me.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableOutgoingBitrate})))&&void 0!==ve?ve:W.sampleseries(null===(ye=Nt.video)||void 0===ye?void 0:ye.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableOutgoingBitrate})),ReportedSendBWMax:F.reportedSendBandwidthMax,ReportedSendBWMin:F.reportedSendBandwidthMin,Bandwidth_jumpsHistogram:JSON.stringify(null===(_e=null===(Se=null==xt?void 0:xt.transport)||void 0===Se?void 0:Se.extensions)||void 0===_e?void 0:_e.bwJumpsHistogram),WebRTCStats_ssrc:W.removeUndefinedFields({audio:(0,z.compileAudioReport)(Nt,Lt,kt),video:(0,K.compileVideoTelemetryReport)("video",Nt,Ft,xt),sharing:(0,K.compileVideoTelemetryReport)("sharing",Nt,Ut,jt)}),Audio_recv_jitterBufferAvgSize:null===(Ce=null==Lt?void 0:Lt.extensions)||void 0===Ce?void 0:Ce.avgJitterBufferSize,Audio_recv_packetsLostRateMax:null===(Te=null==Lt?void 0:Lt.extensions)||void 0===Te?void 0:Te.lossRateMax,Audio_send_rttAvg:(null===(Ee=null==kt?void 0:kt.extensions)||void 0===Ee?void 0:Ee.rttAvg)&&W.round(1e3*kt.extensions.rttAvg),Audio_send_rttMax:(null===(be=null==kt?void 0:kt.extensions)||void 0===be?void 0:be.rttMax)&&W.round(1e3*kt.extensions.rttMax),Audio_send_RawInputVolume:W.sampleseries(null===(Ie=Nt.audio)||void 0===Ie?void 0:Ie.send,(function(F){var B;return null===(B=F.extensions)||void 0===B?void 0:B.rawInputVolume})),Audio_send_packetsLostRateMax:null===(Ae=null==kt?void 0:kt.extensions)||void 0===Ae?void 0:Ae.lossRateMax,Video_recv_DurationSeconds:null===(Re=null==Ft?void 0:Ft.extensions)||void 0===Re?void 0:Re.duration,Video_recv_FreezeHistogram:JSON.stringify(null===(Pe=null==Ft?void 0:Ft.extensions)||void 0===Pe?void 0:Pe.freezeCountHistogram),Video_recv_FreezeTimestamps:JSON.stringify(W.rebaseHistogramTimestamps(null===(Oe=null==Ft?void 0:Ft.extensions)||void 0===Oe?void 0:Oe.freezeTimestampsHistogram,F.startTime)),Video_recv_LongestFreezeDuration:null===(Me=null==Ft?void 0:Ft.extensions)||void 0===Me?void 0:Me.longestFreeze,Video_recv_OngoingFreeze:null===(we=null==Ft?void 0:Ft.extensions)||void 0===we?void 0:we.isFrozen,Video_recv_TotalFreezeDuration:null===(De=null==Ft?void 0:Ft.extensions)||void 0===De?void 0:De.totalFreezeDuration,Video_recv_RecvAvgFreezeDuration:null===(Ne=null==Ft?void 0:Ft.extensions)||void 0===Ne?void 0:Ne.avgFreezeDuration,Video_recv_NumResolutionSwitches:null===(Le=null==Ft?void 0:Ft.extensions)||void 0===Le?void 0:Le.numResolutionSwitches,Video_recv_ResolutionDurations:JSON.stringify(null===(ke=null==Ft?void 0:Ft.extensions)||void 0===ke?void 0:ke.resolutionDurations),Video_recv_StreamsMax:F.recvVideoStreamCount.max,Video_recv_StreamsMin:F.recvVideoStreamCount.min,Video_recv_StreamsMode:F.recvVideoStreamCount.mode,Video_recv_TimeToFirstFrame:F.remoteVideoManager.firstTimeToFirstFrameVideo,Video_recv_bitrateAvg:null===(Fe=null==Ft?void 0:Ft.extensions)||void 0===Fe?void 0:Fe.bitrateAvg,Video_recv_bitrateMax:null===(xe=null==Ft?void 0:Ft.extensions)||void 0===xe?void 0:xe.bitrateMax,Video_recv_frameRateAvg:null===(Ue=null==Ft?void 0:Ft.extensions)||void 0===Ue?void 0:Ue.avgFrameRate,Video_recv_jitterBufferAvgSize:null===(je=null==Ft?void 0:Ft.extensions)||void 0===je?void 0:je.avgJitterBufferSize,Video_recv_packetsLostRateMax:null===(Be=null==Ft?void 0:Ft.extensions)||void 0===Be?void 0:Be.lossRateMax,Video_recv_isRenderingEvents:JSON.stringify(W.limitArraySize(F.remoteVideoManager.isRenderingEvents.video,B.config.diagnostics.telemetryLimits.numIsRenderingEvents)),Video_recv_FpsHarmonicAverage:null===(He=null==Ft?void 0:Ft.extensions)||void 0===He?void 0:He.fpsHarmonicAverage,Video_recv_PreferredResolution:null===(Ve=F.remoteVideoManager.preferredResolution.video)||void 0===Ve?void 0:Ve.toString(),Video_SubscriptionEvents:JSON.stringify(W.rebaseTime(null===(Ge=F.subscriptionManager)||void 0===Ge?void 0:Ge.events.video,"ts",F.startTime)),Video_send_CaptureFramerateAvg:null===(We=null==xt?void 0:xt.extensions)||void 0===We?void 0:We.captureFramerateAvg,Video_send_DurationSeconds:null===(qe=null==xt?void 0:xt.extensions)||void 0===qe?void 0:qe.duration,Video_send_FreezeIntervals:null===(ze=null==xt?void 0:xt.extensions)||void 0===ze?void 0:ze.captureFreezeIntervalsCount,Video_send_MaxCapabilities:JSON.stringify(Bt),Video_send_OvershootDurations:JSON.stringify({fs:null===(Ke=null==xt?void 0:xt.extensions)||void 0===Ke?void 0:Ke.totalFsOvershootDuration,fps:null===(Je=null==xt?void 0:xt.extensions)||void 0===Je?void 0:Je.totalFpsOvershootDuration,br:null===(Qe=null==xt?void 0:xt.extensions)||void 0===Qe?void 0:Qe.totalBrOvershootDuration}),Video_send_OvershootEvents:JSON.stringify(W.rebaseTime(null==xt?void 0:xt.extensions.overshootEvents,"timestamp",F.startTime)),Video_send_QpAvg:null===(Ye=null==xt?void 0:xt.extensions)||void 0===Ye?void 0:Ye.qpAvg,Video_send_bitrateAvg:null===($e=null==xt?void 0:xt.extensions)||void 0===$e?void 0:$e.bitrateAvg,Video_send_bitrateMax:null===(Xe=null==xt?void 0:xt.extensions)||void 0===Xe?void 0:Xe.bitrateMax,Video_send_frameRateAvg:null===(Ze=null==xt?void 0:xt.extensions)||void 0===Ze?void 0:Ze.frameRateAvg,Video_send_AllocateBWAvg:null===(et=null==xt?void 0:xt.extensions)||void 0===et?void 0:et.bweAvg,Video_send_CameraOpenWidth:null===(nt=null===(tt=null==xt?void 0:xt.extensions)||void 0===tt?void 0:tt.cameraOpenResolution)||void 0===nt?void 0:nt.width,Video_send_CameraOpenHeight:null===(rt=null===(it=null==xt?void 0:xt.extensions)||void 0===it?void 0:it.cameraOpenResolution)||void 0===rt?void 0:rt.height,Video_send_packetsLostRateMax:null===(ot=null==xt?void 0:xt.extensions)||void 0===ot?void 0:ot.lossRateMax,Sharing_recv_DurationSeconds:null===(at=null==Ut?void 0:Ut.extensions)||void 0===at?void 0:at.duration,Sharing_recv_FreezeHistogram:JSON.stringify(null===(st=null==Ut?void 0:Ut.extensions)||void 0===st?void 0:st.freezeCountHistogram),Sharing_recv_FreezeTimestamps:JSON.stringify(W.rebaseHistogramTimestamps(null===(ct=null==Ut?void 0:Ut.extensions)||void 0===ct?void 0:ct.freezeTimestampsHistogram,F.startTime)),Sharing_recv_LongestFreezeDuration:null===(lt=null==Ut?void 0:Ut.extensions)||void 0===lt?void 0:lt.longestFreeze,Sharing_recv_OngoingFreeze:null===(dt=null==Ut?void 0:Ut.extensions)||void 0===dt?void 0:dt.isFrozen,Sharing_recv_TotalFreezeDuration:null===(ut=null==Ut?void 0:Ut.extensions)||void 0===ut?void 0:ut.totalFreezeDuration,Sharing_recv_RecvAvgFreezeDuration:null===(pt=null==Ut?void 0:Ut.extensions)||void 0===pt?void 0:pt.avgFreezeDuration,Sharing_recv_NumResolutionSwitches:null===(ht=null==Ut?void 0:Ut.extensions)||void 0===ht?void 0:ht.numResolutionSwitches,Sharing_recv_ResolutionDurations:JSON.stringify(null===(gt=null==Ut?void 0:Ut.extensions)||void 0===gt?void 0:gt.resolutionDurations),Sharing_recv_StreamsMax:F.recvVideoStreamCount.max,Sharing_recv_StreamsMin:F.recvVideoStreamCount.min,Sharing_recv_StreamsMode:F.recvVideoStreamCount.mode,Sharing_recv_TimeToFirstFrame:F.remoteVideoManager.firstTimeToFirstFrameSharing,Sharing_recv_bitrateAvg:null===(ft=null==Ut?void 0:Ut.extensions)||void 0===ft?void 0:ft.bitrateAvg,Sharing_recv_bitrateMax:null===(mt=null==Ut?void 0:Ut.extensions)||void 0===mt?void 0:mt.bitrateMax,Sharing_recv_frameRateAvg:null===(vt=null==Ut?void 0:Ut.extensions)||void 0===vt?void 0:vt.avgFrameRate,Sharing_recv_jitterBufferAvgSize:null===(yt=null==Ut?void 0:Ut.extensions)||void 0===yt?void 0:yt.avgJitterBufferSize,Sharing_recv_packetsLostRateMax:null===(St=null==Ut?void 0:Ut.extensions)||void 0===St?void 0:St.lossRateMax,Sharing_recv_isRenderingEvents:JSON.stringify(W.limitArraySize(F.remoteVideoManager.isRenderingEvents.sharing,B.config.diagnostics.telemetryLimits.numIsRenderingEvents)),Sharing_recv_PreferredResolution:null===(_t=F.remoteVideoManager.preferredResolution.sharing)||void 0===_t?void 0:_t.toString(),Sharing_SubscriptionEvents:JSON.stringify(W.rebaseTime(null===(Ct=F.subscriptionManager)||void 0===Ct?void 0:Ct.events.sharing,"ts",F.startTime)),Sharing_send_CaptureFramerateAvg:null===(Tt=null==jt?void 0:jt.extensions)||void 0===Tt?void 0:Tt.captureFramerateAvg,Sharing_send_DurationSeconds:null===(Et=null==jt?void 0:jt.extensions)||void 0===Et?void 0:Et.duration,Sharing_send_MaxCapabilities:JSON.stringify(Ht),Sharing_send_OvershootDurations:JSON.stringify({fs:null===(bt=null==jt?void 0:jt.extensions)||void 0===bt?void 0:bt.totalFsOvershootDuration,fps:null===(It=null==jt?void 0:jt.extensions)||void 0===It?void 0:It.totalFpsOvershootDuration,br:null===(At=null==jt?void 0:jt.extensions)||void 0===At?void 0:At.totalBrOvershootDuration}),Sharing_send_OvershootEvents:JSON.stringify(W.rebaseTime(null==jt?void 0:jt.extensions.overshootEvents,"timestamp",F.startTime)),Sharing_send_QpAvg:null===(Rt=null==jt?void 0:jt.extensions)||void 0===Rt?void 0:Rt.qpAvg,Sharing_send_bitrateAvg:null===(Pt=null==jt?void 0:jt.extensions)||void 0===Pt?void 0:Pt.bitrateAvg,Sharing_send_bitrateMax:null===(Ot=null==jt?void 0:jt.extensions)||void 0===Ot?void 0:Ot.bitrateMax,Sharing_send_frameRateAvg:null===(Mt=null==jt?void 0:jt.extensions)||void 0===Mt?void 0:Mt.frameRateAvg,Sharing_send_AllocateBWAvg:null===(wt=null==jt?void 0:jt.extensions)||void 0===wt?void 0:wt.bweAvg,Sharing_send_packetsLostRateMax:null===(Dt=null==jt?void 0:jt.extensions)||void 0===Dt?void 0:Dt.lossRateMax,multipleVideoStreams:JSON.stringify(W.rebaseTime(F.multiViewStats,"startTime",F.startTime)),ReportedReceiveBandwidth:F.reportedReceiveBandwidth,OptimalVideoCount:W.rebaseTime(F.optimalVideoCount,"ts",F.startTime).map((function(F){return JSON.stringify(F)}))})}B.compileExtensionsTelemetryReport=compileExtensionsTelemetryReport},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.compileAudioReport=void 0;var W=G(1);function compileAudioReport(F,B,G){var z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Te,Ee,be,Ie,Ae,Re,Pe,Oe,Me,we,De,Ne,Le,ke,Fe,xe,Ue,je,Be,He,Ve,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e,Xe,Ze,et,tt,nt,it,rt,ot,at,st,ct,lt,dt,ut,pt,ht,gt,ft,mt,vt,yt,St,_t,Ct,Tt,Et,bt,It,At,Rt,Pt,Ot,Mt,wt,Dt,Nt,Lt,kt,Ft,xt,Ut,jt,Bt,Ht,Vt,Gt,Wt,qt,zt,Kt,Jt,Qt,Yt,$t,Xt,Zt,en,tn,nn,rn;return W.removeUndefinedFields({recv:W.removeUndefinedFields({id:null==B?void 0:B.inboundRTP.id,ssrc:null==B?void 0:B.inboundRTP.ssrc,mediaType:null!==(z=null==B?void 0:B.inboundRTP.mediaType)&&void 0!==z?z:null==B?void 0:B.inboundRTP.kind,bytesReceived:W.sampleseries(null===(K=F.audio)||void 0===K?void 0:K.recv,(function(F){return F.inboundRTP.bytesReceived})),packetsReceived:W.sampleseries(null===(J=F.audio)||void 0===J?void 0:J.recv,(function(F){return F.inboundRTP.packetsReceived})),packetsLost:W.sampleseries(null===(Q=F.audio)||void 0===Q?void 0:Q.recv,(function(F){return F.inboundRTP.packetsLost})),googCodecName:null===(Y=null==B?void 0:B.codec)||void 0===Y?void 0:Y.mimeType.split("/")[1],googTrackId:null===($=null==B?void 0:B.track)||void 0===$?void 0:$.trackIdentifier,transport_id:null===(X=null==B?void 0:B.transport)||void 0===X?void 0:X.id,transportId:null==B?void 0:B.inboundRTP.transportId,transport_selectedCandidatePairId:null===(Z=null==B?void 0:B.transport)||void 0===Z?void 0:Z.selectedCandidatePairId,transport_localCertificateId:null===(ee=null==B?void 0:B.transport)||void 0===ee?void 0:ee.localCertificateId,transport_remoteCertificateId:null===(te=null==B?void 0:B.transport)||void 0===te?void 0:te.remoteCertificateId,transport_dtlsCipher:null===(ne=null==B?void 0:B.transport)||void 0===ne?void 0:ne.dtlsCipher,transport_srtpCipher:null===(ie=null==B?void 0:B.transport)||void 0===ie?void 0:ie.srtpCipher,pair_id:null===(oe=null===(re=null==B?void 0:B.transport)||void 0===re?void 0:re.selectedCandidatePair)||void 0===oe?void 0:oe.id,pair_responsesSent:W.sampleseries(null===(ae=F.audio)||void 0===ae?void 0:ae.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesSent})),pair_requestsReceived:W.sampleseries(null===(se=F.audio)||void 0===se?void 0:se.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsReceived})),pair_googRemoteCandidateType:null===(de=null===(le=null===(ce=null==B?void 0:B.transport)||void 0===ce?void 0:ce.selectedCandidatePair)||void 0===le?void 0:le.remoteCandidate)||void 0===de?void 0:de.candidateType,pair_consentRequestsSent:W.sampleseries(null===(ue=F.audio)||void 0===ue?void 0:ue.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.consentRequestsSent})),pair_googTransportType:null===(ge=null===(he=null===(pe=null==B?void 0:B.transport)||void 0===pe?void 0:pe.selectedCandidatePair)||void 0===he?void 0:he.localCandidate)||void 0===ge?void 0:ge.protocol,pair_googLocalCandidateType:null===(ve=null===(me=null===(fe=null==B?void 0:B.transport)||void 0===fe?void 0:fe.selectedCandidatePair)||void 0===me?void 0:me.localCandidate)||void 0===ve?void 0:ve.candidateType,pair_googWritable:null===(Se=null===(ye=null==B?void 0:B.transport)||void 0===ye?void 0:ye.selectedCandidatePair)||void 0===Se?void 0:Se.writable,pair_requestsSent:W.sampleseries(null===(_e=F.audio)||void 0===_e?void 0:_e.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsSent})),pair_googRtt:W.sampleseries(null===(Ce=F.audio)||void 0===Ce?void 0:Ce.recv,(function(F){var B,G;return 1e3*(null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(Ee=null===(Te=null==B?void 0:B.transport)||void 0===Te?void 0:Te.selectedCandidatePair)||void 0===Ee?void 0:Ee.nominated,pair_packetsDiscardedOnSend:null===(Ie=null===(be=null==B?void 0:B.transport)||void 0===be?void 0:be.selectedCandidatePair)||void 0===Ie?void 0:Ie.packetsDiscardedOnSend,pair_bytesReceived:W.sampleseries(null===(Ae=F.audio)||void 0===Ae?void 0:Ae.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesReceived})),pair_responsesReceived:W.sampleseries(null===(Re=F.audio)||void 0===Re?void 0:Re.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesReceived})),pair_remoteCandidateId:null===(Me=null===(Oe=null===(Pe=null==B?void 0:B.transport)||void 0===Pe?void 0:Pe.selectedCandidatePair)||void 0===Oe?void 0:Oe.remoteCandidate)||void 0===Me?void 0:Me.id,pair_localCandidateId:null===(Ne=null===(De=null===(we=null==B?void 0:B.transport)||void 0===we?void 0:we.selectedCandidatePair)||void 0===De?void 0:De.localCandidate)||void 0===Ne?void 0:Ne.id,pair_packetsSent:W.sampleseries(null===(Le=F.audio)||void 0===Le?void 0:Le.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.packetsSent})),pair_googLocalAddress:null!==(Ue=null===(xe=null===(Fe=null===(ke=null==B?void 0:B.transport)||void 0===ke?void 0:ke.selectedCandidatePair)||void 0===Fe?void 0:Fe.localCandidate)||void 0===xe?void 0:xe.ip)&&void 0!==Ue?Ue:null===(He=null===(Be=null===(je=null==B?void 0:B.transport)||void 0===je?void 0:je.selectedCandidatePair)||void 0===Be?void 0:Be.localCandidate)||void 0===He?void 0:He.address,pair_googRemoteAddress:null!==(qe=null===(We=null===(Ge=null===(Ve=null==B?void 0:B.transport)||void 0===Ve?void 0:Ve.selectedCandidatePair)||void 0===Ge?void 0:Ge.remoteCandidate)||void 0===We?void 0:We.ip)&&void 0!==qe?qe:null===(Je=null===(Ke=null===(ze=null==B?void 0:B.transport)||void 0===ze?void 0:ze.selectedCandidatePair)||void 0===Ke?void 0:Ke.remoteCandidate)||void 0===Je?void 0:Je.address,pair_bytesSent:W.sampleseries(null===(Qe=F.audio)||void 0===Qe?void 0:Qe.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesSent})),pair_googReadable:null===($e=null===(Ye=null==B?void 0:B.transport)||void 0===Ye?void 0:Ye.selectedCandidatePair)||void 0===$e?void 0:$e.nominated}),send:W.removeUndefinedFields({id:null==G?void 0:G.outboundRTP.id,ssrc:null==G?void 0:G.outboundRTP.ssrc,mediaType:null!==(Xe=null==G?void 0:G.outboundRTP.mediaType)&&void 0!==Xe?Xe:null==G?void 0:G.outboundRTP.kind,bytesSent:W.sampleseries(null===(Ze=F.audio)||void 0===Ze?void 0:Ze.send,(function(F){return F.outboundRTP.bytesSent})),packetsSent:W.sampleseries(null===(et=F.audio)||void 0===et?void 0:et.send,(function(F){return F.outboundRTP.packetsSent})),packetsLost:W.sampleseries(null===(tt=F.audio)||void 0===tt?void 0:tt.send,(function(F){var B;return null===(B=F.remoteInboundRTP)||void 0===B?void 0:B.packetsLost})),googCodecName:null===(nt=null==G?void 0:G.codec)||void 0===nt?void 0:nt.mimeType.split("/")[1],googTrackId:null===(it=null==G?void 0:G.track)||void 0===it?void 0:it.trackIdentifier,transport_id:null===(rt=null==G?void 0:G.transport)||void 0===rt?void 0:rt.id,transportId:null==G?void 0:G.outboundRTP.transportId,transport_selectedCandidatePairId:null===(ot=null==G?void 0:G.transport)||void 0===ot?void 0:ot.selectedCandidatePairId,transport_localCertificateId:null===(at=null==G?void 0:G.transport)||void 0===at?void 0:at.localCertificateId,transport_remoteCertificateId:null===(st=null==G?void 0:G.transport)||void 0===st?void 0:st.remoteCertificateId,transport_dtlsCipher:null===(ct=null==G?void 0:G.transport)||void 0===ct?void 0:ct.dtlsCipher,transport_srtpCipher:null===(lt=null==G?void 0:G.transport)||void 0===lt?void 0:lt.srtpCipher,pair_id:null===(ut=null===(dt=null==G?void 0:G.transport)||void 0===dt?void 0:dt.selectedCandidatePair)||void 0===ut?void 0:ut.id,pair_responsesSent:W.sampleseries(null===(pt=F.audio)||void 0===pt?void 0:pt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesSent})),pair_requestsReceived:W.sampleseries(null===(ht=F.audio)||void 0===ht?void 0:ht.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsReceived})),pair_googRemoteCandidateType:null===(mt=null===(ft=null===(gt=null==G?void 0:G.transport)||void 0===gt?void 0:gt.selectedCandidatePair)||void 0===ft?void 0:ft.remoteCandidate)||void 0===mt?void 0:mt.candidateType,pair_consentRequestsSent:W.sampleseries(null===(vt=F.audio)||void 0===vt?void 0:vt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.consentRequestsSent})),pair_googTransportType:null===(_t=null===(St=null===(yt=null==G?void 0:G.transport)||void 0===yt?void 0:yt.selectedCandidatePair)||void 0===St?void 0:St.localCandidate)||void 0===_t?void 0:_t.protocol,pair_googLocalCandidateType:null===(Et=null===(Tt=null===(Ct=null==G?void 0:G.transport)||void 0===Ct?void 0:Ct.selectedCandidatePair)||void 0===Tt?void 0:Tt.localCandidate)||void 0===Et?void 0:Et.candidateType,pair_googWritable:null===(It=null===(bt=null==G?void 0:G.transport)||void 0===bt?void 0:bt.selectedCandidatePair)||void 0===It?void 0:It.writable,pair_requestsSent:W.sampleseries(null===(At=F.audio)||void 0===At?void 0:At.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsSent})),pair_googRtt:W.sampleseries(null===(Rt=F.audio)||void 0===Rt?void 0:Rt.send,(function(F){var B,G;return 1e3*(null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(Ot=null===(Pt=null==G?void 0:G.transport)||void 0===Pt?void 0:Pt.selectedCandidatePair)||void 0===Ot?void 0:Ot.nominated,pair_packetsDiscardedOnSend:null===(wt=null===(Mt=null==G?void 0:G.transport)||void 0===Mt?void 0:Mt.selectedCandidatePair)||void 0===wt?void 0:wt.packetsDiscardedOnSend,pair_bytesReceived:W.sampleseries(null===(Dt=F.audio)||void 0===Dt?void 0:Dt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesReceived})),pair_responsesReceived:W.sampleseries(null===(Nt=F.audio)||void 0===Nt?void 0:Nt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesReceived})),pair_remoteCandidateId:null===(Ft=null===(kt=null===(Lt=null==G?void 0:G.transport)||void 0===Lt?void 0:Lt.selectedCandidatePair)||void 0===kt?void 0:kt.remoteCandidate)||void 0===Ft?void 0:Ft.id,pair_localCandidateId:null===(jt=null===(Ut=null===(xt=null==G?void 0:G.transport)||void 0===xt?void 0:xt.selectedCandidatePair)||void 0===Ut?void 0:Ut.localCandidate)||void 0===jt?void 0:jt.id,pair_packetsSent:W.sampleseries(null===(Bt=F.audio)||void 0===Bt?void 0:Bt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.packetsSent})),pair_googLocalAddress:null!==(Wt=null===(Gt=null===(Vt=null===(Ht=null==G?void 0:G.transport)||void 0===Ht?void 0:Ht.selectedCandidatePair)||void 0===Vt?void 0:Vt.localCandidate)||void 0===Gt?void 0:Gt.ip)&&void 0!==Wt?Wt:null===(Kt=null===(zt=null===(qt=null==G?void 0:G.transport)||void 0===qt?void 0:qt.selectedCandidatePair)||void 0===zt?void 0:zt.localCandidate)||void 0===Kt?void 0:Kt.address,pair_googRemoteAddress:null!==($t=null===(Yt=null===(Qt=null===(Jt=null==G?void 0:G.transport)||void 0===Jt?void 0:Jt.selectedCandidatePair)||void 0===Qt?void 0:Qt.remoteCandidate)||void 0===Yt?void 0:Yt.ip)&&void 0!==$t?$t:null===(en=null===(Zt=null===(Xt=null==G?void 0:G.transport)||void 0===Xt?void 0:Xt.selectedCandidatePair)||void 0===Zt?void 0:Zt.remoteCandidate)||void 0===en?void 0:en.address,pair_bytesSent:W.sampleseries(null===(tn=F.audio)||void 0===tn?void 0:tn.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesSent})),pair_googReadable:null===(rn=null===(nn=null==G?void 0:G.transport)||void 0===nn?void 0:nn.selectedCandidatePair)||void 0===rn?void 0:rn.nominated})})}B.compileAudioReport=compileAudioReport},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.compileVideoTelemetryReport=void 0;var W=G(1);function compileVideoTelemetryReport(F,B,G,z){var K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Te,Ee,be,Ie,Ae,Re,Pe,Oe,Me,we,De,Ne,Le,ke,Fe,xe,Ue,je,Be,He,Ve,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e,Xe,Ze,et,tt,nt,it,rt,ot,at,st,ct,lt,dt,ut,pt,ht,gt,ft,mt,vt,yt,St,_t,Ct,Tt,Et,bt,It,At,Rt,Pt,Ot,Mt,wt,Dt,Nt,Lt,kt,Ft,xt,Ut,jt,Bt,Ht,Vt,Gt,Wt,qt,zt,Kt,Jt,Qt,Yt,$t,Xt,Zt,en,tn,nn,rn,on,an,sn,cn,ln,dn,un,pn,hn,gn,fn,mn,vn,yn,Sn,_n,Cn,Tn,En,bn,In,An,Rn,Pn,On,Mn;return W.removeUndefinedFields({recv:W.removeUndefinedFields({id:null==G?void 0:G.inboundRTP.id,ssrc:null==G?void 0:G.inboundRTP.ssrc,mediaType:null!==(K=null==G?void 0:G.inboundRTP.mediaType)&&void 0!==K?K:null==G?void 0:G.inboundRTP.kind,bytesReceived:W.sampleseries(null===(J=B[F])||void 0===J?void 0:J.recv,(function(F){return F.inboundRTP.bytesReceived})),packetsReceived:W.sampleseries(null===(Q=B[F])||void 0===Q?void 0:Q.recv,(function(F){return F.inboundRTP.packetsReceived})),packetsLost:W.sampleseries(null===(Y=B[F])||void 0===Y?void 0:Y.recv,(function(F){return F.inboundRTP.packetsLost})),googCodecName:null===($=null==G?void 0:G.codec)||void 0===$?void 0:$.mimeType.split("/")[1],codecImplementationName:null==G?void 0:G.inboundRTP.decoderImplementation,googTrackId:null===(X=null==G?void 0:G.track)||void 0===X?void 0:X.trackIdentifier,transport_id:null===(Z=null==G?void 0:G.transport)||void 0===Z?void 0:Z.id,transportId:null==G?void 0:G.inboundRTP.transportId,transport_selectedCandidatePairId:null===(ee=null==G?void 0:G.transport)||void 0===ee?void 0:ee.selectedCandidatePairId,transport_localCertificateId:null===(te=null==G?void 0:G.transport)||void 0===te?void 0:te.localCertificateId,transport_remoteCertificateId:null===(ne=null==G?void 0:G.transport)||void 0===ne?void 0:ne.remoteCertificateId,transport_dtlsCipher:null===(ie=null==G?void 0:G.transport)||void 0===ie?void 0:ie.dtlsCipher,transport_srtpCipher:null===(re=null==G?void 0:G.transport)||void 0===re?void 0:re.srtpCipher,pair_id:null===(ae=null===(oe=null==G?void 0:G.transport)||void 0===oe?void 0:oe.selectedCandidatePair)||void 0===ae?void 0:ae.id,pair_responsesSent:W.sampleseries(null===(se=B[F])||void 0===se?void 0:se.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesSent})),pair_requestsReceived:W.sampleseries(null===(ce=B[F])||void 0===ce?void 0:ce.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsReceived})),pair_googRemoteCandidateType:null===(ue=null===(de=null===(le=null==G?void 0:G.transport)||void 0===le?void 0:le.selectedCandidatePair)||void 0===de?void 0:de.remoteCandidate)||void 0===ue?void 0:ue.candidateType,pair_consentRequestsSent:W.sampleseries(null===(pe=B[F])||void 0===pe?void 0:pe.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.consentRequestsSent})),pair_googTransportType:null===(fe=null===(ge=null===(he=null==G?void 0:G.transport)||void 0===he?void 0:he.selectedCandidatePair)||void 0===ge?void 0:ge.localCandidate)||void 0===fe?void 0:fe.protocol,pair_googLocalCandidateType:null===(ye=null===(ve=null===(me=null==G?void 0:G.transport)||void 0===me?void 0:me.selectedCandidatePair)||void 0===ve?void 0:ve.localCandidate)||void 0===ye?void 0:ye.candidateType,pair_googWritable:null===(_e=null===(Se=null==G?void 0:G.transport)||void 0===Se?void 0:Se.selectedCandidatePair)||void 0===_e?void 0:_e.writable,pair_requestsSent:W.sampleseries(null===(Ce=B[F])||void 0===Ce?void 0:Ce.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsSent})),pair_googRtt:W.sampleseries(null===(Te=B[F])||void 0===Te?void 0:Te.recv,(function(F){var B,G;return 1e3*(null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(be=null===(Ee=null==G?void 0:G.transport)||void 0===Ee?void 0:Ee.selectedCandidatePair)||void 0===be?void 0:be.nominated,pair_packetsDiscardedOnSend:null===(Ae=null===(Ie=null==G?void 0:G.transport)||void 0===Ie?void 0:Ie.selectedCandidatePair)||void 0===Ae?void 0:Ae.packetsDiscardedOnSend,pair_bytesReceived:W.sampleseries(null===(Re=B[F])||void 0===Re?void 0:Re.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesReceived})),pair_responsesReceived:W.sampleseries(null===(Pe=B[F])||void 0===Pe?void 0:Pe.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesReceived})),pair_remoteCandidateId:null===(we=null===(Me=null===(Oe=null==G?void 0:G.transport)||void 0===Oe?void 0:Oe.selectedCandidatePair)||void 0===Me?void 0:Me.remoteCandidate)||void 0===we?void 0:we.id,pair_localCandidateId:null===(Le=null===(Ne=null===(De=null==G?void 0:G.transport)||void 0===De?void 0:De.selectedCandidatePair)||void 0===Ne?void 0:Ne.localCandidate)||void 0===Le?void 0:Le.id,pair_packetsSent:W.sampleseries(null===(ke=B[F])||void 0===ke?void 0:ke.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.packetsSent})),pair_googLocalAddress:null!==(je=null===(Ue=null===(xe=null===(Fe=null==G?void 0:G.transport)||void 0===Fe?void 0:Fe.selectedCandidatePair)||void 0===xe?void 0:xe.localCandidate)||void 0===Ue?void 0:Ue.ip)&&void 0!==je?je:null===(Ve=null===(He=null===(Be=null==G?void 0:G.transport)||void 0===Be?void 0:Be.selectedCandidatePair)||void 0===He?void 0:He.localCandidate)||void 0===Ve?void 0:Ve.address,pair_googRemoteAddress:null!==(ze=null===(qe=null===(We=null===(Ge=null==G?void 0:G.transport)||void 0===Ge?void 0:Ge.selectedCandidatePair)||void 0===We?void 0:We.remoteCandidate)||void 0===qe?void 0:qe.ip)&&void 0!==ze?ze:null===(Qe=null===(Je=null===(Ke=null==G?void 0:G.transport)||void 0===Ke?void 0:Ke.selectedCandidatePair)||void 0===Je?void 0:Je.remoteCandidate)||void 0===Qe?void 0:Qe.address,pair_bytesSent:W.sampleseries(null===(Ye=B[F])||void 0===Ye?void 0:Ye.recv,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesSent})),pair_googReadable:null===(Xe=null===($e=null==G?void 0:G.transport)||void 0===$e?void 0:$e.selectedCandidatePair)||void 0===Xe?void 0:Xe.nominated,framesDecoded:W.sampleseries(null===(Ze=B[F])||void 0===Ze?void 0:Ze.recv,(function(F){return F.inboundRTP.framesDecoded})),googFrameHeightReceived:W.sampleseries(null===(et=B[F])||void 0===et?void 0:et.recv,(function(F){return F.inboundRTP.frameHeight})),googFrameWidthReceived:W.sampleseries(null===(tt=B[F])||void 0===tt?void 0:tt.recv,(function(F){return F.inboundRTP.frameWidth})),googFrameRateReceived:W.sampleseries(null===(nt=B[F])||void 0===nt?void 0:nt.recv,(function(F){return F.inboundRTP.framesPerSecond})),googNacksSent:W.sampleseries(null===(it=B[F])||void 0===it?void 0:it.recv,(function(F){return F.inboundRTP.nackCount})),googPlisSent:W.sampleseries(null===(rt=B[F])||void 0===rt?void 0:rt.recv,(function(F){return F.inboundRTP.pliCount})),keyFramesDecoded:W.sampleseries(null===(ot=B[F])||void 0===ot?void 0:ot.recv,(function(F){return F.inboundRTP.keyFramesDecoded})),googFirsSent:W.sampleseries(null===(at=B[F])||void 0===at?void 0:at.recv,(function(F){return F.inboundRTP.firCount})),googJitterBufferMs:W.sampleseries(null===(st=B[F])||void 0===st?void 0:st.recv,(function(F){var B;return null===(B=F.extensions)||void 0===B?void 0:B.jitterBufferMs})),googFrameRateDecoded:W.sampleseries(null===(ct=B[F])||void 0===ct?void 0:ct.recv,(function(F){var B;return null===(B=F.extensions)||void 0===B?void 0:B.frameRateDecoded})),googFrameRateOutput:null===(lt=null==G?void 0:G.extensions)||void 0===lt?void 0:lt.trackRecvFps,jitter:null==G?void 0:G.inboundRTP.jitter}),send:W.removeUndefinedFields({id:null==z?void 0:z.outboundRTP.id,ssrc:null==z?void 0:z.outboundRTP.ssrc,mediaType:null!==(dt=null==z?void 0:z.outboundRTP.mediaType)&&void 0!==dt?dt:null==z?void 0:z.outboundRTP.kind,bytesSent:W.sampleseries(null===(ut=B[F])||void 0===ut?void 0:ut.send,(function(F){return F.outboundRTP.bytesSent})),packetsSent:W.sampleseries(null===(pt=B[F])||void 0===pt?void 0:pt.send,(function(F){return F.outboundRTP.packetsSent})),packetsLost:W.sampleseries(null===(ht=B[F])||void 0===ht?void 0:ht.send,(function(F){var B;return null===(B=F.remoteInboundRTP)||void 0===B?void 0:B.packetsLost})),googCodecName:null===(gt=null==z?void 0:z.codec)||void 0===gt?void 0:gt.mimeType.split("/")[1],codecImplementationName:null==z?void 0:z.outboundRTP.encoderImplementation,googTrackId:null===(ft=null==z?void 0:z.track)||void 0===ft?void 0:ft.trackIdentifier,transport_id:null===(mt=null==z?void 0:z.transport)||void 0===mt?void 0:mt.id,transportId:null==z?void 0:z.outboundRTP.transportId,transport_selectedCandidatePairId:null===(vt=null==z?void 0:z.transport)||void 0===vt?void 0:vt.selectedCandidatePairId,transport_localCertificateId:null===(yt=null==z?void 0:z.transport)||void 0===yt?void 0:yt.localCertificateId,transport_remoteCertificateId:null===(St=null==z?void 0:z.transport)||void 0===St?void 0:St.remoteCertificateId,transport_dtlsCipher:null===(_t=null==z?void 0:z.transport)||void 0===_t?void 0:_t.dtlsCipher,transport_srtpCipher:null===(Ct=null==z?void 0:z.transport)||void 0===Ct?void 0:Ct.srtpCipher,pair_id:null===(Et=null===(Tt=null==z?void 0:z.transport)||void 0===Tt?void 0:Tt.selectedCandidatePair)||void 0===Et?void 0:Et.id,pair_responsesSent:W.sampleseries(null===(bt=B[F])||void 0===bt?void 0:bt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesSent})),pair_requestsReceived:W.sampleseries(null===(It=B[F])||void 0===It?void 0:It.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsReceived})),pair_googRemoteCandidateType:null===(Pt=null===(Rt=null===(At=null==z?void 0:z.transport)||void 0===At?void 0:At.selectedCandidatePair)||void 0===Rt?void 0:Rt.remoteCandidate)||void 0===Pt?void 0:Pt.candidateType,pair_consentRequestsSent:W.sampleseries(null===(Ot=B[F])||void 0===Ot?void 0:Ot.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.consentRequestsSent})),pair_googTransportType:null===(Dt=null===(wt=null===(Mt=null==z?void 0:z.transport)||void 0===Mt?void 0:Mt.selectedCandidatePair)||void 0===wt?void 0:wt.localCandidate)||void 0===Dt?void 0:Dt.protocol,pair_googLocalCandidateType:null===(kt=null===(Lt=null===(Nt=null==z?void 0:z.transport)||void 0===Nt?void 0:Nt.selectedCandidatePair)||void 0===Lt?void 0:Lt.localCandidate)||void 0===kt?void 0:kt.candidateType,pair_googWritable:null===(xt=null===(Ft=null==z?void 0:z.transport)||void 0===Ft?void 0:Ft.selectedCandidatePair)||void 0===xt?void 0:xt.writable,pair_requestsSent:W.sampleseries(null===(Ut=B[F])||void 0===Ut?void 0:Ut.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.requestsSent})),pair_googRtt:W.sampleseries(null===(jt=B[F])||void 0===jt?void 0:jt.send,(function(F){var B,G;return 1e3*(null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(Ht=null===(Bt=null==z?void 0:z.transport)||void 0===Bt?void 0:Bt.selectedCandidatePair)||void 0===Ht?void 0:Ht.nominated,pair_packetsDiscardedOnSend:null===(Gt=null===(Vt=null==z?void 0:z.transport)||void 0===Vt?void 0:Vt.selectedCandidatePair)||void 0===Gt?void 0:Gt.packetsDiscardedOnSend,pair_bytesReceived:W.sampleseries(null===(Wt=B[F])||void 0===Wt?void 0:Wt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesReceived})),pair_responsesReceived:W.sampleseries(null===(qt=B[F])||void 0===qt?void 0:qt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.responsesReceived})),pair_remoteCandidateId:null===(Jt=null===(Kt=null===(zt=null==z?void 0:z.transport)||void 0===zt?void 0:zt.selectedCandidatePair)||void 0===Kt?void 0:Kt.remoteCandidate)||void 0===Jt?void 0:Jt.id,pair_localCandidateId:null===($t=null===(Yt=null===(Qt=null==z?void 0:z.transport)||void 0===Qt?void 0:Qt.selectedCandidatePair)||void 0===Yt?void 0:Yt.localCandidate)||void 0===$t?void 0:$t.id,pair_packetsSent:W.sampleseries(null===(Xt=B[F])||void 0===Xt?void 0:Xt.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.packetsSent})),pair_googLocalAddress:null!==(nn=null===(tn=null===(en=null===(Zt=null==z?void 0:z.transport)||void 0===Zt?void 0:Zt.selectedCandidatePair)||void 0===en?void 0:en.localCandidate)||void 0===tn?void 0:tn.ip)&&void 0!==nn?nn:null===(an=null===(on=null===(rn=null==z?void 0:z.transport)||void 0===rn?void 0:rn.selectedCandidatePair)||void 0===on?void 0:on.localCandidate)||void 0===an?void 0:an.address,pair_googRemoteAddress:null!==(dn=null===(ln=null===(cn=null===(sn=null==z?void 0:z.transport)||void 0===sn?void 0:sn.selectedCandidatePair)||void 0===cn?void 0:cn.remoteCandidate)||void 0===ln?void 0:ln.ip)&&void 0!==dn?dn:null===(hn=null===(pn=null===(un=null==z?void 0:z.transport)||void 0===un?void 0:un.selectedCandidatePair)||void 0===pn?void 0:pn.remoteCandidate)||void 0===hn?void 0:hn.address,pair_bytesSent:W.sampleseries(null===(gn=B[F])||void 0===gn?void 0:gn.send,(function(F){var B,G;return null===(G=null===(B=F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.bytesSent})),pair_googReadable:null===(mn=null===(fn=null==z?void 0:z.transport)||void 0===fn?void 0:fn.selectedCandidatePair)||void 0===mn?void 0:mn.nominated,framesEncoded:W.sampleseries(null===(vn=B[F])||void 0===vn?void 0:vn.send,(function(F){return F.outboundRTP.framesEncoded})),googNacksReceived:W.sampleseries(null===(yn=B[F])||void 0===yn?void 0:yn.send,(function(F){return F.outboundRTP.nackCount})),googPlisReceived:W.sampleseries(null===(Sn=B[F])||void 0===Sn?void 0:Sn.send,(function(F){return F.outboundRTP.pliCount})),googFirsReceived:W.sampleseries(null===(_n=B[F])||void 0===_n?void 0:_n.send,(function(F){return F.outboundRTP.firCount})),keyFramesEncoded:W.sampleseries(null===(Cn=B[F])||void 0===Cn?void 0:Cn.send,(function(F){return F.outboundRTP.keyFramesEncoded})),googFrameHeightInput:null===(Tn=null==z?void 0:z.mediaSource)||void 0===Tn?void 0:Tn.height,googFrameWidthInput:null===(En=null==z?void 0:z.mediaSource)||void 0===En?void 0:En.width,googFrameRateInput:W.sampleseries(null===(bn=B[F])||void 0===bn?void 0:bn.send,(function(F){var B;return null===(B=F.mediaSource)||void 0===B?void 0:B.framesPerSecond})),googFrameHeightSent:W.sampleseries(null===(In=B[F])||void 0===In?void 0:In.send,(function(F){return F.outboundRTP.frameHeight})),googFrameWidthSent:W.sampleseries(null===(An=B[F])||void 0===An?void 0:An.send,(function(F){return F.outboundRTP.frameWidth})),googFrameRateSent:W.sampleseries(null===(Rn=B[F])||void 0===Rn?void 0:Rn.send,(function(F){return F.outboundRTP.framesPerSecond})),googRtt:W.sampleseries(null===(Pn=B[F])||void 0===Pn?void 0:Pn.send,(function(F){var B,G;return 1e3*(null!==(G=null===(B=F.remoteInboundRTP)||void 0===B?void 0:B.roundTripTime)&&void 0!==G?G:0)}),!0),hugeFramesSent:null==z?void 0:z.outboundRTP.hugeFramesSent,qpSum:W.sampleseries(null===(On=B[F])||void 0===On?void 0:On.send,(function(F){return F.outboundRTP.qpSum})),qualityLimitationDurations:z?JSON.stringify(null==z?void 0:z.outboundRTP.qualityLimitationDurations):void 0,qualityLimitationReason:null==z?void 0:z.outboundRTP.qualityLimitationReason,qualityLimitationResolutionChanges:null==z?void 0:z.outboundRTP.qualityLimitationResolutionChanges,jitter:null===(Mn=null==z?void 0:z.remoteInboundRTP)||void 0===Mn?void 0:Mn.jitter})})}B.compileVideoTelemetryReport=compileVideoTelemetryReport},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},K=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},J=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0}),B.compileRealtimeTelemetryReport=B.formatVideoStats=void 0;var Q=G(1);function getValue(F,B){var G,W=B.filter((function(F){return void 0!==F}));switch(F){case"Difference":G=W[W.length-1]-W[0];break;case"Average":G=W.reduce((function(F,B){return F+B}),0)/W.length;break;case"LastValue":G=W[W.length-1]}return G||0===G?"".concat("number"==typeof G?+G.toFixed(3):G):void 0}function filterStats(F,B,G){return F.map((function(F){var W;return null===(W=null==F?void 0:F[B])||void 0===W?void 0:W[G]})).filter((function(F){return void 0!==F})).reduce((function(F,B){return F.concat(B)}),[])}function getMediaDirection(F,B){return F&B?"Bidirectional":F?"ReceiveFromPeer":B?"SendToPeer":"Inactive"}function compileAudioReport(F){var B,G,W=filterStats(F,"audio","send"),z=filterStats(F,"audio","recv");if(W.length||z.length)return(0,Q.removeUndefinedFields)({mediaType:"Audio",mediaDirection:getMediaDirection(z.length,W.length),"Received BW estimate":getValue("Average",z.map((function(F){var B,G;return null===(G=null===(B=null==F?void 0:F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableIncomingBitrate}))),"Recv Loss Rate (Avg)":getValue("LastValue",z.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.lossRate}))),"Rtp Packets Received":getValue("Difference",z.map((function(F){var B;return null===(B=null==F?void 0:F.inboundRTP)||void 0===B?void 0:B.packetsReceived}))),"Rtp Packet Sent":getValue("Difference",W.map((function(F){var B;return null===(B=null==F?void 0:F.outboundRTP)||void 0===B?void 0:B.packetsSent}))),"Sent BW estimate":getValue("Average",W.map((function(F){var B,G;return null===(G=null===(B=null==F?void 0:F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableOutgoingBitrate}))),"Send Audio Codec":null===(B=getValue("LastValue",W.map((function(F){var B;return null===(B=null==F?void 0:F.codec)||void 0===B?void 0:B.mimeType}))))||void 0===B?void 0:B.split("/")[1],"Send RTT (Avg)":getValue("LastValue",W.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.rttAvg}))),"Audio NW jitter avg":getValue("LastValue",z.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.jitterMs}))),"Audio send bps":getValue("Difference",W.map((function(F){var B;return null===(B=null==F?void 0:F.outboundRTP)||void 0===B?void 0:B.bytesSent}))),"JB delay (ms)":getValue("LastValue",z.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.jitterBufferDelayMs}))),"Recv Audio Codec":null===(G=getValue("LastValue",z.map((function(F){var B;return null===(B=null==F?void 0:F.codec)||void 0===B?void 0:B.mimeType}))))||void 0===G?void 0:G.split("/")[1]})}function formatVideoStats(F){var B={},formatStats=function(G){F.map((function(F){var B;return null===(B=null==F?void 0:F.video)||void 0===B?void 0:B[G]})).forEach((function(F){null==F||F.forEach((function(F){var W,z,K,J,Q=null===(W=null==F?void 0:F.mediaEntity)||void 0===W?void 0:W.remoteSsrc;null!==(z=B[Q])&&void 0!==z||(B[Q]={}),null!==(K=(J=B[Q])[G])&&void 0!==K||(J[G]=[]),B[Q][G].push(F)}))}))};return formatStats("recv"),formatStats("send"),B}function compileVideoReport(F){var B,G,K=[],J=formatVideoStats(F);try{for(var Y=z(Object.values(J)),$=Y.next();!$.done;$=Y.next()){var X=$.value,Z=X.send,ee=X.recv,te={mediaType:"Camera",mediaDirection:getMediaDirection(null==ee?void 0:ee.length,null==Z?void 0:Z.length)};ee&&(te=W(W({},te),compileVideoRecvReport(ee))),Z&&(te=W(W({},te),compileVideoSendReport(Z))),K.push((0,Q.removeUndefinedFields)(te))}}catch(F){B={error:F}}finally{try{$&&!$.done&&(G=Y.return)&&G.call(Y)}finally{if(B)throw B.error}}return K}function compileVideoSendReport(F){var B;return{"Rtp Packet Sent":getValue("Difference",F.map((function(F){var B;return null===(B=null==F?void 0:F.transport)||void 0===B?void 0:B.packetsSent}))),"Sent BW estimate":getValue("Average",F.map((function(F){var B,G;return null===(G=null===(B=null==F?void 0:F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableOutgoingBitrate}))),"Send Current Bitrate":getValue("Average",F.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.bitrate}))),"Allocated Send Bandwidth Average":getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.bitrateAvg}))),"Send Actual Height":getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.outboundRTP)||void 0===B?void 0:B.frameHeight}))),"Send Actual Width":getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.outboundRTP)||void 0===B?void 0:B.frameWidth}))),"Send Current Frame Rate":getValue("Average",F.map((function(F){var B;return null===(B=null==F?void 0:F.outboundRTP)||void 0===B?void 0:B.framesPerSecond}))),"Send RTT (Avg)":getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.rttAvg}))),"Sent Codec Name":null===(B=getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.codec)||void 0===B?void 0:B.mimeType}))))||void 0===B?void 0:B.split("/")[1]}}function compileVideoRecvReport(F){var B,G=getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.mediaEntity)||void 0===B?void 0:B.xSourceStreamId})));return{"Recv Loss Rate (Avg)":getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.lossRate}))),"Received BW estimate":getValue("Average",F.map((function(F){var B,G;return null===(G=null===(B=null==F?void 0:F.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===G?void 0:G.availableIncomingBitrate}))),"Receive Current Bitrate":getValue("Average",F.map((function(F){var B;return null===(B=null==F?void 0:F.extensions)||void 0===B?void 0:B.bitrate}))),"Rtp Packets Received":getValue("Difference",F.map((function(F){var B;return null===(B=null==F?void 0:F.inboundRTP)||void 0===B?void 0:B.packetsReceived}))),"Receive Actual Height":getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.inboundRTP)||void 0===B?void 0:B.frameHeight}))),"Receive Actual Width":getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.inboundRTP)||void 0===B?void 0:B.frameWidth}))),"Receive Current Frame Rate":getValue("Average",F.map((function(F){var B;return null===(B=null==F?void 0:F.inboundRTP)||void 0===B?void 0:B.framesPerSecond}))),"Received Codec Name":null===(B=getValue("LastValue",F.map((function(F){var B;return null===(B=null==F?void 0:F.codec)||void 0===B?void 0:B.mimeType}))))||void 0===B?void 0:B.split("/")[1],videoSourceId:G?parseInt(G):void 0}}function compileSharingReport(F){var B=filterStats(F,"sharing","send"),G=filterStats(F,"sharing","recv");if(G.length||B.length){var z={mediaType:"AppSharing",mediaDirection:getMediaDirection(G.length,B.length),"Render Device Name":""};return G.length&&(z=W(W({},z),compileVideoRecvReport(G))),B.length&&(z=W(W({},z),compileVideoSendReport(B))),(0,Q.removeUndefinedFields)(z)}}function compileRealtimeTelemetryReport(F){var B,G={channels:[]},W=compileAudioReport(F);W&&G.channels.push(W);var z=compileVideoReport(F);z.length&&(B=G.channels).push.apply(B,J([],K(z),!1));var Q=compileSharingReport(F);return Q&&G.channels.push(Q),G}B.formatVideoStats=formatVideoStats,B.compileRealtimeTelemetryReport=compileRealtimeTelemetryReport},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.compileMediaStatsReportMetrics=B.compileMediaStatsReportExtensions=B.compileMediaStatsReport=void 0;var W=G(1),z=G(1);function convertCodec(F){return null==F?void 0:F.substr(F.indexOf("/")+1).toUpperCase()}function compileAudioSendReport(F){var B,G;return(null!==(G=null===(B=F.audio)||void 0===B?void 0:B.send)&&void 0!==G?G:[]).map((function(B){var G,W,K,J,Q,Y,$,X=F.transports[B.outboundRTP.transportId],Z=null==X?void 0:X.selectedCandidatePair,ee={id:B.outboundRTP.ssrc.toString(),codecName:convertCodec(null===(G=B.codec)||void 0===G?void 0:G.mimeType),bitrate:null===(W=B.extensions)||void 0===W?void 0:W.bitrate,jitter:null===(K=B.remoteInboundRTP)||void 0===K?void 0:K.jitter,packetsPerSecond:null===(J=B.extensions)||void 0===J?void 0:J.packetsPerSecond,packetsLostPerSecond:null===(Q=B.extensions)||void 0===Q?void 0:Q.packetsLostPerSecond,rtt:null===(Y=B.remoteInboundRTP)||void 0===Y?void 0:Y.roundTripTime,pairRtt:null==Z?void 0:Z.currentRoundTripTime,availableBitrate:null==Z?void 0:Z.availableOutgoingBitrate,audioInputLevel:null===($=B.mediaSource)||void 0===$?void 0:$.audioLevel};return(0,z.removeUndefinedFields)(ee)}))}function compileAudioRecvReport(F){var B,G;return(null!==(G=null===(B=F.audio)||void 0===B?void 0:B.recv)&&void 0!==G?G:[]).map((function(B){var G,W,K,J,Q,Y,$,X=F.transports[B.inboundRTP.transportId],Z=null==X?void 0:X.selectedCandidatePair,ee={id:B.inboundRTP.ssrc.toString(),codecName:convertCodec(null===(G=B.codec)||void 0===G?void 0:G.mimeType),bitrate:null===(W=B.extensions)||void 0===W?void 0:W.bitrate,jitterBufferMs:null===(K=B.extensions)||void 0===K?void 0:K.jitterBufferMs,jitter:B.inboundRTP.jitter,packetsPerSecond:null===(J=B.extensions)||void 0===J?void 0:J.packetsPerSecond,packetsLostPerSecond:null===(Q=B.extensions)||void 0===Q?void 0:Q.packetsLostPerSecond,pairRtt:null==Z?void 0:Z.currentRoundTripTime,availableBitrate:null==Z?void 0:Z.availableIncomingBitrate,audioOutputLevel:B.inboundRTP.audioLevel,healedRatio:null===(Y=B.extensions)||void 0===Y?void 0:Y.healedRatio,lossRate:null===($=B.extensions)||void 0===$?void 0:$.lossRate};return(0,z.removeUndefinedFields)(ee)}))}function compileVideoSendReport(F){var B,G;return(null!==(G=null===(B=F.video)||void 0===B?void 0:B.send)&&void 0!==G?G:[]).map((function(B){var G,W,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se=F.transports[B.outboundRTP.transportId],ce=null==se?void 0:se.selectedCandidatePair,le={id:B.outboundRTP.ssrc.toString(),codecName:convertCodec(null===(G=B.codec)||void 0===G?void 0:G.mimeType),bitrate:null===(W=B.extensions)||void 0===W?void 0:W.bitrate,jitter:null===(K=B.remoteInboundRTP)||void 0===K?void 0:K.jitter,packetsPerSecond:null===(J=B.extensions)||void 0===J?void 0:J.packetsPerSecond,packetsLostPerSecond:null===(Q=B.extensions)||void 0===Q?void 0:Q.packetsLostPerSecond,rtt:null===(Y=B.remoteInboundRTP)||void 0===Y?void 0:Y.roundTripTime,pairRtt:null==ce?void 0:ce.currentRoundTripTime,availableBitrate:null==ce?void 0:ce.availableOutgoingBitrate,frameRateInput:null===($=B.mediaSource)||void 0===$?void 0:$.framesPerSecond,frameWidthInput:null===(X=B.mediaSource)||void 0===X?void 0:X.width,frameHeightInput:null===(Z=B.mediaSource)||void 0===Z?void 0:Z.height,frameRateEncoded:null===(ee=B.extensions)||void 0===ee?void 0:ee.frameRateEncoded,frameRateSent:null===(te=B.outboundRTP)||void 0===te?void 0:te.framesPerSecond,frameWidthSent:null===(ne=B.outboundRTP)||void 0===ne?void 0:ne.frameWidth,frameHeightSent:null===(ie=B.outboundRTP)||void 0===ie?void 0:ie.frameHeight,framesSent:null===(re=B.outboundRTP)||void 0===re?void 0:re.framesSent,framesEncoded:null===(oe=B.outboundRTP)||void 0===oe?void 0:oe.framesEncoded,keyFramesEncoded:null===(ae=B.outboundRTP)||void 0===ae?void 0:ae.keyFramesEncoded};return(0,z.removeUndefinedFields)(le)}))}function compileVideoRecvReport(F){var B,G;return(null!==(G=null===(B=F.video)||void 0===B?void 0:B.recv)&&void 0!==G?G:[]).map((function(B){var G,W,K,J,Q,Y,$,X,Z,ee,te=F.transports[B.inboundRTP.transportId],ne=null==te?void 0:te.selectedCandidatePair,ie={id:B.inboundRTP.ssrc.toString(),codecName:convertCodec(null===(G=B.codec)||void 0===G?void 0:G.mimeType),bitrate:null===(W=B.extensions)||void 0===W?void 0:W.bitrate,jitterBufferMs:null===(K=B.extensions)||void 0===K?void 0:K.jitterBufferMs,jitter:B.inboundRTP.jitter,packetsPerSecond:null===(J=B.extensions)||void 0===J?void 0:J.packetsPerSecond,packetsLostPerSecond:null===(Q=B.extensions)||void 0===Q?void 0:Q.packetsLostPerSecond,pairRtt:null==ne?void 0:ne.currentRoundTripTime,availableBitrate:null==ne?void 0:ne.availableIncomingBitrate,msi:null===(Y=B.renderer)||void 0===Y?void 0:Y.msi,frameRateOutput:null===($=B.extensions)||void 0===$?void 0:$.trackRecvFps,frameRateDecoded:null===(X=B.extensions)||void 0===X?void 0:X.frameRateDecoded,frameRateReceived:B.inboundRTP.framesPerSecond,frameWidthReceived:B.inboundRTP.frameWidth,frameHeightReceived:B.inboundRTP.frameHeight,longestFreezeDuration:null===(Z=B.extensions)||void 0===Z?void 0:Z.longestFreeze,totalFreezeDuration:null===(ee=B.extensions)||void 0===ee?void 0:ee.totalFreezeDuration,framesReceived:B.inboundRTP.framesReceived,framesDropped:B.inboundRTP.framesDropped,framesDecoded:B.inboundRTP.framesDecoded,keyFramesDecoded:B.inboundRTP.keyFramesDecoded};return(0,z.removeUndefinedFields)(ie)}))}function compileScreenShareSendReport(F){var B,G;return(null!==(G=null===(B=F.sharing)||void 0===B?void 0:B.send)&&void 0!==G?G:[]).map((function(B){var G,W,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se=F.transports[B.outboundRTP.transportId],ce=null==se?void 0:se.selectedCandidatePair,le={id:B.outboundRTP.ssrc.toString(),codecName:convertCodec(null===(G=B.codec)||void 0===G?void 0:G.mimeType),bitrate:null===(W=B.extensions)||void 0===W?void 0:W.bitrate,jitter:null===(K=B.remoteInboundRTP)||void 0===K?void 0:K.jitter,packetsPerSecond:null===(J=B.extensions)||void 0===J?void 0:J.packetsPerSecond,packetsLostPerSecond:null===(Q=B.extensions)||void 0===Q?void 0:Q.packetsLostPerSecond,rtt:null===(Y=B.remoteInboundRTP)||void 0===Y?void 0:Y.roundTripTime,pairRtt:null==ce?void 0:ce.currentRoundTripTime,availableBitrate:null==ce?void 0:ce.availableOutgoingBitrate,frameRateInput:null===($=B.mediaSource)||void 0===$?void 0:$.framesPerSecond,frameWidthInput:null===(X=B.mediaSource)||void 0===X?void 0:X.width,frameHeightInput:null===(Z=B.mediaSource)||void 0===Z?void 0:Z.height,frameRateEncoded:null===(ee=B.extensions)||void 0===ee?void 0:ee.frameRateEncoded,frameRateSent:null===(te=B.outboundRTP)||void 0===te?void 0:te.framesPerSecond,frameWidthSent:null===(ne=B.outboundRTP)||void 0===ne?void 0:ne.frameWidth,frameHeightSent:null===(ie=B.outboundRTP)||void 0===ie?void 0:ie.frameHeight,framesSent:null===(re=B.outboundRTP)||void 0===re?void 0:re.framesSent,framesEncoded:null===(oe=B.outboundRTP)||void 0===oe?void 0:oe.framesEncoded,keyFramesEncoded:null===(ae=B.outboundRTP)||void 0===ae?void 0:ae.keyFramesEncoded};return(0,z.removeUndefinedFields)(le)}))}function compileScreenShareRecvReport(F){var B,G;return(null!==(G=null===(B=F.sharing)||void 0===B?void 0:B.recv)&&void 0!==G?G:[]).map((function(B){var G,W,K,J,Q,Y,$,X,Z,ee,te=F.transports[B.inboundRTP.transportId],ne=null==te?void 0:te.selectedCandidatePair,ie={id:B.inboundRTP.ssrc.toString(),codecName:convertCodec(null===(G=B.codec)||void 0===G?void 0:G.mimeType),bitrate:null===(W=B.extensions)||void 0===W?void 0:W.bitrate,jitterBufferMs:null===(K=B.extensions)||void 0===K?void 0:K.jitterBufferMs,jitter:B.inboundRTP.jitter,packetsPerSecond:null===(J=B.extensions)||void 0===J?void 0:J.packetsPerSecond,packetsLostPerSecond:null===(Q=B.extensions)||void 0===Q?void 0:Q.packetsLostPerSecond,pairRtt:null==ne?void 0:ne.currentRoundTripTime,availableBitrate:null==ne?void 0:ne.availableIncomingBitrate,msi:null===(Y=B.renderer)||void 0===Y?void 0:Y.msi,frameRateOutput:null===($=B.extensions)||void 0===$?void 0:$.trackRecvFps,frameRateDecoded:null===(X=B.extensions)||void 0===X?void 0:X.frameRateDecoded,frameRateReceived:B.inboundRTP.framesPerSecond,frameWidthReceived:B.inboundRTP.frameWidth,frameHeightReceived:B.inboundRTP.frameHeight,longestFreezeDuration:null===(Z=B.extensions)||void 0===Z?void 0:Z.longestFreeze,totalFreezeDuration:null===(ee=B.extensions)||void 0===ee?void 0:ee.totalFreezeDuration,framesReceived:B.inboundRTP.framesReceived,framesDropped:B.inboundRTP.framesDropped,framesDecoded:B.inboundRTP.framesDecoded,keyFramesDecoded:B.inboundRTP.keyFramesDecoded};return(0,z.removeUndefinedFields)(ie)}))}function compileMediaStatsReport(F){return{audio:{send:compileAudioSendReport(F),recv:compileAudioRecvReport(F)},video:{send:compileVideoSendReport(F),recv:compileVideoRecvReport(F)},screenShare:{send:compileScreenShareSendReport(F),recv:compileScreenShareRecvReport(F)}}}function compileMediaStatsReportExtensions(F,B){var G,z,K=F.qualityManager&&W.limitArraySize(W.deepClone(F.qualityManager.videoMaxCapabilitiesEvents).map((function(G){return W.rebaseTime(W.limitArraySize(G.events,B.config.diagnostics.telemetryLimits.numCapabilitiesApplied,1),"timestamp",F.startTime)})),B.config.diagnostics.telemetryLimits.numCapabilitiesRequested),J=F.qualityManager&&W.limitArraySize(W.deepClone(F.qualityManager.sharingMaxCapabilitiesEvents).map((function(G){return W.rebaseTime(W.limitArraySize(G.events,B.config.diagnostics.telemetryLimits.numCapabilitiesApplied,1),"timestamp",F.startTime)})),B.config.diagnostics.telemetryLimits.numCapabilitiesRequested);return W.removeUndefinedFields({Video_SubscriptionEvents:JSON.stringify(W.rebaseTime(null===(G=F.subscriptionManager)||void 0===G?void 0:G.events.video,"ts",F.startTime)),Sharing_SubscriptionEvents:JSON.stringify(W.rebaseTime(null===(z=F.subscriptionManager)||void 0===z?void 0:z.events.sharing,"ts",F.startTime)),Video_send_MaxCapabilities:JSON.stringify(K),Sharing_send_MaxCapabilities:JSON.stringify(J),RelayCandidate:F.relayCandidate,Video_recv_TimeToFirstFrame:F.remoteVideoManager.firstTimeToFirstFrameVideo,Sharing_recv_TimeToFirstFrame:F.remoteVideoManager.firstTimeToFirstFrameSharing})}function compileMediaStatsReportMetrics(F,B,G){return W.removeUndefinedFields({DeviceEvents:JSON.stringify(W.rebaseTime(G.deviceManager.deviceTelemetryEvents.filter((function(F){return F.timestamp>B})),"timestamp",F.creationTime)),IceConnectedStateTime:1e4*F.iceConnectedStateTime})}B.compileMediaStatsReport=compileMediaStatsReport,B.compileMediaStatsReportExtensions=compileMediaStatsReportExtensions,B.compileMediaStatsReportMetrics=compileMediaStatsReportMetrics},function(F,B,G){var W=this&&this.__read||function(F,B){var G="function"==typeof Symbol&&F[Symbol.iterator];if(!G)return F;var W,z,K=G.call(F),J=[];try{for(;(void 0===B||B-- >0)&&!(W=K.next()).done;)J.push(W.value)}catch(F){z={error:F}}finally{try{W&&!W.done&&(G=K.return)&&G.call(K)}finally{if(z)throw z.error}}return J},z=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var K=function(){function JamaLogger(F,B){this.safe=F,this.unsafe=B,this.safe||(this.safe=this.unsafe)}return JamaLogger.prototype.warn=function(){for(var F,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];(F=this.unsafe).warn.apply(F,z([],W(B),!1))},JamaLogger.prototype.error=function(){for(var F,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];(F=this.unsafe).error.apply(F,z([],W(B),!1))},JamaLogger.prototype.debug=function(){for(var F,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];(F=this.unsafe).debug.apply(F,z([],W(B),!1))},JamaLogger.prototype.info=function(){for(var F,B=[],G=0;G<arguments.length;G++)B[G]=arguments[G];(F=this.unsafe).info.apply(F,z([],W(B),!1))},JamaLogger.prototype.createChild=function(F){return new JamaLogger(this.safe.createChild(F),this.unsafe.createChild(F))},JamaLogger}();B.default=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.PlatformCallConstraintsProvider=void 0;var J=G(6),Q=G(28),isDefined=function(F){return null!=F},getMinDefined=function(F,B){return isDefined(B)?isDefined(F)?Math.min(F,B):B:F},Y=function(F){function PlatformCallConstraintsProvider(B){var G=F.call(this,B)||this;return G.logger=B,G.constraints={},G}return z(PlatformCallConstraintsProvider,F),PlatformCallConstraintsProvider.prototype.setConstraints=function(F){this.logger.debug("Setting new platform call constraints",JSON.stringify(F)),this.constraints=F,this.raiseChanged()},PlatformCallConstraintsProvider.prototype.getSettings=function(F){var B=this.getMaxConstrainedFs(F);return{numVideoChannelsGvc:getMinDefined(F.numVideoChannelsGvc,this.constraints.maxIncomingStreams),webrtcCameraOpenFs:getMinDefined(F.webrtcCameraOpenFs,B),webrtcMaxScalingFs:getMinDefined(F.webrtcMaxScalingFs,B),specCompliantSimulcast:this.getMaxSimulcastLayers(F.specCompliantSimulcast),multiviewResolutionLimits:this.getMaxParticipantResolutions(F.multiviewResolutionLimits)}},PlatformCallConstraintsProvider.prototype.getMaxSimulcastLayers=function(F){var B=this;if(void 0===this.constraints.maxSimulcastLayers&&!F.allowOverride)return F;var constrainedSimulcastConfig=function(F){var G=null==F?void 0:F.layerScaleFactors.filter((function(F){return F<=B.constraints.maxSimulcastLayers})),W=!(null==G?void 0:G.length);return K(K({},F),W?{enableLocally:!1,allowEnableRemotely:!1}:{layerScaleFactors:G})};return K(K({},F),{video:constrainedSimulcastConfig(F.video),sharing:constrainedSimulcastConfig(F.sharing)})},PlatformCallConstraintsProvider.prototype.getMaxParticipantResolutions=function(F){var B=this.constraints.maxParticipantResolutions;if(!B)return F;var G={more:F.more};if(Number.isInteger(B))Object.keys(F).forEach((function(W){G[W]=getMinDefined(B,F[W])}));else{var W=Object.keys(B);if(!W.length)return this.logger.warn("ignoring invalid value provided for maxParticipantResolutions: ".concat(B,"}")),F;W.forEach((function(W){G[W]=getMinDefined(B[W],F[W]||F.more)}))}return G},PlatformCallConstraintsProvider.prototype.getMaxConstrainedFs=function(F){if(isDefined(this.constraints.maxOutgoingResolution))return new Q.default(F.resolutionTableOverride).getResolutionForHeight(this.constraints.maxOutgoingResolution).fs},PlatformCallConstraintsProvider}(J.default);B.PlatformCallConstraintsProvider=Y},function(F,B,G){!function webpackUniversalModuleDefinition(B,W){F.exports=W(G(8))}(window,(function(F){return function(F){var B={};function __webpack_require__(G){if(B[G])return B[G].exports;var W=B[G]={i:G,l:!1,exports:{}};return F[G].call(W.exports,W,W.exports,__webpack_require__),W.l=!0,W.exports}return __webpack_require__.m=F,__webpack_require__.c=B,__webpack_require__.d=function(F,B,G){__webpack_require__.o(F,B)||Object.defineProperty(F,B,{enumerable:!0,get:G})},__webpack_require__.r=function(F){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})},__webpack_require__.t=function(F,B){if(1&B&&(F=__webpack_require__(F)),8&B)return F;if(4&B&&"object"==typeof F&&F&&F.__esModule)return F;var G=Object.create(null);if(__webpack_require__.r(G),Object.defineProperty(G,"default",{enumerable:!0,value:F}),2&B&&"string"!=typeof F)for(var W in F)__webpack_require__.d(G,W,function(B){return F[B]}.bind(null,W));return G},__webpack_require__.n=function(F){var B=F&&F.__esModule?function getDefault(){return F.default}:function getModuleExports(){return F};return __webpack_require__.d(B,"a",B),B},__webpack_require__.o=function(F,B){return Object.prototype.hasOwnProperty.call(F,B)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(F,B,G){F.exports=G(1)},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.ImageRenderer=B.ImageRendererProvider=void 0;var K,J=G(2),Q=G(3),Y=3e4,$="image renderer disposed",X=1;!function(F){F[F.OK=200]="OK",F[F.NoContent=204]="NoContent",F[F.Unauthorized=401]="Unauthorized",F[F.Forbidden=403]="Forbidden",F[F.NotFound=404]="NotFound",F[F.TooManyRequests=429]="TooManyRequests",F[F.InternalServerError=500]="InternalServerError"}(K||(K={}));var Z=function(){function ImageRendererProvider(F){this.config=F,this.logger=this.config.callingLogger.createChild("ImageRenderer")}return ImageRendererProvider.prototype.createRenderer=function(F){return new ee(this.logger,this.config.tokenProvider,this.config.httpRequestDispatcher,this.config.appStateProvider,F)},ImageRendererProvider}();B.ImageRendererProvider=Z;var ee=function(F){function ImageRenderer(B,G,W,z,K){var J=F.call(this)||this;return J.logger=B,J.tokenProvider=G,J.httpRequestDispatcher=W,J.appStateProvider=z,J.options=K,J.frameRateInSeconds=0,J.frameUriIndex=0,J.frameTimeoutId=0,J.sequenceNumber=0,J.started=!1,J.currentQuality=1,J.frameUri=K.frameUris,J.id=K.id,J}return z(ImageRenderer,F),ImageRenderer.prototype.start=function(){return this.started?Promise.reject("ImageRenderer already started"):(this.started=!0,this.event("onRendererStarted").raise(this),this.logger.debug("Image based rendering starting for id: ".concat(this.id)),this.shouldUseBackgroundImage()?this.frameElement=document.createElement("div"):this.frameElement=document.createElement("img"),this.frameElement.classList.add("image-renderer"),this.options.frameContainer.appendChild(this.frameElement),this.renderSafe())},ImageRenderer.prototype.dispose=function(){clearTimeout(this.frameTimeoutId),this.disposeOnlineSubscriptions(),this.getNextFrameResolve&&(this.getNextFrameResolve(),this.getNextFrameResolve=void 0),this.onlineReject&&(this.onlineReject($),this.onlineReject=void 0),this.frameElement&&(this.frameElement.parentNode&&this.frameElement.parentNode.removeChild(this.frameElement),this.frameElement=void 0),this.started=!1,this.event("onRendererDisposed").raise(this)},ImageRenderer.prototype.render=function(F){var B=this;return void 0===F&&(F=(0,J.default)()),this.waitForAppOnline().then((function(){return B.tokenProvider()})).then((function(G){var W={"X-Skypetoken":G,"X-Microsoft-Skype-Chain-ID":B.options.callParams.callId,"X-Microsoft-Skype-Message-ID":F};B.sequenceNumber&&(W["x-ms-sequencenumber"]=B.sequenceNumber.toString());var z=B.httpRequestDispatcher.getRequestOptions("GET",W,"",Y,"blob");return B.sendRequestThrottled(B.frameUri[B.frameUriIndex],z,F).then((function(G){return B.started?B.handleRequestReceived(G,F):Promise.reject($)}))}))},ImageRenderer.prototype.waitForAppOnline=function(){return!this.appStateProvider||this.appStateProvider.isOnline()?Promise.resolve():(this.logger.error("Teams is offline, waiting for network before continuing rendering"),this.onQualityChanged(3),this.getAppOnlinePromise())},ImageRenderer.prototype.getAppOnlinePromise=function(){var F=this;return this.onlinePromise||(this.onlinePromise=new Promise((function(B,G){if(F.onlineReject=G,F.appStateProvider){var W=F.appStateProvider;F.onlineSubscription=W.on("onAppStateChanged",(function(){W.isOnline()&&(B(),F.disposeOnlineSubscriptions())}))}else B()}))),this.onlinePromise},ImageRenderer.prototype.disposeOnlineSubscriptions=function(){this.onlineSubscription&&(this.onlineSubscription.dispose(),this.onlineSubscription=void 0),this.onlinePromise&&(this.onlinePromise=void 0)},ImageRenderer.prototype.handleRequestReceived=function(F,B){var G,W=this;if(!F||!F.status)return this.logger.warn("Received empty XHR, retrying. MessageId: ".concat(B)),this.render();switch(this.frameRateInSeconds=this.frameRateInSeconds||X,F.status){case K.OK:return this.handleFrameReceived(F,B).then((function(){W.renderSafe().catch((function(){}))})).catch((function(F){return W.render()}));case K.NoContent:break;case K.Unauthorized:case K.Forbidden:return this.onQualityChanged(3),Promise.reject("Request not authorized, status: ".concat(F.status));case K.NotFound:return this.onQualityChanged(3),Promise.reject("Meeting/session was not found, status: 404");case K.TooManyRequests:if(this.onQualityChanged(3),G=F.getResponseHeader("retry-after")){var z=parseInt(G,10);z&&(this.frameRateInSeconds=z)}break;default:if(F.status>=K.InternalServerError){if(this.frameUriIndex++,this.sequenceNumber=0,this.logger.error("Received internal server error ".concat(F.status,", switching to next frameUrl. MessageId: ").concat(B)),this.frameUriIndex===this.frameUri.length)return this.onQualityChanged(3),Promise.reject("No more available frameUris")}else this.logger.error("Received invalid error ".concat(F.status,", retrying. MessageId: ").concat(B))}return this.render()},ImageRenderer.prototype.renderSafe=function(){var F=this,B=(0,J.default)();return this.render(B).catch((function(G){return F.logger.error("Getting frame failed with terminal error: ".concat(JSON.stringify(G),". MessageId: ").concat(B)),F.dispose(),Promise.reject(G)}))},ImageRenderer.prototype.handleFrameReceived=function(F,B){var G=F.getResponseHeader("x-ms-sequencenumber");if(!G)return this.logger.warn("sequenceNumberHeader not present. MessageId: ".concat(B)),this.onQualityChanged(3),this.renderFrame(F.response);var W=parseInt(G,10);if(W&&W>this.sequenceNumber)return this.logger.debug("Received frame number: ".concat(W,". MessageId: ").concat(B)),this.sequenceNumber=W,this.onQualityChanged(1),this.renderFrame(F.response,B);if(W&&W===this.sequenceNumber)return Promise.resolve();var z="Received out of sequence frame: ".concat(W," current sequence: ").concat(this.sequenceNumber,". MessageId: ").concat(B);return this.logger.error(z),this.onQualityChanged(3),Promise.reject(z)},ImageRenderer.prototype.renderFrame=function(F,B){var G=this;return new Promise((function(W,z){var K=new FileReader;K.readAsDataURL(F),K.onloadend=function(){return G.frameElement?(G.shouldUseBackgroundImage()?G.frameElement.style.backgroundImage="url('".concat(K.result,"')"):G.frameElement.src=K.result,W()):z("No frameElement found. MessageId: ".concat(B))},K.onerror=function(F){var W="Failed rendering received image: ".concat(F,". MessageId: ").concat(B);return G.logger.error(W),z(W)}}))},ImageRenderer.prototype.sendRequestThrottled=function(F,B,G){var W=this;return this.started?new Promise((function(z){W.getNextFrameResolve=z,W.frameTimeoutId=window.setTimeout((function(){var K=W.httpRequestDispatcher.getAsync(F,B).then((function(F){return F.request})).catch((function(F){return W.logger.error("Getting frame failed with error: ".concat(JSON.stringify(F),", attempting recovery. MessageId: ").concat(G)),F?F.request:{}}));z(K)}),1e3*W.frameRateInSeconds)})):Promise.reject($)},ImageRenderer.prototype.shouldUseBackgroundImage=function(){return-1!==navigator.userAgent.indexOf("Trident")},ImageRenderer.prototype.onQualityChanged=function(F){if(this.currentQuality!==F){this.currentQuality=F;var B=this.options.callParams.imageRenderingEventCallbacks;B&&B.onImageRenderingQualityChanged&&B.onImageRenderingQualityChanged({type:51,value:F,isLocalSource:!1,mediaType:2})}},ImageRenderer}(Q.default);B.ImageRenderer=ee},function(F,B,G){function generateGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(F){var B=16*Math.random()|0;return("x"===F?B:3&B|8).toString(16)}))}Object.defineProperty(B,"__esModule",{value:!0}),B.default=generateGuid},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__spreadArray||function(F,B,G){if(G||2===arguments.length)for(var W,z=0,K=B.length;z<K;z++)!W&&z in B||(W||(W=Array.prototype.slice.call(B,0,z)),W[z]=B[z]);return F.concat(W||Array.prototype.slice.call(B))};Object.defineProperty(B,"__esModule",{value:!0});var J=function(F){function ObservableBase(B){return F.call(this,B)||this}return z(ObservableBase,F),ObservableBase.prototype.changed=function(F,B){return this.subscribe({changed:{skipEventConfig:B,handler:F},on:void 0})},ObservableBase.prototype.on=function(F,B){return this.subscribe({changed:void 0,on:{name:String(F),handler:this._toEventCallback(B)}})},ObservableBase.prototype.once=function(F,B,G){var W,z=this,onceSubscription=function(){for(var F=[],K=0;K<arguments.length;K++)F[K]=arguments[K];W.dispose(G),z._toEventCallback(B).apply(void 0,F)};return W=this.on(F,this._fromEventCallback(onceSubscription))},ObservableBase.prototype.raiseChanged=function(F){var B=this;this.raiseEvents((function(G){if(G.changed){var W=G.changed,z=W.skipEventConfig,K=W.handler;!B.getShouldSkipChangedEvent(F,z)&&K()}}))},ObservableBase.prototype.event=function(F){var B=this;return{raise:this._fromEventCallback((function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];return B._raiseEventImpl.apply(B,K([String(F)],G,!1))}))}},ObservableBase.prototype._raiseEventImpl=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];this.raiseEvents((function(G){var W;return G.on&&G.on.name===F&&(W=G.on).handler.apply(W,B)}))},ObservableBase.prototype._toEventCallback=function(F){return F},ObservableBase.prototype._fromEventCallback=function(F){return F},ObservableBase.prototype.getShouldSkipChangedEvent=function(F,B){return(null==F?void 0:F.skipDominantSpeakerUpdatesOnCall)?!!(null==B?void 0:B.skipDominantSpeakerUpdatesOnCall):!!(null==F?void 0:F.skipParticipantsUpdatesOnCall)&&!!(null==B?void 0:B.skipParticipantsUpdatesOnCall)},ObservableBase}(G(4).EventSourceImpl);B.default=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.EventSourceImpl=void 0;var W=G(5),z=G(6),K=function(){function EventSourceImpl(F){this.eventLogger=F,this.subscriptions=[]}return EventSourceImpl.prototype.subscribe=function(F){return new J(this.subscriptions,F)},EventSourceImpl.prototype.dispose=function(F){this.subscriptions=[]},EventSourceImpl.prototype.raiseEvents=function(F){var B=this;this.subscriptions.slice().forEach((function(G){try{void 0!==G.eventHandler&&F(G.eventHandler)}catch(F){B.eventLogger&&B.eventLogger.warn&&B.eventLogger.warn("Event handler exception caught!",(0,z.stringifyObject)(F))}}))},EventSourceImpl}();B.EventSourceImpl=K;var J=function(){function EventSubscriptionImpl(F,B){this.subscriptions=F,this.eventHandler=B,this.subscriptions.push(this)}return EventSubscriptionImpl.prototype.dispose=function(){var F=this;W.remove(this.subscriptions,(function(B){return B===F})),this.eventHandler=void 0},EventSubscriptionImpl}()},function(B,G){B.exports=F},function(F,B,G){function getRandomizedTimeout(F){var B=Math.floor(11*Math.random())+10;return Math.floor(F*(1-B/100))}function isStringBase64(F){if(!F)return!1;try{return atob(F),!0}catch(F){return!1}}function isPromiseLike(F){return!!F&&"function"==typeof F.then}function stringifyObject(F){if(!F)return"".concat(F);if(F instanceof Map)return mapToString(F);var B=F.toString();return B.endsWith("[object Object]")?JSON.stringify(F):B}function mapToString(F){var B={};return F.forEach((function(F,G){B[G.toString()]=F})),JSON.stringify(B)}function stringToBuffer(F){for(var B=new ArrayBuffer(F.length),G=new Uint8Array(B),W=0;W<F.length;W++)G[W]=F.charCodeAt(W);return G}Object.defineProperty(B,"__esModule",{value:!0}),B.stringToBuffer=B.stringifyObject=B.isPromiseLike=B.isStringBase64=B.getRandomizedTimeout=void 0,B.getRandomizedTimeout=getRandomizedTimeout,B.isStringBase64=isStringBase64,B.isPromiseLike=isPromiseLike,B.stringifyObject=stringifyObject,B.stringToBuffer=stringToBuffer}])}))},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.LiveStreamClient=void 0;var K=G(471),J=G(477),Q=function(){function LiveStreamClient(F,B,G){this.ecsConfig=F,this.logger=B,this.getTelemetryLogger=G}return LiveStreamClient.prototype.configure=function(F){this.configuration=F},LiveStreamClient.prototype.initialize=function(){return W(this,void 0,void 0,(function(){var F,B,G,W,K;return z(this,(function(z){F="MDN_MIDDLELANE_TEAMS",B="liveStream",G=this.ecsConfig.getString(F,B),W={};try{W=JSON.parse(G)}catch(G){this.logger.warn("failed to parse ECS configuration for ".concat(F,"/").concat(B))}return K=this.ecsConfig.getString("ConfigIDs",F),this._configProvider=new J.LiveStreamConfigProvider(W,this.configuration,K,this.logger.createChild("LiveStreamConfigProvider")),[2]}))}))},LiveStreamClient.prototype.createLiveStream=function(){return new K.LiveStream(this._configProvider,this.logger.createChild("LiveStream"),this.getTelemetryLogger)},LiveStreamClient.prototype.dispose=function(F){},LiveStreamClient}();B.LiveStreamClient=Q},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},Q=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.LiveStream=void 0;var Y=G(15),$=G(117),X=G(472),Z=G(476),ee=function(F){function LiveStream(B,G,W){var z=F.call(this)||this;return z.configProvider=B,z.logger=G,z.getTelemetryLogger=W,z.isAvailable=!0,z._isStreaming=!1,z.playerSubs=[],z.isFinalTelemetrySent=!1,z.initializeTelemetry(),1===z.configProvider.playerConfig.playerType?z.player=new Z.HlsLiveStreamPlayer(z.logger.createChild("HlsLiveStreamPlayer"),z.liveStreamStatistic,z.configProvider):z.player=new X.AmpLiveStreamPlayer(z.logger.createChild("AmpLiveStreamPlayer"),z.liveStreamStatistic,z.configProvider),z.subscribeForPlayerEvents(),z}return z(LiveStream,F),Object.defineProperty(LiveStream.prototype,"isStreaming",{get:function(){return this._isStreaming},enumerable:!1,configurable:!0}),LiveStream.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},LiveStream.prototype.start=function(F,B){return K(this,void 0,void 0,(function(){var G,W=this;return J(this,(function(z){switch(z.label){case 0:return[4,this.setOptions(B)];case 1:return z.sent(),this.isFinalTelemetrySent=!1,this.telemetryLogger=this.getTelemetryLogger(),[4,this.player.loadPlayer(F)];case 2:if(!(G=z.sent()).setupSucceeded)throw this.player.stop(),this.logger.error("playerLoadFailed"),this.sendTelemetry(),new Error(JSON.stringify(G.playerSetupError));return this._isStreaming=!0,this.statsSub=window.setTimeout((function(){clearTimeout(W.statsSub),W.logger.debug("initial telemetry report after ".concat(W.configProvider.config.sendInitialTelemetryAfterMs," ms")),W.sendTelemetry()}),this.configProvider.config.sendInitialTelemetryAfterMs),[2,this.player.getRenderer()]}}))}))},LiveStream.prototype.initializeTelemetry=function(){if(0===this.configProvider.playerConfig.playerType){var F={perceivedBandwidth:[],videoBufferLength:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowWidth:[],windowHeight:[],currentPlayPosition:[],currentMediaTime:[],statsInterval:[]};this.liveStreamStatistic=new $.LiveStreamStatistic(this.configProvider.config,this.logger.createChild("LiveStreamStatistic"),F)}else{F={perceivedBandwidth:[],videoBufferLength:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowWidth:[],windowHeight:[],currentPlayPosition:[],currentMediaTime:[],statsInterval:[]};this.liveStreamStatistic=new $.LiveStreamStatistic(this.configProvider.config,this.logger.createChild("LiveStreamStatistic"),F)}},LiveStream.prototype.stop=function(){return K(this,void 0,void 0,(function(){return J(this,(function(F){return[2]}))}))},LiveStream.prototype.setOptions=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this.options=F,[2,this.player.configure(F)]}))}))},LiveStream.prototype.getStats=function(){return this.liveStreamStatistic.getPlayerDiagnosticSnapshot()},LiveStream.prototype.dispose=function(){this.unsubscribeFromPlayerEvents(),this.player.stop(),clearTimeout(this.statsSub),this.logger.debug("stopping live event"),this.sendFinalTelemetry(),F.prototype.dispose.call(this)},LiveStream.prototype.sendFinalTelemetry=function(){this.isFinalTelemetrySent||(this.isFinalTelemetrySent=!0,this.sendTelemetry(!0))},LiveStream.prototype.sendTelemetry=function(F){if(this.configProvider.config.sendTelemetry&&this.telemetryLogger){var B={configIds:this.configProvider.configIds,correlationId:this.options&&this.options.correlationId,eTag:this.configProvider.etag,isFinal:F,overflow:this.options&&this.options.overflow,threadId:this.options&&this.options.threadId,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton},G=this.liveStreamStatistic.getReport(B);this.logger.debug("generated live stream report",G),this.telemetryLogger.sendEvent({eventName:"live_events",props:G})}else this.logger.info("telemetry not sent")},LiveStream.prototype.subscribeForPlayerEvents=function(){var F=this;this.playerSubs.push(this.player.on("playbackStateChanged",(function(){F.onPlaybackStateChanged()}))),this.playerSubs.push(this.player.on("playbackError",(function(B,G){F.onPlaybackError(B,G)}))),this.playerSubs.push(this.player.on("urlSwitched",(function(B){F.onUrlSwitched(B)}))),this.playerSubs.push(this.player.on("sdnPluginLoadFailed",(function(B){F.onSdnPluginLoadFailed(B)})))},LiveStream.prototype.unsubscribeFromPlayerEvents=function(){var F,B;try{for(var G=Q(this.playerSubs),W=G.next();!W.done;W=G.next()){W.value.dispose()}}catch(B){F={error:B}}finally{try{W&&!W.done&&(B=G.return)&&B.call(G)}finally{if(F)throw F.error}}this.playerSubs=[]},LiveStream.prototype.onPlaybackStateChanged=function(){var F=this.player.getPlaybackState();switch(F){case"Start":this.event("playbackStarted").raise();break;case"Ended":this.event("playbackNotLive").raise(),this.sendFinalTelemetry();break;case"Seeked":this.event("playbackSeeked").raise(this.player.getCaptionsTimestamp());break;default:this.logger.debug("playbackStateChanged: ".concat(F))}this.event("playbackStateChanged").raise(this.player.getPlaybackState())},LiveStream.prototype.onPlaybackError=function(F,B){this.event("error").raise(F,B)},LiveStream.prototype.onUrlSwitched=function(F){this.event("urlSwitched").raise(F)},LiveStream.prototype.onSdnPluginLoadFailed=function(F){this.event("sdnPluginLoadFailed").raise(F)},LiveStream}(Y.default);B.LiveStream=ee},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.AmpLiveStreamPlayer=void 0;var Q=G(8),Y=G(15),$=G(26),X=G(168),Z=G(169),ee=G(77),te=G(170),ne=[2097152,2097552,2097556,2097557,2097564,2097652,2097654,2097655,2097656,2097752,3145728,4194305,4194306,4194307,4194308,4194309,5242880,5242881,5242882,5242884,5242885,5242886],ie=2097753,re=function(F){function AmpLiveStreamPlayer(B,G,W){var z=F.call(this)||this;return z.logger=B,z.liveStreamStatistic=G,z.configProvider=W,z.playerState="Destroyed",z.retryCount=0,z.captionsTimestamp=0,z.isSwitchStreamingUrlOngoing=!1,z.streamingUrlSwitchCount=0,z.isPlaybackUnsupported=!1,z}return z(AmpLiveStreamPlayer,F),AmpLiveStreamPlayer.prototype.configure=function(F){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:return ee.isStreamValid(F.stream)||ee.isStreamValid(F.altStream)?(this.logger.info("Live Stream configuration provided"),this.liveStreamOptions=F,B=ee.isStreamValid(F.stream)?F.stream:F.altStream,!this.playerInstance||this.isPlaybackUnsupported?(this.selectedStreamDetails=B,[2]):[4,this.handleStreamInfoUpdate(B)]):(this.logger.error("Invalid Live Stream configuration provided: no valid primary or alternative stream"),[2]);case 1:return G.sent(),[2]}}))}))},AmpLiveStreamPlayer.prototype.loadPlayer=function(F){return K(this,void 0,void 0,(function(){var B,G,W,z,K=this;return J(this,(function(J){switch(J.label){case 0:return this.playerInstance?(this.logger.error("playerLoadFailed: cannot load a player while current one is still active"),[2,{setupSucceeded:!1,playerSetupError:{errorType:"MultiplePlayerLoad",errorMessage:"cannot load a player while current one is still active"}}]):this.liveStreamOptions&&this.selectedStreamDetails&&ee.isStreamValid(this.selectedStreamDetails)?(this.playerInstance=new X.PlayerWrapper(this.logger),this.playerInstance.on("stateChanged",(function(F,B){return K.ampStateChanged(F,B)})),this.playerInstance.on("captionsToggled",(function(F,B,G){return K.captionsToggled(F,B,G)})),this.playerInstance.on("statsUpdated",(function(F){return K.liveStreamStatistic.registerStatsUpdated(F)})),[4,this.playerInstance.initialize(F,this.liveStreamOptions,this.configProvider,0)]):(this.logger.error("playerLoadFailed: empty/invalid primary and alternate stream info configured"),[2,{setupSucceeded:!1,playerSetupError:{errorType:"InvalidStream",errorMessage:"empty/invalid primary and alternate stream info configured"}}]);case 1:J.sent(),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.srcLoadPromise||(this.srcLoadPromise=this.playerInstance.message("loadPlayerScript").send()),J.label=2;case 2:return J.trys.push([2,4,,5]),[4,this.srcLoadPromise];case 3:return J.sent(),[3,5];case 4:return B=J.sent(),z=(0,$.stringifyObject)(B),this.logger.error("playerLoadFailed: player scripts load failed: ".concat(z)),this.liveStreamStatistic.registerPlayerLoadFailed("player scripts load failed"),this.srcLoadPromise=null,[2,{setupSucceeded:!1,playerSetupError:{errorType:"PlayerScriptLoadFailed",errorMessage:z}}];case 5:return[4,this.tryLoadSdnPlugin()];case 6:J.sent(),J.label=7;case 7:return J.trys.push([7,9,,10]),[4,this.playerInstance.message("createAmp").send()];case 8:return J.sent(),[3,10];case 9:return G=J.sent(),z=(0,$.stringifyObject)(G),this.logger.error("playerLoadFailed: createAmp failed: ".concat(z)),this.liveStreamStatistic.registerPlayerLoadFailed("playerLoadFailed ".concat(z)),[2,{setupSucceeded:!1,playerSetupError:{errorType:"PlayerInitializationFailed",errorMessage:z}}];case 10:return J.trys.push([10,12,,13]),[4,this.setPlayerSource(this.selectedStreamDetails)];case 11:return J.sent(),this.loadSucceeded=!0,this.logger.info("loadPlayer succeeded: ".concat(this.loadSucceeded)),this.liveStreamStatistic.registerPlayerLoadSucceeded(),this.playerState="Initialized",[2,{setupSucceeded:this.loadSucceeded}];case 12:return W=J.sent(),z=(0,$.stringifyObject)(W),this.loadSucceeded=!1,this.logger.error("loadPlayer succeeded: ".concat(this.loadSucceeded,": setSource failed: ").concat(z)),this.liveStreamStatistic.registerPlayerLoadFailed("setPlayerSource failed"),[2,{setupSucceeded:this.loadSucceeded,playerSetupError:{errorType:"SetSourceFailed",errorMessage:z}}];case 13:return[2]}}))}))},AmpLiveStreamPlayer.prototype.getRenderer=function(){return!this.renderer&&this.playerInstance&&(this.renderer=new Z.LiveStreamRenderer(this,this.logger.createChild("LiveStreamRenderer"))),this.renderer},AmpLiveStreamPlayer.prototype.stop=function(){this.destroy()},AmpLiveStreamPlayer.prototype.getPlaybackState=function(){return this.playerState},AmpLiveStreamPlayer.prototype.getCaptionsTimestamp=function(){return this.captionsTimestamp},AmpLiveStreamPlayer.prototype.getCaptionsControl=function(){if(!this.captionsControl&&this.playerInstance){var F=this.liveStreamOptions.supportedSubtitleLanguages?this.liveStreamOptions.supportedSubtitleLanguages.map((function(F){return F.culture})):[];this.captionsControl=new te.CaptionsControl(this.playerInstance,F)}return this.captionsControl},AmpLiveStreamPlayer.prototype.getStreamSize=function(){var F=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return F?{width:F.mediaWidth,height:F.mediaHeight}:{width:0,height:0}},AmpLiveStreamPlayer.prototype.isRendering=function(){var F=this.getStreamSize();return F.width>0&&F.height>0},AmpLiveStreamPlayer.prototype.ampStateChanged=function(F,B){switch(F){case"error":return this.handlePlaybackError(B);case"canplaythrough":return this.onCanplaythrough();case"play":return this.onPlay();case"playing":return this.onPlaying();case"pause":return this.onPause();case"resume":return this.onResume();case"start":return this.onStart();case"ended":return this.onEnded();case"seeking":return this.onSeeking();case"seeked":return this.onSeeked(B);case"loadedmetadata":return this.onMetadataLoaded();case"waiting":return this.onWaiting();case"playbackbitratechanged":return this.onPlaybackBitrateChanged(B);case"downloadbitratechanged":return this.onDownloadBitrateChanged(B);case"fullscreenchange":return this.onFullscreenChange(B);case"potentialMediaFreeze":return this.onPotentialMediaFreeze();case"mute":return this.onMute();case"unmute":return this.onUnmute();case"volumechange":return this.onVolumeChange(B);case"loadstart":return this.onLoadStart();case"loadeddata":return this.onLoadedData();default:this.logger.warn("Unknown amp event ".concat(F))}},AmpLiveStreamPlayer.prototype.captionsToggled=function(F,B,G){this.event("captionsToggled").raise(F,B,G),this.liveStreamStatistic.registerCaptionToggle(F,B,G)},AmpLiveStreamPlayer.prototype.tryLoadSdnPlugin=function(){return K(this,void 0,void 0,(function(){var F,B;return J(this,(function(G){switch(G.label){case 0:if(this.sdnPluginLoadPromise||!this.liveStreamOptions.sdn||!this.configProvider.config.allowSdnPlugins)return[2];switch(this.liveStreamOptions.sdn.name){case"hive":case"kollective":case"ramp":case"peer5":break;default:return this.logger.warn("unsupported SDN provider: ".concat(this.liveStreamOptions.sdn.name)),this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!1),[2]}G.label=1;case 1:return G.trys.push([1,3,,4]),this.sdnPluginLoadPromise=this.playerInstance.message("tryLoadSdnPlugin").send(),[4,this.sdnPluginLoadPromise];case 2:return G.sent(),[3,4];case 3:return F=G.sent(),B=(0,$.stringifyObject)(F),this.sdnPluginLoadPromise=void 0,this.logger.error("loadSdnPlugin failed: ".concat(B)),this.event("sdnPluginLoadFailed").raise(B),[3,4];case 4:return this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!!this.sdnPluginLoadPromise),[2]}}))}))},AmpLiveStreamPlayer.prototype.setPlayerSource=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:if(!this.playerInstance)throw this.logger.error("setPlayerSource: playerInstance is null"),new Error("playerInstance is null");this.logger.info("setPlayerSource: AMP source set to: [".concat(F.url,"]")),this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,W.label=1;case 1:return W.trys.push([1,3,,4]),this.logger.info("setPlayerSource: src changed"),this.selectedStreamDetails=F,this.liveStreamStatistic.registerSetSourceAttempt(),[4,this.playerInstance.message("setSource").send(F)];case 2:return W.sent(),this.liveStreamStatistic.registerSetSourceSucceeded(),[3,4];case 3:throw B=W.sent(),G=(0,$.stringifyObject)(B),this.logger.error("setPlayerSource: failed with error [".concat(G,"]")),this.liveStreamStatistic.registerSetSourcedFailed(G),B;case 4:return[2]}}))}))},AmpLiveStreamPlayer.prototype.handleStreamInfoUpdate=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){switch(B.label){case 0:return this.loadSucceeded&&F.url!==this.selectedStreamDetails.url?[4,this.setPlayerSource(F)]:[3,2];case 1:return B.sent(),[3,3];case 2:this.loadSucceeded&&this.playerInstance&&this.getCurrentTime()>0&&this.setPlaybackState("Start"),B.label=3;case 3:return[2]}}))}))},AmpLiveStreamPlayer.prototype.switchStreamingUrl=function(F){return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){return this.streamingUrlSwitchCount>=this.configProvider.config.streamingUrlSwitchMaxCount||!Q.includes(this.configProvider.config.ampErrorCodesEligibleForStreamingUrlSwitch,F)?[2,!1]:(B=this.selectedStreamDetails.url===(this.liveStreamOptions.stream&&this.liveStreamOptions.stream.url),G=B?this.liveStreamOptions.altStream:this.liveStreamOptions.stream,ee.isStreamValid(G)?(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,[2,this.setPlayerSource(G).then((function(){return!0})).catch((function(){return!1}))]):(this.logger.error("Stream to switch (".concat(B?"alternative":"primary",") is not valid")),[2,!1]))}))}))},AmpLiveStreamPlayer.prototype.destroy=function(){this.srcLoadPromise=null,this.sdnPluginLoadPromise=null,this.renderer&&(this.renderer.dispose(),this.renderer=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.liveStreamStatistic.registerPlayerDestroyed(),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState("Destroyed"))},AmpLiveStreamPlayer.prototype.getCurrentTime=function(){var F=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return F&&F.currentPlayPosition||0},AmpLiveStreamPlayer.prototype.onCanplaythrough=function(){this.setPlaybackState("Ready")},AmpLiveStreamPlayer.prototype.onPlay=function(){(this.retryCount>0||this.lastKnownPlayTime)&&(this.logger.info("Playing after retry count ".concat(this.retryCount,", Setting current time to ").concat(this.lastKnownPlayTime)),this.playerInstance.message("setPlayTime").send(this.lastKnownPlayTime),this.retryCount=0,this.lastKnownPlayTime=void 0),this.setPlaybackState("Play")},AmpLiveStreamPlayer.prototype.onPlaying=function(){this.setPlaybackState("Playing")},AmpLiveStreamPlayer.prototype.onPause=function(){this.setPlaybackState("Paused")},AmpLiveStreamPlayer.prototype.onResume=function(){this.setPlaybackState("Resume")},AmpLiveStreamPlayer.prototype.onStart=function(){this.logger.info("Playback started, retry count: ".concat(this.retryCount)),this.setPlaybackState("Start"),this.isSwitchStreamingUrlOngoing&&(this.logger.info("Playback started, switch count: ".concat(this.streamingUrlSwitchCount)),this.event("urlSwitched").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)},AmpLiveStreamPlayer.prototype.onEnded=function(){this.setPlaybackState("Ended")},AmpLiveStreamPlayer.prototype.onSeeking=function(){this.setPlaybackState("Seeking")},AmpLiveStreamPlayer.prototype.onSeeked=function(F){this.captionsTimestamp=F.captionsTimestamp,this.setPlaybackState("Seeked")},AmpLiveStreamPlayer.prototype.onMetadataLoaded=function(){this.setPlaybackState("LoadedMetadata")},AmpLiveStreamPlayer.prototype.onWaiting=function(){this.setPlaybackState("Buffering")},AmpLiveStreamPlayer.prototype.onLoadedData=function(){this.setPlaybackState("LoadedData")},AmpLiveStreamPlayer.prototype.onLoadStart=function(){this.setPlaybackState("LoadStart")},AmpLiveStreamPlayer.prototype.setPlaybackState=function(F){this.playerState=F,this.logger.debug("playback state changed: ".concat(F)),this.liveStreamStatistic.registerPlaybackStateChanged(F),this.event("playbackStateChanged").raise()},AmpLiveStreamPlayer.prototype.onPlaybackBitrateChanged=function(F){this.liveStreamStatistic.registerPlaybackBitratechanged(F.bitrate)},AmpLiveStreamPlayer.prototype.onDownloadBitrateChanged=function(F){this.liveStreamStatistic.registerDownloadBitratechanged(F.bitrate)},AmpLiveStreamPlayer.prototype.onFullscreenChange=function(F){this.logger.debug("fullscreenchange, isFullscreen=".concat(F.isFullscreen)),this.event("fullscreenToggled").raise(F.isFullscreen),this.liveStreamStatistic.registerFullScreenChange(F.isFullscreen)},AmpLiveStreamPlayer.prototype.onPotentialMediaFreeze=function(){this.logger.warn("Player detected a potential media freeze"),this.liveStreamStatistic.registerPotentialMediaFreeze()},AmpLiveStreamPlayer.prototype.onMute=function(){this.liveStreamStatistic.registerMute(!0)},AmpLiveStreamPlayer.prototype.onUnmute=function(){this.liveStreamStatistic.registerMute(!1)},AmpLiveStreamPlayer.prototype.onVolumeChange=function(F){this.liveStreamStatistic.registerVolumeChange(F.value)},AmpLiveStreamPlayer.prototype.stringifyPlayerError=function(F){return JSON.stringify(F,(function(F,B){return"errorCode"===F?B.toString(16):B}))},AmpLiveStreamPlayer.prototype.handlePlaybackError=function(F){return K(this,void 0,void 0,(function(){var B,G,W,z,K=this;return J(this,(function(J){switch(J.label){case 0:return B=4194307,this.playerState="Error",G=this.stringifyPlayerError(F),this.logger.info("Playback error ".concat(G)),F.errorCode?(F.errorCode&B)===B?(this.isPlaybackUnsupported=!0,this.raisePlaybackError("UnsupportedPlatform",G),this.destroy(),[2]):(this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,W=F.errorCode,z=268435455&W,this.logger.error("onError: errorCode: 0x".concat(W.toString(16),", errorCodeExcludingTech: 0x").concat(z.toString(16),", message: ").concat(F.message)),this.retryCount<this.configProvider.config.maxRetryCount&&-1!==Q.indexOf(ne,z)?(setTimeout((function(){K.logger.info("Retry loading stream because of error code: 0x".concat(W.toString(16))),K.incrementRetryCount(),K.raisePlaybackError("PlaybackRetried",G),K.setPlayerSource(K.selectedStreamDetails)}),this.configProvider.config.sourceResetTimeoutInMs),[3,4]):[3,1]):(this.logger.error("onError: error details are not available"),this.raisePlaybackError("Unknown",G),[2]);case 1:return z===ie||F.message&&F.message.includes(ie.toString(16))?(this.raisePlaybackError("NetworkError",G),this.destroy(),[3,4]):[3,2];case 2:return[4,this.switchStreamingUrl(z)];case 3:J.sent()||(this.raisePlaybackError("PlaybackError",G),this.destroy()),J.label=4;case 4:return[2]}}))}))},AmpLiveStreamPlayer.prototype.incrementRetryCount=function(){var F,B;this.retryCount++;var G=null===(F=this.playerInstance)||void 0===F?void 0:F.message("getPlayerDiagnosticStat").send("retryCount");null===(B=this.playerInstance)||void 0===B||B.message("setPlayerDiagnosticStat").send("retryCount",G+1)},AmpLiveStreamPlayer.prototype.raisePlaybackError=function(F,B){this.liveStreamStatistic.registerPlaybackError(F,B),this.event("playbackError").raise(F,B)},AmpLiveStreamPlayer}(Y.default);B.AmpLiveStreamPlayer=re},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.setupHlsAndBuildPipe=B.setupAmpAndBuildPipe=void 0;var K=G(40),J=G(474),Q=G(475),Y=function(){function PlayerCommunicationDirect(){}return PlayerCommunicationDirect.prototype.sendMsg=function(F){this.peer.onMsg(F)},PlayerCommunicationDirect.prototype.registerObserver=function(F){this.observer=F},PlayerCommunicationDirect.prototype.onMsg=function(F){this.observer&&this.observer.processMessage(F)},PlayerCommunicationDirect.prototype.connect=function(F){this.peer=F},PlayerCommunicationDirect.prototype.dispose=function(){this.peer=null,this.observer=null},PlayerCommunicationDirect}(),$=function(){function IFrameWrapper(F){this.container=F}return Object.defineProperty(IFrameWrapper.prototype,"contextWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),IFrameWrapper.prototype.sendMsg=function(F){var B,G;null===(G=null===(B=this.iframe)||void 0===B?void 0:B.contentWindow)||void 0===G||G.postMessage(F,"*")},IFrameWrapper.prototype.registerObserver=function(F){this.observer=F},IFrameWrapper.prototype.dispose=function(){this.contextWindow&&this.contextWindow.removeEventListener("message",this.processMsg),this.iframe&&this.container.hasChildNodes()&&this.container.removeChild(this.iframe),this.iframe=null},IFrameWrapper.prototype.initializeAmpIframe=function(F){var B=this.initializeIframe();return this.setAmpIframeContent(F),this.finilizeIframe(B)},IFrameWrapper.prototype.initializeHlsIframe=function(F){var B=this.initializeIframe();return this.setHlsIframeContent(F),this.finilizeIframe(B)},IFrameWrapper.prototype.initializeIframe=function(){var F=K.defer();return this.iframe=this.container.ownerDocument.createElement("iframe"),this.iframe.id="player-iframe",this.iframe.sandbox.add("allow-scripts"),this.iframe.allowFullscreen=!0,this.iframe.allow="autoplay",this.iframe.style.height="100%",this.iframe.style.width="100%",this.iframe.style.border="none",this.iframe.onload=function(){F.resolve()},this.iframe.onerror=function(){F.reject("iframe load failed")},F},IFrameWrapper.prototype.finilizeIframe=function(F){return this.container.appendChild(this.iframe),this.processMsg=this.processMsg.bind(this),this.contextWindow.addEventListener("message",this.processMsg),F.promise},IFrameWrapper.prototype.processMsg=function(F){"null"===F.origin&&F.source===this.iframe.contentWindow&&this.observer&&this.observer.processMessage(F.data)},IFrameWrapper.prototype.setAmpIframeContent=function(F){var B=(0,J.buildAmpEmbededSrc)(),G=F?"<script nonce='".concat(F,"'> ").concat(B,"<\/script>"):"<script> ".concat(B,"<\/script>"),W="\n            <html class style='height: 100%; width: 100%; overflow: hidden'>\n            <head></head>\n            <body class style='height: 100%; width: 100%; margin: 0px'>\n                ".concat(G,"\n            </body>\n            </html>\n        ");this.iframe.srcdoc=W},IFrameWrapper.prototype.setHlsIframeContent=function(F){var B=(0,Q.buildHlsEmbededSrc)(),G=F?"<script nonce='".concat(F,"'> ").concat(B,"<\/script>"):"<script> ".concat(B,"<\/script>"),W="\n            <html class style='height: 100%; width: 100%; overflow: hidden'>\n            <head></head>\n            <body class style='height: 100%; width: 100%; margin: 0px'>\n                ".concat(G,"\n            </body>\n            </html>\n        ");this.iframe.srcdoc=W},IFrameWrapper}();function setupAmpAndBuildPipe(F,B,G){return W(this,void 0,void 0,(function(){var W,K,Q;return z(this,(function(z){switch(z.label){case 0:return 0===B?(W=new Y,K=new Y,W.connect(K),K.connect(W),K.registerObserver(new J.AmpCommunicationHandler(K,F)),[2,W]):1!==B?[3,2]:[4,(Q=new $(F)).initializeAmpIframe(G)];case 1:return z.sent(),[2,Q];case 2:throw new Error("Unsupported communication type ".concat(B))}}))}))}function setupHlsAndBuildPipe(F,B,G){return W(this,void 0,void 0,(function(){var W,K,J;return z(this,(function(z){switch(z.label){case 0:return 0===B?(W=new Y,K=new Y,W.connect(K),K.connect(W),K.registerObserver(new Q.HlsCommunicationHandler(K,F)),[2,W]):1!==B?[3,2]:[4,(J=new $(F)).initializeHlsIframe(G)];case 1:return z.sent(),[2,J];case 2:throw new Error("Unsupported communication type ".concat(B))}}))}))}B.setupAmpAndBuildPipe=setupAmpAndBuildPipe,B.setupHlsAndBuildPipe=setupHlsAndBuildPipe},function(F,B,G){function AmpPlayerF(){var F=AmpDiagnosticProviderF(),B=CaptionsControlToggleProviderF();return function(){function AmpPlayer(F,B){this.container=F,this.eventsHandler=B,this.playerEvents=[],this.maxMemoryTraceLogCount=1e4,this.videoSourceType="application/dash+xml",this.sdnPluginLoaded=!1,this.statsTimer=-1,this.statsInterval=1e3,this.totalBufferingTime=0,this.isBuffering=!1,this.totalPlayingTime=0,this.isPlaying=!1,this.videoTrackHistory=[]}return Object.defineProperty(AmpPlayer.prototype,"contextWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),AmpPlayer.prototype.configure=function(F,B){this.liveStreamOptions=F,this.configProvider=B,this.statsInterval=B.config.playerTelemetryTickMs||this.statsInterval,this.maxMemoryTraceLogCount=B.config.maxPlayerMemoryTraceLogCount||this.maxMemoryTraceLogCount},AmpPlayer.prototype.loadPlayerScript=function(){var F=this;this.log("loadPlayerScript started");for(var B=Promise.resolve(),G=this.configProvider.playerConfig.nonce,W=this.configProvider.playerConfig.css,_loop_1=function(z){B=B.then((function(){return F.loadCss(F.container.ownerDocument,W[z],G)}))},z=0;z<W.length;z++)_loop_1(z);var K=this.configProvider.playerConfig.src,_loop_2=function(W){B=B.then((function(){return F.loadScript(F.container.ownerDocument,K[W],G)}))};for(z=0;z<K.length;z++)_loop_2(z);return B},AmpPlayer.prototype.tryLoadSdnPlugin=function(){var F=this;return this.sdnPluginLoaded||!this.liveStreamOptions.sdn?Promise.resolve():this.configProvider.config.allowSdnPlugins?(this.log("tryLoadSdnPlugin started"),this.loadScript(this.container.ownerDocument,this.liveStreamOptions.sdn.url,this.configProvider.playerConfig.nonce).then((function(){F.sdnPluginLoaded=!0,F.log("tryLoadSdnPlugin done")}))):(this.log("Loading SDN plugins is not allowed"),Promise.reject("Loading SDN plugins is not allowed"))},AmpPlayer.prototype.createAmp=function(){this.log("createAmp started"),this.createVideoElement();var G=this.getAmpOptions();if(this.playerInstance=this.contextWindow.amp(this.video.id,G),!this.playerInstance)throw this.log("createAmp failed","error"),new Error("playerInstance is null");this.diagnosticProvider=new F(this.playerInstance,this.contextWindow,new Date);var W={isOverflow:this.liveStreamOptions.overflow,logFn:this.log.bind(this),removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack};this.captionsControl=new B(this.playerInstance,this,W),this.registerPlayerEvents(),this.log("createAmp done")},AmpPlayer.prototype.setSource=function(F){if(this.log("setSource started"),!this.playerInstance)throw this.log("setSource failed: playerInstance is null","error"),new Error("playerInstance is null");var B={src:F.url,type:this.videoSourceType,protectionInfo:F.decryptionToken?[{type:"AES",authenticationToken:F.decryptionToken}]:null};this.configureSdnSource(B,F),this.playerInstance.src([B],this.getTextTracks()),this.log("setSource done")},AmpPlayer.prototype.setPlayTime=function(F){F&&(this.log("setPlayerTime: ".concat(F)),this.playerInstance.currentTime(F))},AmpPlayer.prototype.setPlayerDiagnosticStat=function(F,B){this.diagnosticProvider&&this.diagnosticProvider.setValue(F,B)},AmpPlayer.prototype.getPlayerDiagnosticStat=function(F){var B;return null===(B=this.diagnosticProvider)||void 0===B?void 0:B.getValue(F)},AmpPlayer.prototype.dispose=function(){this.log("dispose started"),this.diagnosticProvider&&(this.stopStatsCollection(),this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.removeEventListeners(),this.playerInstance.getMemoryLog(!0),this.playerInstance.dispose(),this.playerInstance=null),this.eventsHandler.ampDisposed(),this.video&&this.video.parentNode&&(this.video.parentNode.removeChild(this.video),this.video=null),this.onPlaybackStopped(),this.log("dispose done"),this.eventsHandler=null},AmpPlayer.prototype.updateDiagnostics=function(){this.updateTotalPlayingTimeStatistic(),this.updateBufferingRateStatistic(),this.updateVideoTrackHistoryStatistic(!1)},AmpPlayer.prototype.onPlaybackStopped=function(){this.isBuffering=!1,this.bufferingRateStatUpdatedTimestamp=null,this.isPlaying=!1,this.totalPlayingTimeUpdatedTimestamp=null,this.currentVideoDownloadBitrate=null,this.videoTrackHistoryUpdatedTimestamp=null},AmpPlayer.prototype.showCaptions=function(F){this.log("showCaptions: ".concat(F)),this.captionsControl.showCaptions(F)},AmpPlayer.prototype.addCues=function(F){F=F.filter((function(F){return F.text&&0!==F.text.trim().length})),this.captionsControl.addCues(F)},AmpPlayer.prototype.clearCues=function(){this.captionsControl.clearCues()},AmpPlayer.prototype.captionsToggled=function(F,B,G){this.log("captionsToggled: ".concat(F," for culture ").concat(B," at ").concat(G)),this.eventsHandler.message("captionsToggled").send(F,B,G)},AmpPlayer.prototype.createVideoElement=function(){this.log("createVideoElement started"),this.video=this.container.ownerDocument.createElement("video"),this.video.id="amp-player",this.video.setAttribute("playsinline","");var F=this.configProvider.playerConfig.lang;F&&(this.video.setAttribute("lang",F),this.log("createVideoElement: language set to ".concat(F)));for(var B=this.configProvider.playerConfig.styles,G=0;G<B.length;G++)this.video.classList.add(B[G]);this.container.appendChild(this.video),this.log("createVideoElement done")},AmpPlayer.prototype.getAmpOptions=function(){var F=[];this.configProvider.config.debug?F.push({target:"memory",maxMemoryTraceCount:this.maxMemoryTraceLogCount}):F.push({target:"console"});var B={TraceTargets:F,maxLogLevel:this.configProvider.config.debug?3:2},G={techOrder:this.configProvider.config.techOrder,nativeControlsForTouch:!1,autoplay:!0,preload:"auto",controls:!this.liveStreamOptions.overflow,logo:{enabled:!1},height:"100%",width:"100%",traceConfig:B,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton,staleDataTimeLimitInSec:this.configProvider.config.staleDataTimeLimitInSec,heuristicProfile:this.contextWindow.amp.Player.HeuristicProfile.HighQuality,customPlayerSettings:{customHeuristicSettings:{bandwidthTestWithTimeThresholdDuringLive:!1,windowSizeHeuristics:this.configProvider.config.useBrowserWindowSizeForBitRate,useBrowserWindowForWindowSizeRule:this.configProvider.config.useBrowserWindowSizeForBitRate,useVariableFragmentSizeMode:!0}},plugins:{}};return this.initializePluginOptions(G),G},AmpPlayer.prototype.isStreamValid=function(F){return F&&!!F.url&&!!F.decryptionToken},AmpPlayer.prototype.initializePluginOptions=function(F){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn){var B=this.liveStreamOptions.correlationId,G=this.isStreamValid(this.liveStreamOptions.stream)?this.liveStreamOptions.stream:this.liveStreamOptions.altStream;try{switch(this.liveStreamOptions.sdn.name){case"hive":return void(F.plugins={hive:{debugLevel:this.configProvider.config.debug?"debug":"notice",telemetryId:B}});case"kollective":return void(G.sdnContext&&(F.plugins={kollectiveSDN:{playbackInfo:this.parseJson(G.sdnContext,"kollective sdn context"),reportSessionId:B}}));case"ramp":return void(G.sdnContext&&(F.plugins={RampMOPlugin:this.parseJson(G.sdnContext,"ramp sdn context")},this.configProvider.config.debug&&(F.plugins.RampMOPlugin.verbose=!0)));case"peer5":return void(G.sdnContext&&(F.plugins={peer5:this.parseJson(G.sdnContext,"peer5 sdn context")}));default:return}}catch(F){this.log("initializePluginOptions failed, error: ".concat(F),"error")}}},AmpPlayer.prototype.getTextTracks=function(){var F=[];if(this.liveStreamOptions.overflow)F.push({id:"amp-player_default",kind:"captions",label:"default-text-track",src:"",srclang:""});else if(this.liveStreamOptions.supportedSubtitleLanguages)for(var B=this.liveStreamOptions.supportedSubtitleLanguages,G=0;G<B.length;G++)F.push({id:"amp-player_".concat(B[G].culture),kind:this.configProvider.config.textTrackKind,label:B[G].name||B[G].culture,src:"",srclang:B[G].culture.substr(0,2)});return F},AmpPlayer.prototype.configureSdnSource=function(F,B){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn)try{switch(this.liveStreamOptions.sdn.name){case"hive":B.sdnContext?F.sdnList=[{sdnName:"hive",sdnUrl:B.sdnContext}]:F.sdnList=[];break;case"kollective":B.sdnContext?F.sdnList=[{sdnName:"kollectiveSDN",playbackInfo:this.parseJson(B.sdnContext,"kollective sdn list context")}]:F.sdnList=[];break;case"ramp":case"peer5":F.sdnList=[];break;default:return}}catch(B){F.sdnList=[],this.log("configureSdnSource failed, error: ".concat(B),"error")}},AmpPlayer.prototype.registerPlayerEvents=function(){var F=this;this.registerPlayerEvent(this.contextWindow.amp.eventName.error,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.error)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.canplaythrough,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.canplaythrough)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.play,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.play)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.playing,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.playing)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.pause,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.pause)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.resume,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.resume)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.start,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.start)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.ended,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.ended)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeking,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.seeking)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeked,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.seeked)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadedmetadata,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.loadedmetadata)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.waiting,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.waiting)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.playbackbitratechanged,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.playbackbitratechanged)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.downloadbitratechanged,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.downloadbitratechanged)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.fullscreenchange,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.fullscreenchange)})),this.registerPlayerEvent("potentialMediaFreeze",(function(){F.onAmpEvent("potentialMediaFreeze")})),this.registerPlayerEvent(this.contextWindow.amp.eventName.mute,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.mute)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.unmute,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.unmute)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.volumechange,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.volumechange)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadeddata,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.loadeddata)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadstart,(function(){F.onAmpEvent(F.contextWindow.amp.eventName.loadstart)}))},AmpPlayer.prototype.registerPlayerEvent=function(F,B){this.playerEvents.push(F),this.playerInstance.addEventListener(F,B)},AmpPlayer.prototype.removeEventListeners=function(){var F=this;this.playerEvents.forEach((function(B){F.playerInstance.removeEventListener(B)}))},AmpPlayer.prototype.onAmpEvent=function(F){var B,G;switch(F){case this.contextWindow.amp.eventName.error:G=this.playerInstance.error(),B={currentTime:this.playerInstance.currentTime(),errorCode:G?G.code:0,message:G?G.message:""};break;case this.contextWindow.amp.eventName.canplaythrough:this.initializeStatsColletion();break;case this.contextWindow.amp.eventName.loadedmetadata:this.captionsControl.initialize();break;case this.contextWindow.amp.eventName.fullscreenchange:B={isFullscreen:this.playerInstance.isFullscreen()};break;case this.contextWindow.amp.eventName.playbackbitratechanged:B={bitrate:this.playerInstance.currentPlaybackBitrate()};break;case this.contextWindow.amp.eventName.downloadbitratechanged:B={bitrate:this.playerInstance.currentDownloadBitrate()};break;case this.contextWindow.amp.eventName.seeked:B={captionsTimestamp:this.liveStreamOptions.overflow?this.playerInstance.currentMediaTime():this.playerInstance.currentTime()};break;case this.contextWindow.amp.eventName.volumechange:B={value:this.playerInstance.volume()}}this.updateDiagnostics(),this.checkPlayingState(F),this.checkBufferingState(F),this.checkCurrentDownloadBitrate(F),F!==this.contextWindow.amp.eventName.ended&&F!==this.contextWindow.amp.eventName.error||this.onPlaybackStopped(),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),this.eventsHandler.message("stateChanged").send(F,B)},AmpPlayer.prototype.checkPlayingState=function(F){this.isPlaying?F!==this.contextWindow.amp.eventName.pause&&F!==this.contextWindow.amp.eventName.seeking&&F!==this.contextWindow.amp.eventName.ended&&F!==this.contextWindow.amp.eventName.error&&F!==this.contextWindow.amp.eventName.waiting||(this.isPlaying=!1):F===this.contextWindow.amp.eventName.playing&&(this.isPlaying=!0)},AmpPlayer.prototype.checkBufferingState=function(F){this.isBuffering?F!==this.contextWindow.amp.eventName.pause&&F!==this.contextWindow.amp.eventName.seeking&&F!==this.contextWindow.amp.eventName.ended&&F!==this.contextWindow.amp.eventName.error&&F!==this.contextWindow.amp.eventName.playing||(this.isBuffering=!1):F===this.contextWindow.amp.eventName.waiting&&(this.isBuffering=!0)},AmpPlayer.prototype.checkCurrentDownloadBitrate=function(F){F===this.contextWindow.amp.eventName.ended||F===this.contextWindow.amp.eventName.error?this.currentVideoDownloadBitrate=null:F===this.contextWindow.amp.eventName.downloadbitratechanged&&this.playerInstance.currentDownloadBitrate()!==this.currentVideoDownloadBitrate&&(this.currentVideoDownloadBitrate=this.playerInstance.currentDownloadBitrate(),this.updateVideoTrackHistoryStatistic(!0))},AmpPlayer.prototype.initializeStatsColletion=function(){var F=this;this.diagnosticProvider.initialize(),this.statsTimer=window.setInterval((function(){F.eventsHandler&&(F.updateDiagnostics(),F.eventsHandler.message("statsUpdated").send(F.getPlayerDiagnostics()))}),this.statsInterval)},AmpPlayer.prototype.stopStatsCollection=function(){this.updateDiagnostics(),this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),-1!==this.statsTimer&&window.clearInterval(this.statsTimer),this.statsTimer=-1},AmpPlayer.prototype.updateVideoTrackHistoryStatistic=function(F){var B=new Date;if(!F&&this.videoTrackHistoryUpdatedTimestamp&&this.videoTrackHistory.length>0&&this.currentVideoDownloadBitrate===this.videoTrackHistory[this.videoTrackHistory.length-1].trackDownloadBitrate)this.videoTrackHistory[this.videoTrackHistory.length-1].durationInSeconds+=(B.getTime()-this.videoTrackHistoryUpdatedTimestamp.getTime())/1e3;else if(F&&this.currentVideoDownloadBitrate){var G=this.playerInstance.videoBufferData(),W=null;G&&G.perceivedBandwidth&&(W=G.perceivedBandwidth),this.videoTrackHistory.push({trackDownloadBitrate:this.currentVideoDownloadBitrate,trackSwitchTimestamp:B.getTime(),trackSwitchMeasuredBandwidth:this.diagnosticProvider?this.diagnosticProvider.getLatestMeasuredBandwidth():null,trackSwitchPerceivedBandwidth:W,durationInSeconds:0})}this.videoTrackHistoryUpdatedTimestamp=B,this.diagnosticProvider&&this.diagnosticProvider.setValue("videoTrackHistory",this.videoTrackHistory)},AmpPlayer.prototype.updateTotalPlayingTimeStatistic=function(){var F=new Date;this.isPlaying&&this.totalPlayingTimeUpdatedTimestamp&&(this.totalPlayingTime+=F.getTime()-this.totalPlayingTimeUpdatedTimestamp.getTime()),this.totalPlayingTimeUpdatedTimestamp=F,this.diagnosticProvider&&this.diagnosticProvider.setValue("totalPlayingTimeInSeconds",this.totalPlayingTime/1e3)},AmpPlayer.prototype.updateBufferingRateStatistic=function(){var F=new Date;if(this.isBuffering&&this.bufferingRateStatUpdatedTimestamp&&(this.totalBufferingTime+=F.getTime()-this.bufferingRateStatUpdatedTimestamp.getTime()),this.bufferingRateStatUpdatedTimestamp=F,this.diagnosticProvider){var B=this.totalPlayingTime>0||this.totalBufferingTime>0?this.totalBufferingTime/(this.totalPlayingTime+this.totalBufferingTime):0;this.diagnosticProvider.setValue("bufferingRate",B)}},AmpPlayer.prototype.getPlayerDiagnostics=function(){var F=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return F.statsInterval=this.statsInterval,this.configProvider.config.debug&&(F.memoryLog=this.playerInstance.getMemoryLog(!0)),F},AmpPlayer.prototype.log=function(F,B){void 0===B&&(B="info");var G="[AmpPlayer".concat(1===this.configProvider.config.loadType?"IFrame":"","]"),W="".concat(G,": ").concat(F);this.configProvider.config.debug&&console.log(W),this.eventsHandler.message("log").send(B,W)},AmpPlayer.prototype.getElementLoadPromise=function(F){return new Promise((function(B,G){F.onload=function(){B()},F.onerror=function(F){G(F)}}))},AmpPlayer.prototype.loadScript=function(F,B,G){var W=F.createElement("script"),z=this.getElementLoadPromise(W);return W.src=B,G&&(W.nonce=G),F.head.appendChild(W),z},AmpPlayer.prototype.loadCss=function(F,B,G){var W=F.createElement("link"),z=this.getElementLoadPromise(W);return W.href=B,W.rel="stylesheet",G&&(W.nonce=G),F.head.appendChild(W),z},AmpPlayer.prototype.parseJson=function(F,B){try{return JSON.parse(F)}catch(F){throw this.log("Error parsing JSON for ".concat(B,", error: ").concat(JSON.stringify(F))),F}},AmpPlayer}()}function AmpCommunicationHandlerF(){var F=AmpPlayerF();return function(){function AmpCommunicationHandler(B,G){this.pipe=B,this.amp=new F(G,this)}return AmpCommunicationHandler.prototype.processMessage=function(F){var B=this;"Command"===F.msgType&&Promise.resolve().then((function(){return B.amp[F.cmd].apply(B.amp,F.args)})).catch((function(F){return F})).then((function(G){B.pipe&&B.pipe.sendMsg({msgType:"CommandResult",cmd:F.cmd,error:G})}))},AmpCommunicationHandler.prototype.message=function(F){var B=this;return{send:this.fromMessage((function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];B.sendMessageImpl(F,G)}))}},AmpCommunicationHandler.prototype.ampDisposed=function(){this.pipe.dispose(),this.pipe=null,this.amp=null},AmpCommunicationHandler.prototype.fromMessage=function(F){return F},AmpCommunicationHandler.prototype.sendMessageImpl=function(F,B){this.pipe.sendMsg({msgType:"PlayerNotification",name:F,args:B})},AmpCommunicationHandler}()}function IFrameMessageHandlerF(){function isCmdResult(F){return"CommandResult"===F.msgType}function getErrorString(F){var B="unknown";try{B="string"==typeof F?F:"toString"in F&&0!==F.toString().indexOf("[object")?F.toString():JSON.stringify(F)}catch(B){console.error("Failed to stringify error",F)}return B}return function(){function IFrameMessageHandler(){this.processMsg=this.processMsg.bind(this),window.addEventListener("message",this.processMsg)}return IFrameMessageHandler.prototype.sendMsg=function(F){try{var B=F;isCmdResult(F)&&F.error instanceof Event&&(console.debug("Stringifying error Event before trying to postMessage:",F),B={msgType:F.msgType,cmd:F.cmd,error:"Event: ".concat(getErrorString(F.error))}),this.postMessage(B)}catch(B){console.error("Unexpected exception caught from postMessage.\n","message:",F,"\n","exception:",B);var G={msgType:"PlayerNotification",name:"log",args:["error","Unexpected error with postMessage: ".concat(getErrorString(B))]};throw this.postMessage(G),B}},IFrameMessageHandler.prototype.registerObserver=function(F){this.observer=F},IFrameMessageHandler.prototype.dispose=function(){window.removeEventListener("message",this.processMsg),this.observer=null},IFrameMessageHandler.prototype.processMsg=function(F){this.observer.processMessage(F.data)},IFrameMessageHandler.prototype.postMessage=function(F){window.parent.postMessage(F,"*")},IFrameMessageHandler}()}function AmpDiagnosticProviderF(){return function(){function AmpDiagnosticProvider(F,B,G){this.playerInstance=F,this.contextWindow=B,this.streamingStartedTimestamp=G,this.currentDiagnosticSnapshot={playerType:0,errorCode:null,currentPlayPosition:null,currentMediaTime:null,currentAbsoluteTime:null,livePosition:null,playbackBitrate:null,downloadBitrate:null,perceivedBandwidth:null,tech:null,playerVersion:null,isP2PSdnUsed:null,sdnName:null,heuristicProfile:null,encryption:null,streamType:null,audioStream:null,videoStream:null,muted:null,volume:null,audioBufferLength:null,videoBufferLength:null,mediaHeight:null,mediaWidth:null,playerHeight:null,playerWidth:null,windowWidth:null,windowHeight:null,isFullscreen:null,avgAudioDownloadLatency:null,avgVideoDownloadLatency:null,avgAudioDownloadBytes:null,avgVideoDownloadBytes:null,maxVideoDownloadBytes:null,minVideoDownloadBytes:null,audioDownloadFailureCount:null,audioDownloadSuccessCount:null,videoDownloadFailureCount:null,videoDownloadSuccessCount:null,audioDownloadFailures:null,videoDownloadFailures:null,totalDownloadedBytes:null,averageDownloadBitrate:null,retryFrequency:null,retryCount:0,totalPlayingTimeInSeconds:0,bufferingRate:0,videoTrackHistory:[],memoryLog:null,statsInterval:null},this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailures=[],this.videoDownloadFailures=[],this.totalDownloadedBytes=0,this.videoDownloadMeasuredBandwidthHistory=[],this.videoDownloadMeasuredBandwidthHistoryMaxSize=10,this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=30,this.downloadFailuresLimit=10,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}return AmpDiagnosticProvider.prototype.initialize=function(){this.playerVideoBuffer=this.playerInstance.videoBufferData(),this.playerAudioBuffer=this.playerInstance.audioBufferData(),this.registerForPlayerBufferEvents()},AmpDiagnosticProvider.prototype.setValue=function(F,B){this.currentDiagnosticSnapshot[F]=B},AmpDiagnosticProvider.prototype.getValue=function(F){return this.currentDiagnosticSnapshot[F]},AmpDiagnosticProvider.prototype.getPlayerDiagnosticSnapshot=function(){var F,B,G=this;if(!this.playerInstance)return null;var W=window.screen,z=this.playerInstance.error(),mean=function(F){var B=F.slice().sort();return B[Math.floor(B.length/2)]};this.currentDiagnosticSnapshot.errorCode=z&&z.code||0,this.currentDiagnosticSnapshot.currentPlayPosition=this.playerInstance.currentTime(),this.currentDiagnosticSnapshot.currentMediaTime=null!==(F=this.playerInstance.currentMediaTime())&&void 0!==F?F:this.playerInstance.currentTime(),this.currentDiagnosticSnapshot.currentAbsoluteTime=null!==(B=this.playerInstance.currentAbsoluteTime())&&void 0!==B?B:this.playerInstance.currentTime(),this.currentDiagnosticSnapshot.livePosition=this.playerInstance.duration(),this.currentDiagnosticSnapshot.playbackBitrate=this.playerInstance.currentPlaybackBitrate(),this.currentDiagnosticSnapshot.downloadBitrate=this.playerInstance.currentDownloadBitrate(),this.currentDiagnosticSnapshot.perceivedBandwidth=this.playerVideoBuffer?this.playerVideoBuffer.perceivedBandwidth:0,this.currentDiagnosticSnapshot.tech=this.playerInstance.currentTechName(),this.currentDiagnosticSnapshot.playerVersion=this.playerInstance.getAmpVersion(),this.currentDiagnosticSnapshot.isP2PSdnUsed=this.isP2PSdnUsed(),this.currentDiagnosticSnapshot.sdnName=this.sdnName(),this.currentDiagnosticSnapshot.heuristicProfile=this.playerInstance.currentHeuristicProfile(),this.currentDiagnosticSnapshot.encryption=this.playerInstance.currentProtectionInfo()?this.playerInstance.currentProtectionInfo().type:"",this.currentDiagnosticSnapshot.streamType=this.playerInstance.isLive()?"LIVE":"DVR",this.currentDiagnosticSnapshot.audioStream=this.getAudioStreamData(),this.currentDiagnosticSnapshot.videoStream=this.getVideoStreamData(),this.currentDiagnosticSnapshot.muted=this.playerInstance.muted(),this.currentDiagnosticSnapshot.volume=this.playerInstance.volume(),this.currentDiagnosticSnapshot.audioBufferLength=this.playerAudioBuffer?this.playerAudioBuffer.bufferLevel:0,this.currentDiagnosticSnapshot.videoBufferLength=this.playerVideoBuffer?this.playerVideoBuffer.bufferLevel:0,this.currentDiagnosticSnapshot.mediaHeight=this.playerInstance.videoHeight(),this.currentDiagnosticSnapshot.mediaWidth=this.playerInstance.videoWidth(),this.currentDiagnosticSnapshot.playerHeight=this.playerInstance.height(),this.currentDiagnosticSnapshot.playerWidth=this.playerInstance.width(),this.currentDiagnosticSnapshot.windowWidth=W?W.width:0,this.currentDiagnosticSnapshot.windowHeight=W?W.height:0,this.currentDiagnosticSnapshot.isFullscreen=this.playerInstance.isFullscreen(),this.currentDiagnosticSnapshot.avgAudioDownloadLatency=mean(this.audioDownloadLatencies),this.currentDiagnosticSnapshot.avgVideoDownloadLatency=mean(this.videoDownloadLatencies),this.currentDiagnosticSnapshot.avgAudioDownloadBytes=mean(this.audioDownloadBytes),this.currentDiagnosticSnapshot.avgVideoDownloadBytes=mean(this.videoDownloadBytes),this.currentDiagnosticSnapshot.maxVideoDownloadBytes=Math.max.apply(null,this.videoDownloadBytes),this.currentDiagnosticSnapshot.minVideoDownloadBytes=Math.min.apply(null,this.videoDownloadBytes),this.currentDiagnosticSnapshot.audioDownloadFailureCount=this.audioDownloadFailureCount,this.currentDiagnosticSnapshot.audioDownloadSuccessCount=this.audioDownloadSuccessCount,this.currentDiagnosticSnapshot.videoDownloadFailureCount=this.videoDownloadFailureCount,this.currentDiagnosticSnapshot.videoDownloadSuccessCount=this.videoDownloadSuccessCount,this.currentDiagnosticSnapshot.audioDownloadFailures=this.audioDownloadFailures,this.currentDiagnosticSnapshot.videoDownloadFailures=this.videoDownloadFailures,this.currentDiagnosticSnapshot.totalDownloadedBytes=this.totalDownloadedBytes,this.currentDiagnosticSnapshot.retryFrequency=this.getRetryFrequency(),this.currentDiagnosticSnapshot.averageDownloadBitrate=this.getAverageDownloadBitrate();var K=this.getDiagnosticWritableField();return Object.keys(K).forEach((function(F){G.currentDiagnosticSnapshot[F]=K[F]})),this.currentDiagnosticSnapshot},AmpDiagnosticProvider.prototype.getDiagnosticWritableField=function(){return{retryCount:this.currentDiagnosticSnapshot.retryCount,totalPlayingTimeInSeconds:this.currentDiagnosticSnapshot.totalPlayingTimeInSeconds,bufferingRate:this.currentDiagnosticSnapshot.bufferingRate,videoTrackHistory:this.currentDiagnosticSnapshot.videoTrackHistory}},AmpDiagnosticProvider.prototype.dispose=function(){this.unsubscribeFromPlayerBufferEvents()},AmpDiagnosticProvider.prototype.registerForPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},AmpDiagnosticProvider.prototype.unsubscribeFromPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},AmpDiagnosticProvider.prototype.isP2PSdnUsed=function(){return!!this.sdnName()},AmpDiagnosticProvider.prototype.sdnName=function(){var F="options_";return this.playerInstance[F]&&this.playerInstance[F].sdn&&this.playerInstance[F].sdn.name},AmpDiagnosticProvider.prototype.onVideoDownloadCompleted=function(){this.videoDownloadSuccessCount++,this.addToList(this.videoDownloadLatencies,this.playerVideoBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.videoDownloadBytes,this.playerVideoBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes),this.totalDownloadedBytes+=this.playerVideoBuffer.downloadCompleted.totalBytes,this.videoDownloadMeasuredBandwidthHistory.push(this.playerVideoBuffer.downloadCompleted.measuredBandwidth),this.videoDownloadMeasuredBandwidthHistory.length>this.videoDownloadMeasuredBandwidthHistoryMaxSize&&(this.videoDownloadMeasuredBandwidthHistory=this.videoDownloadMeasuredBandwidthHistory.slice(this.videoDownloadMeasuredBandwidthHistory.length-this.videoDownloadMeasuredBandwidthHistoryMaxSize))},AmpDiagnosticProvider.prototype.onAudioDownloadCompleted=function(){this.audioDownloadSuccessCount++,this.addToList(this.audioDownloadLatencies,this.playerAudioBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.audioDownloadBytes,this.playerAudioBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes),this.totalDownloadedBytes+=this.playerAudioBuffer.downloadCompleted.totalBytes},AmpDiagnosticProvider.prototype.addToList=function(F,B,G){F.push(B),F.length>G&&F.shift()},AmpDiagnosticProvider.prototype.onVideoDownloadError=function(){this.videoDownloadFailureCount++,this.addDownloadFailureInfo(this.playerVideoBuffer.downloadFailed,this.videoDownloadFailures)},AmpDiagnosticProvider.prototype.onAudioDownloadError=function(){this.audioDownloadFailureCount++,this.addDownloadFailureInfo(this.playerAudioBuffer.downloadFailed,this.audioDownloadFailures)},AmpDiagnosticProvider.prototype.addDownloadFailureInfo=function(F,B){var G={bitrate:F.mediaDownload.bitrate,errorCode:F.code,mediaTime:F.mediaDownload.mediaTime,message:F.message,timestamp:Date.now()};this.addToList(B,G,this.downloadFailuresLimit)},AmpDiagnosticProvider.prototype.getAudioStreamData=function(){var F=this.playerInstance.currentAudioStreamList();if(F)try{var B=F.streams[F.enabledIndices[0]];return{bitrate:B.bitrate,codec:B.codec,enabled:B.enabled,name:B.name,language:B.language}}catch(F){return}},AmpDiagnosticProvider.prototype.getVideoStreamData=function(){var F=this.playerInstance.currentVideoStreamList();if(F)try{var B=F.streams[F.selectedIndex],G=this.playerInstance.currentPlaybackBitrate(),mapTrackData=function(F){return{bitrate:F.bitrate,codec:F.codec,height:F.height,id:F.id,selectable:F.selectable,width:F.width}},W=B.tracks?B.tracks.map(mapTrackData).find((function(F){return F.bitrate===G})):null;return{codec:B.codec,name:B.name,currentTrack:W}}catch(F){return}},AmpDiagnosticProvider.prototype.getAverageDownloadBitrate=function(){if(this.streamingStartedTimestamp&&this.totalDownloadedBytes){var F=((new Date).getTime()-this.streamingStartedTimestamp.getTime())/1e3;if(F>0)return 8*this.totalDownloadedBytes/F}return 0},AmpDiagnosticProvider.prototype.getRetryFrequency=function(){var F=this.currentDiagnosticSnapshot.retryCount;if(this.streamingStartedTimestamp&&F){var B=((new Date).getTime()-this.streamingStartedTimestamp.getTime())/6e4;if(B>0)return F/B}return 0},AmpDiagnosticProvider.prototype.getLatestMeasuredBandwidth=function(){if(0===this.videoDownloadMeasuredBandwidthHistory.length)return null;for(var F=0,B=0;B<this.videoDownloadMeasuredBandwidthHistory.length;B++)F+=this.videoDownloadMeasuredBandwidthHistory[B];return F/this.videoDownloadMeasuredBandwidthHistory.length},AmpDiagnosticProvider}()}function CaptionsControlToggleProviderF(){return function(){function CaptionsControlToggleProvider(F,B,G){var W;this.player=F,this.toggleListener=B,this.config=G,this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.isHtml5Tech="html5"===(null===(W=this.player.currentTechName())||void 0===W?void 0:W.toLowerCase())}return CaptionsControlToggleProvider.prototype.dispose=function(){this.unsubscribeFromTrackEvents(),this.player=null,this.toggleListener=null},CaptionsControlToggleProvider.prototype.initialize=function(){var F=this.getPlayerTextTracksAsArray();if(this.config.isOverflow)F[0].mode="showing";else for(var B=0;B<F.length;B++)F[B].mode="disabled";this.subscribeOnTrackEvents()},CaptionsControlToggleProvider.prototype.addCues=function(F){var B=this.player.getCurrentTextTrack();if(B)for(var G=this.isHtml5Tech?this.getCurrentTime():this.player.currentAbsoluteTime()||1,W=this.getCurrentTime(),z=this.config.isOverflow?Math.max(G-W,0):G-W,K=this.isHtml5Tech?window.VTTCue:window.vttjs&&window.vttjs.VTTCue||window.VTTCue,J=0;J<F.length;J++){var Q=F[J],Y=Q.start,$=Q.end,X=Q.text,Z=6,ee=new K(Number((Y+z).toFixed(Z)),Number(($+z).toFixed(Z)),X);ee.size=100,!this.containsCue(B,ee)&&B.addCue(ee)}},CaptionsControlToggleProvider.prototype.clearCues=function(){var F=this.player.getCurrentTextTrack();if(F)try{if(F.activeCues&&F.removeCue)for(;F.activeCues.length>0;)F.removeCue(F.activeCues[0]);var B="setCues_";if(F.cues[B]){F.cues_&&(F.cues_.length=0),F.cues[B]([]);for(var G=Object.getOwnPropertyNames(F.cues),W=0;W<G.length;W++)"length"!==G[W]&&"length_"!==G[W]&&"cues_"!==G[W]&&delete F.cues[G[W]]}}catch(F){this.config.logFn("[clearCues]: ".concat(F),"warn")}},CaptionsControlToggleProvider.prototype.showCaptions=function(F){this.config.logFn("[CaptionsControl]: showCaptions(".concat(F,")")),F?this.show():this.hide()},CaptionsControlToggleProvider.prototype.hide=function(){this.previouslyVisibleTextTrack=this.player.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="disabled"),this.player.captionToggle&&this.player.captionToggle.hide&&this.player.captionToggle.hide(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.hide&&this.player.MoreOptionscaptionSubtitleButton.hide(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.hide&&this.player.MoreOptionscaptionSettingsButton.hide()},CaptionsControlToggleProvider.prototype.show=function(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="showing"),this.player.captionToggle&&this.player.captionToggle.show&&this.player.captionToggle.show(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.show&&this.player.MoreOptionscaptionSubtitleButton.show(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.show&&this.player.MoreOptionscaptionSettingsButton.show()},CaptionsControlToggleProvider.prototype.subscribeOnTrackEvents=function(){var F=this.player.textTracks(),B="addEventListener";F&&F[B]&&(F[B]("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&F[B]("addtrack",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.unsubscribeFromTrackEvents=function(){var F=this.player.textTracks(),B="removeEventListener";F&&F[B]&&(F[B]("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&F[B]("addtrack",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.onTextTrackChanged=function(){var F=this.player.getCurrentTextTrack();if(!F||!this.currentTextTrack||this.currentTextTrack.label!==F.label||this.currentTextTrack.mode!==F.mode){if(F||this.currentTextTrack){var B=!!F&&"showing"===F.mode,G=this.getCulture(F||this.currentTextTrack),W=this.getCurrentTime();this.toggleListener.captionsToggled(B,G,W),this.config.logFn("[CaptionsControl]: track changed: culture '".concat(G,"', timestamp '").concat(W,"'"))}this.currentTextTrack=F}},CaptionsControlToggleProvider.prototype.onAddTrack=function(F){var B,G,W=null==F?void 0:F.track;"captions"===(null==W?void 0:W.kind)&&!W.label&&!W.id&&(null===(G=null===(B=this.player)||void 0===B?void 0:B.textTracks_)||void 0===G||G.removeTrack_(W),this.config.logFn("[CaptionsControl]: removing default empty text track"))},CaptionsControlToggleProvider.prototype.getCurrentTime=function(){return this.isHtml5Tech?this.player.currentTime():(this.config.isOverflow?this.player.currentMediaTime():this.player.currentTime())||1},CaptionsControlToggleProvider.prototype.getCulture=function(F){if(!F)return"";if(F.id){var B=F.id.split("_")[1];if(B)return B}return""},CaptionsControlToggleProvider.prototype.getPlayerTextTracksAsArray=function(){var F=this.player.textTracks();return F&&F["tracks_"]||[]},CaptionsControlToggleProvider.prototype.containsCue=function(F,B){var G=this;return Array.from((null==F?void 0:F.cues)||[]).some((function(F){return G.areCueEquals(F,B)}))},CaptionsControlToggleProvider.prototype.areCueEquals=function(F,B){function getCueField(F){return{start:F.start?F.start:F.startTime,end:F.end?F.end:F.endTime,text:F.text}}var G=getCueField(F),W=getCueField(B);return G.start===W.start&&G.end===W.end&&G.text===W.text},CaptionsControlToggleProvider}()}function initIFrame(){var F=IFrameMessageHandlerF(),B=AmpCommunicationHandlerF(),G=new F,W=new B(G,document.body);G.registerObserver(W)}function buildAmpEmbededSrc(){var F="(".concat(initIFrame.toString(),")();");return F+=AmpPlayerF.toString()+";",F+=IFrameMessageHandlerF.toString()+";",F+=AmpCommunicationHandlerF.toString()+";",F+=CaptionsControlToggleProviderF.toString()+";",F+=AmpDiagnosticProviderF.toString()+";",F+="//# sourceURL=TsCallingAmpPlayer.js"}Object.defineProperty(B,"__esModule",{value:!0}),B.buildAmpEmbededSrc=B.CaptionsControlToggleProvider=B.AmpDiagnosticProvider=B.IFrameMessageHandler=B.AmpCommunicationHandler=B.AmpPlayer=void 0,B.AmpPlayer=AmpPlayerF(),B.AmpCommunicationHandler=AmpCommunicationHandlerF(),B.IFrameMessageHandler=IFrameMessageHandlerF(),B.AmpDiagnosticProvider=AmpDiagnosticProviderF(),B.CaptionsControlToggleProvider=CaptionsControlToggleProviderF(),B.buildAmpEmbededSrc=buildAmpEmbededSrc},function(F,B,G){function HlsPlayerF(){var F=HlsDiagnosticProviderF(),B=CaptionsControlToggleProviderF(),G=HlsMediaF(),W=Html5MediaF();return function(){function HlsPlayer(F,B){this.container=F,this.eventsHandler=B,this.maxMemoryTraceLogCount=1e4,this.sdnLoaded=!1,this.statsTimer=-1,this.statsInterval=1e3,this.stallingTimeoutId=-1,this.lastWaitTime=0}return Object.defineProperty(HlsPlayer.prototype,"contextWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),HlsPlayer.prototype.configure=function(F,B){this.liveStreamOptions=F,this.configProvider=B,this.statsInterval=B.config.playerTelemetryTickMs||this.statsInterval,this.maxMemoryTraceLogCount=B.config.maxPlayerMemoryTraceLogCount||this.maxMemoryTraceLogCount},HlsPlayer.prototype.loadPlayerScript=function(){var F=this;this.log("loadPlayerScript started");for(var B=Promise.resolve(),G=this.configProvider.playerConfig.nonce,W=this.configProvider.playerConfig.css,_loop_1=function(z){B=B.then((function(){return F.loadCss(F.container.ownerDocument,W[z],G)}))},z=0;z<W.length;z++)_loop_1(z);var K=this.configProvider.playerConfig.src,_loop_2=function(W){B=B.then((function(){return F.loadScript(F.container.ownerDocument,K[W],G)}))};for(z=0;z<K.length;z++)_loop_2(z);return B},HlsPlayer.prototype.tryLoadSdnPlugin=function(){var F=this;if(this.sdnLoaded||!this.liveStreamOptions.sdn)return Promise.resolve();if(!this.configProvider.config.allowSdnPlugins)return this.log("Loading SDN plugins is not allowed"),Promise.reject("Loading SDN plugins is not allowed");Promise.resolve();return this.log("tryLoadSdn started"),this.loadScript(this.container.ownerDocument,this.liveStreamOptions.sdn.url,this.configProvider.playerConfig.nonce).then((function(){return F.log("SDN script loaded"),F.loadScript(F.container.ownerDocument,F.liveStreamOptions.sdn.plugin,F.configProvider.playerConfig.nonce).then((function(){F.log("SDN plugin loaded"),F.sdnLoaded=!0,F.log("tryLoadSdn done")}))}))},HlsPlayer.prototype.createHls=function(){var z,K;if(this.log("createHls started"),this.contextWindow.define=this.tempDefine,this.createVideoElement(),this.contextWindow.Hls.isSupported())this.media=new G(this.video,this.contextWindow,this.log.bind(this),this.getHlsConfig());else{if(!this.video.canPlayType("application/vnd.apple.mpegurl")){var J="Your browser cannot support HLS streaming";throw this.log("Error: ".concat(J),"error"),new Error(J)}this.media=new W(this.video,this.log.bind(this))}this.diagnosticProvider=new F(null===(K=(z=this.media).getPlayer)||void 0===K?void 0:K.call(z),this.contextWindow,this.video,this.media),this.addCaptionsTracks(this.liveStreamOptions.supportedSubtitleLanguages);var Q={isOverflow:this.liveStreamOptions.overflow,logFn:this.log.bind(this),removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack};this.captionsControl=new B(this.video,this,Q),this.registerMediaEvents(),this.initialState=!0,this.log("createHls done")},HlsPlayer.prototype.setSource=function(F){if(this.log("setSource started"),!this.media)throw this.log("setSource failed: playerInstance is null","error"),new Error("playerInstance is null");this.media.setSource(F),this.currentStreamingUrl=F.url,this.configureSdnSource(F)},HlsPlayer.prototype.switchStreamingUrl=function(F){if(this.video.readyState>2)this.log("Not switching as video is building","warn");else{if(!this.media)throw this.log("setSource failed: playerInstance is null","error"),new Error("playerInstance is null");this.media.switchStreamingUrl(F)}},HlsPlayer.prototype.setPlayTime=function(F){F&&(this.log("setPlayerTime: ".concat(F)),this.video.currentTime=F)},HlsPlayer.prototype.dispose=function(){this.log("dispose started"),this.diagnosticProvider&&(this.stopStatsColletion(),this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.media&&(this.media.destroy(),this.media=null),this.eventsHandler.hlsDisposed(),this.video&&this.video.parentNode&&(this.video.parentNode.removeChild(this.video),this.video=null),this.log("dispose done"),this.eventsHandler=null},HlsPlayer.prototype.showCaptions=function(F){this.log("showCaptions: ".concat(F)),this.captionsControl.showCaptions(F)},HlsPlayer.prototype.addCues=function(F){this.captionsControl.addCues(F)},HlsPlayer.prototype.clearCues=function(){this.captionsControl.clearCues()},HlsPlayer.prototype.captionsToggled=function(F,B,G){this.log("captionsToggled: ".concat(F," for culture ").concat(B," at ").concat(G)),this.eventsHandler.message("captionsToggled").send(F,B,G)},HlsPlayer.prototype.getHlsConfig=function(){var F=this,B={autoStartLoad:!1,fragLoadingMaxRetry:5,debug:this.configProvider.config.debug,nudgeOffset:.5,nudgeMaxRetry:6,maxBufferLength:60,liveSyncDuration:7,liveMaxLatencyDuration:10,maxLiveSyncPlaybackRate:1.1,fragLoadingRetryDelay:100,manifestLoadingRetryDelay:100,fragLoadingMaxRetryTimeout:500,manifestLoadingMaxRetryTimeout:500,levelLoadingMaxRetryTimeout:500,liveDurationInfinity:!0,fragLoadingTimeOut:8e3,manifestLoadingTimeOut:8e3,levelLoadingTimeOut:8e3,manifestLoadingMaxRetry:2,levelLoadingRetryDelay:100,startFragPrefetch:!0,stretchShortVideoTrack:!0,lowLatencyMode:!0,abrEwmaDefaultEstimate:26e5};return this.configProvider.config.hlsSettings&&(Object.keys(this.configProvider.config.hlsSettings).forEach((function(B){F.contextWindow.Hls.DefaultConfig.hasOwnProperty(B)||(F.log("Invalid property: ".concat(B)),delete F.configProvider.config.hlsSettings[B])})),Object.assign(B,this.configProvider.config.hlsSettings),this.log("Applying HLS config: ".concat(JSON.stringify(B)))),B},HlsPlayer.prototype.createVideoElement=function(){this.log("createVideoElement started"),this.video=this.container.ownerDocument.createElement("video"),this.video.controls=!this.liveStreamOptions.overflow,this.video.id="hls-player",this.video.setAttribute("playsinline","");var F=this.configProvider.playerConfig.lang;F&&(this.video.setAttribute("lang",F),this.log("createVideoElement: language set to ".concat(F)));for(var B=this.configProvider.playerConfig.styles,G=0;G<B.length;G++)this.video.classList.add(B[G]);this.video.style.width="100%",this.video.style.height="100%",this.container.appendChild(this.video),this.log("createVideoElement done")},HlsPlayer.prototype.addCaptionsTracks=function(F){var B=this;F&&F.forEach((function(F){B.log("addCaptionsTracks for ".concat(F.name)),B.video.addTextTrack(B.configProvider.config.textTrackKind,F.name,F.culture)}))},HlsPlayer.prototype.configureSdnSource=function(F){if(this.sdnLoaded&&this.liveStreamOptions.sdn){var B=this.liveStreamOptions.sdn.name;if(null==F?void 0:F.sdnContext)try{var G=JSON.parse(F.sdnContext);if(G.streamingPlatformEventId){var W=/^19:meeting_/,z=/@thread\.v2$/;G.streamingPlatformEventId=decodeURIComponent(G.streamingPlatformEventId),G.streamingPlatformEventId=G.streamingPlatformEventId.replace(W,"PE:").replace(z,"")}switch(G.RTCIceCandidates&&(G.RTCIceCandidates=G.RTCIceCandidates.map((function(F){return new RTCIceCandidate(JSON.parse(F))}))),B){case"peer5":case"microsoft":this.contextWindow.peer5.configure(G);break;default:return void this.log("configureSdnSource failed, error: Unknown SDN Name: ".concat(B),"error")}}catch(F){this.log("configureSdnSource failed for ".concat(B,", error: ").concat(F),"error")}else this.log("configureSdnSource failed, error: SDN context for ".concat(B," is null"),"error")}},HlsPlayer.prototype.log=function(F,B){void 0===B&&(B="info");var G="[HlsPlayer".concat(1===this.configProvider.config.loadType?"IFrame":"","]"),W="".concat(G,": ").concat(F);this.configProvider.config.debug&&console.log(W),this.eventsHandler.message("log").send(B,W)},HlsPlayer.prototype.getElementLoadPromise=function(F){return new Promise((function(B,G){F.onload=function(){B()},F.onerror=function(F){G(F)}}))},HlsPlayer.prototype.loadScript=function(F,B,G){var W=F.createElement("script"),z=this.getElementLoadPromise(W);return W.src=B,G&&(W.nonce=G),F.defaultView.define&&(this.tempDefine=F.defaultView.define,F.defaultView.define=null),F.head.appendChild(W),z},HlsPlayer.prototype.initializeStatsColletion=function(){var F=this;this.statsTimer=window.setInterval((function(){F.eventsHandler&&F.eventsHandler.message("statsUpdated").send(F.getPlayerDiagnostics())}),this.statsInterval),this.contextWindow.peer5&&this.configProvider.config.debug&&this.contextWindow.peer5.showStats()},HlsPlayer.prototype.stopStatsColletion=function(){this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),-1!==this.statsTimer&&window.clearInterval(this.statsTimer),this.statsTimer=-1},HlsPlayer.prototype.getPlayerDiagnostics=function(){var F=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return F.statsInterval=this.statsInterval,F},HlsPlayer.prototype.registerMediaEvents=function(){var F=this,B={passive:!0};this.video.addEventListener("seeking",(function(){F.onHlsEvent("seeking")}),B),this.video.addEventListener("seeked",(function(){F.onHlsEvent("seeked")}),B),this.video.addEventListener("pause",(function(){F.onHlsEvent("pause")}),B),this.video.addEventListener("play",(function(){F.onHlsEvent("play")}),B),this.video.addEventListener("playing",(function(){F.onHlsEvent("playing"),F.initialState&&(F.onHlsEvent("start"),F.initialState=!1);var B=Date.now(),G=0===F.lastWaitTime?0:B-F.lastWaitTime;F.log("Player stalled for ".concat(G," ms, resumed playing at ").concat(B,", url:").concat(F.currentStreamingUrl),"debug"),self.clearTimeout(F.stallingTimeoutId),F.stallingTimeoutId=-1,F.lastWaitTime=0}),B),this.video.addEventListener("canplaythrough",(function(){F.onHlsEvent("canplaythrough")}),B),this.video.addEventListener("loadstart",(function(){F.onHlsEvent("loadstart")}),B),this.video.addEventListener("loadeddata",(function(){F.onHlsEvent("loadeddata"),F.video.readyState>=2&&(F.video.play(),F.initializeStatsColletion())}),B),this.video.addEventListener("loadedmetadata",(function(){F.onHlsEvent("loadedmetadata")}),B),this.video.addEventListener("volumechange",(function(){F.onHlsEvent("volumechange",{value:F.video.volume})}),B),this.video.addEventListener("waiting",(function(){F.onHlsEvent("waiting");var B=Date.now();F.log("Player stalling at ".concat(B,", url:").concat(F.currentStreamingUrl,", previous stallingTimeoutId:").concat(F.stallingTimeoutId,", lastWaitTime:").concat(F.lastWaitTime," "),"debug"),-1===F.stallingTimeoutId&&(F.lastWaitTime=B,F.stallingTimeoutId=self.setTimeout((function(){return F.handleWaitingEvent()}),F.configProvider.config.timeoutForSwitchingUrl))}),B),this.video.addEventListener("stalled",(function(){F.onHlsEvent("stalled")}),B),this.video.addEventListener("ended",(function(){F.video.currentTime=0,F.onHlsEvent("ended")}),B),this.video.addEventListener(this.contextWindow.Hls.Events.LEVEL_SWITCHED,(function(B){F.onHlsEvent("playbackbitratechanged",B.detail),F.onHlsEvent("downloadbitratechanged",B.detail)}),B),Object.keys(this.contextWindow.Hls.ErrorTypes).forEach((function(G){F.video.addEventListener(F.contextWindow.Hls.ErrorTypes[G],(function(B){F.emitError(B.type,B.detail.data.details,B.detail.data.fatal)}),B)})),this.video.addEventListener(this.contextWindow.Hls.ErrorTypes.NETWORK_ERROR,(function(B){F.diagnosticProvider.registerForPlayerFragDownloadEvents(B)}),B),this.video.addEventListener(this.contextWindow.Hls.Events.FRAG_LOADED,(function(B){F.diagnosticProvider.registerForPlayerFragDownloadEvents(B)}),B)},HlsPlayer.prototype.emitError=function(F,B,G){var W={currentTime:this.video?this.video.currentTime:0,message:B,type:F,errorCode:0,fatal:G};this.diagnosticProvider.setError(B,F),this.onHlsEvent("error",W)},HlsPlayer.prototype.onHlsEvent=function(F,B){if("loadedmetadata"===F)this.captionsControl.initialize();else this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),this.eventsHandler.message("stateChanged").send(F,B)},HlsPlayer.prototype.loadCss=function(F,B,G){var W=F.createElement("link"),z=this.getElementLoadPromise(W);return W.href=B,W.rel="stylesheet",G&&(W.nonce=G),F.head.appendChild(W),z},HlsPlayer.prototype.handleWaitingEvent=function(){var F=Date.now(),B=this.video.currentTime,G=this.shouldSkipRecovery(),W="Player stall timeout at ".concat(F,", url:").concat(this.currentStreamingUrl,", currTime:").concat(B,", shouldSkipRecovery:").concat(G," ");this.log(W,"debug"),G||this.emitError("networkError",W,!0)},HlsPlayer.prototype.shouldSkipRecovery=function(){return!this.video||this.video.paused||this.video.ended||0===this.video.playbackRate||this.video.seeking||this.video.readyState>2},HlsPlayer}()}function HlsCommunicationHandlerF(){var F=HlsPlayerF();return function(){function HlsCommunicationHandler(B,G){this.pipe=B,this.hls=new F(G,this)}return HlsCommunicationHandler.prototype.processMessage=function(F){var B=this;"Command"===F.msgType&&Promise.resolve().then((function(){return B.hls[F.cmd].apply(B.hls,F.args)})).catch((function(F){return F})).then((function(G){B.pipe&&B.pipe.sendMsg({msgType:"CommandResult",cmd:F.cmd,error:G})}))},HlsCommunicationHandler.prototype.message=function(F){var B=this;return{send:this.fromMessage((function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];B.sendMessageImpl(F,G)}))}},HlsCommunicationHandler.prototype.hlsDisposed=function(){this.pipe.dispose(),this.pipe=null,this.hls=null},HlsCommunicationHandler.prototype.fromMessage=function(F){return F},HlsCommunicationHandler.prototype.sendMessageImpl=function(F,B){this.pipe.sendMsg({msgType:"PlayerNotification",name:F,args:B})},HlsCommunicationHandler}()}function IFrameMessageHandlerF(){function isCmdResult(F){return"CommandResult"===F.msgType}function getErrorString(F){var B="unknown";try{B="string"==typeof F?F:"toString"in F&&0!==F.toString().indexOf("[object")?F.toString():JSON.stringify(F)}catch(B){console.error("Failed to stringify error",F)}return B}return function(){function IFrameMessageHandler(){this.processMsg=this.processMsg.bind(this),window.addEventListener("message",this.processMsg)}return IFrameMessageHandler.prototype.sendMsg=function(F){try{var B=F;isCmdResult(F)&&F.error instanceof Event&&(console.debug("Stringifying error Event before trying to postMessage:",F),B={msgType:F.msgType,cmd:F.cmd,error:"Event: ".concat(getErrorString(F.error))}),this.postMessage(B)}catch(B){console.error("Unexpected exception caught from postMessage.\n","message:",F,"\n","exception:",B);var G={msgType:"PlayerNotification",name:"log",args:["error","Unexpected error with postMessage: ".concat(getErrorString(B))]};throw this.postMessage(G),B}},IFrameMessageHandler.prototype.registerObserver=function(F){this.observer=F},IFrameMessageHandler.prototype.dispose=function(){window.removeEventListener("message",this.processMsg),this.observer=null},IFrameMessageHandler.prototype.processMsg=function(F){this.observer.processMessage(F.data)},IFrameMessageHandler.prototype.postMessage=function(F){window.parent.postMessage(F,"*")},IFrameMessageHandler}()}function HlsDiagnosticProviderF(){return function(){function HlsDiagnosticProvider(F,B,G,W){this.playerInstance=F,this.contextWindow=B,this.video=G,this.media=W,this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailures=[],this.videoDownloadFailures=[],this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=30,this.downloadFailuresLimit=10,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}return HlsDiagnosticProvider.prototype.getPlayerDiagnosticSnapshot=function(){var F,B,G,W,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge=window.screen,mean=function(F){var B=F.slice().sort();return B[Math.floor(B.length/2)]},fe=this.video.getVideoPlaybackQuality();return{playerType:1,errorCode:0,errorMessage:this.errorMessage,errorType:this.errorType,currentPlayPosition:this.video.currentTime,currentMediaTime:this.video.currentTime,currentAbsoluteTime:this.video.currentTime,livePosition:null===(F=this.playerInstance)||void 0===F?void 0:F.liveSyncPosition,playbackBitrate:-1!==(null===(B=this.playerInstance)||void 0===B?void 0:B.currentLevel)?null===(G=this.playerInstance)||void 0===G?void 0:G.levels[this.playerInstance.currentLevel].bitrate:void 0,downloadBitrate:-1!==(null===(W=this.playerInstance)||void 0===W?void 0:W.currentLevel)?null===(z=this.playerInstance)||void 0===z?void 0:z.levels[this.playerInstance.currentLevel].bitrate:void 0,perceivedBandwidth:null===(K=this.playerInstance)||void 0===K?void 0:K.bandwidthEstimate,tech:this.playerInstance?"hls":"html5",playerVersion:this.contextWindow.Hls.version,isP2PSdnUsed:!!this.contextWindow.peer5&&this.contextWindow.peer5.getStats().numOfPeers>0,sdnName:this.contextWindow.peer5?"microsoft":void 0,sdnStats:null===(J=this.contextWindow.peer5)||void 0===J?void 0:J.getStats(),sdnVersion:null===(Q=this.contextWindow.peer5)||void 0===Q?void 0:Q.version,heuristicProfile:"HighQuality",encryption:void 0,streamType:-1!==(null===(Y=this.playerInstance)||void 0===Y?void 0:Y.currentLevel)?null===($=this.playerInstance)||void 0===$?void 0:$.levels[this.playerInstance.currentLevel].details.type:void 0,audioStream:this.getAudioStreamData(),videoStream:this.getVideoStreamData(),muted:this.video.muted,volume:this.video.volume,audioBufferLength:this.video.buffered.length>0?this.video.buffered.end(0)-this.video.buffered.start(0):0,videoBufferLength:this.video.buffered.length>0?this.video.buffered.end(0)-this.video.buffered.start(0):0,mediaHeight:-1!==(null===(X=this.playerInstance)||void 0===X?void 0:X.currentLevel)?null===(Z=this.playerInstance)||void 0===Z?void 0:Z.levels[this.playerInstance.currentLevel].height:void 0,mediaWidth:-1!==(null===(ee=this.playerInstance)||void 0===ee?void 0:ee.currentLevel)?null===(te=this.playerInstance)||void 0===te?void 0:te.levels[this.playerInstance.currentLevel].width:void 0,playerHeight:-1!==(null===(ne=this.playerInstance)||void 0===ne?void 0:ne.currentLevel)?null===(ie=this.playerInstance)||void 0===ie?void 0:ie.levels[this.playerInstance.currentLevel].height:void 0,playerWidth:-1!==(null===(re=this.playerInstance)||void 0===re?void 0:re.currentLevel)?null===(oe=this.playerInstance)||void 0===oe?void 0:oe.levels[this.playerInstance.currentLevel].width:void 0,windowWidth:ge?ge.width:0,windowHeight:ge?ge.height:0,isFullscreen:document.fullscreenElement===this.video,avgAudioDownloadLatency:mean(this.audioDownloadLatencies),avgVideoDownloadLatency:mean(this.videoDownloadLatencies),avgAudioDownloadBytes:mean(this.audioDownloadBytes),avgVideoDownloadBytes:mean(this.videoDownloadBytes),maxVideoDownloadBytes:Math.max.apply(null,this.videoDownloadBytes),minVideoDownloadBytes:Math.min.apply(null,this.videoDownloadBytes),audioDownloadFailureCount:this.audioDownloadFailureCount,audioDownloadSuccessCount:this.audioDownloadSuccessCount,videoDownloadFailureCount:this.videoDownloadFailureCount,videoDownloadSuccessCount:this.videoDownloadSuccessCount,audioDownloadFailures:this.audioDownloadFailures,videoDownloadFailures:this.videoDownloadFailures,corruptedVideoFrames:fe.corruptedVideoFrames,creationTime:fe.creationTime,droppedVideoFrames:fe.droppedVideoFrames,totalVideoFrames:fe.totalVideoFrames,errorMSRequestIds:null===(se=(ae=this.media).getMSErrorRequestIds)||void 0===se?void 0:se.call(ae),errorUuids:null===(le=(ce=this.media).getErrorUuids)||void 0===le?void 0:le.call(ce),successMSRequestIds:null===(ue=(de=this.media).getMSSuccessRequestIds)||void 0===ue?void 0:ue.call(de),successUuids:null===(he=(pe=this.media).getSuccessUuids)||void 0===he?void 0:he.call(pe),recentHopLatencyMetrics:null,overallHopLatencyMetrics:null,serviceAvgLatency:null,endToEndAvgLatency:null,memoryLog:null,statsInterval:null}},HlsDiagnosticProvider.prototype.setError=function(F,B){this.errorMessage=F,this.errorType=B},HlsDiagnosticProvider.prototype.dispose=function(){},HlsDiagnosticProvider.prototype.registerForPlayerFragDownloadEvents=function(F){var B=F.detail.data;if(B.details===this.contextWindow.Hls.ErrorDetails.FRAG_LOAD_ERROR){var G=F.detail.bitrate;switch(B.frag.type){case"audio":this.onAudioDownloadError(B.frag.duration,B.details,B.type,G);break;case"main":this.onVideoDownloadError(B.frag.duration,B.details,B.type,G)}}else if(F.type===this.contextWindow.Hls.Events.FRAG_LOADED)switch(B.frag.type){case"audio":this.onAudioDownloadCompleted(B.frag.duration,B.frag.stats.total);break;case"main":this.onVideoDownloadCompleted(B.frag.duration,B.frag.stats.total)}},HlsDiagnosticProvider.prototype.onVideoDownloadCompleted=function(F,B){this.videoDownloadSuccessCount++,this.addToList(this.videoDownloadLatencies,F,this.slidingWindowLengthForLatency),this.addToList(this.videoDownloadBytes,B,this.slidingWindowLengthForDownloadBytes)},HlsDiagnosticProvider.prototype.onAudioDownloadCompleted=function(F,B){this.audioDownloadSuccessCount++,this.addToList(this.audioDownloadLatencies,F,this.slidingWindowLengthForLatency),this.addToList(this.audioDownloadBytes,B,this.slidingWindowLengthForDownloadBytes)},HlsDiagnosticProvider.prototype.addToList=function(F,B,G){F.push(B),F.length>G&&F.shift()},HlsDiagnosticProvider.prototype.onVideoDownloadError=function(F,B,G,W){this.videoDownloadFailureCount++,this.addDownloadFailureInfo(F,B,G,this.videoDownloadFailures,W)},HlsDiagnosticProvider.prototype.onAudioDownloadError=function(F,B,G,W){this.audioDownloadFailureCount++,this.addDownloadFailureInfo(F,B,G,this.audioDownloadFailures,W)},HlsDiagnosticProvider.prototype.addDownloadFailureInfo=function(F,B,G,W,z){var K={bitrate:z,errorCode:0,mediaTime:F,message:B,type:G,timestamp:Date.now()};this.addToList(W,K,this.downloadFailuresLimit)},HlsDiagnosticProvider.prototype.getAudioStreamData=function(){var F;if(this.playerInstance&&-1!==(null===(F=this.playerInstance)||void 0===F?void 0:F.currentLevel))try{var B=this.playerInstance.levels[this.playerInstance.currentLevel];return{bitrate:B.bitrate,codec:B.audioCodec,enabled:!0,name:B.audioCodec,language:void 0}}catch(F){return}},HlsDiagnosticProvider.prototype.getVideoStreamData=function(){var F;if(this.playerInstance&&-1!==(null===(F=this.playerInstance)||void 0===F?void 0:F.currentLevel))try{var B=this.playerInstance.levels[this.playerInstance.currentLevel],G={bitrate:B.bitrate,codec:B.videoCodec,height:B.height,id:B.videoCodec,selectable:!0,width:B.width};return{codec:B.videoCodec,name:B.videoCodec,currentTrack:G}}catch(F){return}},HlsDiagnosticProvider}()}function CaptionsControlToggleProviderF(){return function(){function CaptionsControlToggleProvider(F,B,G){this.media=F,this.toggleListener=B,this.config=G,this.onTextTrackChanged=this.onTextTrackChanged.bind(this)}return CaptionsControlToggleProvider.prototype.dispose=function(){this.unsubscribeFromTrackEvents(),this.media=null,this.toggleListener=null},CaptionsControlToggleProvider.prototype.initialize=function(){for(var F=this.getTextTracks(),B=0;B<F.length;B++)F[B].mode="disabled";this.subscribeOnTrackEvents()},CaptionsControlToggleProvider.prototype.addCues=function(F){var B=this.getCurrentTextTrack();if(B){var G=this.getCurrentTime()||1,W=this.getCurrentTime(),z=this.config.isOverflow?Math.max(G-W,0):G-W;this.config.logFn("[CaptionsControl]: addCues, captionOffsetTime => ".concat(z));for(var K=0;K<F.length;K++){var J=F[K],Q=J.start,Y=J.end,$=J.text,X=6,Z=Number((Q+z).toFixed(X)),ee=Number((Y+z).toFixed(X)),te=new VTTCue(Z,ee,$);!this.containsCue(B,te)&&B.addCue(te)}}},CaptionsControlToggleProvider.prototype.clearCues=function(){var removeAllCues=function(F){if(F&&F.cues)for(;F.cues.length;)F.removeCue(F.cues[0])};removeAllCues(this.previouslyVisibleTextTrack),removeAllCues(this.currentTextTrack)},CaptionsControlToggleProvider.prototype.getTextTracks=function(){return this.media.textTracks},CaptionsControlToggleProvider.prototype.getCurrentTime=function(){return this.media.currentTime},CaptionsControlToggleProvider.prototype.getCurrentTextTrack=function(){for(var F=this.getTextTracks(),B=0;F&&B<F.length;B++)if("showing"===F[B].mode)return F[B];return null},CaptionsControlToggleProvider.prototype.showCaptions=function(F){this.config.logFn("[CaptionsControl]: showCaptions(".concat(F,")")),F?this.show():this.hide()},CaptionsControlToggleProvider.prototype.hide=function(){this.previouslyVisibleTextTrack=this.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="disabled")},CaptionsControlToggleProvider.prototype.show=function(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="showing")},CaptionsControlToggleProvider.prototype.subscribeOnTrackEvents=function(){var F=this.getTextTracks(),B="addEventListener";F&&F[B]&&(F[B]("change",this.onTextTrackChanged),this.config.removeEmptyDefaultTextTrack&&F[B]("addtrack",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.unsubscribeFromTrackEvents=function(){var F=this.getTextTracks(),B="removeEventListener";F&&F[B]&&(F[B]("change",this.onTextTrackChanged),this.config.removeEmptyDefaultTextTrack&&F[B]("addtrack",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.onTextTrackChanged=function(){var F=this.getCurrentTextTrack();if(!F||!this.currentTextTrack||this.currentTextTrack.label!==F.label||this.currentTextTrack.mode!==F.mode){if(F||this.currentTextTrack){var B=!!F&&"showing"===F.mode,G=this.getCulture(F||this.currentTextTrack),W=this.getCurrentTime();this.toggleListener.captionsToggled(B,G,W),this.config.logFn("[CaptionsControl]: track changed: culture '".concat(G,"', timestamp '").concat(W,"'"))}this.currentTextTrack=F}},CaptionsControlToggleProvider.prototype.onAddTrack=function(F){var B,G,W=null==F?void 0:F.track;"captions"===(null==W?void 0:W.kind)&&!W.label&&!W.id&&(null===(G=null===(B=this.media)||void 0===B?void 0:B.textTracks_)||void 0===G||G.removeTrack_(W),this.config.logFn("[CaptionsControl]: removing default empty text track"))},CaptionsControlToggleProvider.prototype.getCulture=function(F){if(F&&F.id){var B=F.id.split("_")[1];if(B)return B}else if(F&&F.language)return F.language;return""},CaptionsControlToggleProvider.prototype.containsCue=function(F,B){var G=this;return Array.from((null==F?void 0:F.cues)||[]).some((function(F){return G.areCueEquals(F,B)}))},CaptionsControlToggleProvider.prototype.areCueEquals=function(F,B){return F.startTime===B.startTime&&F.endTime===B.endTime&&F.id===B.id&&F.text===B.text},CaptionsControlToggleProvider}()}function initIFrame(){var F=IFrameMessageHandlerF(),B=HlsCommunicationHandlerF(),G=new F,W=new B(G,document.body);G.registerObserver(W)}function Html5MediaF(){return function(){function Html5Media(F,B){this.element=F,this.logFn=B;var G={passive:!0};this._dispatchError=this._dispatchError.bind(this),this.element.addEventListener("error",this._dispatchError,G),this.logFn("Created Html5Media")}return Object.defineProperty(Html5Media.prototype,"averageTargetDuration",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(Html5Media.prototype,"tech",{get:function(){return"NativeHls"},enumerable:!1,configurable:!0}),Html5Media.prototype.setSource=function(F){this.element.src=F.url,this.logFn("Set Source completed")},Html5Media.prototype.destroy=function(){this.element.removeEventListener("error",this._dispatchError),this.logFn("Destroyed Html5Media")},Html5Media.prototype.switchStreamingUrl=function(F){this.logFn("Switching streaming url from HTML5Media at now:".concat(Date.now()," currTime:").concat(this.element.currentTime),"warn"),this.setSource(F)},Html5Media.prototype._addEvent=function(F,B){var G={};return B&&B.detail&&(G={detail:B.detail}),new CustomEvent(F,G)},Html5Media.prototype._dispatchError=function(F){var B,G=F.target,W=null==G?void 0:G.error;switch(null==W?void 0:W.code){case null==W?void 0:W.MEDIA_ERR_ABORTED:B="Media playback aborted";break;case null==W?void 0:W.MEDIA_ERR_NETWORK:B="Media download failed part-way due to a network error";break;case null==W?void 0:W.MEDIA_ERR_DECODE:B="Media playback aborted due to a corruption problem or because the\n                        media used features your browser did not support.";break;case null==W?void 0:W.MEDIA_ERR_SRC_NOT_SUPPORTED:B="Media could not be loaded, either because the server or network failed\n                        or because the format is not supported.";break;default:B="Unknown error occurred."}this.logFn("Html5Media received ".concat(null==W?void 0:W.message," errCode: ").concat(null==W?void 0:W.code),"error");var z=this._addEvent("networkError",{detail:{data:{fatal:!0,details:"".concat(B," errCode:").concat(null==W?void 0:W.code)},bitrate:void 0}});this.element.dispatchEvent(z)},Html5Media}()}function HlsMediaF(){return function(){function HlsMedia(F,B,G,W){this.element=F,this.contextWindow=B,this.logFn=G,this.hlsConfig=W,this.recoverDecodingErrorDate=0,this.recoverSwapAudioCodecDate=0,this.errorMSRequestIds=[],this.errorUuids=[],this.successMSRequestIds=[],this.successUuids=[],this._create=this._create.bind(this),this._play=this._play.bind(this),this._pause=this._pause.bind(this),this._assign=this._assign.bind(this),this._handleError=this._handleError.bind(this),this.hlsConfig.xhrSetup=function(F,B){-1!==B.indexOf("keydelivery")&&(F.withCredentials=!0)},this._create()}return Object.defineProperty(HlsMedia.prototype,"averageTargetDuration",{get:function(){var F,B,G,W;return(null===(W=null===(G=null===(F=this.player)||void 0===F?void 0:F.levels[null===(B=this.player)||void 0===B?void 0:B.currentLevel])||void 0===G?void 0:G.details)||void 0===W?void 0:W.averagetargetduration)||0},enumerable:!1,configurable:!0}),Object.defineProperty(HlsMedia.prototype,"tech",{get:function(){return"Hls"},enumerable:!1,configurable:!0}),HlsMedia.prototype.getPlayer=function(){return this.player},HlsMedia.prototype.getMSErrorRequestIds=function(){return this.errorMSRequestIds},HlsMedia.prototype.getErrorUuids=function(){return this.errorUuids},HlsMedia.prototype.getMSSuccessRequestIds=function(){return this.successMSRequestIds},HlsMedia.prototype.getSuccessUuids=function(){return this.successUuids},HlsMedia.prototype.setSource=function(F){if(-1===F.url.indexOf("m3u8"))throw new Error("Invalid stream ".concat(F.url));this.player.loadSource(F.url),this.logFn("Set Source completed")},HlsMedia.prototype.destroy=function(){this.player&&(this.logFn("destroying HlsMedia"),this.player.destroy(),this.player=null)},HlsMedia.prototype.switchStreamingUrl=function(F){var B=Math.max(this.player.bandwidthEstimate||0,this.contextWindow.Hls.DefaultConfig.abrEwmaDefaultEstimate),G=Math.max(this.player.currentLevel,0);this.hlsConfig.startLevel=G,this.hlsConfig.abrEwmaDefaultEstimate=B,this.logFn("Switching streaming url from HlsMedia at now:".concat(Date.now()," currTime:").concat(this.element.currentTime,", startLevel:").concat(G,", bandwidthEstimate:").concat(B),"warn"),this.destroy(),this._create(),this.setSource(F)},HlsMedia.prototype._create=function(){var F=this;this.player=new this.contextWindow.Hls(this.hlsConfig),this.events=this.contextWindow.Hls.Events,Object.keys(this.events).forEach((function(B){F.player.on(F.events[B],(function(){for(var G=[],W=0;W<arguments.length;W++)G[W]=arguments[W];F._assign(F.events[B],G)}))})),this.player.attachMedia(this.element),this.logFn("Created HlsMedia")},HlsMedia.prototype._play=function(){this.player&&(this.logFn("Started Playing"),this.player.startLoad())},HlsMedia.prototype._pause=function(){this.player&&(this.logFn("Paused Playing"),this.player.stopLoad())},HlsMedia.prototype._logRequestId=function(F,B){if(B[1]){var G=B[1].networkDetails;if(G){var W=G.getResponseHeader("x-ms-request-id"),z=G.getResponseHeader("uuid");z&&(F===this.contextWindow.Hls.Events.ERROR?this.errorUuids.push(z):this.successUuids.push(z)),W&&(F===this.contextWindow.Hls.Events.ERROR?this.errorMSRequestIds.push(W):this.successMSRequestIds.push(W))}}},HlsMedia.prototype._assign=function(F,B){switch(this._logRequestId(F,B),F){case this.contextWindow.Hls.Events.ERROR:this._handleError(B);break;case this.contextWindow.Hls.Events.MEDIA_ATTACHED:this.logFn("video and hls.js are now bound together ! Event:".concat(F));break;case this.contextWindow.Hls.Events.MANIFEST_PARSED:this.logFn("Starting HLS load Event:".concat(F)),this._play();break;case this.contextWindow.Hls.Events.LEVEL_SWITCHED:this.element.dispatchEvent(this._addEvent(F,{detail:{bitrate:this.player.levels[B[1].level].bitrate}}));break;case this.contextWindow.Hls.Events.FRAG_LOADED:this.element.dispatchEvent(this._addEvent(F,{detail:{data:B[1]}}))}},HlsMedia.prototype._addEvent=function(F,B){var G={};return B&&B.detail&&(G={detail:B.detail}),new CustomEvent(F,G)},HlsMedia.prototype._handleError=function(F){var B=F[1].type,G=F[1].fatal;this.logFn("HLS Error type: ".concat(B," details: ").concat(F[1].details," fatal: ").concat(G),"error");var W=-1!==this.player.currentLevel?this.player.levels[this.player.currentLevel].bitrate:void 0;if(G){var z=this._addEvent(B,{detail:{data:F[1]}});switch(B){case this.contextWindow.Hls.ErrorTypes.MEDIA_ERROR:this.handleMediaError(z);break;case this.contextWindow.Hls.ErrorTypes.NETWORK_ERROR:console.error("Network error type:".concat(B," fatal:").concat(G)),F[1].details===this.contextWindow.Hls.ErrorDetails.FRAG_LOAD_ERROR&&(F[1].fatal=!1,this.player.startLoad(this.element.currentTime)),this.element.dispatchEvent(this._addEvent(B,{detail:{data:F[1],bitrate:W}}));break;default:this.element.dispatchEvent(z)}}else if(F[1].details===this.contextWindow.Hls.ErrorDetails.FRAG_LOAD_ERROR){var K=this._addEvent(B,{detail:{data:F[1],bitrate:W}});this.element.dispatchEvent(K)}},HlsMedia.prototype.handleMediaError=function(F){var B=Date.now();!this.recoverDecodingErrorDate||B-this.recoverDecodingErrorDate>3e3?(this.logFn("Attempting to recover from media error at ".concat(B,", currenTime:").concat(this.element.currentTime),"warn"),this.recoverDecodingErrorDate=B,this.player.recoverMediaError()):!this.recoverSwapAudioCodecDate||B-this.recoverSwapAudioCodecDate>3e3?(this.recoverSwapAudioCodecDate=B,this.logFn("Attempting to swap Audio Codec and recover from media error at ".concat(B,", currenTime:").concat(this.element.currentTime),"warn"),this.player.swapAudioCodec(),this.player.recoverMediaError()):(this.logFn("Cannot recover, last media error recovery failed at ".concat(B,", currenTime:").concat(this.element.currentTime),"error"),this.element.dispatchEvent(F))},HlsMedia}()}function buildHlsEmbededSrc(){var F="(".concat(initIFrame.toString(),")();");return F+=HlsPlayerF.toString()+";",F+=IFrameMessageHandlerF.toString()+";",F+=HlsCommunicationHandlerF.toString()+";",F+=CaptionsControlToggleProviderF.toString()+";",F+=HlsDiagnosticProviderF.toString()+";",F+=HlsMediaF.toString()+";",F+=Html5MediaF.toString()+";",F+="//# sourceURL=TsCallingHlsPlayer.js"}Object.defineProperty(B,"__esModule",{value:!0}),B.buildHlsEmbededSrc=B.CaptionsControlToggleProvider=B.HlsDiagnosticProvider=B.IFrameMessageHandler=B.HlsCommunicationHandler=B.HlsPlayer=void 0,B.HlsPlayer=HlsPlayerF(),B.HlsCommunicationHandler=HlsCommunicationHandlerF(),B.IFrameMessageHandler=IFrameMessageHandlerF(),B.HlsDiagnosticProvider=HlsDiagnosticProviderF(),B.CaptionsControlToggleProvider=CaptionsControlToggleProviderF(),B.buildHlsEmbededSrc=buildHlsEmbededSrc},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.HlsLiveStreamPlayer=void 0;var Q,Y=G(15),$=G(26),X=G(168),Z=G(169),ee=G(77),te=G(170);!function(F){F.NETWORK_ERROR="networkError",F.MEDIA_ERROR="mediaError",F.KEY_SYSTEM_ERROR="keySystemError",F.MUX_ERROR="muxError",F.OTHER_ERROR="otherError"}(Q||(Q={}));var ne=function(F){function HlsLiveStreamPlayer(B,G,W){var z=F.call(this)||this;return z.logger=B,z.liveStreamStatistic=G,z.configProvider=W,z.playerState="Destroyed",z.captionsTimestamp=0,z.isSwitchStreamingUrlOngoing=!1,z.streamingUrlSwitchCount=0,z}return z(HlsLiveStreamPlayer,F),HlsLiveStreamPlayer.prototype.configure=function(F){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:return ee.isStreamValid(F.stream)||ee.isStreamValid(F.altStream)?(this.logger.info("Live Stream configuration provided"),this.liveStreamOptions=F,B=ee.isStreamValid(F.stream)?F.stream:F.altStream,this.playerInstance?[4,this.handleStreamInfoUpdate(B)]:(this.selectedStreamDetails=B,[2])):(this.logger.error("Invalid Live Stream configuration provided: no valid primary or alternative stream"),[2]);case 1:return G.sent(),[2]}}))}))},HlsLiveStreamPlayer.prototype.loadPlayer=function(F){return K(this,void 0,void 0,(function(){var B,G,W,z,K=this;return J(this,(function(J){switch(J.label){case 0:return this.playerInstance?(this.logger.error("playerLoadFailed: cannot load a player while current one is still active"),[2,{setupSucceeded:!1,playerSetupError:{errorType:"MultiplePlayerLoad",errorMessage:"cannot load a player while current one is still active"}}]):this.liveStreamOptions&&this.selectedStreamDetails&&ee.isStreamValid(this.selectedStreamDetails)?(this.playerInstance=new X.PlayerWrapper(this.logger.createChild("PlayerWrapper")),this.playerInstance.on("stateChanged",(function(F,B){return K.hlsStateChanged(F,B)})),this.playerInstance.on("captionsToggled",(function(F,B,G){return K.captionsToggled(F,B,G)})),this.playerInstance.on("statsUpdated",(function(F){return K.liveStreamStatistic.registerStatsUpdated(F)})),[4,this.playerInstance.initialize(F,this.liveStreamOptions,this.configProvider,1)]):(this.logger.error("playerLoadFailed: empty/invalid primary and alternate stream info configured"),[2,{setupSucceeded:!1,playerSetupError:{errorType:"InvalidStream",errorMessage:"empty/invalid primary and alternate stream info configured"}}]);case 1:J.sent(),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.srcLoadPromise||(this.srcLoadPromise=this.playerInstance.message("loadPlayerScript").send()),J.label=2;case 2:return J.trys.push([2,4,,5]),[4,this.srcLoadPromise];case 3:return J.sent(),[3,5];case 4:return B=J.sent(),W=(0,$.stringifyObject)(B),this.logger.error("playerLoadFailed: player scripts load failed: ".concat(W)),this.liveStreamStatistic.registerPlayerLoadFailed("player scripts load failed"),this.srcLoadPromise=null,[2,{setupSucceeded:!1,playerSetupError:{errorType:"PlayerScriptLoadFailed",errorMessage:W}}];case 5:return[4,this.tryLoadSdnPlugin()];case 6:J.sent(),J.label=7;case 7:return J.trys.push([7,9,,10]),[4,this.playerInstance.message("createHls").send()];case 8:return J.sent(),[3,10];case 9:return G=J.sent(),W=(0,$.stringifyObject)(G),this.logger.error("playerLoadFailed ".concat(W)),this.liveStreamStatistic.registerPlayerLoadFailed("playerLoadFailed ".concat(W)),[2,{setupSucceeded:!1,playerSetupError:{errorType:"PlayerInitializationFailed",errorMessage:W}}];case 10:return z=this,[4,this.setPlayerSource(this.selectedStreamDetails,!1)];case 11:return z.loadSucceeded=J.sent(),this.logger.info("loadPlayer succeeded: ".concat(this.loadSucceeded)),this.loadSucceeded?(this.liveStreamStatistic.registerPlayerLoadSucceeded(),this.playerState="Initialized",[2,{setupSucceeded:this.loadSucceeded}]):(this.liveStreamStatistic.registerPlayerLoadFailed("setPlayerSource failed"),[2,{setupSucceeded:this.loadSucceeded,playerSetupError:{errorType:"SetSourceFailed",errorMessage:"failed to set player source"}}])}}))}))},HlsLiveStreamPlayer.prototype.getRenderer=function(){return!this.renderer&&this.playerInstance&&(this.renderer=new Z.LiveStreamRenderer(this,this.logger.createChild("LiveStreamRenderer"))),this.renderer},HlsLiveStreamPlayer.prototype.stop=function(){this.destroy()},HlsLiveStreamPlayer.prototype.getPlaybackState=function(){return this.playerState},HlsLiveStreamPlayer.prototype.getCaptionsTimestamp=function(){return this.captionsTimestamp},HlsLiveStreamPlayer.prototype.getCaptionsControl=function(){if(!this.captionsControl&&this.playerInstance){var F=this.liveStreamOptions.supportedSubtitleLanguages?this.liveStreamOptions.supportedSubtitleLanguages.map((function(F){return F.culture})):["en","es"];this.captionsControl=new te.CaptionsControl(this.playerInstance,F)}return this.captionsControl},HlsLiveStreamPlayer.prototype.getStreamSize=function(){var F=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return F?{width:F.mediaWidth,height:F.mediaHeight}:{width:0,height:0}},HlsLiveStreamPlayer.prototype.isRendering=function(){var F=this.getStreamSize();return F.width>0&&F.height>0},HlsLiveStreamPlayer.prototype.hlsStateChanged=function(F,B){switch(F){case"error":return this.handlePlaybackError(B);case"canplaythrough":return this.onCanplaythrough();case"play":return this.onPlay();case"playing":return this.onPlaying();case"pause":return this.onPause();case"start":return this.onStart();case"ended":return this.onEnded();case"seeking":return this.onSeeking();case"seeked":return this.onSeeked(B);case"loadedmetadata":return this.onMetadataLoaded();case"waiting":return this.onWaiting();case"stalled":return this.onStalled();case"playbackbitratechanged":return this.onPlaybackBitrateChanged(B);case"downloadbitratechanged":return this.onDownloadBitrateChanged(B);case"volumechange":return this.onVolumeChange(B);case"loadstart":return this.onLoadStart();case"loadeddata":return this.onLoadedData();case"skippingSegment":return this.onSkippingSegment(B);default:this.logger.warn("Unknown hls event ".concat(F))}},HlsLiveStreamPlayer.prototype.handlePlaybackError=function(F){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:return this.playerState="Error",B=(0,$.stringifyObject)(F),this.logger.info("Playback error ".concat(B)),F.message?(this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,F.fatal?[4,this.switchStreamingUrl()]:[3,2]):(this.logger.error("onError: error details are not available"),this.raisePlaybackError("Unknown",B),this.destroy(),[2]);case 1:if(G.sent())this.raisePlaybackError("PlaybackRetried",B);else{switch(this.logger.error("Switching to alt streaming url failed. Destroying player"),F.type){case Q.NETWORK_ERROR:this.raisePlaybackError("NetworkError",B);break;case Q.MEDIA_ERROR:case Q.KEY_SYSTEM_ERROR:case Q.MUX_ERROR:this.raisePlaybackError("PlaybackError",B);break;default:this.raisePlaybackError("Unknown",B)}this.destroy()}G.label=2;case 2:return[2]}}))}))},HlsLiveStreamPlayer.prototype.raisePlaybackError=function(F,B){this.liveStreamStatistic.registerPlaybackError(F,B),this.event("playbackError").raise(F,B)},HlsLiveStreamPlayer.prototype.captionsToggled=function(F,B,G){this.event("captionsToggled").raise(F,B,G),this.liveStreamStatistic.registerCaptionToggle(F,B,G)},HlsLiveStreamPlayer.prototype.tryLoadSdnPlugin=function(){return K(this,void 0,void 0,(function(){var F,B;return J(this,(function(G){switch(G.label){case 0:if(this.sdnPluginLoadPromise||!this.liveStreamOptions.sdn||!this.configProvider.config.allowSdnPlugins)return[2];switch(this.liveStreamOptions.sdn.name){case"peer5":case"microsoft":break;default:return this.logger.warn("unsupported SDN provider: ".concat(this.liveStreamOptions.sdn.name)),this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!1),[2]}G.label=1;case 1:return G.trys.push([1,3,,4]),this.sdnPluginLoadPromise=this.playerInstance.message("tryLoadSdnPlugin").send(),[4,this.sdnPluginLoadPromise];case 2:return G.sent(),[3,4];case 3:return F=G.sent(),B=(0,$.stringifyObject)(F),this.sdnPluginLoadPromise=void 0,this.logger.error("loadSdnPlugin failed: ".concat(B)),this.event("sdnPluginLoadFailed").raise(B),[3,4];case 4:return this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!!this.sdnPluginLoadPromise),[2]}}))}))},HlsLiveStreamPlayer.prototype.setPlayerSource=function(F,B){return K(this,void 0,void 0,(function(){var G,W,z;return J(this,(function(K){switch(K.label){case 0:if(!this.playerInstance)return this.logger.error("setPlayerSource: playerInstance is null"),[2,!1];this.logger.info("setPlayerSource: Hls source set to: [".concat(F.url,"]")),this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,K.label=1;case 1:return K.trys.push([1,4,,7]),this.liveStreamStatistic.registerSetSourceAttempt(F.url),this.selectedStreamDetails=F,[4,this.setAuthCookieRequest(F)];case 2:return K.sent(),G=B?"switchStreamingUrl":"setSource",[4,this.playerInstance.message(G).send(F)];case 3:return K.sent(),this.liveStreamStatistic.registerSetSourceSucceeded(),this.logger.info("setPlayerSource: src changed, isSwitching:".concat(B)),[2,!0];case 4:return W=K.sent(),z=(0,$.stringifyObject)(W),this.logger.error("setPlayerSource: failed with error [".concat(z,"]")),this.liveStreamStatistic.registerSetSourcedFailed(z),B?[3,6]:[4,this.switchStreamingUrl()];case 5:return[2,K.sent()];case 6:return[3,7];case 7:return[2,!1]}}))}))},HlsLiveStreamPlayer.prototype.setAuthCookieRequest=function(F){return K(this,void 0,void 0,(function(){var B;return J(this,(function(G){switch(G.label){case 0:-1!==F.url.indexOf("format=mpd-time-csf")&&(F.url=F.url.substring(0,F.url.indexOf("(format=mpd-time-csf"))),F.url.endsWith("/manifest")&&(F.url+="(format=m3u8-aapl)"),G.label=1;case 1:return G.trys.push([1,4,,5]),F.keyDeliveryUrl&&F.keyAuthorizationToken?[4,fetch(F.keyDeliveryUrl,{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyAuthorizationToken:F.keyAuthorizationToken})}).then((function(F){if(200!==F.status)throw new Error("Unexpected KeyDelivery response status ".concat(F.status))}))]:[3,3];case 2:G.sent(),G.label=3;case 3:return[3,5];case 4:throw B=G.sent(),new Error("Setting authorization cookie failed ".concat(B));case 5:return[2]}}))}))},HlsLiveStreamPlayer.prototype.handleStreamInfoUpdate=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){switch(B.label){case 0:return this.loadSucceeded&&F.url!==this.selectedStreamDetails.url?[4,this.setPlayerSource(F,!0)]:[3,2];case 1:return B.sent(),[3,3];case 2:this.loadSucceeded&&this.playerInstance&&this.getCurrentTime()>0&&this.setPlaybackState("Start"),B.label=3;case 3:return[2]}}))}))},HlsLiveStreamPlayer.prototype.switchStreamingUrl=function(){var F;return K(this,void 0,void 0,(function(){var B,G;return J(this,(function(W){switch(W.label){case 0:return this.streamingUrlSwitchCount>=this.configProvider.config.streamingUrlSwitchMaxCountHls?(this.logger.error("Switching to alt stream url failed. Number of switches reached maximum of configured ".concat(this.streamingUrlSwitchCount," number")),[2,!1]):(B=this.selectedStreamDetails.url===(null===(F=this.liveStreamOptions.stream)||void 0===F?void 0:F.url),(G=B?this.liveStreamOptions.altStream:this.liveStreamOptions.stream)&&ee.isStreamValid(G)?(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,this.logger.info("Switching player to ".concat(G.url," stream URL. Stream URL switch count:  ").concat(this.streamingUrlSwitchCount)),[4,this.setPlayerSource(G,!0)]):(this.logger.error("Stream to switch (".concat(B?"alternative":"primary",") is not valid")),[2,!1]));case 1:return[2,W.sent()]}}))}))},HlsLiveStreamPlayer.prototype.destroy=function(){this.srcLoadPromise=null,this.sdnPluginLoadPromise=null,this.renderer&&(this.renderer.dispose(),this.renderer=null),this.playerInstance&&(this.liveStreamStatistic.registerPlayerDestroyed(),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState("Destroyed"))},HlsLiveStreamPlayer.prototype.getCurrentTime=function(){var F=this.liveStreamStatistic.getPlayerDiagnosticSnapshot();return F&&F.currentPlayPosition||0},HlsLiveStreamPlayer.prototype.onCanplaythrough=function(){this.setPlaybackState("Ready")},HlsLiveStreamPlayer.prototype.onPlay=function(){this.lastKnownPlayTime&&(this.logger.info("Setting current time to ".concat(this.lastKnownPlayTime)),this.playerInstance.message("setPlayTime").send(this.lastKnownPlayTime),this.lastKnownPlayTime=void 0),this.setPlaybackState("Play")},HlsLiveStreamPlayer.prototype.onPlaying=function(){this.setPlaybackState("Playing")},HlsLiveStreamPlayer.prototype.onPause=function(){this.setPlaybackState("Paused")},HlsLiveStreamPlayer.prototype.onStart=function(){this.logger.info("Playback started"),this.setPlaybackState("Start"),this.isSwitchStreamingUrlOngoing&&(this.logger.info("Playback started, switch count: ".concat(this.streamingUrlSwitchCount)),this.event("urlSwitched").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)},HlsLiveStreamPlayer.prototype.onEnded=function(){this.setPlaybackState("Ended")},HlsLiveStreamPlayer.prototype.onSeeking=function(){this.setPlaybackState("Seeking")},HlsLiveStreamPlayer.prototype.onSeeked=function(F){this.setPlaybackState("Seeked")},HlsLiveStreamPlayer.prototype.onMetadataLoaded=function(){this.setPlaybackState("LoadedMetadata")},HlsLiveStreamPlayer.prototype.onWaiting=function(){this.setPlaybackState("Buffering")},HlsLiveStreamPlayer.prototype.onStalled=function(){this.setPlaybackState("Stalled")},HlsLiveStreamPlayer.prototype.onLoadedData=function(){this.setPlaybackState("LoadedData")},HlsLiveStreamPlayer.prototype.onLoadStart=function(){this.setPlaybackState("LoadStart")},HlsLiveStreamPlayer.prototype.onSkippingSegment=function(F){this.setPlaybackState("SkippingSegment"),this.liveStreamStatistic.registerPotentialMediaFreeze(F)},HlsLiveStreamPlayer.prototype.setPlaybackState=function(F){this.playerState=F,this.logger.debug("playback state changed: ".concat(F)),this.liveStreamStatistic.registerPlaybackStateChanged(F),this.event("playbackStateChanged").raise()},HlsLiveStreamPlayer.prototype.onVolumeChange=function(F){this.liveStreamStatistic.registerVolumeChange(F.value)},HlsLiveStreamPlayer.prototype.onPlaybackBitrateChanged=function(F){this.liveStreamStatistic.registerPlaybackBitratechanged(F.bitrate)},HlsLiveStreamPlayer.prototype.onDownloadBitrateChanged=function(F){this.liveStreamStatistic.registerDownloadBitratechanged(F.bitrate)},HlsLiveStreamPlayer}(Y.default);B.HlsLiveStreamPlayer=ne},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.LiveStreamConfigProvider=void 0;var K=G(8),J=G(23),Q={src:["//amp.azure.net/libs/amp/2.3.8.4/azuremediaplayer.min.js","https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.js"],css:["https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.css","https://statics.teams.cdn.office.net/evergreen-assets/broadcast/video-player.css?v=2"],styles:["azuremediaplayer","amp-stream-skin","amp-big-play-centered"],lang:"en-us",disableFullscreenButton:!1},Y=function(){function LiveStreamConfigProvider(F,B,G,W){this.clientSettings=B,this.configIds=G,this.logger=W,this.settings=getSettings(),this.logger.info("client settings: ".concat(JSON.stringify(this.clientSettings))),this.settings.debug=!!B&&B.debug,K.mergeWith(this.settings,F,arrayMergeCustomizer),this.logger.info("applied settings: ".concat(JSON.stringify(this.settings)))}return Object.defineProperty(LiveStreamConfigProvider.prototype,"playerConfig",{get:function(){return this.clientSettings&&this.clientSettings.playerConfig?this.clientSettings.playerConfig:Q},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamConfigProvider.prototype,"config",{get:function(){return this.settings},enumerable:!1,configurable:!0}),LiveStreamConfigProvider}();B.LiveStreamConfigProvider=Y;var $=function(){function PlatfromSettings(){this.defaultSettings={staleDataTimeLimitInSec:30,loadType:1,allowSdnPlugins:!0,useBrowserWindowSizeForBitRate:!0,techOrder:["azureHtml5JS","html5"],textTrackKind:"subtitles",streamingUrlSwitchMaxCount:2,ampErrorCodesEligibleForStreamingUrlSwitch:[4194309,2097564,2097556,2097752,2097753,5242884],maxRetryCount:10,sourceResetTimeoutInMs:1e3,sendInitialTelemetryAfterMs:6e4,maxPlayerPlaybackEventCount:50,playerTelemetryTickMs:1e3,maxPlayerDiagnosticsCount:50,maxPlayerMemoryTraceLogCount:1e3,sendTelemetry:!0,removeEmptyDefaultTextTrack:!0,timeoutForSwitchingUrl:1e4,streamingUrlSwitchMaxCountHls:10}}return PlatfromSettings.prototype.getSettings=function(){return this.defaultSettings},PlatfromSettings}(),X=function(F){function SafariSettings(){var B=F.call(this)||this;return B.settings=F.prototype.getSettings.call(B),B.settings.loadType=0,B.settings.allowSdnPlugins=!1,B}return z(SafariSettings,F),SafariSettings.prototype.getSettings=function(){return this.settings},SafariSettings}($);function getSettings(){var F;if("Safari"===(0,J.getBrowserInfo)().engine)F=new X;else F=new $;return F.getSettings()}function arrayMergeCustomizer(F,B){if(K.isArray(F))return B.slice()}},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=G(15),J=function(F){function NoopDeviceManager(){var B=null!==F&&F.apply(this,arguments)||this;return B.isAudioOutputSelectionSupported=!1,B}return z(NoopDeviceManager,F),NoopDeviceManager.prototype.createAudioRenderer=function(){return null},NoopDeviceManager.prototype.getRawDeviceMediaStream=function(F){return null},NoopDeviceManager.prototype.askDevicePermission=function(){return Promise.resolve({audio:!1,video:!1})},NoopDeviceManager.prototype.getPermissionState=function(F){return"granted"},NoopDeviceManager.prototype.enumerateDevicesAsync=function(){return Promise.resolve([])},NoopDeviceManager.prototype.getPreferredCamera=function(){return null},NoopDeviceManager.prototype.selectDevices=function(){},NoopDeviceManager.prototype.getSelectedDevices=function(){return{}},NoopDeviceManager.prototype.createPreview=function(){return Promise.resolve(new Q)},NoopDeviceManager.prototype.createPreviewRenderer=function(){return Promise.resolve(new Q)},NoopDeviceManager.prototype.createScreenSharingPreviewRenderer=function(){return Promise.resolve(new Q)},NoopDeviceManager.prototype.getDeviceNameAsync=function(){return Promise.resolve("")},NoopDeviceManager.prototype.setDeviceEffectsAsync=function(){return Promise.resolve()},NoopDeviceManager.prototype.getDeviceEffectsCapabilityAsync=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.setBackgroundImageAsync=function(){return Promise.resolve()},NoopDeviceManager.prototype.getImagePropertyAsync=function(){return Promise.resolve({width:0,height:0,uri:" "})},NoopDeviceManager.prototype.getMicrophoneGeometryArrayInfoAsync=function(F){return Promise.resolve({})},NoopDeviceManager.prototype.transformImageAsync=function(){return Promise.resolve(!1)},NoopDeviceManager.prototype.sendMessageDeviceVideoEffectsAsync=function(){return Promise.resolve({code:0})},NoopDeviceManager.prototype.sendMessageDeviceVideoExtensibilityAsync=function(){return Promise.resolve({code:0,type:"Error",response:{details:"The API has not been implemented."}})},NoopDeviceManager.prototype.setVideoCaptureConfigAsync=function(){return Promise.resolve()},NoopDeviceManager.prototype.setAudioProcessingFlags=function(F){},NoopDeviceManager.prototype.getSpeakerVolume=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.getSpeakerSystemVolume=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.setSpeakerVolume=function(F){return Promise.resolve()},NoopDeviceManager.prototype.setSpeakerSystemVolume=function(F){return Promise.resolve()},NoopDeviceManager.prototype.unmuteMicrophone=function(){return Promise.resolve()},NoopDeviceManager.prototype.unmuteSpeaker=function(){return Promise.resolve()},NoopDeviceManager.prototype.getNrgLevelsForDeviceTuner=function(F){return Promise.resolve(0)},NoopDeviceManager.prototype.getAudioFeatureCapability=function(F){return Promise.resolve(0)},NoopDeviceManager.prototype.getMicrophoneVolume=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.setMicrophoneVolume=function(F){return Promise.resolve()},NoopDeviceManager.prototype.setDeviceTelemetryData=function(F,B,G){return Promise.resolve()},NoopDeviceManager.prototype.getSpeakerDeviceDomIdAsync=function(F,B){return Promise.reject()},NoopDeviceManager.prototype.getSourceFormats=function(F){return Promise.resolve([])},NoopDeviceManager.prototype.enableShellSharing=function(){return Promise.resolve()},NoopDeviceManager.prototype.disableShellSharing=function(){return Promise.resolve()},NoopDeviceManager.prototype.enableParticipantCameras=function(){return Promise.resolve()},NoopDeviceManager.prototype.startAudioLoopbackDevice=function(F){return Promise.resolve()},NoopDeviceManager}(K.default);B.default=J;var Q=function(F){function NoopRenderer(){var B=null!==F&&F.apply(this,arguments)||this;return B.isRendering=!1,B.streamSize={width:0,height:0},B.rendererType=-1,B.frameType=-1,B}return z(NoopRenderer,F),NoopRenderer.prototype.captureFrame=function(){return Promise.resolve(new Y)},NoopRenderer.prototype.getStats=function(){return Promise.resolve({framesDropped:0,framesTotal:0})},NoopRenderer.prototype.setScalingMode=function(){return Promise.resolve()},NoopRenderer.prototype.dumpVideoSourceImages=function(){return Promise.resolve(0)},NoopRenderer.prototype.cameraAutoControl=function(F){return Promise.resolve(!1)},NoopRenderer.prototype.getCameraManualControlStates=function(F){return Promise.resolve([])},NoopRenderer.prototype.setCameraManualControlStates=function(F){return Promise.resolve([])},NoopRenderer.prototype.enumerateCameraManualControls=function(){return Promise.resolve([])},NoopRenderer.prototype.dispose=function(){},NoopRenderer}(K.default),Y=function(F){function NoopVideoFrame(){return null!==F&&F.apply(this,arguments)||this}return z(NoopVideoFrame,F),NoopVideoFrame.prototype.getSize=function(){return{width:0,height:0}},NoopVideoFrame.prototype.isMirrored=function(){return!1},NoopVideoFrame}(K.default)},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)},z=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.build=B.RelayManager=void 0;var J=G(8),Q=G(1),Y='"rtcmedia"',$={Service:{url:"https://edge.skype.com/trap",tokenUrl:"https://edge.skype.com/trap/tokens",disabled:!1},Relay:{addresses:["13.107.8.2"],tcpPort:443,udpPort:3478,Lync:{addresses:["mr.skype.net"],fqdns:[],tcpPort:443,udpPort:3478},Skype:{addresses:["13.107.8.2"],fqdns:[],tcpPort:443,udpPort:3478},Turn:{addresses:["52.113.193.12"],fqdns:["euaz.relay.teams.microsoft.com"],tcpPort:443,udpPort:3478,tlsPort:443,realm:"rtcmedia",url:"https://eu.turn.skype.com/relay"}},Token:{earlyRefreshMinutes:60,earlyRefreshPercentage:50}};function getRelayCredentials(F){return{expires:F.expires,username:F.username,password:F.password,realm:F.realm}}var X=function(){function TimeCounter(){this.reports={}}return TimeCounter.prototype.watch=function(F){var B={time:Date.now(),duration:-1};return this.reports[F]&&(F="".concat(F,"_last")),this.reports[F]=B,{end:function(F){F?B.error=F:B.duration=Date.now()-B.time}}},TimeCounter.prototype.getReports=function(){return this.reports},TimeCounter}(),Z="configFetch",ee="skypeTokenFetch",te="trapTokenFetch",ne=function(){function RelayManager(F){this.updateRelaysPromise=null,this.config=J.cloneDeep($),this.trapTokens={},this.timers=new X,this.context=F,this.logger=F.logger.createChild("RM"),this.request=F.request}return RelayManager.prototype.initialize=function(){this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync(!0))},RelayManager.prototype.queryRelaysAsync=function(F){return void 0===F&&(F={}),z(this,void 0,void 0,(function(){var B;return K(this,(function(G){switch(G.label){case 0:return this.logger.info("query relays"),this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync()),[4,this.updateRelaysPromise];case 1:return(B=G.sent())?"turn"===F.relayType?[2,B.Turn]:[2,F.isRemoteClientLync?B.Lync:B.Skype]:[2,[]]}}))}))},RelayManager.prototype.getStats=function(){return this.timers.getReports()},RelayManager.prototype.updateRelaysFromConfigAsync=function(F){var B=this;void 0===F&&(F=!1);var G=this.getConfigAsync().then((function(){return B.updateRelaysAsync()})).then((function(F){return B.updateRelaysPromise=G,F})).catch((function(G){return B.updateRelaysPromise=null,F?B.logger.warn("failed to retrieve relays",Q.stringifyObject(G)):B.logger.error("failed to retrieve relays",Q.stringifyObject(G)),null}));return G},RelayManager.prototype.refreshRelaysFromConfig=function(){this.request.isOnline()?this.updateRelaysFromConfigAsync():(this.updateRelaysPromise=null,this.logger.warn("not refreshing relays due to no network connection"))},RelayManager.prototype.updateRelaysAsync=function(){var F,B=this,G=this.config.Service.tokenUrl,fetchTrapTokenThroughProvider=function(){return z(B,void 0,void 0,(function(){return K(this,(function(B){return F=this.timers.watch(te),[2,this.context.trapTokenCredentialsProvider()]}))}))},fetchTrapTokenDirectly=function(){return z(B,void 0,void 0,(function(){var B,W,z;return K(this,(function(K){switch(K.label){case 0:B=this.timers.watch(ee),W="",K.label=1;case 1:return K.trys.push([1,3,,4]),[4,this.context.tokenProvider()];case 2:return W=K.sent(),this.logger.info("skypeToken fetched"),[3,4];case 3:throw z=K.sent(),B.end(Q.stringifyObject(z)),z;case 4:return B.end(),F=this.timers.watch(te),[4,this.request.get(G,{headers:{"X-Skypetoken":W,"api-version":2}})];case 5:return[2,K.sent().response]}}))}))},J=this.context.trapTokenCredentialsProvider?fetchTrapTokenThroughProvider:fetchTrapTokenDirectly;return this.logger.info("Fetch TRAP token ".concat(this.context.trapTokenCredentialsProvider?"with provider":"directly")),J().then((function(G){F.end();var z=0,K=B.config.Token.earlyRefreshMinutes,J=B.config.Token.earlyRefreshPercentage;B.storeTrapTokens(G),z=Math.max(G.expires-60*K,G.expires*J/100),setTimeout(B.refreshRelaysFromConfig.bind(B),1e3*z);var Q=B.config.Relay.Turn.realm?B.config.Relay.Turn.realm:Y,$=getRelayCredentials(B.getTrapToken(Q)),X={Skype:[W({addresses:B.config.Relay.Skype.addresses,fqdns:B.config.Relay.Skype.fqdns,tcpPort:B.config.Relay.Skype.tcpPort,udpPort:B.config.Relay.Skype.udpPort,type:"msturn"},$)],Lync:[W({addresses:B.config.Relay.Lync.addresses,fqdns:B.config.Relay.Lync.fqdns,tcpPort:B.config.Relay.Lync.tcpPort,udpPort:B.config.Relay.Lync.udpPort,type:"msturn"},$)],Turn:[W({addresses:B.config.Relay.Turn.addresses,fqdns:B.config.Relay.Turn.fqdns,tcpPort:B.config.Relay.Turn.tcpPort,udpPort:B.config.Relay.Turn.udpPort,tlsPort:B.config.Relay.Turn.tlsPort,type:"turn"},$)]};return B.logger.info("relays from trap",X),X})).catch((function(B){throw F&&F.end(Q.stringifyObject(B)),B}))},RelayManager.prototype.storeTrapTokens=function(F){if(F&&F.tokens){var B={};F.tokens.forEach((function(G){B[G.realm]={expires:F.expires,username:G.username,password:G.password,realm:G.realm}})),this.trapTokens=B}else this.logger.error("failed to get tokens from trap response")},RelayManager.prototype.getTrapToken=function(F){if("string"==typeof F){var B=F.replace(/^"|"$/g,""),G='"'.concat(B,'"'),W=this.trapTokens[G]||this.trapTokens[B];if(W)return W}throw new Error("token for relay not found, realm: ".concat(F))},RelayManager.prototype.getConfigAsync=function(){var F=this;this.logger.info("retrieving configuration");var B=this.timers.watch(Z);return this.context.configProvider().then((function(G){B.end(),F.logger.info("retrieved configuration:",G),F.config=J.cloneDeep($),J.mergeWith(F.config,G,(function(B,G){if(J.isArray(G))return G.map((function(B){var G=J.trim(B);return B!==G&&F.logger.warn("MDN_TRAP config got santizied '".concat(B,"'->'").concat(G,"'")),G}))})),F.logger.info("applied configuration:",F.config)})).catch((function(G){F.logger.warn("failed to retrieve configuration",Q.stringifyObject(G)),B.end(Q.stringifyObject(G))}))},RelayManager}();function build(F){return new ne(F)}B.RelayManager=ne,B.build=build},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.initLogger=void 0;var W=G(31),z=G(106),K=G(481),J=G(482);function initLogger(F,B){if(!W.RootToolsManager.isDelegateSet()){var G=new J.RootToolsManagerDelegate(F.telemetryService,B);if(W.RootToolsManager.setDelegate(G),F.logger){var Q=new K.RedirectingLogAppender(F.logger);W.LogFactory.instance().addAppender(Q)}}F.logger=new z.TsCallingLogger("JS.TsCalling.Pluginless",!0),F.mediaAgentFactoryConfig.logger=new z.TsCallingLogger("JS.TsCalling.MediaAgentUnsafe",!1),F.mediaAgentFactoryConfig.safeLogger=new z.TsCallingLogger("JS.TsCalling.MediaAgent",!0),F.signalingAgentConfig.logger=new z.TsCallingLogger("JS.TsCalling.SignalingAgent",!0)}B.initLogger=initLogger},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0}),B.RedirectingLogAppender=void 0;var K=G(31),J=function(F){function RedirectingLogAppender(B){var G=F.call(this,new K.StandardLogFormatter(K.SLF_Flags.Component))||this;return G._logger=B,G}return z(RedirectingLogAppender,F),RedirectingLogAppender.prototype.log=function(F,B,G,W){if(this._logger){var z=F.level<=K.LogLevel.Debug4?this._logger.debug:F.level<=K.LogLevel.Debug2?this._logger.log:F.level<=K.LogLevel.Debug1?this._logger.info:F.level<=K.LogLevel.Warning?this._logger.warn:this._logger.error;z&&z.apply(this._logger,[this.formatter().format(F,B,G,W)])}},RedirectingLogAppender}(K.AbstractLogAppender);B.RedirectingLogAppender=J},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.RootToolsManagerDelegate=void 0;var W=G(31),z=G(483),K=function(){function RootToolsManagerDelegate(F,B){this._telemetryService=F,this._ecsProvider=B,this._ecsProvider.on("OnECSChanged",(function(){return W.RootToolsManager.OnEcsChange()}))}return RootToolsManagerDelegate.prototype.fetchEcsConfig=function(F,B){var G=this;return z.Resolved().then((function(){return G._ecsProvider.getEcsConfig(F,B)}))},RootToolsManagerDelegate.prototype.sendTelemetry=function(F,B){this._telemetryService.getGenericTelemetryLogger&&F?this._telemetryService.getGenericTelemetryLogger(F).sendEvent({eventName:"rt_log",props:B}):this._telemetryService.sendEvents([{eventName:"rt_log",props:B}])},RootToolsManagerDelegate}();B.RootToolsManagerDelegate=K},function(F,B,G){(function(F){function fromThenable(F){var B=Defer();return F.then((function(F){B.resolve(F)}),(function(F){B.reject(F)})),B.promise().thenAsync((function(F){return F}))}function isThenable(F){return null!=F&&"function"==typeof F.then}function isCancelable(F){return null!=F&&"function"==typeof F.cancel}function run(F,G){if(!B.config.catchExceptions)return F();try{return F()}catch(F){return G(F)}}Object.defineProperty(B,"__esModule",{value:!0}),B.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(F){throw F}},B.fromThenable=fromThenable;var G,W=[],z=void 0!==F;function asyncCallback(B){W.push(B),1===W.length&&(z?F(resolveAsyncCallbacks):setTimeout(resolveAsyncCallbacks,0))}function resolveAsyncCallbacks(){var F=W;W=[];for(var B=0;B<F.length;B++)F[B]()}function all(F){if(0===F.length)return Resolved([]);var B,W=Defer(),z=F.length,K=Array(F.length);W.onCancel((function(B){F.forEach((function(F){isCancelable(F)&&G.SyncTask.cancelOtherInternal(F,B)}))}));var checkFinish=function(){0==--z&&(void 0!==B?W.reject(B):W.resolve(K))};return F.forEach((function(F,G){isThenable(F)?F.then((function(F){K[G]=F,checkFinish()}),(function(F){void 0===B&&(B=void 0===F||F),checkFinish()})):(K[G]=F,checkFinish())})),W.promise()}function Defer(){return new G.SyncTask}function Resolved(F){return(new G.SyncTask).resolve(F).promise()}function Rejected(F){return(new G.SyncTask).reject(F).promise()}function race(F){var B=Defer(),W=!1;return B.onCancel((function(B){F.forEach((function(F){isCancelable(F)&&G.SyncTask.cancelOtherInternal(F,B)}))})),F.forEach((function(F){isThenable(F)?F.then((function(F){W||(W=!0,B.resolve(F))}),(function(F){W||(W=!0,B.reject(F))})):W||(W=!0,B.resolve(F))})),B.promise()}function raceTimer(F,B){var G=Defer(),W=setTimeout((function(){G.resolve({timedOut:!0})}),B);return race([F.then((function(F){return clearTimeout(W),{timedOut:!1,result:F}})),G.promise()])}B.asyncCallback=asyncCallback,function(F){var G=function(){function SyncTask(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return SyncTask.prototype._addCallbackSet=function(F,B){var G=this,W=new SyncTask;return W.onCancel((function(B){F.wasCanceled=!0,F.cancelContext=B,G._cancelInternal(B)})),F.task=W,this._storedCallbackSets.push(F),B?this._mustHandleError=!1:W._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),W.promise()},SyncTask.prototype.onCancel=function(F){return this._completedSuccess||this._completedFail||(this._wasCanceled?F(this._cancelContext):this._cancelCallbacks.push(F)),this},SyncTask.prototype.then=function(F,B){return this._addCallbackSet({successFunc:F,failFunc:B},!0)},SyncTask.prototype.thenAsync=function(F,B){return this._addCallbackSet({successFunc:F,failFunc:B,asyncCallback:!0},!0)},SyncTask.prototype.catch=function(F){return this._addCallbackSet({failFunc:F},!0)},SyncTask.prototype.always=function(F){return this._addCallbackSet({successFunc:F,failFunc:F},!0)},SyncTask.prototype.setTracingEnabled=function(F){return this._traceEnabled=F,this},SyncTask.prototype.finally=function(F){return this._addCallbackSet({successFunc:F,failFunc:F},!1),this},SyncTask.prototype.done=function(F){return this._addCallbackSet({successFunc:F},!1),this},SyncTask.prototype.fail=function(F){return this._addCallbackSet({failFunc:F},!1),this},SyncTask.prototype.resolve=function(F){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=F,this._cancelCallbacks=[],this._resolveSuccesses(),this},SyncTask.prototype.reject=function(F){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=F,this._cancelCallbacks=[],this._resolveFailures(),SyncTask._enforceErrorHandled(this),this},SyncTask.prototype._checkState=function(F){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var G="Failed to "+(F?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(G)}(B.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},SyncTask._enforceErrorHandled=function(F){F._mustHandleError&&(SyncTask._rejectedTasks.push(F),SyncTask._enforceErrorHandledTimer||(SyncTask._enforceErrorHandledTimer=setTimeout((function(){SyncTask._enforceErrorHandledTimer=void 0;var F=SyncTask._rejectedTasks;SyncTask._rejectedTasks=[],F.forEach((function(F,G){F._mustHandleError&&B.config.unhandledErrorHandler(F._storedErrResolution)}))}),0)))},SyncTask.prototype.cancel=function(F){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(F)},SyncTask.prototype._cancelInternal=function(F){var B=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=F;var G=this._cancelCallbacks;this._cancelCallbacks=[],G.length>0&&G.forEach((function(F){B._completedSuccess||B._completedFail||F(B._cancelContext)}))}},SyncTask.cancelOtherInternal=function(F,B){var G=F;G._storedCallbackSets&&G._cancelInternal?G._cancelInternal(B):F.cancel(B)},SyncTask.prototype.promise=function(){return this},SyncTask.prototype._resolveSuccesses=function(){var F=this;for(this._resolving=!0;this._storedCallbackSets.length;){var B=this._storedCallbackSets;this._storedCallbackSets=[],B.forEach((function(B){B.asyncCallback?asyncCallback((function(){return F._resolveSuccessCallback(B)})):F._resolveSuccessCallback(B)}))}this._resolving=!1},SyncTask.prototype._resolveSuccessCallback=function(F){var B=this;F.successFunc?run((function(){var G=F.successFunc(B._storedResolution);isCancelable(G)&&(F.wasCanceled?SyncTask.cancelOtherInternal(G,F.cancelContext):F.task.onCancel((function(F){return SyncTask.cancelOtherInternal(G,F)}))),isThenable(G)?G.then((function(B){F.task.resolve(B)}),(function(B){F.task.reject(B)})):F.task.resolve(G)}),(function(G){B._handleException(G,"SyncTask caught exception in success block: "+G.toString()),F.task.reject(G)})):F.task.resolve(this._storedResolution)},SyncTask.prototype._resolveFailures=function(){var F=this;for(this._resolving=!0;this._storedCallbackSets.length;){var B=this._storedCallbackSets;this._storedCallbackSets=[],B.forEach((function(B){B.asyncCallback?asyncCallback((function(){return F._resolveFailureCallback(B)})):F._resolveFailureCallback(B)}))}this._resolving=!1},SyncTask.prototype._resolveFailureCallback=function(F){var B=this;F.failFunc?run((function(){var G=F.failFunc(B._storedErrResolution);isCancelable(G)&&(F.wasCanceled?SyncTask.cancelOtherInternal(G,F.cancelContext):F.task.onCancel((function(F){return SyncTask.cancelOtherInternal(G,F)}))),isThenable(G)?G.then((function(B){F.task.resolve(B)}),(function(B){F.task.reject(B)})):F.task.resolve(G)}),(function(G){B._handleException(G,"SyncTask caught exception in failure block: "+G.toString()),F.task.reject(G)})):F.task.reject(this._storedErrResolution)},SyncTask.prototype._handleException=function(F,G){B.config.exceptionsToConsole&&console.error(G),B.config.exceptionHandler&&B.config.exceptionHandler(F)},SyncTask.prototype.toEs6Promise=function(){var F=this;return new Promise((function(B,G){return F.then(B,G)}))},SyncTask._rejectedTasks=[],SyncTask}();F.SyncTask=G}(G||(G={})),B.all=all,B.Defer=Defer,B.Resolved=Resolved,B.Rejected=Rejected,B.race=race,B.raceTimer=raceTimer}).call(this,G(484).setImmediate)},function(F,B,G){(function(F){var W=void 0!==F&&F||"undefined"!=typeof self&&self||window,z=Function.prototype.apply;function Timeout(F,B){this._id=F,this._clearFn=B}B.setTimeout=function(){return new Timeout(z.call(setTimeout,W,arguments),clearTimeout)},B.setInterval=function(){return new Timeout(z.call(setInterval,W,arguments),clearInterval)},B.clearTimeout=B.clearInterval=function(F){F&&F.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(W,this._id)},B.enroll=function(F,B){clearTimeout(F._idleTimeoutId),F._idleTimeout=B},B.unenroll=function(F){clearTimeout(F._idleTimeoutId),F._idleTimeout=-1},B._unrefActive=B.active=function(F){clearTimeout(F._idleTimeoutId);var B=F._idleTimeout;B>=0&&(F._idleTimeoutId=setTimeout((function onTimeout(){F._onTimeout&&F._onTimeout()}),B))},G(485),B.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==F&&F.setImmediate||this&&this.setImmediate,B.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==F&&F.clearImmediate||this&&this.clearImmediate}).call(this,G(49))},function(F,B,G){(function(F,B){!function(F,G){if(!F.setImmediate){var W,z=1,K={},J=!1,Q=F.document,Y=Object.getPrototypeOf&&Object.getPrototypeOf(F);Y=Y&&Y.setTimeout?Y:F,"[object process]"==={}.toString.call(F.process)?installNextTickImplementation():canUsePostMessage()?installPostMessageImplementation():F.MessageChannel?installMessageChannelImplementation():Q&&"onreadystatechange"in Q.createElement("script")?installReadyStateChangeImplementation():installSetTimeoutImplementation(),Y.setImmediate=setImmediate,Y.clearImmediate=clearImmediate}function setImmediate(F){"function"!=typeof F&&(F=new Function(""+F));for(var B=new Array(arguments.length-1),G=0;G<B.length;G++)B[G]=arguments[G+1];var J={callback:F,args:B};return K[z]=J,W(z),z++}function clearImmediate(F){delete K[F]}function run(F){var B=F.callback,W=F.args;switch(W.length){case 0:B();break;case 1:B(W[0]);break;case 2:B(W[0],W[1]);break;case 3:B(W[0],W[1],W[2]);break;default:B.apply(G,W)}}function runIfPresent(F){if(J)setTimeout(runIfPresent,0,F);else{var B=K[F];if(B){J=!0;try{run(B)}finally{clearImmediate(F),J=!1}}}}function installNextTickImplementation(){W=function(F){B.nextTick((function(){runIfPresent(F)}))}}function canUsePostMessage(){if(F.postMessage&&!F.importScripts){var B=!0,G=F.onmessage;return F.onmessage=function(){B=!1},F.postMessage("","*"),F.onmessage=G,B}}function installPostMessageImplementation(){var B="setImmediate$"+Math.random()+"$",onGlobalMessage=function(G){G.source===F&&"string"==typeof G.data&&0===G.data.indexOf(B)&&runIfPresent(+G.data.slice(B.length))};F.addEventListener?F.addEventListener("message",onGlobalMessage,!1):F.attachEvent("onmessage",onGlobalMessage),W=function(G){F.postMessage(B+G,"*")}}function installMessageChannelImplementation(){var F=new MessageChannel;F.port1.onmessage=function(F){runIfPresent(F.data)},W=function(B){F.port2.postMessage(B)}}function installReadyStateChangeImplementation(){var F=Q.documentElement;W=function(B){var G=Q.createElement("script");G.onreadystatechange=function(){runIfPresent(B),G.onreadystatechange=null,F.removeChild(G),G=null},F.appendChild(G)}}function installSetTimeoutImplementation(){W=function(F){setTimeout(runIfPresent,0,F)}}}("undefined"==typeof self?void 0===F?this:F:self)}).call(this,G(49),G(101))},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(23),z=G(10),K=function(){function PlatformManager(){this.supportedPlatforms=new Map([["Chrome","59.0"],["EdgeAnaheim","79.0"],["Safari","13.1"],["Electron","3.0"],["Firefox","96.0"]]),this.experimentalPlatforms=new Map,this.lightweightSupported=new Set(["Chrome","EdgeAnaheim","Firefox","Safari","MSIE","AppleWebView"])}return PlatformManager.prototype.getPlatformSupportLevel=function(F){var B=(0,W.getBrowserInfo)(),G=this.supportedPlatforms.get(B.name);if(F&&G&&z.isVersionGreaterOrEqual(B.version,G))return 1;if(F&&!G){if("Chromium"===B.engine)return 2;var K=this.experimentalPlatforms.get(B.name);if(K&&z.isVersionGreaterOrEqual(B.version,K))return 2}return this.lightweightSupported.has(B.name)?3:0},PlatformManager}();B.default=K},function(F,B,G){var W,z=this&&this.__extends||(W=function(F,B){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)Object.prototype.hasOwnProperty.call(B,G)&&(F[G]=B[G])},W(F,B)},function(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function __(){this.constructor=F}W(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=this&&this.__awaiter||function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},J=this&&this.__generator||function(F,B){var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K;function verb(F){return function(B){return step([F,B])}}function step(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=J.trys,(z=z.length>0&&z[z.length-1])||6!==K[0]&&2!==K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}};Object.defineProperty(B,"__esModule",{value:!0}),B.PluginlessEcsProvider=void 0;var Q=G(23),Y=G(15),$=G(32),X=G(27),Z=function(F){function PluginlessEcsProvider(){var B=null!==F&&F.apply(this,arguments)||this;return B.config=null,B}return z(PluginlessEcsProvider,F),Object.defineProperty(PluginlessEcsProvider.prototype,"ETag",{get:function(){return this.etag},enumerable:!1,configurable:!0}),PluginlessEcsProvider.prototype.setEcsConfig=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(B){return this.config=JSON.parse(F.ecsBlob),this.etag=F.etag,this.event("OnECSChanged").raise(),[2]}))}))},PluginlessEcsProvider.prototype.setUserEcsServerUrl=function(F,B){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},PluginlessEcsProvider.prototype.getUserEcsServerUrl=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},PluginlessEcsProvider.prototype.getEcsQueryParameters=function(){return K(this,void 0,void 0,(function(){var F,B,G;return J(this,(function(W){return(F={}).CLRelease=(0,$.getTsCallingVersion)(),B="_TS_BUILC_VERSION_".replace("C","D"),F.CLRelease===B&&(F.CLRelease="9999.99"),G=(0,Q.getBrowserInfo)(),F.BrowserName=G.name,F.BrowserEngine=G.engine,F.BrowserVersion=G.version,F.FormFactor=G.formFactor,X.UserAgentConfig.hardwareConcurrency&&(F.CPUCount=X.UserAgentConfig.hardwareConcurrency),[2,JSON.stringify(F)]}))}))},PluginlessEcsProvider.prototype.ecsGetUserQueryParameters=function(F){return K(this,void 0,void 0,(function(){return J(this,(function(F){return[2,this.getEcsQueryParameters()]}))}))},PluginlessEcsProvider.prototype.shouldTriggerCQF=function(F,B,G){return K(this,void 0,void 0,(function(){return J(this,(function(F){throw new Error("Not implemented")}))}))},PluginlessEcsProvider.prototype.getEcsConfig=function(F,B){var G=this.config&&this.config[F];return B?G&&G[B]:G},PluginlessEcsProvider.prototype.createEcsConfiguration=function(){return new(function(){function class_1(F){this.provider=F}return class_1.prototype.getBoolean=function(F,B){return this.provider.getEcsConfig(F,B)},class_1.prototype.getNumber=function(F,B){return this.provider.getEcsConfig(F,B)},class_1.prototype.getString=function(F,B){var G=this.provider.getEcsConfig(F,B);return JSON.stringify(G)},class_1}())(this)},PluginlessEcsProvider}(Y.default);B.PluginlessEcsProvider=Z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.signalingAgentProviderFactory=B.SignalingAgentProvider=B.callSignalingAgentEcsNS=void 0;var W=G(31),z=G(89),K=G(32),J=G(489);B.callSignalingAgentEcsNS="SkypeCalling";var Q=function(){function SignalingAgentProvider(F,B,G){var J=this;this.signalingAgentConfig=F,this.ecsProvider=B,this.logger=G,this.ecsProvider.on("OnECSChanged",(function(){return J.onEcsUpdate()})),this.signalingAgentConfig.clientInformation+="/TsCallingVersion=".concat((0,K.getTsCallingVersion)(),"/Ovb=").concat((0,K.getOvb)()),this.signalingAgentConfig.piiScrubber={omit:W.pii.Omit,mri:W.pii.Mri},this.signalingAgent=new z.SignalingAgent(this.getSignalingAgentConfig())}return SignalingAgentProvider.prototype.getSignalingAgent=function(){return this.signalingAgent},SignalingAgentProvider.prototype.onEcsUpdate=function(){var F=this.ecsProvider.getEcsConfig(B.callSignalingAgentEcsNS);this.logger.info("onEcsUpdate, ecsTag=".concat(this.ecsProvider.ETag||"",", ecsConfig=").concat(JSON.stringify(F))),this.signalingAgentConfig=(0,J.updateSignalingAgentConfig)(this.signalingAgentConfig,F),this.signalingAgentConfig.ecsEtag=this.ecsProvider.ETag,this.signalingAgent.updateSignalingAgentConfig(this.getSignalingAgentConfig())},SignalingAgentProvider.prototype.getSignalingAgentConfig=function(){return this.signalingAgentConfig.handleRosterFromCreateAndJoin=!0,this.signalingAgentConfig},SignalingAgentProvider}();B.SignalingAgentProvider=Q,B.signalingAgentProviderFactory={build:function(F,B,G){return new Q(F,B,G)}}},function(F,B,G){var W=this&&this.__assign||function(){return W=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},W.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.updateSignalingAgentConfig=void 0;var updateSignalingAgentConfig=function(F,B){if(!B)return F;var G=W({},F);if(B.ngIncoming&&B.ngOutgoing){var z=convertScreenSharingFlag(B.ngIncoming.isVBSSEnabled,B.ngOutgoing.isVBSSEnabled);G.cloudScreenSharingFlag=getParam(z,F.cloudScreenSharingFlag)}return B.ngOutgoing&&(G.emergencyCallCountry=convertEmergencyCallCountryFlag(B.ngOutgoing.isEmergencyCallingEnabled,F.emergencyCallCountry),G.isGVCOutgoingEnabled=getParam(B.ngOutgoing.isGVCEnabled,F.isGVCOutgoingEnabled),G.brokerEnabledOutgoing=getParam(B.ngOutgoing.isBrokerEnabled,F.brokerEnabledOutgoing)),B.ngIncoming&&(G.isGVCJoiningEnabled=getParam(B.ngIncoming.isGVCEnabled,F.isGVCJoiningEnabled),G.brokerEnabledIncoming=getParam(B.ngIncoming.isBrokerEnabled,F.brokerEnabledIncoming)),G.conversationServiceUrl=getUrl(B.conversationServiceUrl,F.conversationServiceUrl),G.uploadLogRequestUrl=getUrl(B.uploadLogRequestUrl,F.uploadLogRequestUrl),G.isConversationServiceUrlFromEcs=!!B.conversationServiceUrl,G.isUploadLogRequestUrlFromEcs=!!B.uploadLogRequestUrl,G.doHostlessCalling=getParam(B.allowHostlessCalls,F.doHostlessCalling),G.supportsCompressedServicePayload=getParam(B.supportCompressedTrouterPayload,F.supportsCompressedServicePayload),G.brokerRequestBatching=getParam(B.allowBrokerSubscribeBatching,F.brokerRequestBatching),G.brokerExclusively=getParam(B.brokerExclusively,F.brokerExclusively),G.handleRosterFromCreateAndJoin=getParam(B.handleRosterFromCreateAndJoin,F.handleRosterFromCreateAndJoin),G.handleMediaOfferFromPushNotification=getParam(B.handleMediaOfferFromPushNotification,F.handleMediaOfferFromPushNotification),G.handleNewOfferRequest=getParam(B.handleNewOfferRequest,F.handleNewOfferRequest),G.sendProgressFromCC=getParam(B.sendProgressFromCC,F.sendProgressFromCC),G.handleUnmuteMuteFromResponse=getParam(B.handleUnmuteMuteFromResponse,F.handleUnmuteMuteFromResponse),G.useInternalHttpDispatcher=getParam(B.webInternalHttpDispatcher,F.useInternalHttpDispatcher),(B.webInternalHttpDispatcherConfigNetworkRequest||F.requestTypeHttpDispatcherConfigMap)&&(B.webInternalHttpDispatcherConfigNetworkRequest=B.webInternalHttpDispatcherConfigNetworkRequest||{},F.requestTypeHttpDispatcherConfigMap=F.requestTypeHttpDispatcherConfigMap||{},G.requestTypeHttpDispatcherConfigMap=W(W({},F.requestTypeHttpDispatcherConfigMap),B.webInternalHttpDispatcherConfigNetworkRequest)),(B.operationTypeHttpDispatcherConfigMap||F.operationTypeHttpDispatcherConfigMap)&&(B.operationTypeHttpDispatcherConfigMap=B.operationTypeHttpDispatcherConfigMap||{},F.operationTypeHttpDispatcherConfigMap=F.operationTypeHttpDispatcherConfigMap||{},G.operationTypeHttpDispatcherConfigMap=W(W({},F.operationTypeHttpDispatcherConfigMap),B.operationTypeHttpDispatcherConfigMap)),(B.csaTimeoutConfiguration||F.csaTimeoutConfiguration)&&(B.csaTimeoutConfiguration=B.csaTimeoutConfiguration||{},F.csaTimeoutConfiguration=F.csaTimeoutConfiguration||{},G.csaTimeoutConfiguration=W(W({},F.csaTimeoutConfiguration),B.csaTimeoutConfiguration)),G.overrideDisplayName=getParam(B.overrideDisplayName,F.overrideDisplayName),G.autoJoinOnConflict=getParam(B.autoJoinOnConflict,F.autoJoinOnConflict),G.enableDeltaRosterWeb=getParam(B.enableDeltaRosterWeb,F.enableDeltaRosterWeb),G.processSelfDataFromSubscribeResponse=getParam(B.processSelfDataFromSubscribeResponse,F.processSelfDataFromSubscribeResponse),G.enableMusicOnHoldV2=getParam(B.enableMusicOnHoldV2,F.enableMusicOnHoldV2),G.enablePstnMasking=getParam(B.enablePstnMasking,F.enablePstnMasking),G.enableQuickSendAcceptanceAck=getParam(B.enableQuickSendAcceptanceAck,F.enableQuickSendAcceptanceAck),G.supportMediaRetargetWhileIncomingRenegotiation=getParam(B.supportMediaRetargetWhileIncomingRenegotiation,F.supportMediaRetargetWhileIncomingRenegotiation),G.enableStaging=getParam(B.enableStaging,F.enableStaging),G.enableErrorCodeImprovementsForNetworkFailures=getParam(B.enableErrorCodeImprovementsForNetworkFailures,F.enableErrorCodeImprovementsForNetworkFailures),G.enableMergeParticipantLegsBatchSupport=getParam(B.enableMergeParticipantLegsBatchSupport,F.enableMergeParticipantLegsBatchSupport),G.enableCallEstablishmentTimeoutsForStartJoinCall=getParam(B.enableCallEstablishmentTimeoutsForStartJoinCall,F.enableCallEstablishmentTimeoutsForStartJoinCall),G.callingServiceSupportsAADTokens=getParam(B.callingServiceSupportsAADTokens,F.callingServiceSupportsAADTokens),G.aadTokenExpirationTimeInSeconds=getParam(B.aadTokenExpirationTimeInSeconds,F.aadTokenExpirationTimeInSeconds),G.popTokenExpirationTimeInSeconds=getParam(B.popTokenExpirationTimeInSeconds,F.popTokenExpirationTimeInSeconds),G.refreshTimeBeforeTokenTimeoutInSeconds=getParam(B.refreshTimeBeforeTokenTimeoutInSeconds,F.refreshTimeBeforeTokenTimeoutInSeconds),G};function getParam(F,B){return null==F?B:F}function getUrl(F,B){return F||B}function convertScreenSharingFlag(F,B){return B&&F?"enabled":F?"recvOnly":!1===F&&!1===B?"disabled":void 0}function convertEmergencyCallCountryFlag(F,B){return!1===F?"":B}B.updateSignalingAgentConfig=updateSignalingAgentConfig},function(F,B,G){var W=this&&this.__values||function(F){var B="function"==typeof Symbol&&Symbol.iterator,G=B&&F[B],W=0;if(G)return G.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&W>=F.length&&(F=void 0),{value:F&&F[W++],done:!F}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(B,"__esModule",{value:!0}),B.OneDsTelemetryTransportLogger=void 0;var z=G(492),K=G(171),J=G(1),Q=G(34),Y=function(){function OneDsTelemetryTransportLogger(F,B,G){void 0===G&&(G=K.EventLatency.Normal);var W=this;this.settings=F,this.envOverride=B,this.eventLatency=G,this.manager=new K.ApplicationInsightsManager,this.managerConfig=this.createConfigForManager(),this.currentTransmitProfile=Q.Constants.REPORTING_PROFILE.RT_PROFILE,this.initManager(),this.uiVersion=this.getUiVersion(),this.settings.configProvider.on("configUpdated",(function(){return W.updateChannelConfig()}))}return OneDsTelemetryTransportLogger.prototype.createLogger=function(F){return new $(F,this.manager,this.settings.configProvider,this.uiVersion,this.settings.contextProvider,this.envOverride,this.settings.logger,this.eventLatency)},OneDsTelemetryTransportLogger.prototype.createConfigForManager=function(){var F={extensionConfig:{LocalStorage:{storageKey:"TsCalling"}},propertyConfiguration:{populateBrowserInfo:!0,populateOperatingSystemInfo:!0},channelConfiguration:{eventsLimitInMem:this.settings.configProvider.config.eventsLimitInMem},endpointUrl:this.settings.configProvider.config.collectorUrl,enableCompoundKey:this.settings.configProvider.config.enableCompoundKey};if(this.settings.configProvider.config.useLocalStorageForOneDs){var B=new z.LocalStorageChannel;F.channels=[[B]]}return F},OneDsTelemetryTransportLogger.prototype.getUiVersion=function(){var F=this.settings.clientInfo.match(/^.*?\/(\d+\/)(.*?)\/.*$/);return F?F[1]+F[2]:this.settings.clientInfo},OneDsTelemetryTransportLogger.prototype.updateChannelConfig=function(){this.settings.configProvider.config.eventsLimitInMem!==this.managerConfig.channelConfiguration.eventsLimitInMem&&this.manager.getPostChannel().setEventQueueLimits(this.settings.configProvider.config.eventsLimitInMem),this.setTransmitProfile()},OneDsTelemetryTransportLogger.prototype.initManager=function(){var F=this;this.manager.create(this.managerConfig,[]),this.manager.getPostChannel()._notificationManager.addNotificationListener({eventsDiscarded:function(B,G){return F.logDiscardedEvents(B,G)},eventsSent:function(B){return F.logSentEvents(B)}}),this.setTransmitProfile()},OneDsTelemetryTransportLogger.prototype.logDiscardedEvents=function(F,B){var G="discarded events:";F.forEach((function(F){return G="".concat(G+F.name,";")})),this.settings.logger.info("".concat(G," reason:").concat(B))},OneDsTelemetryTransportLogger.prototype.logSentEvents=function(F){var B,G,W=(null===(G=null===(B=F[0])||void 0===B?void 0:B.data)||void 0===G?void 0:G.CorrelationId)&&J.getFrom("value",F[0].data.CorrelationId),z="sent events: ".concat(W,":");F.forEach((function(F){z="".concat(z+F.name,";")})),this.settings.logger.info("".concat(z))},OneDsTelemetryTransportLogger.prototype.setTransmitProfile=function(){var F;this.settings.configProvider.config.transmitProfileTimings.length&&this.manager.getPostChannel()._loadTransmitProfiles(((F={})[this.settings.configProvider.config.transmitProfileName]=this.settings.configProvider.config.transmitProfileTimings,F)),this.settings.configProvider.config.transmitProfileName!==this.currentTransmitProfile&&this.manager.getPostChannel()._setTransmitProfile(this.settings.configProvider.config.transmitProfileName),this.currentTransmitProfile=this.settings.configProvider.config.transmitProfileName},OneDsTelemetryTransportLogger}();B.OneDsTelemetryTransportLogger=Y;var $=function(){function OneDsTelemetryTransport(F,B,G,W,z,J,Q,Y){void 0===Y&&(Y=K.EventLatency.Normal),this.tenant=F,this.manager=B,this.configProvider=G,this.uiVersion=W,this.contextProvider=z,this.envOverride=J,this.logger=Q,this.eventLatency=Y,this.instanceConfig={extensions:[],extensionConfig:[]}}return OneDsTelemetryTransport.prototype.sendEvent=function(F){var B,G,z,J,Q,Y,$;this.setEnvPropertiesToEveryEvent();var X=this.configProvider.config.telemetryTenants[this.tenant],Z=null!==(z=this.manager.getInst(X))&&void 0!==z?z:this.manager.newInst(X,this.instanceConfig,[]),ee=F.props,te={};switch(this.logger.info("preparing event for delievery: ".concat(null!==(Q=null===(J=F.props)||void 0===J?void 0:J.CorrelationId)&&void 0!==Q?Q:"","/").concat(F.eventName)),this.tenant){case"signaling":ee.SkypeId&&(te.user_id={value:ee.SkypeId,kind:10},te.Skype_InitiatingUser_Username={value:ee.SkypeId,kind:10},te.SkypeId={value:ee.SkypeId,kind:10},delete ee.SkypeId),this.uiVersion&&(te.ui_version={value:this.uiVersion,kind:0});break;case"media":case"tlePlayer":this.uiVersion&&(te.uiVersion={value:this.uiVersion,kind:0});break;case"realtimeMedia":this.uiVersion&&(te["AppInfo.Version"]={value:this.uiVersion,kind:0})}try{for(var ne=W(Object.keys(ee)),ie=ne.next();!ie.done;ie=ne.next()){var re=ie.value,oe=ee[re];te[re]={value:null!==(Y=null==oe?void 0:oe.value)&&void 0!==Y?Y:oe,kind:null!==($=null==oe?void 0:oe.piiKind)&&void 0!==$?$:0}}}catch(F){B={error:F}}finally{try{ie&&!ie.done&&(G=ne.return)&&G.call(ne)}finally{if(B)throw B.error}}var ae={name:F.eventName,data:te,latency:this.eventLatency,persistence:K.EventPersistence.Normal};this.configProvider.config.useSendBeaconSync&&(ae.sync=2),this.logger.info("about to send event ".concat(JSON.stringify(ae))),Z.track(ae)},OneDsTelemetryTransport.prototype.setEnvPropertiesToEveryEvent=function(){var F,B,G,z,K,Q,Y,$=null===(K=this.contextProvider)||void 0===K?void 0:K.call(this);if(!J.deepEqual(this.ctx,$)&&(this.ctx=$,this.ctx))if(this.envOverride)try{for(var X=W(Object.keys(this.envOverride||{})),Z=X.next();!Z.done;Z=X.next()){var ee=Z.value,te=null!==(Q=this.ctx[ee].piiKind)&&void 0!==Q?Q:0,ne=this.ctx[ee].value;this.manager.getPropertyManager().setProperty(this.envOverride[ee],{value:ne,kind:te})}}catch(B){F={error:B}}finally{try{Z&&!Z.done&&(B=X.return)&&B.call(X)}finally{if(F)throw F.error}}else try{for(var ie=W(Object.keys(this.ctx)),re=ie.next();!re.done;re=ie.next()){ee=re.value,te=null!==(Y=this.ctx[ee].piiKind)&&void 0!==Y?Y:0;this.manager.getPropertyManager().setProperty(ee,{value:this.ctx[ee].value,kind:te})}}catch(F){G={error:F}}finally{try{re&&!re.done&&(z=ie.return)&&z.call(ie)}finally{if(G)throw G.error}}},OneDsTelemetryTransport}()},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.generateCauseId=B.getVersion=B.getOvb=B.pluginlessStackFactory=B.HttpRequestDispatcherImplementation=void 0;var W=G(75);Object.defineProperty(B,"HttpRequestDispatcherImplementation",{enumerable:!0,get:function(){return W.HttpRequestDispatcher}});var z=G(167);Object.defineProperty(B,"pluginlessStackFactory",{enumerable:!0,get:function(){return z.pluginlessStackFactory}});var K=G(32);Object.defineProperty(B,"getOvb",{enumerable:!0,get:function(){return K.getOvb}}),Object.defineProperty(B,"getVersion",{enumerable:!0,get:function(){return K.getTsCallingVersion}});var J=G(13);Object.defineProperty(B,"generateCauseId",{enumerable:!0,get:function(){return J.generateCauseId}})},function(F,B,G){G.r(B),G.d(B,"LocalStorageChannel",(function(){return it})),G.d(B,"StorageProviders",(function(){return re})),G.d(B,"BaseTelemetryPlugin",(function(){return ue.a})),G.d(B,"LoggingSeverity",(function(){return rt.a})),G.d(B,"_InternalLogMessage",(function(){return ot.b})),G.d(B,"_InternalMessageId",(function(){return rt.b}));var W=G(173),z=G(42),K=G(0),J=G(7),Q=K.o;function _createPromiseAllOnResolvedFunction(F,B,G){return function(W){F[B]=W,G()}}var Y=function(){function ESPromise(F){var B=0,G=null,W=[];function _enqueue(F,z,K,J){W.push((function(){var W;try{(W=1===B?Q(F)?F(G):G:Q(z)?z(G):G)instanceof ESPromise?W.then(K,J):2!==B||Q(z)?K(W):J(W)}catch(F){return void J(F)}})),0!==B&&_processQueue()}function _processQueue(){if(W.length>0){var F=W.slice();W=[],setTimeout((function(){for(var B=0,G=F.length;B<G;++B)try{F[B]()}catch(F){}}),0)}}function _resolve(F){0===B&&(G=F,B=1,_processQueue())}function _reject(F){0===B&&(G=F,B=2,_processQueue())}Object(J.a)(ESPromise,this,(function(F){F.then=function(F,B){return new ESPromise((function(G,W){_enqueue(F,B,G,W)}))},F.catch=function(B){return F.then(null,B)}})),function _initialize(){if(!Q(F))throw new TypeError("ESPromise: resolvedFunc argument is not a Function");try{F(_resolve,_reject)}catch(F){_reject(F)}}()}return ESPromise.resolve=function(F){return F instanceof ESPromise?F:F&&Q(F.then)?new ESPromise((function(B,G){try{F.then(B,G)}catch(F){G(F)}})):new ESPromise((function(B){B(F)}))},ESPromise.reject=function(F){return new ESPromise((function(B,G){G(F)}))},ESPromise.all=function(F){if(F&&F.length)return new ESPromise((function(B,G){try{for(var W=[],z=0,K=0;K<F.length;K++){var J=F[K];J&&Q(J.then)?(z++,J.then(_createPromiseAllOnResolvedFunction(W,K,(function(){0==--z&&B(W)})),G)):W[K]=J}0===z&&setTimeout((function(){B(W)}),0)}catch(F){G(F)}}))},ESPromise.race=function(F){return new ESPromise((function(B,G){if(F&&F.length)try{for(var _loop_1=function(W){var z=F[W];z&&Q(z.then)?z.then(B,G):setTimeout((function(){B(z)}),0)},W=0;W<F.length;W++)_loop_1(W)}catch(F){G(F)}}))},ESPromise}(),$=Y,X=G(29),Z=6e5,ee=0,te=[],ne=[],ie=[];function _getTime(){return(new Date).getTime()}var re,oe=function(){function ESPromiseScheduler(F,B){var G=0,W=(F||"<unnamed>")+"."+ee;function _debugLog(F){var B=Object(X.a)();B&&B.QUnit&&console&&console.log("ESPromiseScheduler["+W+"] "+F)}function _warnLog(F){B&&B.warnToConsole("ESPromiseScheduler["+W+"] "+F)}ee++,Object(J.a)(ESPromiseScheduler,this,(function(F){var B=null,z=0;function _removeQueuedEvent(F,B){for(var G=0;G<F.length;G++)if(F[G].id===B)return F.splice(G,1)[0];return null}F.scheduleEvent=function(F,K,J){var Q=W+"."+z;z++,K&&(Q+="-("+K+")");var Y=Q+"{"+G+"}";G++;var X={evt:null,tm:_getTime(),id:Y,isRunning:!1,isAborted:!1};return X.evt=B?_waitForPreviousEvent(X,B):_startWaitingEvent(X),(B=X).evt._schId=Y,X.evt;function _abortAndRemoveOldEvents(F){for(var B=_getTime(),G=B-Z,W=F.length,z=0;z<W;){var K=F[z];if(K&&K.tm<G){var J=null;K.abort?(J="Aborting ["+K.id+"] due to Excessive runtime ("+(B-K.tm)+" ms)",K.abort(J)):J="Removing ["+K.id+"] due to Excessive runtime ("+(B-K.tm)+" ms)",_warnLog(J),F.splice(z,1),W--}else z++}}function _cleanup(F,G){var W=!1,z=_removeQueuedEvent(te,F);if(z||(z=_removeQueuedEvent(ie,F),W=!0),z){z.to&&(clearTimeout(z.to),z.to=null);var K=_getTime()-z.tm;G?W?_warnLog("Timed out event ["+F+"] finally complete -- "+K+" ms"):_debugLog("Promise ["+F+"] Complete -- "+K+" ms"):(ie.push(z),_warnLog("Event ["+F+"] Timed out and removed -- "+K+" ms"))}else _debugLog("Failed to remove ["+F+"] from running queue");B&&B.id===F&&(B=null),_abortAndRemoveOldEvents(te),_abortAndRemoveOldEvents(ne),_abortAndRemoveOldEvents(ie)}function _removeScheduledEvent(F,B){return function(G){return _cleanup(F,!0),B&&B(G),G}}function _waitForFinalResult(F,B,G,W){B.then((function(B){return B instanceof $?(_debugLog("Event ["+F+"] returned a promise -- waiting"),_waitForFinalResult(F,B,G,W),B):_removeScheduledEvent(F,G)(B)}),_removeScheduledEvent(F,W))}function _createScheduledEvent(F,B){var G=F.id;return new $((function(W,z){_debugLog("Event ["+G+"] Starting -- waited for "+(F.wTm||"--")+" ms"),F.isRunning=!0,F.abort=function(B){F.abort=null,F.isAborted=!0,_cleanup(G,!1),z(new Error(B))};var K=B(G);K instanceof $?(J&&(F.to=setTimeout((function(){_cleanup(G,!1),z(new Error("Timed out after ["+J+"] ms"))}),J)),_waitForFinalResult(G,K,(function(B){_debugLog("Event ["+G+"] Resolving after "+(_getTime()-F.tm)+" ms"),W(B)}),z)):(_debugLog("Promise ["+G+"] Auto completed as the start action did not return a promise"),W())}))}function _startWaitingEvent(B){var G=_getTime();return B.wTm=G-B.tm,B.tm=G,B.isAborted?$.reject(new Error("["+Q+"] was aborted")):(te.push(B),_createScheduledEvent(B,F))}function _waitForPreviousEvent(F,B){var G=new $((function(G,W){var z=_getTime()-B.tm,K=B.id;_debugLog("["+Q+"] is waiting for ["+K+":"+z+" ms] to complete before starting -- ["+ne.length+"] waiting and ["+te.length+"] running"),F.abort=function(B){F.abort=null,_removeQueuedEvent(ne,Q),F.isAborted=!0,W(new Error(B))},B.evt.then((function(B){_removeQueuedEvent(ne,Q),_startWaitingEvent(F).then(G,W)}),(function(B){_removeQueuedEvent(ne,Q),_startWaitingEvent(F).then(G,W)}))}));return ne.push(F),G}}}))}return ESPromiseScheduler.incomplete=function(){return te},ESPromiseScheduler.waitingToStart=function(){return ne},ESPromiseScheduler}(),ae=oe,se=G(67),ce=G(36),le=G(35),de=G(19),ue=G(172);
/**
	* LocalStorageChannel.ts
	* @author Nev Wylie (newylie) Hector Hernandez (hectorh)
	* @copyright Microsoft 2019
	*/
function isValidPersistenceLevel(F){return Object(K.s)(F)&&F>=de.b.Normal&&F<=de.b.Critical}
/**
	* WebStorageProvider.ts
	* @author Abhilash Panwar (abpanwar) Hector Hernandez (hectorh) Nev Wylie (newylie)
	* @copyright Microsoft 2019
	*/!function(F){F[F.LocalStorage=1]="LocalStorage",F[F.SessionStorage=2]="SessionStorage",F[F.IndexedDb=3]="IndexedDb"}(re||(re={}));var pe=10,he="3",ge="Version",fe=6e5,me="AWTEvents",ve=5e6,ye=1,Se=2;function _isQuotaExceeded(F,B){var G=!1;return B instanceof DOMException&&(22!==B.code&&"QuotaExceededError"!==B.name&&1014!==B.code&&"NS_ERROR_DOM_QUOTA_REACHED"!==B.name||F&&0!==F.length&&(G=!0)),G}function _getAvailableStorage(F){var B=Object(X.a)()||{},G=null;try{if(G=B[F]){var W="__storage_test__";G.setItem(W,W),G.removeItem(W)}}catch(F){_isQuotaExceeded(G,F)||(G=null)}return G}function _forEachMap(F,B){if(F)for(var G=Object(K.B)(F),W=0;W<G.length;W++){var z=G[W];if(!B(F[z],z))break}}function _isMapEmpty(F){var B=!0;return _forEachMap(F,(function(F,G){return F&&(B=!1),B})),B}function _dropEventsUpToPersistence(F,B){for(var G=ye,W=0,_loop_1=function(){var F=[],z=B[G];if(_forEachMap(z,(function(B,G){return F.push(G),++W<pe})),W>0){for(var K=0;K<F.length;K++)delete z[F[K]];return{value:!0}}G++};G<=F&&W<pe;){var z=_loop_1();if("object"==typeof z)return z.value}return W>0}var _e=isValidPersistenceLevel,Ce=function(){function WebStorageProvider(F,B){Object(J.a)(WebStorageProvider,this,(function(G){var W=null,z=me,K=null,J=he,Q=null,Y=null,X=ve,Z=null,ee=null;function _newStore(F,B){return{key:F,db:B}}function _fetchStoredDb(F,B){void 0===B&&(B=!0);var G=null;if(W){var z=W.getItem(F);if(z)try{G=JSON.parse(z)}catch(B){W.removeItem(F)}}return B&&!G&&(G={events:{1:{},2:{},3:{}},lastAccessTime:0}),_newStore(F,G)}function _updateStoredDb(F,B){void 0===B&&(B=!0);var G=!0,z=F.db;if(z){B&&(z.lastAccessTime=(new Date).getTime());for(var K=ye;K<=Se;K++)if(!_isMapEmpty(z.events[K])){G=!1;break}}try{if(G)W&&W.removeItem(F.key);else{var J=JSON.stringify(z);if(J.length>X)return!1;W&&W.setItem(F.key,J)}}catch(F){return!1}return!0}function _clearDatabase(F){var B=[],G=_fetchStoredDb(F,!1),z=G.db;if(z){var K=z.events;try{for(var J=ye;J<=Se;J++)_forEachMap(K[J],(function(F,G){return F&&B.push(F),!0}))}catch(F){}W&&W.removeItem(G.key)}return B}function _checkVersionAndMoveEventsToCurrentStorage(){if(W){for(var F=W.getItem(Z),B=[],G=_fetchStoredDb(ee),K=!1,Q=0;Q<W.length;Q++){var $=W.key(Q);if(0===$.indexOf(z)&&$!==Z){if(F!==he){B.push(_newStore($,null));continue}var X=_fetchStoredDb($,!1),te=X.db;if(te){if((new Date).getTime()-te.lastAccessTime>fe){for(var ne=ye,_loop_3=function(){var F=te.events[ne],B=G.db.events[ne];_forEachMap(F,(function(G,W){return(Object(se.h)(G.iKey)||G.iKey)===Y&&(B[W]=G,delete F[W]),!0})),ne++};ne<=Se;)_loop_3();K=!0,B.push(X)}}else B.push(_newStore($,null))}}for(Q=0;Q<B.length;Q++)_updateStoredDb(B[Q],!1);K&&_updateStoredDb(G),W.setItem(Z,J)}}G.id=B,W=_getAvailableStorage(F)||null,G.initialize=function(F){if(!W)return!1;var B=F.storageConfig||{};return X=B.maxStorageSizeInBytes>0?B.maxStorageSizeInBytes:X,z=B.storageKey||me,K=G.id||F.id||Object(ce.f)(),ee=z+"."+K,Z=z+ge,Q=F.itemCtx.getCfg().instrumentationKey,Y=Object(se.h)(Q)||Q,_checkVersionAndMoveEventsToCurrentStorage(),!0},G.supportsSyncRequests=function(){return!0},G.getAllEvents=function(){try{var F=[],B=_fetchStoredDb(ee,!1).db;if(B)for(var G=B.events,W=Se;W>=ye;W--)_forEachMap(G[W],(function(B){B&&((Object(se.h)(B.iKey)||B.iKey)===Y&&F.push(B));return!0}));return $.resolve(F)}catch(F){return $.reject(F)}},G.addEvent=function(F,B,G){try{var W=_fetchStoredDb(ee);B.id=B.id||Object(ce.f)(),_e(B.persistence)||(B.persistence=ye);for(var z=B.persistence,K=B.id,J=W.db.events;;){if(J[z][K]=B,_updateStoredDb(W))return $.resolve(B);if(delete J[z][K],!_dropEventsUpToPersistence(z,J))return $.reject(new Error("Unable to free up event space"))}}catch(F){return $.reject(F)}},G.removeEvents=function(F){try{var B=_fetchStoredDb(ee,!1),G=B.db;if(G){var W=G.events;try{for(var z=0;z<F.length;++z){var K=F[z];delete W[K.persistence][K.id]}if(_updateStoredDb(B))return $.resolve(F)}catch(F){}F=_clearDatabase(B.key)}return $.resolve(F)}catch(F){return $.reject(F)}},G.clear=function(){try{var F=[],B=_fetchStoredDb(ee,!1),G=B.db;if(G){for(var W=G.events,_loop_2=function(B){var G=W[B];_forEachMap(G,(function(B){B&&((Object(se.h)(B.iKey)||B.iKey)===Y&&(delete G[B.id],F.push(B)));return!0}))},z=Se;z>=ye;z--)_loop_2(z);_updateStoredDb(B)}return $.resolve(F)}catch(F){return $.reject(F)}},G.teardown=function(){try{var F=_fetchStoredDb(ee,!1),B=F.db;B&&(B.lastAccessTime=0,_updateStoredDb(F,!1))}catch(F){}}}))}return WebStorageProvider}(),Te=G(11),Ee="readwrite",be="result",Ie="DBError: Unable to open database",Ae="Database is not open",Re="DBError: Failed to Open Cursor",Pe="DBError: Failed to delete the database",Oe="DBError: Database does not exist",Me="DBError: Database upgrade required",we="DBError: Feature not supported",De=["indexedDB"],Ne=K.o,Le=K.u;function _getDbFactory(){var F=Object(X.a)()||{},B=null;if(F)try{for(var G=0;G<De.length;G++)if((B=F[De[G]])&&Ne(B.open))return B}catch(F){B=null}return B||null}function IndexedDbHelper_debugLog(F,B){Object(Te.e)("QUnit")&&console&&console.log("IndexedDbHelper ["+F+"] "+B)}function IndexedDbHelper_warnLog(F,B,G){F&&F.warnToConsole("IndexedDbHelper ["+B+"] "+G)}function _eventReject(F,B,G,W){return function(z){G(new Error(B)),IndexedDbHelper_debugLog(F,"["+W+"] event rejected")}}var ke=[];function _getDbContext(F,B){for(var G=null,W=0;W<ke.length;W++)if((G=ke[W]).name===F)return G;return G={name:F,sch:new ae("IndexedDbHelper["+F+"]",B),dbHdl:[],add:function(B){G.dbHdl.push(B),IndexedDbHelper_debugLog(F,"- dbOpened (add) -- hdls ["+G.dbHdl.length+"]")},remove:function(B){for(var W=G.dbHdl,z=0;z<W.length;z++)if(W[z]===B){W.splice(z,1);break}IndexedDbHelper_debugLog(F,"- dbClosed (remove) -- hdls ["+G.dbHdl.length+"]")},isOpen:function(){return G.dbHdl.length>0},openHdl:function(){return G.dbHdl.length>0?G.dbHdl[0]:null}},ke.push(G),G}var Fe=function(){function IndexedDbHelper(F){Object(J.a)(IndexedDbHelper,this,(function(B){var G=_getDbFactory()||null;function _createStoreContext(B,G){var W=B.db.transaction(G,Ee);return W.onabort=function(){IndexedDbHelper_warnLog(F,B.dbName,"txn.onabort")},W.onerror=function(){IndexedDbHelper_warnLog(F,B.dbName,"txn.onerror")},W.oncomplete=function(){IndexedDbHelper_debugLog(B.dbName,"txn.oncomplete")},{db:B,store:W.objectStore(G),tx:W,tbl:G,openCursor:function(F,W){return _openCursor(B,G,F,W)},newTransaction:function(F){return _openStore(B,G,F)}}}function _openStore(F,B,G){if(!F||!F.db)return $.reject(new Error(Ae));try{var W=G(_createStoreContext(F,B));return W instanceof $?W:$.resolve(W)}catch(F){return $.reject(F)}}function _openCursor(F,B,G,W){if(!F||!F.db)return $.reject(new Error(Ae));var z=null;return G&&Le(G)?z=new xe(G):G&&G.isMatch&&(z=G),new $((function(G,K){var J=[],Q=null,Y=null;z&&z.keyRange&&(Y=z.keyRange());var $=_createStoreContext(F,B);(Q=Y?$.store.openCursor(Y):$.store.openCursor()).onerror=_eventReject($.db.dbName,Re,K,"openCursor"),Q.onsuccess=function(F){var B=F.target[be];if(B){var Q={store:$,cursor:B,continue:function(){B.continue()},done:function(){G(J)}},Y=B.value;if(!z||z.isMatch(Y))if(W)try{switch(W(Q,Y,J)){case 2:G(J);break;case 1:break;default:Q.continue()}}catch(F){K(F)}else J.push(Y),Q.continue();else Q.continue()}else G(J)}}))}function _scheduleEvent(F,B,G,W){return _getDbContext(F).sch.scheduleEvent(G,B,W)}B.isAvailable=function(){return!!G},B.openDb=function(B,W,z,K){return _scheduleEvent(B,"openDb",(function(J){return new $((function(Q,Y){var $=!1;function _createDbCtx(F,G,z,K,J){var Q={db:G,dbName:B,dbVersion:W,ctx:null,isNew:K,txn:z?z.transaction:null};return J||(Q.openStore=function(F,B){return _openStore(Q,F,B)},Q.openCursor=function(F,B,G){return _openCursor(Q,F,B,G)}),Q}function _databaseUpgrade(F,B){var G=_createDbCtx(null,F,B,!0,!0);if(K)$=!0,K(G).then((function(){G.txn||(G.txn=B.transaction)}),(function(F){try{B.transaction&&B.transaction.abort()}finally{Y(F)}}));else try{B.transaction&&B.transaction.abort()}finally{Y(new Error(Me))}}function _databaseOpen(G,W){var K=_getDbContext(B);K.add(G),G.onabort=function(W){IndexedDbHelper_warnLog(F,B,"onabort -- closing the Db"),K.remove(G)},G.onerror=function(W){IndexedDbHelper_warnLog(F,B,"onerror -- closing the Db"),K.remove(G)},G.onclose=function(W){IndexedDbHelper_warnLog(F,B,"onclose -- closing the Db"),K.remove(G)},G.onversionchange=function(W){IndexedDbHelper_warnLog(F,B,"onversionchange -- force closing the Db"),G.close(),K.remove(G)};var J=null,X=null;K.dbHdl.length>0&&(X=K.dbHdl[0]),J=_createDbCtx(K,X,W,$);try{z(J).then((function(F){Q(F)}),Y)}catch(F){Y(F)}}var X=_getDbContext(B);if(null==G)Y(new Error("No available storage factory"));else if(X.isOpen()){var Z=_createDbCtx(X,X.openHdl(),null,!1);z(Z).then(Q,Y)}else{var ee=G.open(B,W);ee.onblocked=function(G){IndexedDbHelper_warnLog(F,B,"Db Open Blocked event ["+J+"] - "+(ee.error||"")),Y(new Error(Ie))},ee.onerror=function(G){IndexedDbHelper_warnLog(F,B,"Db Open Error event ["+J+"] - "+(ee.error||"")),Y(new Error(Ie))},ee.onupgradeneeded=function(F){IndexedDbHelper_debugLog(B,"Db Open Create/Upgrade needed event ["+J+"]");try{var G=F.target[be];if(!G)return void Y(new Error(Ie));_databaseUpgrade(G,ee)}catch(F){_eventReject(B,Ie,Y,J)(F)}},ee.onsuccess=function(F){var B=F.target[be];B?_databaseOpen(B,ee):Y(new Error(Ie))}}}))}))},B.closeDb=function(F){_scheduleEvent(F,"closeDb",(function(B){var G=_getDbContext(F),W=G.dbHdl,z=W.length;if(z>0){for(var K=0;K<z;K++)W[K].close();G.dbHdl=[]}return $.resolve(1)}))},B.deleteDb=function(B){return null==G?$.resolve(!1):_scheduleEvent(B,"deleteDb",(function(W){var z=_getDbContext(B),K=z.dbHdl,J=K.length;if(J>0){IndexedDbHelper_warnLog(F,B,"Db is open ["+J+"] force closing");for(var Q=0;Q<J;Q++)K[Q].close();z.dbHdl=[]}return new $((function(z,K){setTimeout((function(){try{IndexedDbHelper_debugLog(B,"["+W+"] starting");var J=G.deleteDatabase(B);J.onerror=function(G){IndexedDbHelper_warnLog(F,B,"["+W+"] error!!"),K(new Error(Pe))},J.onblocked=function(G){IndexedDbHelper_warnLog(F,B,"["+W+"] blocked!!"),K(new Error(Pe))},J.onupgradeneeded=function(G){IndexedDbHelper_warnLog(F,B,"["+W+"] upgrade needed!!"),K(new Error(Pe))},J.onsuccess=function(F){IndexedDbHelper_debugLog(B,"["+W+"] complete"),z(!0)},IndexedDbHelper_debugLog(B,"["+W+"] started")}catch(G){IndexedDbHelper_warnLog(F,B,"["+W+"] threw - "+G),K(new Error(Pe+" - "+G))}}),0)}))}))},B.getDbDetails=function(F){return _scheduleEvent(F,"getDbDetails",(function(B){return null!=G&&G.databases?new $((function(B,W){G.databases().then((function(G){for(var z=0;z<G.length;z++)if(G[z].name===F)return void B(G[z]);W(new Error(Oe))}),W)})):$.reject(new Error(we))}),2e3)}}))}return IndexedDbHelper}(),xe=function(){function SimpleQuery(F){var B=[],G=null;Object(J.a)(SimpleQuery,this,(function(W){W.keyRange=function(){return G},W.parseQuery=function(F){if(B=[],F)for(var z=F.split(";"),K=0;K<z.length;K++){var J=z[K],Q=J.indexOf("=");if(-1!==Q){var Y=J.substring(0,Q),$=J.substring(Q+1);0===Y.indexOf("#")&&(Y=Y.substring(1),G||(G=IDBKeyRange.bound($,$+"￿"))),W.startsWith(Y,$)}}},W.startsWith=function(F,G){B.push({name:F,value:G,type:0})},W.contains=function(F,G){B.push({name:F,value:G,type:1})},W.isMatch=function(F){if(!B||0===B.length)return!0;if(!F)return!1;for(var G=0;G<B.length;G++){var W=B[G],z=F[W.name];if(z)if(0===W.type){if(0!==z.indexOf(W.value))return!1}else if(1===W.type&&-1===z.indexOf(W.value))return!1}return!0},F&&W.parseQuery(F)}))}return SimpleQuery}(),Ue=10,je=1,Be=6e5,He=1008e4,Ve="Unknown",Ge=-1,We="DBError: Unable to add event",qe="DBError: Unable to update iKey",ze="AppInsightEvents.1",Ke=1,Je="Evts",Qe="iKey",Ye=isValidPersistenceLevel;function IndexedDbProvider_getTime(){return(new Date).getTime()}function IndexedDbProvider_eventReject(F,B){return function(G){return B(new Error(F))}}function _createDb(F){F.objectStoreNames.contains(Je)||F.createObjectStore(Je,{keyPath:"key"}).createIndex("EvntId","key",{unique:!1});F.objectStoreNames.contains(Qe)||F.createObjectStore(Qe,{keyPath:"iKey"}).createIndex("iKey","iKey",{unique:!0})}function _updateiKey(F){return F.openStore(Qe,(function(B){return new $((function(G,W){var z={iKey:F.ctx.iKey,tm:IndexedDbProvider_getTime()},K=B.store.put(z);K.onsuccess=function(F){G(K.result.toString())},K.onerror=function(F){W(new Error(We))},K.onerror=IndexedDbProvider_eventReject(qe,W)}))}))}function _orderEventsByPriority(F){for(var B=[],G=de.b.Critical;G>=de.b.Normal;G--)for(var W=0;W<F.length;W++){var z=F[W];z&&z.evt.persistence===G&&B.push(z.evt)}return B}function _addEventByTime(F,B){for(var G=0;G<F.length;G++)if(B.tm<F[G].tm)return void F.splice(G,0,B);F.push(B)}function _getKeyIndex(F,B){for(var G=B.length,W=0;W<G;W++)if(F===B[W].id)return W;return-1}function _isOldItem(F,B){var G=F.tm;return IndexedDbProvider_getTime()-G>B}function _cursorContinueEvent(F){return function(B){return F.continue()}}function _cursorDeleteAndContinue(F){var B=F.cursor.delete();return B.onerror=_cursorContinueEvent(F),B.onsuccess=_cursorContinueEvent(F),1}function _getAllEventsForiKey(F,B){return F.openCursor(Je,B,(function(F,B,G){return G.push(B),0}))}function _deleteEvents(F,B,G){return F.openCursor(Je,B,(function(F,B,W){return G(B)?(W.push(B),_cursorDeleteAndContinue(F)):0}))}function _deleteOrphanedEvents(F){return new $((function(B,G){var W=!1;F.openCursor(Qe,null,(function(F,B,G){var z=B.tm;return IndexedDbProvider_getTime()-z<He?0:(W=!0,2)})).then((function(){if(W){var z={};_deleteEvents(F,null,(function(F){if(!F||!F.evt||!F.evt.iKey)return!0;var B=F.tm;return IndexedDbProvider_getTime()-B>He||(z[F.evt.iKey]=1,!1)})).then((function(){var W=[];F.openCursor(Qe,null,(function(F,B,G){var K=B.tm;return IndexedDbProvider_getTime()-K<He||z[B.iKey]?0:(W.push(B),_cursorDeleteAndContinue(F))})).then((function(){B(W)}),G)}),G)}else B([])}),G)}))}function _moveOldEventsToCurrentStore(F){return F.openCursor(Je,"#key="+F.ctx.iKeyPrefix(),(function(B,G){var W=G.key;if(0===W.indexOf(F.ctx.iKeyPrefix())&&-1===W.indexOf(F.ctx.evtKeyPrefix())&&_isOldItem(G,Be)){G.key=F.ctx.evtKeyPrefix()+G.id;var z=B.store.store.put(G);return z.onerror=_cursorContinueEvent(B),z.onsuccess=function(F){try{_cursorDeleteAndContinue(B)}catch(F){B.continue()}},1}return 0}))}function IndexedDbProvider_checkVersionAndMoveEventsToCurrentStorage(F){return new $((function(B,G){_deleteOrphanedEvents(F).then((function(){_moveOldEventsToCurrentStore(F).then(B,B)}),G)}))}function IndexedDbProvider_dropEventsUpToPersistence(F,B){return new $((function(G,W){var z=0,K=F.ctx.evtKeyPrefix();function _resolveWithDroppedEvents(){G(z)}function _dropEvent(F,B){return new $((function(G){var W=F.store.delete(B.key);W.onsuccess=function(F){z++,G()},W.onerror=function(F){G()}}))}function _processCandidates(B){0!==B.length?F.openStore(Je,(function(F){for(var G=[],W=0;W<B.length;W++)G.push(_dropEvent(F,B[W]));return $.all(G).then(_resolveWithDroppedEvents,_resolveWithDroppedEvents)})):_resolveWithDroppedEvents()}F.openCursor(Je,"#key="+K,(function(F,G,W){return G.evt.persistence<=B&&0===G.key.indexOf(K)&&(_addEventByTime(W,G),W.length>Ue&&W.splice(W.length-1,1)),0})).then(_processCandidates,(function(){G(0)}))}))}var $e=function(){function IndexedDbProvider(F){Object(J.a)(IndexedDbProvider,this,(function(B){var G=null,W=null,z=Ve,K=null,J=null,Q=null,Y=Ge,X=0;function _openDb(F){function _handleDbUpgrade(F){return new $((function(B,G){_createDb(F.db),B()}))}function _handleDbOpen(B){return new $((function(G,W){var Y={iKey:z,storageId:K,iKeyPrefix:function(){return J},evtKeyPrefix:function(){return Q}};B.ctx=Y,_updateiKey(B).then((function(){F(B).then(G,W)}),W)}))}return G.openDb(W,Ke,_handleDbOpen,_handleDbUpgrade)}function _addDbEvent(F,B,G){return new $((function(W,z){function dropEvents(B,G){IndexedDbProvider_dropEventsUpToPersistence(F,B).then((function(F){F>0&&(X-=F),G(F)}),(function(F){G(0)}))}function resolveAddEvent(F){W(B.evt)}function _insertNewEvent(){F.openStore(Je,(function(K){var J=K.store.put(B);J.onsuccess=function(z){G&&_updateiKey(F).then(resolveAddEvent,resolveAddEvent),X++,W(B.evt)},J.onerror=function(K){function _retryAddEvent(G){0===G&&z(new Error(We)),_addDbEvent(F,B,!1).then((function(F){W(B.evt)}),(function(){z(new Error(We))}))}G?dropEvents(de.b.Normal,(function(F){F>0?_retryAddEvent(F):B.evt.persistence>=de.b.Critical?dropEvents(de.b.Critical,(function(F){_retryAddEvent(F)})):z(new Error(We))})):z(new Error(We))}}))}Y>0&&X>=Y?dropEvents(de.b.Normal,(function(F){0===F?B.evt.persistence>=de.b.Critical?dropEvents(de.b.Critical,(function(F){_insertNewEvent()})):z(new Error(We)):_insertNewEvent()})):_insertNewEvent()}))}B.id=F,B.initialize=function(F){var X=F.itemCtx.diagLog();if(!(G=new Fe(X)).isAvailable())return G=null,!1;var Z=F.itemCtx.getCfg(),ee=F.storageConfig||{};return W=ee.indexedDbName||ze,z=Z.instrumentationKey||z,K=B.id||F.id||Object(ce.f)(),Q=(J=z+"::")+K+"::",Y=ee.maxStorageItems>0?ee.maxStorageItems:Y,_openDb((function(F){return F.isNew?$.resolve(!0):IndexedDbProvider_checkVersionAndMoveEventsToCurrentStorage(F)})).then((function(F){}),(function(F){X.warnToConsole("IndexedDbProvider failed to initialize - "+(F||"<unknown>")),G=null})),!0},B.supportsSyncRequests=function(){return!1},B.getAllEvents=function(){return null!=G&&G.isAvailable()?_openDb((function(F){return new $((function(B,G){_getAllEventsForiKey(F,"#key="+F.ctx.evtKeyPrefix()).then((function(F){X=F.length,B(_orderEventsByPriority(F))}),G)}))})):$.resolve([])},B.addEvent=function(F,B,W){return null!=G&&G.isAvailable()?(B.id=B.id||Object(ce.f)(),Ye(B.persistence)||(B.persistence=de.b.Normal),_openDb((function(G){var W=F||B.id,z={key:G.ctx.evtKeyPrefix()+W,id:W,evt:B,tm:IndexedDbProvider_getTime(),v:je};return _addDbEvent(G,z,!0)}))):$.resolve(B)},B.removeEvents=function(F){if(null==G||!G.isAvailable())return $.resolve([]);var B=[];return new $((function(G,W){_openDb((function(G){return G.openCursor(Je,"#key="+G.ctx.iKey,(function(G,W,z){if(-1!==_getKeyIndex(W.id,F)){var K=G.cursor.delete();return K.onerror=_cursorContinueEvent(G),K.onsuccess=function(){B.push(W.evt),G.continue()},1}return 0}))})).then((function(F){X-=B.length,G(B)}),(function(F){X-=B.length,G(B)}))}))},B.clear=function(){return null!=G&&G.isAvailable()?new $((function(F,B){_openDb((function(F){return _deleteEvents(F,"#key="+F.ctx.evtKeyPrefix(),(function(B){return 0===B.key.indexOf(F.ctx.evtKeyPrefix())}))})).then((function(B){X=0,F(_orderEventsByPriority(B))}),B)})):$.resolve([])},B.teardown=function(){G&&G.closeDb(W)}}))}return IndexedDbProvider}(),Xe="3.1.11",Ze="LocalStorage",et=5,tt=isValidPersistenceLevel,nt=function(F){function LocalStorageChannel(){var B=F.call(this)||this;return B.identifier=Ze,B.priority=1009,B.version=Xe,Object(J.a)(LocalStorageChannel,B,(function(F,B){var G=!1,W=!1,J=null,Q=[];function _queueStorageEvent(F,B){J||(J=new ae("LocalStorage")),J.scheduleEvent((function(F){return B(F)}),F)}function _sendStoredEventsToNextPlugin(B){Object(z.b)(F.core,(function(){return"LocalStorageChannel:_sendStoredEventsToNextPlugin"}),(function(){_queueStorageEvent("sendToNext",(function(G){return B.provider.getAllEvents().then((function(G){for(var W=0;W<G.length;W++)try{var z=G[W];(Object(se.h)(z.iKey)||z.iKey)===B.tenantId&&F.processNext(z,B.coreRootCtx.createNew())}catch(F){}}))}))}),(function(){return{iKeyConfig:B}}))}function _removeEvents(B,G){Object(z.b)(F.core,(function(){return"LocalStorageChannel:_removeEvents"}),(function(){_queueStorageEvent("removeEvents",(function(F){var W=[];return Object(K.a)(G,(function(F){(Object(se.h)(F.iKey)||F.iKey)===B.tenantId&&W.push(F)})),W.length>0?B.provider.removeEvents(W).then((function(F){})).catch((function(F){})):$.resolve()}))}),(function(){return{iKeyConfig:B,events:G}}))}function _shouldCacheEvent(F,B){return!(B.sync||B.persistence<F.minPersistenceCacheLevel)}function _tryGetIndexedDbProvider(F){var B=new $e;return B.initialize(F)||(B=null),B}function _tryGetWebStorageProvider(F,B){var G=new Ce(F);return G.initialize(B)||(G=null),G}function _initializeProvider(F){for(var B=F.storageConfig.providers,G=null,W=0;!G&&W<B.length&&W<et;)switch(B[W++]){case re.LocalStorage:G=_tryGetWebStorageProvider("localStorage",F);break;case re.SessionStorage:G=_tryGetWebStorageProvider("sessionStorage",F);break;case re.IndexedDb:G=_tryGetIndexedDbProvider(F)}return G}function _getCoreItemCtx(B,G,W,z){B&&(B.extensionConfig=B.extensionConfig||[]),!z&&G&&(z=G.getProcessTelContext().getNext());var K=null,J=F._getTelCtx().getNext();return J&&(K=J.getPlugin()),new le.a(z,B,G,K)}function _createIkeyConfig(B,G,W,z){var K=F.identifier,J=B.extensionConfig=B.extensionConfig||[],Y=J[K]=J[K]||{};Y.providers||(Y.providers=[re.LocalStorage,re.IndexedDb]);var $=_getCoreItemCtx(B,G,W,z),X={itemCtx:$,storageConfig:Y,id:F.id},Z=_initializeProvider(X);if(Z){var ee={iKey:B.instrumentationKey,tenantId:Object(se.h)(B.instrumentationKey)||B.instrumentationKey,minPersistenceCacheLevel:de.b.Normal,coreRootCtx:$,providerContext:X,provider:Z};tt(Y.minPersistenceLevel||-1)&&(ee.minPersistenceCacheLevel=Y.minPersistenceLevel),Q.push(ee),G.addNotificationListener({eventsSent:function(F){_removeEvents(ee,F)},eventsDiscarded:function(F,B){_removeEvents(ee,F)}}),_sendStoredEventsToNextPlugin(ee)}}F.initialize=function(F,W,K,Q){Object(z.b)(W,(function(){return"LocalStorageChannel.initialize"}),(function(){G||(B.initialize(F,W,K),B.setInitialized(!1),G=!0,J=new ae("LocalStorage",W.logger)),_createIkeyConfig(F,W,K,Q)}),(function(){return{coreConfig:F,core:W,extensions:K,pluginChain:Q}}))},F.processTelemetry=function(B,G){G=F._getTelCtx(G),Object(se.q)(B,F.identifier);var z=null;Object(K.a)(Q,(function(F){F.iKey===B.iKey&&(z=F)}));var J=W,Y=z?z.provider:null,$=B;!$.sync&&Y?($.id=$.id||Object(ce.f)(),isValidPersistenceLevel($.persistence)||($.persistence=1),_shouldCacheEvent(z,$)&&_queueStorageEvent("processTelemetry",(function(F){return Y.addEvent($.id,$,G)})),J||F.processNext($,G)):F.processNext($,G)},F.pause=function(){W=!0},F.resume=function(){Object(z.b)(F.core,(function(){return"LocalStorageChannel:resume"}),(function(){W=!1,Object(K.a)(Q,(function(F){F.provider&&_sendStoredEventsToNextPlugin(F)}))}))},F.teardown=function(){Object(K.a)(Q,(function(F){var B=F.provider;B&&B.teardown()})),Q=[]},F.flush=function(F,B){}})),B}return Object(W.b)(LocalStorageChannel,F),LocalStorageChannel}(ue.a),it=nt,rt=G(20),ot=G(43);
/**
	* LocalStorageChannel.ts
	* @author Abhilash Panwar (abpanwar) Hector Hernandez (hectorh)
	* @copyright Microsoft 2018
	*/}])}))}));const ne=400,ie=401,re=403,oe=404,ae=405,se=408,ce=409,le=412,de=422,ue=500,pe={Date:!0,RegExp:!0,String:!0,Number:!0};class CallingCommunicationError extends Error{constructor(F,B){if(super(),this._code=0,this._subCode=0,this.name="CallingCommunicationError",B instanceof CallingCommunicationError)return this._code=B.code,this._subCode=B.subCode,this.message=B.message,void(this.stack=B.stack);this.message=F.message,this._code=F.code,F.subCode&&(this._subCode=F.subCode),B instanceof Error&&(this.stack=B.stack)}get code(){return this._code}get subCode(){return this._subCode}}const he=Symbol("loggerKeySymbol");var ge,fe,me;(ge=F.CallAgentKind||(F.CallAgentKind={})).CallAgent="CallAgent",ge.TeamsCallAgent="TeamsCallAgent",(fe=F.CallKind||(F.CallKind={})).Call="Call",fe.TeamsCall="TeamsCall",(me=F.IncomingCallKind||(F.IncomingCallKind={})).IncomingCall="IncomingCall",me.TeamsIncomingCall="TeamsIncomingCall";var __awaiter=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};function syncOperation(F){return operationDecoratorFactory(F||"",!1)}function asyncOperation(F){return operationDecoratorFactory(F||"",!0)}const validateEmergencyCallOperation=B=>(G,W,z)=>{const K=z.value;return z.value=function(...G){if(this.kind===F.CallKind.TeamsCall&&this.isEmergencyCallInProgress())throw new CallingCommunicationError({message:`${B} operation is not allowed during Emergency Call`,code:ue});return K.apply(this,G)},z},operationDecoratorFactory=(F,B)=>B?(B,G,W)=>{const z=W.value;return W.value=function(...B){return __awaiter(this,void 0,void 0,(function*(){let G;const W=+new Date;tryToLogAcsMessage(this,F,"started");try{G=yield z.apply(this,B),tryToLogAcsMessage(this,F,"succeeded",W)}catch(B){const G=new CallingCommunicationError({message:`${F} failed`,code:ue},B);throw tryToLogAcsError(this,F,B,W),G}return G}))},W}:(B,G,W)=>{const z=W.value;return W.value=function(...B){let G;const W=+new Date;tryToLogAcsMessage(this,F,"started");try{G=z.apply(this,B),tryToLogAcsMessage(this,F,"succeeded",W)}catch(B){const G=new CallingCommunicationError({message:`${F} failed`,code:ue},B);throw tryToLogAcsError(this,F,B,W),G}return G},W};function tryToLogAcsMessage(F,B,G,W){const z=getAcsLogger(F);if(z){const F=W?`in ${(+new Date-W)/1e3}s`:"";z.info(`op:${B}, ${G} ${F}`)}}function tryToLogAcsError(F,B,G,W){const z=getAcsLogger(F);try{if(z){const F=W?`in ${(+new Date-W)/1e3}s`:"";G&&G.code?z.error(`op:${B} failed, message=${G.message}, code=${G.code}${G.subCode?`, subCode=${G.subCode}`:""} ${F}`):z.error(`op:${B} failed, message=${G.message} ${F}`)}}catch(G){}}function getAcsLogger(F){try{const B=Reflect.getMetadata(he,F);if(B)return F[B]}catch(F){}}function generateGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(F=>{const B=16*Math.random()|0;return("x"===F?B:3&B|8).toString(16)}))}var ve,ye,Se,_e,Ce,Te,Ee,be,Ie,Ae,Re,Pe,Oe,Me,we,De,Ne;function parseMeetingUrl(F){try{const B=new URL(F),G=B.pathname.split("/"),W=decodeURIComponent(G[3]),z=G[4],K=JSON.parse(decodeURIComponent(B.search.replace("?context=",""))),J=K.Oid;return{threadId:W,messageId:z,organizerId:J,tenantId:K.Tid}}catch(F){throw new CallingCommunicationError({message:"Invalid meeting link",code:de},F)}}function base64UrlEncoding(F){let B=btoa(F).replace(/=/g,"");B=B.replace(/\+/g,"-"),B=B.replace(/\//g,"_");for(const F of B)if(F.match(/[^A-Za-z0-9-_]/))throw new CallingCommunicationError({message:"Failed to get server call Id",code:ue});return B}!function(F){F.Outgoing="Outgoing",F.Incoming="Incoming",F.TransferOutgoing="TransferOutgoing"}(ve||(ve={})),function(F){F.CreateCallAgent="CreateCallAgent",F.CreateTeamsCallAgent="CreateTeamsCallAgent",F.GetDeviceManager="GetDeviceManager",F.GetSDKVersion="GetSDKVersion",F.GetEnvironmentInfo="GetEnvironmentInfo",F.Feature="Feature"}(ye||(ye={})),function(F){F.StartCall="StartCall",F.Join="Join",F.HandlePushNotifications="HandlePushNotification",F.Initialize="Initialize",F.Dispose="Dispose",F.CreateCall="CreateCall",F.Feature="Feature"}(Se||(Se={})),function(F){F.Call="Call",F.StartCall="StartCall",F.CallGroup="CallGroup",F.JoinGroup="JoinGroup",F.Accept="Accept",F.Reject="Reject",F.Mute="Mute",F.Unmute="Unmute",F.MuteIncomingAudio="MuteIncomingAudio",F.UnmuteIncomingAudio="UnmuteIncomingAudio",F.SendDtmf="SendDtmf",F.HangUp="HangUp",F.StartVideo="StartVideo",F.startAudio="startAudio",F.StopVideo="StopVideo",F.AddParticipant="AddParticipant",F.RemoveParticipant="RemoveParticipant",F.Hold="Hold",F.Resume="Resume",F.StartScreenShare="StartScreenShare",F.StopScreenShare="StopScreenShare",F.Transfer="Transfer",F.BindToCall="BindToCall",F.Feature="Feature"}(_e||(_e={})),function(F){F.GetServerCallId="GetServerCallId"}(Ce||(Ce={})),function(F){F.CreateStackBase="CreateStackBase",F.GetDeviceManager="GetDeviceManager",F.InitializeStackForUser="InitializeStackForUser",F.InitializeEcsBase="InitializeEcsBase",F.InitializeEcsForUser="InitializeEcsForUser",F.Dispose="Dispose"}(Te||(Te={})),function(F){F.GetDeviceManager="GetDeviceManager",F.GetCameras="GetCameras",F.GetMicrophones="GetMicrophones",F.GetSpeakers="GetSpeakers",F.GetCamera="GetCamera",F.SelectCamera="SelectCamera",F.GetSelectedMicrophone="GetSelectedMicrophone",F.SelectMicrophone="SelectMicrophone",F.GetSelectedSpeaker="GetSelectedSpeaker",F.SelectSpeaker="SelectSpeaker",F.RenderPreviewVideo="RenderPreviewVideo",F.AskDevicePermission="AskDevicePermission"}(Ee||(Ee={})),function(F){F.Dispose="Dispose",F.UpdateScalingMode="UpdateScalingMode",F.Render="Render",F.RenderRemoteStream="RenderRemoteStream",F.RenderLocalStream="RenderLocalStream"}(be||(be={})),function(F){F.Dispose="Dispose",F.CreateView="CreateView"}(Ie||(Ie={})),function(F){F.SwitchSource="SwitchSource",F.Render="Render"}(Ae||(Ae={})),function(F){F.SwitchSource="SwitchSource",F.GetMediaStreamTrack="GetMediaStreamTrack"}(Re||(Re={})),function(F){F.SwitchVideo="SwitchVideo"}(Ae||(Ae={})),function(F){F.SetScalingMode="SetScalingMode",F.Start="Start",F.Stop="Stop",F.SwitchDevice="SwitchDevice",F.Dispose="Dispose"}(Pe||(Pe={})),function(F){F.Render="Render"}(Oe||(Oe={})),function(F){F.Start="Start",F.Resume="Resume",F.Pause="Pause",F.SetScalingMode="SetScalingMode",F.Dispose="Dispose"}(Me||(Me={})),function(F){F.Start="Start",F.Resume="Resume",F.Pause="Pause",F.SetScalingMode="SetScalingMode",F.Dispose="Dispose"}(we||(we={})),function(F){F.SourceUnavailableError="SourceUnavailableError",F.PermissionDeniedError="permissionDeniedError",F.UnknownFailureForVideoOperation="UnknownFailureForVideoOperation"}(De||(De={})),function(F){F.BrowserNotSupported="BrowserNotSupported",F.IncompatibleVersions="IncompatibleVersions"}(Ne||(Ne={}));var __decorate=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$1=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class CallInfoImpl{constructor(F,B={}){this._tsCall=F;const G=this._tsCall.groupId;this._groupId=!G||G.startsWith("19:")||G.startsWith("99:")?void 0:G,this._roomId=B.roomId}get groupId(){return this._groupId}get roomId(){return this._roomId}getServerCallId(){return __awaiter$1(this,void 0,void 0,(function*(){const F=JSON.parse(yield this._tsCall.getJoinBlob()),B=null==F?void 0:F.conversationUrl;if(!B)throw new CallingCommunicationError({message:"Failed to get serverCallId, serverCallId is empty",code:oe});return base64UrlEncoding(B)}))}}__decorate([asyncOperation(Ce.GetServerCallId),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],CallInfoImpl.prototype,"getServerCallId",null);const Le="Skype",ke="ConfigIDs",Fe="This type of config is not currently supported.",xe="Ecs Service has not yet responded. Try calling this API again in sometime.",Ue="Possible duplicate call. Ecs already initialized for this confiugration definition.";var je,Be,He,Ve,Ge,We;!function(F){F.Public="https://ic3.events.data.microsoft.com/OneCollector/1.0/",F.PublicEUDB="https://eu-ic3.events.data.microsoft.com/OneCollector/1.0/",F.GccHigh="https://tb.events.data.microsoft.com/OneCollector/1.0/",F.Dod="https://pf.events.data.microsoft.com/OneCollector/1.0/",F.AirGap08="https://collector.azure.eaglex.ic.gov/OneCollector/1.0/",F.AirGap09="https://collector.azure.microsoft.scloud/OneCollector/1.0/",F.Enterprise="https://teams.events.data.microsoft.com/OneCollector/1.0"}(je||(je={})),function(F){F.Public="Public",F.GccHigh="GCCHigh",F.Dod="DoD",F.AirGap08="AirGap08",F.AirGap09="AirGap09"}(Be||(Be={})),function(F){F.OrgId="orgid",F.Acs="acs",F.Spool="spool",F.GccHigh="gcch",F.GccHighAcs="gcch-acs",F.Dod="dod",F.DodAcs="dod-acs",F.AirGap08="ag08",F.AirGap08Acs="ag08-acs",F.AirGap09="ag09",F.AirGap09Acs="ag09-acs"}(He||(He={})),function(F){F.Public_EcsServer_Url="https://ecs.office.com",F.GccHigh_EcsServer_Url="https://config.ecs.gov.teams.microsoft.us",F.Dod_EcsServer_Url="https://config.ecs.dod.teams.microsoft.us",F.AirGap08_EcsServer_Url="https://config.ecs.teams.eaglex.ic.go",F.AirGap09_EcsServer_Url="https://config.ecs.teams.microsoft.scloud",F.Enterprise_Ecs_ServerUrl="https://config.teams.microsoft.com"}(Ve||(Ve={})),function(F){F.Public_ConversationServiceUrl="https://api.flightproxy.skype.com/api/v2/cpconv",F.Public_TrouterServiceUrl="https://go.trouter.skype.com/v4/a",F.Public_RegistrarServiceUrl="https://prod.registrar.skype.com/v3/registrations",F.Public_MdnTrapServiceUrl="https://edge.skype.com/trap",F.Public_MdnTrapServiceTokenUrl="https://edge.skype.com/trap/tokens",F.Public_MdnTrapRelaySkypeFqdns="worldaz.tr.skype.com",F.Public_MdnTrapRelayTurnFqdns="turn.azure.com",F.Public_MdnTrapRelayTurnUrl="https://turn.azure.com/relay",F.GccHigh_ConversationServiceUrl="https://api.cc.gov.teams.microsoft.us/conv/",F.GccHigh_TrouterServiceUrl="https://go.trouter.gov.teams.microsoft.us/v4/a",F.GccHigh_RegistrarServiceUrl="https://registrar.gov.teams.microsoft.us/v3/registrations",F.GccHigh_MdnTrapServiceUrl="https://trap.gov.teams.microsoft.us",F.GccHigh_MdnTrapServiceTokenUrl="https://trap.gov.teams.microsoft.us/tokens",F.GccHigh_MdnTrapRelaySkypeFqdns="tr.gov.teams.microsoft.us",F.GccHigh_MdnTrapRelayTurnFqdns="turn.gov.teams.microsoft.us",F.GccHigh_MdnTrapRelayTurnUrl="https://turn.gov.teams.microsoft.us/relay",F.Dod_ConversationServiceUrl="https://api.cc.dod.teams.microsoft.us/conv/",F.Dod_TrouterServiceUrl="https://go.trouter.dod.teams.microsoft.us/v4/a",F.Dod_RegistrarServiceUrl="https://registrar.dod.teams.microsoft.us/v3/registrations",F.Dod_MdnTrapServiceUrl="https://trap.dod.teams.microsoft.us",F.Dod_MdnTrapServiceTokenUrl="https://trap.dod.teams.microsoft.us/tokens",F.Dod_MdnTrapRelaySkypeFqdns="tr.dod.teams.microsoft.us",F.Dod_MdnTrapRelayTurnFqdns="turn.dod.teams.microsoft.us",F.Dod_MdnTrapRelayTurnUrl="https://turn.dod.teams.microsoft.us/relay",F.AirGap08_ConversationServiceUrl="https://api.cc.skype.com/conv/",F.AirGap08_TrouterServiceUrl="https://go.trouter.teams.eaglex.ic.gov/v4/a",F.AirGap08_RegistrarServiceUrl="https://api.registrar.teams.eaglex.ic.gov/v3/registrations",F.AirGap09_ConversationServiceUrl="https://api.cc.skype.com/conv/",F.AirGap09_TrouterServiceUrl="https://go.trouter.teams.microsoft.scloud/v4/a",F.AirGap09_RegistrarServiceUrl="https://api.registrar.teams.microsoft.scloud/v3/registrations",F.Enterprise_ConversationServiceUrl="https://api.flightproxy.teams.microsoft.com/api/v2/epconv",F.Enterprise_TrouterServiceUrl="https://go.trouter.teams.microsoft.com/v4/a",F.Enterprise_RegistrarServiceUrl="https://teams.microsoft.com/registrar/prod/v3/registrations",F.Enterprise_MdnTrapServiceUrl="https://teams.microsoft.com/trap",F.Enterprise_MdnTrapServiceTokenUrl="https://teams.microsoft.com/trap/tokens",F.Enterprise_MdnTrapRelaySkypeFqdns="worldaz.tr.teams.microsoft.com",F.Enterprise_MdnTrapRelayTurnFqdns="worldaz.turn.teams.microsoft.com",F.Enterprise_MdnTrapRelayTurnUrl=""}(Ge||(Ge={})),function(F){F.Public_ConversationServiceUrl_EUDB="https://api.flightproxy.teams.microsoft.com/api/v2/epconv",F.Public_TrouterServiceUrl_EUDB="https://go.trouter.skype.com/v4/a",F.Public_RegistrarServiceUrl_EUDB="https://prod.registrar.skype.com/v3/registrations",F.Public_MdnTrapServiceUrl_EUDB="https://edge.skype.com/trap",F.Public_MdnTrapServiceTokenUrl_EUDB="https://edge.skype.com/trap/tokens",F.Public_MdnTrapRelaySkypeFqdns_EUDB="worldaz.tr.skype.com",F.Public_MdnTrapRelayTurnFqdns_EUDB="turn.azure.com",F.Public_MdnTrapRelayTurnUrl_EUDB="https://turn.azure.com/relay"}(We||(We={}));const qe=Object.assign(Object.assign(Object.assign({},Ge),Ve),We),ze={baseServiceUrl:"https://global.mtgw.prod.communication.microsoft.com/acsmt/v1/",policyUrlSuffix:"useraggregatepolicysettings/"};var Ke;!function(F){F.Consumer="consumer",F.Enterprise="enterprise"}(Ke||(Ke={}));const Je=["europe","france","germany","norway","switzerland","sweden"],Qe={AUDIO:{JITTER:{GOOD:30,AVERAGE:75},RTT:{GOOD:200,AVERAGE:350},PACKETS_LOSS_PERCENTAGE:{GOOD:3,AVERAGE:6}},VIDEO:{JITTER:{GOOD:20,AVERAGE:75},RTT:{GOOD:200,AVERAGE:350},PACKETS_LOSS_PERCENTAGE:{GOOD:3,AVERAGE:6}},BANDWIDTH:{GOOD:1500,AVERAGE:500},CALL:{DURATION_IN_SEC:30,GROUP_ID:generateGuid(),AGGREGATION:{INTERVAL:1e3,DATAPOINTS:1},VIDEO_SIZE:{heigth:720,width:1280},MEDIASTREAM_TIMEOUT_IN_SEC:15,CONNECT_TIMEOUT_IN_SEC:10}};var Ye;!function(F){F.AcsOrganizerRole="acsorganizer",F.AcsPresenterRole="acspresenter",F.AcsAttendeeRole="acsattendee",F.AcsConsumerRole="acsconsumer",F.TeamsOrganizer="organizer",F.TeamsAttendee="attendee",F.TeamsPresenter="presenter"}(Ye||(Ye={}));let $e="3617";const getPlatformId=()=>$e,Xe=2e3,Ze=5e4,et=3e4,tt=25e3,nt=6e3,it=5e3,rt=1e3,ot=3,at=!1,st=500,ct=6e3,lt=2500,dt=1500,ut=5e3,pt=12,ht=2e4,gt=6e4,ft="4cf9ed87f7dc4e148f77855cd1f2fdca-61fb83a7-6672-4264-806f-7aded29f9b49-7618",mt="53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413",vt="1cae5691997646c98b01d15beddae7a3-ce16e198-bc32-420f-ac64-42bb916111af-6865",yt="708a9eb9fe2646fe8f4c37b7eee2e3da-9b97485a-57b9-43a8-8177-07ca7a653a30-6706",St=7e3,_t=10,Ct="28:8133db4c-c049-4346-9edd-273f164a9227",Tt="28:b1902c3e-b9f7-4650-9b23-5772bd429747",Et="ACS-Public",bt=["en-us"],It=10,At="28:e32c9418-a835-4eb1-bfb9-733fa74dd6e8",Rt=256,Pt="0.0",Ot="8:",Mt="28:",wt="4:",Dt=":",Nt=Ot+("orgid"+Dt),Lt=Ot+("dod"+Dt),kt=Ot+("gcch"+Dt),Ft=Ot+("teamsvisitor"+Dt),xt=Ot+("acs"+Dt),Ut=Ot+("spool"+Dt),jt=Ot+("dod-acs"+Dt),Bt=Ot+("gcch-acs"+Dt),Ht={codecName:{raw_data_reduction:!0},bitrate:{aggregation_needed:!0},jitter:{aggregation_needed:!0,multiplier:1e3,integer:!0,name:"jitterInMs"},packetsPerSecond:{aggregation_needed:!0},packetsLostPerSecond:{aggregation_needed:!0},rtt:{aggregation_needed:!0,multiplier:1e3,integer:!0,name:"rttInMs"},pairRtt:{aggregation_needed:!0,multiplier:1e3,integer:!0,name:"pairRttInMs"},availableBitrate:{aggregation_needed:!0},jitterBufferMs:{aggregation_needed:!0,integer:!0,name:"jitterBufferInMs"},audioInputLevel:{aggregation_needed:!0,multiplier:65536,integer:!0},audioOutputLevel:{aggregation_needed:!0,multiplier:65536,integer:!0},healedRatio:{aggregation_needed:!0},lossRate:{aggregation_needed:!0},frameRateInput:{aggregation_needed:!0},frameWidthInput:{aggregation_needed:!0},frameHeightInput:{aggregation_needed:!0},frameRateEncoded:{aggregation_needed:!0},frameRateSent:{aggregation_needed:!0},frameWidthSent:{aggregation_needed:!0},frameHeightSent:{aggregation_needed:!0},framesSent:{},framesEncoded:{},keyFramesEncoded:{},msi:{raw_data_reduction:!0,name:"streamId"},frameRateOutput:{aggregation_needed:!0},frameRateDecoded:{aggregation_needed:!0},frameRateReceived:{aggregation_needed:!0},frameWidthReceived:{aggregation_needed:!0},frameHeightReceived:{aggregation_needed:!0},longestFreezeDuration:{multiplier:1e3,integer:!0,name:"longestFreezeDurationInMs"},totalFreezeDuration:{multiplier:1e3,integer:!0,name:"totalFreezeDurationInMs"},framesReceived:{},framesDropped:{},framesDecoded:{},keyFramesDecoded:{}};var Vt,Gt;function getMriFromIdentifier(F){const B=G.getIdentifierKind(F);switch(B.kind){case"communicationUser":return B.communicationUserId;case"phoneNumber":if(B.rawId)return`${B.rawId}`;if(B.phoneNumber)return`${wt}${B.phoneNumber}`;throw new CallingCommunicationError({message:"Unable to parse PhoneNumberIdentifier object",code:de});case"microsoftTeamsUser":if(B.rawId)return B.rawId;if(B.microsoftTeamsUserId){if(B.isAnonymous)return`${Ft}${B.microsoftTeamsUserId}`;if("public"===B.cloud)return`${Nt}${B.microsoftTeamsUserId}`;if("dod"===B.cloud)return`${Lt}${B.microsoftTeamsUserId}`;if("gcch"===B.cloud)return`${kt}${B.microsoftTeamsUserId}`;if(!B.cloud)return`${Nt}${B.microsoftTeamsUserId}`}throw new CallingCommunicationError({message:"Unable to parse MicrosoftTeamsUserIdentifier object",code:de});case"unknown":return B.id;default:throw new CallingCommunicationError({message:"Unable to parse Identifier object, please check the syntax",code:de})}}function constructIdentifierKindFromMri(F){return F.startsWith(Nt)?{kind:"microsoftTeamsUser",rawId:F,microsoftTeamsUserId:F.substring(8),isAnonymous:!1,cloud:"public"}:F.startsWith(Lt)?{kind:"microsoftTeamsUser",rawId:F,microsoftTeamsUserId:F.substring(6),isAnonymous:!1,cloud:"dod"}:F.startsWith(kt)?{kind:"microsoftTeamsUser",rawId:F,microsoftTeamsUserId:F.substring(7),isAnonymous:!1,cloud:"gcch"}:F.startsWith(Ft)?{kind:"microsoftTeamsUser",rawId:F,microsoftTeamsUserId:F.substring(15),isAnonymous:!0}:F.startsWith(wt)?{kind:"phoneNumber",rawId:F,phoneNumber:F.substring(2)}:F.startsWith(xt)||F.startsWith(Ut)||F.startsWith(Bt)||F.startsWith(jt)?{kind:"communicationUser",communicationUserId:F}:{kind:"unknown",id:F}}function isCallingApplication(F){return!!F.startsWith(Mt)}function validateIdentifier(F){const B=G.getIdentifierKind(F);switch(B.kind){case"communicationUser":if(!(B.communicationUserId.startsWith(xt)||B.communicationUserId.startsWith(Ut)||B.communicationUserId.startsWith(Bt)||B.communicationUserId.startsWith(jt)))throw new CallingCommunicationError({message:"Invalid CommunicationUser identifier specified",code:de});return;case"phoneNumber":return;case"microsoftTeamsUser":if(B.rawId&&!B.rawId.startsWith(Nt)&&!B.rawId.startsWith(Lt)&&!B.rawId.startsWith(kt)&&!B.rawId.startsWith(Ft))throw new CallingCommunicationError({message:"Invalid MicrosoftTeamsUser rawId specified",code:de});if(!B.microsoftTeamsUserId)throw new CallingCommunicationError({message:"Invalid MicrosoftTeamsUser microsoftTeamsUserId specified",code:de});return;case"unknown":if(!B.id)throw new CallingCommunicationError({message:"Invalid identifier specified, please specify an id",code:de});return;default:throw new CallingCommunicationError({message:"Unable to parse Identifier object",code:de})}}function assertIsArrayOfIdentifiers(F,B){if(!(F instanceof Array))throw new CallingCommunicationError({message:"AssertIsArrayOfIdentifiers failed. "+(void 0!==B?`: ${B}`:""),code:de})}function getCloudTypeFromSkypeId(F){const B=F.substring(0,F.indexOf(":"));if(!B)throw new CallingCommunicationError({message:"No cloud prefix found in identity",code:ce});switch(B){case He.OrgId:case He.Acs:case He.Spool:return Be.Public;case He.GccHigh:case He.GccHighAcs:return Be.GccHigh;case He.Dod:case He.DodAcs:return Be.Dod;case He.AirGap08:case He.AirGap08Acs:return Be.AirGap08;case He.AirGap09:case He.AirGap09Acs:return Be.AirGap09;default:return Be.Public}}!function(F){F.GroupCall="joinGroupId",F.GroupChatCall="joinThreadId",F.TeamsCoordinates="joinMeetingCoordinates",F.TeamsMeetingId="joinMeetingId",F.TeamsMeetingLink="joinMeetingLink",F.RoomCall="joinRoom"}(Vt||(Vt={})),function(F){F.Organizer="Organizer",F.Attendee="Attendee",F.Presenter="Presenter",F.Consumer="Consumer",F.Unknown="Unknown"}(Gt||(Gt={}));var Wt,qt="object"==typeof Reflect?Reflect:null,zt=qt&&"function"==typeof qt.apply?qt.apply:function ReflectApply(F,B,G){return Function.prototype.apply.call(F,B,G)};function ProcessEmitWarning(F){console&&console.warn&&console.warn(F)}Wt=qt&&"function"==typeof qt.ownKeys?qt.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(F){return Object.getOwnPropertyNames(F).concat(Object.getOwnPropertySymbols(F))}:function ReflectOwnKeys(F){return Object.getOwnPropertyNames(F)};var Kt=Number.isNaN||function NumberIsNaN(F){return F!=F};function EventEmitter(){EventEmitter.init.call(this)}var Jt=EventEmitter,Qt=once;EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var Yt,$t,Xt,Zt=10;function checkListener(F){if("function"!=typeof F)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof F)}function _getMaxListeners(F){return void 0===F._maxListeners?EventEmitter.defaultMaxListeners:F._maxListeners}function _addListener(F,B,G,W){var z,K,J;if(checkListener(G),void 0===(K=F._events)?(K=F._events=Object.create(null),F._eventsCount=0):(void 0!==K.newListener&&(F.emit("newListener",B,G.listener?G.listener:G),K=F._events),J=K[B]),void 0===J)J=K[B]=G,++F._eventsCount;else if("function"==typeof J?J=K[B]=W?[G,J]:[J,G]:W?J.unshift(G):J.push(G),(z=_getMaxListeners(F))>0&&J.length>z&&!J.warned){J.warned=!0;var Q=new Error("Possible EventEmitter memory leak detected. "+J.length+" "+String(B)+" listeners added. Use emitter.setMaxListeners() to increase limit");Q.name="MaxListenersExceededWarning",Q.emitter=F,Q.type=B,Q.count=J.length,ProcessEmitWarning(Q)}return F}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(F,B,G){var W={fired:!1,wrapFn:void 0,target:F,type:B,listener:G},z=onceWrapper.bind(W);return z.listener=G,W.wrapFn=z,z}function _listeners(F,B,G){var W=F._events;if(void 0===W)return[];var z=W[B];return void 0===z?[]:"function"==typeof z?G?[z.listener||z]:[z]:G?unwrapListeners(z):arrayClone(z,z.length)}function listenerCount(F){var B=this._events;if(void 0!==B){var G=B[F];if("function"==typeof G)return 1;if(void 0!==G)return G.length}return 0}function arrayClone(F,B){for(var G=new Array(B),W=0;W<B;++W)G[W]=F[W];return G}function spliceOne(F,B){for(;B+1<F.length;B++)F[B]=F[B+1];F.pop()}function unwrapListeners(F){for(var B=new Array(F.length),G=0;G<B.length;++G)B[G]=F[G].listener||F[G];return B}function once(F,B){return new Promise((function(G,W){function eventListener(){void 0!==z&&F.removeListener("error",z),G([].slice.call(arguments))}var z;"error"!==B&&(z=function errorListener(G){F.removeListener(B,eventListener),W(G)},F.once("error",z)),F.once(B,eventListener)}))}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return Zt},set:function(F){if("number"!=typeof F||F<0||Kt(F))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+F+".");Zt=F}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(F){if("number"!=typeof F||F<0||Kt(F))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+F+".");return this._maxListeners=F,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(F){for(var B=[],G=1;G<arguments.length;G++)B.push(arguments[G]);var W="error"===F,z=this._events;if(void 0!==z)W=W&&void 0===z.error;else if(!W)return!1;if(W){var K;if(B.length>0&&(K=B[0]),K instanceof Error)throw K;var J=new Error("Unhandled error."+(K?" ("+K.message+")":""));throw J.context=K,J}var Q=z[F];if(void 0===Q)return!1;if("function"==typeof Q)zt(Q,this,B);else{var Y=Q.length,$=arrayClone(Q,Y);for(G=0;G<Y;++G)zt($[G],this,B)}return!0},EventEmitter.prototype.addListener=function addListener(F,B){return _addListener(this,F,B,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(F,B){return _addListener(this,F,B,!0)},EventEmitter.prototype.once=function once(F,B){return checkListener(B),this.on(F,_onceWrap(this,F,B)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(F,B){return checkListener(B),this.prependListener(F,_onceWrap(this,F,B)),this},EventEmitter.prototype.removeListener=function removeListener(F,B){var G,W,z,K,J;if(checkListener(B),void 0===(W=this._events))return this;if(void 0===(G=W[F]))return this;if(G===B||G.listener===B)0==--this._eventsCount?this._events=Object.create(null):(delete W[F],W.removeListener&&this.emit("removeListener",F,G.listener||B));else if("function"!=typeof G){for(z=-1,K=G.length-1;K>=0;K--)if(G[K]===B||G[K].listener===B){J=G[K].listener,z=K;break}if(z<0)return this;0===z?G.shift():spliceOne(G,z),1===G.length&&(W[F]=G[0]),void 0!==W.removeListener&&this.emit("removeListener",F,J||B)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(F){var B,G,W;if(void 0===(G=this._events))return this;if(void 0===G.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==G[F]&&(0==--this._eventsCount?this._events=Object.create(null):delete G[F]),this;if(0===arguments.length){var z,K=Object.keys(G);for(W=0;W<K.length;++W)"removeListener"!==(z=K[W])&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(B=G[F]))this.removeListener(F,B);else if(void 0!==B)for(W=B.length-1;W>=0;W--)this.removeListener(F,B[W]);return this},EventEmitter.prototype.listeners=function listeners(F){return _listeners(this,F,!0)},EventEmitter.prototype.rawListeners=function rawListeners(F){return _listeners(this,F,!1)},EventEmitter.listenerCount=function(F,B){return"function"==typeof F.listenerCount?F.listenerCount(B):listenerCount.call(F,B)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Wt(this._events):[]},Jt.once=Qt;class BaseCallAgentFeature{constructor(F){this.disposed=!1,this.callAgent=F.callAgent,this.callClient=F.callClient,this.eventEmitter=new Jt.EventEmitter}dispose(){this.disposed||(this.eventEmitter.removeAllListeners(),this.disposed=!0)}}class BaseCallClientFeature{constructor(F){this.disposed=!1,this.callClient=F.callClient,this.eventEmitter=new Jt.EventEmitter}dispose(){this.disposed||(this.eventEmitter.removeAllListeners(),this.disposed=!0)}}class BaseCallFeature{constructor(F){this.disposed=!1,this.call=F.call,this.callAgent=F.callAgent,this.eventEmitter=new Jt.EventEmitter}dispose(){this.disposed||(this.eventEmitter.removeAllListeners(),this.disposed=!0)}}!function(F){F[F.CallClientFeature=0]="CallClientFeature",F[F.CallAgentFeature=1]="CallAgentFeature",F[F.CallFeature=2]="CallFeature"}(Yt||(Yt={}));class FirstPartyCallFeature extends BaseCallFeature{}class FirstPartyCallAgentFeature extends BaseCallAgentFeature{}class FirstPartyCallClientFeature extends BaseCallClientFeature{}!function(F){F.Transfer="Transfer",F.StartCaptions="StartCaptions",F.StopCaptions="StopCaptions",F.SelectLanguage="SelectLanguage",F.getMediaStatsCollector="getMediaStatsCollector",F.disposeAllCollectors="disposeAllCollectors"}($t||($t={}));class ExtensibleFeatureImpl{constructor(F,B,G){this._logger=F,this._featureCtorContext=B,this._featureInitContext=G,this._apiObjInstances=new Map}getApiObjectInstance(F){if(!this._apiObjInstances.has(F)){const B=new F(this._featureCtorContext);return(B instanceof FirstPartyCallFeature||B instanceof FirstPartyCallAgentFeature||B instanceof FirstPartyCallClientFeature)&&B.initialize(this._featureInitContext,this._logger),this._apiObjInstances.set(F,B),B}return this._apiObjInstances.get(F)}dispose(){for(const[,F]of this._apiObjInstances)F.dispose()}}(Xt=F.ResultType||(F.ResultType={}))[Xt.Intermediate=0]="Intermediate",Xt[Xt.Final=1]="Final";var en="function",tn="object",nn="undefined",rn="prototype",on="hasOwnProperty",an=Object,sn=an[rn],cn=an.assign,ln=an.create,dn=null;function getGlobal(F){return void 0===F&&(F=!0),dn&&F||(typeof globalThis!==nn&&globalThis&&(dn=globalThis),typeof self!==nn&&self&&(dn=self),typeof window!==nn&&window&&(dn=window),typeof global!==nn&&global&&(dn=global)),dn}function throwTypeError(F){throw new TypeError(F)}function objCreateFn(F){if(ln)return ln(F);if(null==F)return{};var B=typeof F;function tmpFunc(){}return B!==tn&&B!==en&&throwTypeError("Object prototype may only be an Object:"+F),tmpFunc[rn]=F,new tmpFunc}(getGlobal()||{}).Symbol,(getGlobal()||{}).Reflect;var __objAssignFnImpl=function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])sn[on].call(B,z)&&(F[z]=B[z]);return F},un=cn||__objAssignFnImpl,extendStaticsFn=function(F,B){return extendStaticsFn=an.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B[on](G)&&(F[G]=B[G])},extendStaticsFn(F,B)};function __extendsFn(F,B){function __(){this.constructor=F}typeof B!==en&&null!==B&&throwTypeError("Class extends value "+String(B)+" is not a constructor or null"),extendStaticsFn(F,B),F[rn]=null===B?objCreateFn(B):(__[rn]=B[rn],new __)}var pn={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},hn="function",gn="object",fn="undefined",mn="prototype",vn="hasOwnProperty",yn=Object,Sn=yn[mn],_n=yn.assign,Cn=yn.create,Tn=yn.defineProperty,En=Sn[vn];function getGlobal$1(){return typeof globalThis!==fn&&globalThis?globalThis:typeof self!==fn&&self?self:typeof window!==fn&&window?window:typeof global!==fn&&global?global:null}function throwTypeError$1(F){throw new TypeError(F)}function objCreateFn$1(F){if(Cn)return Cn(F);if(null==F)return{};var B=typeof F;function tmpFunc(){}return B!==gn&&B!==hn&&throwTypeError$1("Object prototype may only be an Object:"+F),tmpFunc[mn]=F,new tmpFunc}(getGlobal$1()||{}).Symbol,(getGlobal$1()||{}).Reflect;var extendStaticsFn$1=function(F,B){return extendStaticsFn$1=yn.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B[vn](G)&&(F[G]=B[G])},extendStaticsFn$1(F,B)};function __extendsFn$1(F,B){function __(){this.constructor=F}typeof B!==hn&&null!==B&&throwTypeError$1("Class extends value "+String(B)+" is not a constructor or null"),extendStaticsFn$1(F,B),F[mn]=null===B?objCreateFn$1(B):(__[mn]=B[mn],new __)}
/*!
	 * Microsoft Dynamic Proto Utility, 1.1.6
	 * Copyright (c) Microsoft and contributors. All rights reserved.
	 */var bn="constructor",In="prototype",An="function",Rn="_dynInstFuncs",Pn="_isDynProxy",On="_dynClass",Mn="_dynCls$",wn="_dynInstChk",Dn=wn,Nn="_dfOpts",Ln="_unknown_",kn="__proto__",Fn="_dyn"+kn,xn="_dynInstProto",Un="useBaseInst",jn="setInstFuncs",Bn=Object,Hn=Bn.getPrototypeOf,Vn=Bn.getOwnPropertyNames,Gn=0;function _hasOwnProperty(F,B){return F&&Bn[In].hasOwnProperty.call(F,B)}function _isObjectOrArrayPrototype(F){return F&&(F===Bn[In]||F===Array[In])}function _isObjectArrayOrFunctionPrototype(F){return _isObjectOrArrayPrototype(F)||F===Function[In]}function _getObjProto(F){var B;if(F){if(Hn)return Hn(F);var G=F[kn]||F[In]||(F[bn]?F[bn][In]:null);B=F[Fn]||G,_hasOwnProperty(F,Fn)||(delete F[xn],B=F[Fn]=F[xn]||F[Fn],F[xn]=G)}return B}function _forEachProp(F,B){var G=[];if(Vn)G=Vn(F);else for(var W in F)"string"==typeof W&&_hasOwnProperty(F,W)&&G.push(W);if(G&&G.length>0)for(var z=0;z<G.length;z++)B(G[z])}function _isDynamicCandidate(F,B,G){return B!==bn&&typeof F[B]===An&&(G||_hasOwnProperty(F,B))}function _throwTypeError(F){throw new TypeError("DynamicProto: "+F)}function _getInstanceFuncs(F){var B={};return _forEachProp(F,(function(G){!B[G]&&_isDynamicCandidate(F,G,!1)&&(B[G]=F[G])})),B}function _hasVisited(F,B){for(var G=F.length-1;G>=0;G--)if(F[G]===B)return!0;return!1}function _getBaseFuncs(F,B,G,W){function _instFuncProxy(F,B,G){var z=B[G];if(z[Pn]&&W){var K=F[Rn]||{};!1!==K[Dn]&&(z=(K[B[On]]||{})[G]||z)}return function(){return z.apply(F,arguments)}}var z={};_forEachProp(G,(function(F){z[F]=_instFuncProxy(B,G,F)}));for(var K=_getObjProto(F),J=[];K&&!_isObjectArrayOrFunctionPrototype(K)&&!_hasVisited(J,K);)_forEachProp(K,(function(F){!z[F]&&_isDynamicCandidate(K,F,!Hn)&&(z[F]=_instFuncProxy(B,K,F))})),J.push(K),K=_getObjProto(K);return z}function _getInstFunc(F,B,G,W){var z=null;if(F&&_hasOwnProperty(G,On)){var K=F[Rn]||{};if((z=(K[G[On]]||{})[B])||_throwTypeError("Missing ["+B+"] "+An),!z[wn]&&!1!==K[Dn]){for(var J=!_hasOwnProperty(F,B),Q=_getObjProto(F),Y=[];J&&Q&&!_isObjectArrayOrFunctionPrototype(Q)&&!_hasVisited(Y,Q);){var $=Q[B];if($){J=$===W;break}Y.push(Q),Q=_getObjProto(Q)}try{J&&(F[B]=z),z[wn]=1}catch(F){K[Dn]=!1}}}return z}function _getProtoFunc(F,B,G){var W=B[F];return W===G&&(W=_getObjProto(B)[F]),typeof W!==An&&_throwTypeError("["+F+"] is not a "+An),W}function _populatePrototype(F,B,G,W,z){function _createDynamicPrototype(F,B){var dynProtoProxy=function(){return(_getInstFunc(this,B,F,dynProtoProxy)||_getProtoFunc(B,F,dynProtoProxy)).apply(this,arguments)};return dynProtoProxy[Pn]=1,dynProtoProxy}if(!_isObjectOrArrayPrototype(F)){var K=G[Rn]=G[Rn]||{},J=K[B]=K[B]||{};!1!==K[Dn]&&(K[Dn]=!!z),_forEachProp(G,(function(B){_isDynamicCandidate(G,B,!1)&&G[B]!==W[B]&&(J[B]=G[B],delete G[B],(!_hasOwnProperty(F,B)||F[B]&&!F[B][Pn])&&(F[B]=_createDynamicPrototype(F,B)))}))}}function _checkPrototype(F,B){if(Hn){for(var G=[],W=_getObjProto(B);W&&!_isObjectArrayOrFunctionPrototype(W)&&!_hasVisited(G,W);){if(W===F)return!0;G.push(W),W=_getObjProto(W)}return!1}return!0}function _getObjName(F,B){return _hasOwnProperty(F,In)?F.name||B||Ln:((F||{})[bn]||{}).name||B||Ln}function dynamicProto(F,B,G,W){_hasOwnProperty(F,In)||_throwTypeError("theClass is an invalid class definition.");var z=F[In];_checkPrototype(z,B)||_throwTypeError("["+_getObjName(F)+"] is not in class hierarchy of ["+_getObjName(B)+"]");var K=null;_hasOwnProperty(z,On)?K=z[On]:(K=Mn+_getObjName(F,"_")+"$"+Gn,Gn++,z[On]=K);var J=dynamicProto[Nn],Q=!!J[Un];Q&&W&&void 0!==W[Un]&&(Q=!!W[Un]);var Y=_getInstanceFuncs(B);G(B,_getBaseFuncs(z,B,Y,Q));var $=!!Hn&&!!J[jn];$&&W&&($=!!W[jn]),_populatePrototype(z,K,B,Y,!1!==$)}var Wn,qn={setInstFuncs:!0,useBaseInst:!0};dynamicProto[Nn]=qn,function(F){F[F.CRITICAL=1]="CRITICAL",F[F.WARNING=2]="WARNING"}(Wn||(Wn={}));var zn={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103},Kn="on",Jn="attachEvent",Qn="addEventListener",Yn="detachEvent",$n="removeEventListener",Xn=Tn;function objToString(F){return Sn.toString.call(F)}function isUndefined(F){return void 0===F||typeof F===fn}function isNullOrUndefined(F){return null===F||isUndefined(F)}function isNotNullOrUndefined(F){return!isNullOrUndefined(F)}function hasOwnProperty(F,B){return F&&En.call(F,B)}function isObject(F){return typeof F===gn}function isFunction(F){return typeof F===hn}function attachEvent(F,B,G,W){void 0===W&&(W=!1);var z=!1;if(!isNullOrUndefined(F))try{isNullOrUndefined(F[Qn])?isNullOrUndefined(F[Jn])||(F[Jn](Kn+B,G),z=!0):(F[Qn](B,G,W),z=!0)}catch(F){}return z}function detachEvent(F,B,G,W){if(void 0===W&&(W=!1),!isNullOrUndefined(F))try{isNullOrUndefined(F[$n])?isNullOrUndefined(F[Yn])||F[Yn](Kn+B,G):F[$n](B,G,W)}catch(F){}}function objForEachKey(F,B){if(F)for(var G in F)En.call(F,G)&&B.call(F,G,F[G])}function strEndsWith(F,B){if(F&&B){var G=B.length,W=F.length;if(F===B)return!0;if(W>=G){for(var z=W-1,K=G-1;K>=0;K--){if(F[z]!=B[K])return!1;z--}return!0}}return!1}function strStartsWith(F,B){var G=!1;if(F&&B){var W=B.length;if(F===B)return!0;if(F.length>=W){for(var z=0;z<W;z++)if(F[z]!==B[z])return!1;G=!0}}return G}function strContains(F,B){return!(!F||!B)&&-1!==F.indexOf(B)}function isDate(F){return"[object Date]"===objToString(F)}function isArray(F){return"[object Array]"===objToString(F)}function isError(F){return"[object Error]"===objToString(F)}function isString(F){return"string"==typeof F}function isNumber(F){return"number"==typeof F}function isBoolean(F){return"boolean"==typeof F}function toISOString(F){if(isDate(F)){var pad=function(F){var B=String(F);return 1===B.length&&(B="0"+B),B};return F.getUTCFullYear()+"-"+pad(F.getUTCMonth()+1)+"-"+pad(F.getUTCDate())+"T"+pad(F.getUTCHours())+":"+pad(F.getUTCMinutes())+":"+pad(F.getUTCSeconds())+"."+String((F.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}function arrForEach(F,B,G){for(var W=F.length,z=0;z<W&&(!(z in F)||-1!==B.call(G||F,F[z],z,F));z++);}function arrIndexOf(F,B,G){for(var W=F.length,z=G||0,K=Math.max(z>=0?z:W-Math.abs(z),0);K<W;K++)if(K in F&&F[K]===B)return K;return-1}function strTrim(F){return"string"!=typeof F?F:F.replace(/^\s+|\s+$/g,"")}var Zn=!{toString:null}.propertyIsEnumerable("toString"),ei=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];function objKeys(F){var B=typeof F;B===hn||B===gn&&null!==F||throwTypeError$1("objKeys called on non-object");var G=[];for(var W in F)F&&En.call(F,W)&&G.push(W);if(Zn)for(var z=ei.length,K=0;K<z;K++)F&&En.call(F,ei[K])&&G.push(ei[K]);return G}function objDefineAccessors(F,B,G,W){if(Xn)try{var z={enumerable:!0,configurable:!0};return G&&(z.get=G),W&&(z.set=W),Xn(F,B,z),!0}catch(F){}return!1}function dateNow(){var F=Date;return F.now?F.now():(new F).getTime()}function getExceptionName(F){return isError(F)?F.name:""}function setValue(F,B,G,W,z){var K=G;return F&&((K=F[B])===G||z&&!z(K)||W&&!W(G)||(K=G,F[B]=K)),K}function getSetValue(F,B,G){var W;return F?!(W=F[B])&&isNullOrUndefined(W)&&(W=isUndefined(G)?{}:G,F[B]=W):W=isUndefined(G)?{}:G,W}function isNotTruthy(F){return!F}function isTruthy(F){return!!F}function throwError(F){throw new Error(F)}function optimizeObject(F){return F&&(F=yn(_n?_n({},F):F)),F}var ti="window",ni="document",ii="navigator",ri="location",oi="console",ai="performance",si="JSON",ci="crypto",li="msCrypto",di="ReactNative",ui="msie",pi="trident/",hi=null,gi=null,fi=!1;function getGlobalInst(F){var B=getGlobal$1();return B&&B[F]?B[F]:F===ti&&hasWindow()?window:null}function hasWindow(){return Boolean(typeof window===gn&&window)}function getWindow(){return hasWindow()?window:getGlobalInst(ti)}function hasDocument(){return Boolean(typeof document===gn&&document)}function getDocument(){return hasDocument()?document:getGlobalInst(ni)}function hasNavigator(){return Boolean(typeof navigator===gn&&navigator)}function getNavigator(){return hasNavigator()?navigator:getGlobalInst(ii)}function getLocation(F){if(F&&fi){var B=getGlobalInst("__mockLocation");if(B)return B}return typeof location===gn&&location?location:getGlobalInst(ri)}function getConsole(){return typeof console!==fn?console:getGlobalInst(oi)}function getPerformance(){return getGlobalInst(ai)}function hasJSON(){return Boolean(typeof JSON===gn&&JSON||null!==getGlobalInst(si))}function getJSON(){return hasJSON()?JSON||getGlobalInst(si):null}function getCrypto(){return getGlobalInst(ci)}function getMsCrypto(){return getGlobalInst(li)}function isReactNative(){var F=getNavigator();return!(!F||!F.product)&&F.product===di}function isIE(){var F=getNavigator();if(F&&(F.userAgent!==gi||null===hi)){var B=((gi=F.userAgent)||"").toLowerCase();hi=strContains(B,ui)||strContains(B,pi)}return hi}function dumpObj(F){var B=Object[mn].toString.call(F),G="";return"[object Error]"===B?G="{ stack: '"+F.stack+"', message: '"+F.message+"', name: '"+F.name+"'":hasJSON()&&(G=getJSON().stringify(F)),B+G}var mi="AI (Internal): ",vi="AI: ",yi="AITR_";function _sanitizeDiagnosticText(F){return F?'"'+F.replace(/\"/g,"")+'"':""}var Si=function(){function _InternalLogMessage(F,B,G,W){void 0===G&&(G=!1);var z=this;z.messageId=F,z.message=(G?vi:mi)+F;var K="";hasJSON()&&(K=getJSON().stringify(W));var J=(B?" message:"+_sanitizeDiagnosticText(B):"")+(W?" props:"+_sanitizeDiagnosticText(K):"");z.message+=J}return _InternalLogMessage.dataType="MessageData",_InternalLogMessage}();function safeGetLogger(F,B){return(F||{}).logger||new _i(B)}var _i=function(){function DiagnosticLogger(F){this.identifier="DiagnosticLogger",this.queue=[];var B=0,G={};dynamicProto(DiagnosticLogger,this,(function(W){function _getConfigValue(B,G){var W=F[B];return isNullOrUndefined(W)?G:W}function _areInternalMessagesThrottled(){return B>=W.maxInternalMessageLimit()}isNullOrUndefined(F)&&(F={}),W.consoleLoggingLevel=function(){return _getConfigValue("loggingLevelConsole",0)},W.telemetryLoggingLevel=function(){return _getConfigValue("loggingLevelTelemetry",1)},W.maxInternalMessageLimit=function(){return _getConfigValue("maxMessageLimit",25)},W.enableDebugExceptions=function(){return _getConfigValue("enableDebugExceptions",!1)},W.throwInternal=function(F,B,z,K,J){void 0===J&&(J=!1);var Q=new Si(B,z,J,K);if(W.enableDebugExceptions())throw Q;if(!isUndefined(Q)&&Q&&!isUndefined(Q.message)){var Y=W.consoleLoggingLevel();if(J){var $=+Q.messageId;!G[$]&&Y>=Wn.WARNING&&(W.warnToConsole(Q.message),G[$]=!0)}else Y>=Wn.WARNING&&W.warnToConsole(Q.message);W.logInternalMessage(F,Q)}},W.warnToConsole=function(F){var B=getConsole();if(B){var G="log";B.warn&&(G="warn"),isFunction(B[G])&&B[G](F)}},W.resetInternalMessageCount=function(){B=0,G={}},W.logInternalMessage=function(F,z){if(!_areInternalMessagesThrottled()){var K=!0,J=yi+z.messageId;if(G[J]?K=!1:G[J]=!0,K&&(F<=W.telemetryLoggingLevel()&&(W.queue.push(z),B++),B===W.maxInternalMessageLimit())){var Q="Internal events throttle limit per PageView reached for this app.",Y=new Si(zn.MessageLimitPerPVExceeded,Q,!1);W.queue.push(Y),W.warnToConsole(Q)}}}}))}return DiagnosticLogger}(),Ci="ctx",Ti=function(){function PerfEvent(F,B,G){var W,z=this,K=!1;(z.start=dateNow(),z.name=F,z.isAsync=G,z.isChildEvt=function(){return!1},isFunction(B))&&(K=objDefineAccessors(z,"payload",(function(){return!W&&isFunction(B)&&(W=B(),B=null),W})));z.getCtx=function(F){return F?F===PerfEvent.ParentContextKey||F===PerfEvent.ChildrenContextKey?z[F]:(z[Ci]||{})[F]:null},z.setCtx=function(F,B){if(F)if(F===PerfEvent.ParentContextKey)z[F]||(z.isChildEvt=function(){return!0}),z[F]=B;else if(F===PerfEvent.ChildrenContextKey)z[F]=B;else{(z[Ci]=z[Ci]||{})[F]=B}},z.complete=function(){var F=0,G=z.getCtx(PerfEvent.ChildrenContextKey);if(isArray(G))for(var W=0;W<G.length;W++){var J=G[W];J&&(F+=J.time)}z.time=dateNow()-z.start,z.exTime=z.time-F,z.complete=function(){},!K&&isFunction(B)&&(z.payload=B())}}return PerfEvent.ParentContextKey="parent",PerfEvent.ChildrenContextKey="childEvts",PerfEvent}(),Ei=function(){function PerfManager(F){this.ctx={},dynamicProto(PerfManager,this,(function(B){B.create=function(F,B,G){return new Ti(F,B,G)},B.fire=function(B){B&&(B.complete(),F&&F.perfEvent(B))},B.setCtx=function(F,G){F&&((B[Ci]=B[Ci]||{})[F]=G)},B.getCtx=function(F){return(B[Ci]||{})[F]}}))}return PerfManager}(),bi="CoreUtils.doPerf";function doPerf(F,B,G,W,z){if(F){var K=F;if(K&&isFunction(K.getPerfMgr)&&(K=K.getPerfMgr()),K){var J=void 0,Q=K.getCtx(bi);try{if(J=K.create(B(),W,z)){if(Q&&J.setCtx&&(J.setCtx(Ti.ParentContextKey,Q),Q.getCtx&&Q.setCtx)){var Y=Q.getCtx(Ti.ChildrenContextKey);Y||(Y=[],Q.setCtx(Ti.ChildrenContextKey,Y)),Y.push(J)}return K.setCtx(bi,J),G(J)}}catch(F){J&&J.setCtx&&J.setCtx("exception",F)}finally{J&&K.fire(J),K.setCtx(bi,Q)}}}return G()}var Ii=function(){function TelemetryPluginChain(F,B){var G=this,W=null,z=isFunction(F.processTelemetry),K=isFunction(F.setNextPlugin);G._hasRun=!1,G.getPlugin=function(){return F},G.getNext=function(){return W},G.setNext=function(F){W=F},G.processTelemetry=function(J,Q){Q||(Q=B);var Y=F?F.identifier:"TelemetryPluginChain";doPerf(Q?Q.core():null,(function(){return Y+":processTelemetry"}),(function(){if(F&&z){G._hasRun=!0;try{Q.setNext(W),K&&F.setNextPlugin(W),W&&(W._hasRun=!1),F.processTelemetry(J,Q)}catch(G){var B=W&&W._hasRun;W&&B||Q.diagLog().throwInternal(Wn.CRITICAL,zn.PluginException,"Plugin ["+F.identifier+"] failed during processTelemetry - "+G),W&&!B&&W.processTelemetry(J,Q)}}else W&&(G._hasRun=!0,W.processTelemetry(J,Q))}),(function(){return{item:J}}),!J.sync)}}return TelemetryPluginChain}();function _createProxyChain(F,B){var G=[];if(F&&F.length>0)for(var W=null,z=0;z<F.length;z++){var K=F[z];if(K&&isFunction(K.processTelemetry)){var J=new Ii(K,B);G.push(J),W&&W.setNext(J),W=J}}return G.length>0?G[0]:null}function _copyProxyChain(F,B,G){var W=[],z=!G;if(F)for(;F;){var K=F.getPlugin();(z||K===G)&&(z=!0,W.push(K)),F=F.getNext()}return z||W.push(G),_createProxyChain(W,B)}function _copyPluginChain(F,B,G){var W=F,z=!1;return G&&F&&(W=[],arrForEach(F,(function(F){(z||F===G)&&(z=!0,W.push(F))}))),G&&!z&&(W||(W=[]),W.push(G)),_createProxyChain(W,B)}var Ai=function(){function ProcessTelemetryContext(F,B,G,W){var z=this,K=null;null!==W&&(F&&isFunction(F.getPlugin)?K=_copyProxyChain(F,z,W||F.getPlugin()):W?K=_copyPluginChain(F,z,W):isUndefined(W)&&(K=_createProxyChain(F,z))),z.core=function(){return G},z.diagLog=function(){return safeGetLogger(G,B)},z.getCfg=function(){return B},z.getExtCfg=function(F,G){var W;if(void 0===G&&(G={}),B){var z=B.extensionConfig;z&&F&&(W=z[F])}return W||G},z.getConfig=function(F,G,W){var K;void 0===W&&(W=!1);var J=z.getExtCfg(F,null);return J&&!isNullOrUndefined(J[G])?K=J[G]:B&&!isNullOrUndefined(B[G])&&(K=B[G]),isNullOrUndefined(K)?W:K},z.hasNext=function(){return null!=K},z.getNext=function(){return K},z.setNext=function(F){K=F},z.processNext=function(F){var B=K;B&&(K=B.getNext(),B.processTelemetry(F,z))},z.createNew=function(F,W){return void 0===F&&(F=null),new ProcessTelemetryContext(F||K,B,G,W)}}return ProcessTelemetryContext}(),Ri="iKey",Pi="extensionConfig",Oi="getPlugin",Mi=function(){function BaseTelemetryPlugin(){var F=this,B=!1,G=null,W=null;F.core=null,F.diagLog=function(B){return F._getTelCtx(B).diagLog()},F.isInitialized=function(){return B},F.setInitialized=function(F){B=F},F.setNextPlugin=function(F){W=F},F.processNext=function(F,B){B?B.processNext(F):W&&isFunction(W.processTelemetry)&&W.processTelemetry(F,null)},F._getTelCtx=function(B){void 0===B&&(B=null);var z=B;if(!z){var K=G||new Ai(null,{},F.core);z=W&&W[Oi]?K.createNew(null,W[Oi]):K.createNew(null,W)}return z},F._baseTelInit=function(z,K,J,Q){z&&setValue(z,Pi,[],null,isNullOrUndefined),!Q&&K&&(Q=K.getProcessTelContext().getNext());var Y=W;W&&W[Oi]&&(Y=W[Oi]()),F.core=K,G=new Ai(Q,z,K,Y),B=!0}}return BaseTelemetryPlugin.prototype.initialize=function(F,B,G,W){this._baseTelInit(F,B,G,W)},BaseTelemetryPlugin}(),wi="processTelemetry",Di="priority",Ni="setNextPlugin",Li="isInitialized";function initializePlugins(F,B){for(var G=[],W=null,z=F.getNext();z;){var K=z.getPlugin();K&&(W&&isFunction(W[Ni])&&isFunction(K[wi])&&W[Ni](K),isFunction(K[Li])&&K[Li]()||G.push(K),W=K,z=z.getNext())}arrForEach(G,(function(G){G.initialize(F.getCfg(),F.core(),B,F.getNext())}))}function sortPlugins(F){return F.sort((function(F,B){var G=0,W=isFunction(B[wi]);return isFunction(F[wi])?G=W?F[Di]-B[Di]:1:W&&(G=-1),G}))}var ki=500,Fi="Channel has invalid priority",xi=function(F){function ChannelController(){var B,G=F.call(this)||this;function _checkQueuePriority(F){arrForEach(F,(function(F){F.priority<ki&&throwError(Fi+F.identifier)}))}function _addChannelQueue(F){F&&F.length>0&&(_checkQueuePriority(F=F.sort((function(F,B){return F.priority-B.priority}))),B.push(F))}function _createChannelQueues(F,G){if(B=[],F&&arrForEach(F,(function(F){return _addChannelQueue(F)})),G){var W=[];arrForEach(G,(function(F){F.priority>ki&&W.push(F)})),_addChannelQueue(W)}}return G.identifier="ChannelControllerPlugin",G.priority=ki,dynamicProto(ChannelController,G,(function(F,W){F.setNextPlugin=function(F){},F.processTelemetry=function(F,W){B&&arrForEach(B,(function(B){B.length>0&&G._getTelCtx(W).createNew(B).processNext(F)}))},F.getChannelControls=function(){return B},F.initialize=function(G,z,K){F.isInitialized()||(W.initialize(G,z,K),_createChannelQueues((G||{}).channels,K),arrForEach(B,(function(F){return initializePlugins(new Ai(F,G,z),K)})))}})),G}var B;return __extendsFn$1(ChannelController,F),ChannelController._staticInit=(objDefineAccessors(B=ChannelController.prototype,"ChannelControls",B.getChannelControls),void objDefineAccessors(B,"channelQueue",B.getChannelControls)),ChannelController}(Mi),Ui="toGMTString",ji="toUTCString",Bi="cookie",Hi="expires",Vi="enabled",Gi="isCookieUseDisabled",Wi="disableCookiesUsage",qi="_ckMgr",zi="",Ki=null,Ji=null,Qi=null,Yi=getDocument(),$i={},Xi={};function _gblCookieMgr(F,B){var G=createCookieMgr[qi]||Xi[qi];return G||(G=createCookieMgr[qi]=createCookieMgr(F,B),Xi[qi]=G),G}function _isMgrEnabled(F){return!F||F.isEnabled()}function _createCookieMgrConfig(F){var B=F.cookieCfg=F.cookieCfg||{};if(setValue(B,"domain",F.cookieDomain,isNotNullOrUndefined,isNullOrUndefined),setValue(B,"path",F.cookiePath||"/",null,isNullOrUndefined),isNullOrUndefined(B[Vi])){var G=void 0;isUndefined(F[Gi])||(G=!F[Gi]),isUndefined(F[Wi])||(G=!F[Wi]),B[Vi]=G}return B}function safeGetCookieMgr(F,B){var G;if(F)G=F.getCookieMgr();else if(B){var W=(B||{}).cookieCfg;G=W[qi]?W[qi]:createCookieMgr(B)}return G||(G=_gblCookieMgr(B,(F||{}).logger)),G}function createCookieMgr(F,B){var G=_createCookieMgrConfig(F||Xi),W=G.path||"/",z=G.domain,K=!1!==G[Vi],J={isEnabled:function(){var F=K&&areCookiesSupported(B),G=Xi[qi];return F&&G&&J!==G&&(F=_isMgrEnabled(G)),F},setEnabled:function(F){K=!1!==F},set:function(F,B,K,Q,Y){if(_isMgrEnabled(J)){var $={},X=strTrim(B||zi),Z=X.indexOf(";");if(-1!==Z&&(X=strTrim(B.substring(0,Z)),$=_extractParts(B.substring(Z+1))),setValue($,"domain",Q||z,isTruthy,isUndefined),!isNullOrUndefined(K)){var ee=isIE();if(isUndefined($[Hi])){var te=dateNow()+1e3*K;if(te>0){var ne=new Date;ne.setTime(te),setValue($,Hi,_formatDate(ne,ee?Ui:ji)||_formatDate(ne,ee?Ui:ji)||zi,isTruthy)}}ee||setValue($,"max-age",zi+K,null,isUndefined)}var ie=getLocation();ie&&"https:"===ie.protocol&&(setValue($,"secure",null,null,isUndefined),null===Ji&&(Ji=!uaDisallowsSameSiteNone((getNavigator()||{}).userAgent)),Ji&&setValue($,"SameSite","None",null,isUndefined)),setValue($,"path",Y||W,null,isUndefined),(G.setCookie||_setCookieValue)(F,_formatCookieValue(X,$))}},get:function(F){var B=zi;return _isMgrEnabled(J)&&(B=(G.getCookie||_getCookieValue)(F)),B},del:function(F,B){_isMgrEnabled(J)&&J.purge(F,B)},purge:function(F,W){if(areCookiesSupported(B)){var z=((K={}).path=W||"/",K[Hi]="Thu, 01 Jan 1970 00:00:01 GMT",K);isIE()||(z["max-age"]="0"),(G.delCookie||_setCookieValue)(F,_formatCookieValue(zi,z))}var K}};return J[qi]=J,J}function areCookiesSupported(F){if(null===Ki){Ki=!1;try{Ki=void 0!==(Yi||{})[Bi]}catch(B){F&&F.throwInternal(Wn.WARNING,zn.CannotAccessCookie,"Cannot access document.cookie - "+getExceptionName(B),{exception:dumpObj(B)})}}return Ki}function _extractParts(F){var B={};F&&F.length&&arrForEach(strTrim(F).split(";"),(function(F){if(F=strTrim(F||zi)){var G=F.indexOf("=");-1===G?B[F]=null:B[strTrim(F.substring(0,G))]=strTrim(F.substring(G+1))}}));return B}function _formatDate(F,B){return isFunction(F[B])?F[B]():null}function _formatCookieValue(F,B){var G=F||zi;return objForEachKey(B,(function(F,B){G+="; "+F+(isNullOrUndefined(B)?zi:"="+B)})),G}function _getCookieValue(F){var B=zi;if(Yi){var G=Yi[Bi]||zi;Qi!==G&&($i=_extractParts(G),Qi=G),B=strTrim($i[F]||zi)}return B}function _setCookieValue(F,B){Yi&&(Yi[Bi]=F+"="+B)}function uaDisallowsSameSiteNone(F){return!!isString(F)&&(!(!strContains(F,"CPU iPhone OS 12")&&!strContains(F,"iPad; CPU OS 12"))||(!!(strContains(F,"Macintosh; Intel Mac OS X 10_14")&&strContains(F,"Version/")&&strContains(F,"Safari"))||(!(!strContains(F,"Macintosh; Intel Mac OS X 10_14")||!strEndsWith(F,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))||(!(!strContains(F,"Chrome/5")&&!strContains(F,"Chrome/6"))||(!(!strContains(F,"UnrealEngine")||strContains(F,"Chrome"))||!(!strContains(F,"UCBrowser/12")&&!strContains(F,"UCBrowser/11")))))))}var Zi="Extensions must provide callback to initialize",er="_notificationManager",tr=function(){function BaseCore(){var F,B,G,W,z,K=!1;dynamicProto(BaseCore,this,(function(J){J._extensions=new Array,B=new xi,J.logger=objCreateFn$1({throwInternal:function(F,B,G,W,z){},warnToConsole:function(F){},resetInternalMessageCount:function(){}}),F=[],J.isInitialized=function(){return K},J.initialize=function(F,W,z,Q){J.isInitialized()&&throwError("Core should not be initialized more than once"),F&&!isNullOrUndefined(F.instrumentationKey)||throwError("Please provide instrumentation key"),G=Q,J[er]=Q,J.config=F||{},F.extensions=isNullOrUndefined(F.extensions)?[]:F.extensions,getSetValue(F,Pi).NotificationManager=Q,z&&(J.logger=z);var Y=[];Y.push.apply(Y,W.concat(F.extensions)),Y=sortPlugins(Y);var $=[],X={};arrForEach(Y,(function(F){(isNullOrUndefined(F)||isNullOrUndefined(F.initialize))&&throwError(Zi);var G=F.priority,W=F.identifier;F&&G&&(isNullOrUndefined(X[G])?X[G]=W:z.warnToConsole("Two extensions have same priority #"+G+" - "+X[G]+", "+W)),(!G||G<B.priority)&&$.push(F)})),Y.push(B),$.push(B),Y=sortPlugins(Y),J._extensions=Y,initializePlugins(new Ai([B],F,J),Y),initializePlugins(new Ai($,F,J),Y),J._extensions=$,0===J.getTransmissionControls().length&&throwError("No channels available"),K=!0,J.releaseQueue()},J.getTransmissionControls=function(){return B.getChannelControls()},J.track=function(B){setValue(B,Ri,J.config.instrumentationKey,null,isNotTruthy),setValue(B,"time",toISOString(new Date),null,isNotTruthy),setValue(B,"ver","4.0",null,isNullOrUndefined),J.isInitialized()?J.getProcessTelContext().processNext(B):F.push(B)},J.getProcessTelContext=function(){var F=J._extensions,G=F;return F&&0!==F.length||(G=[B]),new Ai(G,J.config,J)},J.getNotifyMgr=function(){return G||(G=objCreateFn$1({addNotificationListener:function(F){},removeNotificationListener:function(F){},eventsSent:function(F){},eventsDiscarded:function(F,B){},eventsSendRequest:function(F,B){}}),J[er]=G),G},J.getCookieMgr=function(){return z||(z=createCookieMgr(J.config,J.logger)),z},J.setCookieMgr=function(F){z=F},J.getPerfMgr=function(){return W||J.config&&J.config.enablePerfMgr&&(W=new Ei(J.getNotifyMgr())),W},J.setPerfMgr=function(F){W=F},J.eventCnt=function(){return F.length},J.releaseQueue=function(){F.length>0&&(arrForEach(F,(function(F){J.getProcessTelContext().processNext(F)})),F=[])}}))}return BaseCore}(),nr=function(){function NotificationManager(F){this.listeners=[];var B=!!(F||{}).perfEvtsSendAll;dynamicProto(NotificationManager,this,(function(F){F.addNotificationListener=function(B){F.listeners.push(B)},F.removeNotificationListener=function(B){for(var G=arrIndexOf(F.listeners,B);G>-1;)F.listeners.splice(G,1),G=arrIndexOf(F.listeners,B)},F.eventsSent=function(B){arrForEach(F.listeners,(function(F){F&&F.eventsSent&&setTimeout((function(){return F.eventsSent(B)}),0)}))},F.eventsDiscarded=function(B,G){arrForEach(F.listeners,(function(F){F&&F.eventsDiscarded&&setTimeout((function(){return F.eventsDiscarded(B,G)}),0)}))},F.eventsSendRequest=function(B,G){arrForEach(F.listeners,(function(F){if(F&&F.eventsSendRequest)if(G)setTimeout((function(){return F.eventsSendRequest(B,G)}),0);else try{F.eventsSendRequest(B,G)}catch(F){}}))},F.perfEvent=function(G){G&&(!B&&G.isChildEvt()||arrForEach(F.listeners,(function(F){if(F&&F.perfEvent)if(G.isAsync)setTimeout((function(){return F.perfEvent(G)}),0);else try{F.perfEvent(G)}catch(F){}})))}}))}return NotificationManager}(),ir=function(F){function AppInsightsCore(){var B=F.call(this)||this;return dynamicProto(AppInsightsCore,B,(function(F,B){function _validateTelemetryItem(F){if(isNullOrUndefined(F.name))throw _notifyInvalidEvent(F),Error("telemetry name required")}function _notifyInvalidEvent(B){var G=F.getNotifyMgr();G&&G.eventsDiscarded([B],pn.InvalidEvent)}F.initialize=function(F,G,W,z){B.initialize(F,G,W||new _i(F),z||new nr(F))},F.track=function(G){doPerf(F.getPerfMgr(),(function(){return"AppInsightsCore:track"}),(function(){null===G&&(_notifyInvalidEvent(G),throwError("Invalid telemetry item")),_validateTelemetryItem(G),B.track(G)}),(function(){return{item:G}}),!G.sync)},F.addNotificationListener=function(B){var G=F.getNotifyMgr();G&&G.addNotificationListener(B)},F.removeNotificationListener=function(B){var G=F.getNotifyMgr();G&&G.removeNotificationListener(B)},F.pollInternalLogs=function(B){var G=F.config.diagnosticLogInterval;return G&&G>0||(G=1e4),setInterval((function(){var G=F.logger?F.logger.queue:[];arrForEach(G,(function(G){var W={name:B||"InternalMessageId: "+G.messageId,iKey:F.config.instrumentationKey,time:toISOString(new Date),baseType:Si.dataType,baseData:{message:G.message}};F.track(W)})),G.length=0}),G)}})),B}return __extendsFn$1(AppInsightsCore,F),AppInsightsCore}(tr),rr=4294967296,or=4294967295,ar=!1,sr=123456789,cr=987654321;function _mwcSeed(F){F<0&&(F>>>=0),sr=123456789+F&or,cr=987654321-F&or,ar=!0}function _autoSeedMwc(){try{var F=2147483647&dateNow();_mwcSeed((Math.random()*rr^F)+F)}catch(F){}}function randomValue(F){return F>0?Math.floor(random32()/or*(F+1))>>>0:0}function random32(F){var B,G=getCrypto()||getMsCrypto();return G&&G.getRandomValues?B=G.getRandomValues(new Uint32Array(1))[0]&or:isIE()?(ar||_autoSeedMwc(),B=mwcRandom32()&or):B=Math.floor(rr*Math.random()|0),F||(B>>>=0),B}function mwcRandom32(F){var B=((cr=36969*(65535&cr)+(cr>>16)&or)<<16)+(65535&(sr=18e3*(65535&sr)+(sr>>16)&or))>>>0&or|0;return F||(B>>>=0),B}function addEventHandler(F,B){var G=!1,W=getWindow();W&&(G=attachEvent(W,F,B),G=attachEvent(W.body,F,B)||G);var z=getDocument();return z&&(G=ur.Attach(z,F,B)||G),G}function newGuid(){function randomHexDigit(){return randomValue(15)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(dr,(function(F){var B=0|randomHexDigit();return("x"===F?B:3&B|8).toString(16)}))}function perfNow(){var F=getPerformance();return F&&F.now?F.now():dateNow()}function newId(F){void 0===F&&(F=22);for(var B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",G=random32()>>>0,W=0,z="";z.length<F;)W++,z+=B.charAt(63&G),G>>>=6,5===W&&(G=(random32()<<2&4294967295|3&G)>>>0,W=0);return z}function generateW3CId(){for(var F,B=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],G="",W=0;W<4;W++)G+=B[15&(F=random32())]+B[F>>4&15]+B[F>>8&15]+B[F>>12&15]+B[F>>16&15]+B[F>>20&15]+B[F>>24&15]+B[F>>28&15];var z=B[8+(3&random32())|0];return G.substr(0,8)+G.substr(9,4)+"4"+G.substr(13,3)+z+G.substr(16,3)+G.substr(19,12)}var lr,dr=/[xy]/g,ur={Attach:attachEvent,AttachEvent:attachEvent,Detach:detachEvent,DetachEvent:detachEvent},pr={NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,CustomerContent_GenericContent:32},hr={Normal:1,CostDeferred:2,RealTime:3,Immediate:4},gr={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},fr=un(un({},zn),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520}),mr="1DS-Web-JS-"+"3.1.2",vr=((lr={})[0]=gr.Unspecified,lr[2]=gr.Double,lr[1]=gr.String,lr[3]=gr.Bool,lr[4098]=gr.Double,lr[4097]=gr.String,lr[4099]=gr.Bool,lr),yr=null,Sr=(Boolean(getDocument()),Boolean(getWindow()));function isValueAssigned(F){return!(""===F||isNullOrUndefined(F))}function getTenantId(F){if(F){var B=F.indexOf("-");if(B>-1)return F.substring(0,B)}return""}function isBeaconsSupported(){return null===yr&&(yr=hasNavigator()&&Boolean(getNavigator().sendBeacon)),yr}function isLatency(F){return!!(F&&isNumber(F)&&F>=hr.Normal&&F<=hr.Immediate)}function sanitizeProperty(F,B,G){if(!B&&!isValueAssigned(B)||"string"!=typeof F)return null;var W=typeof B;if("string"===W||"number"===W||"boolean"===W||isArray(B))B={value:B};else if("object"!==W||B.hasOwnProperty("value")){if(isNullOrUndefined(B.value)||""===B.value||!isString(B.value)&&!isNumber(B.value)&&!isBoolean(B.value)&&!isArray(B.value))return null}else B={value:G?JSON.stringify(B):B};if(isArray(B.value)&&!isArrayValid(B.value))return null;if(!isNullOrUndefined(B.kind)){if(isArray(B.value)||!isValueKind(B.kind))return null;B.value=B.value.toString()}return B}function useXDomainRequest(){if(void 0!==typeof XMLHttpRequest){var F=getGlobalInst("XMLHttpRequest");if(F){var B=new F;return Boolean(isUndefined(B.withCredentials)&&void 0!==typeof XDomainRequest)}}}function getCommonSchemaMetaData(F,B,G){var W=-1;if(!isUndefined(F))if(B>0&&(32===B?W=8192:B<=13&&(W=B<<5)),isDataType(G))-1===W&&(W=0),W|=G;else{var z=vr[getFieldValueType(F)]||-1;-1!==W&&-1!==z?W|=z:z===gr.Double&&(W=z)}return W}function getCookie(F){return areCookiesSupported(null)?getCookieValue(safeGetCookieMgr(null),F):""}function getCookieValue(F,B,G){var W;return void 0===G&&(G=!0),F&&(W=F.get(B),G&&W&&decodeURIComponent&&(W=decodeURIComponent(W))),W||""}function createGuid(F){void 0===F&&(F="D");var B=newGuid();return"B"===F?B="{"+B+"}":"P"===F?B="("+B+")":"N"===F&&(B=B.replace(/-/g,"")),B}function extend(F,B,G,W,z){var K={},J=!1,Q=0,Y=arguments.length,$=arguments;for("[object Boolean]"===Object[mn].toString.call($[0])&&(J=$[0],Q++);Q<Y;Q++){objForEachKey($[Q],(function(F,B){J&&B&&isObject(B)?isArray(B)?(K[F]=K[F]||[],arrForEach(B,(function(B,G){B&&isObject(B)?K[F][G]=extend(!0,K[F][G],B):K[F][G]=B}))):K[F]=extend(!0,K[F],B):K[F]=B}))}return K}var _r=perfNow;function isValueKind(F){return F===pr.NotSet||F>pr.NotSet&&F<=pr.Pii_IPV4AddressLegacy||F===pr.CustomerContent_GenericContent}function isDataType(F){return F>=0&&F<=9}function isArrayValid(F){return F.length>0}function addPageUnloadEventListener(F){var B=addEventHandler("beforeunload",F);return B=addEventHandler("unload",F)||B,B=addEventHandler("pagehide",F)||B}function setProcessTelemetryTimings(F,B){var G=F;G.timings=G.timings||{},G.timings.processTelemetryStart=G.timings.processTelemetryStart||{},G.timings.processTelemetryStart[B]=_r()}function getFieldValueType(F){var B=0;if(null!=F){var G=typeof F;"string"===G?B=1:"number"===G?B=2:"boolean"===G?B=3:G===tn&&(B=4,isArray(F)?(B=4096,F.length>0&&(B|=getFieldValueType(F[0]))):hasOwnProperty(F,"value")&&(B=8192|getFieldValueType(F.value)))}return B}function isChromium(){return!!getGlobalInst("chrome")}var Cr="version",Tr="properties",Er=function(F){function AppInsightsCore(){var B=F.call(this)||this;return B.pluginVersionStringArr=[],B.pluginVersionString="",dynamicProto(AppInsightsCore,B,(function(F,B){F.initialize=function(G,W,z,K){doPerf(F,(function(){return"AppInsightsCore.initialize"}),(function(){if(G){G.endpointUrl||(G.endpointUrl="https://browser.events.data.microsoft.com/OneCollector/1.0/");var J=G.propertyStorageOverride;if(J&&(!J.getProperty||!J.setProperty))throw new Error("Invalid property storage override passed.");G.channels&&arrForEach(G.channels,(function(B){B&&arrForEach(B,(function(B){if(B.identifier&&B.version){var G=B.identifier+"="+B.version;F.pluginVersionStringArr.push(G)}}))}))}F.getWParam=function(){return"undefined"!=typeof document?0:-1},W&&arrForEach(W,(function(B){if(B&&B.identifier&&B.version){var G=B.identifier+"="+B.version;F.pluginVersionStringArr.push(G)}})),F.pluginVersionString=F.pluginVersionStringArr.join(";");try{B.initialize(G,W,z,K)}catch(B){F.logger.throwInternal(Wn.CRITICAL,fr.ErrorProvidedChannels,"Channels must be provided through config.channels only")}F.pollInternalLogs("InternalLog")}),(function(){return{config:G,extensions:W,logger:z,notificationManager:K}}))},F.track=function(G){doPerf(F,(function(){return"AppInsightsCore.track"}),(function(){var W=G;if(W){W.timings=W.timings||{},W.timings.trackStart=_r(),isLatency(W.latency)||(W.latency=hr.Normal);var z=W.ext=W.ext||{};z.sdk=z.sdk||{},z.sdk.ver=mr;var K=W.baseData=W.baseData||{};K[Tr]||(K[Tr]={});var J=K[Tr];J[Cr]||(J[Cr]=""),""!==F.pluginVersionString&&(J[Cr]=F.pluginVersionString)}B.track(W)}),(function(){return{item:G}}),!G.sync)}})),B}return __extendsFn(AppInsightsCore,F),AppInsightsCore}(ir);let br,Ir={telemetry:{callStatsFlushTimeout:nt,discardedTelemetryRetryTimeout:it,discardedEventsBufferMaxLength:rt,discardedEventsMaxRetries:ot,telemetryFlushTimeout:Xe,allowedEvents:[],blockedEvents:["acs_calling_feature_usage"],telemetryBeforeUnload:!1,gzipTelemetryPayload:!0,localStorageEnable:!1,mediaStatsConfig:{enabled:!0,throttleTelemetry:1,enableLegacyMediaStats:!1,fetchInterval:1,aggregationInterval:10,dataPointsPerAggregation:6,additionalStats:{},dataToSend:{raw:!1,min:!0,max:!0,sum:!0,count:!0}},reportSdkUaToService:!1},debugInfo:{enableLogDump:at,maxLogDumpLength:st,includeList:[],excludeList:[]},telemetryEvents:{eventNameToPriority:{eventName:["acs_calling_call_stats"],priority:[hr.Immediate]}},rendering:{remoteVideo:{createViewTimeout:ct,createViewUnsubscribeTimeout:lt,debounceTimeout:dt,createViewSendMediaStats:!0,forceCheckIfVideoWasAttachedToDom:!0,checkIfVideoAttachedToDom_poll:!0,checkIfVideoAttachedToDom_intervalTime:ut,checkIfVideoAttachedToDom_intervalMaxTries:pt,checkIfVideoAttachedToDom_timeout:ht,createViewSenderStatsEnabled:!1,createViewSenderStatsDuration:gt}},captions:{acsBotMri:Ct,teamsBotMri:Tt,clientInfo:Et,availableLanguages:bt},calling:{doNotWaitForTrouter:!1,hangUpCallOnPageHide:!1,maxNumberOfTokenFetchRetries:10,deviceNotFunctioningMuted:!0,preventStopAudio:!1,preventFakeMute:!1,osAutoRecoverAudio:!1,deviceCaptureMuteRecover:!1,allowMuteOnBadUfd:!0,preventStopVideo:!0,mediaMetricsDeviceEventsEnabled:!1,allowAccessRawMediaStream:!1,applyViewLimit:!1,deviceCaptureMutedVideo:!0,removeLvsCheckOnCallStartAndCallAccept:!1,removeLocalAudioStreamCheckOnCallStartAndCallAccept:!1,supportLiveStreaming:!1,liveStreamingBotId:At,devicePermissions:{splitAskAudioVideo:!1,timeoutInBetween:0,getCurrentState:!0},applicationSettingsUrls:{Public_ConversationServiceUrl:qe.Public_ConversationServiceUrl,Public_TrouterServiceUrl:qe.Public_TrouterServiceUrl,Public_RegistrarServiceUrl:qe.Public_RegistrarServiceUrl,Public_MdnTrapServiceUrl:qe.Public_MdnTrapServiceUrl,Public_MdnTrapServiceTokenUrl:qe.Public_MdnTrapServiceTokenUrl,Public_MdnTrapRelaySkypeFqdns:qe.Public_MdnTrapRelaySkypeFqdns,Public_MdnTrapRelayTurnFqdns:qe.Public_MdnTrapRelayTurnFqdns,Public_MdnTrapRelayTurnUrl:qe.Public_MdnTrapRelayTurnUrl,GccHigh_ConversationServiceUrl:qe.GccHigh_ConversationServiceUrl,GccHigh_TrouterServiceUrl:qe.GccHigh_TrouterServiceUrl,GccHigh_RegistrarServiceUrl:qe.GccHigh_RegistrarServiceUrl,GccHigh_MdnTrapServiceUrl:qe.GccHigh_MdnTrapServiceUrl,GccHigh_MdnTrapServiceTokenUrl:qe.GccHigh_MdnTrapServiceTokenUrl,GccHigh_MdnTrapRelaySkypeFqdns:qe.GccHigh_MdnTrapRelaySkypeFqdns,GccHigh_MdnTrapRelayTurnFqdns:qe.GccHigh_MdnTrapRelayTurnFqdns,GccHigh_MdnTrapRelayTurnUrl:qe.GccHigh_MdnTrapRelayTurnUrl,Dod_ConversationServiceUrl:qe.Dod_ConversationServiceUrl,Dod_TrouterServiceUrl:qe.Dod_TrouterServiceUrl,Dod_RegistrarServiceUrl:qe.Dod_RegistrarServiceUrl,Dod_MdnTrapServiceUrl:qe.Dod_MdnTrapServiceUrl,Dod_MdnTrapServiceTokenUrl:qe.Dod_MdnTrapServiceTokenUrl,Dod_MdnTrapRelaySkypeFqdns:qe.Dod_MdnTrapRelaySkypeFqdns,Dod_MdnTrapRelayTurnFqdns:qe.Dod_MdnTrapRelayTurnFqdns,Dod_MdnTrapRelayTurnUrl:qe.Dod_MdnTrapRelayTurnUrl,AirGap08_ConversationServiceUrl:qe.AirGap08_ConversationServiceUrl,AirGap08_TrouterServiceUrl:qe.AirGap08_TrouterServiceUrl,AirGap08_RegistrarServiceUrl:qe.AirGap08_RegistrarServiceUrl,AirGap09_ConversationServiceUrl:qe.AirGap09_ConversationServiceUrl,AirGap09_TrouterServiceUrl:qe.AirGap09_TrouterServiceUrl,AirGap09_RegistrarServiceUrl:qe.AirGap09_RegistrarServiceUrl,Enterprise_ConversationServiceUrl:qe.Enterprise_ConversationServiceUrl,Enterprise_TrouterServiceUrl:qe.Enterprise_TrouterServiceUrl,Enterprise_RegistrarServiceUrl:qe.Enterprise_RegistrarServiceUrl,Enterprise_MdnTrapServiceUrl:qe.Enterprise_MdnTrapServiceUrl,Enterprise_MdnTrapServiceTokenUrl:qe.Enterprise_MdnTrapServiceTokenUrl,Enterprise_MdnTrapRelaySkypeFqdns:qe.Enterprise_MdnTrapRelaySkypeFqdns,Enterprise_MdnTrapRelayTurnFqdns:qe.Enterprise_MdnTrapRelayTurnFqdns,Enterprise_MdnTrapRelayTurnUrl:qe.Enterprise_MdnTrapRelayTurnUrl,Public_ConversationServiceUrl_EUDB:We.Public_ConversationServiceUrl_EUDB,Public_TrouterServiceUrl_EUDB:We.Public_TrouterServiceUrl_EUDB,Public_RegistrarServiceUrl_EUDB:We.Public_RegistrarServiceUrl_EUDB,Public_MdnTrapServiceUrl_EUDB:We.Public_MdnTrapServiceUrl_EUDB,Public_MdnTrapServiceTokenUrl_EUDB:We.Public_MdnTrapServiceTokenUrl_EUDB,Public_MdnTrapRelaySkypeFqdns_EUDB:We.Public_MdnTrapRelaySkypeFqdns_EUDB,Public_MdnTrapRelayTurnFqdns_EUDB:We.Public_MdnTrapRelayTurnFqdns_EUDB,Public_MdnTrapRelayTurnUrl_EUDB:We.Public_MdnTrapRelayTurnUrl_EUDB},maxDisplayNameLength:256,callDiagnostics:Qe,eudb:{countries:Je,defaultDataLocationEurope:!1}},roles:{acsOrganizer:Ye.AcsOrganizerRole,acsPresenter:Ye.AcsPresenterRole,acsAttendee:Ye.AcsAttendeeRole,acsConsumer:Ye.AcsConsumerRole,teamsAttendee:Ye.TeamsAttendee,teamsOrganizer:Ye.TeamsOrganizer,teamsPresenter:Ye.TeamsPresenter},environments:{android:{chrome:{minVersion:Pt}},ios:{safari:{minVersion:Pt}},mac:{chrome:{minVersion:Pt},safari:{minVersion:Pt}},windows:{chrome:{minVersion:Pt},chromium:{minVersion:Pt},edgeanaheim:{minVersion:Pt}},linux:{chrome:{minVersion:Pt}}},MiddleTier:{enabled:!1,maxRetry:3,baseServiceUrl:ze.baseServiceUrl,policyUrlSuffix:ze.policyUrlSuffix,userPolicySettingsApi:!1}};function setAcsEcsConfig(F,B){var G,W,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Te,Ee,be,Ie,Ae,Re,Pe,Oe,Me,we,De,Ne,Le,ke,Fe,xe,Ue,je,Be,He,Ve,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e;if(!F)return;const Xe=F.AcsCallingSDKWeb;try{void 0!==(null===(G=null==Xe?void 0:Xe.telemetry)||void 0===G?void 0:G.callStatsFlushTimeout)&&(Ir.telemetry.callStatsFlushTimeout=Xe.telemetry.callStatsFlushTimeout)}catch(F){}try{void 0!==(null===(W=null==Xe?void 0:Xe.telemetry)||void 0===W?void 0:W.mediaStatsConfig)&&(void 0!==Xe.telemetry.mediaStatsConfig.enabled&&(Ir.telemetry.mediaStatsConfig.enabled=Xe.telemetry.mediaStatsConfig.enabled),void 0!==Xe.telemetry.mediaStatsConfig.throttleTelemetry&&(Ir.telemetry.mediaStatsConfig.throttleTelemetry=Xe.telemetry.mediaStatsConfig.throttleTelemetry),void 0!==Xe.telemetry.mediaStatsConfig.enableLegacyMediaStats&&(Ir.telemetry.mediaStatsConfig.enableLegacyMediaStats=Xe.telemetry.mediaStatsConfig.enableLegacyMediaStats),void 0!==Xe.telemetry.mediaStatsConfig.fetchInterval&&(Ir.telemetry.mediaStatsConfig.fetchInterval=Xe.telemetry.mediaStatsConfig.fetchInterval),void 0!==Xe.telemetry.mediaStatsConfig.aggregationInterval&&(Ir.telemetry.mediaStatsConfig.aggregationInterval=Xe.telemetry.mediaStatsConfig.aggregationInterval),void 0!==Xe.telemetry.mediaStatsConfig.dataPointsPerAggregation&&(Ir.telemetry.mediaStatsConfig.dataPointsPerAggregation=Xe.telemetry.mediaStatsConfig.dataPointsPerAggregation),void 0!==Xe.telemetry.mediaStatsConfig.additionalStats&&(Ir.telemetry.mediaStatsConfig.additionalStats=Xe.telemetry.mediaStatsConfig.additionalStats),void 0!==Xe.telemetry.mediaStatsConfig.dataToSend&&(void 0!==Xe.telemetry.mediaStatsConfig.dataToSend.raw&&(Ir.telemetry.mediaStatsConfig.dataToSend.raw=Xe.telemetry.mediaStatsConfig.dataToSend.raw),void 0!==Xe.telemetry.mediaStatsConfig.dataToSend.min&&(Ir.telemetry.mediaStatsConfig.dataToSend.min=Xe.telemetry.mediaStatsConfig.dataToSend.min),void 0!==Xe.telemetry.mediaStatsConfig.dataToSend.max&&(Ir.telemetry.mediaStatsConfig.dataToSend.max=Xe.telemetry.mediaStatsConfig.dataToSend.max),void 0!==Xe.telemetry.mediaStatsConfig.dataToSend.sum&&(Ir.telemetry.mediaStatsConfig.dataToSend.sum=Xe.telemetry.mediaStatsConfig.dataToSend.sum),void 0!==Xe.telemetry.mediaStatsConfig.dataToSend.count&&(Ir.telemetry.mediaStatsConfig.dataToSend.count=Xe.telemetry.mediaStatsConfig.dataToSend.count)))}catch(F){}try{void 0!==(null===(z=null==Xe?void 0:Xe.telemetry)||void 0===z?void 0:z.telemetryFlushTimeout)&&(Ir.telemetry.telemetryFlushTimeout=Xe.telemetry.telemetryFlushTimeout)}catch(F){}try{void 0!==(null===(K=null==Xe?void 0:Xe.telemetry)||void 0===K?void 0:K.discardedTelemetryRetryTimeout)&&(Ir.telemetry.discardedTelemetryRetryTimeout=Xe.telemetry.discardedTelemetryRetryTimeout)}catch(F){}try{void 0!==(null===(J=null==Xe?void 0:Xe.telemetry)||void 0===J?void 0:J.discardedEventsBufferMaxLength)&&(Ir.telemetry.discardedEventsBufferMaxLength=Xe.telemetry.discardedEventsBufferMaxLength)}catch(F){}try{void 0!==(null===(Q=null==Xe?void 0:Xe.telemetry)||void 0===Q?void 0:Q.discardedEventsMaxRetries)&&(Ir.telemetry.discardedEventsMaxRetries=Xe.telemetry.discardedEventsMaxRetries)}catch(F){}try{Array.isArray(null===(Y=null==Xe?void 0:Xe.telemetry)||void 0===Y?void 0:Y.allowedEvents)&&(Ir.telemetry.allowedEvents=Xe.telemetry.allowedEvents)}catch(F){}try{Array.isArray(null===($=null==Xe?void 0:Xe.telemetry)||void 0===$?void 0:$.blockedEvents)&&(Ir.telemetry.blockedEvents=Xe.telemetry.blockedEvents)}catch(F){}try{void 0!==(null===(X=null==Xe?void 0:Xe.telemetry)||void 0===X?void 0:X.telemetryBeforeUnload)&&(Ir.telemetry.telemetryBeforeUnload=Xe.telemetry.telemetryBeforeUnload)}catch(F){}try{void 0!==(null==Xe?void 0:Xe.debugInfo)&&(Ir.debugInfo=Object.assign(Object.assign({},Ir.debugInfo),Xe.debugInfo))}catch(F){}try{void 0!==(null===(Z=null==Xe?void 0:Xe.telemetry)||void 0===Z?void 0:Z.gzipTelemetryPayload)&&(Ir.telemetry.gzipTelemetryPayload=Xe.telemetry.gzipTelemetryPayload)}catch(F){}try{void 0!==(null===(ee=null==Xe?void 0:Xe.telemetry)||void 0===ee?void 0:ee.localStorageEnable)&&(Ir.telemetry.localStorageEnable=Xe.telemetry.localStorageEnable)}catch(F){}try{void 0!==(null===(te=null==Xe?void 0:Xe.telemetry)||void 0===te?void 0:te.reportSdkUaToService)&&(Ir.telemetry.reportSdkUaToService=Xe.telemetry.reportSdkUaToService)}catch(F){}try{void 0!==(null==Xe?void 0:Xe.calling.applyViewLimit)&&(Ir.calling.applyViewLimit=Xe.calling.applyViewLimit)}catch(F){}try{void 0!==(null===(ie=null===(ne=null==Xe?void 0:Xe.rendering)||void 0===ne?void 0:ne.remoteVideo)||void 0===ie?void 0:ie.createViewTimeout)&&(Ir.rendering.remoteVideo.createViewTimeout=Xe.rendering.remoteVideo.createViewTimeout)}catch(F){}try{void 0!==(null===(oe=null===(re=null==Xe?void 0:Xe.rendering)||void 0===re?void 0:re.remoteVideo)||void 0===oe?void 0:oe.createViewUnsubscribeTimeout)&&(Ir.rendering.remoteVideo.createViewUnsubscribeTimeout=Xe.rendering.remoteVideo.createViewUnsubscribeTimeout)}catch(F){}try{void 0!==(null===(se=null===(ae=null==Xe?void 0:Xe.rendering)||void 0===ae?void 0:ae.remoteVideo)||void 0===se?void 0:se.debounceTimeout)&&(Ir.rendering.remoteVideo.debounceTimeout=Xe.rendering.remoteVideo.debounceTimeout)}catch(F){}try{void 0!==(null===(le=null===(ce=null==Xe?void 0:Xe.rendering)||void 0===ce?void 0:ce.remoteVideo)||void 0===le?void 0:le.createViewSendMediaStats)&&(Ir.rendering.remoteVideo.createViewSendMediaStats=Xe.rendering.remoteVideo.createViewSendMediaStats)}catch(F){}try{void 0!==(null===(ue=null===(de=null==Xe?void 0:Xe.rendering)||void 0===de?void 0:de.remoteVideo)||void 0===ue?void 0:ue.forceCheckIfVideoWasAttachedToDom)&&(Ir.rendering.remoteVideo.forceCheckIfVideoWasAttachedToDom=Xe.rendering.remoteVideo.forceCheckIfVideoWasAttachedToDom)}catch(F){}try{void 0!==(null===(he=null===(pe=null==Xe?void 0:Xe.rendering)||void 0===pe?void 0:pe.remoteVideo)||void 0===he?void 0:he.checkIfVideoAttachedToDom_poll)&&(Ir.rendering.remoteVideo.checkIfVideoAttachedToDom_poll=Xe.rendering.remoteVideo.checkIfVideoAttachedToDom_poll)}catch(F){}try{void 0!==(null===(fe=null===(ge=null==Xe?void 0:Xe.rendering)||void 0===ge?void 0:ge.remoteVideo)||void 0===fe?void 0:fe.checkIfVideoAttachedToDom_intervalTime)&&(Ir.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalTime=Xe.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalTime)}catch(F){}try{void 0!==(null===(ve=null===(me=null==Xe?void 0:Xe.rendering)||void 0===me?void 0:me.remoteVideo)||void 0===ve?void 0:ve.checkIfVideoAttachedToDom_intervalMaxTries)&&(Ir.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalMaxTries=Xe.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalMaxTries)}catch(F){}try{void 0!==(null===(Se=null===(ye=null==Xe?void 0:Xe.rendering)||void 0===ye?void 0:ye.remoteVideo)||void 0===Se?void 0:Se.checkIfVideoAttachedToDom_timeout)&&(Ir.rendering.remoteVideo.checkIfVideoAttachedToDom_timeout=Xe.rendering.remoteVideo.checkIfVideoAttachedToDom_timeout)}catch(F){}try{void 0!==(null===(Ce=null===(_e=null==Xe?void 0:Xe.rendering)||void 0===_e?void 0:_e.remoteVideo)||void 0===Ce?void 0:Ce.createViewSenderStatsEnabled)&&(Ir.rendering.remoteVideo.createViewSenderStatsEnabled=Xe.rendering.remoteVideo.createViewSenderStatsEnabled)}catch(F){}try{void 0!==(null===(Ee=null===(Te=null==Xe?void 0:Xe.rendering)||void 0===Te?void 0:Te.remoteVideo)||void 0===Ee?void 0:Ee.createViewSenderStatsDuration)&&(Ir.rendering.remoteVideo.createViewSenderStatsDuration=Xe.rendering.remoteVideo.createViewSenderStatsDuration)}catch(F){}try{void 0!==(null==Xe?void 0:Xe.tsCalling)&&(Ir.tsCalling=Xe.tsCalling)}catch(F){}try{void 0!==(null==Xe?void 0:Xe.captions)&&(Ir.captions.acsBotMri=null!==(be=Xe.captions.acsBotMri)&&void 0!==be?be:Ir.captions.acsBotMri,Ir.captions.teamsBotMri=null!==(Ie=Xe.captions.teamsBotMri)&&void 0!==Ie?Ie:Ir.captions.teamsBotMri,Ir.captions.clientInfo=null!==(Ae=Xe.captions.clientInfo)&&void 0!==Ae?Ae:Ir.captions.clientInfo,Ir.captions.availableLanguages=null!==(Re=Xe.captions.availableLanguages)&&void 0!==Re?Re:Ir.captions.availableLanguages)}catch(F){}try{void 0!==(null===(Pe=null==Xe?void 0:Xe.calling)||void 0===Pe?void 0:Pe.maxNumberOfTokenFetchRetries)&&(Ir.calling.maxNumberOfTokenFetchRetries=Xe.calling.maxNumberOfTokenFetchRetries)}catch(F){}try{void 0!==(null===(Oe=null==Xe?void 0:Xe.calling)||void 0===Oe?void 0:Oe.deviceNotFunctioningMuted)&&(Ir.calling.deviceNotFunctioningMuted=Xe.calling.deviceNotFunctioningMuted)}catch(F){}try{void 0!==(null===(Me=null==Xe?void 0:Xe.calling)||void 0===Me?void 0:Me.preventStopAudio)&&(Ir.calling.preventStopAudio=Xe.calling.preventStopAudio)}catch(F){}try{void 0!==(null===(we=null==Xe?void 0:Xe.calling)||void 0===we?void 0:we.preventFakeMute)&&(Ir.calling.preventFakeMute=Xe.calling.preventFakeMute)}catch(F){}try{void 0!==(null===(De=null==Xe?void 0:Xe.calling)||void 0===De?void 0:De.osAutoRecoverAudio)&&(Ir.calling.osAutoRecoverAudio=Xe.calling.osAutoRecoverAudio)}catch(F){}try{void 0!==(null===(Ne=null==Xe?void 0:Xe.calling)||void 0===Ne?void 0:Ne.deviceCaptureMuteRecover)&&(Ir.calling.deviceCaptureMuteRecover=Xe.calling.deviceCaptureMuteRecover)}catch(F){}try{void 0!==(null===(Le=null==Xe?void 0:Xe.calling)||void 0===Le?void 0:Le.allowMuteOnBadUfd)&&(Ir.calling.allowMuteOnBadUfd=Xe.calling.allowMuteOnBadUfd)}catch(F){}try{void 0!==(null===(ke=null==Xe?void 0:Xe.calling)||void 0===ke?void 0:ke.preventStopVideo)&&(Ir.calling.preventStopVideo=Xe.calling.preventStopVideo)}catch(F){}try{void 0!==(null===(Fe=null==Xe?void 0:Xe.calling)||void 0===Fe?void 0:Fe.mediaMetricsDeviceEventsEnabled)&&(Ir.calling.mediaMetricsDeviceEventsEnabled=Xe.calling.mediaMetricsDeviceEventsEnabled)}catch(F){}try{void 0!==(null===(xe=null==Xe?void 0:Xe.calling)||void 0===xe?void 0:xe.allowAccessRawMediaStream)&&(Ir.calling.allowAccessRawMediaStream=Xe.calling.allowAccessRawMediaStream)}catch(F){}try{void 0!==(null===(Ue=null==Xe?void 0:Xe.calling)||void 0===Ue?void 0:Ue.deviceCaptureMutedVideo)&&(Ir.calling.deviceCaptureMutedVideo=Xe.calling.deviceCaptureMutedVideo)}catch(F){}try{void 0!==(null===(je=null==Xe?void 0:Xe.calling)||void 0===je?void 0:je.removeLvsCheckOnCallStartAndCallAccept)&&(Ir.calling.removeLvsCheckOnCallStartAndCallAccept=Xe.calling.removeLvsCheckOnCallStartAndCallAccept)}catch(F){}try{void 0!==(null===(Be=null==Xe?void 0:Xe.calling)||void 0===Be?void 0:Be.supportLiveStreaming)&&(Ir.calling.supportLiveStreaming=Xe.calling.supportLiveStreaming)}catch(F){}try{void 0!==(null===(He=null==Xe?void 0:Xe.calling)||void 0===He?void 0:He.liveStreamingBotId)&&(Ir.calling.liveStreamingBotId=Xe.calling.liveStreamingBotId)}catch(F){}try{void 0!==(null===(Ve=null==Xe?void 0:Xe.calling)||void 0===Ve?void 0:Ve.removeLocalAudioStreamCheckOnCallStartAndCallAccept)&&(Ir.calling.removeLocalAudioStreamCheckOnCallStartAndCallAccept=Xe.calling.removeLocalAudioStreamCheckOnCallStartAndCallAccept)}catch(F){}try{void 0!==(null===(Ge=null==Xe?void 0:Xe.calling)||void 0===Ge?void 0:Ge.hangUpCallOnPageHide)&&(Ir.calling.hangUpCallOnPageHide=Xe.calling.hangUpCallOnPageHide)}catch(F){}try{void 0!==(null===(We=null==Xe?void 0:Xe.calling)||void 0===We?void 0:We.doNotWaitForTrouter)&&(Ir.calling.doNotWaitForTrouter=Xe.calling.doNotWaitForTrouter)}catch(F){}try{void 0!==(null===(ze=null===(qe=null==Xe?void 0:Xe.calling)||void 0===qe?void 0:qe.eudb)||void 0===ze?void 0:ze.countries)&&(Ir.calling.eudb.countries=Xe.calling.eudb.countries)}catch(F){}try{void 0!==(null===(Je=null===(Ke=null==Xe?void 0:Xe.calling)||void 0===Ke?void 0:Ke.eudb)||void 0===Je?void 0:Je.defaultDataLocationEurope)&&(Ir.calling.eudb.defaultDataLocationEurope=Xe.calling.eudb.defaultDataLocationEurope)}catch(F){}try{if(void 0!==(null==Xe?void 0:Xe.telemetryEvents)){if(Xe.telemetryEvents.eventNameToPriority.eventName.length!==Xe.telemetryEvents.eventNameToPriority.priority.length)return;Xe.telemetryEvents.eventNameToPriority.priority.forEach((F=>{[hr.CostDeferred,hr.Immediate,hr.Normal,hr.RealTime].includes(F)})),Ir.telemetryEvents.eventNameToPriority.eventName=Xe.telemetryEvents.eventNameToPriority.eventName,Ir.telemetryEvents.eventNameToPriority.priority=Xe.telemetryEvents.eventNameToPriority.priority}}catch(F){}try{void 0!==(null===(Qe=null==Xe?void 0:Xe.calling)||void 0===Qe?void 0:Qe.applicationSettingsUrls)&&(Ir.calling.applicationSettingsUrls=Object.assign(Object.assign({},Ir.calling.applicationSettingsUrls),Xe.calling.applicationSettingsUrls))}catch(F){}try{void 0!==(null===(Ye=null==Xe?void 0:Xe.calling)||void 0===Ye?void 0:Ye.devicePermissions)&&(Ir.calling.devicePermissions=Object.assign(Object.assign({},Ir.calling.devicePermissions),Xe.calling.devicePermissions))}catch(F){}try{void 0!==(null===($e=null==Xe?void 0:Xe.calling)||void 0===$e?void 0:$e.callDiagnostics)&&(Ir.calling.callDiagnostics=Object.assign(Object.assign({},Ir.calling.callDiagnostics),Xe.calling.callDiagnostics))}catch(F){}try{void 0!==(null==Xe?void 0:Xe.environments)&&(Ir.environments=Object.assign(Object.assign({},Ir.environments),Xe.environments))}catch(F){}try{void 0!==(null==Xe?void 0:Xe.roles)&&(void 0!==Xe.roles.acsOrganizer&&(Ir.roles.acsOrganizer=Xe.roles.acsOrganizer),void 0!==Xe.roles.acsPresenter&&(Ir.roles.acsPresenter=Xe.roles.acsPresenter),void 0!==Xe.roles.acsAttendee&&(Ir.roles.acsAttendee=Xe.roles.acsAttendee),void 0!==Xe.roles.acsConsumer&&(Ir.roles.acsConsumer=Xe.roles.acsConsumer),void 0!==Xe.roles.teamsOrganizer&&(Ir.roles.teamsOrganizer=Xe.roles.teamsOrganizer),void 0!==Xe.roles.teamsPresenter&&(Ir.roles.teamsPresenter=Xe.roles.teamsPresenter),void 0!==Xe.roles.teamsAttendee&&(Ir.roles.teamsAttendee=Xe.roles.teamsAttendee))}catch(F){}try{void 0!==(null==Xe?void 0:Xe.MiddleTier)&&(Ir.MiddleTier=Object.assign(Object.assign({},Ir.MiddleTier),Xe.MiddleTier))}catch(F){}}function getAcsEcsConfig(){return Ir}function setMediaConfig(F){br=F}function getMediaConfig(){return br}const Ar={commandUrl:"",processingModes:{closedCaptions:{state:"Inactive"},realTimeTranscript:{state:"Inactive"}}};var Rr;!function(F){F.Acs="acs",F.Teams="teams",F.Unknown="unknown"}(Rr||(Rr={}));class BaseLanguageCallFeatureImplOverTsCall{constructor(F,B,G){this._eventEmitter=F,this._captionsModeKey="closedCaptions",this._transcriptModeKey="realTimeTranscript",this._transcriptionDataId=3,this._isCaptionsBot=F=>F.id===this._captionsBotMri,this._getBotMetadata=F=>{var B,G,W;return null!==(W=null===(G=null===(B=null==F?void 0:F.endpoints)||void 0===B?void 0:B.endpointDetails[0])||void 0===G?void 0:G.endpointMetadata)&&void 0!==W?W:void 0},this._isCaptionsEnabled=F=>{var B,G;return"Active"===(null===(G=null===(B=null==F?void 0:F.processingModes)||void 0===B?void 0:B[this._captionsModeKey])||void 0===G?void 0:G.state)},this._isTranscriptionEnabled=F=>{var B,G;return"Active"===(null===(G=null===(B=null==F?void 0:F.processingModes)||void 0===B?void 0:B[this._transcriptModeKey])||void 0===G?void 0:G.state)},this._copyBotMetaData=F=>{const B=this._getBotMetadata(F)||Ar;return JSON.parse(JSON.stringify(B))};let W=getAcsEcsConfig();this._captionsBotMri=B,this._clientInfo=W.captions.clientInfo,this._name=G}dispose(){this._acsMetadata=void 0}}var Pr,Or="function",Mr="object",wr="undefined",Dr="hasOwnProperty",Nr=Object,Lr=Nr["prototype"],kr=Nr.defineProperty,Fr=Lr[Dr];function getGlobal$2(){return typeof globalThis!==wr&&globalThis?globalThis:typeof self!==wr&&self?self:typeof window!==wr&&window?window:typeof global!==wr&&global?global:null}function throwTypeError$2(F){throw new TypeError(F)}!function(F){F[F.CRITICAL=1]="CRITICAL",F[F.WARNING=2]="WARNING"}(Pr||(Pr={}));var xr={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103},Ur=kr;function objToString$1(F){return Lr.toString.call(F)}function isUndefined$1(F){return void 0===F||typeof F===wr}function isNullOrUndefined$1(F){return null===F||isUndefined$1(F)}function isFunction$1(F){return typeof F===Or}function strContains$1(F,B){return!(!F||!B)&&-1!==F.indexOf(B)}function isArray$1(F){return"[object Array]"===objToString$1(F)}function isString$1(F){return"string"==typeof F}function isNumber$1(F){return"number"==typeof F}function arrForEach$1(F,B,G){for(var W=F.length,z=0;z<W&&(!(z in F)||-1!==B.call(G||F,F[z],z,F));z++);}var jr=!{toString:null}.propertyIsEnumerable("toString"),Br=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];function objKeys$1(F){var B=typeof F;B===Or||B===Mr&&null!==F||throwTypeError$2("objKeys called on non-object");var G=[];for(var W in F)F&&Fr.call(F,W)&&G.push(W);if(jr)for(var z=Br.length,K=0;K<z;K++)F&&Fr.call(F,Br[K])&&G.push(Br[K]);return G}function objDefineAccessors$1(F,B,G,W){if(Ur)try{var z={enumerable:!0,configurable:!0};return G&&(z.get=G),W&&(z.set=W),Ur(F,B,z),!0}catch(F){}return!1}function dateNow$1(){var F=Date;return F.now?F.now():(new F).getTime()}function setValue$1(F,B,G,W,z){var K=G;return F&&((K=F[B])===G||z&&!z(K)||W&&!W(G)||(K=G,F[B]=K)),K}var Hr="window",Vr="document",Gr="navigator",Wr="console",qr="performance",zr="JSON",Kr="crypto",Jr="msCrypto",Qr="msie",Yr="trident/",$r=null,Xr=null;function getGlobalInst$1(F){var B=getGlobal$2();return B&&B[F]?B[F]:F===Hr&&hasWindow$1()?window:null}function hasWindow$1(){return Boolean(typeof window===Mr&&window)}function getWindow$1(){return hasWindow$1()?window:getGlobalInst$1(Hr)}function hasDocument$1(){return Boolean(typeof document===Mr&&document)}function getDocument$1(){return hasDocument$1()?document:getGlobalInst$1(Vr)}function hasNavigator$1(){return Boolean(typeof navigator===Mr&&navigator)}function getNavigator$1(){return hasNavigator$1()?navigator:getGlobalInst$1(Gr)}function getConsole$1(){return typeof console!==wr?console:getGlobalInst$1(Wr)}function getPerformance$1(){return getGlobalInst$1(qr)}function hasJSON$1(){return Boolean(typeof JSON===Mr&&JSON||null!==getGlobalInst$1(zr))}function getJSON$1(){return hasJSON$1()?JSON||getGlobalInst$1(zr):null}function getCrypto$1(){return getGlobalInst$1(Kr)}function getMsCrypto$1(){return getGlobalInst$1(Jr)}function isIE$1(){var F=getNavigator$1();if(F&&(F.userAgent!==Xr||null===$r)){var B=((Xr=F.userAgent)||"").toLowerCase();$r=strContains$1(B,Qr)||strContains$1(B,Yr)}return $r}var Zr="AI (Internal): ",eo="AI: ",to="AITR_";function _sanitizeDiagnosticText$1(F){return F?'"'+F.replace(/\"/g,"")+'"':""}var no=function(){function _InternalLogMessage(F,B,G,W){void 0===G&&(G=!1);var z=this;z.messageId=F,z.message=(G?eo:Zr)+F;var K="";hasJSON$1()&&(K=getJSON$1().stringify(W));var J=(B?" message:"+_sanitizeDiagnosticText$1(B):"")+(W?" props:"+_sanitizeDiagnosticText$1(K):"");z.message+=J}return _InternalLogMessage.dataType="MessageData",_InternalLogMessage}();function safeGetLogger$1(F,B){return(F||{}).logger||new io(B)}var io=function(){function DiagnosticLogger(F){this.identifier="DiagnosticLogger",this.queue=[];var B=0,G={};dynamicProto(DiagnosticLogger,this,(function(W){function _getConfigValue(B,G){var W=F[B];return isNullOrUndefined$1(W)?G:W}function _areInternalMessagesThrottled(){return B>=W.maxInternalMessageLimit()}isNullOrUndefined$1(F)&&(F={}),W.consoleLoggingLevel=function(){return _getConfigValue("loggingLevelConsole",0)},W.telemetryLoggingLevel=function(){return _getConfigValue("loggingLevelTelemetry",1)},W.maxInternalMessageLimit=function(){return _getConfigValue("maxMessageLimit",25)},W.enableDebugExceptions=function(){return _getConfigValue("enableDebugExceptions",!1)},W.throwInternal=function(F,B,z,K,J){void 0===J&&(J=!1);var Q=new no(B,z,J,K);if(W.enableDebugExceptions())throw Q;if(!isUndefined$1(Q)&&Q&&!isUndefined$1(Q.message)){var Y=W.consoleLoggingLevel();if(J){var $=+Q.messageId;!G[$]&&Y>=Pr.WARNING&&(W.warnToConsole(Q.message),G[$]=!0)}else Y>=Pr.WARNING&&W.warnToConsole(Q.message);W.logInternalMessage(F,Q)}},W.warnToConsole=function(F){var B=getConsole$1();if(B){var G="log";B.warn&&(G="warn"),isFunction$1(B[G])&&B[G](F)}},W.resetInternalMessageCount=function(){B=0,G={}},W.logInternalMessage=function(F,z){if(!_areInternalMessagesThrottled()){var K=!0,J=to+z.messageId;if(G[J]?K=!1:G[J]=!0,K&&(F<=W.telemetryLoggingLevel()&&(W.queue.push(z),B++),B===W.maxInternalMessageLimit())){var Q="Internal events throttle limit per PageView reached for this app.",Y=new no(xr.MessageLimitPerPVExceeded,Q,!1);W.queue.push(Y),W.warnToConsole(Q)}}}}))}return DiagnosticLogger}(),ro="ctx",oo=function(){function PerfEvent(F,B,G){var W,z=this,K=!1;(z.start=dateNow$1(),z.name=F,z.isAsync=G,z.isChildEvt=function(){return!1},isFunction$1(B))&&(K=objDefineAccessors$1(z,"payload",(function(){return!W&&isFunction$1(B)&&(W=B(),B=null),W})));z.getCtx=function(F){return F?F===PerfEvent.ParentContextKey||F===PerfEvent.ChildrenContextKey?z[F]:(z[ro]||{})[F]:null},z.setCtx=function(F,B){if(F)if(F===PerfEvent.ParentContextKey)z[F]||(z.isChildEvt=function(){return!0}),z[F]=B;else if(F===PerfEvent.ChildrenContextKey)z[F]=B;else{(z[ro]=z[ro]||{})[F]=B}},z.complete=function(){var F=0,G=z.getCtx(PerfEvent.ChildrenContextKey);if(isArray$1(G))for(var W=0;W<G.length;W++){var J=G[W];J&&(F+=J.time)}z.time=dateNow$1()-z.start,z.exTime=z.time-F,z.complete=function(){},!K&&isFunction$1(B)&&(z.payload=B())}}return PerfEvent.ParentContextKey="parent",PerfEvent.ChildrenContextKey="childEvts",PerfEvent}(),ao="CoreUtils.doPerf";function doPerf$1(F,B,G,W,z){if(F){var K=F;if(K&&isFunction$1(K.getPerfMgr)&&(K=K.getPerfMgr()),K){var J=void 0,Q=K.getCtx(ao);try{if(J=K.create(B(),W,z)){if(Q&&J.setCtx&&(J.setCtx(oo.ParentContextKey,Q),Q.getCtx&&Q.setCtx)){var Y=Q.getCtx(oo.ChildrenContextKey);Y||(Y=[],Q.setCtx(oo.ChildrenContextKey,Y)),Y.push(J)}return K.setCtx(ao,J),G(J)}}catch(F){J&&J.setCtx&&J.setCtx("exception",F)}finally{J&&K.fire(J),K.setCtx(ao,Q)}}}return G()}var so=function(){function TelemetryPluginChain(F,B){var G=this,W=null,z=isFunction$1(F.processTelemetry),K=isFunction$1(F.setNextPlugin);G._hasRun=!1,G.getPlugin=function(){return F},G.getNext=function(){return W},G.setNext=function(F){W=F},G.processTelemetry=function(J,Q){Q||(Q=B);var Y=F?F.identifier:"TelemetryPluginChain";doPerf$1(Q?Q.core():null,(function(){return Y+":processTelemetry"}),(function(){if(F&&z){G._hasRun=!0;try{Q.setNext(W),K&&F.setNextPlugin(W),W&&(W._hasRun=!1),F.processTelemetry(J,Q)}catch(G){var B=W&&W._hasRun;W&&B||Q.diagLog().throwInternal(Pr.CRITICAL,xr.PluginException,"Plugin ["+F.identifier+"] failed during processTelemetry - "+G),W&&!B&&W.processTelemetry(J,Q)}}else W&&(G._hasRun=!0,W.processTelemetry(J,Q))}),(function(){return{item:J}}),!J.sync)}}return TelemetryPluginChain}();function _createProxyChain$1(F,B){var G=[];if(F&&F.length>0)for(var W=null,z=0;z<F.length;z++){var K=F[z];if(K&&isFunction$1(K.processTelemetry)){var J=new so(K,B);G.push(J),W&&W.setNext(J),W=J}}return G.length>0?G[0]:null}function _copyProxyChain$1(F,B,G){var W=[],z=!G;if(F)for(;F;){var K=F.getPlugin();(z||K===G)&&(z=!0,W.push(K)),F=F.getNext()}return z||W.push(G),_createProxyChain$1(W,B)}function _copyPluginChain$1(F,B,G){var W=F,z=!1;return G&&F&&(W=[],arrForEach$1(F,(function(F){(z||F===G)&&(z=!0,W.push(F))}))),G&&!z&&(W||(W=[]),W.push(G)),_createProxyChain$1(W,B)}var co=function(){function ProcessTelemetryContext(F,B,G,W){var z=this,K=null;null!==W&&(F&&isFunction$1(F.getPlugin)?K=_copyProxyChain$1(F,z,W||F.getPlugin()):W?K=_copyPluginChain$1(F,z,W):isUndefined$1(W)&&(K=_createProxyChain$1(F,z))),z.core=function(){return G},z.diagLog=function(){return safeGetLogger$1(G,B)},z.getCfg=function(){return B},z.getExtCfg=function(F,G){var W;if(void 0===G&&(G={}),B){var z=B.extensionConfig;z&&F&&(W=z[F])}return W||G},z.getConfig=function(F,G,W){var K;void 0===W&&(W=!1);var J=z.getExtCfg(F,null);return J&&!isNullOrUndefined$1(J[G])?K=J[G]:B&&!isNullOrUndefined$1(B[G])&&(K=B[G]),isNullOrUndefined$1(K)?W:K},z.hasNext=function(){return null!=K},z.getNext=function(){return K},z.setNext=function(F){K=F},z.processNext=function(F){var B=K;B&&(K=B.getNext(),B.processTelemetry(F,z))},z.createNew=function(F,W){return void 0===F&&(F=null),new ProcessTelemetryContext(F||K,B,G,W)}}return ProcessTelemetryContext}(),lo="extensionConfig",uo="getPlugin",po=function(){function BaseTelemetryPlugin(){var F=this,B=!1,G=null,W=null;F.core=null,F.diagLog=function(B){return F._getTelCtx(B).diagLog()},F.isInitialized=function(){return B},F.setInitialized=function(F){B=F},F.setNextPlugin=function(F){W=F},F.processNext=function(F,B){B?B.processNext(F):W&&isFunction$1(W.processTelemetry)&&W.processTelemetry(F,null)},F._getTelCtx=function(B){void 0===B&&(B=null);var z=B;if(!z){var K=G||new co(null,{},F.core);z=W&&W[uo]?K.createNew(null,W[uo]):K.createNew(null,W)}return z},F._baseTelInit=function(z,K,J,Q){z&&setValue$1(z,lo,[],null,isNullOrUndefined$1),!Q&&K&&(Q=K.getProcessTelContext().getNext());var Y=W;W&&W[uo]&&(Y=W[uo]()),F.core=K,G=new co(Q,z,K,Y),B=!0}}return BaseTelemetryPlugin.prototype.initialize=function(F,B,G,W){this._baseTelInit(F,B,G,W)},BaseTelemetryPlugin}(),ho=4294967296,go=4294967295,fo=!1,mo=123456789,vo=987654321;function _mwcSeed$1(F){F<0&&(F>>>=0),mo=123456789+F&go,vo=987654321-F&go,fo=!0}function _autoSeedMwc$1(){try{var F=2147483647&dateNow$1();_mwcSeed$1((Math.random()*ho^F)+F)}catch(F){}}function randomValue$1(F){return F>0?Math.floor(random32$1()/go*(F+1))>>>0:0}function random32$1(F){var B,G=getCrypto$1()||getMsCrypto$1();return G&&G.getRandomValues?B=G.getRandomValues(new Uint32Array(1))[0]&go:isIE$1()?(fo||_autoSeedMwc$1(),B=mwcRandom32$1()&go):B=Math.floor(ho*Math.random()|0),F||(B>>>=0),B}function mwcRandom32$1(F){var B=((vo=36969*(65535&vo)+(vo>>16)&go)<<16)+(65535&(mo=18e3*(65535&mo)+(mo>>16)&go))>>>0&go|0;return F||(B>>>=0),B}function newGuid$1(){function randomHexDigit(){return randomValue$1(15)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(So,(function(F){var B=0|randomHexDigit();return("x"===F?B:3&B|8).toString(16)}))}function perfNow$1(){var F=getPerformance$1();return F&&F.now?F.now():dateNow$1()}var yo,So=/[xy]/g,_o={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},Co={Normal:1,Critical:2};un(un({},xr),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520}),(yo={})[0]=_o.Unspecified,yo[2]=_o.Double,yo[1]=_o.String,yo[3]=_o.Bool,yo[4098]=_o.Double,yo[4097]=_o.String,yo[4099]=_o.Bool,Boolean(getDocument$1()),Boolean(getWindow$1());function getTenantId$1(F){if(F){var B=F.indexOf("-");if(B>-1)return F.substring(0,B)}return""}var To=perfNow$1;function setProcessTelemetryTimings$1(F,B){var G=F;G.timings=G.timings||{},G.timings.processTelemetryStart=G.timings.processTelemetryStart||{},G.timings.processTelemetryStart[B]=To()}var Eo=isFunction$1;function _createPromiseAllOnResolvedFunction(F,B,G){return function(W){F[B]=W,G()}}var bo=function(){function ESPromise(F){var B=0,G=null,W=[];function _enqueue(F,z,K,J){W.push((function(){var W;try{(W=1===B?Eo(F)?F(G):G:Eo(z)?z(G):G)instanceof ESPromise?W.then(K,J):2!==B||Eo(z)?K(W):J(W)}catch(F){return void J(F)}})),0!==B&&_processQueue()}function _processQueue(){if(W.length>0){var F=W.slice();W=[],setTimeout((function(){for(var B=0,G=F.length;B<G;++B)try{F[B]()}catch(F){}}),0)}}function _resolve(F){0===B&&(G=F,B=1,_processQueue())}function _reject(F){0===B&&(G=F,B=2,_processQueue())}dynamicProto(ESPromise,this,(function(F){F.then=function(F,B){return new ESPromise((function(G,W){_enqueue(F,B,G,W)}))},F.catch=function(B){return F.then(null,B)}})),function _initialize(){if(!Eo(F))throw new TypeError("ESPromise: resolvedFunc argument is not a Function");try{F(_resolve,_reject)}catch(F){_reject(F)}}()}return ESPromise.resolve=function(F){return F instanceof ESPromise?F:F&&Eo(F.then)?new ESPromise((function(B,G){try{F.then(B,G)}catch(F){G(F)}})):new ESPromise((function(B){B(F)}))},ESPromise.reject=function(F){return new ESPromise((function(B,G){G(F)}))},ESPromise.all=function(F){if(F&&F.length)return new ESPromise((function(B,G){try{for(var W=[],z=0,K=0;K<F.length;K++){var J=F[K];J&&Eo(J.then)?(z++,J.then(_createPromiseAllOnResolvedFunction(W,K,(function(){0==--z&&B(W)})),G)):W[K]=J}0===z&&setTimeout((function(){B(W)}),0)}catch(F){G(F)}}))},ESPromise.race=function(F){return new ESPromise((function(B,G){if(F&&F.length)try{for(var _loop_1=function(W){var z=F[W];z&&Eo(z.then)?z.then(B,G):setTimeout((function(){B(z)}),0)},W=0;W<F.length;W++)_loop_1(W)}catch(F){G(F)}}))},ESPromise}(),Io=6e5,Ao=0,Ro=[],Po=[],Oo=[];function _getTime(){return(new Date).getTime()}var Mo,wo=function(){function ESPromiseScheduler(F,B){var G=0,W=(F||"<unnamed>")+"."+Ao;function _debugLog(F){var B=getGlobal$2();B&&B.QUnit&&console&&console.log("ESPromiseScheduler["+W+"] "+F)}function _warnLog(F){B&&B.warnToConsole("ESPromiseScheduler["+W+"] "+F)}Ao++,dynamicProto(ESPromiseScheduler,this,(function(F){var B=null,z=0;function _removeQueuedEvent(F,B){for(var G=0;G<F.length;G++)if(F[G].id===B)return F.splice(G,1)[0];return null}F.scheduleEvent=function(F,K,J){var Q=W+"."+z;z++,K&&(Q+="-("+K+")");var Y=Q+"{"+G+"}";G++;var $={evt:null,tm:_getTime(),id:Y,isRunning:!1,isAborted:!1};return $.evt=B?_waitForPreviousEvent($,B):_startWaitingEvent($),(B=$).evt._schId=Y,$.evt;function _abortAndRemoveOldEvents(F){for(var B=_getTime(),G=B-Io,W=F.length,z=0;z<W;){var K=F[z];if(K&&K.tm<G){var J=null;K.abort?(J="Aborting ["+K.id+"] due to Excessive runtime ("+(B-K.tm)+" ms)",K.abort(J)):J="Removing ["+K.id+"] due to Excessive runtime ("+(B-K.tm)+" ms)",_warnLog(J),F.splice(z,1),W--}else z++}}function _cleanup(F,G){var W=!1,z=_removeQueuedEvent(Ro,F);if(z||(z=_removeQueuedEvent(Oo,F),W=!0),z){z.to&&(clearTimeout(z.to),z.to=null);var K=_getTime()-z.tm;G?W?_warnLog("Timed out event ["+F+"] finally complete -- "+K+" ms"):_debugLog("Promise ["+F+"] Complete -- "+K+" ms"):(Oo.push(z),_warnLog("Event ["+F+"] Timed out and removed -- "+K+" ms"))}else _debugLog("Failed to remove ["+F+"] from running queue");B&&B.id===F&&(B=null),_abortAndRemoveOldEvents(Ro),_abortAndRemoveOldEvents(Po),_abortAndRemoveOldEvents(Oo)}function _removeScheduledEvent(F,B){return function(G){return _cleanup(F,!0),B&&B(G),G}}function _waitForFinalResult(F,B,G,W){B.then((function(B){return B instanceof bo?(_debugLog("Event ["+F+"] returned a promise -- waiting"),_waitForFinalResult(F,B,G,W),B):_removeScheduledEvent(F,G)(B)}),_removeScheduledEvent(F,W))}function _createScheduledEvent(F,B){var G=F.id;return new bo((function(W,z){_debugLog("Event ["+G+"] Starting -- waited for "+(F.wTm||"--")+" ms"),F.isRunning=!0,F.abort=function(B){F.abort=null,F.isAborted=!0,_cleanup(G,!1),z(new Error(B))};var K=B(G);K instanceof bo?(J&&(F.to=setTimeout((function(){_cleanup(G,!1),z(new Error("Timed out after ["+J+"] ms"))}),J)),_waitForFinalResult(G,K,(function(B){_debugLog("Event ["+G+"] Resolving after "+(_getTime()-F.tm)+" ms"),W(B)}),z)):(_debugLog("Promise ["+G+"] Auto completed as the start action did not return a promise"),W())}))}function _startWaitingEvent(B){var G=_getTime();return B.wTm=G-B.tm,B.tm=G,B.isAborted?bo.reject(new Error("["+Q+"] was aborted")):(Ro.push(B),_createScheduledEvent(B,F))}function _waitForPreviousEvent(F,B){var G=new bo((function(G,W){var z=_getTime()-B.tm,K=B.id;_debugLog("["+Q+"] is waiting for ["+K+":"+z+" ms] to complete before starting -- ["+Po.length+"] waiting and ["+Ro.length+"] running"),F.abort=function(B){F.abort=null,_removeQueuedEvent(Po,Q),F.isAborted=!0,W(new Error(B))},B.evt.then((function(B){_removeQueuedEvent(Po,Q),_startWaitingEvent(F).then(G,W)}),(function(B){_removeQueuedEvent(Po,Q),_startWaitingEvent(F).then(G,W)}))}));return Po.push(F),G}}}))}return ESPromiseScheduler.incomplete=function(){return Ro},ESPromiseScheduler.waitingToStart=function(){return Po},ESPromiseScheduler}();function isValidPersistenceLevel(F){return isNumber$1(F)&&F>=Co.Normal&&F<=Co.Critical}!function(F){F[F.LocalStorage=1]="LocalStorage",F[F.SessionStorage=2]="SessionStorage",F[F.IndexedDb=3]="IndexedDb"}(Mo||(Mo={}));var Do=10,No="3",Lo="Version",ko=6e5,Fo="AWTEvents",xo=5e6,Uo=1,jo=2;function _isQuotaExceeded(F,B){var G=!1;return B instanceof DOMException&&(22!==B.code&&"QuotaExceededError"!==B.name&&1014!==B.code&&"NS_ERROR_DOM_QUOTA_REACHED"!==B.name||F&&0!==F.length&&(G=!0)),G}function _getAvailableStorage(F){var B=getGlobal$2()||{},G=null;try{if(G=B[F]){var W="__storage_test__";G.setItem(W,W),G.removeItem(W)}}catch(F){_isQuotaExceeded(G,F)||(G=null)}return G}function _forEachMap(F,B){if(F)for(var G=objKeys$1(F),W=0;W<G.length;W++){var z=G[W];if(!B(F[z],z))break}}function _isMapEmpty(F){var B=!0;return _forEachMap(F,(function(F,G){return F&&(B=!1),B})),B}function _dropEventsUpToPersistence(F,B){for(var G=Uo,W=0,_loop_1=function(){var F=[],z=B[G];if(_forEachMap(z,(function(B,G){return F.push(G),++W<Do})),W>0){for(var K=0;K<F.length;K++)delete z[F[K]];return{value:!0}}G++};G<=F&&W<Do;){var z=_loop_1();if("object"==typeof z)return z.value}return W>0}var Bo=isValidPersistenceLevel,Ho=function(){function WebStorageProvider(F,B){dynamicProto(WebStorageProvider,this,(function(G){var W=null,z=Fo,K=null,J=No,Q=null,Y=null,$=xo,X=null,Z=null;function _newStore(F,B){return{key:F,db:B}}function _fetchStoredDb(F,B){void 0===B&&(B=!0);var G=null;if(W){var z=W.getItem(F);if(z)try{G=JSON.parse(z)}catch(B){W.removeItem(F)}}return B&&!G&&(G={events:{1:{},2:{},3:{}},lastAccessTime:0}),_newStore(F,G)}function _updateStoredDb(F,B){void 0===B&&(B=!0);var G=!0,z=F.db;if(z){B&&(z.lastAccessTime=(new Date).getTime());for(var K=Uo;K<=jo;K++)if(!_isMapEmpty(z.events[K])){G=!1;break}}try{if(G)W&&W.removeItem(F.key);else{var J=JSON.stringify(z);if(J.length>$)return!1;W&&W.setItem(F.key,J)}}catch(F){return!1}return!0}function _clearDatabase(F){var B=[],G=_fetchStoredDb(F,!1),z=G.db;if(z){var K=z.events;try{for(var J=Uo;J<=jo;J++)_forEachMap(K[J],(function(F,G){return F&&B.push(F),!0}))}catch(F){}W&&W.removeItem(G.key)}return B}function _checkVersionAndMoveEventsToCurrentStorage(){if(W){for(var F=W.getItem(X),B=[],G=_fetchStoredDb(Z),K=!1,Q=0;Q<W.length;Q++){var $=W.key(Q);if(0===$.indexOf(z)&&$!==X){if(F!==No){B.push(_newStore($,null));continue}var ee=_fetchStoredDb($,!1),te=ee.db;if(te){if((new Date).getTime()-te.lastAccessTime>ko){for(var ne=Uo,_loop_3=function(){var F=te.events[ne],B=G.db.events[ne];_forEachMap(F,(function(G,W){return(getTenantId$1(G.iKey)||G.iKey)===Y&&(B[W]=G,delete F[W]),!0})),ne++};ne<=jo;)_loop_3();K=!0,B.push(ee)}}else B.push(_newStore($,null))}}for(Q=0;Q<B.length;Q++)_updateStoredDb(B[Q],!1);K&&_updateStoredDb(G),W.setItem(X,J)}}G.id=B,W=_getAvailableStorage(F)||null,G.initialize=function(F){if(!W)return!1;var B=F.storageConfig||{};return $=B.maxStorageSizeInBytes>0?B.maxStorageSizeInBytes:$,z=B.storageKey||Fo,K=G.id||F.id||newGuid$1(),Z=z+"."+K,X=z+Lo,Q=F.itemCtx.getCfg().instrumentationKey,Y=getTenantId$1(Q)||Q,_checkVersionAndMoveEventsToCurrentStorage(),!0},G.supportsSyncRequests=function(){return!0},G.getAllEvents=function(){try{var F=[],B=_fetchStoredDb(Z,!1).db;if(B)for(var G=B.events,W=jo;W>=Uo;W--)_forEachMap(G[W],(function(B){B&&((getTenantId$1(B.iKey)||B.iKey)===Y&&F.push(B));return!0}));return bo.resolve(F)}catch(F){return bo.reject(F)}},G.addEvent=function(F,B,G){try{var W=_fetchStoredDb(Z);B.id=B.id||newGuid$1(),Bo(B.persistence)||(B.persistence=Uo);for(var z=B.persistence,K=B.id,J=W.db.events;;){if(J[z][K]=B,_updateStoredDb(W))return bo.resolve(B);if(delete J[z][K],!_dropEventsUpToPersistence(z,J))return bo.reject(new Error("Unable to free up event space"))}}catch(F){return bo.reject(F)}},G.removeEvents=function(F){try{var B=_fetchStoredDb(Z,!1),G=B.db;if(G){var W=G.events;try{for(var z=0;z<F.length;++z){var K=F[z];delete W[K.persistence][K.id]}if(_updateStoredDb(B))return bo.resolve(F)}catch(F){}F=_clearDatabase(B.key)}return bo.resolve(F)}catch(F){return bo.reject(F)}},G.clear=function(){try{var F=[],B=_fetchStoredDb(Z,!1),G=B.db;if(G){for(var W=G.events,_loop_2=function(B){var G=W[B];_forEachMap(G,(function(B){B&&((getTenantId$1(B.iKey)||B.iKey)===Y&&(delete G[B.id],F.push(B)));return!0}))},z=jo;z>=Uo;z--)_loop_2(z);_updateStoredDb(B)}return bo.resolve(F)}catch(F){return bo.reject(F)}},G.teardown=function(){try{var F=_fetchStoredDb(Z,!1),B=F.db;B&&(B.lastAccessTime=0,_updateStoredDb(F,!1))}catch(F){}}}))}return WebStorageProvider}(),Vo="readwrite",Go="result",Wo="DBError: Unable to open database",qo="Database is not open",zo="DBError: Failed to Open Cursor",Ko="DBError: Failed to delete the database",Jo="DBError: Database does not exist",Qo="DBError: Database upgrade required",Yo="DBError: Feature not supported",$o=["indexedDB"],Xo=isFunction$1,Zo=isString$1;function _getDbFactory(){var F=getGlobal$2()||{},B=null;if(F)try{for(var G=0;G<$o.length;G++)if((B=F[$o[G]])&&Xo(B.open))return B}catch(F){B=null}return B||null}function _debugLog(F,B){getGlobalInst$1("QUnit")&&console&&console.log("IndexedDbHelper ["+F+"] "+B)}function _warnLog(F,B,G){F&&F.warnToConsole("IndexedDbHelper ["+B+"] "+G)}function _eventReject(F,B,G,W){return function(z){G(new Error(B)),_debugLog(F,"["+W+"] event rejected")}}var ea=[];function _getDbContext(F,B){for(var G=null,W=0;W<ea.length;W++)if((G=ea[W]).name===F)return G;return G={name:F,sch:new wo("IndexedDbHelper["+F+"]",B),dbHdl:[],add:function(B){G.dbHdl.push(B),_debugLog(F,"- dbOpened (add) -- hdls ["+G.dbHdl.length+"]")},remove:function(B){for(var W=G.dbHdl,z=0;z<W.length;z++)if(W[z]===B){W.splice(z,1);break}_debugLog(F,"- dbClosed (remove) -- hdls ["+G.dbHdl.length+"]")},isOpen:function(){return G.dbHdl.length>0},openHdl:function(){return G.dbHdl.length>0?G.dbHdl[0]:null}},ea.push(G),G}var ta=function(){function IndexedDbHelper(F){dynamicProto(IndexedDbHelper,this,(function(B){var G=_getDbFactory()||null;function _createStoreContext(B,G){var W=B.db.transaction(G,Vo);return W.onabort=function(){_warnLog(F,B.dbName,"txn.onabort")},W.onerror=function(){_warnLog(F,B.dbName,"txn.onerror")},W.oncomplete=function(){_debugLog(B.dbName,"txn.oncomplete")},{db:B,store:W.objectStore(G),tx:W,tbl:G,openCursor:function(F,W){return _openCursor(B,G,F,W)},newTransaction:function(F){return _openStore(B,G,F)}}}function _openStore(F,B,G){if(!F||!F.db)return bo.reject(new Error(qo));try{var W=G(_createStoreContext(F,B));return W instanceof bo?W:bo.resolve(W)}catch(F){return bo.reject(F)}}function _openCursor(F,B,G,W){if(!F||!F.db)return bo.reject(new Error(qo));var z=null;return G&&Zo(G)?z=new na(G):G&&G.isMatch&&(z=G),new bo((function(G,K){var J=[],Q=null,Y=null;z&&z.keyRange&&(Y=z.keyRange());var $=_createStoreContext(F,B);(Q=Y?$.store.openCursor(Y):$.store.openCursor()).onerror=_eventReject($.db.dbName,zo,K,"openCursor"),Q.onsuccess=function(F){var B=F.target[Go];if(B){var Q={store:$,cursor:B,continue:function(){B.continue()},done:function(){G(J)}},Y=B.value;if(!z||z.isMatch(Y))if(W)try{switch(W(Q,Y,J)){case 2:G(J);break;case 1:break;default:Q.continue()}}catch(F){K(F)}else J.push(Y),Q.continue();else Q.continue()}else G(J)}}))}function _scheduleEvent(F,B,G,W){return _getDbContext(F).sch.scheduleEvent(G,B,W)}B.isAvailable=function(){return!!G},B.openDb=function(B,W,z,K){return _scheduleEvent(B,"openDb",(function(J){return new bo((function(Q,Y){var $=!1;function _createDbCtx(F,G,z,K,J){var Q={db:G,dbName:B,dbVersion:W,ctx:null,isNew:K,txn:z?z.transaction:null};return J||(Q.openStore=function(F,B){return _openStore(Q,F,B)},Q.openCursor=function(F,B,G){return _openCursor(Q,F,B,G)}),Q}function _databaseUpgrade(F,B){var G=_createDbCtx(null,F,B,!0,!0);if(K)$=!0,K(G).then((function(){G.txn||(G.txn=B.transaction)}),(function(F){try{B.transaction&&B.transaction.abort()}finally{Y(F)}}));else try{B.transaction&&B.transaction.abort()}finally{Y(new Error(Qo))}}function _databaseOpen(G,W){var K=_getDbContext(B);K.add(G),G.onabort=function(W){_warnLog(F,B,"onabort -- closing the Db"),K.remove(G)},G.onerror=function(W){_warnLog(F,B,"onerror -- closing the Db"),K.remove(G)},G.onclose=function(W){_warnLog(F,B,"onclose -- closing the Db"),K.remove(G)},G.onversionchange=function(W){_warnLog(F,B,"onversionchange -- force closing the Db"),G.close(),K.remove(G)};var J=null,X=null;K.dbHdl.length>0&&(X=K.dbHdl[0]),J=_createDbCtx(K,X,W,$);try{z(J).then((function(F){Q(F)}),Y)}catch(F){Y(F)}}var X=_getDbContext(B);if(null==G)Y(new Error("No available storage factory"));else if(X.isOpen()){var Z=_createDbCtx(X,X.openHdl(),null,!1);z(Z).then(Q,Y)}else{var ee=G.open(B,W);ee.onblocked=function(G){_warnLog(F,B,"Db Open Blocked event ["+J+"] - "+(ee.error||"")),Y(new Error(Wo))},ee.onerror=function(G){_warnLog(F,B,"Db Open Error event ["+J+"] - "+(ee.error||"")),Y(new Error(Wo))},ee.onupgradeneeded=function(F){_debugLog(B,"Db Open Create/Upgrade needed event ["+J+"]");try{var G=F.target[Go];if(!G)return void Y(new Error(Wo));_databaseUpgrade(G,ee)}catch(F){_eventReject(B,Wo,Y,J)(F)}},ee.onsuccess=function(F){var B=F.target[Go];B?_databaseOpen(B,ee):Y(new Error(Wo))}}}))}))},B.closeDb=function(F){_scheduleEvent(F,"closeDb",(function(B){var G=_getDbContext(F),W=G.dbHdl,z=W.length;if(z>0){for(var K=0;K<z;K++)W[K].close();G.dbHdl=[]}return bo.resolve(1)}))},B.deleteDb=function(B){return null==G?bo.resolve(!1):_scheduleEvent(B,"deleteDb",(function(W){var z=_getDbContext(B),K=z.dbHdl,J=K.length;if(J>0){_warnLog(F,B,"Db is open ["+J+"] force closing");for(var Q=0;Q<J;Q++)K[Q].close();z.dbHdl=[]}return new bo((function(z,K){setTimeout((function(){try{_debugLog(B,"["+W+"] starting");var J=G.deleteDatabase(B);J.onerror=function(G){_warnLog(F,B,"["+W+"] error!!"),K(new Error(Ko))},J.onblocked=function(G){_warnLog(F,B,"["+W+"] blocked!!"),K(new Error(Ko))},J.onupgradeneeded=function(G){_warnLog(F,B,"["+W+"] upgrade needed!!"),K(new Error(Ko))},J.onsuccess=function(F){_debugLog(B,"["+W+"] complete"),z(!0)},_debugLog(B,"["+W+"] started")}catch(G){_warnLog(F,B,"["+W+"] threw - "+G),K(new Error(Ko+" - "+G))}}),0)}))}))},B.getDbDetails=function(F){return _scheduleEvent(F,"getDbDetails",(function(B){return null!=G&&G.databases?new bo((function(B,W){G.databases().then((function(G){for(var z=0;z<G.length;z++)if(G[z].name===F)return void B(G[z]);W(new Error(Jo))}),W)})):bo.reject(new Error(Yo))}),2e3)}}))}return IndexedDbHelper}(),na=function(){function SimpleQuery(F){var B=[],G=null;dynamicProto(SimpleQuery,this,(function(W){W.keyRange=function(){return G},W.parseQuery=function(F){if(B=[],F)for(var z=F.split(";"),K=0;K<z.length;K++){var J=z[K],Q=J.indexOf("=");if(-1!==Q){var Y=J.substring(0,Q),$=J.substring(Q+1);0===Y.indexOf("#")&&(Y=Y.substring(1),G||(G=IDBKeyRange.bound($,$+"￿"))),W.startsWith(Y,$)}}},W.startsWith=function(F,G){B.push({name:F,value:G,type:0})},W.contains=function(F,G){B.push({name:F,value:G,type:1})},W.isMatch=function(F){if(!B||0===B.length)return!0;if(!F)return!1;for(var G=0;G<B.length;G++){var W=B[G],z=F[W.name];if(z)if(0===W.type){if(0!==z.indexOf(W.value))return!1}else if(1===W.type&&-1===z.indexOf(W.value))return!1}return!0},F&&W.parseQuery(F)}))}return SimpleQuery}(),ia=10,ra=1,oa=6e5,aa=1008e4,sa="Unknown",ca=-1,la="DBError: Unable to add event",da="DBError: Unable to update iKey",ua="AppInsightEvents.1",pa=1,ha="Evts",ga="iKey",fa=isValidPersistenceLevel;function _getTime$1(){return(new Date).getTime()}function _eventReject$1(F,B){return function(G){return B(new Error(F))}}function _createDb(F){F.objectStoreNames.contains(ha)||F.createObjectStore(ha,{keyPath:"key"}).createIndex("EvntId","key",{unique:!1});F.objectStoreNames.contains(ga)||F.createObjectStore(ga,{keyPath:"iKey"}).createIndex("iKey","iKey",{unique:!0})}function _updateiKey(F){return F.openStore(ga,(function(B){return new bo((function(G,W){var z={iKey:F.ctx.iKey,tm:_getTime$1()},K=B.store.put(z);K.onsuccess=function(F){G(K.result.toString())},K.onerror=function(F){W(new Error(la))},K.onerror=_eventReject$1(da,W)}))}))}function _orderEventsByPriority(F){for(var B=[],G=Co.Critical;G>=Co.Normal;G--)for(var W=0;W<F.length;W++){var z=F[W];z&&z.evt.persistence===G&&B.push(z.evt)}return B}function _addEventByTime(F,B){for(var G=0;G<F.length;G++)if(B.tm<F[G].tm)return void F.splice(G,0,B);F.push(B)}function _getKeyIndex(F,B){for(var G=B.length,W=0;W<G;W++)if(F===B[W].id)return W;return-1}function _isOldItem(F,B){var G=F.tm;return _getTime$1()-G>B}function _cursorContinueEvent(F){return function(B){return F.continue()}}function _cursorDeleteAndContinue(F){var B=F.cursor.delete();return B.onerror=_cursorContinueEvent(F),B.onsuccess=_cursorContinueEvent(F),1}function _getAllEventsForiKey(F,B){return F.openCursor(ha,B,(function(F,B,G){return G.push(B),0}))}function _deleteEvents(F,B,G){return F.openCursor(ha,B,(function(F,B,W){return G(B)?(W.push(B),_cursorDeleteAndContinue(F)):0}))}function _deleteOrphanedEvents(F){return new bo((function(B,G){var W=!1;F.openCursor(ga,null,(function(F,B,G){var z=B.tm;return _getTime$1()-z<aa?0:(W=!0,2)})).then((function(){if(W){var z={};_deleteEvents(F,null,(function(F){if(!F||!F.evt||!F.evt.iKey)return!0;var B=F.tm;return _getTime$1()-B>aa||(z[F.evt.iKey]=1,!1)})).then((function(){var W=[];F.openCursor(ga,null,(function(F,B,G){var K=B.tm;return _getTime$1()-K<aa||z[B.iKey]?0:(W.push(B),_cursorDeleteAndContinue(F))})).then((function(){B(W)}),G)}),G)}else B([])}),G)}))}function _moveOldEventsToCurrentStore(F){return F.openCursor(ha,"#key="+F.ctx.iKeyPrefix(),(function(B,G){var W=G.key;if(0===W.indexOf(F.ctx.iKeyPrefix())&&-1===W.indexOf(F.ctx.evtKeyPrefix())&&_isOldItem(G,oa)){G.key=F.ctx.evtKeyPrefix()+G.id;var z=B.store.store.put(G);return z.onerror=_cursorContinueEvent(B),z.onsuccess=function(F){try{_cursorDeleteAndContinue(B)}catch(F){B.continue()}},1}return 0}))}function _checkVersionAndMoveEventsToCurrentStorage(F){return new bo((function(B,G){_deleteOrphanedEvents(F).then((function(){_moveOldEventsToCurrentStore(F).then(B,B)}),G)}))}function _dropEventsUpToPersistence$1(F,B){return new bo((function(G,W){var z=0,K=F.ctx.evtKeyPrefix();function _resolveWithDroppedEvents(){G(z)}function _dropEvent(F,B){return new bo((function(G){var W=F.store.delete(B.key);W.onsuccess=function(F){z++,G()},W.onerror=function(F){G()}}))}function _processCandidates(B){0!==B.length?F.openStore(ha,(function(F){for(var G=[],W=0;W<B.length;W++)G.push(_dropEvent(F,B[W]));return bo.all(G).then(_resolveWithDroppedEvents,_resolveWithDroppedEvents)})):_resolveWithDroppedEvents()}F.openCursor(ha,"#key="+K,(function(F,G,W){return G.evt.persistence<=B&&0===G.key.indexOf(K)&&(_addEventByTime(W,G),W.length>ia&&W.splice(W.length-1,1)),0})).then(_processCandidates,(function(){G(0)}))}))}var ma=function(){function IndexedDbProvider(F){dynamicProto(IndexedDbProvider,this,(function(B){var G=null,W=null,z=sa,K=null,J=null,Q=null,Y=ca,$=0;function _openDb(F){function _handleDbUpgrade(F){return new bo((function(B,G){_createDb(F.db),B()}))}function _handleDbOpen(B){return new bo((function(G,W){var Y={iKey:z,storageId:K,iKeyPrefix:function(){return J},evtKeyPrefix:function(){return Q}};B.ctx=Y,_updateiKey(B).then((function(){F(B).then(G,W)}),W)}))}return G.openDb(W,pa,_handleDbOpen,_handleDbUpgrade)}function _addDbEvent(F,B,G){return new bo((function(W,z){function dropEvents(B,G){_dropEventsUpToPersistence$1(F,B).then((function(F){F>0&&($-=F),G(F)}),(function(F){G(0)}))}function resolveAddEvent(F){W(B.evt)}function _insertNewEvent(){F.openStore(ha,(function(K){var J=K.store.put(B);J.onsuccess=function(z){G&&_updateiKey(F).then(resolveAddEvent,resolveAddEvent),$++,W(B.evt)},J.onerror=function(K){function _retryAddEvent(G){0===G&&z(new Error(la)),_addDbEvent(F,B,!1).then((function(F){W(B.evt)}),(function(){z(new Error(la))}))}G?dropEvents(Co.Normal,(function(F){F>0?_retryAddEvent(F):B.evt.persistence>=Co.Critical?dropEvents(Co.Critical,(function(F){_retryAddEvent(F)})):z(new Error(la))})):z(new Error(la))}}))}Y>0&&$>=Y?dropEvents(Co.Normal,(function(F){0===F?B.evt.persistence>=Co.Critical?dropEvents(Co.Critical,(function(F){_insertNewEvent()})):z(new Error(la)):_insertNewEvent()})):_insertNewEvent()}))}B.id=F,B.initialize=function(F){var $=F.itemCtx.diagLog();if(!(G=new ta($)).isAvailable())return G=null,!1;var X=F.itemCtx.getCfg(),Z=F.storageConfig||{};return W=Z.indexedDbName||ua,z=X.instrumentationKey||z,K=B.id||F.id||newGuid$1(),Q=(J=z+"::")+K+"::",Y=Z.maxStorageItems>0?Z.maxStorageItems:Y,_openDb((function(F){return F.isNew?bo.resolve(!0):_checkVersionAndMoveEventsToCurrentStorage(F)})).then((function(F){}),(function(F){$.warnToConsole("IndexedDbProvider failed to initialize - "+(F||"<unknown>")),G=null})),!0},B.supportsSyncRequests=function(){return!1},B.getAllEvents=function(){return null!=G&&G.isAvailable()?_openDb((function(F){return new bo((function(B,G){_getAllEventsForiKey(F,"#key="+F.ctx.evtKeyPrefix()).then((function(F){$=F.length,B(_orderEventsByPriority(F))}),G)}))})):bo.resolve([])},B.addEvent=function(F,B,W){return null!=G&&G.isAvailable()?(B.id=B.id||newGuid$1(),fa(B.persistence)||(B.persistence=Co.Normal),_openDb((function(G){var W=F||B.id,z={key:G.ctx.evtKeyPrefix()+W,id:W,evt:B,tm:_getTime$1(),v:ra};return _addDbEvent(G,z,!0)}))):bo.resolve(B)},B.removeEvents=function(F){if(null==G||!G.isAvailable())return bo.resolve([]);var B=[];return new bo((function(G,W){_openDb((function(G){return G.openCursor(ha,"#key="+G.ctx.iKey,(function(G,W,z){if(-1!==_getKeyIndex(W.id,F)){var K=G.cursor.delete();return K.onerror=_cursorContinueEvent(G),K.onsuccess=function(){B.push(W.evt),G.continue()},1}return 0}))})).then((function(F){$-=B.length,G(B)}),(function(F){$-=B.length,G(B)}))}))},B.clear=function(){return null!=G&&G.isAvailable()?new bo((function(F,B){_openDb((function(F){return _deleteEvents(F,"#key="+F.ctx.evtKeyPrefix(),(function(B){return 0===B.key.indexOf(F.ctx.evtKeyPrefix())}))})).then((function(B){$=0,F(_orderEventsByPriority(B))}),B)})):bo.resolve([])},B.teardown=function(){G&&G.closeDb(W)}}))}return IndexedDbProvider}(),va="3.1.3",ya="LocalStorage",Sa=5,_a=isValidPersistenceLevel,Ca=function(F){function LocalStorageChannel(){var B=F.call(this)||this;return B.identifier=ya,B.priority=1009,B.version=va,dynamicProto(LocalStorageChannel,B,(function(F,B){var G=!1,W=!1,z=null,K=[];function _queueStorageEvent(F,B){z||(z=new wo("LocalStorage")),z.scheduleEvent((function(F){return B(F)}),F)}function _sendStoredEventsToNextPlugin(B){doPerf$1(F.core,(function(){return"LocalStorageChannel:_sendStoredEventsToNextPlugin"}),(function(){_queueStorageEvent("sendToNext",(function(G){return B.provider.getAllEvents().then((function(G){for(var W=0;W<G.length;W++)try{var z=G[W];(getTenantId$1(z.iKey)||z.iKey)===B.tenantId&&F.processNext(z,B.coreRootCtx.createNew())}catch(F){}}))}))}),(function(){return{iKeyConfig:B}}))}function _removeEvents(B,G){doPerf$1(F.core,(function(){return"LocalStorageChannel:_removeEvents"}),(function(){_queueStorageEvent("removeEvents",(function(F){var W=[];return arrForEach$1(G,(function(F){(getTenantId$1(F.iKey)||F.iKey)===B.tenantId&&W.push(F)})),W.length>0?B.provider.removeEvents(W).then((function(F){})).catch((function(F){})):bo.resolve()}))}),(function(){return{iKeyConfig:B,events:G}}))}function _shouldCacheEvent(F,B){return!(B.sync||B.persistence<F.minPersistenceCacheLevel)}function _tryGetIndexedDbProvider(F){var B=new ma;return B.initialize(F)||(B=null),B}function _tryGetWebStorageProvider(F,B){var G=new Ho(F);return G.initialize(B)||(G=null),G}function _initializeProvider(F){for(var B=F.storageConfig.providers,G=null,W=0;!G&&W<B.length&&W<Sa;)switch(B[W++]){case Mo.LocalStorage:G=_tryGetWebStorageProvider("localStorage",F);break;case Mo.SessionStorage:G=_tryGetWebStorageProvider("sessionStorage",F);break;case Mo.IndexedDb:G=_tryGetIndexedDbProvider(F)}return G}function _getCoreItemCtx(B,G,W,z){B&&(B.extensionConfig=B.extensionConfig||[]),!z&&G&&(z=G.getProcessTelContext().getNext());var K=null,J=F._getTelCtx().getNext();return J&&(K=J.getPlugin()),new co(z,B,G,K)}function _createIkeyConfig(B,G,W,z){var J=F.identifier,Q=B.extensionConfig=B.extensionConfig||[],Y=Q[J]=Q[J]||{};Y.providers||(Y.providers=[Mo.LocalStorage,Mo.IndexedDb]);var $=_getCoreItemCtx(B,G,W,z),X={itemCtx:$,storageConfig:Y,id:F.id},Z=_initializeProvider(X);if(Z){var ee={iKey:B.instrumentationKey,tenantId:getTenantId$1(B.instrumentationKey)||B.instrumentationKey,minPersistenceCacheLevel:Co.Normal,coreRootCtx:$,providerContext:X,provider:Z};_a(Y.minPersistenceLevel||-1)&&(ee.minPersistenceCacheLevel=Y.minPersistenceLevel),K.push(ee),G.addNotificationListener({eventsSent:function(F){_removeEvents(ee,F)},eventsDiscarded:function(F,B){_removeEvents(ee,F)}}),_sendStoredEventsToNextPlugin(ee)}}F.initialize=function(F,W,K,J){doPerf$1(W,(function(){return"LocalStorageChannel.initialize"}),(function(){G||(B.initialize(F,W,K),B.setInitialized(!1),G=!0,z=new wo("LocalStorage",W.logger)),_createIkeyConfig(F,W,K,J)}),(function(){return{coreConfig:F,core:W,extensions:K,pluginChain:J}}))},F.processTelemetry=function(B,G){G=F._getTelCtx(G),setProcessTelemetryTimings$1(B,F.identifier);var z=null;arrForEach$1(K,(function(F){F.iKey===B.iKey&&(z=F)}));var J=W,Q=z?z.provider:null,Y=B;!Y.sync&&Q?(Y.id=Y.id||newGuid$1(),isValidPersistenceLevel(Y.persistence)||(Y.persistence=1),_shouldCacheEvent(z,Y)&&_queueStorageEvent("processTelemetry",(function(F){return Q.addEvent(Y.id,Y,G)})),J||F.processNext(Y,G)):F.processNext(Y,G)},F.pause=function(){W=!0},F.resume=function(){doPerf$1(F.core,(function(){return"LocalStorageChannel:resume"}),(function(){W=!1,arrForEach$1(K,(function(F){F.provider&&_sendStoredEventsToNextPlugin(F)}))}))},F.teardown=function(){arrForEach$1(K,(function(F){var B=F.provider;B&&B.teardown()})),K=[]},F.flush=function(F,B){}})),B}return __extendsFn(LocalStorageChannel,F),LocalStorageChannel}(po),Ta="REAL_TIME",Ea="NEAR_REAL_TIME",ba="BEST_EFFORT",Ia=function(){function EventBatch(F,B){var G=B?[].concat(B):[],W=this;W.iKey=function(){return F},W.count=function(){return G.length},W.events=function(){return G},W.addEvents=function(F,B){return void 0===B&&(B=!0),F&&F.length>0?(G=B?G.concat(F):F.concat(G),F.length):0},W.split=function(B,W){var z=new EventBatch(F);if(B<G.length){var K=G.length-B;isNullOrUndefined(W)||(K=W<K?W:K),z.addEvents(G.splice(B,K),!0)}return z}}return EventBatch.create=function(F,B){return new EventBatch(F,B)},EventBatch}(),Aa=20,Ra=3984588,Pa=65e3,Oa=2e6,Ma=Math.min(Oa,Pa),wa="metadata",Da="f",Na=/\./,La=function(){function Serializer(F,B,G,W){var z="data",K="baseData",J="ext",Q=!!W,Y=!0,$=B,X={};dynamicProto(Serializer,this,(function(B){function _isReservedField(F,B){var G=X[F];return void 0===G&&(F.length>=7&&(G=strStartsWith(F,"ext.metadata")||strStartsWith(F,"ext.web")),X[F]=G),G}function _processPathKeys(F,B,W,z,K,J,Y){objForEachKey(F,(function(F,X){var Z=null;if(X||isValueAssigned(X)){var ee=W,te=F,ne=K,ie=B;if(Q&&!z&&Na.test(F)){var re=F.split("."),oe=re.length;if(oe>1){ne&&(ne=ne.slice());for(var ae=0;ae<oe-1;ae++){var se=re[ae];ie=ie[se]=ie[se]||{},ee+="."+se,ne&&ne.push(se)}te=re[oe-1]}}if(Z=!(z&&_isReservedField(ee))&&$&&$.handleField(ee,te)?$.value(ee,te,X,G):sanitizeProperty(te,X,G)){var ce=Z.value;if(ie[te]=ce,J&&J(ne,te,Z),Y&&"object"==typeof ce&&!isArray(ce)){var le=ne;le&&(le=le.slice()).push(te),_processPathKeys(X,ce,ee+"."+te,z,le,J,Y)}}}}))}B.createPayload=function(F,B,G,W,z){return{apiKeys:[],payloadBlob:"",overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:F,isTeardown:B,isSync:G,isBeacon:W,sendReason:z}},B.appendPayload=function(G,W,z){var K=G&&W&&!G.overflow;return K&&doPerf(F,(function(){return"Serializer:appendPayload"}),(function(){for(var F=W.events(),K=G.payloadBlob,J=G.numEvents,Q=!1,Y=[],$=[],X=G.isBeacon,Z=X?Pa:Ra,ee=X?Ma:Oa,te=0,ne=0;te<F.length;){var ie=F[te];if(ie){if(J>=z){G.overflow=W.split(te);break}var re=B.getEventBlob(ie);if(re&&re.length<=ee){var oe=re.length;if(K.length+oe>Z){G.overflow=W.split(te);break}K&&(K+="\n"),K+=re,++ne>Aa&&(K.substr(0,1),ne=0),Q=!0,J++}else re?Y.push(ie):$.push(ie),F.splice(te,1),te--}te++}if(Y&&Y.length>0&&G.sizeExceed.push(Ia.create(W.iKey(),Y)),$&&$.length>0&&G.failedEvts.push(Ia.create(W.iKey(),$)),Q){G.batches.push(W),G.payloadBlob=K,G.numEvents=J;var ae=W.iKey();-1===arrIndexOf(G.apiKeys,ae)&&G.apiKeys.push(ae)}}),(function(){return{payload:G,theBatch:{iKey:W.iKey(),evts:W.events()},max:z}})),K},B.getEventBlob=function(B){try{return doPerf(F,(function(){return"Serializer.getEventBlob"}),(function(){var F={};F.name=B.name,F.time=B.time,F.ver=B.ver,F.iKey="o:"+getTenantId(B.iKey);var G={},W=B[J];W&&(F[J]=G,objForEachKey(W,(function(F,B){_processPathKeys(B,G[F]={},"ext."+F,!0,null,null,!0)})));var Q=F[z]={};Q.baseType=B.baseType;var $=Q[K]={};return _processPathKeys(B.baseData,$,K,!1,[K],(function(F,B,W){_addJSONPropertyMetaData(G,F,B,W)}),Y),_processPathKeys(B.data,Q,z,!1,[],(function(F,B,W){_addJSONPropertyMetaData(G,F,B,W)}),Y),JSON.stringify(F)}),(function(){return{item:B}}))}catch(F){return null}}}))}return Serializer}();function _addJSONPropertyMetaData(F,B,G,W){if(W&&F){var z=getCommonSchemaMetaData(W.value,W.kind,W.propertyType);if(z>-1){var K=F[wa];K||(K=F[wa]={f:{}});var J=K[Da];if(J||(J=K[Da]={}),B)for(var Q=0;Q<B.length;Q++){var Y=B[Q];J[Y]||(J[Y]={f:{}});var $=J[Y][Da];$||($=J[Y][Da]={}),J=$}J=J[G]={},isArray(W.value)?J.a={t:z}:J.t=z}}}
/**
	* RetryPolicy.ts
	* @author Abhilash Panwar (abpanwar)
	* @copyright Microsoft 2018
	*/var ka,Fa=.8,xa=1.2,Ua=3e3,ja=6e5,Ba=function(){function RetryPolicy(){}return RetryPolicy.shouldRetryForStatus=function(F){return!(F>=300&&F<500&&408!==F&&429!==F||501===F||505===F)},RetryPolicy.getMillisToBackoffForRetry=function(F){var B=0,G=Ua*Fa,W=Ua*xa,z=Math.floor(Math.random()*(W-G))+G;return B=Math.pow(2,F)*z,Math.min(B,ja)},RetryPolicy}(),Ha=1e3,Va=function(){function KillSwitch(){var F={};function _normalizeTenants(F){var B=[];return F&&arrForEach(F,(function(F){B.push(strTrim(F))})),B}dynamicProto(KillSwitch,this,(function(B){B.setKillSwitchTenants=function(B,G){if(B&&G)try{var W=_normalizeTenants(B.split(","));if("this-request-only"===G)return W;for(var z=parseInt(G,10)*Ha,K=0;K<W.length;++K)F[W[K]]=dateNow()+z}catch(F){return[]}return[]},B.isTenantKilled=function(B){var G=F,W=strTrim(B);return void 0!==G[W]&&G[W]>dateNow()||(delete G[W],!1)}}))}return KillSwitch}(),Ga=function(){function ClockSkewManager(){var F=!0,B=!0,G=!0,W="use-collector-delta",z=!1;dynamicProto(ClockSkewManager,this,(function(K){K.allowRequestSending=function(){return F},K.firstRequestSent=function(){G&&(G=!1,z||(F=!1))},K.shouldAddClockSkewHeaders=function(){return B},K.getClockSkewHeaderValue=function(){return W},K.setClockSkew=function(G){z||(G?(W=G,B=!0,z=!0):B=!1,F=!0)}}))}return ClockSkewManager}(),Wa="POST",qa="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",za="drop",Ka="send",Ja="requeue",Qa="rspFail",Ya="oth",$a="kill-tokens",Xa="kill-duration",Za="kill-duration-seconds",es="time-delta-millis",ts=((ka={})[1]=Ja,ka[100]=Ja,ka[200]="sent",ka[8004]=za,ka[8003]=za,ka);function _getResponseText(F){try{return F.responseText}catch(F){}return""}var ns=function(){function HttpManager(F,B,G,W){this._responseHandlers=[];var z,K,J,Q,Y,$="?cors=true&content-type=application/x-json-stream&client-id=NO_AUTH&client-version="+mr,X=new Va,Z=!1,ee=new Ga,te=!1,ne=0,ie=!0,re=[],oe={},ae=[],se=null,ce=!1;dynamicProto(HttpManager,this,(function(le){var de=!0;function _getSenderInterface(F){for(var B=0,G=null,W=0;null==G&&W<F.length;)1===(B=F[W])?useXDomainRequest()?G=_xdrSendPost:"undefined"!=typeof XMLHttpRequest&&(G=_xhrSendPost):2===B?G=_fetchSendPost:te&&3===B&&isBeaconsSupported()&&(G=_beaconSendPost),W++;return G?{_transport:B,sendPOST:G}:null}function _xdrSendPost(F,B,G){var W=new XDomainRequest;W.open(Wa,F.urlString),W.onload=function(){var F=_getResponseText(W);_doOnComplete(B,200,{},F),_handleCollectorResponse(F)},W.onerror=function(){_doOnComplete(B,400,{})},W.ontimeout=function(){_doOnComplete(B,500,{})},W.onprogress=function(){},G?W.send(F.data):z._setTimeoutOverride((function(){W.send(F.data)}),0)}function _fetchSendPost(F,B){var G,W=((G={body:F.data,method:Wa})[qa]=!0,G);de&&(W.credentials="include"),F.headers&&objKeys(F.headers).length>0&&(W.headers=F.headers),fetch(F.urlString,W).then((function(F){var G={},W="";F.headers&&F.headers.forEach((function(F,B){G[B]=F})),F.body&&F.text().then((function(F){W=F})),_doOnComplete(B,F.status,G,W),_handleCollectorResponse(W)})).catch((function(F){_doOnComplete(B,0,{})}))}function _xhrSendPost(F,B,G){function _appendHeader(F,B,G){if(!F[G]&&B&&B.getResponseHeader){var W=B.getResponseHeader(G);W&&(F[G]=strTrim(W))}return F}function _getAllResponseHeaders(F){var B={};return F.getAllResponseHeaders?B=_convertAllHeadersToMap(F.getAllResponseHeaders()):(B=_appendHeader(B,F,es),B=_appendHeader(B,F,Xa),B=_appendHeader(B,F,Za)),B}function xhrComplete(F,G){_doOnComplete(B,F.status,_getAllResponseHeaders(F),G)}var W=new XMLHttpRequest;try{W[qa]=!0}catch(F){}de&&(W.withCredentials=!0),W.open(Wa,F.urlString,!G),objForEachKey(F.headers,(function(F,B){W.setRequestHeader(F,B)})),W.onload=function(){var F=_getResponseText(W);xhrComplete(W,F),_handleCollectorResponse(F)},W.onerror=function(){xhrComplete(W)},W.ontimeout=function(){xhrComplete(W)},W.send(F.data)}function _doOnComplete(F,B,G,W){try{F(B,G,W)}catch(F){z.diagLog().throwInternal(Wn.WARNING,fr.SendPostOnCompleteFailure,dumpObj(F))}}function _beaconSendPost(F,B,G){var W=200,K=F._thePayload;try{var J=getNavigator();if(!J.sendBeacon(F.urlString,F.data))if(K){var Q=[];arrForEach(K.batches,(function(B){if(Q&&B&&B.count()>0){for(var G=B.events(),W=0;W<G.length;W++)if(!J.sendBeacon(F.urlString,se.getEventBlob(G[W]))){Q.push(B.split(W));break}}else Q.push(B.split(0))})),_sendBatchesNotification(Q,8003,K.isSync,!0)}else W=0}catch(F){z.diagLog().warnToConsole("Failed to send telemetry using sendBeacon API. Ex:"+F),W=0}finally{_doOnComplete(B,W,{},"")}}function _hasIdleConnection(){return!Z&&ne<B}function _clearQueue(){var F=ae;return ae=[],F}function _canSendPayload(F,B,G){var W=!1;return F&&F.length>0&&!Z&&K&&se&&(W=B||_hasIdleConnection()&&(G>0||ee.allowRequestSending())),W}function _createDebugBatches(F){var B={};return F&&arrForEach(F,(function(F,G){B[G]={iKey:F.iKey(),evts:F.events()}})),B}function _sendBatches(B,G,W,J,Y,$){if(B&&0!==B.length)if(Z)_sendBatchesNotification(B,1,J);else try{var ee=B;doPerf(Q,(function(){return"HttpManager:_sendBatches"}),(function(z){z&&(B=B.slice(0));for(var Q=[],Z=null,ee=_r(),te=($||K&&3===K._transport)&&_canUseSendBeaconApi();_canSendPayload(B,J,G);){var ne=B.shift();ne&&ne.count()>0&&(X.isTenantKilled(ne.iKey())?Q.push(ne):(Z=Z||se.createPayload(G,W,J,te,Y),se.appendPayload(Z,ne,F)?null!==Z.overflow&&(B=[Z.overflow].concat(B),Z.overflow=null,_doPayloadSend(Z,ee,_r(),Y),ee=_r(),Z=null):(_doPayloadSend(Z,ee,_r(),Y),ee=_r(),B=[ne].concat(B),Z=null)))}Z&&_doPayloadSend(Z,ee,_r(),Y),B.length>0&&(ae=B.concat(ae)),_sendBatchesNotification(Q,8004,J)}),(function(){return{batches:_createDebugBatches(ee),retryCount:G,isTeardown:W,isSynchronous:J,sendReason:Y,useSendBeacon:$}}),!J)}catch(F){z.diagLog().throwInternal(Wn.WARNING,fr.CannotSerializeObject,"Unexpected Exception sending batch: "+dumpObj(F))}}function _buildQueryString(F){var B=$,G="";arrForEach(F.apiKeys,(function(F){G.length>0&&(G+=","),G+=F})),G.length>0&&(B+="&apikey="+G),B+="&upload-time="+dateNow().toString();var W=_getMsfpc(F);if(isValueAssigned(W)&&(B=B+"&ext.intweb.msfpc="+W),ee.shouldAddClockSkewHeaders()&&(B+="&time-delta-to-apply-millis="+ee.getClockSkewHeaderValue()),Q.getWParam){var z=Q.getWParam();z>=0&&(B+="&w="+z)}for(var K=0;K<re.length;K++)B+="&"+re[K].name+"="+re[K].value;return B}function _canUseSendBeaconApi(){return!ie&&te&&isBeaconsSupported()}function _setTimingValue(F,B,G){F[B]=F[B]||{},F[B][z.identifier]=G}function _doPayloadSend(F,B,G,W){if(F&&F.payloadBlob&&F.payloadBlob.length>0){var Y=_buildQueryString(F),$=_r(),X="sendAttempt";doPerf(Q,(function(){return"HttpManager:_doPayloadSend"}),(function(){for(var Z=0;Z<F.batches.length;Z++)for(var te=F.batches[Z].events(),re=0;re<te.length;re++){var ae=te[re];if(ce){var se=ae.timings=ae.timings||{};_setTimingValue(se,"sendEventStart",$),_setTimingValue(se,"serializationStart",B),_setTimingValue(se,"serializationCompleted",G)}ae[X]>0?ae[X]++:ae[X]=1}_sendBatchesNotification(F.batches,1e3+(W||0),F.isSync,!0);var de={data:F.payloadBlob,urlString:Y,headers:extend({},oe),_thePayload:F,_sendReason:W},ue=null,pe=!!le.sendHook,he=K;J&&F.isBeacon&&2===F.sendReason&&(he=J),he&&(ue=function(B){ee.firstRequestSent();var onComplete=function(B,G){_retryRequestIfNeeded(B,G,F,W)};try{he.sendPOST(B,onComplete,F.isTeardown||F.isSync),le.sendListener&&le.sendListener(de,B,F.isSync||F.isTeardown,F.isBeacon)}catch(F){z.diagLog().warnToConsole("Unexpected exception sending payload. Ex:"+dumpObj(F)),_doOnComplete(onComplete,0,{})}}),doPerf(Q,(function(){return"HttpManager:_doPayloadSend.sender"}),(function(){if(ue)if(F.isSync||F.isBeacon||ne++,pe&&!F.isBeacon&&3!==he._transport){var B={data:de.data,urlString:de.urlString,headers:de.headers},G=!1;doPerf(Q,(function(){return"HttpManager:_doPayloadSend.sendHook"}),(function(){try{le.sendHook(B,(function(F){G=!0,ie||F._thePayload||(F._thePayload=F._thePayload||de._thePayload,F._sendReason=F._sendReason||de._sendReason),ue(F)}),F.isSync||F.isTeardown)}catch(F){G||ue(de)}}))}else ue(de)}))}),(function(){return{thePayload:F,serializationStart:B,serializationCompleted:G,sendReason:W}}),F.isSync)}F.sizeExceed&&F.sizeExceed.length>0&&_sendBatchesNotification(F.sizeExceed,8003,F.isSync),F.failedEvts&&F.failedEvts.length>0&&_sendBatchesNotification(F.failedEvts,8002,F.isSync)}function _addEventCompletedTimings(F,B){ce&&arrForEach(F,(function(F){_setTimingValue(F.timings=F.timings||{},"sendEventCompleted",B)}))}function _retryRequestIfNeeded(F,B,W,z){var K=9e3,J=null,Q=!1,Y=!1;try{var $=!0;if(typeof F!==fn){if(B){ee.setClockSkew(B[es]);var Z=B[Xa]||B["kill-duration-seconds"];arrForEach(X.setKillSwitchTenants(B[$a],Z),(function(F){arrForEach(W.batches,(function(B){if(B.iKey()===F){J=J||[];var G=B.split(0);W.numEvents-=G.count(),J.push(G)}}))}))}if(200===F)return void(K=200);(!Ba.shouldRetryForStatus(F)||W.numEvents<=0)&&($=!1),K=9e3+F%1e3}if($){K=100;var te=W.retryCnt;W.isSync||W.isBeacon||(te<G?(Q=!0,_doAction((function(){W.isSync||W.isBeacon||ne--,_sendBatches(W.batches,te+1,W.isTeardown,W.isSync,5,W.isBeacon)}),!0,Ba.getMillisToBackoffForRetry(te))):Y=!0)}}finally{Q||(ee.setClockSkew(),_handleRequestFinished(W,K,z,Y)),_sendBatchesNotification(J,8004,W.isSync)}}function _handleRequestFinished(F,B,G,W){try{W&&z._backOffTransmission(),200===B&&(W||F.isSync||z._clearBackOff(),_addCompleteTimings(F.batches)),_sendBatchesNotification(F.batches,B,F.isSync,!0)}finally{F.isSync||F.isBeacon||(ne--,5!==G&&le.sendQueuedRequests(G,!F.isSync,F.isBeacon))}}function _addCompleteTimings(F){if(ce){var B=_r();arrForEach(F,(function(F){F&&F.count()>0&&_addEventCompletedTimings(F.events(),B)}))}}function _doAction(F,B,G){B?F():z._setTimeoutOverride(F,G)}function _convertAllHeadersToMap(F){var B={};isString(F)&&arrForEach(strTrim(F).split(/[\r\n]+/),(function(F){if(F){var G=F.indexOf(": ");if(-1!==G){var W=strTrim(F.substring(0,G)).toLowerCase(),z=strTrim(F.substring(G+1));B[W]=z}else B[strTrim(F)]=1}}));return B}function _getMsfpc(F){for(var B=0;B<F.batches.length;B++)for(var G=F.batches[B].events(),W=0;W<G.length;W++){var z=(G[W].ext||{}).intweb||{};if(isValueAssigned(z.msfpc))return encodeURIComponent(z.msfpc)}return""}function _handleCollectorResponse(F){var B=le._responseHandlers;try{for(var G=0;G<B.length;G++)try{B[G](F)}catch(F){z.diagLog().throwInternal(Wn.CRITICAL,fr.PostResponseHandler,"Response handler failed: "+F)}if(F){var W=JSON.parse(F);isValueAssigned(W.webResult)&&isValueAssigned(W.webResult.msfpc)&&Y.set("MSFPC",W.webResult.msfpc,31536e3)}}catch(F){}}function _sendBatchesNotification(F,B,G,K){if(F&&F.length>0&&W){var J=W[_getNotificationAction(B)];J&&doPerf(Q,(function(){return"HttpManager:_sendBatchesNotification"}),(function(){_doAction((function(){try{J.call(W,F,B,G)}catch(F){z.diagLog().throwInternal(Wn.CRITICAL,fr.NotificationException,"send request notification failed: "+F)}}),K||G,0)}),(function(){return{batches:_createDebugBatches(F),reason:B,isSync:G,sendSync:K}}),!G)}}function _getNotificationAction(F){var B=ts[F];return isValueAssigned(B)||(B=Ya,F>=9e3&&F<=9999?B=Qa:F>=8e3&&F<=8999?B=za:F>=1e3&&F<=1999&&(B=Ka)),B}le.initialize=function(F,B,G,W,X){X||(X={}),$=F+$,Q=B,Y=B.getCookieMgr(),ce=!Q.config.disableEventTimings;var Z=!!Q.config.enableCompoundKey;z=G;var ee=X.valueSanitizer,ne=X.stringifyObjects;if(isUndefined(X.enableCompoundKey)||(Z=!!X.enableCompoundKey),te=!isReactNative(),se=new La(Q,ee,ne,Z),J=_getSenderInterface([3]),!(K=W)){ie=!1;var re=getLocation();re&&re.protocol&&"file:"===re.protocol.toLowerCase()&&(de=!1);var oe=[];oe=isReactNative()?[2,1]:[1,2,3];var ae=X.transports;ae&&(isNumber(ae)?oe=[ae].concat(oe):isArray(ae)&&(oe=ae.concat(oe))),(K=_getSenderInterface(oe))||z.diagLog().warnToConsole("No available transport to send events")}},le._getDbgPlgTargets=function(){return[K,X,se]},le.addQueryStringParameter=function(F,B){for(var G=0;G<re.length;G++)if(re[G].name===F)return void(re[G].value=B);re.push({name:F,value:B})},le.addHeader=function(F,B){oe[F]=B},le.canSendRequest=function(){return _hasIdleConnection()&&ee.allowRequestSending()},le.sendQueuedRequests=function(F,B,G){var W=!isNullOrUndefined(B)&&!B;_canSendPayload(ae,W,0)&&_sendBatches(_clearQueue(),0,!1,W,F||0,!!G)},le.isCompletelyIdle=function(){return!Z&&0===ne&&0===ae.length},le.addBatch=function(F){if(F&&F.count()>0){if(X.isTenantKilled(F.iKey()))return!1;ae.push(F)}return!0},le.teardown=function(){ae.length>0&&_sendBatches(_clearQueue(),0,!0,!0,2,!0)},le.pause=function(){Z=!0},le.resume=function(){Z=!1,le.sendQueuedRequests(4,!1)},le.sendSynchronousBatch=function(F,B,G){F&&F.count()>0&&_sendBatches([F],0,!1,!0,B||0,!!G)}}))}return HttpManager}(),is=.25,rs=500,os=20,as=6,ss=4,cs=Sr?window:void 0,ls=2,ds=1,us="eventsDiscarded",ps="overrideInstrumentationKey",hs=function(F){function PostChannel(){var B,G=F.call(this)||this;G.identifier="PostChannel",G.priority=1011,G.version="3.1.2";var W,z,K,J,Q,Y=!1,$=[],X=null,Z=!1,ee=0,te=500,ne=0,ie=1e4,re={},oe=Ta,ae=null,se=null,ce=0,le=0,de={},ue=-1,pe=!0;return dynamicProto(PostChannel,G,(function(F,G){function _addEventToQueues(F,B){if(F.sendAttempt||(F.sendAttempt=0),F.latency||(F.latency=hr.Normal),F.ext&&F.ext.trace&&delete F.ext.trace,F.ext&&F.ext.user&&F.ext.user.id&&delete F.ext.user.id,pe&&(F.ext=optimizeObject(F.ext),F.baseData&&(F.baseData=optimizeObject(F.baseData)),F.data&&(F.data=optimizeObject(F.data))),F.sync)if(ce||Z)F.latency=hr.RealTime,F.sync=!1;else if(z)return pe&&(F=optimizeObject(F)),void z.sendSynchronousBatch(Ia.create(F.iKey,[F]),3);var G=F.latency,W=ne,K=ie;G===hr.Immediate&&(W=ee,K=te);var J=!1;if(W<K)J=!_addEventToProperQueue(F,B);else{var Q=hr.Normal,Y=os;G===hr.Immediate&&(Q=hr.Immediate,Y=1),J=!0,_dropEventWithLatencyOrLess(F.iKey,F.latency,Q,Y)&&(J=!_addEventToProperQueue(F,B))}J&&_notifyEvents(us,[F],pn.QueueFull)}function _sendEventsForLatencyAndAbove(F,B,G,W){var K=_queueBatches(F,B,G);return z.sendQueuedRequests(B,G,W),K}function _hasEvents(){return ne>0}function _scheduleTimer(){if(ue>=0&&_queueBatches(ue,Q,!0)&&z.sendQueuedRequests(Q,!0,!1),ee>0&&!se&&!Z){var F=re[oe][2];F>=0&&(se=_createTimer((function(){se=null,_sendEventsForLatencyAndAbove(hr.Immediate,1,!0),_scheduleTimer()}),F))}var B=re[oe][1];!ae&&!X&&B>=0&&!Z&&(_hasEvents()?ae=_createTimer((function(){ae=null,_sendEventsForLatencyAndAbove(0===le?hr.RealTime:hr.Normal,1,!0),le++,le%=2,_scheduleTimer()}),B):le=0)}function _createTimer(B,G){0===G&&ce&&(G=1);var W=1e3;return ce&&(W=Ba.getMillisToBackoffForRetry(ce-1)),F._setTimeoutOverride(B,G*W)}function _clearScheduledTimer(){null!==ae&&(F._clearTimeoutOverride(ae),ae=null,le=0)}function _releaseAllQueuesUsingBeacons(B,G){_clearScheduledTimer(),X&&(F._clearTimeoutOverride(X),X=null),Z||_sendEventsForLatencyAndAbove(hr.Normal,B,G,!0)}function _clearQueues(){de[hr.Immediate]={batches:[],iKeyMap:{}},de[hr.RealTime]={batches:[],iKeyMap:{}},de[hr.CostDeferred]={batches:[],iKeyMap:{}},de[hr.Normal]={batches:[],iKeyMap:{}}}function _getEventBatch(F,B,G){var W=de[B];W||(B=hr.Normal,W=de[B]);var z=W.iKeyMap[F];return!z&&G&&(z=Ia.create(F),W.batches.push(z),W.iKeyMap[F]=z),z}function _performAutoFlush(B,G){z.canSendRequest()&&!ce&&(K>0&&ne>K&&(G=!0),G&&null==X&&F.flush(B,null,20))}function _addEventToProperQueue(F,B){pe&&(F=optimizeObject(F));var G=F.latency,W=_getEventBatch(F.iKey,G,!0);return!!W.addEvents([F],B)&&(G!==hr.Immediate?(ne++,B&&0===F.sendAttempt&&_performAutoFlush(!F.sync,J>0&&W.count()>=J)):ee++,!0)}function _dropEventWithLatencyOrLess(F,B,G,W){for(;G<=B;){var z=_getEventBatch(F,B,!0);if(z&&z.count()>0){var K=z.split(0,W),J=K.count();if(J>0)return G===hr.Immediate?ee-=J:ne-=J,_notifyBatchEvents(us,[K],pn.QueueFull),!0}G++}return _resetQueueCounts(),!1}function _resetQueueCounts(){for(var F=0,B=0,_loop_1=function(G){var W=de[G];W&&W.batches&&arrForEach(W.batches,(function(W){G===hr.Immediate?F+=W.count():B+=W.count()}))},G=hr.Normal;G<=hr.Immediate;G++)_loop_1(G);ne=B,ee=F}function _queueBatches(B,G,W){var K=!1;return!W||z.canSendRequest()?doPerf(F.core,(function(){return"PostChannel._queueBatches"}),(function(){for(var F=[],G=hr.Immediate;G>=B;){var W=de[G];W&&W.batches&&(arrForEach(W.batches,(function(B){z.addBatch(B)?K=K||B&&B.count()>0:F=F.concat(B.events()),G===hr.Immediate?ee-=B.count():ne-=B.count()})),W.batches=[],W.iKeyMap={}),G--}F.length>0&&_notifyEvents(us,F,pn.KillSwitch),K&&ue>=B&&(ue=-1,Q=0)}),(function(){return{latency:B,sendReason:G}}),W):(ue=ue>=0?Math.min(ue,B):B,Q=Math.max(Q,G)),K}function _flushImpl(F,B){_sendEventsForLatencyAndAbove(hr.Normal,B,!0),_waitForIdleManager((function(){F&&F(),$.length>0?X=_createTimer((function(){return _flushImpl($.shift(),B)}),0):(X=null,_hasEvents()&&_scheduleTimer())}))}function _waitForIdleManager(F){z.isCompletelyIdle()?F():X=_createTimer((function(){_waitForIdleManager(F)}),is)}function _resetTransmitProfiles(){_clearScheduledTimer(),_initializeProfiles(),oe=Ta,_scheduleTimer()}function _initializeProfiles(){(re={})[Ta]=[2,1,0],re[Ea]=[6,3,0],re[ba]=[18,9,0]}function _requeueEvents(B,G){var W=[];arrForEach(B,(function(B){B&&B.count()>0&&arrForEach(B.events(),(function(B){B&&(B.sync&&(B.latency=hr.RealTime,B.sync=!1),B.sendAttempt<as?(setProcessTelemetryTimings(B,F.identifier),_addEventToQueues(B,!1)):W.push(B))}))})),W.length>0&&_notifyEvents(us,W,pn.NonRetryableStatus)}function _callNotification(B,G){var W=F._notificationManager||{},z=W[B];if(z)try{z.apply(W,G)}catch(G){F.diagLog().throwInternal(Wn.CRITICAL,fr.NotificationException,B+" notification failed: "+G)}}function _notifyEvents(F,B){for(var G=[],W=2;W<arguments.length;W++)G[W-2]=arguments[W];B&&B.length>0&&_callNotification(F,[B].concat(G))}function _notifyBatchEvents(F,B){for(var G=[],W=2;W<arguments.length;W++)G[W-2]=arguments[W];B&&B.length>0&&arrForEach(B,(function(B){B&&B.count()>0&&_callNotification(F,[B.events()].concat(G))}))}function _sendingEvent(F,B,G){F&&F.length>0&&_callNotification("eventsSendRequest",[B>=1e3&&B<=1999?B-1e3:0,!0!==G])}function _eventsSentEvent(F,B){_notifyBatchEvents("eventsSent",F,B),_scheduleTimer()}function _eventsDropped(F,B){_notifyBatchEvents(us,F,B>=8e3&&B<=8999?B-8e3:pn.Unknown)}function _eventsResponseFail(F){_notifyBatchEvents(us,F,pn.NonRetryableStatus),_scheduleTimer()}function _otherEvent(F,B){_notifyBatchEvents(us,F,pn.Unknown),_scheduleTimer()}function _setAutoLimits(){J=B&&B.disableAutoBatchFlushLimit?0:Math.max(rs*(ls+1),ie/6)}_initializeProfiles(),_clearQueues(),_setAutoLimits(),z=new ns(rs,ls,ds,{requeue:_requeueEvents,send:_sendingEvent,sent:_eventsSentEvent,drop:_eventsDropped,rspFail:_eventsResponseFail,oth:_otherEvent}),F._getDbgPlgTargets=function(){return[z]},F.initialize=function(J,Q,Y){doPerf(Q,(function(){return"PostChannel:initialize"}),(function(){var $=Q;G.initialize(J,Q,Y),F.setInitialized(!1);var X=F._getTelCtx();J.extensionConfig[F.identifier]=J.extensionConfig[F.identifier]||{},B=X.getExtCfg(F.identifier),F._setTimeoutOverride=B.setTimeoutOverride?B.setTimeoutOverride:setTimeout.bind(cs),F._clearTimeoutOverride=B.clearTimeoutOverride?B.clearTimeoutOverride:clearTimeout.bind(cs),pe=!B.disableOptimizeObj&&isChromium();var Z=$.getWParam;$.getWParam=function(){var F=0;return B.ignoreMc1Ms0CookieProcessing&&(F|=2),F|Z()},B.eventsLimitInMem>0&&(ie=B.eventsLimitInMem),B.immediateEventLimit>0&&(te=B.immediateEventLimit),B.autoFlushEventsLimit>0&&(K=B.autoFlushEventsLimit),_setAutoLimits(),B.httpXHROverride&&B.httpXHROverride.sendPOST&&(W=B.httpXHROverride),isValueAssigned(J.anonCookieName)&&z.addQueryStringParameter("anoncknm",J.anonCookieName),z.sendHook=B.payloadPreprocessor,z.sendListener=B.payloadListener;var ee=B.overrideEndpointUrl?B.overrideEndpointUrl:J.endpointUrl;F._notificationManager=J.extensionConfig.NotificationManager,z.initialize(ee,F.core,F,W,B),addPageUnloadEventListener((function(){_releaseAllQueuesUsingBeacons(2,!1)})),F.setInitialized(!0)}),(function(){return{coreConfig:J,core:Q,extensions:Y}}))},F.processTelemetry=function(G,W){setProcessTelemetryTimings(G,F.identifier);var z=(W=F._getTelCtx(W)).getExtCfg(F.identifier),K=!!B.disableTelemetry;z&&(K=K||!!z.disableTelemetry);var J=G;K||Y||(B[ps]&&(J.iKey=B[ps]),z&&z[ps]&&(J.iKey=z[ps]),_addEventToQueues(J,!0),_scheduleTimer()),F.processNext(J,W)},F.setEventQueueLimits=function(F,B){ie=F>0?F:1e4,K=B>0?B:0,_setAutoLimits();var G=ne>F;if(!G&&J>0)for(var W=hr.Normal;!G&&W<=hr.RealTime;W++){var z=de[W];z&&z.batches&&arrForEach(z.batches,(function(F){F&&F.count()>=J&&(G=!0)}))}_performAutoFlush(!0,G)},F.teardown=function(){_releaseAllQueuesUsingBeacons(2,!1),Y=!0,z.teardown()},F.pause=function(){_clearScheduledTimer(),Z=!0,z.pause()},F.resume=function(){Z=!1,z.resume(),_scheduleTimer()},F.addResponseHandler=function(F){z._responseHandlers.push(F)},F._loadTransmitProfiles=function(F){_resetTransmitProfiles(),objForEachKey(F,(function(F,B){var G=B.length;if(G>=2){var W=G>2?B[2]:0;if(B.splice(0,G-2),B[1]<0&&(B[0]=-1),B[1]>0&&B[0]>0){var z=B[0]/B[1];B[0]=Math.ceil(z)*B[1]}W>=0&&B[1]>=0&&W>B[1]&&(W=B[1]),B.push(W),re[F]=B}}))},F.flush=function(F,B,G){void 0===F&&(F=!0),Z||(_clearScheduledTimer(),G=G||1,F?(_queueBatches(hr.Normal,G,F),_resetQueueCounts(),null==X?X=_createTimer((function(){_flushImpl(B,G)}),0):$.push(B)):(_sendEventsForLatencyAndAbove(hr.Normal,G,!1),null!=B&&B()))},F.setMsaAuthTicket=function(F){z.addHeader("AuthMsaDeviceTicket",F)},F.hasEvents=_hasEvents,F._setTransmitProfile=function(F){oe!==F&&void 0!==re[F]&&(_clearScheduledTimer(),oe=F,_scheduleTimer())},F._backOffTransmission=function(){ce<ss&&(ce++,_clearScheduledTimer(),_scheduleTimer())},F._clearBackOff=function(){ce&&(ce=0,_clearScheduledTimer(),_scheduleTimer())}})),G}return __extendsFn(PostChannel,F),PostChannel}(Mi),gs=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function _validateAppExpId(F,B){void 0===B&&(B=gs);var G=null;if(F)for(var W=F.split(","),z=0;z<W.length;z++)_isValidAppFlightId(W[z],B)&&(G?G+=","+W[z]:G=W[z]);return G}function _isValidAppFlightId(F,B){if(void 0===B&&(B=gs),!F||F.length<4)return!1;for(var G=!1,W=256,z=F.substring(0,3).toString().toUpperCase(),K=0;K<B.length;K++)if(B[K]+":"===z&&F.length<=W){G=!0;break}return G}var fs=function(){function Application(F,B){this.core=B,this.appExpId=null,this.flightIdNameSpaces=gs.slice(0),this.expIdCookieName="Treatments",this._cookieMgr=safeGetCookieMgr(B),this._propertiesConfig=F;var G=getDocument();if(G){var W=G.documentElement;G&&(this.locale=W.lang)}this.env=F.env?F.env:this._getMetaDataFromDOM("awa-").env}return Application.prototype.getExpId=function(){return this._propertiesConfig.expId?this._readExpIdFromCoreData(this._propertiesConfig.expId):this._readExpIdFromCookie()},Application.prototype._getMetaDataFromDOM=function(F){var B,G={},W=getDocument();if(W){B=W&&W.querySelectorAll("meta");for(var z=0;z<B.length;z++){var K=B[z];if(K.name)if(0===K.name.toLowerCase().indexOf(F))G[K.name.replace(F,"")]=K.content}}return G},Application.prototype._setAppExpId=function(F){F!==this.appExpId&&(this.appExpId=_validateAppExpId(F,this.flightIdNameSpaces))},Application.prototype._getAppExpId=function(){return this.appExpId},Application.prototype._readExpIdFromCookie=function(){var F=getCookieValue(this._cookieMgr,this.expIdCookieName);return this._setAppExpId(F),this._getAppExpId()},Application.prototype._readExpIdFromCoreData=function(F){return this._setAppExpId(F),this._getAppExpId()},Application.validateAppExpId=_validateAppExpId,Application._staticInit=void objDefineAccessors(Application.prototype,"expId",Application.prototype.getExpId),Application}(),ms=function(){function Cloud(){}return Cloud}(),vs=function(){function User(F,B,G){this.core=G;var W=this._cookieMgr=safeGetCookieMgr(G,F);if(W&&W.isEnabled()){var z=getCookieValue(W,"MUID");if(z&&this.setLocalId("t:"+z),B.enableApplicationInsightsUser){var K=getCookieValue(W,User.userCookieName);if(K){var J=K.split(User.cookieSeparator);J.length>0&&(this.id=J[0])}if(!this.id){this.id=newId(F&&!isUndefined(F.idLength)?F.idLength:22);var Q=toISOString(new Date);this.accountAcquisitionDate=Q;var Y=[this.id,Q],$=B.cookieDomain?B.cookieDomain:void 0;W.set(User.userCookieName,Y.join(User.cookieSeparator),31536e3,$)}}}if("undefined"!=typeof navigator){var X=navigator;this.locale=X.userLanguage||X.language}}return User.prototype.getLocalId=function(){if(this._customLocalId)return this._customLocalId;var F=getCookieValue(this._cookieMgr,"MUID");F&&this.setLocalId("t:"+F)},User.prototype.setLocalId=function(F){this._customLocalId=F},User.cookieSeparator="|",User.userCookieName="ai_user",User._staticInit=void objDefineAccessors(User.prototype,"localId",User.prototype.getLocalId,User.prototype.setLocalId),User}(),ys={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",OPERA:"Opera"},Ss="([\\d,.]+)",_s="Unknown",Cs="Edg/",Ts=function(){function Web(F,B){this._cookieMgr=safeGetCookieMgr(B),this._propertiesConfig=F;var G=getLocation();if(G){var W=G.hostname;W&&(this.domain="file:"===G.protocol?"local":W)}var z="undefined"!=typeof navigator?navigator.userAgent:"";if(F.userAgent&&(z=F.userAgent),F.populateBrowserInfo){if(z){var K=this._getBrowserName(z);this.browser=K,this.browserVer=this._getBrowserVersion(z,K)}var J=this._getScreenResolution();this.screenRes=J.w+"X"+J.h}}return Web.prototype.getUserConsent=function(){return this._propertiesConfig.userConsented||!!getCookieValue(this._cookieMgr,this._propertiesConfig.userConsentCookieName||"MSCC")},Web.prototype.getUserConsentDetails=function(){try{if(this._propertiesConfig.callback&&this._propertiesConfig.callback.userConsentDetails){var F=this._propertiesConfig.callback.userConsentDetails();if(F)return JSON.stringify({Required:!!F.Required&&F.Required,Analytics:!!F.Analytics&&F.Analytics,SocialMedia:!!F.SocialMedia&&F.SocialMedia,Advertising:!!F.Advertising&&F.Advertising})}}catch(F){}return null},Web.prototype._getBrowserName=function(F){return this._userAgentContainsString("OPR/",F)?ys.OPERA:this._userAgentContainsString(ys.PHANTOMJS,F)?ys.PHANTOMJS:this._userAgentContainsString(ys.EDGE,F)||this._userAgentContainsString(Cs,F)?ys.EDGE:this._userAgentContainsString(ys.ELECTRON,F)?ys.ELECTRON:this._userAgentContainsString(ys.CHROME,F)?ys.CHROME:this._userAgentContainsString("Trident",F)?ys.MSIE:this._userAgentContainsString(ys.FIREFOX,F)?ys.FIREFOX:this._userAgentContainsString(ys.SAFARI,F)?ys.SAFARI:this._userAgentContainsString(ys.SKYPE_SHELL,F)?ys.SKYPE_SHELL:_s},Web.prototype._userAgentContainsString=function(F,B){return B.indexOf(F)>-1},Web.prototype._getBrowserVersion=function(F,B){return B===ys.MSIE?this._getIeVersion(F):this._getOtherVersion(B,F)},Web.prototype._getIeVersion=function(F){var B=F.match(new RegExp(ys.MSIE+" "+Ss));if(B)return B[1];var G=F.match(new RegExp("rv:"+Ss));return G?G[1]:void 0},Web.prototype._getOtherVersion=function(F,B){F===ys.SAFARI?F="Version":F===ys.EDGE&&this._userAgentContainsString(Cs,B)&&(F="Edg");var G=B.match(new RegExp(F+"/"+Ss));return G?G[1]:_s},Web.prototype._getScreenResolution=function(){var F={h:0,w:0},B=getWindow();return B&&B.screen&&(F.h=screen.height,F.w=screen.width),F},Web._staticInit=void objDefineAccessors(Web.prototype,"userConsent",Web.prototype.getUserConsent),Web}(),Es={WINDOWS:"Windows",MACOSX:"Mac OS X",ANDROID:"Android",IOS:"iOS"},bs={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},Is={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},As="([\\d,.]+)",Rs="([\\d,_,.]+)",Ps="Unknown",Os=function(){function OperatingSystem(F){var B="undefined"!=typeof navigator?navigator.userAgent:"";if(F.userAgent&&(B=F.userAgent),B&&F.populateOperatingSystemInfo){var G=this._getOsName(B.toLowerCase());this.name=G,this.ver=this._getOsVersion(B,G)}}return OperatingSystem.prototype._getOsName=function(F){return F.match(bs.WINPHONE)?"Windows Phone":F.match(bs.WINRT)?"Windows RT":F.match(bs.WIN)?Es.WINDOWS:F.match(bs.IOS)?Es.IOS:F.match(bs.ANDROID)?Es.ANDROID:F.match(bs.LINUX)?"Linux":F.match(bs.CROS)?"Chrome OS":-1!==F.indexOf("x11")?"Unix":-1!==F.indexOf("blackberry")?"BlackBerry":-1!==F.indexOf("symbian")?"Symbian":-1!==F.indexOf("nokia")?"Nokia":F.match(bs.OSX)?Es.MACOSX:Ps},OperatingSystem.prototype._getOsVersion=function(F,B){return B===Es.WINDOWS?this._getGenericOsVersion(F,"Windows NT"):B===Es.ANDROID?this._getGenericOsVersion(F,B):B===Es.MACOSX?this._getMacOsxVersion(F):B===Es.IOS?this._getIosVersion(F):Ps},OperatingSystem.prototype._getGenericOsVersion=function(F,B){var G=F.match(new RegExp(B+" "+As));return G?Is[G[1]]?Is[G[1]]:G[1]:Ps},OperatingSystem.prototype._getMacOsxVersion=function(F){var B=F.match(new RegExp(Es.MACOSX+" "+Rs));if(B){var G=B[1].replace(/_/g,".");if(G){var W=this._getDelimiter(G);return W?G.split(W)[0]:G}}return Ps},OperatingSystem.prototype._getIosVersion=function(F){var B=F.match(new RegExp("OS "+Rs));if(B){var G=B[1].replace(/_/g,".");if(G){var W=this._getDelimiter(G);return W?G.split(W)[0]:G}}return Ps},OperatingSystem.prototype._getDelimiter=function(F){return F.indexOf(".")>-1?".":F.indexOf("_")>-1?"_":null},OperatingSystem}(),Ms=function(){function IntWeb(F,B){this.core=B,F.serviceName&&(this.serviceName=F.serviceName),this._cookieMgr=safeGetCookieMgr(B)}return IntWeb.prototype.getMsfpc=function(){return getCookieValue(this._cookieMgr,"MSFPC")},IntWeb.prototype.getAnid=function(){return getCookieValue(this._cookieMgr,"ANON").slice(0,34)},IntWeb._staticInit=(objDefineAccessors(IntWeb.prototype,"msfpc",IntWeb.prototype.getMsfpc),void objDefineAccessors(IntWeb.prototype,"anid",IntWeb.prototype.getAnid)),IntWeb}(),ws=1048576,Ds=2097152,Ns=function(){function Utc(F){this.popSample=100,this.eventFlags=0,F.hashIdentifiers&&(this.eventFlags=this.eventFlags|ws),F.dropIdentifiers&&(this.eventFlags=this.eventFlags|Ds)}return Utc}(),Ls=function(){function Loc(){var F=(new Date).getTimezoneOffset(),B=F%60,G=(F-B)/60,W="+";G>0&&(W="-"),G=Math.abs(G),B=Math.abs(B),this.tz=W+(G<10?"0"+G:G.toString())+":"+(B<10?"0"+B:B.toString())}return Loc}(),ks=function(){function Device(){}return Device}(),Fs=function(){function Session(){}return Session.prototype.setId=function(F){this.customId=F},Session.prototype.getId=function(){return isString(this.customId)?this.customId:this.automaticId},Session._staticInit=void objDefineAccessors(Session.prototype,"id",Session.prototype.getId,Session.prototype.setId),Session}(),xs=function(){function Trace(F,B,G,W){if(F.enableApplicationInsightsTrace){this.traceId=B||generateW3CId(),this.parentId=G,this.name=W;var z=getLocation();z&&z.pathname&&(this.name=z.pathname)}}return Trace}(),Us=function(){function AppExtensionKeys(){}return AppExtensionKeys.id="id",AppExtensionKeys.ver="ver",AppExtensionKeys.appName="name",AppExtensionKeys.locale="locale",AppExtensionKeys.expId="expId",AppExtensionKeys.env="env",AppExtensionKeys}(),js=function(){function WebExtensionKeys(){}return WebExtensionKeys.domain="domain",WebExtensionKeys.browser="browser",WebExtensionKeys.browserVer="browserVer",WebExtensionKeys.screenRes="screenRes",WebExtensionKeys.userConsent="userConsent",WebExtensionKeys.consentDetails="consentDetails",WebExtensionKeys}(),Bs=function(){function UserExtensionKeys(){}return UserExtensionKeys.locale="locale",UserExtensionKeys.localId="localId",UserExtensionKeys.id="id",UserExtensionKeys}(),Hs=function(){function OSExtKeys(){}return OSExtKeys.osName="name",OSExtKeys.ver="ver",OSExtKeys}(),Vs=function(){function SDKExtKeys(){}return SDKExtKeys.ver="ver",SDKExtKeys.seq="seq",SDKExtKeys.installId="installId",SDKExtKeys.epoch="epoch",SDKExtKeys}(),Gs=function(){function IntWebExtKeys(){}return IntWebExtKeys.msfpc="msfpc",IntWebExtKeys.anid="anid",IntWebExtKeys.serviceName="serviceName",IntWebExtKeys}(),Ws=function(){function UtcExtKeys(){}return UtcExtKeys.popSample="popSample",UtcExtKeys.eventFlags="eventFlags",UtcExtKeys}(),qs=function(){function LocExtKeys(){}return LocExtKeys.tz="tz",LocExtKeys}(),zs=function(){function SessionExtKeys(){}return SessionExtKeys.sessionId="sesId",SessionExtKeys}(),Ks=function(){function DeviceExtKeys(){}return DeviceExtKeys.localId="localId",DeviceExtKeys.deviceClass="deviceClass",DeviceExtKeys.make="make",DeviceExtKeys.model="model",DeviceExtKeys}(),Js=function(){function CloudExtKeys(){}return CloudExtKeys.role="role",CloudExtKeys.roleInstance="roleInstance",CloudExtKeys.roleVer="roleVer",CloudExtKeys}(),Qs=function(){function TraceExtKeys(){}return TraceExtKeys.traceId="traceID",TraceExtKeys.traceName="name",TraceExtKeys.parentId="parentID",TraceExtKeys}(),Ys=function(){function Extensions(){}return Extensions.UserExt="user",Extensions.DeviceExt="device",Extensions.TraceExt="trace",Extensions.WebExt="web",Extensions.AppExt="app",Extensions.OSExt="os",Extensions.SdkExt="sdk",Extensions.IntWebExt="intweb",Extensions.UtcExt="utc",Extensions.LocExt="loc",Extensions.CloudExt="cloud",Extensions}(),$s="MicrosoftApplicationsTelemetryDeviceId";
/**
	* Cloud.ts
	* @author Hector Hernandez (hectorh)
	* @copyright Microsoft 2020
	*/function _saveData(F,B,G,W){B?B.setProperty(G,W):F.set(G,W,31536e3)}function _getData(F,B,G){return B?B.getProperty(G)||"":getCookieValue(F,G)}var Xs,Zs,ec=function(){function Sdk(F,B){this._sequenceId=0;var G=F.propertyStorageOverride;this.seq=this._sequenceId,this.epoch=random32(!1).toString();var W=safeGetCookieMgr(B,F);if(W.isEnabled()||G){var z=_getData(W,G,$s);z||(z=newGuid()),_saveData(W,G,$s,z),this.installId=z}else W.purge($s)}return Sdk.prototype.getSequenceId=function(){return++this._sequenceId},Sdk}();function canUseLocalStorage(){return void 0===Xs&&(Xs=!!_getVerifiedStorageObject(Zs.LocalStorage)),Xs}function _getLocalStorageObject(){return canUseLocalStorage()?_getVerifiedStorageObject(Zs.LocalStorage):null}function _getVerifiedStorageObject(F){var B,G,W=null;try{var z=getGlobal$1();if(!z)return null;G=new Date,(W=F===Zs.LocalStorage?z.localStorage:z.sessionStorage)&&isFunction(W.setItem)&&(W.setItem(G,G),B=W.getItem(G)!==G,W.removeItem(G),B&&(W=null))}catch(F){W=null}return W}function setStorage(F,B,G){var W=_getLocalStorageObject();if(null!==W)try{return W.setItem(B,G),!0}catch(B){Xs=!1,F.throwInternal(Wn.CRITICAL,fr.BrowserCannotWriteLocalStorage,"Browser failed write to local storage. "+B)}return!1}function getStorage(F,B){var G=_getLocalStorageObject();if(null!==G)try{return G.getItem(B)}catch(B){Xs=!1,F.throwInternal(Wn.CRITICAL,fr.BrowserCannotReadLocalStorage,"Browser failed read of local storage. "+B)}return null}!function(F){F[F.LocalStorage=0]="LocalStorage",F[F.SessionStorage=1]="SessionStorage"}(Zs||(Zs={}));var tc=function(){function SessionManager(F,B){var G,W,z=safeGetLogger(F),K=safeGetCookieMgr(F);dynamicProto(SessionManager,this,(function(F){var J=getDefaultConfig(B);function getDefaultConfig(F){return{sessionRenewalMs:F.sessionRenewalMs&&function(){return F.sessionRenewalMs},sessionExpirationMs:F.sessionExpirationMs&&function(){return F.sessionExpirationMs},cookieDomain:F.cookieDomain&&function(){return F.cookieDomain},namePrefix:F.namePrefix&&function(){return F.namePrefix},sessionAsGuid:function(){return F.sessionAsGuid},idLength:function(){return F.idLength?F.idLength:22}}}function _initializeAutomaticSession(){var B=getCookie(W());if(B&&isFunction(B.split))_initializeAutomaticSessionWithData(B);else{var G=getStorage(z,W());G&&_initializeAutomaticSessionWithData(G)}F.automaticSession.getId()||_renew()}function _initializeAutomaticSessionWithData(B){var G=F.automaticSession,W=B.split("|");W.length>0&&G.setId(W[0]);try{if(W.length>1){var K=+W[1];G.acquisitionDate=+new Date(K),G.acquisitionDate=G.acquisitionDate>0?G.acquisitionDate:0}if(W.length>2){var J=+W[2];G.renewalDate=+new Date(J),G.renewalDate=G.renewalDate>0?G.renewalDate:0}}catch(F){z.throwInternal(Wn.CRITICAL,fr.ErrorParsingAISessionCookie,"Error parsing ai_session cookie, session will be reset: "+F)}0===G.renewalDate&&z.throwInternal(Wn.WARNING,fr.SessionRenewalDateIsZero,"AI session renewal date is 0, session will be reset.")}function _renew(){var B=F.automaticSession,G=(new Date).getTime(),W=F.config.sessionAsGuid();!isUndefined(W)&&W?isBoolean(W)?B.setId(createGuid()):B.setId(createGuid(W)):B.setId(newId(J&&J.idLength?J.idLength():22)),B.acquisitionDate=G,B.renewalDate=G,_setCookie(B.getId(),B.acquisitionDate,B.renewalDate),canUseLocalStorage()||z.throwInternal(Wn.WARNING,fr.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")}function _setCookie(B,z,J){var Q=z+F.config.sessionExpirationMs(),Y=J+F.config.sessionRenewalMs(),$=new Date,X=[B,z,J];Q<Y?$.setTime(Q):$.setTime(Y);var Z=F.config.cookieDomain?F.config.cookieDomain():null;K.set(W(),X.join("|")+";expires="+$.toUTCString(),null,Z),G=(new Date).getTime()}function _setStorage(F,B,G){setStorage(z,W(),[F,B,G].join("|"))}isFunction(B.sessionExpirationMs)||(J.sessionExpirationMs=function(){return SessionManager.acquisitionSpan}),isFunction(B.sessionRenewalMs)||(J.sessionRenewalMs=function(){return SessionManager.renewalSpan}),F.config=J,W=function(){return F.config.namePrefix&&F.config.namePrefix()?SessionManager.cookieNameConst+F.config.namePrefix():SessionManager.cookieNameConst},F.automaticSession=new Fs,F.update=function(){F.automaticSession.getId()||_initializeAutomaticSession();var B=F.automaticSession,W=F.config,z=(new Date).getTime(),K=z-B.acquisitionDate>W.sessionExpirationMs(),J=z-B.renewalDate>W.sessionRenewalMs();if(K||J)_renew();else{(!G||z-G>SessionManager.cookieUpdateInterval)&&(B.renewalDate=z,_setCookie(B.getId(),B.acquisitionDate,B.renewalDate))}},F.backup=function(){var B=F.automaticSession;_setStorage(B.getId(),B.acquisitionDate,B.renewalDate)}}))}return SessionManager.acquisitionSpan=864e5,SessionManager.renewalSpan=18e5,SessionManager.cookieUpdateInterval=6e4,SessionManager.cookieNameConst="ai_session",SessionManager}(),nc=isString,ic=function(){function TelemetryContext(F,B,G){this.app=new fs(B,G),this.cloud=new ms,this.user=new vs(F,B,G),this.os=new Os(B),this.web=new Ts(B,G),this.sdk=new ec(F,G),this.intWeb=new Ms(B,G),this.utc=new Ns(B),this.loc=new Ls,this.device=new ks,this.telemetryTrace=new xs(B),this.sessionManager=new tc(G,B),this.session=new Fs}return TelemetryContext.prototype.getSessionId=function(){var F=this.session;if(F&&nc(F.customId))return F.customId;var B=this.sessionManager;B.update();var G=B.automaticSession;if(G){var W=G.getId();W&&nc(W)&&(F.automaticId=W)}return F.automaticId},TelemetryContext.prototype.applyApplicationContext=function(F){var B=this.app;nc(B.id)&&(F.ext[Ys.AppExt][Us.id]=B.id),nc(B.ver)&&(F.ext[Ys.AppExt][Us.ver]=B.ver),nc(B.name)&&(F.ext[Ys.AppExt][Us.appName]=B.name),nc(B.locale)&&(F.ext[Ys.AppExt][Us.locale]=B.locale);var G=B.getExpId();nc(G)&&(F.ext[Ys.AppExt][Us.expId]=G),nc(B.env)&&(F.ext[Ys.AppExt][Us.env]=B.env)},TelemetryContext.prototype.applyUserContext=function(F){var B=this.user,G=B.getLocalId();nc(G)&&(F.ext[Ys.UserExt][Bs.localId]=G),nc(B.locale)&&(F.ext[Ys.UserExt][Bs.locale]=B.locale),nc(B.id)&&(F.ext[Ys.UserExt][Bs.id]=B.id)},TelemetryContext.prototype.applyWebContext=function(F){var B=this.web;nc(B.domain)&&(F.ext[Ys.WebExt][js.domain]=B.domain),nc(B.browser)&&(F.ext[Ys.WebExt][js.browser]=B.browser),nc(B.browserVer)&&(F.ext[Ys.WebExt][js.browserVer]=B.browserVer),nc(B.screenRes)&&(F.ext[Ys.WebExt][js.screenRes]=B.screenRes),F.ext[Ys.WebExt][js.userConsent]=B.getUserConsent(),F.ext[Ys.WebExt][js.consentDetails]=B.getUserConsentDetails()},TelemetryContext.prototype.applyOsContext=function(F){var B=this.os;nc(B.name)&&(F.ext[Ys.OSExt][Hs.osName]=B.name),nc(B.ver)&&(F.ext[Ys.OSExt][Hs.ver]=B.ver)},TelemetryContext.prototype.applySdkContext=function(F){var B=this.sdk;F.ext[Ys.SdkExt][Vs.seq]=B.getSequenceId(),F.ext[Ys.SdkExt][Vs.epoch]=B.epoch,nc(B.installId)&&(F.ext[Ys.SdkExt][Vs.installId]=B.installId)},TelemetryContext.prototype.applyIntWebContext=function(F){var B=this.intWeb,G=B.getMsfpc();nc(G)&&(F.ext[Ys.IntWebExt][Gs.msfpc]=G);var W=B.getAnid();nc(W)&&(F.ext[Ys.IntWebExt][Gs.anid]=W),nc(B.serviceName)&&(F.ext[Ys.IntWebExt][Gs.serviceName]=B.serviceName)},TelemetryContext.prototype.applyUtcContext=function(F){var B=this.utc;F.ext[Ys.UtcExt][Ws.popSample]=B.popSample,B.eventFlags>0&&(F.ext[Ys.UtcExt][Ws.eventFlags]=B.eventFlags)},TelemetryContext.prototype.applyLocContext=function(F){F.ext[Ys.LocExt][qs.tz]=this.loc.tz},TelemetryContext.prototype.applySessionContext=function(F){F.ext[Ys.AppExt][zs.sessionId]=this.getSessionId()},TelemetryContext.prototype.applyDeviceContext=function(F){var B=this.device;nc(B.localId)&&(F.ext[Ys.DeviceExt][Ks.localId]=B.localId),nc(B.make)&&(F.ext[Ys.DeviceExt][Ks.make]=B.make),nc(B.model)&&(F.ext[Ys.DeviceExt][Ks.model]=B.model),nc(B.deviceClass)&&(F.ext[Ys.DeviceExt][Ks.deviceClass]=B.deviceClass)},TelemetryContext.prototype.applyCloudContext=function(F){var B=this.cloud;nc(B.role)&&(F.ext[Ys.CloudExt][Js.role]=B.role),nc(B.roleInstance)&&(F.ext[Ys.CloudExt][Js.roleInstance]=B.roleInstance),nc(B.roleVer)&&(F.ext[Ys.CloudExt][Js.roleVer]=B.roleVer)},TelemetryContext.prototype.applyAITraceContext=function(F){var B=this.telemetryTrace;nc(B.traceId)&&(F.ext[Ys.TraceExt][Qs.traceId]=B.traceId),nc(B.name)&&(F.ext[Ys.TraceExt][Qs.traceName]=B.name),nc(B.parentId)&&(F.ext[Ys.TraceExt][Qs.parentId]=B.parentId)},TelemetryContext}(),rc=function(F){function PropertiesPlugin(){var B,G=F.call(this)||this;G.identifier="SystemPropertiesCollector",G.priority=3,G.version="3.1.2";var W={};return dynamicProto(PropertiesPlugin,G,(function(z,K){function _addPropertiesIfAbsent(F,B){F&&objForEachKey(F,(function(F,G){B[F]||(B[F]=G)}))}z.initialize=function(W,K,J){F.prototype.initialize.call(G,W,K,J),B=new ic(W,z._getTelCtx().getExtCfg(z.identifier),K)},z.processTelemetry=function(F,G){setProcessTelemetryTimings(F,z.identifier),G=z._getTelCtx(G);var K=F.ext=F.ext?F.ext:{};F.data=F.data?F.data:{},K[Ys.AppExt]=K[Ys.AppExt]||{},K[Ys.UserExt]=K[Ys.UserExt]||{},K[Ys.WebExt]=K[Ys.WebExt]||{},K[Ys.OSExt]=K[Ys.OSExt]||{},K[Ys.SdkExt]=K[Ys.SdkExt]||{},K[Ys.IntWebExt]=K[Ys.IntWebExt]||{},K[Ys.UtcExt]=K[Ys.UtcExt]||{},K[Ys.LocExt]=K[Ys.LocExt]||{},K[Ys.DeviceExt]=K[Ys.DeviceExt]||{},K[Ys.TraceExt]=K[Ys.TraceExt]||{},K[Ys.CloudExt]=K[Ys.CloudExt]||{},B.applyApplicationContext(F),B.applyUserContext(F),B.applyWebContext(F),B.applyOsContext(F),B.applySdkContext(F),B.applyIntWebContext(F),B.applyUtcContext(F),B.applyLocContext(F),B.applySessionContext(F),B.applyDeviceContext(F),B.applyAITraceContext(F),B.applyCloudContext(F),arrForEach(objKeys(K),(function(F){0===objKeys(K[F]).length&&delete K[F]})),_addPropertiesIfAbsent(W,F.data),z.processNext(F,G)},z.getPropertiesContext=function(){return B},z.setProperty=function(F,B){W[F]=B}})),G}return __extendsFn(PropertiesPlugin,F),PropertiesPlugin}(Mi),__awaiter$2=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};const oc=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","phrase","subCode","reason"];function toTsScalingMode(F){switch(F){case"Crop":return 1;case"Fit":return 2;default:return 0}}function getSizeInBytes(F,B){try{return"string"==typeof F?new Blob([F]).size:F.byteLength}catch(F){return B.error(F),0}}function shallowEqual(F,B){const G=Object.keys(F);for(let W of G)if(F[W]!==B[W])return!1;return!0}function convertMapToFrozenJson(F){let B={};return F.forEach(((F,G)=>{B[G]=F})),Object.freeze(B)}function defer(){let F,B,G=!0,W=new Promise(((G,W)=>{F=G,B=W}));return{isPending:()=>G,promise:W,resolve:B=>{G&&(F(B),G=!1)},reject:F=>{G&&(B(F),G=!1)},dispose:()=>{W=void 0}}}function assertNotNull(F,B){if(null===F)throw new CallingCommunicationError({message:"AssertNotNull failed. "+(void 0!==B?`: ${B}`:""),code:ne})}function assertIsObject(F,B){if("object"!=typeof F)throw new CallingCommunicationError({message:"AssertIsObject failed. "+(void 0!==B?`: ${B}`:""),code:ne})}function parseJWT(F){let[,B]=null==F?void 0:F.split(".");if(void 0===B)throw new CallingCommunicationError({message:"Invalid token",code:ne});return B=B.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape(atob(B))))}function logErrorAndThrow(F,B,G){const W=F;throw G.error(W),new CallingCommunicationError({message:W,code:B})}function noop(){}function isEudbLocation(F,B){return!!(null==B?void 0:B.countryCode)&&!!F.find((F=>F===(null==B?void 0:B.countryCode)))}function parseTokenCredential(F,B){var G;return __awaiter$2(this,void 0,void 0,(function*(){try{if(!F)throw new CallingCommunicationError({message:"No CommunicationTokenCredential provided",code:ne});let W;try{W=null===(G=yield F.getToken(B))||void 0===G?void 0:G.token}catch(F){throw new CallingCommunicationError({message:"Failed to get AccessToken",code:ne})}if(!W)throw new CallingCommunicationError({message:"AccessToken is empty",code:ne});try{let F=parseJWT(W);if(!F)throw new CallingCommunicationError({message:"Failed to parse AccessToken",code:ne});const B=F.resourceId,G=constructIdentifierKindFromMri(`8:${F.skypeid}`),z="microsoftTeamsUser"===(null==G?void 0:G.kind);if(!B&&!z)throw new CallingCommunicationError({message:"AccessToken does not contain ACS resource Id",code:ie});let K=F.skypeid;if(!K)throw new CallingCommunicationError({message:"AccessToken does not contain ACS user Id",code:ie});const J=getCloudTypeFromSkypeId(K),Q=!!F.tid;return{jwtToken:W,acsResourceId:B,identityMri:K,cloudType:J,isCte:Q,countryCode:F.dataLocation||""}}catch(F){throw new CallingCommunicationError({message:"Failed to parse AccessToken",code:ne},F)}}catch(F){throw new CallingCommunicationError({message:"AccessToken is invalid",code:ie},F)}}))}function buildCallingUserAgent(F,B,G){var W,z,K,J,Q,Y,$,X;const Z=`azsdk-js-communication-calling/${F}`;let ee="";if(null===(W=null==G?void 0:G.diagnostics)||void 0===W?void 0:W.appName){let F=null===(z=null==G?void 0:G.diagnostics)||void 0===z?void 0:z.appName.trim().replace(/\s/g,"_");F.length>0&&(B.warn("appName is to long, max allowed length is 64 chars, appName was truncated to max length"),F=F.substr(0,64)),ee+=F?`${F}/`:"default/"}else ee+="default/";if(null===(K=null==G?void 0:G.diagnostics)||void 0===K?void 0:K.appVersion){let F=null===(J=null==G?void 0:G.diagnostics)||void 0===J?void 0:J.appVersion.trim().replace(/\s/g,"_").substr(0,64);F.length>0&&(B.warn("appVersion is to long, max allowed length is 64 chars, appVersion was truncated to max length"),F=F.substr(0,64)),ee+=F||"0.0.0"}else ee+="0.0.0";if(ee+=` ${Z}`,(null===(Q=null==G?void 0:G.diagnostics)||void 0===Q?void 0:Q.tags)&&Array.isArray(null===(Y=null==G?void 0:G.diagnostics)||void 0===Y?void 0:Y.tags)&&(null===($=null==G?void 0:G.diagnostics)||void 0===$?void 0:$.tags.length)>0){let F=null===(X=null==G?void 0:G.diagnostics)||void 0===X?void 0:X.tags.map((F=>F.trim().replace(/\s/g,"_"))).filter((F=>!!F)).join(";");F.length>0&&(B.warn("tags are to long, max allowed length is 64 chars, tags were truncated to max length"),F=F.substr(0,64),ee+=" ("+F+").")}return`${ee} ${navigator.userAgent}`}function getJoinContextDescription(F){return F?F.groupId?Vt.GroupCall:!F.threadId||F.organizerId||F.tenantId||F.messageId?F.threadId&&F.organizerId&&F.tenantId&&F.messageId?Vt.TeamsCoordinates:F.meetingId?Vt.TeamsMeetingId:F.meetingLink?Vt.TeamsMeetingLink:F.roomId?Vt.RoomCall:"":Vt.GroupChatCall:""}function getPrintableObject(F,B=!1){const processStackTrace=F=>{try{return F.split("\n")[0]}catch(F){return"invalid stack"}};if(void 0===F)return"void";if(F instanceof Error)return F.toString();if(F instanceof String||F instanceof Number||F instanceof Boolean)return F.toString();try{return F.stack&&(F.stack=processStackTrace(F.stack)),(B?JSON.stringify(F):JSON.stringify(F,oc,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(B){return`failed to get error information:${F&&"function"==typeof F.toString&&F.toString()} ${F&&F.response&&JSON.stringify(F.response)}`}}function permissionStateToBool(F,B){return B.info("permission state to boolean",F),"granted"===F}function getSafeObjectDiff(F,B,G=[]){let W=[];try{const z=Array.isArray(F);for(const K in F){const J=F[K],Q=z?+K:K;if(!(K in B)){W.push({type:"REMOVE",path:[Q],oldValue:F[K]});continue}const Y=B[K],$="object"==typeof J&&"object"==typeof Y;if(J&&Y&&$&&!pe[Object.getPrototypeOf(J).constructor.name]&&!G.includes(J)){const F=getSafeObjectDiff(J,Y);W.push.apply(W,F.map((F=>(F.path.unshift(Q),F))))}else J===Y||$&&(isNaN(J)?J+""==Y+"":+J==+Y)||W.push({path:[Q],type:"CHANGE",value:Y,oldValue:J})}const K=Array.isArray(B);for(const G in B)G in F||W.push({type:"CREATE",path:[K?+G:G],value:B[G]})}catch(F){}return W}function advancedMeetingRoleToParticipantRole(F,B){const G={[F.roles.acsOrganizer.toLowerCase()]:Gt.Organizer,[F.roles.teamsOrganizer.toLowerCase()]:Gt.Organizer,[F.roles.acsPresenter.toLowerCase()]:Gt.Presenter,[F.roles.teamsPresenter.toLowerCase()]:Gt.Presenter,[F.roles.acsAttendee.toLowerCase()]:Gt.Attendee,[F.roles.teamsAttendee.toLowerCase()]:Gt.Attendee,[F.roles.acsConsumer.toLowerCase()]:Gt.Consumer};return B&&G[B.toString().toLowerCase()]?G[B.toString().toLowerCase()]:Gt.Unknown}var ac=createCommonjsModule((function(F,B){var G="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;B.assign=function(F){for(var B=Array.prototype.slice.call(arguments,1);B.length;){var G=B.shift();if(G){if("object"!=typeof G)throw new TypeError(G+"must be non-object");for(var W in G)G.hasOwnProperty(W)&&(F[W]=G[W])}}return F},B.shrinkBuf=function(F,B){return F.length===B?F:F.subarray?F.subarray(0,B):(F.length=B,F)};var W={arraySet:function(F,B,G,W,z){if(B.subarray&&F.subarray)F.set(B.subarray(G,G+W),z);else for(var K=0;K<W;K++)F[z+K]=B[G+K]},flattenChunks:function(F){var B,G,W,z,K,J;for(W=0,B=0,G=F.length;B<G;B++)W+=F[B].length;for(J=new Uint8Array(W),z=0,B=0,G=F.length;B<G;B++)K=F[B],J.set(K,z),z+=K.length;return J}},z={arraySet:function(F,B,G,W,z){for(var K=0;K<W;K++)F[z+K]=B[G+K]},flattenChunks:function(F){return[].concat.apply([],F)}};B.setTyped=function(F){F?(B.Buf8=Uint8Array,B.Buf16=Uint16Array,B.Buf32=Int32Array,B.assign(B,W)):(B.Buf8=Array,B.Buf16=Array,B.Buf32=Array,B.assign(B,z))},B.setTyped(G)})),sc=4,cc=0,lc=1,dc=2;function zero(F){for(var B=F.length;--B>=0;)F[B]=0}var uc=0,pc=1,hc=2,gc=3,fc=258,mc=29,vc=256,yc=vc+1+mc,Sc=30,_c=19,Cc=2*yc+1,Tc=15,Ec=16,bc=7,Ic=256,Ac=16,Rc=17,Pc=18,Oc=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Mc=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],wc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Dc=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Nc=512,Lc=new Array(2*(yc+2));zero(Lc);var kc=new Array(2*Sc);zero(kc);var Fc=new Array(Nc);zero(Fc);var xc=new Array(fc-gc+1);zero(xc);var Uc=new Array(mc);zero(Uc);var jc,Bc,Hc,Vc=new Array(Sc);function StaticTreeDesc(F,B,G,W,z){this.static_tree=F,this.extra_bits=B,this.extra_base=G,this.elems=W,this.max_length=z,this.has_stree=F&&F.length}function TreeDesc(F,B){this.dyn_tree=F,this.max_code=0,this.stat_desc=B}function d_code(F){return F<256?Fc[F]:Fc[256+(F>>>7)]}function put_short(F,B){F.pending_buf[F.pending++]=255&B,F.pending_buf[F.pending++]=B>>>8&255}function send_bits(F,B,G){F.bi_valid>Ec-G?(F.bi_buf|=B<<F.bi_valid&65535,put_short(F,F.bi_buf),F.bi_buf=B>>Ec-F.bi_valid,F.bi_valid+=G-Ec):(F.bi_buf|=B<<F.bi_valid&65535,F.bi_valid+=G)}function send_code(F,B,G){send_bits(F,G[2*B],G[2*B+1])}function bi_reverse(F,B){var G=0;do{G|=1&F,F>>>=1,G<<=1}while(--B>0);return G>>>1}function bi_flush(F){16===F.bi_valid?(put_short(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):F.bi_valid>=8&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)}function gen_bitlen(F,B){var G,W,z,K,J,Q,Y=B.dyn_tree,$=B.max_code,X=B.stat_desc.static_tree,Z=B.stat_desc.has_stree,ee=B.stat_desc.extra_bits,te=B.stat_desc.extra_base,ne=B.stat_desc.max_length,ie=0;for(K=0;K<=Tc;K++)F.bl_count[K]=0;for(Y[2*F.heap[F.heap_max]+1]=0,G=F.heap_max+1;G<Cc;G++)(K=Y[2*Y[2*(W=F.heap[G])+1]+1]+1)>ne&&(K=ne,ie++),Y[2*W+1]=K,W>$||(F.bl_count[K]++,J=0,W>=te&&(J=ee[W-te]),Q=Y[2*W],F.opt_len+=Q*(K+J),Z&&(F.static_len+=Q*(X[2*W+1]+J)));if(0!==ie){do{for(K=ne-1;0===F.bl_count[K];)K--;F.bl_count[K]--,F.bl_count[K+1]+=2,F.bl_count[ne]--,ie-=2}while(ie>0);for(K=ne;0!==K;K--)for(W=F.bl_count[K];0!==W;)(z=F.heap[--G])>$||(Y[2*z+1]!==K&&(F.opt_len+=(K-Y[2*z+1])*Y[2*z],Y[2*z+1]=K),W--)}}function gen_codes(F,B,G){var W,z,K=new Array(Tc+1),J=0;for(W=1;W<=Tc;W++)K[W]=J=J+G[W-1]<<1;for(z=0;z<=B;z++){var Q=F[2*z+1];0!==Q&&(F[2*z]=bi_reverse(K[Q]++,Q))}}function tr_static_init(){var F,B,G,W,z,K=new Array(Tc+1);for(G=0,W=0;W<mc-1;W++)for(Uc[W]=G,F=0;F<1<<Oc[W];F++)xc[G++]=W;for(xc[G-1]=W,z=0,W=0;W<16;W++)for(Vc[W]=z,F=0;F<1<<Mc[W];F++)Fc[z++]=W;for(z>>=7;W<Sc;W++)for(Vc[W]=z<<7,F=0;F<1<<Mc[W]-7;F++)Fc[256+z++]=W;for(B=0;B<=Tc;B++)K[B]=0;for(F=0;F<=143;)Lc[2*F+1]=8,F++,K[8]++;for(;F<=255;)Lc[2*F+1]=9,F++,K[9]++;for(;F<=279;)Lc[2*F+1]=7,F++,K[7]++;for(;F<=287;)Lc[2*F+1]=8,F++,K[8]++;for(gen_codes(Lc,yc+1,K),F=0;F<Sc;F++)kc[2*F+1]=5,kc[2*F]=bi_reverse(F,5);jc=new StaticTreeDesc(Lc,Oc,vc+1,yc,Tc),Bc=new StaticTreeDesc(kc,Mc,0,Sc,Tc),Hc=new StaticTreeDesc(new Array(0),wc,0,_c,bc)}function init_block(F){var B;for(B=0;B<yc;B++)F.dyn_ltree[2*B]=0;for(B=0;B<Sc;B++)F.dyn_dtree[2*B]=0;for(B=0;B<_c;B++)F.bl_tree[2*B]=0;F.dyn_ltree[2*Ic]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function bi_windup(F){F.bi_valid>8?put_short(F,F.bi_buf):F.bi_valid>0&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function copy_block(F,B,G,W){bi_windup(F),W&&(put_short(F,G),put_short(F,~G)),ac.arraySet(F.pending_buf,F.window,B,G,F.pending),F.pending+=G}function smaller(F,B,G,W){var z=2*B,K=2*G;return F[z]<F[K]||F[z]===F[K]&&W[B]<=W[G]}function pqdownheap(F,B,G){for(var W=F.heap[G],z=G<<1;z<=F.heap_len&&(z<F.heap_len&&smaller(B,F.heap[z+1],F.heap[z],F.depth)&&z++,!smaller(B,W,F.heap[z],F.depth));)F.heap[G]=F.heap[z],G=z,z<<=1;F.heap[G]=W}function compress_block(F,B,G){var W,z,K,J,Q=0;if(0!==F.last_lit)do{W=F.pending_buf[F.d_buf+2*Q]<<8|F.pending_buf[F.d_buf+2*Q+1],z=F.pending_buf[F.l_buf+Q],Q++,0===W?send_code(F,z,B):(send_code(F,(K=xc[z])+vc+1,B),0!==(J=Oc[K])&&send_bits(F,z-=Uc[K],J),send_code(F,K=d_code(--W),G),0!==(J=Mc[K])&&send_bits(F,W-=Vc[K],J))}while(Q<F.last_lit);send_code(F,Ic,B)}function build_tree(F,B){var G,W,z,K=B.dyn_tree,J=B.stat_desc.static_tree,Q=B.stat_desc.has_stree,Y=B.stat_desc.elems,$=-1;for(F.heap_len=0,F.heap_max=Cc,G=0;G<Y;G++)0!==K[2*G]?(F.heap[++F.heap_len]=$=G,F.depth[G]=0):K[2*G+1]=0;for(;F.heap_len<2;)K[2*(z=F.heap[++F.heap_len]=$<2?++$:0)]=1,F.depth[z]=0,F.opt_len--,Q&&(F.static_len-=J[2*z+1]);for(B.max_code=$,G=F.heap_len>>1;G>=1;G--)pqdownheap(F,K,G);z=Y;do{G=F.heap[1],F.heap[1]=F.heap[F.heap_len--],pqdownheap(F,K,1),W=F.heap[1],F.heap[--F.heap_max]=G,F.heap[--F.heap_max]=W,K[2*z]=K[2*G]+K[2*W],F.depth[z]=(F.depth[G]>=F.depth[W]?F.depth[G]:F.depth[W])+1,K[2*G+1]=K[2*W+1]=z,F.heap[1]=z++,pqdownheap(F,K,1)}while(F.heap_len>=2);F.heap[--F.heap_max]=F.heap[1],gen_bitlen(F,B),gen_codes(K,$,F.bl_count)}function scan_tree(F,B,G){var W,z,K=-1,J=B[1],Q=0,Y=7,$=4;for(0===J&&(Y=138,$=3),B[2*(G+1)+1]=65535,W=0;W<=G;W++)z=J,J=B[2*(W+1)+1],++Q<Y&&z===J||(Q<$?F.bl_tree[2*z]+=Q:0!==z?(z!==K&&F.bl_tree[2*z]++,F.bl_tree[2*Ac]++):Q<=10?F.bl_tree[2*Rc]++:F.bl_tree[2*Pc]++,Q=0,K=z,0===J?(Y=138,$=3):z===J?(Y=6,$=3):(Y=7,$=4))}function send_tree(F,B,G){var W,z,K=-1,J=B[1],Q=0,Y=7,$=4;for(0===J&&(Y=138,$=3),W=0;W<=G;W++)if(z=J,J=B[2*(W+1)+1],!(++Q<Y&&z===J)){if(Q<$)do{send_code(F,z,F.bl_tree)}while(0!=--Q);else 0!==z?(z!==K&&(send_code(F,z,F.bl_tree),Q--),send_code(F,Ac,F.bl_tree),send_bits(F,Q-3,2)):Q<=10?(send_code(F,Rc,F.bl_tree),send_bits(F,Q-3,3)):(send_code(F,Pc,F.bl_tree),send_bits(F,Q-11,7));Q=0,K=z,0===J?(Y=138,$=3):z===J?(Y=6,$=3):(Y=7,$=4)}}function build_bl_tree(F){var B;for(scan_tree(F,F.dyn_ltree,F.l_desc.max_code),scan_tree(F,F.dyn_dtree,F.d_desc.max_code),build_tree(F,F.bl_desc),B=_c-1;B>=3&&0===F.bl_tree[2*Dc[B]+1];B--);return F.opt_len+=3*(B+1)+5+5+4,B}function send_all_trees(F,B,G,W){var z;for(send_bits(F,B-257,5),send_bits(F,G-1,5),send_bits(F,W-4,4),z=0;z<W;z++)send_bits(F,F.bl_tree[2*Dc[z]+1],3);send_tree(F,F.dyn_ltree,B-1),send_tree(F,F.dyn_dtree,G-1)}function detect_data_type(F){var B,G=4093624447;for(B=0;B<=31;B++,G>>>=1)if(1&G&&0!==F.dyn_ltree[2*B])return cc;if(0!==F.dyn_ltree[18]||0!==F.dyn_ltree[20]||0!==F.dyn_ltree[26])return lc;for(B=32;B<vc;B++)if(0!==F.dyn_ltree[2*B])return lc;return cc}zero(Vc);var Gc=!1;function _tr_init(F){Gc||(tr_static_init(),Gc=!0),F.l_desc=new TreeDesc(F.dyn_ltree,jc),F.d_desc=new TreeDesc(F.dyn_dtree,Bc),F.bl_desc=new TreeDesc(F.bl_tree,Hc),F.bi_buf=0,F.bi_valid=0,init_block(F)}function _tr_stored_block(F,B,G,W){send_bits(F,(uc<<1)+(W?1:0),3),copy_block(F,B,G,!0)}function _tr_align(F){send_bits(F,pc<<1,3),send_code(F,Ic,Lc),bi_flush(F)}function _tr_flush_block(F,B,G,W){var z,K,J=0;F.level>0?(F.strm.data_type===dc&&(F.strm.data_type=detect_data_type(F)),build_tree(F,F.l_desc),build_tree(F,F.d_desc),J=build_bl_tree(F),z=F.opt_len+3+7>>>3,(K=F.static_len+3+7>>>3)<=z&&(z=K)):z=K=G+5,G+4<=z&&-1!==B?_tr_stored_block(F,B,G,W):F.strategy===sc||K===z?(send_bits(F,(pc<<1)+(W?1:0),3),compress_block(F,Lc,kc)):(send_bits(F,(hc<<1)+(W?1:0),3),send_all_trees(F,F.l_desc.max_code+1,F.d_desc.max_code+1,J+1),compress_block(F,F.dyn_ltree,F.dyn_dtree)),init_block(F),W&&bi_windup(F)}function _tr_tally(F,B,G){return F.pending_buf[F.d_buf+2*F.last_lit]=B>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&B,F.pending_buf[F.l_buf+F.last_lit]=255&G,F.last_lit++,0===B?F.dyn_ltree[2*G]++:(F.matches++,B--,F.dyn_ltree[2*(xc[G]+vc+1)]++,F.dyn_dtree[2*d_code(B)]++),F.last_lit===F.lit_bufsize-1}var Wc={_tr_init:_tr_init,_tr_stored_block:_tr_stored_block,_tr_flush_block:_tr_flush_block,_tr_tally:_tr_tally,_tr_align:_tr_align};function adler32(F,B,G,W){for(var z=65535&F|0,K=F>>>16&65535|0,J=0;0!==G;){G-=J=G>2e3?2e3:G;do{K=K+(z=z+B[W++]|0)|0}while(--J);z%=65521,K%=65521}return z|K<<16|0}var qc=adler32;function makeTable(){for(var F,B=[],G=0;G<256;G++){F=G;for(var W=0;W<8;W++)F=1&F?3988292384^F>>>1:F>>>1;B[G]=F}return B}var zc=makeTable();function crc32(F,B,G,W){var z=zc,K=W+G;F^=-1;for(var J=W;J<K;J++)F=F>>>8^z[255&(F^B[J])];return-1^F}var Kc,Jc=crc32,Qc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Yc=0,$c=1,Xc=3,Zc=4,el=5,tl=0,nl=1,il=-2,rl=-3,ol=-5,al=-1,sl=1,cl=2,ll=3,dl=4,ul=0,pl=2,hl=8,gl=9,fl=15,ml=8,vl=256+1+29,yl=30,Sl=19,_l=2*vl+1,Cl=15,Tl=3,El=258,bl=El+Tl+1,Il=32,Al=42,Rl=69,Pl=73,Ol=91,Ml=103,wl=113,Dl=666,Nl=1,Ll=2,kl=3,Fl=4,xl=3;function err(F,B){return F.msg=Qc[B],B}function rank(F){return(F<<1)-(F>4?9:0)}function zero$1(F){for(var B=F.length;--B>=0;)F[B]=0}function flush_pending(F){var B=F.state,G=B.pending;G>F.avail_out&&(G=F.avail_out),0!==G&&(ac.arraySet(F.output,B.pending_buf,B.pending_out,G,F.next_out),F.next_out+=G,B.pending_out+=G,F.total_out+=G,F.avail_out-=G,B.pending-=G,0===B.pending&&(B.pending_out=0))}function flush_block_only(F,B){Wc._tr_flush_block(F,F.block_start>=0?F.block_start:-1,F.strstart-F.block_start,B),F.block_start=F.strstart,flush_pending(F.strm)}function put_byte(F,B){F.pending_buf[F.pending++]=B}function putShortMSB(F,B){F.pending_buf[F.pending++]=B>>>8&255,F.pending_buf[F.pending++]=255&B}function read_buf(F,B,G,W){var z=F.avail_in;return z>W&&(z=W),0===z?0:(F.avail_in-=z,ac.arraySet(B,F.input,F.next_in,z,G),1===F.state.wrap?F.adler=qc(F.adler,B,z,G):2===F.state.wrap&&(F.adler=Jc(F.adler,B,z,G)),F.next_in+=z,F.total_in+=z,z)}function longest_match(F,B){var G,W,z=F.max_chain_length,K=F.strstart,J=F.prev_length,Q=F.nice_match,Y=F.strstart>F.w_size-bl?F.strstart-(F.w_size-bl):0,$=F.window,X=F.w_mask,Z=F.prev,ee=F.strstart+El,te=$[K+J-1],ne=$[K+J];F.prev_length>=F.good_match&&(z>>=2),Q>F.lookahead&&(Q=F.lookahead);do{if($[(G=B)+J]===ne&&$[G+J-1]===te&&$[G]===$[K]&&$[++G]===$[K+1]){K+=2,G++;do{}while($[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&$[++K]===$[++G]&&K<ee);if(W=El-(ee-K),K=ee-El,W>J){if(F.match_start=B,J=W,W>=Q)break;te=$[K+J-1],ne=$[K+J]}}}while((B=Z[B&X])>Y&&0!=--z);return J<=F.lookahead?J:F.lookahead}function fill_window(F){var B,G,W,z,K,J=F.w_size;do{if(z=F.window_size-F.lookahead-F.strstart,F.strstart>=J+(J-bl)){ac.arraySet(F.window,F.window,J,J,0),F.match_start-=J,F.strstart-=J,F.block_start-=J,B=G=F.hash_size;do{W=F.head[--B],F.head[B]=W>=J?W-J:0}while(--G);B=G=J;do{W=F.prev[--B],F.prev[B]=W>=J?W-J:0}while(--G);z+=J}if(0===F.strm.avail_in)break;if(G=read_buf(F.strm,F.window,F.strstart+F.lookahead,z),F.lookahead+=G,F.lookahead+F.insert>=Tl)for(K=F.strstart-F.insert,F.ins_h=F.window[K],F.ins_h=(F.ins_h<<F.hash_shift^F.window[K+1])&F.hash_mask;F.insert&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[K+Tl-1])&F.hash_mask,F.prev[K&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=K,K++,F.insert--,!(F.lookahead+F.insert<Tl)););}while(F.lookahead<bl&&0!==F.strm.avail_in)}function deflate_stored(F,B){var G=65535;for(G>F.pending_buf_size-5&&(G=F.pending_buf_size-5);;){if(F.lookahead<=1){if(fill_window(F),0===F.lookahead&&B===Yc)return Nl;if(0===F.lookahead)break}F.strstart+=F.lookahead,F.lookahead=0;var W=F.block_start+G;if((0===F.strstart||F.strstart>=W)&&(F.lookahead=F.strstart-W,F.strstart=W,flush_block_only(F,!1),0===F.strm.avail_out))return Nl;if(F.strstart-F.block_start>=F.w_size-bl&&(flush_block_only(F,!1),0===F.strm.avail_out))return Nl}return F.insert=0,B===Zc?(flush_block_only(F,!0),0===F.strm.avail_out?kl:Fl):(F.strstart>F.block_start&&(flush_block_only(F,!1),F.strm.avail_out),Nl)}function deflate_fast(F,B){for(var G,W;;){if(F.lookahead<bl){if(fill_window(F),F.lookahead<bl&&B===Yc)return Nl;if(0===F.lookahead)break}if(G=0,F.lookahead>=Tl&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Tl-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),0!==G&&F.strstart-G<=F.w_size-bl&&(F.match_length=longest_match(F,G)),F.match_length>=Tl)if(W=Wc._tr_tally(F,F.strstart-F.match_start,F.match_length-Tl),F.lookahead-=F.match_length,F.match_length<=F.max_lazy_match&&F.lookahead>=Tl){F.match_length--;do{F.strstart++,F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Tl-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart}while(0!=--F.match_length);F.strstart++}else F.strstart+=F.match_length,F.match_length=0,F.ins_h=F.window[F.strstart],F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+1])&F.hash_mask;else W=Wc._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++;if(W&&(flush_block_only(F,!1),0===F.strm.avail_out))return Nl}return F.insert=F.strstart<Tl-1?F.strstart:Tl-1,B===Zc?(flush_block_only(F,!0),0===F.strm.avail_out?kl:Fl):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Nl:Ll}function deflate_slow(F,B){for(var G,W,z;;){if(F.lookahead<bl){if(fill_window(F),F.lookahead<bl&&B===Yc)return Nl;if(0===F.lookahead)break}if(G=0,F.lookahead>=Tl&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Tl-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),F.prev_length=F.match_length,F.prev_match=F.match_start,F.match_length=Tl-1,0!==G&&F.prev_length<F.max_lazy_match&&F.strstart-G<=F.w_size-bl&&(F.match_length=longest_match(F,G),F.match_length<=5&&(F.strategy===sl||F.match_length===Tl&&F.strstart-F.match_start>4096)&&(F.match_length=Tl-1)),F.prev_length>=Tl&&F.match_length<=F.prev_length){z=F.strstart+F.lookahead-Tl,W=Wc._tr_tally(F,F.strstart-1-F.prev_match,F.prev_length-Tl),F.lookahead-=F.prev_length-1,F.prev_length-=2;do{++F.strstart<=z&&(F.ins_h=(F.ins_h<<F.hash_shift^F.window[F.strstart+Tl-1])&F.hash_mask,G=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart)}while(0!=--F.prev_length);if(F.match_available=0,F.match_length=Tl-1,F.strstart++,W&&(flush_block_only(F,!1),0===F.strm.avail_out))return Nl}else if(F.match_available){if((W=Wc._tr_tally(F,0,F.window[F.strstart-1]))&&flush_block_only(F,!1),F.strstart++,F.lookahead--,0===F.strm.avail_out)return Nl}else F.match_available=1,F.strstart++,F.lookahead--}return F.match_available&&(W=Wc._tr_tally(F,0,F.window[F.strstart-1]),F.match_available=0),F.insert=F.strstart<Tl-1?F.strstart:Tl-1,B===Zc?(flush_block_only(F,!0),0===F.strm.avail_out?kl:Fl):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Nl:Ll}function deflate_rle(F,B){for(var G,W,z,K,J=F.window;;){if(F.lookahead<=El){if(fill_window(F),F.lookahead<=El&&B===Yc)return Nl;if(0===F.lookahead)break}if(F.match_length=0,F.lookahead>=Tl&&F.strstart>0&&(W=J[z=F.strstart-1])===J[++z]&&W===J[++z]&&W===J[++z]){K=F.strstart+El;do{}while(W===J[++z]&&W===J[++z]&&W===J[++z]&&W===J[++z]&&W===J[++z]&&W===J[++z]&&W===J[++z]&&W===J[++z]&&z<K);F.match_length=El-(K-z),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=Tl?(G=Wc._tr_tally(F,1,F.match_length-Tl),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(G=Wc._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),G&&(flush_block_only(F,!1),0===F.strm.avail_out))return Nl}return F.insert=0,B===Zc?(flush_block_only(F,!0),0===F.strm.avail_out?kl:Fl):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Nl:Ll}function deflate_huff(F,B){for(var G;;){if(0===F.lookahead&&(fill_window(F),0===F.lookahead)){if(B===Yc)return Nl;break}if(F.match_length=0,G=Wc._tr_tally(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,G&&(flush_block_only(F,!1),0===F.strm.avail_out))return Nl}return F.insert=0,B===Zc?(flush_block_only(F,!0),0===F.strm.avail_out?kl:Fl):F.last_lit&&(flush_block_only(F,!1),0===F.strm.avail_out)?Nl:Ll}function Config(F,B,G,W,z){this.good_length=F,this.max_lazy=B,this.nice_length=G,this.max_chain=W,this.func=z}function lm_init(F){F.window_size=2*F.w_size,zero$1(F.head),F.max_lazy_match=Kc[F.level].max_lazy,F.good_match=Kc[F.level].good_length,F.nice_match=Kc[F.level].nice_length,F.max_chain_length=Kc[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=Tl-1,F.match_available=0,F.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=hl,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ac.Buf16(2*_l),this.dyn_dtree=new ac.Buf16(2*(2*yl+1)),this.bl_tree=new ac.Buf16(2*(2*Sl+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ac.Buf16(Cl+1),this.heap=new ac.Buf16(2*vl+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ac.Buf16(2*vl+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(F){var B;return F&&F.state?(F.total_in=F.total_out=0,F.data_type=pl,(B=F.state).pending=0,B.pending_out=0,B.wrap<0&&(B.wrap=-B.wrap),B.status=B.wrap?Al:wl,F.adler=2===B.wrap?0:1,B.last_flush=Yc,Wc._tr_init(B),tl):err(F,il)}function deflateReset(F){var B=deflateResetKeep(F);return B===tl&&lm_init(F.state),B}function deflateSetHeader(F,B){return F&&F.state?2!==F.state.wrap?il:(F.state.gzhead=B,tl):il}function deflateInit2(F,B,G,W,z,K){if(!F)return il;var J=1;if(B===al&&(B=6),W<0?(J=0,W=-W):W>15&&(J=2,W-=16),z<1||z>gl||G!==hl||W<8||W>15||B<0||B>9||K<0||K>dl)return err(F,il);8===W&&(W=9);var Q=new DeflateState;return F.state=Q,Q.strm=F,Q.wrap=J,Q.gzhead=null,Q.w_bits=W,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=z+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+Tl-1)/Tl),Q.window=new ac.Buf8(2*Q.w_size),Q.head=new ac.Buf16(Q.hash_size),Q.prev=new ac.Buf16(Q.w_size),Q.lit_bufsize=1<<z+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new ac.Buf8(Q.pending_buf_size),Q.d_buf=Q.lit_bufsize>>1,Q.l_buf=3*Q.lit_bufsize,Q.level=B,Q.strategy=K,Q.method=G,deflateReset(F)}function deflateInit(F,B){return deflateInit2(F,B,hl,fl,ml,ul)}function deflate(F,B){var G,W,z,K;if(!F||!F.state||B>el||B<0)return F?err(F,il):il;if(W=F.state,!F.output||!F.input&&0!==F.avail_in||W.status===Dl&&B!==Zc)return err(F,0===F.avail_out?ol:il);if(W.strm=F,G=W.last_flush,W.last_flush=B,W.status===Al)if(2===W.wrap)F.adler=0,put_byte(W,31),put_byte(W,139),put_byte(W,8),W.gzhead?(put_byte(W,(W.gzhead.text?1:0)+(W.gzhead.hcrc?2:0)+(W.gzhead.extra?4:0)+(W.gzhead.name?8:0)+(W.gzhead.comment?16:0)),put_byte(W,255&W.gzhead.time),put_byte(W,W.gzhead.time>>8&255),put_byte(W,W.gzhead.time>>16&255),put_byte(W,W.gzhead.time>>24&255),put_byte(W,9===W.level?2:W.strategy>=cl||W.level<2?4:0),put_byte(W,255&W.gzhead.os),W.gzhead.extra&&W.gzhead.extra.length&&(put_byte(W,255&W.gzhead.extra.length),put_byte(W,W.gzhead.extra.length>>8&255)),W.gzhead.hcrc&&(F.adler=Jc(F.adler,W.pending_buf,W.pending,0)),W.gzindex=0,W.status=Rl):(put_byte(W,0),put_byte(W,0),put_byte(W,0),put_byte(W,0),put_byte(W,0),put_byte(W,9===W.level?2:W.strategy>=cl||W.level<2?4:0),put_byte(W,xl),W.status=wl);else{var J=hl+(W.w_bits-8<<4)<<8;J|=(W.strategy>=cl||W.level<2?0:W.level<6?1:6===W.level?2:3)<<6,0!==W.strstart&&(J|=Il),J+=31-J%31,W.status=wl,putShortMSB(W,J),0!==W.strstart&&(putShortMSB(W,F.adler>>>16),putShortMSB(W,65535&F.adler)),F.adler=1}if(W.status===Rl)if(W.gzhead.extra){for(z=W.pending;W.gzindex<(65535&W.gzhead.extra.length)&&(W.pending!==W.pending_buf_size||(W.gzhead.hcrc&&W.pending>z&&(F.adler=Jc(F.adler,W.pending_buf,W.pending-z,z)),flush_pending(F),z=W.pending,W.pending!==W.pending_buf_size));)put_byte(W,255&W.gzhead.extra[W.gzindex]),W.gzindex++;W.gzhead.hcrc&&W.pending>z&&(F.adler=Jc(F.adler,W.pending_buf,W.pending-z,z)),W.gzindex===W.gzhead.extra.length&&(W.gzindex=0,W.status=Pl)}else W.status=Pl;if(W.status===Pl)if(W.gzhead.name){z=W.pending;do{if(W.pending===W.pending_buf_size&&(W.gzhead.hcrc&&W.pending>z&&(F.adler=Jc(F.adler,W.pending_buf,W.pending-z,z)),flush_pending(F),z=W.pending,W.pending===W.pending_buf_size)){K=1;break}K=W.gzindex<W.gzhead.name.length?255&W.gzhead.name.charCodeAt(W.gzindex++):0,put_byte(W,K)}while(0!==K);W.gzhead.hcrc&&W.pending>z&&(F.adler=Jc(F.adler,W.pending_buf,W.pending-z,z)),0===K&&(W.gzindex=0,W.status=Ol)}else W.status=Ol;if(W.status===Ol)if(W.gzhead.comment){z=W.pending;do{if(W.pending===W.pending_buf_size&&(W.gzhead.hcrc&&W.pending>z&&(F.adler=Jc(F.adler,W.pending_buf,W.pending-z,z)),flush_pending(F),z=W.pending,W.pending===W.pending_buf_size)){K=1;break}K=W.gzindex<W.gzhead.comment.length?255&W.gzhead.comment.charCodeAt(W.gzindex++):0,put_byte(W,K)}while(0!==K);W.gzhead.hcrc&&W.pending>z&&(F.adler=Jc(F.adler,W.pending_buf,W.pending-z,z)),0===K&&(W.status=Ml)}else W.status=Ml;if(W.status===Ml&&(W.gzhead.hcrc?(W.pending+2>W.pending_buf_size&&flush_pending(F),W.pending+2<=W.pending_buf_size&&(put_byte(W,255&F.adler),put_byte(W,F.adler>>8&255),F.adler=0,W.status=wl)):W.status=wl),0!==W.pending){if(flush_pending(F),0===F.avail_out)return W.last_flush=-1,tl}else if(0===F.avail_in&&rank(B)<=rank(G)&&B!==Zc)return err(F,ol);if(W.status===Dl&&0!==F.avail_in)return err(F,ol);if(0!==F.avail_in||0!==W.lookahead||B!==Yc&&W.status!==Dl){var Q=W.strategy===cl?deflate_huff(W,B):W.strategy===ll?deflate_rle(W,B):Kc[W.level].func(W,B);if(Q!==kl&&Q!==Fl||(W.status=Dl),Q===Nl||Q===kl)return 0===F.avail_out&&(W.last_flush=-1),tl;if(Q===Ll&&(B===$c?Wc._tr_align(W):B!==el&&(Wc._tr_stored_block(W,0,0,!1),B===Xc&&(zero$1(W.head),0===W.lookahead&&(W.strstart=0,W.block_start=0,W.insert=0))),flush_pending(F),0===F.avail_out))return W.last_flush=-1,tl}return B!==Zc?tl:W.wrap<=0?nl:(2===W.wrap?(put_byte(W,255&F.adler),put_byte(W,F.adler>>8&255),put_byte(W,F.adler>>16&255),put_byte(W,F.adler>>24&255),put_byte(W,255&F.total_in),put_byte(W,F.total_in>>8&255),put_byte(W,F.total_in>>16&255),put_byte(W,F.total_in>>24&255)):(putShortMSB(W,F.adler>>>16),putShortMSB(W,65535&F.adler)),flush_pending(F),W.wrap>0&&(W.wrap=-W.wrap),0!==W.pending?tl:nl)}function deflateEnd(F){var B;return F&&F.state?(B=F.state.status)!==Al&&B!==Rl&&B!==Pl&&B!==Ol&&B!==Ml&&B!==wl&&B!==Dl?err(F,il):(F.state=null,B===wl?err(F,rl):tl):il}function deflateSetDictionary(F,B){var G,W,z,K,J,Q,Y,$,X=B.length;if(!F||!F.state)return il;if(2===(K=(G=F.state).wrap)||1===K&&G.status!==Al||G.lookahead)return il;for(1===K&&(F.adler=qc(F.adler,B,X,0)),G.wrap=0,X>=G.w_size&&(0===K&&(zero$1(G.head),G.strstart=0,G.block_start=0,G.insert=0),$=new ac.Buf8(G.w_size),ac.arraySet($,B,X-G.w_size,G.w_size,0),B=$,X=G.w_size),J=F.avail_in,Q=F.next_in,Y=F.input,F.avail_in=X,F.next_in=0,F.input=B,fill_window(G);G.lookahead>=Tl;){W=G.strstart,z=G.lookahead-(Tl-1);do{G.ins_h=(G.ins_h<<G.hash_shift^G.window[W+Tl-1])&G.hash_mask,G.prev[W&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=W,W++}while(--z);G.strstart=W,G.lookahead=Tl-1,fill_window(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=Tl-1,G.match_available=0,F.next_in=Q,F.input=Y,F.avail_in=J,G.wrap=K,tl}Kc=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];var Ul={deflateInit:deflateInit,deflateInit2:deflateInit2,deflateReset:deflateReset,deflateResetKeep:deflateResetKeep,deflateSetHeader:deflateSetHeader,deflate:deflate,deflateEnd:deflateEnd,deflateSetDictionary:deflateSetDictionary,deflateInfo:"pako deflate (from Nodeca project)"},jl=!0,Bl=!0;try{String.fromCharCode.apply(null,[0])}catch(F){jl=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(F){Bl=!1}for(var Hl=new ac.Buf8(256),Vl=0;Vl<256;Vl++)Hl[Vl]=Vl>=252?6:Vl>=248?5:Vl>=240?4:Vl>=224?3:Vl>=192?2:1;function buf2binstring(F,B){if(B<65537&&(F.subarray&&Bl||!F.subarray&&jl))return String.fromCharCode.apply(null,ac.shrinkBuf(F,B));for(var G="",W=0;W<B;W++)G+=String.fromCharCode(F[W]);return G}Hl[254]=Hl[254]=1;var Gl={string2buf:function(F){var B,G,W,z,K,J=F.length,Q=0;for(z=0;z<J;z++)55296==(64512&(G=F.charCodeAt(z)))&&z+1<J&&56320==(64512&(W=F.charCodeAt(z+1)))&&(G=65536+(G-55296<<10)+(W-56320),z++),Q+=G<128?1:G<2048?2:G<65536?3:4;for(B=new ac.Buf8(Q),K=0,z=0;K<Q;z++)55296==(64512&(G=F.charCodeAt(z)))&&z+1<J&&56320==(64512&(W=F.charCodeAt(z+1)))&&(G=65536+(G-55296<<10)+(W-56320),z++),G<128?B[K++]=G:G<2048?(B[K++]=192|G>>>6,B[K++]=128|63&G):G<65536?(B[K++]=224|G>>>12,B[K++]=128|G>>>6&63,B[K++]=128|63&G):(B[K++]=240|G>>>18,B[K++]=128|G>>>12&63,B[K++]=128|G>>>6&63,B[K++]=128|63&G);return B},buf2binstring:function(F){return buf2binstring(F,F.length)},binstring2buf:function(F){for(var B=new ac.Buf8(F.length),G=0,W=B.length;G<W;G++)B[G]=F.charCodeAt(G);return B},buf2string:function(F,B){var G,W,z,K,J=B||F.length,Q=new Array(2*J);for(W=0,G=0;G<J;)if((z=F[G++])<128)Q[W++]=z;else if((K=Hl[z])>4)Q[W++]=65533,G+=K-1;else{for(z&=2===K?31:3===K?15:7;K>1&&G<J;)z=z<<6|63&F[G++],K--;K>1?Q[W++]=65533:z<65536?Q[W++]=z:(z-=65536,Q[W++]=55296|z>>10&1023,Q[W++]=56320|1023&z)}return buf2binstring(Q,W)},utf8border:function(F,B){var G;for((B=B||F.length)>F.length&&(B=F.length),G=B-1;G>=0&&128==(192&F[G]);)G--;return G<0||0===G?B:G+Hl[F[G]]>B?G:B}};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Wl=ZStream,ql=Object.prototype.toString,zl=0,Kl=4,Jl=0,Ql=1,Yl=2,$l=-1,Xl=0,Zl=8;function Deflate(F){if(!(this instanceof Deflate))return new Deflate(F);this.options=ac.assign({level:$l,method:Zl,chunkSize:16384,windowBits:15,memLevel:8,strategy:Xl,to:""},F||{});var B=this.options;B.raw&&B.windowBits>0?B.windowBits=-B.windowBits:B.gzip&&B.windowBits>0&&B.windowBits<16&&(B.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wl,this.strm.avail_out=0;var G=Ul.deflateInit2(this.strm,B.level,B.method,B.windowBits,B.memLevel,B.strategy);if(G!==Jl)throw new Error(Qc[G]);if(B.header&&Ul.deflateSetHeader(this.strm,B.header),B.dictionary){var W;if(W="string"==typeof B.dictionary?Gl.string2buf(B.dictionary):"[object ArrayBuffer]"===ql.call(B.dictionary)?new Uint8Array(B.dictionary):B.dictionary,(G=Ul.deflateSetDictionary(this.strm,W))!==Jl)throw new Error(Qc[G]);this._dict_set=!0}}function deflate$1(F,B){var G=new Deflate(B);if(G.push(F,!0),G.err)throw G.msg;return G.result}function deflateRaw(F,B){return(B=B||{}).raw=!0,deflate$1(F,B)}function gzip(F,B){return(B=B||{}).gzip=!0,deflate$1(F,B)}Deflate.prototype.push=function(F,B){var G,W,z=this.strm,K=this.options.chunkSize;if(this.ended)return!1;W=B===~~B?B:!0===B?Kl:zl,"string"==typeof F?z.input=Gl.string2buf(F):"[object ArrayBuffer]"===ql.call(F)?z.input=new Uint8Array(F):z.input=F,z.next_in=0,z.avail_in=z.input.length;do{if(0===z.avail_out&&(z.output=new ac.Buf8(K),z.next_out=0,z.avail_out=K),(G=Ul.deflate(z,W))!==Ql&&G!==Jl)return this.onEnd(G),this.ended=!0,!1;0!==z.avail_out&&(0!==z.avail_in||W!==Kl&&W!==Yl)||("string"===this.options.to?this.onData(Gl.buf2binstring(ac.shrinkBuf(z.output,z.next_out))):this.onData(ac.shrinkBuf(z.output,z.next_out)))}while((z.avail_in>0||0===z.avail_out)&&G!==Ql);return W===Kl?(G=Ul.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===Jl):W!==Yl||(this.onEnd(Jl),z.avail_out=0,!0)},Deflate.prototype.onData=function(F){this.chunks.push(F)},Deflate.prototype.onEnd=function(F){F===Jl&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ac.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.msg=this.strm.msg};var ed={Deflate:Deflate,deflate:deflate$1,deflateRaw:deflateRaw,gzip:gzip},td=30,nd=12,id=function inflate_fast(F,B){var G,W,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge;G=F.state,W=F.next_in,he=F.input,z=W+(F.avail_in-5),K=F.next_out,ge=F.output,J=K-(B-F.avail_out),Q=K+(F.avail_out-257),Y=G.dmax,$=G.wsize,X=G.whave,Z=G.wnext,ee=G.window,te=G.hold,ne=G.bits,ie=G.lencode,re=G.distcode,oe=(1<<G.lenbits)-1,ae=(1<<G.distbits)-1;e:do{ne<15&&(te+=he[W++]<<ne,ne+=8,te+=he[W++]<<ne,ne+=8),se=ie[te&oe];t:for(;;){if(te>>>=ce=se>>>24,ne-=ce,0===(ce=se>>>16&255))ge[K++]=65535&se;else{if(!(16&ce)){if(0==(64&ce)){se=ie[(65535&se)+(te&(1<<ce)-1)];continue t}if(32&ce){G.mode=nd;break e}F.msg="invalid literal/length code",G.mode=td;break e}le=65535&se,(ce&=15)&&(ne<ce&&(te+=he[W++]<<ne,ne+=8),le+=te&(1<<ce)-1,te>>>=ce,ne-=ce),ne<15&&(te+=he[W++]<<ne,ne+=8,te+=he[W++]<<ne,ne+=8),se=re[te&ae];n:for(;;){if(te>>>=ce=se>>>24,ne-=ce,!(16&(ce=se>>>16&255))){if(0==(64&ce)){se=re[(65535&se)+(te&(1<<ce)-1)];continue n}F.msg="invalid distance code",G.mode=td;break e}if(de=65535&se,ne<(ce&=15)&&(te+=he[W++]<<ne,(ne+=8)<ce&&(te+=he[W++]<<ne,ne+=8)),(de+=te&(1<<ce)-1)>Y){F.msg="invalid distance too far back",G.mode=td;break e}if(te>>>=ce,ne-=ce,de>(ce=K-J)){if((ce=de-ce)>X&&G.sane){F.msg="invalid distance too far back",G.mode=td;break e}if(ue=0,pe=ee,0===Z){if(ue+=$-ce,ce<le){le-=ce;do{ge[K++]=ee[ue++]}while(--ce);ue=K-de,pe=ge}}else if(Z<ce){if(ue+=$+Z-ce,(ce-=Z)<le){le-=ce;do{ge[K++]=ee[ue++]}while(--ce);if(ue=0,Z<le){le-=ce=Z;do{ge[K++]=ee[ue++]}while(--ce);ue=K-de,pe=ge}}}else if(ue+=Z-ce,ce<le){le-=ce;do{ge[K++]=ee[ue++]}while(--ce);ue=K-de,pe=ge}for(;le>2;)ge[K++]=pe[ue++],ge[K++]=pe[ue++],ge[K++]=pe[ue++],le-=3;le&&(ge[K++]=pe[ue++],le>1&&(ge[K++]=pe[ue++]))}else{ue=K-de;do{ge[K++]=ge[ue++],ge[K++]=ge[ue++],ge[K++]=ge[ue++],le-=3}while(le>2);le&&(ge[K++]=ge[ue++],le>1&&(ge[K++]=ge[ue++]))}break}}break}}while(W<z&&K<Q);W-=le=ne>>3,te&=(1<<(ne-=le<<3))-1,F.next_in=W,F.next_out=K,F.avail_in=W<z?z-W+5:5-(W-z),F.avail_out=K<Q?Q-K+257:257-(K-Q),G.hold=te,G.bits=ne},rd=15,od=852,ad=592,sd=0,cd=1,ld=2,dd=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ud=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],pd=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],hd=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],gd=function inflate_table(F,B,G,W,z,K,J,Q){var Y,$,X,Z,ee,te,ne,ie,re,oe=Q.bits,ae=0,se=0,ce=0,le=0,de=0,ue=0,pe=0,he=0,ge=0,fe=0,me=null,ve=0,ye=new ac.Buf16(rd+1),Se=new ac.Buf16(rd+1),_e=null,Ce=0;for(ae=0;ae<=rd;ae++)ye[ae]=0;for(se=0;se<W;se++)ye[B[G+se]]++;for(de=oe,le=rd;le>=1&&0===ye[le];le--);if(de>le&&(de=le),0===le)return z[K++]=20971520,z[K++]=20971520,Q.bits=1,0;for(ce=1;ce<le&&0===ye[ce];ce++);for(de<ce&&(de=ce),he=1,ae=1;ae<=rd;ae++)if(he<<=1,(he-=ye[ae])<0)return-1;if(he>0&&(F===sd||1!==le))return-1;for(Se[1]=0,ae=1;ae<rd;ae++)Se[ae+1]=Se[ae]+ye[ae];for(se=0;se<W;se++)0!==B[G+se]&&(J[Se[B[G+se]]++]=se);if(F===sd?(me=_e=J,te=19):F===cd?(me=dd,ve-=257,_e=ud,Ce-=257,te=256):(me=pd,_e=hd,te=-1),fe=0,se=0,ae=ce,ee=K,ue=de,pe=0,X=-1,Z=(ge=1<<de)-1,F===cd&&ge>od||F===ld&&ge>ad)return 1;for(;;){ne=ae-pe,J[se]<te?(ie=0,re=J[se]):J[se]>te?(ie=_e[Ce+J[se]],re=me[ve+J[se]]):(ie=96,re=0),Y=1<<ae-pe,ce=$=1<<ue;do{z[ee+(fe>>pe)+($-=Y)]=ne<<24|ie<<16|re|0}while(0!==$);for(Y=1<<ae-1;fe&Y;)Y>>=1;if(0!==Y?(fe&=Y-1,fe+=Y):fe=0,se++,0==--ye[ae]){if(ae===le)break;ae=B[G+J[se]]}if(ae>de&&(fe&Z)!==X){for(0===pe&&(pe=de),ee+=ce,he=1<<(ue=ae-pe);ue+pe<le&&!((he-=ye[ue+pe])<=0);)ue++,he<<=1;if(ge+=1<<ue,F===cd&&ge>od||F===ld&&ge>ad)return 1;z[X=fe&Z]=de<<24|ue<<16|ee-K|0}}return 0!==fe&&(z[ee+fe]=ae-pe<<24|64<<16|0),Q.bits=de,0},fd=0,md=1,vd=2,yd=4,Sd=5,_d=6,Cd=0,Td=1,Ed=2,bd=-2,Id=-3,Ad=-4,Rd=-5,Pd=8,Od=1,Md=2,wd=3,Dd=4,Nd=5,Ld=6,kd=7,Fd=8,xd=9,Ud=10,jd=11,Bd=12,Hd=13,Vd=14,Gd=15,Wd=16,qd=17,zd=18,Kd=19,Jd=20,Qd=21,Yd=22,$d=23,Xd=24,Zd=25,eu=26,tu=27,nu=28,iu=29,ru=30,ou=31,au=852,su=592,cu=15;function zswap32(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ac.Buf16(320),this.work=new ac.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(F){var B;return F&&F.state?(B=F.state,F.total_in=F.total_out=B.total=0,F.msg="",B.wrap&&(F.adler=1&B.wrap),B.mode=Od,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new ac.Buf32(au),B.distcode=B.distdyn=new ac.Buf32(su),B.sane=1,B.back=-1,Cd):bd}function inflateReset(F){var B;return F&&F.state?((B=F.state).wsize=0,B.whave=0,B.wnext=0,inflateResetKeep(F)):bd}function inflateReset2(F,B){var G,W;return F&&F.state?(W=F.state,B<0?(G=0,B=-B):(G=1+(B>>4),B<48&&(B&=15)),B&&(B<8||B>15)?bd:(null!==W.window&&W.wbits!==B&&(W.window=null),W.wrap=G,W.wbits=B,inflateReset(F))):bd}function inflateInit2(F,B){var G,W;return F?(W=new InflateState,F.state=W,W.window=null,(G=inflateReset2(F,B))!==Cd&&(F.state=null),G):bd}function inflateInit(F){return inflateInit2(F,cu)}var lu,du,uu=!0;function fixedtables(F){if(uu){var B;for(lu=new ac.Buf32(512),du=new ac.Buf32(32),B=0;B<144;)F.lens[B++]=8;for(;B<256;)F.lens[B++]=9;for(;B<280;)F.lens[B++]=7;for(;B<288;)F.lens[B++]=8;for(gd(md,F.lens,0,288,lu,0,F.work,{bits:9}),B=0;B<32;)F.lens[B++]=5;gd(vd,F.lens,0,32,du,0,F.work,{bits:5}),uu=!1}F.lencode=lu,F.lenbits=9,F.distcode=du,F.distbits=5}function updatewindow(F,B,G,W){var z,K=F.state;return null===K.window&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new ac.Buf8(K.wsize)),W>=K.wsize?(ac.arraySet(K.window,B,G-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):((z=K.wsize-K.wnext)>W&&(z=W),ac.arraySet(K.window,B,G-W,z,K.wnext),(W-=z)?(ac.arraySet(K.window,B,G-W,W,0),K.wnext=W,K.whave=K.wsize):(K.wnext+=z,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=z))),0}function inflate(F,B){var G,W,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge=0,fe=new ac.Buf8(4),me=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&0!==F.avail_in)return bd;(G=F.state).mode===Bd&&(G.mode=Hd),J=F.next_out,z=F.output,Y=F.avail_out,K=F.next_in,W=F.input,Q=F.avail_in,$=G.hold,X=G.bits,Z=Q,ee=Y,ue=Cd;e:for(;;)switch(G.mode){case Od:if(0===G.wrap){G.mode=Hd;break}for(;X<16;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if(2&G.wrap&&35615===$){G.check=0,fe[0]=255&$,fe[1]=$>>>8&255,G.check=Jc(G.check,fe,2,0),$=0,X=0,G.mode=Md;break}if(G.flags=0,G.head&&(G.head.done=!1),!(1&G.wrap)||(((255&$)<<8)+($>>8))%31){F.msg="incorrect header check",G.mode=ru;break}if((15&$)!==Pd){F.msg="unknown compression method",G.mode=ru;break}if(X-=4,de=8+(15&($>>>=4)),0===G.wbits)G.wbits=de;else if(de>G.wbits){F.msg="invalid window size",G.mode=ru;break}G.dmax=1<<de,F.adler=G.check=1,G.mode=512&$?Ud:Bd,$=0,X=0;break;case Md:for(;X<16;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if(G.flags=$,(255&G.flags)!==Pd){F.msg="unknown compression method",G.mode=ru;break}if(57344&G.flags){F.msg="unknown header flags set",G.mode=ru;break}G.head&&(G.head.text=$>>8&1),512&G.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,G.check=Jc(G.check,fe,2,0)),$=0,X=0,G.mode=wd;case wd:for(;X<32;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}G.head&&(G.head.time=$),512&G.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,fe[2]=$>>>16&255,fe[3]=$>>>24&255,G.check=Jc(G.check,fe,4,0)),$=0,X=0,G.mode=Dd;case Dd:for(;X<16;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}G.head&&(G.head.xflags=255&$,G.head.os=$>>8),512&G.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,G.check=Jc(G.check,fe,2,0)),$=0,X=0,G.mode=Nd;case Nd:if(1024&G.flags){for(;X<16;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}G.length=$,G.head&&(G.head.extra_len=$),512&G.flags&&(fe[0]=255&$,fe[1]=$>>>8&255,G.check=Jc(G.check,fe,2,0)),$=0,X=0}else G.head&&(G.head.extra=null);G.mode=Ld;case Ld:if(1024&G.flags&&((te=G.length)>Q&&(te=Q),te&&(G.head&&(de=G.head.extra_len-G.length,G.head.extra||(G.head.extra=new Array(G.head.extra_len)),ac.arraySet(G.head.extra,W,K,te,de)),512&G.flags&&(G.check=Jc(G.check,W,te,K)),Q-=te,K+=te,G.length-=te),G.length))break e;G.length=0,G.mode=kd;case kd:if(2048&G.flags){if(0===Q)break e;te=0;do{de=W[K+te++],G.head&&de&&G.length<65536&&(G.head.name+=String.fromCharCode(de))}while(de&&te<Q);if(512&G.flags&&(G.check=Jc(G.check,W,te,K)),Q-=te,K+=te,de)break e}else G.head&&(G.head.name=null);G.length=0,G.mode=Fd;case Fd:if(4096&G.flags){if(0===Q)break e;te=0;do{de=W[K+te++],G.head&&de&&G.length<65536&&(G.head.comment+=String.fromCharCode(de))}while(de&&te<Q);if(512&G.flags&&(G.check=Jc(G.check,W,te,K)),Q-=te,K+=te,de)break e}else G.head&&(G.head.comment=null);G.mode=xd;case xd:if(512&G.flags){for(;X<16;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if($!==(65535&G.check)){F.msg="header crc mismatch",G.mode=ru;break}$=0,X=0}G.head&&(G.head.hcrc=G.flags>>9&1,G.head.done=!0),F.adler=G.check=0,G.mode=Bd;break;case Ud:for(;X<32;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}F.adler=G.check=zswap32($),$=0,X=0,G.mode=jd;case jd:if(0===G.havedict)return F.next_out=J,F.avail_out=Y,F.next_in=K,F.avail_in=Q,G.hold=$,G.bits=X,Ed;F.adler=G.check=1,G.mode=Bd;case Bd:if(B===Sd||B===_d)break e;case Hd:if(G.last){$>>>=7&X,X-=7&X,G.mode=tu;break}for(;X<3;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}switch(G.last=1&$,X-=1,3&($>>>=1)){case 0:G.mode=Vd;break;case 1:if(fixedtables(G),G.mode=Jd,B===_d){$>>>=2,X-=2;break e}break;case 2:G.mode=qd;break;case 3:F.msg="invalid block type",G.mode=ru}$>>>=2,X-=2;break;case Vd:for($>>>=7&X,X-=7&X;X<32;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if((65535&$)!=($>>>16^65535)){F.msg="invalid stored block lengths",G.mode=ru;break}if(G.length=65535&$,$=0,X=0,G.mode=Gd,B===_d)break e;case Gd:G.mode=Wd;case Wd:if(te=G.length){if(te>Q&&(te=Q),te>Y&&(te=Y),0===te)break e;ac.arraySet(z,W,K,te,J),Q-=te,K+=te,Y-=te,J+=te,G.length-=te;break}G.mode=Bd;break;case qd:for(;X<14;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if(G.nlen=257+(31&$),$>>>=5,X-=5,G.ndist=1+(31&$),$>>>=5,X-=5,G.ncode=4+(15&$),$>>>=4,X-=4,G.nlen>286||G.ndist>30){F.msg="too many length or distance symbols",G.mode=ru;break}G.have=0,G.mode=zd;case zd:for(;G.have<G.ncode;){for(;X<3;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}G.lens[me[G.have++]]=7&$,$>>>=3,X-=3}for(;G.have<19;)G.lens[me[G.have++]]=0;if(G.lencode=G.lendyn,G.lenbits=7,pe={bits:G.lenbits},ue=gd(fd,G.lens,0,19,G.lencode,0,G.work,pe),G.lenbits=pe.bits,ue){F.msg="invalid code lengths set",G.mode=ru;break}G.have=0,G.mode=Kd;case Kd:for(;G.have<G.nlen+G.ndist;){for(;oe=(ge=G.lencode[$&(1<<G.lenbits)-1])>>>16&255,ae=65535&ge,!((re=ge>>>24)<=X);){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if(ae<16)$>>>=re,X-=re,G.lens[G.have++]=ae;else{if(16===ae){for(he=re+2;X<he;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if($>>>=re,X-=re,0===G.have){F.msg="invalid bit length repeat",G.mode=ru;break}de=G.lens[G.have-1],te=3+(3&$),$>>>=2,X-=2}else if(17===ae){for(he=re+3;X<he;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}X-=re,de=0,te=3+(7&($>>>=re)),$>>>=3,X-=3}else{for(he=re+7;X<he;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}X-=re,de=0,te=11+(127&($>>>=re)),$>>>=7,X-=7}if(G.have+te>G.nlen+G.ndist){F.msg="invalid bit length repeat",G.mode=ru;break}for(;te--;)G.lens[G.have++]=de}}if(G.mode===ru)break;if(0===G.lens[256]){F.msg="invalid code -- missing end-of-block",G.mode=ru;break}if(G.lenbits=9,pe={bits:G.lenbits},ue=gd(md,G.lens,0,G.nlen,G.lencode,0,G.work,pe),G.lenbits=pe.bits,ue){F.msg="invalid literal/lengths set",G.mode=ru;break}if(G.distbits=6,G.distcode=G.distdyn,pe={bits:G.distbits},ue=gd(vd,G.lens,G.nlen,G.ndist,G.distcode,0,G.work,pe),G.distbits=pe.bits,ue){F.msg="invalid distances set",G.mode=ru;break}if(G.mode=Jd,B===_d)break e;case Jd:G.mode=Qd;case Qd:if(Q>=6&&Y>=258){F.next_out=J,F.avail_out=Y,F.next_in=K,F.avail_in=Q,G.hold=$,G.bits=X,id(F,ee),J=F.next_out,z=F.output,Y=F.avail_out,K=F.next_in,W=F.input,Q=F.avail_in,$=G.hold,X=G.bits,G.mode===Bd&&(G.back=-1);break}for(G.back=0;oe=(ge=G.lencode[$&(1<<G.lenbits)-1])>>>16&255,ae=65535&ge,!((re=ge>>>24)<=X);){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if(oe&&0==(240&oe)){for(se=re,ce=oe,le=ae;oe=(ge=G.lencode[le+(($&(1<<se+ce)-1)>>se)])>>>16&255,ae=65535&ge,!(se+(re=ge>>>24)<=X);){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}$>>>=se,X-=se,G.back+=se}if($>>>=re,X-=re,G.back+=re,G.length=ae,0===oe){G.mode=eu;break}if(32&oe){G.back=-1,G.mode=Bd;break}if(64&oe){F.msg="invalid literal/length code",G.mode=ru;break}G.extra=15&oe,G.mode=Yd;case Yd:if(G.extra){for(he=G.extra;X<he;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}G.length+=$&(1<<G.extra)-1,$>>>=G.extra,X-=G.extra,G.back+=G.extra}G.was=G.length,G.mode=$d;case $d:for(;oe=(ge=G.distcode[$&(1<<G.distbits)-1])>>>16&255,ae=65535&ge,!((re=ge>>>24)<=X);){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if(0==(240&oe)){for(se=re,ce=oe,le=ae;oe=(ge=G.distcode[le+(($&(1<<se+ce)-1)>>se)])>>>16&255,ae=65535&ge,!(se+(re=ge>>>24)<=X);){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}$>>>=se,X-=se,G.back+=se}if($>>>=re,X-=re,G.back+=re,64&oe){F.msg="invalid distance code",G.mode=ru;break}G.offset=ae,G.extra=15&oe,G.mode=Xd;case Xd:if(G.extra){for(he=G.extra;X<he;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}G.offset+=$&(1<<G.extra)-1,$>>>=G.extra,X-=G.extra,G.back+=G.extra}if(G.offset>G.dmax){F.msg="invalid distance too far back",G.mode=ru;break}G.mode=Zd;case Zd:if(0===Y)break e;if(te=ee-Y,G.offset>te){if((te=G.offset-te)>G.whave&&G.sane){F.msg="invalid distance too far back",G.mode=ru;break}te>G.wnext?(te-=G.wnext,ne=G.wsize-te):ne=G.wnext-te,te>G.length&&(te=G.length),ie=G.window}else ie=z,ne=J-G.offset,te=G.length;te>Y&&(te=Y),Y-=te,G.length-=te;do{z[J++]=ie[ne++]}while(--te);0===G.length&&(G.mode=Qd);break;case eu:if(0===Y)break e;z[J++]=G.length,Y--,G.mode=Qd;break;case tu:if(G.wrap){for(;X<32;){if(0===Q)break e;Q--,$|=W[K++]<<X,X+=8}if(ee-=Y,F.total_out+=ee,G.total+=ee,ee&&(F.adler=G.check=G.flags?Jc(G.check,z,ee,J-ee):qc(G.check,z,ee,J-ee)),ee=Y,(G.flags?$:zswap32($))!==G.check){F.msg="incorrect data check",G.mode=ru;break}$=0,X=0}G.mode=nu;case nu:if(G.wrap&&G.flags){for(;X<32;){if(0===Q)break e;Q--,$+=W[K++]<<X,X+=8}if($!==(4294967295&G.total)){F.msg="incorrect length check",G.mode=ru;break}$=0,X=0}G.mode=iu;case iu:ue=Td;break e;case ru:ue=Id;break e;case ou:return Ad;default:return bd}return F.next_out=J,F.avail_out=Y,F.next_in=K,F.avail_in=Q,G.hold=$,G.bits=X,(G.wsize||ee!==F.avail_out&&G.mode<ru&&(G.mode<tu||B!==yd))&&updatewindow(F,F.output,F.next_out,ee-F.avail_out),Z-=F.avail_in,ee-=F.avail_out,F.total_in+=Z,F.total_out+=ee,G.total+=ee,G.wrap&&ee&&(F.adler=G.check=G.flags?Jc(G.check,z,ee,F.next_out-ee):qc(G.check,z,ee,F.next_out-ee)),F.data_type=G.bits+(G.last?64:0)+(G.mode===Bd?128:0)+(G.mode===Jd||G.mode===Gd?256:0),(0===Z&&0===ee||B===yd)&&ue===Cd&&(ue=Rd),ue}function inflateEnd(F){if(!F||!F.state)return bd;var B=F.state;return B.window&&(B.window=null),F.state=null,Cd}function inflateGetHeader(F,B){var G;return F&&F.state?0==(2&(G=F.state).wrap)?bd:(G.head=B,B.done=!1,Cd):bd}function inflateSetDictionary(F,B){var G,W=B.length;return F&&F.state?0!==(G=F.state).wrap&&G.mode!==jd?bd:G.mode===jd&&qc(1,B,W,0)!==G.check?Id:updatewindow(F,B,W,W)?(G.mode=ou,Ad):(G.havedict=1,Cd):bd}var pu={inflateReset:inflateReset,inflateReset2:inflateReset2,inflateResetKeep:inflateResetKeep,inflateInit:inflateInit,inflateInit2:inflateInit2,inflate:inflate,inflateEnd:inflateEnd,inflateGetHeader:inflateGetHeader,inflateSetDictionary:inflateSetDictionary,inflateInfo:"pako inflate (from Nodeca project)"},hu={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gu=GZheader,fu=Object.prototype.toString;function Inflate(F){if(!(this instanceof Inflate))return new Inflate(F);this.options=ac.assign({chunkSize:16384,windowBits:0,to:""},F||{});var B=this.options;B.raw&&B.windowBits>=0&&B.windowBits<16&&(B.windowBits=-B.windowBits,0===B.windowBits&&(B.windowBits=-15)),!(B.windowBits>=0&&B.windowBits<16)||F&&F.windowBits||(B.windowBits+=32),B.windowBits>15&&B.windowBits<48&&0==(15&B.windowBits)&&(B.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wl,this.strm.avail_out=0;var G=pu.inflateInit2(this.strm,B.windowBits);if(G!==hu.Z_OK)throw new Error(Qc[G]);this.header=new gu,pu.inflateGetHeader(this.strm,this.header)}function inflate$1(F,B){var G=new Inflate(B);if(G.push(F,!0),G.err)throw G.msg;return G.result}function inflateRaw(F,B){return(B=B||{}).raw=!0,inflate$1(F,B)}Inflate.prototype.push=function(F,B){var G,W,z,K,J,Q,Y=this.strm,$=this.options.chunkSize,X=this.options.dictionary,Z=!1;if(this.ended)return!1;W=B===~~B?B:!0===B?hu.Z_FINISH:hu.Z_NO_FLUSH,"string"==typeof F?Y.input=Gl.binstring2buf(F):"[object ArrayBuffer]"===fu.call(F)?Y.input=new Uint8Array(F):Y.input=F,Y.next_in=0,Y.avail_in=Y.input.length;do{if(0===Y.avail_out&&(Y.output=new ac.Buf8($),Y.next_out=0,Y.avail_out=$),(G=pu.inflate(Y,hu.Z_NO_FLUSH))===hu.Z_NEED_DICT&&X&&(Q="string"==typeof X?Gl.string2buf(X):"[object ArrayBuffer]"===fu.call(X)?new Uint8Array(X):X,G=pu.inflateSetDictionary(this.strm,Q)),G===hu.Z_BUF_ERROR&&!0===Z&&(G=hu.Z_OK,Z=!1),G!==hu.Z_STREAM_END&&G!==hu.Z_OK)return this.onEnd(G),this.ended=!0,!1;Y.next_out&&(0!==Y.avail_out&&G!==hu.Z_STREAM_END&&(0!==Y.avail_in||W!==hu.Z_FINISH&&W!==hu.Z_SYNC_FLUSH)||("string"===this.options.to?(z=Gl.utf8border(Y.output,Y.next_out),K=Y.next_out-z,J=Gl.buf2string(Y.output,z),Y.next_out=K,Y.avail_out=$-K,K&&ac.arraySet(Y.output,Y.output,z,K,0),this.onData(J)):this.onData(ac.shrinkBuf(Y.output,Y.next_out)))),0===Y.avail_in&&0===Y.avail_out&&(Z=!0)}while((Y.avail_in>0||0===Y.avail_out)&&G!==hu.Z_STREAM_END);return G===hu.Z_STREAM_END&&(W=hu.Z_FINISH),W===hu.Z_FINISH?(G=pu.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===hu.Z_OK):W!==hu.Z_SYNC_FLUSH||(this.onEnd(hu.Z_OK),Y.avail_out=0,!0)},Inflate.prototype.onData=function(F){this.chunks.push(F)},Inflate.prototype.onEnd=function(F){F===hu.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ac.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.msg=this.strm.msg};var mu={Inflate:Inflate,inflate:inflate$1,inflateRaw:inflateRaw,ungzip:inflate$1},vu={};(0,ac.assign)(vu,ed,mu,hu);var yu=vu;function defer$1(){let F,B,G=!0;return{isPending:()=>G,promise:new Promise(((G,W)=>{F=G,B=W})),resolve:B=>{G&&(F(B),G=!1)},reject:F=>{G&&(B(F),G=!1)}}}function sleep(F){return new Promise((B=>_setTimeout(B,F)))}function _setTimeout(F,B){return void 0!==window?window.setTimeout(F,B):setTimeout(F,B)}function _clearTimeout(F){void 0!==window?window.clearTimeout(F):clearTimeout(F)}function wait(F,B){let G,W=defer$1();try{G=F()}catch(F){return Promise.reject(W.reject(F))}if(B<0)return G.finally((()=>{W.resolve(G)})),W.promise;const z=_setTimeout((()=>{W.isPending()&&W.reject(new CallingCommunicationError({message:"Operation timed out",code:se}))}),B);return G.catch((F=>{_clearTimeout(z),W.isPending()&&W.reject(F)})),G.finally((()=>{_clearTimeout(z),W.isPending()&&W.resolve(G)})),W.promise}const Su="1.8.1.1_beta",_u="1.8.1-beta.1";function getSdkInternalVersion(){const F="ACS_CLIENT_INTERNAL_SZK_VERSION".replace("Z","D");return Su===F?"1.0.0.0":Su}function getSdkVersion(){const F="ACS_CLIENT_SZK_VERSION".replace("Z","D");return _u===F?"1.0.0.0":_u}function dictOrderGreaterFirst(F,B){var G=F.toString(),W=B.toString();return G>W?1:G<W?-1:0}var Cu=dictOrderGreaterFirst;function _classCallCheck(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function _defineProperties(F,B){for(var G=0;G<B.length;G++){var W=B[G];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(F,W.key,W)}}function _createClass(F,B,G){return B&&_defineProperties(F.prototype,B),G&&_defineProperties(F,G),F}function _defineProperty(F,B,G){return B in F?Object.defineProperty(F,B,{value:G,enumerable:!0,configurable:!0,writable:!0}):F[B]=G,F}var Tu=function(){function PriorityQueue(){var F=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).comparator,B=void 0===F?Cu:F;_classCallCheck(this,PriorityQueue),_defineProperty(this,"comparator",void 0),this.comparator=B}return _createClass(PriorityQueue,null,[{key:"from",value:function from(F,B){throw new Error("not implemented")}}]),_createClass(PriorityQueue,[{key:"clear",value:function clear(){throw new Error("not implemented")}},{key:"toArray",value:function toArray(){throw new Error("not implemented")}},{key:"push",value:function push(F){throw new Error("not implemented")}},{key:"enqueue",value:function enqueue(F){return this.push(F)}},{key:"top",value:function top(){throw new Error("not implemented")}},{key:"peek",value:function peek(){return this.top()}},{key:"pop",value:function pop(){throw new Error("not implemented")}},{key:"dequeue",value:function dequeue(){return this.pop()}},{key:"merge",value:function merge(F){throw new Error("not implemented")}},{key:"isEmpty",value:function isEmpty(){throw new Error("not implemented")}},{key:"length",get:function get(){throw new Error("not implemented")}}]),PriorityQueue}();function _typeof(F){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(F){return typeof F}:function _typeof(F){return F&&"function"==typeof Symbol&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},_typeof(F)}function _toConsumableArray(F){return _arrayWithoutHoles(F)||_iterableToArray(F)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(F){if(Symbol.iterator in Object(F)||"[object Arguments]"===Object.prototype.toString.call(F))return Array.from(F)}function _arrayWithoutHoles(F){if(Array.isArray(F)){for(var B=0,G=new Array(F.length);B<F.length;B++)G[B]=F[B];return G}}function _classCallCheck$1(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(F,B){for(var G=0;G<B.length;G++){var W=B[G];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(F,W.key,W)}}function _createClass$1(F,B,G){return B&&_defineProperties$1(F.prototype,B),G&&_defineProperties$1(F,G),F}function _possibleConstructorReturn(F,B){return!B||"object"!==_typeof(B)&&"function"!=typeof B?_assertThisInitialized(F):B}function _getPrototypeOf(F){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(F){return F.__proto__||Object.getPrototypeOf(F)},_getPrototypeOf(F)}function _assertThisInitialized(F){if(void 0===F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F}function _inherits(F,B){if("function"!=typeof B&&null!==B)throw new TypeError("Super expression must either be null or a function");F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,writable:!0,configurable:!0}}),B&&_setPrototypeOf(F,B)}function _setPrototypeOf(F,B){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(F,B){return F.__proto__=B,F},_setPrototypeOf(F,B)}function _defineProperty$1(F,B,G){return B in F?Object.defineProperty(F,B,{value:G,enumerable:!0,configurable:!0,writable:!0}):F[B]=G,F}function getLargestIndex(F,B,G){var W=2*B,z=2*B+1,K=B;return W<F.length&&G(F[K],F[W])<0&&(K=W),z<F.length&&G(F[K],F[z])<0&&(K=z),K}function heapify(F,B,G){var W=getLargestIndex(F,B,G);if(W!==B){var z=F[B];F[B]=F[W],F[W]=z,heapify(F,W,G)}}function heapifyAll(F){for(var B=Math.floor(F.collection.length/2)-1;B>=0;--B)heapify(F.collection,B,F.comparator)}var Eu=function(F){function BinaryHeap(){var F,B;_classCallCheck$1(this,BinaryHeap);for(var G=arguments.length,W=new Array(G),z=0;z<G;z++)W[z]=arguments[z];return _defineProperty$1(_assertThisInitialized(B=_possibleConstructorReturn(this,(F=_getPrototypeOf(BinaryHeap)).call.apply(F,[this].concat(W)))),"collection",[]),B}return _inherits(BinaryHeap,F),_createClass$1(BinaryHeap,[{key:"clear",value:function clear(){this.collection.length=0}},{key:"toArray",value:function toArray(){return _toConsumableArray(this.collection).sort(this.comparator)}},{key:"top",value:function top(){if(0===this.length)throw new Error("invalid operation: top() called for empty BinaryHeap");return this.collection[0]}},{key:"pop",value:function pop(){if(0===this.length)throw new Error("invalid operation: pop() called for empty BinaryHeap");var F=this.collection[0];return this.collection.length>1?(this.collection[0]=this.collection.pop(),heapify(this.collection,0,this.comparator)):this.collection.pop(),F}},{key:"push",value:function push(F){this.collection.push(F);for(var B=this.collection,G=B.length-1,W=Math.floor(G/2);G>0&&this.comparator(B[W],B[G])<0;G=W,W=Math.floor(W/2)){var z=B[G];B[G]=B[W],B[W]=z}}},{key:"merge",value:function merge(F){this.collection=F instanceof BinaryHeap?this.collection.concat(F.collection):this.collection.concat(F.toArray()),heapifyAll(this),F.clear()}},{key:"isEmpty",value:function isEmpty(){return!this.collection.length}},{key:"length",get:function get(){return this.collection.length}}],[{key:"from",value:function from(F){var B=new BinaryHeap(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return B.collection=Array.from(F),heapifyAll(B),B}}]),BinaryHeap}(Tu),bu=Eu;class NotificationManager$1{constructor(F,B){this._tenantId=F,this.listeners=[],this._logger=B.createChild(`TelemetryLogger[${F}]`);const G=this._tenantId;B.log(`Notification Manager Notification Manager logger initialized for tenant ${G}`),this._discardedEventsBufferPQ=new bu({comparator:(F,B)=>B.latency-F.latency})}addNotificationListener(F){this.listeners.push(F)}removeNotificationListener(F){this.listeners=this.listeners.filter((B=>B!==F))}eventsSent(F){const B=JSON.stringify(F);this._logger.log(`Notification Manager sent telemetry events ${B}`)}eventsDiscarded(F,B){this._logger.log(`Notification Manager discarded telemetry events ${JSON.stringify(F)}, reason ${B} adding to retry buffer`),F.forEach((F=>{F.latency=F.latency||hr.Normal;const B=F;(B.sendAttempt||0)<=getAcsEcsConfig().telemetry.discardedEventsMaxRetries?this._discardedEventsBufferPQ.push(B):this._logger.log(`Notification Manager dropping event due to too many retries ${JSON.stringify(F)}`)}));const G=getAcsEcsConfig().telemetry.discardedEventsBufferMaxLength;for(;this._discardedEventsBufferPQ.length>G;)this._logger.log(` dropping event from retry buffer ${this._discardedEventsBufferPQ.dequeue()} due to overflow`)}getDiscardedEvents(){const F=[],B=this._discardedEventsBufferPQ.length;for(let G=0;G<B;G++)F.push(this._discardedEventsBufferPQ.dequeue());return this._logger.log(`Notification Manager get retry bag ${JSON.stringify(F)}`),F}}var Iu=createCommonjsModule((function(F,B){!function(G,W){var z="1.0.2",K="",J="?",Q="function",Y="undefined",$="object",X="string",Z="major",ee="model",te="name",ne="type",ie="vendor",re="version",oe="architecture",ae="console",se="mobile",ce="tablet",le="smarttv",de="wearable",ue="embedded",pe=255,he="Amazon",ge="Apple",fe="ASUS",me="BlackBerry",ve="Browser",ye="Chrome",Se="Firefox",_e="Google",Ce="Huawei",Te="LG",Ee="Microsoft",be="Motorola",Ie="Opera",Ae="Samsung",Re="Sony",Pe="Xiaomi",Oe="Zebra",Me="Facebook",extend=function(F,B){var G={};for(var W in F)B[W]&&B[W].length%2==0?G[W]=B[W].concat(F[W]):G[W]=F[W];return G},enumerize=function(F){for(var B={},G=0;G<F.length;G++)B[F[G].toUpperCase()]=F[G];return B},has=function(F,B){return typeof F===X&&-1!==lowerize(B).indexOf(lowerize(F))},lowerize=function(F){return F.toLowerCase()},majorize=function(F){return typeof F===X?F.replace(/[^\d\.]/g,K).split(".")[0]:W},trim=function(F,B){if(typeof F===X)return F=F.replace(/^\s\s*/,K).replace(/\s\s*$/,K),typeof B===Y?F:F.substring(0,pe)},rgxMapper=function(F,B){for(var G,z,K,J,Y,X,Z=0;Z<B.length&&!Y;){var ee=B[Z],te=B[Z+1];for(G=z=0;G<ee.length&&!Y;)if(Y=ee[G++].exec(F))for(K=0;K<te.length;K++)X=Y[++z],typeof(J=te[K])===$&&J.length>0?2===J.length?typeof J[1]==Q?this[J[0]]=J[1].call(this,X):this[J[0]]=J[1]:3===J.length?typeof J[1]!==Q||J[1].exec&&J[1].test?this[J[0]]=X?X.replace(J[1],J[2]):W:this[J[0]]=X?J[1].call(this,X,J[2]):W:4===J.length&&(this[J[0]]=X?J[3].call(this,X.replace(J[1],J[2])):W):this[J]=X||W;Z+=2}},strMapper=function(F,B){for(var G in B)if(typeof B[G]===$&&B[G].length>0){for(var z=0;z<B[G].length;z++)if(has(B[G][z],F))return G===J?W:G}else if(has(B[G],F))return G===J?W:G;return F},we={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},De={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[re,[te,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[re,[te,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[te,re],[/opios[\/ ]+([\w\.]+)/i],[re,[te,Ie+" Mini"]],[/\bopr\/([\w\.]+)/i],[re,[te,Ie]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[te,re],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[re,[te,"UC"+ve]],[/\bqbcore\/([\w\.]+)/i],[re,[te,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[re,[te,"WeChat"]],[/konqueror\/([\w\.]+)/i],[re,[te,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[re,[te,"IE"]],[/yabrowser\/([\w\.]+)/i],[re,[te,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[te,/(.+)/,"$1 Secure "+ve],re],[/\bfocus\/([\w\.]+)/i],[re,[te,Se+" Focus"]],[/\bopt\/([\w\.]+)/i],[re,[te,Ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[re,[te,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[re,[te,"Dolphin"]],[/coast\/([\w\.]+)/i],[re,[te,Ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[re,[te,"MIUI "+ve]],[/fxios\/([-\w\.]+)/i],[re,[te,Se]],[/\bqihu|(qi?ho?o?|360)browser/i],[[te,"360 "+ve]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[te,/(.+)/,"$1 "+ve],re],[/(comodo_dragon)\/([\w\.]+)/i],[[te,/_/g," "],re],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[te,re],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[te],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[te,Me],re],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[te,re],[/\bgsa\/([\w\.]+) .*safari\//i],[re,[te,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[re,[te,ye+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[te,ye+" WebView"],re],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[re,[te,"Android "+ve]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[te,re],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[re,[te,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[re,te],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[te,[re,strMapper,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[te,re],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[te,"Netscape"],re],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[re,[te,Se+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[te,re]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[oe,"amd64"]],[/(ia32(?=;))/i],[[oe,lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[oe,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[oe,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[oe,"armhf"]],[/windows (ce|mobile); ppc;/i],[[oe,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[oe,/ower/,K,lowerize]],[/(sun4\w)[;\)]/i],[[oe,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[oe,lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[ee,[ie,Ae],[ne,ce]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[ee,[ie,Ae],[ne,se]],[/\((ip(?:hone|od)[\w ]*);/i],[ee,[ie,ge],[ne,se]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[ee,[ie,ge],[ne,ce]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[ee,[ie,Ce],[ne,ce]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[ee,[ie,Ce],[ne,se]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[ee,/_/g," "],[ie,Pe],[ne,se]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[ee,/_/g," "],[ie,Pe],[ne,ce]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[ee,[ie,"OPPO"],[ne,se]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[ee,[ie,"Vivo"],[ne,se]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[ee,[ie,"Realme"],[ne,se]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[ee,[ie,be],[ne,se]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[ee,[ie,be],[ne,ce]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[ee,[ie,Te],[ne,ce]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[ee,[ie,Te],[ne,se]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[ee,[ie,"Lenovo"],[ne,ce]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[ee,/_/g," "],[ie,"Nokia"],[ne,se]],[/(pixel c)\b/i],[ee,[ie,_e],[ne,ce]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[ee,[ie,_e],[ne,se]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[ee,[ie,Re],[ne,se]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[ee,"Xperia Tablet"],[ie,Re],[ne,ce]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[ee,[ie,"OnePlus"],[ne,se]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[ee,[ie,he],[ne,ce]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[ee,/(.+)/g,"Fire Phone $1"],[ie,he],[ne,se]],[/(playbook);[-\w\),; ]+(rim)/i],[ee,ie,[ne,ce]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[ee,[ie,me],[ne,se]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[ee,[ie,fe],[ne,ce]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[ee,[ie,fe],[ne,se]],[/(nexus 9)/i],[ee,[ie,"HTC"],[ne,ce]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[ie,[ee,/_/g," "],[ne,se]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[ee,[ie,"Acer"],[ne,ce]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[ee,[ie,"Meizu"],[ne,se]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[ee,[ie,"Sharp"],[ne,se]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[ie,ee,[ne,se]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[ie,ee,[ne,ce]],[/(surface duo)/i],[ee,[ie,Ee],[ne,ce]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[ee,[ie,"Fairphone"],[ne,se]],[/(u304aa)/i],[ee,[ie,"AT&T"],[ne,se]],[/\bsie-(\w*)/i],[ee,[ie,"Siemens"],[ne,se]],[/\b(rct\w+) b/i],[ee,[ie,"RCA"],[ne,ce]],[/\b(venue[\d ]{2,7}) b/i],[ee,[ie,"Dell"],[ne,ce]],[/\b(q(?:mv|ta)\w+) b/i],[ee,[ie,"Verizon"],[ne,ce]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[ee,[ie,"Barnes & Noble"],[ne,ce]],[/\b(tm\d{3}\w+) b/i],[ee,[ie,"NuVision"],[ne,ce]],[/\b(k88) b/i],[ee,[ie,"ZTE"],[ne,ce]],[/\b(nx\d{3}j) b/i],[ee,[ie,"ZTE"],[ne,se]],[/\b(gen\d{3}) b.+49h/i],[ee,[ie,"Swiss"],[ne,se]],[/\b(zur\d{3}) b/i],[ee,[ie,"Swiss"],[ne,ce]],[/\b((zeki)?tb.*\b) b/i],[ee,[ie,"Zeki"],[ne,ce]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[ie,"Dragon Touch"],ee,[ne,ce]],[/\b(ns-?\w{0,9}) b/i],[ee,[ie,"Insignia"],[ne,ce]],[/\b((nxa|next)-?\w{0,9}) b/i],[ee,[ie,"NextBook"],[ne,ce]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[ie,"Voice"],ee,[ne,se]],[/\b(lvtel\-)?(v1[12]) b/i],[[ie,"LvTel"],ee,[ne,se]],[/\b(ph-1) /i],[ee,[ie,"Essential"],[ne,se]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[ee,[ie,"Envizen"],[ne,ce]],[/\b(trio[-\w\. ]+) b/i],[ee,[ie,"MachSpeed"],[ne,ce]],[/\btu_(1491) b/i],[ee,[ie,"Rotor"],[ne,ce]],[/(shield[\w ]+) b/i],[ee,[ie,"Nvidia"],[ne,ce]],[/(sprint) (\w+)/i],[ie,ee,[ne,se]],[/(kin\.[onetw]{3})/i],[[ee,/\./g," "],[ie,Ee],[ne,se]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[ee,[ie,Oe],[ne,ce]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[ee,[ie,Oe],[ne,se]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[ie,ee,[ne,ae]],[/droid.+; (shield) bui/i],[ee,[ie,"Nvidia"],[ne,ae]],[/(playstation [345portablevi]+)/i],[ee,[ie,Re],[ne,ae]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[ee,[ie,Ee],[ne,ae]],[/smart-tv.+(samsung)/i],[ie,[ne,le]],[/hbbtv.+maple;(\d+)/i],[[ee,/^/,"SmartTV"],[ie,Ae],[ne,le]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[ie,Te],[ne,le]],[/(apple) ?tv/i],[ie,[ee,ge+" TV"],[ne,le]],[/crkey/i],[[ee,ye+"cast"],[ie,_e],[ne,le]],[/droid.+aft(\w)( bui|\))/i],[ee,[ie,he],[ne,le]],[/\(dtv[\);].+(aquos)/i],[ee,[ie,"Sharp"],[ne,le]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[ie,trim],[ee,trim],[ne,le]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[ne,le]],[/((pebble))app/i],[ie,ee,[ne,de]],[/droid.+; (glass) \d/i],[ee,[ie,_e],[ne,de]],[/droid.+; (wt63?0{2,3})\)/i],[ee,[ie,Oe],[ne,de]],[/(quest( 2)?)/i],[ee,[ie,Me],[ne,de]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[ie,[ne,ue]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[ee,[ne,se]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[ee,[ne,ce]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[ne,ce]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[ne,se]],[/(android[-\w\. ]{0,9});.+buil/i],[ee,[ie,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[re,[te,"Edge"+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[re,[te,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[te,re],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[re,te]],os:[[/microsoft (windows) (vista|xp)/i],[te,re],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[te,[re,strMapper,we]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[te,"Windows"],[re,strMapper,we]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[re,/_/g,"."],[te,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[te,"Mac OS"],[re,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[re,te],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[te,re],[/\(bb(10);/i],[re,[te,me]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[re,[te,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[re,[te,Se+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[re,[te,"webOS"]],[/crkey\/([\d\.]+)/i],[re,[te,ye+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[te,"Chromium OS"],re],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[te,re],[/(sunos) ?([\w\.\d]*)/i],[[te,"Solaris"],re],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[te,re]]},UAParser=function(F,B){if(typeof F===$&&(B=F,F=W),!(this instanceof UAParser))return new UAParser(F,B).getResult();var z=F||(typeof G!==Y&&G.navigator&&G.navigator.userAgent?G.navigator.userAgent:K),J=B?extend(De,B):De;return this.getBrowser=function(){var F={};return F[te]=W,F[re]=W,rgxMapper.call(F,z,J.browser),F.major=majorize(F.version),F},this.getCPU=function(){var F={};return F[oe]=W,rgxMapper.call(F,z,J.cpu),F},this.getDevice=function(){var F={};return F[ie]=W,F[ee]=W,F[ne]=W,rgxMapper.call(F,z,J.device),F},this.getEngine=function(){var F={};return F[te]=W,F[re]=W,rgxMapper.call(F,z,J.engine),F},this.getOS=function(){var F={};return F[te]=W,F[re]=W,rgxMapper.call(F,z,J.os),F},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return z},this.setUA=function(F){return z=typeof F===X&&F.length>pe?trim(F,pe):F,this},this.setUA(z),this};UAParser.VERSION=z,UAParser.BROWSER=enumerize([te,re,Z]),UAParser.CPU=enumerize([oe]),UAParser.DEVICE=enumerize([ee,ie,ne,ae,se,le,ce,de,ue]),UAParser.ENGINE=UAParser.OS=enumerize([te,re]),F.exports&&(B=F.exports=UAParser),B.UAParser=UAParser;var Ne=typeof G!==Y&&(G.jQuery||G.Zepto);if(Ne&&!Ne.ua){var Le=new UAParser;Ne.ua=Le.getResult(),Ne.ua.get=function(){return Le.getUA()},Ne.ua.set=function(F){Le.setUA(F);var B=Le.getResult();for(var G in B)Ne.ua[G]=B[G]}}}("object"==typeof window?window:z)}));const Au=[{name:"edge",engine:"Edge",key:"Edge"},{name:"edgeanaheim",engine:"Chromium",key:"Edg"},{name:"chromium",engine:"Chromium",key:"Chromium"},{name:"opera",engine:"Chromium",key:"OPR"},{name:"yandexbrowser",engine:"Chromium",key:"YaBrowser"},{name:"chrome",engine:"Chromium",key:"Chrome"},{name:"firefox",engine:"Firefox",key:"Firefox"},{name:"safari",engine:"Safari",key:"Safari"},{name:"ie",engine:"MSIE",key:"Trident"}],Ru="0.0",Pu="unknown";function getFormFactor(F){return/iPhone|iPad|iPod|Android|Mobi/i.test(F)?"Mobile":"Desktop"}function isAndroid(F){const B=!/like android/i.test(F),G=/android/i.test(F);return B&&G}function getEnvironmentDetails(){return(new Iu.UAParser).getResult()}function getPlatformName(){const F=getEnvironmentDetails().ua;return-1!==F.indexOf("Edge")?"edge":-1!==F.indexOf("Chrome")?"chrome":-1!==F.indexOf("Firefox")?"firefox":-1!==F.indexOf("Safari")?"safari":-1!==F.indexOf("Trident")?"ie":"unknown"}function getEngine(F,B){let G=Pu;return B.some((B=>-1!==F.indexOf(B.key)&&(G=B.engine,!0))),G}function getBrowserName(F,B){let G=Pu;return B.some((B=>-1!==F.indexOf(B.key)&&(G=B.name,!0))),G}function getBrowserVersion(){const F=getEnvironmentDetails();return void 0!==F.browser.version?F.browser.version:Ru}function getBrowserInfo(){const F=getEnvironmentDetails().ua;return{name:getBrowserName(F,Au),engine:getEngine(F,Au),version:getBrowserVersion(),formFactor:getFormFactor(F)}}function getOS(){const F=getEnvironmentDetails().ua;return/windows phone/i.test(F)?"windowsphone":/windows /i.test(F)?"windows":/macintosh/i.test(F)?"mac":/(ipod|iphone|ipad)/i.test(F)?"ios":isAndroid(F)?"android":/(web|hpw)[o0]s/i.test(F)?"webos":/tizen/i.test(F)?"tizen":/headlesschrome(?:\/([\w\.]+)| )/i.test(F)?"headlesschrome":/linux/i.test(F)?"linux":/CrOS/.test(F)?"chrome":"other"}function getOSVersion(){const F=getEnvironmentDetails();return void 0!==F.os.version?F.os.version:Ru}function isDigitMade(F){return/^\d+$/.test(F)}function checkVersionSupport(F,B){F=F.trim(),B=B.trim();let G=F.split("."),W=B.split("."),z=0;try{if(!G.every(isDigitMade)||!W.every(isDigitMade))return-2;for(;G.length<W.length;)G.push("0");for(;W.length<G.length;)W.push("0");let F=G.map(Number),B=W.map(Number);for(var K=0;K<F.length;K++)if(F[K]!==B[K]){if(F[K]>B[K])return 1;if(F[K]<B[K])return-1}}catch(F){console.log(`Error in browser check version support: ${F}`)}return z}function checkOsSupport(F){var B;return!!(null===(B=getAcsEcsConfig())||void 0===B?void 0:B.environments).hasOwnProperty(F)}function checkOsBrowserSupport(F,B){var G;let W=null===(G=getAcsEcsConfig())||void 0===G?void 0:G.environments;return!(!checkOsSupport(F)||!W[F].hasOwnProperty(B))}function getMinBrowserVersion(F,B){var G;let W=null===(G=getAcsEcsConfig())||void 0===G?void 0:G.environments;return W.hasOwnProperty(F)&&W[F].hasOwnProperty(B)?W[F][B].minVersion:Ru}function getEnvironmentInfos(){let F,B,G=!1;const W=getOS(),z=getBrowserInfo().name,K=getBrowserInfo().version,J=checkOsSupport(W),Q=checkOsBrowserSupport(W,z);if(Q){checkVersionSupport(K,getMinBrowserVersion(W,z))>=0&&(G=!0)}return B={platform:W,browser:z,browserVersion:K},F={environment:B,isSupportedPlatform:J,isSupportedBrowser:Q,isSupportedBrowserVersion:G,isSupportedEnvironment:J&&Q&&G},F}var Ou,Mu,wu,Du,Nu,Lu,__awaiter$3=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class TelemetryLogManager{constructor(F,B){this._telemetryLoggers=new Map,this._eventsBufferMap=new Map,this._initialized=!1,this._sdkUserAgent="",this._mediaEventsReportedForTheCall={},this._logger=F.createChild("TelemetryLogManager"),this._sdkUserAgent=B,this._sdkInternaVersion=getSdkInternalVersion()}getTelemetryLoggers(){return this._telemetryLoggers}getEventsBufferMap(){return this._eventsBufferMap}isInitialized(){return this._initialized}getCloudType(){var F;return null===(F=this._caConfigBag)||void 0===F?void 0:F.cloudType}getAcsResourceId(){var F;return null===(F=this._caConfigBag)||void 0===F?void 0:F.acsResourceId}getClientId(){var F;return null===(F=this._caConfigBag)||void 0===F?void 0:F.clientId}initialize(F){if(!F.cloudType)throw this._logger.error("Failed to initialize telemetry loggers, invalid cloud type provided."),new CallingCommunicationError({message:"Failed to initialize telemetry",code:ue});if(this._initialized)throw this._logger.error("Failed to initialize telemetry loggers, telemetry log manager is already initialized."),new CallingCommunicationError({message:"Failed to initialize telemetry",code:ue});this._telemetryLoggers.forEach(((B,G)=>{try{B.initialize(F),this._logger.log(`Initialized and flushed buffered telemetry logger for ${G}`)}catch(F){this._logger.warn(`Failed to initialize and flush buffered telemetry logger for ${G}`),this._telemetryLoggers.delete(G)}})),this._initialized=!0,this._caConfigBag=F,this._logger.log(`Telemetry log manager has been initialized for Call Client: ${this._caConfigBag.clientId}`)}clearTelemetryLoggers(){const F=this._telemetryLoggers.size;return this._telemetryLoggers=new Map,this._caConfigBag=void 0,this._initialized=!1,F}getMediaEventReportedPromise(F){if(!this._mediaEventsReportedForTheCall[F]){const B=defer();B.promise.catch(noop),this._mediaEventsReportedForTheCall[F]=B}return this._mediaEventsReportedForTheCall[F].promise}_reportMediaEventForTheCall(F){if(this._mediaEventsReportedForTheCall[F])this._mediaEventsReportedForTheCall[F].resolve();else{const B=defer();B.promise.catch(noop),B.resolve(),this._mediaEventsReportedForTheCall[F]=B}}sendEvent(F){var B,G,W;try{if(this._logger.debug(`sending event=${F.name}`),this.checkIfEventIsBlocked(null==F?void 0:F.name))return;const z={name:F.name,data:F.properties};if("mdsc_webrtc_session"===(null==z?void 0:z.name)||"mdsc_webrtc_session_initial"===(null==z?void 0:z.name)){const W={};if(F.properties)for(const z of Object.keys(F.properties)){const K=F.properties[z];W[z]={value:null!==(B=null==K?void 0:K.value)&&void 0!==B?B:K,kind:null!==(G=null==K?void 0:K.piiKind)&&void 0!==G?G:0}}z.data=W}void 0===z.data&&(z.data={}),"mdsc_webrtc_session"===(null==z?void 0:z.name)&&this._reportMediaEventForTheCall(null===(W=null==z?void 0:z.data)||void 0===W?void 0:W.CorrelationId),void 0!==typeof F.priority?z.latency=F.priority:z.latency=hr.Normal;const K=getAcsEcsConfig().telemetryEvents.eventNameToPriority.eventName.indexOf(F.name);-1!==K&&(z.latency=getAcsEcsConfig().telemetryEvents.eventNameToPriority.priority[K]),z.data.isSupportedEnvironment=getEnvironmentInfos().isSupportedEnvironment,z.data.sdkVersion=this._sdkInternaVersion,z.data.platformId=getPlatformId();const J=`${getPlatformId()}/${this._sdkInternaVersion}`;z.data.uiVersion=J,z.data.ui_version=J,z.data.Platform_Uiversion=J,z.data.userAgent=`${this._sdkUserAgent}`,z.data.clientTimestamp=+new Date;const Q=F.tenant;let Y=this._eventsBufferMap.get(Q);Y||(Y=this._eventsBufferMap.set(Q,[]).get(Q));let $=this._telemetryLoggers.get(Q);if($||($=new TelemetryLogger(Q,this._logger,Y),this._telemetryLoggers.set(Q,$),this._logger.log(`Created telemetry logger for ${Q}`)),this._initialized){if(!$.isInitialized())try{$.initialize(this._caConfigBag),this._logger.log(`Created and initialized telemetry logger for ${Q}`)}catch(F){throw this._telemetryLoggers.delete(Q),null==Y||Y.push(z),this._logger.error(`Failed to create and initialize telemetry logger for ${Q}`),new CallingCommunicationError({message:`Failed to create and initialize telemetry logger for ${Q}`,code:ue})}$.sendEvent(z)}else null==Y||Y.push(z)}catch(B){this._logger.warn(`Failed to send event ${null==F?void 0:F.name}`)}}flushAllEvents(F){return __awaiter$3(this,void 0,void 0,(function*(){if(this._logger.debug(`flushing events: ${this._telemetryLoggers.size}`),-1!==getAcsEcsConfig().telemetry.telemetryFlushTimeout){const flushLogger=(B,G)=>{try{const W=defer();W.promise.catch(noop);const z=wait((()=>__awaiter$3(this,void 0,void 0,(function*(){return G===vt&&(yield this.getMediaEventReportedPromise(F)),W.promise}))),getAcsEcsConfig().telemetry.telemetryFlushTimeout);return B.flushEvents((()=>{this._logger.debug("events flushed"),W.resolve()})),z.then(noop)}catch(F){throw new CallingCommunicationError({message:"Failed to flush telemetry",code:ue})}},B=[];return this._telemetryLoggers.forEach(((F,G)=>{B.push(flushLogger(F,G).catch((()=>{this._logger.warn("Failed to flush telemetry")})))})),Promise.all(B)}this._telemetryLoggers.forEach((F=>{try{F.flushEvents()}catch(F){this._logger.warn("Failed to flush telemetry")}}))}))}checkIfEventIsBlocked(F){var B,G,W,z;if(Array.isArray(null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.telemetry)||void 0===G?void 0:G.blockedEvents)){const B=null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.telemetry)||void 0===z?void 0:z.blockedEvents;return Array.isArray(B)&&(null==B?void 0:B.indexOf(F))>-1||!1}return!1}}TelemetryLogManager.telemetryPayloadBytesOriginal=0,TelemetryLogManager.telemetryPayloadBytesCompressed=0;class TelemetryLogger{constructor(F,B,G){this._tenantId=F,this._eventsBuffer=G,this._initialized=!1,this._networkOnline=!0,this._telemetryRetryIntervalRunning=!1,this._logger=B.createChild(`TelemetryLogger[${F}]`),window.addEventListener("online",(F=>{this._networkOnline=F.detail,this._networkOnline&&this._initialized&&!this._telemetryRetryIntervalRunning&&(this._logger.log("browser network back online starting telemetry send retry"),this.scheduleDiscardedTelemetryRetry())}))}initialize(F){var B;if(this._initialized)this._logger.warn(`Telemetry logger for tenant: ${this._tenantId}, already initialized`);else try{const G=new rc;this._appInsightsCore=new Er,this._postChannel=new hs;const W={instrumentationKey:this._tenantId,extensions:[this._postChannel,G],disableCookiesUsage:!0},z={populateBrowserInfo:!0,populateOperatingSystemInfo:!0};void 0===W.extensionConfig&&(W.extensionConfig={}),W.extensionConfig[G.identifier]=z;const K={overrideEndpointUrl:this.getAriaCollectorUrl(F),payloadPreprocessor:getAcsEcsConfig().telemetry.gzipTelemetryPayload?(F,B)=>{this.gzipPayload(F,B)}:void 0};if(W.extensionConfig[this._postChannel.identifier]=K,getAcsEcsConfig().telemetry.localStorageEnable){const F=new Ca;null===(B=W.extensions)||void 0===B||B.push(F);const G={storageKey:"WebSdkTelemetry"};W.extensionConfig[F.identifier]=G}this._NotificationManager=new NotificationManager$1(this._tenantId,this._logger),this._appInsightsCore.initialize(W,[],void 0,this._NotificationManager),this._caConfigBag=F,this.scheduleDiscardedTelemetryRetry(),this._initialized=!0,this._eventsBuffer.forEach((F=>{this.sendEvent(F)})),this._eventsBuffer.splice(0,this._eventsBuffer.length)}catch(F){throw this._logger.error(`Failed to initialize telemetry logger for tenant: ${this._tenantId}`),new CallingCommunicationError({message:"Failed to iniztialize telemetry logger",code:ue})}}getCloudType(){var F;return null===(F=this._caConfigBag)||void 0===F?void 0:F.cloudType}getAcsResourceId(){var F;return null===(F=this._caConfigBag)||void 0===F?void 0:F.acsResourceId}getClientId(){var F;return null===(F=this._caConfigBag)||void 0===F?void 0:F.clientId}isInitialized(){return this._initialized}sendEvent(F){var B,G,W,z,K,J;this._initialized&&((null==F?void 0:F.data)&&(F.data.clientId=(null===(B=this._caConfigBag)||void 0===B?void 0:B.clientId)||"",0===(null===(G=null==F?void 0:F.name)||void 0===G?void 0:G.indexOf("mdsc_webrtc"))?F.data.metrics_AcsResourceId=(null===(W=this._caConfigBag)||void 0===W?void 0:W.acsResourceId)||"":F.data.AcsResourceId=(null===(z=this._caConfigBag)||void 0===z?void 0:z.acsResourceId)||"",F.data.cloudType=(null===(K=this._caConfigBag)||void 0===K?void 0:K.cloudType)||"",F.data.identityType=(null===(J=this._caConfigBag)||void 0===J?void 0:J.identityType)||""),this.sendAppInsightsCoreEvent(F))}scheduleDiscardedTelemetryRetry(){const F=getAcsEcsConfig().telemetry.discardedTelemetryRetryTimeout;let B=setInterval((F=>__awaiter$3(this,void 0,void 0,(function*(){var F;this._networkOnline?(null===(F=this._NotificationManager)||void 0===F||F.getDiscardedEvents().forEach((F=>{this.sendEvent(F)})),this._telemetryRetryIntervalRunning=!0):(this._logger.log("browser lost network access stopping telemetry send retry"),clearInterval(B),this._telemetryRetryIntervalRunning=!1)}))),F)}sendAppInsightsCoreEvent(F){var B;null===(B=this._appInsightsCore)||void 0===B||B.track(F)}flushEvents(F){this._initialized&&this._postChannel&&this._postChannel.flush(!1,F)}getAriaCollectorUrl(F){if(F.identityType===Ke.Enterprise)return je.Enterprise;switch(F.cloudType){case Be.Public:return isEudbLocation(getAcsEcsConfig().calling.eudb.countries,F)?je.PublicEUDB:je.Public;case Be.GccHigh:return je.GccHigh;case Be.Dod:return je.Dod;case Be.AirGap08:return je.AirGap08;case Be.AirGap09:return je.AirGap09;default:return je.Public}}gzipPayload(F,B){try{TelemetryLogManager.telemetryPayloadBytesOriginal+=getSizeInBytes(F.data,this._logger),F.data=yu.gzip(F.data),F.urlString+="&content-encoding=gzip",TelemetryLogManager.telemetryPayloadBytesCompressed+=getSizeInBytes(F.data,this._logger)}catch(F){this._logger.warn("Failed to gzip with pako: ",F)}B(F)}}function callFeatureFactory(F,B={activationEvent:"OnFeatureAccess"}){return{get callApiCtor(){return F},activationOptions:B,isCallFeature:!0}}function callClientFeatureFactory(F,B={activationEvent:"OnFeatureAccess"}){return{get callClientApiCtor(){return F},activationOptions:B,isCallClientFeature:!0}}function getRoundedAverage(F,B,G=100){return Math.round((F/B+Number.EPSILON)*G)/G}function sendCallFeatureUsageTelemetry(F,B,G){try{const G={callId:F.callId,localParticipantId:F.localParticipantId,featureName:F.featureName,featureType:F.featureType,initializationType:F.initializationType,featureDetails:F.featureDetails};B.sendEvent({name:Mu.acs_calling_feature_usage,tenant:ft,properties:G})}catch(B){G.debug(`Unable to send ${F.featureName} feature usage telemtery`)}}function sendCallClientFeatureUsageTelemetry(F,B,G){try{const G={featureName:F.featureName,featureType:F.featureType,initializationType:F.initializationType,featureDetails:F.featureDetails};B.sendEvent({name:Mu.acs_calling_feature_usage,tenant:ft,properties:G})}catch(B){G.debug(`Unable to send ${F.featureName} feature usage telemtery`)}}!function(F){F.remote_view="remote_view",F.remote_stream="remote_stream",F.network_quality="network_quality",F.video_device_issue="video_device_issue",F.other_diagnostic="other_diagnostic",F.logger_event="logger_event",F.number_of_participants="number_of_participants",F.media_metrics_device_events="media_metrics_device_events"}(Ou||(Ou={})),function(F){F.acs_calling_call_attempt="acs_calling_call_attempt",F.acs_calling_call_connected="acs_calling_call_connected",F.acs_calling_call_failed="acs_calling_call_failed",F.acs_calling_call_accept_attempt="acs_calling_call_accept_attempt",F.acs_calling_call_accept_connected="acs_calling_call_accept_connected",F.acs_calling_call_accept_failed="acs_calling_call_accept_failed",F.acs_calling_call_reject_attempt="acs_calling_call_reject_attempt",F.acs_calling_call_reject_success="acs_calling_call_reject_success",F.acs_calling_call_reject_failed="acs_calling_call_reject_failed",F.acs_calling_call_hangup_attempt="acs_calling_call_hangup_attempt",F.acs_calling_call_hangup_success="acs_calling_call_hangup_success",F.acs_calling_call_hangup_failure="acs_calling_call_hangup_failure",F.acs_calling_call_progress="acs_calling_call_progress",F.acs_calling_stack_init="acs_calling_stack_init",F.acs_calling_config_fetched_attempt="acs_calling_config_fetched_attempt",F.acs_calling_config_fetched_success="acs_calling_config_fetched_success",F.acs_calling_config_fetched_failure="acs_calling_config_fetched_failure",F.acs_calling_signaling_init="acs_calling_signaling_init",F.acs_calling_call_agent_init_attempt="acs_calling_call_agent_init_attempt",F.acs_calling_call_agent_init_success="acs_calling_call_agent_init_success",F.acs_calling_call_agent_init_failure="acs_calling_call_agent_init_failure",F.acs_calling_create_view_attempt="acs_calling_create_view_attempt",F.acs_calling_create_view_success="acs_calling_create_view_success",F.acs_calling_create_view_failure="acs_calling_create_view_failure",F.acs_calling_dispose_view_attempt="acs_calling_dispose_view_attempt",F.acs_calling_dispose_view_success="acs_calling_dispose_view_success",F.acs_calling_dispose_view_failure="acs_calling_dispose_view_failure",F.acs_calling_start_video_attempt="acs_calling_start_video_attempt",F.acs_calling_start_video_success="acs_calling_start_video_success",F.acs_calling_start_video_failure="acs_calling_start_video_failure",F.acs_calling_stop_video_on_ufd_attempt="acs_calling_stop_video_on_ufd_attempt",F.acs_calling_stop_video_attempt="acs_calling_stop_video_attempt",F.acs_calling_stop_video_success="acs_calling_stop_video_success",F.acs_calling_stop_video_failure="acs_calling_stop_video_failure",F.acs_calling_start_screen_share="acs_calling_start_screen_share",F.acs_calling_stop_screen_share="acs_calling_stop_screen_share",F.acs_calling_call_stats="acs_calling_call_stats",F.acs_calling_participant_added_or_removed="acs_calling_participant_added_or_removed",F.acs_calling_adp_attempt="acs_calling_adp_attempt",F.acs_calling_adp_success="acs_calling_adp_success",F.acs_calling_adp_failure="acs_calling_adp_failure",F.acs_calling_device_permission_changed="acs_calling_device_permission_changed",F.acs_calling_local_audio_source_changed="acs_calling_local_audio_source_changed",F.acs_calling_start_audio_stream_track="acs_calling_start_audio_stream_track",F.acs_calling_stop_audio_stream_track="acs_calling_stop_audio_stream_track",F.acs_calling_get_remote_audio_stream_track="acs_calling_get_remote_audio_stream_track",F.acs_calling_get_raw_device_media_stream="acs_calling_get_raw_device_media_stream",F.acs_calling_page_hidden="acs_calling_page_hidden",F.acs_calling_orientation_changed="acs_calling_orientation_changed",F.acs_calling_token_expiration_changed="acs_calling_token_expiration_changed",F.acs_calling_token_expiration_changed_failure="acs_calling_token_expiration_changed_failure",F.acs_calling_token_expired="acs_calling_token_expired",F.acs_calling_token_has_no_data_location="acs_calling_token_has_no_data_location",F.acs_calling_mute_on_ufd_attempt="acs_calling_mute_on_ufd_attempt",F.acs_calling_mute_attempt="acs_calling_mute_attempt",F.acs_calling_mute_success="acs_calling_mute_success",F.acs_calling_mute_failure="acs_calling_mute_failure",F.acs_calling_unmute_attempt="acs_calling_unmute_attempt",F.acs_calling_unmute_success="acs_calling_unmute_success",F.acs_calling_unmute_failure="acs_calling_unmute_failure",F.acs_calling_start_audio_attempt="acs_calling_start_audio_attempt",F.acs_calling_start_audio_success="acs_calling_start_audio_success",F.acs_calling_start_audio_failure="acs_calling_start_audio_failure",F.acs_calling_unmute_speaker_attempt="acs_calling_unmute_speaker_attempt",F.acs_calling_unmute_speaker_success="acs_calling_unmute_speaker_success",F.acs_calling_unmute_speaker_failure="acs_calling_unmute_speaker_failure",F.acs_calling_stop_audio_attempt="acs_calling_stop_audio_attempt",F.acs_calling_stop_audio_success="acs_calling_stop_audio_success",F.acs_calling_stop_audio_failure="acs_calling_stop_audio_failure",F.acs_calling_prevent_stop_audio="acs_calling_prevent_stop_audio",F.acs_calling_captions="acs_calling_captions",F.acs_calling_mid_call_media_stats="acs_calling_mid_call_media_stats",F.acs_calling_mid_call_new_media_stats="acs_calling_mid_call_new_media_stats",F.acs_calling_mid_call_raw_media_stats="acs_calling_mid_call_raw_media_stats",F.acs_calling_switch_video_source_attempt="acs_calling_switch_video_source_attempt",F.acs_calling_switch_video_source_success="acs_calling_switch_video_source_success",F.acs_calling_switch_video_source_failure="acs_calling_switch_video_source_failure",F.acs_calling_diagnostics_attempt="acs_calling_diagnostics_attempt",F.acs_calling_diagnostics_result="acs_calling_diagnostics_result",F.acs_calling_feature_usage="acs_calling_feature_usage",F.acs_calling_map_role_attempt="acs_calling_map_role_attempt",F.acs_calling_map_role_success="acs_calling_map_role_success",F.acs_calling_map_role_failure="acs_calling_map_role_failure",F.acs_calling_middletier_gateway_fetch_policy="acs_calling_middletier_gateway_fetch_policy",F.acs_calling_middletier_gateway_emergency_content="acs_calling_middletier_gateway_emergency_content"}(Mu||(Mu={})),function(F){F.attempt="attempt",F.success="success",F.failure="failure",F.getter="getter",F.subscribe="subscribe",F.unsubscribe="unsubscribe",F.initialize="initialize"}(wu||(wu={})),function(F){F.MuteMicrophone="MuteMicrophone",F.UnmuteMicrophone="UnmuteMicrophone",F.MuteIncomingAudio="MuteIncomingAudio",F.UnmuteIncomingAudio="UnmuteIncomingAudio"}(Du||(Du={})),function(F){F.InitializeCaptionsStarted="InitializeCaptionsStarted",F.InitializeCaptionsFinished="InitializeCaptionsFinished",F.StartCaptionsStarted="StartCaptionsStarted",F.StartCaptionsFinished="StartCaptionsFinished",F.SelectLanguageStarted="SelectLanguageStarted",F.SelectLanguageFinished="SelectLanguageFinished",F.StateChanged="StateChanged",F.FirstCaptionReceived="FirstCaptionReceived",F.FirstCaptionParsingError="FirstCaptionParsingError",F.LanguageChanged="LanguageChanged"}(Nu||(Nu={})),function(F){F[F.Success=0]="Success",F[F.OperationInProgress=1]="OperationInProgress",F[F.CaptionsAlreadyActive=2]="CaptionsAlreadyActive",F[F.EmptyBotMri=3]="EmptyBotMri",F[F.EmptyBotCommandUrl=4]="EmptyBotCommandUrl",F[F.CallNotConnected=5]="CallNotConnected",F[F.NullToken=6]="NullToken",F[F.SelectedLanguageAlreadySet=7]="SelectedLanguageAlreadySet",F[F.Failed=8]="Failed"}(Lu||(Lu={}));var __decorate$1=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$1=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$4=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};const ku=Date.UTC(1900,0,1),Fu=3;class CaptionsCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new CaptionsCallFeatureImplOverTsCall(this.eventEmitter,getAcsEcsConfig().captions.acsBotMri,"Captions")}get name(){return this._sendFeatureUsage("name",wu.getter),"Captions"}initialize(B,G){if(this._logger=G,B.call.kind===F.CallKind.TeamsCall)throw new CallingCommunicationError({message:"Call Captions for Teams user is not supported",code:ae});if(B.call.kind===F.CallKind.Call&&B.tsCall.threadId)throw new CallingCommunicationError({message:"Cannot start ACS Captions in a Teams Call. Please use TeamsCaptionsCallFeature for Teams meetings captions",code:le});this._telemetryLogManager=B.telemetryLogManager,this._call=B.call,this._impl.initialize(B.tsCall,B.callAgent,B.callAgent.getHttpRequestHelper(),B.telemetryLogManager,G),this._sendFeatureUsage("initialize",wu.initialize)}get isCaptionsActive(){return this._sendFeatureUsage("isCaptionsActive",wu.getter),this._impl.isCaptionsActive}get availableLanguages(){return this._sendFeatureUsage("availableLanguages",wu.getter),getAcsEcsConfig().captions.availableLanguages}startCaptions(F){return __awaiter$4(this,void 0,void 0,(function*(){yield this._impl.startCaptions(F)}))}selectLanguage(F){return __awaiter$4(this,void 0,void 0,(function*(){yield this._impl.selectLanguage(F)}))}on(F,B){this._sendFeatureUsage(F,wu.subscribe),this.eventEmitter.on(F,B)}off(F,B){this._sendFeatureUsage(F,wu.unsubscribe),this.eventEmitter.off(F,B)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"Captions",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class TeamsCaptionsCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new CaptionsCallFeatureImplOverTsCall(this.eventEmitter,getAcsEcsConfig().captions.teamsBotMri,"TeamsCaptions")}get name(){return this._sendFeatureUsage("name",wu.getter),"TeamsCaptions"}initialize(B,G){if(this._logger=G,B.call.kind===F.CallKind.TeamsCall)throw new CallingCommunicationError({message:"Call Captions for Teams user is not supported",code:ae});if(B.call.kind===F.CallKind.Call&&!B.tsCall.threadId)throw new CallingCommunicationError({message:"Cannot start Teams Captions in a ACS Call. Please use CaptionsCallFeature for ACS call captions",code:le});this._telemetryLogManager=B.telemetryLogManager,this._call=B.call,this._impl.initialize(B.tsCall,B.callAgent,B.callAgent.getHttpRequestHelper(),B.telemetryLogManager,G),this._sendFeatureUsage("initialize",wu.initialize)}get isCaptionsActive(){return this._sendFeatureUsage("isCaptionsActive",wu.getter),this._impl.isCaptionsActive}on(F,B){this._sendFeatureUsage(F,wu.subscribe),this.eventEmitter.on(F,B)}off(F,B){this._sendFeatureUsage(F,wu.unsubscribe),this.eventEmitter.off(F,B)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"TeamsCaptions",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class CaptionsCallFeatureImplOverTsCall extends BaseLanguageCallFeatureImplOverTsCall{constructor(B,G,W){super(B,G,W),this._botParticipantId="",this._telemetryEventList=[],this._hasReportedCaptionParseFailure=!1,this._hasReceivedFirstCaption=!1,this._currentLanguage="",this._sequenceId=0,this._participantSequenceIdMap={},this._addParticipantPromise=null,this._dataChannelHandler={onStarted:(F,B)=>__awaiter$4(this,void 0,void 0,(function*(){})),onStopped:F=>__awaiter$4(this,void 0,void 0,(function*(){})),onDataReceived:(B,G,W)=>__awaiter$4(this,void 0,void 0,(function*(){if(!this.isCaptionsActive)return;let B;try{B=JSON.parse(G.toString())}catch(F){try{if(void 0===this._textDecoder)throw new Error("TextDecoder undefined.");B=JSON.parse(this._textDecoder.decode(G))}catch(F){return this._logger.error("Failed to parse Captions result",F),void(this._hasReportedCaptionParseFailure||(this._hasReportedCaptionParseFailure=!0,this._addEvent(Nu.FirstCaptionParsingError,"Could not decode data packet.")))}}(null==B?void 0:B.recognitionResults)&&B.recognitionResults.forEach((B=>{var G,W;try{const[z,K]=B.id.split("/");let J=parseInt(K,10);if(this._participantSequenceIdMap[B.userId]&&this._botParticipantId==z&&this._participantSequenceIdMap[B.userId]>J)return;this._botParticipantId=z,this._participantSequenceIdMap[B.userId]=J,this._sequenceId++;const Q=(null===(G=this._tsCall.participants.find((F=>F.id===B.userId)))||void 0===G?void 0:G.displayName)||(this._internalCallAgent.getUserMri()===B.userId?null===(W=this._internalCallAgent)||void 0===W?void 0:W.displayName:void 0),Y={resultType:B.isFinal?F.ResultType.Final:F.ResultType.Intermediate,text:B.text,timestamp:new Date(new Date(B.timestampAudioSent/1e4).getTime()+ku),speaker:{identifier:constructIdentifierKindFromMri(B.userId),displayName:Q},language:B.spokenLanguage};this._hasReceivedFirstCaption||(this._hasReceivedFirstCaption=!0,this._addEvent(Nu.FirstCaptionReceived)),this._currentLanguage!=B.spokenLanguage&&""!=this._currentLanguage&&(this._currentLanguage=B.spokenLanguage,this._addEvent(Nu.LanguageChanged,`language=${B.spokenLanguage}`)),this._eventEmitter.emit("captionsReceived",Y)}catch(F){this._logger.error("Failed to parse Captions result",F),this._hasReportedCaptionParseFailure||(this._hasReportedCaptionParseFailure=!0,this._addEvent(Nu.FirstCaptionParsingError,"Error thrown during incoming caption result mapping."))}}))}))},this._handleBotRemoved=F=>{this._acsMetadata&&this._isCaptionsBot(F)&&(this._isCaptionsEnabled(this._acsMetadata)&&this._eventEmitter.emit("isCaptionsActiveChanged"),this._acsMetadata=void 0)},this._telemetryStartTime=Date.now()}get isCaptionsActive(){return!!this._acsMetadata&&this._isCaptionsEnabled(this._acsMetadata)}initialize(F,B,G,W,z){this._logger=z.createChild((()=>`CaptionsFeature::Call(id='${F.callId}', state='${F.state}')`)),this._tsCall=F,this._internalCallAgent=B,this._httpRequestHelper=G,this._telemetryLogManager=W,this._initializationPromise=new Promise(((F,B)=>{this._initializeAsync().then((B=>F())).catch((F=>B(F)))}))}_initializeAsync(){return __awaiter$4(this,void 0,void 0,(function*(){try{this._addEvent(Nu.InitializeCaptionsStarted),this._textDecoder=new TextDecoder,yield this._tsCall.startDataChannel(),yield this._tsCall.dataChannelAdapter.addHandler(this._transcriptionDataId,this._dataChannelHandler),this._tsCall.on("participantAdded",(F=>__awaiter$4(this,void 0,void 0,(function*(){this._isCaptionsBot(F)&&(this._acsMetadata||(this._acsMetadata=this._copyBotMetaData(F)))})))),this._tsCall.on("participantRemoved",(F=>__awaiter$4(this,void 0,void 0,(function*(){this._isCaptionsBot(F)&&this._handleBotRemoved(F)})))),this._tsCall.on("participantUpdated",(F=>__awaiter$4(this,void 0,void 0,(function*(){const B=this._getBotMetadata(F);if(B&&this._isCaptionsBot(F)&&this._acsMetadata){const G=this._isCaptionsEnabled(this._acsMetadata);this._acsMetadata=this._copyBotMetaData(F),this._isCaptionsEnabled(B)!==G&&(this._addEvent(Nu.StateChanged,"state="+(G?0:1)),this._eventEmitter.emit("isCaptionsActiveChanged"))}}))));const F=this._tsCall.participants.find((F=>F.id===this._captionsBotMri));F&&(this._acsMetadata=this._copyBotMetaData(F)),this._addEvent(Nu.InitializeCaptionsFinished,Lu.Success)}catch(F){throw this._logger.error("Failed to initialize Captions."),this._addEvent(Nu.InitializeCaptionsFinished,Lu.Failed),new CallingCommunicationError({message:"Failed to initialize Captions.",code:ue})}}))}startCaptions(F){return __awaiter$4(this,void 0,void 0,(function*(){const B=(null==F?void 0:F.language)||"en-us";if(this._sendFeatureUsage("startCaptions",wu.attempt),this._addEvent(Nu.StartCaptionsStarted,`language=${B}`),this._addParticipantPromise)return this._addEvent(Nu.StartCaptionsFinished,Lu.OperationInProgress),void this._sendFeatureUsage("startCaptions",wu.failure);if(yield this._initializationPromise,!this._captionsBotMri)throw this._logger.error("Could not start captions."),this._addEvent(Nu.StartCaptionsFinished,Lu.EmptyBotMri),this._sendFeatureUsage("startCaptions",wu.failure),new CallingCommunicationError({message:"Could not start captions.",code:ue});if(this._acsMetadata)this._isCaptionsEnabled(this._acsMetadata)&&(this._addEvent(Nu.StartCaptionsFinished,Lu.CaptionsAlreadyActive),this._sendFeatureUsage("startCaptions",wu.failure));else try{const F={participantInvitationData:{botData:{clientInfo:this._clientInfo,consumerType:"SkypeTokenClient",initiatorUserToken:yield this._internalCallAgent.tokenProvider(),spokenLanguage:B,mode:"Transcription",transcriptionModes:[this._captionsModeKey]}}};this._addParticipantPromise=this._tsCall.addParticipant(this._captionsBotMri,F),yield this._addParticipantPromise,this._addParticipantPromise=null,this._addEvent(Nu.StartCaptionsFinished,Lu.Success),this._sendFeatureUsage("startCaptions",wu.success)}catch(F){throw this._logger.error("Could not start captions."),this._addEvent(Nu.StartCaptionsFinished,Lu.Failed),this._sendFeatureUsage("startCaptions",wu.failure),new CallingCommunicationError({message:"Could not start captions.",code:ue})}}))}selectLanguage(F){var B,G;return __awaiter$4(this,void 0,void 0,(function*(){if(this._sendFeatureUsage("selectLanguage",wu.attempt),this._addEvent(Nu.SelectLanguageStarted,`language=${F}`),yield this._initializationPromise,!(null===(B=this._acsMetadata)||void 0===B?void 0:B.commandUrl))throw this._addEvent(Nu.SelectLanguageFinished,Lu.EmptyBotCommandUrl),this._sendFeatureUsage("selectLanguage",wu.failure),this._logger.error("Cannot update language as captions have not started.."),new CallingCommunicationError({message:"Cannot update language as captions have not started.",code:de});try{if(F==this._currentLanguage)return this._addEvent(Nu.SelectLanguageFinished,Lu.SelectedLanguageAlreadySet),void this._sendFeatureUsage("selectLanguage",wu.failure);const B=yield this._internalCallAgent.tokenProvider();if(!B)throw this._addEvent(Nu.SelectLanguageFinished,Lu.NullToken),new CallingCommunicationError({message:"Empty token. Unable to update language.",code:ue});const G={timestamp:(new Date).toISOString(),participantMri:this._internalCallAgent.getUserMri(),participantLegId:this._tsCall.participantId,action:"setLanguage",mode:"transcription",actionParameters:{type:"setLanguage",spokenLanguage:F}},W={headers:{"X-Microsoft-Skype-Chain-ID":this._tsCall.callId,Authorization:`Bearer ${B}`,"x-skypetoken":B},withCredentials:!0},z=yield this._httpRequestHelper.sendRequestWithRetry("post",this._acsMetadata.commandUrl,G,W,Fu);this._addEvent(Nu.SelectLanguageFinished,`statusCode=${z.status}`),this._sendFeatureUsage("selectLanguage",wu.success)}catch(F){throw this._logger.error("Unable to update language."),this._addEvent(Nu.SelectLanguageFinished),this._sendFeatureUsage("selectLanguage",wu.failure),new CallingCommunicationError({message:"Unable to update language.",code:(null===(G=null==F?void 0:F.response)||void 0===G?void 0:G.status)||ue},F)}}))}dispose(){this._acsMetadata=void 0,this._textDecoder=void 0,this._eventEmitter.removeAllListeners(),this._sendEvents()}_addEvent(F,B){let G={[`${F}`]:Date.now()-this._telemetryStartTime};void 0!==B&&(G.data="string"==typeof B?B:`result=${B}`),this._telemetryEventList.push(G)}_sendEvents(){let F={SequenceId:this._sequenceId,EventTimestampBag:{eventStart:this._telemetryStartTime,events:this._telemetryEventList}};this._telemetryLogManager.sendEvent({name:Mu.acs_calling_captions,tenant:ft,properties:F})}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._tsCall.callId,localParticipantId:this._tsCall.participantId,featureName:this._name,featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}}__decorate$1([asyncOperation($t.StartCaptions),__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[Object]),__metadata$1("design:returntype",Promise)],CaptionsCallFeatureImplOverTsCall.prototype,"startCaptions",null),__decorate$1([asyncOperation($t.SelectLanguage),__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[String]),__metadata$1("design:returntype",Promise)],CaptionsCallFeatureImplOverTsCall.prototype,"selectLanguage",null);var __awaiter$5=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class RaiseHandCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new RaiseHandCallImplOverTsCall(this.eventEmitter)}get name(){return"RaiseHand"}initialize(F,B){this._logger=B,this._telemetryLogManager=F.telemetryLogManager,this._tsCall=F.tsCall,this._impl.initialize(F.tsCall,F.callAgent,F.telemetryLogManager,B)}raiseHand(){return __awaiter$5(this,void 0,void 0,(function*(){return this._impl.raiseHand()}))}lowerHand(F){return __awaiter$5(this,void 0,void 0,(function*(){return void 0===F?this._impl.lowerHand():this._impl.lowerHands(F)}))}lowerHandForEveryone(){return this._impl.lowerHandForEveryone()}getStatus(){return this._sendFeatureUsage("getStatus",wu.getter),this._impl.currentRaiseHandStates}on(F,B){this._sendFeatureUsage(F,wu.subscribe),this.eventEmitter.on(F,B)}off(F,B){this._sendFeatureUsage(F,wu.unsubscribe),this.eventEmitter.off(F,B)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._tsCall.callId,localParticipantId:this._tsCall.participantId,featureName:"RaiseHand",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this.disposed||super.dispose()}}class RaiseHandCallImplOverTsCall{constructor(F){this.typeRankComparator=(F,B)=>void 0===F.publishedState?-1:void 0===B.publishedState?1:F.publishedState.typeRank-B.publishedState.typeRank,this._eventEmitter=F,this._currentRaiseHandStates=new Map}initialize(F,B,G,W){this._logger=W.createChild((()=>`RaiseHandFeature::Call(id='${F.callId}')`)),this._tsCall=F,this._telemetryLogManager=G,this._internalCallAgent=B,this._sendFeatureUsage("initialize",wu.initialize);try{let extractMRIs=F=>new Map(this.getPublishedState(F).sort(this.typeRankComparator).map(((F,B)=>[F.id,B+1])));this._tsCall.on("publishedStatesChanged",(F=>__awaiter$5(this,void 0,void 0,(function*(){let B=extractMRIs(F);B.forEach(((F,B)=>{this._currentRaiseHandStates.has(B)||this._eventEmitter.emit("raiseHandChanged",{identifier:constructIdentifierKindFromMri(B),order:F,isRaised:!0})})),this._currentRaiseHandStates.forEach(((F,G)=>{B.has(G)||this._eventEmitter.emit("raiseHandChanged",{identifier:constructIdentifierKindFromMri(G),isRaised:!1})})),this._currentRaiseHandStates=B})))),this._tsCall.publishedStates&&(this._currentRaiseHandStates=extractMRIs(this._tsCall.publishedStates)),this._sendFeatureUsage("initialize",wu.success)}catch(F){throw this._logger.error("Could not initialize raise hand feature.",F),this._sendFeatureUsage("initialize",wu.failure),new CallingCommunicationError({message:"Could not initialize raise hand feature.",code:ue},F)}}raiseHand(){var F;return __awaiter$5(this,void 0,void 0,(function*(){this._sendFeatureUsage("raiseHand",wu.attempt);try{if(void 0!==this.getLocalRaiseHandState())return void this._sendFeatureUsage("raiseHand",wu.failure);const F={level:"user",type:"raiseHands",content:"{}"};if(!(yield this._tsCall.publishState(F,te.generateCauseId())))throw new CallingCommunicationError({message:"Could not change a participant state.",code:ue});this._sendFeatureUsage("raiseHand",wu.success)}catch(B){throw this._logger.error("Could not change a participant state.",B),this._sendFeatureUsage("raiseHand",wu.failure),new CallingCommunicationError({message:"Could not change a participant state.",code:(null===(F=null==B?void 0:B.response)||void 0===F?void 0:F.status)||ue},B)}}))}lowerHand(){var F;return __awaiter$5(this,void 0,void 0,(function*(){this._sendFeatureUsage("lowerHand",wu.attempt);try{const F=this.getLocalRaiseHandState();if(void 0===F)return void this._sendFeatureUsage("lowerHand",wu.failure);const B={stateIds:[F]};yield this._tsCall.removeState(B,te.generateCauseId()),this._sendFeatureUsage("lowerHand",wu.success)}catch(B){throw this._logger.error("Could not change a participant state.",B),this._sendFeatureUsage("lowerHand",wu.failure),new CallingCommunicationError({message:"Could not change a participant state.",code:(null===(F=null==B?void 0:B.response)||void 0===F?void 0:F.status)||ue},B)}}))}lowerHands(F){var B;return __awaiter$5(this,void 0,void 0,(function*(){this._sendFeatureUsage("lowerHands",wu.attempt);try{if(0===F.length)return void this._sendFeatureUsage("lowerHands",wu.failure);if(!this._tsCall.publishedStates)return void this._sendFeatureUsage("lowerHands",wu.failure);const B=F.map((F=>getMriFromIdentifier(F))),G=this.findStateIdsForParticipantIds(B);yield this._tsCall.removeState({stateIds:G},te.generateCauseId()),this._sendFeatureUsage("lowerHands",wu.success)}catch(F){throw this._logger.error("Could not change a participant state.",F),this._sendFeatureUsage("lowerHands",wu.failure),new CallingCommunicationError({message:"Could not change a participant state.",code:(null===(B=null==F?void 0:F.response)||void 0===B?void 0:B.status)||ue},F)}}))}lowerHandForEveryone(){var F;return __awaiter$5(this,void 0,void 0,(function*(){this._sendFeatureUsage("lowerHandForEveryone",wu.attempt);try{yield this._tsCall.removeStatesForEveryone({type:"raiseHands"},te.generateCauseId()),this._sendFeatureUsage("lowerHandForEveryone",wu.success)}catch(B){throw this._logger.error("Could not change a participant state.",B),this._sendFeatureUsage("lowerHandForEveryone",wu.failure),new CallingCommunicationError({message:"Could not change a participant state.",code:(null===(F=null==B?void 0:B.response)||void 0===F?void 0:F.status)||ue},B)}}))}get currentRaiseHandStates(){return this._tsCall.publishedStates?this.getPublishedState(this._tsCall.publishedStates).sort(this.typeRankComparator).map((F=>constructIdentifierKindFromMri(F.id))).filter((F=>G.isMicrosoftTeamsUserIdentifier(F)||G.isCommunicationUserIdentifier(F))).map((F=>F)).map(((F,B)=>({identifier:F,order:B+1}))):[]}getLocalRaiseHandState(){const F=this.findStateIdsForParticipantIds([this._internalCallAgent.getUserMri()]);if(F&&F.length>0)return F[0]}findStateIdsForParticipantIds(F){return F&&this._tsCall.publishedStates?this.getPublishedState(this._tsCall.publishedStates).filter((B=>F.includes(B.id))).map((F=>{var B;return null===(B=F.publishedState)||void 0===B?void 0:B.stateId})).filter((F=>!!F)):[]}getPublishedState(F){return F.typeStates.filter((F=>"raiseHands"===F.type)).map((F=>F.participantStates)).flat()}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._tsCall.callId,localParticipantId:this._tsCall.participantId,featureName:"RaiseHand",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}}var xu,bitwise=function(F){var B=0;if(0==F.length)return B;for(var G=0;G<F.length;G++){B=(B<<5)-B+F.charCodeAt(G),B&=B}return B},binaryTransfer=function(F,B){var G="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";B=B||62;var W,z=[],K="",J=F<0?"-":"";for(F=Math.abs(F);F>=B;)W=F%B,F=Math.floor(F/B),z.push(G[W]);F>0&&z.push(G[F]);for(var Q=z.length-1;Q>=0;Q--)K+=z[Q];return J+K},dist=function(F){var B=typeof F;if("string"===B||"number"===B)return binaryTransfer(bitwise(String(F)),61).replace("-","Z");throw new Error("Unexpected input type")};class DebugInfoCallClientFeatureImpl extends FirstPartyCallClientFeature{constructor(F){super(F),this._impl=new DebugInfoImplOverTsCall}get name(){return this._sendFeatureUsage("name",wu.getter),"DebugInfo"}get lastLocalParticipantId(){return this._sendFeatureUsage("lastLocalParticipantId",wu.getter),this._impl.lastLocalParticipantId}get logs(){return this._impl.logDump}get localParticipantIdMap(){return this._impl.localParticipantIdMap}get incommingCallIdMap(){return this._impl.incommingCallIdMap}get lastCallId(){if(this._sendFeatureUsage("lastCallId",wu.getter),this.lastLocalParticipantId)return this._impl.localParticipantIdMap[this.lastLocalParticipantId].callIds.slice(-1)[0]}get userAgent(){return this._impl.userAgent}get sdkVersion(){return getSdkVersion()}get acsResourceId(){return this._impl.AcsResourceId}get clientId(){return this._impl.clientId}dumpDebugInfoAsJSONString(){try{return JSON.stringify(this.toZip())}catch(F){return`JSON.stringify threw: ${F}`}}toZip(){return{clientId:this.clientId,lastLocalParticipantId:this.lastLocalParticipantId,localParticipantIdMap:this.localParticipantIdMap,incommingCallMap:this.incommingCallIdMap,AcsResourceId:this.acsResourceId,userAgent:this.userAgent,sdkVersion:this.sdkVersion,logs:this.logs}}dumpDebugInfo(){this._sendFeatureUsage("dumpDebugInfo",wu.attempt);try{const F=yu.deflate(this.dumpDebugInfoAsJSONString(),{to:"string"}),B=dist(F);return this._sendFeatureUsage("dumpDebugInfo",wu.success),{dump:F,dumpId:`${generateGuid()}-${B}`}}catch(F){const B=`failed to deflate, error: ${F}`;return this.logger.error(B),this._sendFeatureUsage("dumpDebugInfo",wu.failure),{dump:yu.deflate(B,{to:"string"}),dumpId:generateGuid()}}}initialize(F,B){this._impl.initialize(F,B),this.logger=B,this._telemetryLogManager=F.telemetryLogManager,this._sendFeatureUsage("initialize",wu.initialize)}_sendFeatureUsage(F,B){sendCallClientFeatureUsageTelemetry({featureName:"DebugInfo",featureType:"CallClient",initializationType:"OnExtendedObjectConstructor",featureDetails:{name:F,step:B}},this._telemetryLogManager,this.logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class DebugInfoImplOverTsCall{constructor(){this._localParticipantIdMap={},this._incommingCallIdMap={}}get userAgent(){return this._userAgent}get logDump(){return this._logger.log("Log dump requested"),this._logger.dumpAllLogs()}get AcsResourceId(){var F;return null===(F=this._callAgent)||void 0===F?void 0:F.getAcsResourceId()}get lastLocalParticipantId(){return this._lastLocalParticipantId}get localParticipantIdMap(){return this._localParticipantIdMap}get incommingCallIdMap(){return this._incommingCallIdMap}get clientId(){var F;return null===(F=this._callAgent)||void 0===F?void 0:F.getClientId()}initialize(F,B){var G;this._logger=B,this._callAgent=null===(G=null==F?void 0:F.callClient)||void 0===G?void 0:G.callAgent,this._userAgent=null==F?void 0:F.callClient.userAgent,this._logger.info("waiting for call agent to be created");const bindAndSubscribeToCallAgentEvents=()=>{this._callAgent=null==F?void 0:F.callClient.callAgent,this.subscribeToCallAgentEvents()};null==F||F.callClient.on("callAgentCreated",bindAndSubscribeToCallAgentEvents)}dispose(){}subscribeToCallAgentEvents(){var F,B;try{null===(F=this._callAgent)||void 0===F||F.on("callsUpdated",(F=>{[...F.added,...F.removed].forEach((F=>{this.updateLocalParticipantIdMap(F),F.on("idChanged",(()=>{this.updateLocalParticipantIdMap(F)}))}))})),null===(B=this._callAgent)||void 0===B||B.on("incomingCall",(F=>{var B;let G=F.incomingCall;G.on("callEnded",(F=>{try{this._incommingCallIdMap[G.id]=JSON.stringify(F.callEndReason)}catch(F){this._incommingCallIdMap[G.id]="callEnd reason unknown"}}));try{this._incommingCallIdMap[G.id]=JSON.stringify(null===(B=F.incomingCall.callerInfo.identifier)||void 0===B?void 0:B.kind)}catch(F){this._incommingCallIdMap[G.id]="identifier kind unknown"}}))}catch(F){this._logger.info("failed to subscribe to call agent events, due to non initialized call agent")}}updateLocalParticipantIdMap(F){var B,G,W;try{let z=null!==(G=null===(B=this._localParticipantIdMap[F.tsCall.participantId])||void 0===B?void 0:B.callIds.filter((B=>B!==F.tsCall.callId)).concat([F.tsCall.callId]))&&void 0!==G?G:[F.tsCall.callId],K=[],J=[],Q=F.callEndReason?JSON.stringify(F.callEndReason):F.state,Y=F.state;(null===(W=this._localParticipantIdMap[F.tsCall.participantId])||void 0===W?void 0:W.callEndReasons)?(this._localParticipantIdMap[F.tsCall.participantId].callEndReasons.slice(-1)[0]!==Q?(this._localParticipantIdMap[F.tsCall.participantId].callEndReasons.push(Q),K=this._localParticipantIdMap[F.tsCall.participantId].callEndReasons):K=this._localParticipantIdMap[F.tsCall.participantId].callEndReasons,this._localParticipantIdMap[F.tsCall.participantId].stateTransitions.slice(-1)[0]!==Y?(this._localParticipantIdMap[F.tsCall.participantId].stateTransitions.push(Y),J=this._localParticipantIdMap[F.tsCall.participantId].stateTransitions):J=this._localParticipantIdMap[F.tsCall.participantId].stateTransitions):(K=[Q],J=[F.state]),this._localParticipantIdMap[F.tsCall.participantId]={callIds:z,callEndReasons:K,stateTransitions:J},this._logger.info(`localParticipantIdMap: ${JSON.stringify(this._localParticipantIdMap)}`),F.on("stateChanged",(()=>{"Connected"===F.state&&(this._lastLocalParticipantId=F.tsCall.participantId,this._logger.info(`last patricipant id: ${this._lastLocalParticipantId}`)),this._localParticipantIdMap[F.tsCall.participantId].stateTransitions.slice(-1)[0]!==F.state&&this.localParticipantIdMap[F.tsCall.participantId].stateTransitions.push(F.state)}))}catch(F){this._logger.error(`exception occured while updating localParticipantId map: ${F}`)}}}(xu=F.DiagnosticQuality||(F.DiagnosticQuality={}))[xu.Good=1]="Good",xu[xu.Poor=2]="Poor",xu[xu.Bad=3]="Bad";const Uu="networkReconnect",ju="networkReceiveQuality",Bu="networkSendQuality",Hu="networkRelaysNotReachable",Vu="noNetwork",Gu="noSpeakerDevicesEnumerated",Wu="noMicrophoneDevicesEnumerated",qu="microphoneNotFunctioning",zu="microphoneMuteUnexpectedly",Ku="cameraStoppedUnexpectedly",Ju="capturerStoppedUnexpectedly",Qu="speakingWhileMicrophoneIsMuted",Yu="cameraFreeze",$u="cameraStartFailed",Xu="capturerStartFailed",Zu="cameraStartTimedOut",ep="screenshareRecordingDisabled",tp="microphonePermissionDenied",np="cameraPermissionDenied";class UserFacingDiagnosticsFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new UserFacingDiagnosticsImplOverTsCall}get name(){return this._sendFeatureUsage("name",wu.getter),"Diagnostics"}get network(){return this._sendFeatureUsage("network",wu.getter),this._impl.network}get media(){return this._sendFeatureUsage("media",wu.getter),this._impl.media}initialize(F,B){this._logger=B,this._telemetryLogManager=F.telemetryLogManager,this._call=F.call,this._impl.initialize(F,B),this._sendFeatureUsage("initialize",wu.initialize)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"Diagnostics",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class UserFacingDiagnosticsImplOverTsCall{constructor(){}get network(){return this._network}get media(){return this._media}initialize(F,B){this._network=new NetworkDiagnosticsImpl(F,B),this._media=new MediaDiagnosticsImpl(F,B)}dispose(){}}class UserFacingDiagnosticsImpl{constructor(B,G){this.logger=G,this._tsUfdUnknownValue=0,this.tsQualityToAcsQualityMap={1:F.DiagnosticQuality.Good,2:F.DiagnosticQuality.Poor,3:F.DiagnosticQuality.Bad},this.tssQualityToAcsBooleanMap={3:!0,1:!1},this._tsCall=B.tsCall,this.eventEmitter=new Jt.EventEmitter,this._tsCall.on("callQualityChanged",(B=>{try{const G=this.mapTSQualityEventType(B.type,B.mediaType);if(G){if(B.value===this._tsUfdUnknownValue)return;const W=G,z=this.mapTSQualityLevel(G,B.value);let K;if("number"!=typeof z||z!==F.DiagnosticQuality.Good&&z!==F.DiagnosticQuality.Poor&&z!==F.DiagnosticQuality.Bad){if("boolean"!=typeof z)throw new CallingCommunicationError({message:`Mapped to an incorrect value type=${typeof z}, diagnostic value=${z}, for diagnostic ${W}`,code:ue});K="DiagnosticFlag"}else K="DiagnosticQuality";let J={diagnostic:W,value:z,valueType:K};this.logger.log(`Call diagnostic changed, diagnostic='${J.diagnostic}', value='${J.value}'`);const Q="DiagnosticFlag"===J.valueType&&!0===J.value,Y="DiagnosticQuality"===J.valueType&&(J.value===F.DiagnosticQuality.Bad||J.value===F.DiagnosticQuality.Poor);(Q||Y)&&this.logger.warn(`Call diagnostic error raised!, diagnostic='${J.diagnostic}', value='${J.value}', value type='${J.valueType}'`),this.eventEmitter.emit("diagnosticChanged",J)}}catch(F){this.logger.error(`${F.message})`)}}))}}class NetworkDiagnosticsImpl extends UserFacingDiagnosticsImpl{constructor(F,B){super(F,B.createChild((()=>`[UserFacingDiagnosticsFeature:NetworkDiagnostics:Call(id='${F.tsCall.callId}', state='${F.tsCall.state}')]`))),this.latestNetworkDiagnostics=new Map}on(F,B){if("diagnosticChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this.eventEmitter.on(F,B)}off(F,B){if("diagnosticChanged"!==F&&"diagnosticFlagChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this.eventEmitter.off(F,B)}getLatest(){try{return convertMapToFrozenJson(this.latestNetworkDiagnostics)}catch(F){return this.logger.error("Failed to get latest network diagnostics"),{}}}mapTSQualityEventType(F){return{5:Uu,2:ju,1:Bu,32:Hu,37:Vu}[F]}mapTSQualityLevel(F,B){let G,W;switch(F){case Uu:case ju:case Bu:W="DiagnosticQuality",G=this.tsQualityToAcsQualityMap[B];break;case Hu:case Vu:W="DiagnosticFlag",G=this.tssQualityToAcsBooleanMap[B]}if(void 0===G)throw new CallingCommunicationError({message:`Cannot map ts quality level ${B} for ${F}`,code:ue});return this.latestNetworkDiagnostics.set(F,{value:G,valueType:W}),G}}class MediaDiagnosticsImpl extends UserFacingDiagnosticsImpl{constructor(F,B){super(F,B.createChild((()=>`[UserFacingDiagnosticsFeature:MediaDiagnostics:Call(id='${F.tsCall.callId}', state='${F.tsCall.state}')]`))),this.latestMediaDiagnostics=new Map}on(F,B){if("diagnosticChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this.eventEmitter.on(F,B)}off(F,B){if("diagnosticChanged"!==F&&"diagnosticFlagChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this.eventEmitter.off(F,B)}getLatest(){try{return convertMapToFrozenJson(this.latestMediaDiagnostics)}catch(F){return this.logger.error("Failed to get latest media diagnostics"),{}}}mapTSQualityEventType(F,B){const G={44:Gu,43:Wu,9:qu,25:zu,27:Qu,45:Yu,33:$u,34:Zu,55:ep,26:tp,47:np};return this.overrideQualityEventsForMediaType(G[F],B)}overrideQualityEventsForMediaType(F,B){if(F===zu)switch(B){case 1:return Ku;case 2:return Ju}return F===$u&&2===B?Xu:F}mapTSQualityLevel(F,B){let G,W;switch(F){case Gu:case Wu:case qu:case zu:case Qu:case Yu:case $u:case Zu:case ep:case tp:case np:case Ku:case Ju:case Xu:W="DiagnosticFlag",G=this.tssQualityToAcsBooleanMap[B]}if(void 0===G)throw new CallingCommunicationError({message:`Cannot map ts quality level ${B}`,code:ue});return this.latestMediaDiagnostics.set(F,{value:G,valueType:W}),G}}class DominantSpeakersCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new DominantSpeakersCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage("name",wu.getter),"DominantSpeakers"}initialize(F,B){this._logger=B,this._telemetryLogManager=F.telemetryLogManager,this._call=F.call,this._impl.initialize(F.tsCall,F.callAgent,F.telemetryLogManager,B),this._sendFeatureUsage("initialize",wu.initialize)}get dominantSpeakers(){return this._sendFeatureUsage("dominantSpeakers",wu.getter),this._impl.dominantSpeakers}on(F,B){this._sendFeatureUsage("dominantSpeakersChanged",wu.subscribe),this.eventEmitter.on(F,B)}off(F,B){this._sendFeatureUsage("dominantSpeakersChanged",wu.unsubscribe),this.eventEmitter.off(F,B)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"DominantSpeakers",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class DominantSpeakersCallImplOverTsCall{constructor(F){this._eventEmitter=F,this.localDominantList=[]}initialize(F,B,G,W){var z;this._logger=W.createChild((()=>`DominantSpeakersFeature::Call(id='${F.callId}')`)),this._tsCall=F,this.localDominantList=(null===(z=this._tsCall.dominantSpeakerInfo)||void 0===z?void 0:z.speakerList)||[],this._tsCall.changed((()=>{let F=!1;if(this.localDominantList.length!=this._tsCall.dominantSpeakerInfo.speakerList.length)F=!0;else for(let B in this._tsCall.dominantSpeakerInfo.speakerList)if(this._tsCall.dominantSpeakerInfo.speakerList[B]!==this.localDominantList[B]){F=!0;break}F&&(this._logger.info("Dominant speakers list change detected"),this.localDominantList=this._tsCall.dominantSpeakerInfo.speakerList,this._eventEmitter.emit("dominantSpeakersChanged"))}))}get dominantSpeakers(){let F=Array();return this._tsCall.dominantSpeakerInfo.speakerList.map((B=>{F.push(constructIdentifierKindFromMri(B))})),{speakersList:F,timestamp:this._tsCall.dominantSpeakerInfo.timestamp||new Date}}dispose(){}}class CallingEventEmitter extends Jt.EventEmitter{constructor(F,B){super(),this._options={enableLogOn:!0,enableLogOff:!0,enableLogOnce:!0,enableLogEmit:!0},this._logger=F.createChild("CallingEventEmitter"),B&&(this._options=B)}on(F,B){return!1!==this._options.enableLogOn&&this._logger.info(`event:subscribe to ${F.toString()}`),super.on(F,B)}once(F,B){return!1!==this._options.enableLogOnce&&this._logger.info(`event:subscribe once to ${F.toString()}`),super.once(F,B)}off(F,B){return!1!==this._options.enableLogOff&&this._logger.info(`event:unsubscribed ${F.toString()}`),super.off(F,B)}emit(F,...B){return!1!==this._options.enableLogEmit&&this._logger.info(`event:emit ${F.toString()}`),super.emit(F,...B)}}function createMediaStatsCalculators(){return{audio:{send:{},receive:{}},video:{send:{},receive:{}},screenShare:{send:{},receive:{}}}}function getMax(F){let B=F.length>0?F[0]:0;return F.forEach((F=>{F>B&&(B=F)})),B}function getMin(F){let B=F.length>0?F[0]:0;return F.forEach((F=>{F<B&&(B=F)})),B}function getSum(F){let B=0,G=0;return F.forEach((F=>{const W=F-G,z=B+W;G=z-B-W,B=z})),B}class StatsCalculator{constructor(F){this._statsInfo=F,this._originalValues={},this._aggregateValues={}}addStats(F,B){const G=this._statsInfo[F];let W=this._originalValues[F];if(void 0===W&&(W={raw:[],calc:[]},this._originalValues[F]=W),W.raw.push(B),("diff"===G.calculation_method||"last2"===G.calculation_method)&&W.raw.length>1){const F=W.raw[W.raw.length-1],B=W.raw[W.raw.length-2];W.calc.push(F-B)}}aggregate(){var F;for(const[B,G]of Object.entries(this._originalValues)){const W=this._statsInfo[B];if(void 0===W||!1===W.show)continue;let z=this._aggregateValues[B];void 0===z&&(z={raw:[],timestamp:new Date},W.aggregation_needed&&(z.aggregation={count:[],sum:[],max:[],min:[]}),this._aggregateValues[B]=z);const K=(null===(F=G.calc)||void 0===F?void 0:F.length)?G.calc:G.raw;let J=K;if(W.aggregation_needed&&z.aggregation){const F=K.filter((F=>"number"==typeof F&&!isNaN(F)));z.aggregation.count.push(F.length),z.aggregation.sum.push(getSum(F)),z.aggregation.max.push(getMax(F)),z.aggregation.min.push(getMin(F)),J=F}W.raw_data_reduction&&J.length>0&&(z.reduced=z.reduced||[],z.reduced.push(J[J.length-1])),J.forEach((F=>z.raw.push(F)))}this._originalValues={}}popAggregates(){var F;const B={};for(const[G,W]of Object.entries(this._aggregateValues)){B[null!==(F=this._statsInfo[G].name)&&void 0!==F?F:G]=W}return this._aggregateValues={},B}}var __awaiter$6=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class MediaStatsCollectorImpl{constructor(F,B,G){if(this._tsCall=F,this._aggregationInterval=0,this._dataPointsPerAggregation=0,this._disposed=!1,this._calculators=createMediaStatsCalculators(),G.aggregationInterval<1)throw new Error("invalid aggregationInterval value range");if(G.dataPointsPerAggregation<1)throw new Error("invalid dataPointsPerAggregation value range");this._logger=B.createChild("MediaStatsCollector"),this._eventEmitter=new CallingEventEmitter(this._logger,{enableLogEmit:!1}),this._callStateChanged=defer$1(),this._statsPoller=G.statsPoller,this._statsInfo=G.statsInfo,this._aggregationInterval=G.aggregationInterval,this._dataPointsPerAggregation=G.dataPointsPerAggregation,this._isInternal=G.isInternal,this._dataEventListener=F=>{void 0!==F&&this._processMediaStatsReport(F)},this._statsPoller.on("data",this._dataEventListener);const W=[3,10];let z=W.includes(this._tsCall.state);this._callStateChangedHandle=this._tsCall.on("callStateChanged",(()=>{z!==W.includes(this._tsCall.state)&&(z=!z,this._callStateChanged.resolve(z))})),this._run()}on(F,B){this._eventEmitter.on(F,B)}off(F,B){this._eventEmitter.off(F,B)}dispose(){this._disposed||(this._disposed=!0,this._callStateChangedHandle.dispose(),this._callStateChanged.resolve(!1),this._statsPoller.off("data",this._dataEventListener),this._eventEmitter.emit("dispose"),this._eventEmitter.removeAllListeners())}_processMediaStatsReport(F){const B={audio:{send:[],receive:[]},video:{send:[],receive:[]},screenShare:{send:[],receive:[]}};try{const G=[[F.audio.send,B.audio.send,this._calculators.audio.send],[F.audio.recv,B.audio.receive,this._calculators.audio.receive],[F.video.send,B.video.send,this._calculators.video.send],[F.video.recv,B.video.receive,this._calculators.video.receive],[F.screenShare.send,B.screenShare.send,this._calculators.screenShare.send],[F.screenShare.recv,B.screenShare.receive,this._calculators.screenShare.receive]];for(const[F,B,W]of G){const G=[],z=Object.keys(W);for(const z of F){const F={id:z.id};G.push(z.id),void 0===W[z.id]&&(W[z.id]=new StatsCalculator(this._statsInfo)),Object.keys(z).forEach((B=>{var G;const K=this._statsInfo[B];if(K&&!1!==K.show&&(this._isInternal||!K.is_internal)){let J=z[B];void 0!==K.multiplier&&(J*=K.multiplier),!0===K.integer&&(J|=0);const Q=null!==(G=K.name)&&void 0!==G?G:B;W[z.id].addStats(B,J),F[Q]=J}})),B.push(F)}z.filter((F=>!G.includes(F))).forEach((F=>{delete W[F]}))}}catch(F){this._logger.error(F)}this._eventEmitter.emit("sampleReported",B)}_run(){return __awaiter$6(this,void 0,void 0,(function*(){const F=getAcsEcsConfig().telemetry.mediaStatsConfig;let B=0;const filterReducedRaw=F=>(Object.keys(F).forEach((B=>{F[B].reduced&&!this._isInternal&&delete F[B].reduced})),F),flushData=()=>{if(0===B)return;const G={audio:{send:[],receive:[]},video:{send:[],receive:[]},screenShare:{send:[],receive:[]}};for(const[F,B]of Object.entries(this._calculators.audio.send))G.audio.send.push(Object.assign({id:F},filterReducedRaw(B.popAggregates())));for(const[F,B]of Object.entries(this._calculators.audio.receive))G.audio.receive.push(Object.assign({id:F},filterReducedRaw(B.popAggregates())));for(const[F,B]of Object.entries(this._calculators.video.send))G.video.send.push(Object.assign({id:F},filterReducedRaw(B.popAggregates())));for(const[F,B]of Object.entries(this._calculators.video.receive))G.video.receive.push(Object.assign({id:F},filterReducedRaw(B.popAggregates())));for(const[F,B]of Object.entries(this._calculators.screenShare.send))G.screenShare.send.push(Object.assign({id:F},filterReducedRaw(B.popAggregates())));for(const[F,B]of Object.entries(this._calculators.screenShare.receive))G.screenShare.receive.push(Object.assign({id:F},filterReducedRaw(B.popAggregates())));this._eventEmitter.emit("summaryReported",G),F.enableLegacyMediaStats&&this._eventEmitter.emit("mediaStatsEmitted",{collectionInterval:this._statsPoller.fetchInterval,aggregationInterval:this._aggregationInterval,stats:generateMediaStatsList(G)}),B=0},G=[3,10];let W=1e3*this._aggregationInterval;for(;!this._disposed;){const F=[this._calculators.audio.send,this._calculators.audio.receive,this._calculators.video.send,this._calculators.video.receive,this._calculators.screenShare.send,this._calculators.screenShare.receive];if(G.includes(this._tsCall.state)){W>0&&(yield wait((()=>this._callStateChanged.promise),W).catch((F=>{})));const G=Date.now();for(const B of F)for(const[,F]of Object.entries(B))F.aggregate();B++,B===this._dataPointsPerAggregation&&flushData();const z=Date.now();W=G+1e3*this._aggregationInterval-z}else flushData(),this._calculators=createMediaStatsCalculators(),yield this._callStateChanged.promise.catch((F=>{})),W=1e3*this._aggregationInterval;this._callStateChanged.isPending()||(this._callStateChanged=defer$1())}flushData()}))}}function generateMediaStatsList(F){const B={};if(F.video.send.length>0){const G=F.video.send[0];B.sentBWEstimate=G.availableBitrate,B.videoSendRtt=G.rttInMs,B.videoSendPairRtt=G.pairRttInMs,B.videoSendJitterMs=G.jitterInMs,B.videoSendPackets=G.packetsPerSecond,B.videoSendPacketsLost=G.packetsLostPerSecond,B.videoSendBitrate=G.bitrate,B.videoSendCodecName=G.codecName,B.videoSendFrameRateInput=G.frameRateInput,B.videoSendFrameRateSent=G.frameRateSent,B.videoSendFrameWidthInput=G.frameWidthInput,B.videoSendFrameHeightInput=G.frameHeightInput,B.videoSendFrameWidthSent=G.frameWidthSent,B.videoSendFrameHeightSent=G.frameHeightSent}if(F.video.receive.length>0){const G=F.video.receive[0];B.videoRecvPairRtt=G.pairRttInMs,B.videoRecvJitterBufferMs=G.jitterBufferInMs,B.videoRecvJitterMs=G.jitterInMs,B.videoRecvPackets=G.packetsPerSecond,B.videoRecvPacketsLost=G.packetsLostPerSecond,B.videoRecvBitrate=G.bitrate,B.videoRecvFrameRateReceived=G.frameRateReceived,B.videoRecvFrameRateDecoded=G.frameRateDecoded,B.videoRecvFrameRateOutput=G.frameRateOutput,B.videoRecvFrameWidthReceived=G.frameWidthReceived,B.videoRecvFrameHeightReceived=G.frameHeightReceived,B.videoRecvLongestFreezeDuration=G.longestFreezeDurationInMs,B.videoRecvTotalFreezeDuration=G.totalFreezeDurationInMs}if(F.audio.send.length>0){const G=F.audio.send[0];B.audioSendRtt=G.rttInMs,B.audioSendPairRtt=G.pairRttInMs,B.audioSendJitterMs=G.jitterInMs,B.audioSendPackets=G.packetsPerSecond,B.audioSendPacketsLost=G.packetsLostPerSecond,B.audioSendBitrate=G.bitrate,B.audioSendCodecName=G.codecName,B.audioSendAudioInputLevel=G.audioInputLevel}if(F.audio.receive.length>0){const G=F.audio.receive[0];B.audioRecvPairRtt=G.rttInMs,B.audioSendPairRtt=G.pairRttInMs,B.audioRecvJitterBufferMs=G.jitterBufferInMs,B.audioRecvJitterMs=G.jitterInMs,B.audioRecvPackets=G.packetsPerSecond,B.audioRecvPacketsLost=G.packetsLostPerSecond,B.audioRecvBitrate=G.bitrate,B.audioRecvAudioOutputLevel=G.audioOutputLevel}if(F.screenShare.send.length>0){const G=F.screenShare.send[0];B.screenSharingSendPacketsLost=G.packetsLostPerSecond,B.screenSharingSendCodecName=G.codecName,B.screenSharingSendFrameRateInput=G.frameRateInput,B.screenSharingSendFrameRateSent=G.frameRateSent,B.screenSharingSendFrameWidthInput=G.frameWidthInput,B.screenSharingSendFrameHeightInput=G.frameHeightInput,B.screenSharingSendFrameWidthSent=G.frameWidthSent,B.screenSharingSendFrameHeightSent=G.frameHeightSent}if(F.screenShare.receive.length>0){const G=F.screenShare.receive[0];B.screenSharingRecvJitterBufferMs=G.jitterBufferInMs,B.screenSharingRecvPacketsLost=G.packetsLostPerSecond,B.screenSharingRecvCodecName=G.codecName,B.screenSharingRecvFrameRateReceived=G.frameRateReceived,B.screenSharingRecvFrameRateDecoded=G.frameRateDecoded,B.screenSharingRecvFrameRateOutput=G.frameRateOutput,B.screenSharingRecvFrameWidthReceived=G.frameWidthReceived,B.screenSharingRecvFrameHeightReceived=G.frameHeightReceived,B.screenSharingRecvLongestFreezeDuration=G.longestFreezeDurationInMs,B.screenSharingRecvTotalFreezeDuration=G.totalFreezeDurationInMs}return Object.keys(B).forEach((F=>{void 0===B[F]&&delete B[F]})),B}var ip,__awaiter$7=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class StatsPoller{constructor(F,B,G){this._tsCall=F,this._logger=B,this._state={isRunning:!1},this._callQueue=Promise.resolve(),this._dataEventRefCount=0,this._fetchInterval=G,this._eventEmitter=new CallingEventEmitter(this._logger,{enableLogEmit:!1});const checkState=()=>{[10,3].includes(this._tsCall.state)?this._start():this._stop()};this._callStateChangedHandle=this._tsCall.on("callStateChanged",(()=>{checkState()})),checkState()}dispose(){this._callStateChangedHandle.dispose(),this._stop()}get fetchInterval(){return this._fetchInterval}_start(){if(this._state.isRunning)return;const F={isRunning:!0};this._state=F;const B=1e3*this._fetchInterval,runLoop=()=>__awaiter$7(this,void 0,void 0,(function*(){for(;F.isRunning;){const F=Date.now();try{if(this._dataEventRefCount>0){const F=yield this.getStats();F&&this._eventEmitter.emit("data",F)}}catch(F){this._logger.error(F)}const G=Date.now()-F;G<B&&(yield sleep(B-G))}}));this._callQueue=this._callQueue.then((()=>runLoop())).catch((()=>{}))}_stop(){this._state.isRunning&&(this._state.isRunning=!1)}on(F,B){this._dataEventRefCount++,this._eventEmitter.on(F,B)}off(F,B){this._dataEventRefCount--,this._eventEmitter.off(F,B)}}class MediaStatsPoller extends StatsPoller{constructor(F,B,G){super(F,B.createChild("MediaStatsPoller"),G)}getStats(){const F=this._tsCall.getMediaSessionStats();return Promise.resolve(F)}}class MediaStatsTelemetryLogger{constructor(F,B,G){this._tsCall=F,this._telemetryLogManager=B,this._config=G,this._participants=new Map,this._listenerHandles=[],this._senderStatsKeys={},this._listenerHandles.push(this._tsCall.on("participantAdded",(F=>{this._participants.clear()}))),this._listenerHandles.push(this._tsCall.on("participantRemoved",(F=>{this._participants.clear()}))),["audioSendRtt","audioSendPairRtt","videoSendRtt","videoSendPairRtt","audioSendJitterMs","videoSendJitterMs","audioSendPackets","videoSendPackets","audioSendPacketsLost","videoSendPacketsLost","screenSharingSendPacketsLost","audioSendBitrate","videoSendBitrate","videoSendFrameRateInput","videoSendFrameRateSent","screenSharingSendFrameRateInput","screenSharingSendFrameRateSent","videoSendFramesEncoded","screenSharingSendFramesEncoded"].forEach((F=>this._senderStatsKeys[F]=!0))}dispose(){this._listenerHandles.forEach((F=>F.dispose()))}_getParticipantId(F,B){if(void 0===B)return;const G=this._participants.get(B);return void 0!==G?G:(this._tsCall.participants.forEach((B=>{B.streams[F].forEach((F=>{!this._participants.has(F.id)&&F.participantId&&this._participants.set(F.id,F.participantId)}))})),this._participants.get(B))}log(F){[{type:"audio",direction:"send",value:F.audio.send},{type:"audio",direction:"recv",value:F.audio.receive},{type:"video",direction:"send",value:F.video.send},{type:"video",direction:"recv",value:F.video.receive},{type:"screen",direction:"send",value:F.screenShare.send},{type:"screen",direction:"recv",value:F.screenShare.receive}].forEach((F=>{F.value.forEach((B=>{var G;const W={id:B.id},z={id:B.id};Object.keys(B).forEach((F=>{var G,K;const J=F,Q=B[J];if(this._config.dataToSend.raw&&"id"!==J){const F={};(null==Q?void 0:Q.timestamp)&&(F.timestamp=null==Q?void 0:Q.timestamp),this._config.dataToSend.raw&&(F.raw=null==Q?void 0:Q.raw),z[J]=F}if("id"!==J){const F={};void 0!==(null==Q?void 0:Q.aggregation)?((null==Q?void 0:Q.timestamp)&&(F.timestamp=null==Q?void 0:Q.timestamp),this._config.dataToSend.min&&(F.min=null==Q?void 0:Q.aggregation.min),this._config.dataToSend.max&&(F.max=null==Q?void 0:Q.aggregation.max),this._config.dataToSend.sum&&(F.sum=null==Q?void 0:Q.aggregation.sum),this._config.dataToSend.count&&(F.count=null==Q?void 0:Q.aggregation.count)):((null==Q?void 0:Q.timestamp)&&(F.timestamp=null==Q?void 0:Q.timestamp),(null===(G=Q)||void 0===G?void 0:G.reduced)?F.raw=null===(K=Q)||void 0===K?void 0:K.reduced:(null==Q?void 0:Q.raw)&&(F.raw=null==Q?void 0:Q.raw)),W[J]=F}}));let K="";if(void 0!==B.streamId&&(null===(G=B.streamId.raw)||void 0===G?void 0:G.length)){const G=B.streamId.raw[0];"video"===F.type?K=this._getParticipantId(0,G)||"":"screen"===F.type&&(K=this._getParticipantId(1,G)||"")}if(Object.keys(W).length>1){const B={mediaType:F.type,mediaDirection:F.direction,stats:W,callId:this._tsCall.callId,remoteParticipantId:K,localParticipantId:this._tsCall.participantId};this._sendMidCallNewMediaStats(B)}if(this._config.dataToSend.raw&&Object.keys(z).length>1){const B={mediaType:F.type,mediaDirection:F.direction,stats:z,callId:this._tsCall.callId,remoteParticipantId:K,localParticipantId:this._tsCall.participantId};this._sendMidCallRawMediaStats(B)}}))}))}logMediaStats(F,B,G){const W=F.stats;Object.keys(W).forEach((B=>{var G;const z=B;(null===(G=W[z])||void 0===G?void 0:G.raw.every((F=>0===F)))&&delete F.stats[z]}));const z={};Object.keys(W).forEach((F=>{var G,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae;const se=F;if(void 0!==(null===(G=W[se])||void 0===G?void 0:G.aggregation)){const F=null!==(J=null===(K=W[se])||void 0===K?void 0:K.timestamp.getTime())&&void 0!==J?J:0,G={timestamp:null===(Q=W[se])||void 0===Q?void 0:Q.timestamp};if((this._config.dataToSend.raw||F<B&&this._senderStatsKeys[se])&&(G.raw=null===(Y=W[se])||void 0===Y?void 0:Y.raw),G.aggregation={},this._config.dataToSend.min&&(G.aggregation.min=null===(X=null===($=W[se])||void 0===$?void 0:$.aggregation)||void 0===X?void 0:X.min),this._config.dataToSend.max&&(G.aggregation.max=null===(ee=null===(Z=W[se])||void 0===Z?void 0:Z.aggregation)||void 0===ee?void 0:ee.max),this._config.dataToSend.sum&&(G.aggregation.sum=null===(ne=null===(te=W[se])||void 0===te?void 0:te.aggregation)||void 0===ne?void 0:ne.sum),this._config.dataToSend.count&&(G.aggregation.count=null===(re=null===(ie=W[se])||void 0===ie?void 0:ie.aggregation)||void 0===re?void 0:re.count),0===Object.keys(G.aggregation).length&&(delete G.aggregation,void 0===G.raw))return;z[se]=G}else z[se]={raw:null===(oe=W[se])||void 0===oe?void 0:oe.raw,timestamp:null===(ae=W[se])||void 0===ae?void 0:ae.timestamp}}));const K={callId:this._tsCall.callId,callType:this._tsCall.callType,callDirection:G.direction,groupJoin:!!this._tsCall.groupId,meetingJoin:!!this._tsCall.meetingInfo,localParticipantId:this._tsCall.participantId,collectionInterval:F.collectionInterval,aggregationInterval:F.aggregationInterval,stats:z};this._sendMidCallMediaStats(K)}_sendMidCallMediaStats(F){this._telemetryLogManager.sendEvent({name:Mu.acs_calling_mid_call_media_stats,tenant:ft,properties:F})}_sendMidCallNewMediaStats(F){this._telemetryLogManager.sendEvent({name:Mu.acs_calling_mid_call_new_media_stats,tenant:ft,properties:F})}_sendMidCallRawMediaStats(F){this._telemetryLogManager.sendEvent({name:Mu.acs_calling_mid_call_raw_media_stats,tenant:ft,properties:F})}}class MediaStatsManager{constructor(F,B,G,W){this._tsCall=F,this._call=B,this._logger=G,this._collectors=[],this._disposed=!1,this._externalStatsInfo={};const z=getAcsEcsConfig();this._config=z.telemetry.mediaStatsConfig,this._statsPoller=new MediaStatsPoller(this._tsCall,this._logger,this._config.fetchInterval);const K=Object.assign(Object.assign({},Ht),this._config.additionalStats);if(Object.entries(K).filter((([,F])=>!F.is_internal)).forEach((([F,B])=>{this._externalStatsInfo[F]=B})),this._config.enabled){let F=0,B=!1;const G=z.rendering.remoteVideo.createViewSenderStatsEnabled,J=z.rendering.remoteVideo.createViewSenderStatsDuration;G&&(this._remoteParticipantUpdatedListener=G=>{B=this._call.localVideoStreams.length>0||this._call.isScreenSharingOn,B&&G.added.length>0&&(F=Date.now()+J)},this._call.on("remoteParticipantsUpdated",this._remoteParticipantUpdatedListener));const Q=new MediaStatsCollectorImpl(this._tsCall,this._logger,{statsPoller:this._statsPoller,aggregationInterval:this._config.aggregationInterval,dataPointsPerAggregation:this._config.dataPointsPerAggregation,statsInfo:K,isInternal:!0}),Y=new MediaStatsTelemetryLogger(this._tsCall,W,this._config);Q.on("summaryReported",(F=>{Y.log(F)})),Q.on("mediaStatsEmitted",(W=>{if(G){const G=this._call.localVideoStreams.length>0||this._call.isScreenSharingOn;!B&&G&&(F=Date.now()+J),B=G}Y.logMediaStats(W,F,this._call)})),this._collectors.push(Q)}}createCollector(F){var B,G;if(this._disposed)throw new Error("MediaStatsCallFeature has been disposed");const W=this._config,z=new MediaStatsCollectorImpl(this._tsCall,this._logger,{statsPoller:this._statsPoller,aggregationInterval:null!==(B=null==F?void 0:F.aggregationInterval)&&void 0!==B?B:W.aggregationInterval,dataPointsPerAggregation:null!==(G=null==F?void 0:F.dataPointsPerAggregation)&&void 0!==G?G:W.dataPointsPerAggregation,statsInfo:this._externalStatsInfo,isInternal:!1});return z.on("dispose",(()=>{this._collectors=this._collectors.filter((F=>F!==z))})),this._collectors.push(z),z}dispose(){this._disposed||(this._disposed=!0,this._remoteParticipantUpdatedListener&&this._call.off("remoteParticipantsUpdated",this._remoteParticipantUpdatedListener),this._collectors.forEach((F=>{F.dispose()})))}}class MediaStatsCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F)}get name(){return this._sendFeatureUsage("name",wu.getter),"MediaStats"}createCollector(F){this._sendFeatureUsage("createCollector",wu.attempt);const B=this._statsManager.createCollector(F);return this._sendFeatureUsage("creaetCollector",wu.success),B}initialize(F,B){this._logger=B,this._telemetryLogManager=F.telemetryLogManager,this._call=F.call,this._statsManager=new MediaStatsManager(F.tsCall,this._call,this._logger,this._telemetryLogManager),this._sendFeatureUsage("initialize",wu.initialize)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"MediaStats",featureType:"Call",initializationType:"OnExtendedObjectConstructor",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._statsManager.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}(ip=F.RecordingState||(F.RecordingState={}))[ip.None=0]="None",ip[ip.Started=1]="Started",ip[ip.Paused=2]="Paused",ip[ip.Ended=3]="Ended";var __awaiter$8=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class RecordingCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new RecordingCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage("name",wu.getter),"Recording"}initialize(F,B){this._logger=B,this._telemetryLogManager=F.telemetryLogManager,this._call=F.call,this._impl.initialize(F.tsCall,F.telemetryLogManager,B),this._sendFeatureUsage("initialize",wu.initialize)}get isRecordingActive(){return this._sendFeatureUsage("isRecordingActive",wu.getter),this._impl.isRecordingActive}get recordings(){return this._sendFeatureUsage("recordings",wu.getter),this._impl.recordings}on(F,B){if("isRecordingActiveChanged"!==F&&"recordingsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._sendFeatureUsage(F,wu.subscribe),this.eventEmitter.on(F,B)}off(F,B){if("isRecordingActiveChanged"!==F&&"recordingsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe to event ${F}, unknown event name`,code:de});this._sendFeatureUsage(F,wu.unsubscribe),this.eventEmitter.off(F,B)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"Recording",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class RecordingCallImplOverTsCall{constructor(F){this._eventEmitter=F,this._recordingBots=new Map,this._recordingBotChangedSubs=new WeakMap,this._isRecordingActive=!1,this._updateIsCallRecorded=F=>this._isRecordingActive!==F&&(this._isRecordingActive=F,this._logger.info(`Updating isCallRecorded to ${F}`),!0),this._handleRecordingBotAdded=F=>{const handleRecordingBotChanged=()=>{var B,G;let W,z=!1,K=!1;if(this._hasRecordingState(F)){if(this._recordingBots.has(F.id)){let z=this._getRecordingBotEndpoint(F);W=this._recordingBots.get(F.id),z&&W&&(W.endpoint=z,K=null!==(G=null===(B=W.recordingInfo)||void 0===B?void 0:B.update(z))&&void 0!==G&&G)}else W=this._getRecordingBotInfo(F),W&&(this._logger.info("Adding recording bot"),this._recordingBots.set(F.id,W),z=!0);this._sendEvents(K?[W]:void 0,z?[W]:void 0,void 0,this._updateIsCallRecorded(this._isRecordingEnabled()))}};handleRecordingBotChanged(),this._recordingBotChangedSubs.set(F,F.changed(handleRecordingBotChanged))},this._handleRecordingBotRemoved=F=>{var B,G,W;let z=this._recordingBots.get(F.id);this._recordingBots.delete(F.id),null===(B=this._recordingBotChangedSubs.get(F))||void 0===B||B.dispose(),this._recordingBotChangedSubs.delete(F),this._logger.info(`Updating recordingState to ${null===(G=null==z?void 0:z.endpoint)||void 0===G?void 0:G.state}`),null===(W=null==z?void 0:z.recordingInfo)||void 0===W||W.dispose(),this._sendEvents([z],void 0,[z],this._updateIsCallRecorded(this._isRecordingEnabled()))},this._sendEvents=(F,B,G,W)=>{F&&F.forEach((F=>{var B;return null===(B=null==F?void 0:F.recordingInfo)||void 0===B?void 0:B.sendRecordingStateChanged()}));let z=!!B&&B.length>0,K=!!G&&G.length>0;(z||K)&&this._eventEmitter.emit("recordingsUpdated",{added:this._getRecordingInfos(B),removed:this._getRecordingInfos(G)}),W&&this._eventEmitter.emit("isRecordingActiveChanged")},this._hasRecordingState=F=>{var B,G,W;return null!==(W=null===(G=null===(B=null==F?void 0:F.endpoints)||void 0===B?void 0:B.endpointDetails)||void 0===G?void 0:G.some((F=>{var B,G,W,z,K,J,Q;return!!(null===(z=null===(W=null===(G=null===(B=null==F?void 0:F.endpointMetadata)||void 0===B?void 0:B.__platform)||void 0===G?void 0:G.recording)||void 0===W?void 0:W.compliance)||void 0===z?void 0:z.state)||!!(null===(Q=null===(J=null===(K=null==F?void 0:F.endpointMetadata)||void 0===K?void 0:K.processingModes)||void 0===J?void 0:J.recording)||void 0===Q?void 0:Q.state)})))&&void 0!==W&&W},this._getRecordingInfos=F=>{if(F)return F.map((F=>null==F?void 0:F.recordingInfo)).filter((F=>!!F))},this._isRecordingEnabled=()=>{let F=!1;try{this._recordingBots.forEach((B=>{var G;F||(F="Active"===(null===(G=null==B?void 0:B.endpoint)||void 0===G?void 0:G.state))}))}catch(F){this._logger.info("Unable to read recording state: ",F)}return F},this._getRecordingInfoImpl=F=>{if(null!=F&&("Active"===F.state||"Inactive"===F.state))return new RecordingInfoImpl(F.state,this._eventEmitter)},this._getRecordingBotInfo=F=>{let B=this._getRecordingBotEndpoint(F);return B?{endpoint:B,recordingInfo:this._getRecordingInfoImpl(B)}:void 0},this._getRecordingBotEndpoint=F=>{var B;let G=null===(B=F.endpoints)||void 0===B?void 0:B.endpointDetails.map((F=>{var B,G,W,z,K,J,Q;let Y=null===(z=null===(W=null===(G=null===(B=null==F?void 0:F.endpointMetadata)||void 0===B?void 0:B.__platform)||void 0===G?void 0:G.recording)||void 0===W?void 0:W.compliance)||void 0===z?void 0:z.state,$=null===(Q=null===(J=null===(K=null==F?void 0:F.endpointMetadata)||void 0===K?void 0:K.processingModes)||void 0===J?void 0:J.recording)||void 0===Q?void 0:Q.state;if(Y||$)return{state:null!=Y?Y:$}})).filter((F=>null!=F));if(G&&0!=G.length)return G.length>1&&this._logger.log(`Unexpected: multiple recording endpoints: ${null==G?void 0:G.map((F=>{var B;return null!==(B=null==F?void 0:F.state)&&void 0!==B?B:"undefined"})).join(", ")}`),G[0]}}get isRecordingActive(){return this._isRecordingActive}get recordings(){return Array.from(this._recordingBots.values()).map((F=>null==F?void 0:F.recordingInfo)).filter((F=>!!F))}initialize(F,B,G){this._logger=G.createChild((()=>`RecordingFeature::Call(id='${F.callId}', state='${F.state}')`)),F.on("participantAdded",(F=>__awaiter$8(this,void 0,void 0,(function*(){isCallingApplication(F.id)&&this._handleRecordingBotAdded(F)})))),F.on("participantRemoved",(F=>__awaiter$8(this,void 0,void 0,(function*(){isCallingApplication(F.id)&&this._handleRecordingBotRemoved(F)}))))}dispose(){let F=this._updateIsCallRecorded(!1),B=Array.from(this._recordingBots.values());B.forEach((F=>{var B;return null===(B=null==F?void 0:F.recordingInfo)||void 0===B?void 0:B.dispose()})),this._sendEvents(void 0,void 0,B,F)}}class RecordingInfoImpl{constructor(F,B){this.state=this.getRecordingState(F),this._eventEmitter=B}on(F,B){this._eventEmitter.on(F,B)}off(F,B){this._eventEmitter.off(F,B)}update(F){if(null==F)return!1;let B=this.getRecordingState(F.state);return B!=this.state&&(this.state=B,!0)}dispose(){this.state=F.RecordingState.Ended}sendRecordingStateChanged(){this._eventEmitter.emit("recordingStateChanged")}getRecordingState(B){let G=F.RecordingState.None;switch(null==B?void 0:B.toLocaleLowerCase()){case"active":G=F.RecordingState.Started;break;case"inactive":G=F.RecordingState.Paused;break;default:G=F.RecordingState.None}return G}}var __awaiter$9=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class TranscriptionCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new TranscriptionCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage("name",wu.getter),"Transcription"}initialize(F,B){this._logger=B,this._telemetryLogManager=F.telemetryLogManager,this._call=F.call,this._impl.initialize(F.tsCall,F.telemetryLogManager,B),this._sendFeatureUsage("initialize",wu.initialize)}get isTranscriptionActive(){return this._sendFeatureUsage("isTranscriptionActive",wu.getter),this._impl.isTranscriptionActive}on(F,B){this._sendFeatureUsage("isTranscriptionActiveChanged",wu.subscribe),this.eventEmitter.on(F,B)}off(F,B){this._sendFeatureUsage("isTranscriptionActiveChanged",wu.unsubscribe),this.eventEmitter.off(F,B)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"Transcription",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class TranscriptionCallImplOverTsCall{constructor(F){this._eventEmitter=F,this._transcriptionBotChangedSubs=new WeakMap,this._isTranscriptionActive=!1,this._updateIsCallTranscribed=F=>{this._isTranscriptionActive!==F&&(this._isTranscriptionActive=F,this._logger.info(`Updating isTranscriptionActive to ${F}`),this._eventEmitter.emit("isTranscriptionActiveChanged"))},this._isCallingApplication=F=>isCallingApplication(F.id),this._handleTranscriptionBotRemoved=F=>{var B;this._isTranscriptionBot(F)&&(this._transcriptionBot=void 0),null===(B=this._transcriptionBotChangedSubs.get(F))||void 0===B||B.dispose(),this._transcriptionBotChangedSubs.delete(F),this._updateIsCallTranscribed(this._isTranscriptionEnabled())},this._handleTranscriptionBotAdded=F=>{const handleTranscriptionBotChanged=()=>{this._isTranscriptionBot(F)&&!this._transcriptionBot&&(this._logger.info("Adding transcription bot"),this._transcriptionBot=F),this._updateIsCallTranscribed(this._isTranscriptionEnabled())};handleTranscriptionBotChanged(),this._transcriptionBotChangedSubs.set(F,F.changed(handleTranscriptionBotChanged))},this._isTranscriptionEnabled=()=>{var F,B,G,W;let z=!1;if(!this._transcriptionBot)return z;try{const K=null===(F=this._transcriptionBot.endpoints)||void 0===F?void 0:F.endpointDetails[0];z="Active"===(null===(W=null===(G=null===(B=null==K?void 0:K.endpointMetadata)||void 0===B?void 0:B.processingModes)||void 0===G?void 0:G.realTimeTranscript)||void 0===W?void 0:W.state)}catch(F){this._logger.warn("Unable to read transcription state: ",F)}return z},this._isTranscriptionBot=F=>"28:b1902c3e-b9f7-4650-9b23-5772bd429747"===F.id}get isTranscriptionActive(){return this._isTranscriptionActive}initialize(F,B,G){this._logger=G.createChild((()=>`TranscriptionFeature::Call(id='${F.callId}', state='${F.state}')`)),F.on("participantAdded",(F=>__awaiter$9(this,void 0,void 0,(function*(){this._isCallingApplication(F)&&this._handleTranscriptionBotAdded(F)})))),F.on("participantRemoved",(F=>__awaiter$9(this,void 0,void 0,(function*(){this._isCallingApplication(F)&&this._handleTranscriptionBotRemoved(F)}))))}dispose(){this._updateIsCallTranscribed(!1)}}const rp={0:"Undefined",1:"Success",2:"NoNgcEndpoint",3:"NetworkError",4:"MediaDroppedError",5:"BadRequest",6:"CallEstablishmentTimeout",7:"CallSetupError",8:"NoPermission",9:"Missed",10:"Declined",11:"Busy",12:"Cancelled",13:"Dropped",14:"PstnInsufficientFunds",15:"PstnSkypeoutAccountBlocked",16:"PstnCouldNotConnectToSkypeProxy",17:"PstnBlockedByUs",18:"PstnBlockedRegulatoryIndia",19:"PstnInvalidNumber",20:"PstnNumberForbidden",21:"PstnCallTerminated",22:"PstnNumberUnavailable",23:"PstnEmergencyCallDenied",24:"CallNotFound",25:"LocalError",26:"NotAcceptableHere",27:"CallForwarded",28:"CallForwardedToVoicemail",29:"SkypeTokenError",30:"CallAccepted",31:"LocalHttpStackError",32:"UnknownError",33:"PstnNoSubscriptionCover",34:"SessionNotFound",35:"SessionTimedOut",36:"PstnCreditExpired",37:"PstnCreditExpiredButEnough",38:"RetargetNotSupported",39:"EnterprisePstnInternalError",40:"EnterprisePstnUnavailable",41:"EnterprisePstnForbidden",42:"EnterprisePstnInvalidNumber",43:"EnterprisePstnMiscError",44:"Kicked",45:"NetworkRequestTimeoutError",46:"CallDoesNotExist",47:"MediaSetupFailure",48:"ServiceUnavailable",49:"SignalingError",50:"ConversationEstablishmentFailed",51:"TemporarilyUnavailable",52:"CannotConnectToNetworkError",53:"MediaRelayWhiteListingIssue",54:"NoSignalingFromPeer",55:"DeniedInLobby",56:"TimedOutInLobby",57:"CallFailedConflict",58:"DevicePermissionDenied",59:"ConfParticipantCountLimitReached",60:"ActionNotAllowed",61:"Abandoned",62:"ForbiddenDueToPolicy",63:"InsufficientCapabilitiesForCallee",64:"UserBlocked",65:"AccessDenied",66:"AnonymousJoinDisabledByPolicy",67:"NoLobbyForBroadcastJoin",68:"NotAllowedDueToInformationBarrier",69:"BroadcastLimitReached",70:"TeamParkPolicyDisabled",71:"B2bJoinDisabledByPolicy",72:"LocationBasedRoutingError",73:"ConfLobbyParticipantCountLimitReached",74:"DowngradeToStreamingClient",75:"CallRedirected",76:"CallIsEndToEndEncrypted"},convertTerminatedReasonToString=F=>{const B="UnknownError";return"number"==typeof F&&rp[F]||B},op={0:"None",1:"AddingFailed",2:"NoResponse",3:"Declined",4:"NotReachable",5:"Blocked",6:"NotFriendOrAuthorized",7:"CallLimitReached",8:"CallNotFound",9:"NetworkError",10:"MediaDroppedError",11:"OtherError",12:"PstnInsufficientFunds",13:"PstnSkypeoutAccountBlocked",14:"PstnCouldNotConnectToSkypeProxy",15:"PstnBlockedByUs",16:"PstnBlockedRegulatoryIndia",17:"PstnInvalidNumber",18:"PstnNumberForbidden",19:"Busy",20:"PstnCallTerminated",21:"PstnNumberUnavailable",22:"PstnEmergencyCallDenied",23:"Cancelled",24:"Dropped",25:"PstnNoSubscriptionCover",26:"PstnCreditExpired",27:"PstnCreditExpiredButEnough",28:"EnterprisePstnInternalError",29:"EnterprisePstnUnavailable",30:"EnterprisePstnForbidden",31:"EnterprisePstnInvalidNumber",32:"EnterprisePstnMiscError",33:"Kicked",34:"NetworkRequestTimeoutError",35:"CallDoesNotExist",36:"MediaSetupFailure",37:"ServiceUnavailable",38:"SignalingError",39:"ConversationEstablishmentFailed",40:"TemporarilyUnavailable",41:"CannotConnectToNetworkError",42:"NoSignalingFromPeer",43:"ParticipantDoesNotExist",44:"DeniedInLobby",45:"TimedOutInLobby",46:"ConfParticipantCountLimitReached",47:"Abandoned",48:"ActionNotAllowed",49:"ForbiddenDueToPolicy",50:"InsufficientCapabilitiesForCallee",51:"AccessDenied",52:"NoPermission",53:"AnonymousJoinDisabledByPolicy",54:"NoLobbyForBroadcastJoin",55:"NotAllowedDueToInformationBarrier",56:"BroadcastLimitReached",57:"B2bJoinDisabledByPolicy",58:"LocationBasedRoutingError",59:"ConfLobbyParticipantCountLimitReached",60:"LobbyUserLeft"},convertParticipantStateReasonToString=F=>{const B="UnknownError";return"number"==typeof F&&op[F]||B},ap={0:"None",1:"Notified",2:"Connecting",3:"Connected",4:"LocalHold",5:"RemoteHold",10:"InLobby",9:"EarlyMedia",6:"Disconnecting",7:"Disconnected"};function toDtmfTone(F){switch(F){case"Num0":return 0;case"Num1":return 1;case"Num2":return 2;case"Num3":return 3;case"Num4":return 4;case"Num5":return 5;case"Num6":return 6;case"Num7":return 7;case"Num8":return 8;case"Num9":return 9;case"Star":return 10;case"Pound":return 11;case"A":return 12;case"B":return 13;case"C":return 14;case"D":return 15;case"Flash":return 16;default:throw new CallingCommunicationError({message:"Invalid value passed to DtfmTone",code:de})}}class TransferImpl{constructor(F,B,G=!0){return this._eventEmitter=new Jt.EventEmitter,this._lastTsTransferState=0,this._getTransferEndReason=(F,B=0)=>{var G;let W=B,z=0,K=F||"Unknown";this._tsCall&&(W=this._tsCall.transferDiagnosticsInfo&&this._tsCall.transferDiagnosticsInfo.callControllerCode||B,z=this._tsCall.transferDiagnosticsInfo&&(null===(G=this._tsCall.transferDiagnosticsInfo)||void 0===G?void 0:G.callControllerSubCode)||0,K=convertTerminatedReasonToString(this._tsCall.terminatedReason));const J={code:W,subCode:z};return this._logger[0===W?"info":"error"](`Transfer end reason=${K}, code=${W}, subCode=${z}`),J},this._state="None",this._logger=B.createChild((()=>"Transfer")),this._logger.log("created"),this._tsCall=F,G?4!==F.state?(this._logger.error("Transfer end reason= call must be on hold before transfer"),this._error={code:le},void this.setTransferState(4)):(this._lastTsTransferState=this._tsCall.transferState,this.setTransferState(this._tsCall.transferState),void this._tsCall.changed((()=>{this._tsCall.transferState!==this._lastTsTransferState&&(this._logger.log(`tsCall transfer state changed=${this._tsCall.transferState}`),this._lastTsTransferState=this._tsCall.transferState,this.setTransferState(this._tsCall.transferState))}))):(this._logger.error("Transfer end reason= call was not found with this callId"),this._error={code:le},void this.setTransferState(4))}get state(){return this._state}get error(){return this._error}on(F,B){this._eventEmitter.on(F,B)}off(F,B){this._eventEmitter.off(F,B)}setTransferState(F){let B,G;const W={0:"None",1:"Transferring",2:"Transferring",3:"Transferred",4:"Failed"};W[F]?(B=W[F],"Failed"===B&&(G=this._getTransferEndReason(),this._error=G),this._logger.log(`Mapped ts transfer state:[${F}] to [${B}]`),this._setTransferState(B)):this._logger.warn(`unable to map tsCall state=[${F}] to transfer state`)}_setTransferState(F){F!==this._state&&(this._logger.log(`transfer state changed [${this._state}]=>[${this.state}]`),this._state=F,this._eventEmitter.emit("stateChanged"))}}var __decorate$2=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$2=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)};class TransferCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new TransferCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage("name",wu.getter),"Transfer"}transfer(F,B){return this._impl.transfer(F,B)}initialize(F,B){this._logger=B,this._telemetryLogManager=F.telemetryLogManager,this._call=F.call,this._impl.initialize(F.tsCall,F.callAgent,F.telemetryLogManager,B),this._sendFeatureUsage("initialize",wu.initialize)}on(F,B){this._sendFeatureUsage("transferRequested",wu.subscribe),this.eventEmitter.on(F,B)}off(F,B){this._sendFeatureUsage("transferRequested",wu.unsubscribe),this.eventEmitter.off(F,B)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:"Transfer",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class TransferCallImplOverTsCall{constructor(F){this._eventEmitter=F}initialize(F,B,G,W){this._logger=W.createChild((()=>`TransferFeature::Call(id='${F.callId}', state='${F.state}')`)),this._telemetryLogManager=G,this._tsCall=F,this._callAgent=B,F.on("transferRequested",(F=>{try{const G=constructIdentifierKindFromMri(F.transferContext.targetMri);if("communicationUser"!==G.kind&&"phoneNumber"!==G.kind&&"microsoftTeamsUser"!==G.kind&&"unknown"!==G.kind)throw new CallingCommunicationError({message:`Invalid target participant type detected:${G}`,code:de});{let W=!1;const z={targetParticipant:G,accept:G=>{let z;try{return z=B.createTransferTargetCall(F.transferContext),W?(this._logger.info("Transfer accept was called when transfer action is already in progress."),z):(W=!0,z.startCallInternal(G).then((()=>{F.onCompleted(1),this._logger.info("Transfer request has been accepted successfully from transferee.")})).catch((B=>{W=!1,F.onCompleted(7),this._logger.error("Transfer to target failed at call start")})),z)}catch(B){throw W=!1,F.onCompleted(7),this._logger.error("Transfer to target failed at call create"),new CallingCommunicationError({message:"Transfer to target failed",code:ue},B)}},reject:()=>{W?this._logger.info("Transfer reject was called when transfer action is already in progress."):(W=!0,F.onCompleted(10),this._logger.info("Transfer request has been decliend by transferee."))}};this._eventEmitter.emit("transferRequested",z)}}catch(B){F.onCompleted(7),this._logger.error(B)}}))}transfer(F,B){if(this._sendFeatureUsage("transfer",wu.attempt),!this.isTransferable(this._tsCall))throw this._sendFeatureUsage("transfer",wu.failure),new CallingCommunicationError({message:"Transfer can only be initiated from 1 on 1 call.",code:ne});try{if(F.targetParticipant){const G=this.transferToParticipant(F.targetParticipant,B);return this._sendFeatureUsage("transfer",wu.success),G}if(F.targetCallId){const G=this.transferToCall(F.targetCallId,B);return this._sendFeatureUsage("transfer",wu.success),G}}catch(F){if(this._sendFeatureUsage("transfer",wu.failure),F instanceof CallingCommunicationError)throw F}throw this._sendFeatureUsage("transfer",wu.failure),new CallingCommunicationError({message:"Transfer target is not recognized.",code:de})}isTransferable(F){return 1===F.callType||F.participants.filter((F=>!isCallingApplication(F.id))).length<=2}transferToParticipant(F,B){let G=getMriFromIdentifier(F);4===this._tsCall.state&&this._tsCall.callSafeTransfer(G,void 0,B);return new TransferImpl(this._tsCall,this._logger)}transferToCall(F,B){const G=this._callAgent.getCallByCallId(F);if(G&&!this.isTransferable(G))throw new CallingCommunicationError({message:"Transfer target call can only be 1 on 1 call.",code:ne});G&&4===this._tsCall.state&&this._tsCall.callConsultativeTransfer(G,void 0,void 0,B);return new TransferImpl(this._tsCall,this._logger,!!G)}_sendFeatureUsage(F,B){sendCallFeatureUsageTelemetry({callId:this._tsCall.callId,localParticipantId:this._tsCall.participantId,featureName:"Transfer",featureType:"Call",initializationType:"OnFeatureAccess",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){}}__decorate$2([syncOperation($t.Transfer),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[Object,Object]),__metadata$2("design:returntype",Object)],TransferCallImplOverTsCall.prototype,"transfer",null);class VideoDeviceInfoImpl{constructor(F,B,G,W){this._name=F,this._id=B,this._deviceType=G,this._deviceManager=W}get name(){return this._name}setName(F){this._name=F}get id(){return this._id}setId(F){this._id=F}get deviceType(){return this._deviceType}setDeviceType(F){this._deviceType=F}get deviceManager(){return this._deviceManager}}function loggerProperty(F,B){Reflect.defineMetadata(he,B,F)}function getDateInIsoFormat(){return(new Date).toISOString()}function isNonEmptyArray(F){return Array.isArray(F)&&0!==F.length}function isNullOrUndefined$2(F){return null==F||void 0===F}function Deque(F){if(this._capacity=getCapacity(F),this._length=0,this._front=0,sp(F)){for(var B=F.length,G=0;G<B;++G)this[G]=F[G];this._length=B}}Deque.prototype.toArray=function Deque$toArray(){for(var F=this._length,B=new Array(F),G=this._front,W=this._capacity,z=0;z<F;++z)B[z]=this[G+z&W-1];return B},Deque.prototype.push=function Deque$push(F){var B=arguments.length,G=this._length;if(B>1){var W=this._capacity;if(G+B>W){for(var z=0;z<B;++z){this._checkCapacity(G+1),this[K=this._front+G&this._capacity-1]=arguments[z],G++,this._length=G}return G}for(var K=this._front,z=0;z<B;++z)this[K+G&W-1]=arguments[z],K++;return this._length=G+B,G+B}return 0===B?G:(this._checkCapacity(G+1),this[z=this._front+G&this._capacity-1]=F,this._length=G+1,G+1)},Deque.prototype.pop=function Deque$pop(){var F=this._length;if(0!==F){var B=this._front+F-1&this._capacity-1,G=this[B];return this[B]=void 0,this._length=F-1,G}},Deque.prototype.shift=function Deque$shift(){var F=this._length;if(0!==F){var B=this._front,G=this[B];return this[B]=void 0,this._front=B+1&this._capacity-1,this._length=F-1,G}},Deque.prototype.unshift=function Deque$unshift(F){var B=this._length,G=arguments.length;if(G>1){if(B+G>(z=this._capacity)){for(var W=G-1;W>=0;W--){this._checkCapacity(B+1);var z=this._capacity;this[J=(this._front-1&z-1^z)-z]=arguments[W],B++,this._length=B,this._front=J}return B}var K=this._front;for(W=G-1;W>=0;W--){var J;this[J=(K-1&z-1^z)-z]=arguments[W],K=J}return this._front=K,this._length=B+G,B+G}if(0===G)return B;this._checkCapacity(B+1);z=this._capacity;return this[W=(this._front-1&z-1^z)-z]=F,this._length=B+1,this._front=W,B+1},Deque.prototype.peekBack=function Deque$peekBack(){var F=this._length;if(0!==F)return this[this._front+F-1&this._capacity-1]},Deque.prototype.peekFront=function Deque$peekFront(){if(0!==this._length)return this[this._front]},Deque.prototype.get=function Deque$get(F){var B=F;if(B===(0|B)){var G=this._length;if(B<0&&(B+=G),!(B<0||B>=G))return this[this._front+B&this._capacity-1]}},Deque.prototype.isEmpty=function Deque$isEmpty(){return 0===this._length},Deque.prototype.clear=function Deque$clear(){for(var F=this._length,B=this._front,G=this._capacity,W=0;W<F;++W)this[B+W&G-1]=void 0;this._length=0,this._front=0},Deque.prototype.toString=function Deque$toString(){return this.toArray().toString()},Deque.prototype.valueOf=Deque.prototype.toString,Deque.prototype.removeFront=Deque.prototype.shift,Deque.prototype.removeBack=Deque.prototype.pop,Deque.prototype.insertFront=Deque.prototype.unshift,Deque.prototype.insertBack=Deque.prototype.push,Deque.prototype.enqueue=Deque.prototype.push,Deque.prototype.dequeue=Deque.prototype.shift,Deque.prototype.toJSON=Deque.prototype.toArray,Object.defineProperty(Deque.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),Deque.prototype._checkCapacity=function Deque$_checkCapacity(F){this._capacity<F&&this._resizeTo(getCapacity(1.5*this._capacity+16))},Deque.prototype._resizeTo=function Deque$_resizeTo(F){var B=this._capacity;this._capacity=F;var G=this._front,W=this._length;G+W>B&&arrayMove(this,0,this,B,G+W&B-1)};var sp=Array.isArray;function arrayMove(F,B,G,W,z){for(var K=0;K<z;++K)G[K+W]=F[K+B],F[K+B]=void 0}function pow2AtLeast(F){return F>>>=0,F-=1,F|=F>>1,F|=F>>2,F|=F>>4,F|=F>>8,(F|=F>>16)+1}function getCapacity(F){if("number"!=typeof F){if(!sp(F))return 16;F=F.length}return pow2AtLeast(Math.min(Math.max(16,F),1073741824))}var cp,lp,dp=Deque,up=createCommonjsModule((function(F,B){(function(){var G,W="4.17.21",K=200,J="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",Q="Expected a function",Y="Invalid `variable` option passed into `_.template`",$="__lodash_hash_undefined__",X=500,Z="__lodash_placeholder__",ee=1,te=2,ne=4,ie=1,re=2,oe=1,ae=2,se=4,ce=8,le=16,de=32,ue=64,pe=128,he=256,ge=512,fe=30,me="...",ve=800,ye=16,Se=1,_e=2,Ce=3,Te=1/0,Ee=9007199254740991,be=17976931348623157e292,Ie=NaN,Ae=4294967295,Re=Ae-1,Pe=Ae>>>1,Oe=[["ary",pe],["bind",oe],["bindKey",ae],["curry",ce],["curryRight",le],["flip",ge],["partial",de],["partialRight",ue],["rearg",he]],Me="[object Arguments]",we="[object Array]",De="[object AsyncFunction]",Ne="[object Boolean]",Le="[object Date]",ke="[object DOMException]",Fe="[object Error]",xe="[object Function]",Ue="[object GeneratorFunction]",je="[object Map]",Be="[object Number]",He="[object Null]",Ve="[object Object]",Ge="[object Promise]",We="[object Proxy]",qe="[object RegExp]",ze="[object Set]",Ke="[object String]",Je="[object Symbol]",Qe="[object Undefined]",Ye="[object WeakMap]",$e="[object WeakSet]",Xe="[object ArrayBuffer]",Ze="[object DataView]",et="[object Float32Array]",tt="[object Float64Array]",nt="[object Int8Array]",it="[object Int16Array]",rt="[object Int32Array]",ot="[object Uint8Array]",at="[object Uint8ClampedArray]",st="[object Uint16Array]",ct="[object Uint32Array]",lt=/\b__p \+= '';/g,dt=/\b(__p \+=) '' \+/g,ut=/(__e\(.*?\)|\b__t\)) \+\n'';/g,pt=/&(?:amp|lt|gt|quot|#39);/g,ht=/[&<>"']/g,gt=RegExp(pt.source),ft=RegExp(ht.source),mt=/<%-([\s\S]+?)%>/g,vt=/<%([\s\S]+?)%>/g,yt=/<%=([\s\S]+?)%>/g,St=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,_t=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Tt=/[\\^$.*+?()[\]{}|]/g,Et=RegExp(Tt.source),bt=/^\s+/,It=/\s/,At=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Rt=/\{\n\/\* \[wrapped with (.+)\] \*/,Pt=/,? & /,Ot=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Mt=/[()=,{}\[\]\/\s]/,wt=/\\(\\)?/g,Dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Nt=/\w*$/,Lt=/^[-+]0x[0-9a-f]+$/i,kt=/^0b[01]+$/i,Ft=/^\[object .+?Constructor\]$/,xt=/^0o[0-7]+$/i,Ut=/^(?:0|[1-9]\d*)$/,jt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Bt=/($^)/,Ht=/['\n\r\u2028\u2029\\]/g,Vt="\\ud800-\\udfff",Gt="\\u0300-\\u036f"+"\\ufe20-\\ufe2f"+"\\u20d0-\\u20ff",Wt="\\u2700-\\u27bf",qt="a-z\\xdf-\\xf6\\xf8-\\xff",zt="A-Z\\xc0-\\xd6\\xd8-\\xde",Kt="\\ufe0e\\ufe0f",Jt="\\xac\\xb1\\xd7\\xf7"+"\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf"+"\\u2000-\\u206f"+" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Qt="['’]",Yt="["+Vt+"]",$t="["+Jt+"]",Xt="["+Gt+"]",Zt="\\d+",en="["+Wt+"]",tn="["+qt+"]",nn="[^"+Vt+Jt+Zt+Wt+qt+zt+"]",rn="\\ud83c[\\udffb-\\udfff]",on="[^"+Vt+"]",an="(?:\\ud83c[\\udde6-\\uddff]){2}",sn="[\\ud800-\\udbff][\\udc00-\\udfff]",cn="["+zt+"]",ln="\\u200d",dn="(?:"+tn+"|"+nn+")",un="(?:"+cn+"|"+nn+")",pn="(?:"+Qt+"(?:d|ll|m|re|s|t|ve))?",hn="(?:"+Qt+"(?:D|LL|M|RE|S|T|VE))?",gn="(?:"+Xt+"|"+rn+")"+"?",fn="["+Kt+"]?",mn="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",yn=fn+gn+("(?:"+ln+"(?:"+[on,an,sn].join("|")+")"+fn+gn+")*"),Sn="(?:"+[en,an,sn].join("|")+")"+yn,_n="(?:"+[on+Xt+"?",Xt,an,sn,Yt].join("|")+")",Cn=RegExp(Qt,"g"),Tn=RegExp(Xt,"g"),En=RegExp(rn+"(?="+rn+")|"+_n+yn,"g"),bn=RegExp([cn+"?"+tn+"+"+pn+"(?="+[$t,cn,"$"].join("|")+")",un+"+"+hn+"(?="+[$t,cn+dn,"$"].join("|")+")",cn+"?"+dn+"+"+pn,cn+"+"+hn,vn,mn,Zt,Sn].join("|"),"g"),In=RegExp("["+ln+Vt+Gt+Kt+"]"),An=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Rn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Pn=-1,On={};On[et]=On[tt]=On[nt]=On[it]=On[rt]=On[ot]=On[at]=On[st]=On[ct]=!0,On[Me]=On[we]=On[Xe]=On[Ne]=On[Ze]=On[Le]=On[Fe]=On[xe]=On[je]=On[Be]=On[Ve]=On[qe]=On[ze]=On[Ke]=On[Ye]=!1;var Mn={};Mn[Me]=Mn[we]=Mn[Xe]=Mn[Ze]=Mn[Ne]=Mn[Le]=Mn[et]=Mn[tt]=Mn[nt]=Mn[it]=Mn[rt]=Mn[je]=Mn[Be]=Mn[Ve]=Mn[qe]=Mn[ze]=Mn[Ke]=Mn[Je]=Mn[ot]=Mn[at]=Mn[st]=Mn[ct]=!0,Mn[Fe]=Mn[xe]=Mn[Ye]=!1;var wn={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},Dn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Nn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ln={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},kn=parseFloat,Fn=parseInt,xn="object"==typeof z&&z&&z.Object===Object&&z,Un="object"==typeof self&&self&&self.Object===Object&&self,jn=xn||Un||Function("return this")(),Bn=B&&!B.nodeType&&B,Hn=Bn&&F&&!F.nodeType&&F,Vn=Hn&&Hn.exports===Bn,Gn=Vn&&xn.process,Wn=function(){try{var F=Hn&&Hn.require&&Hn.require("util").types;return F||Gn&&Gn.binding&&Gn.binding("util")}catch(F){}}(),qn=Wn&&Wn.isArrayBuffer,zn=Wn&&Wn.isDate,Kn=Wn&&Wn.isMap,Jn=Wn&&Wn.isRegExp,Qn=Wn&&Wn.isSet,Yn=Wn&&Wn.isTypedArray;function apply(F,B,G){switch(G.length){case 0:return F.call(B);case 1:return F.call(B,G[0]);case 2:return F.call(B,G[0],G[1]);case 3:return F.call(B,G[0],G[1],G[2])}return F.apply(B,G)}function arrayAggregator(F,B,G,W){for(var z=-1,K=null==F?0:F.length;++z<K;){var J=F[z];B(W,J,G(J),F)}return W}function arrayEach(F,B){for(var G=-1,W=null==F?0:F.length;++G<W&&!1!==B(F[G],G,F););return F}function arrayEachRight(F,B){for(var G=null==F?0:F.length;G--&&!1!==B(F[G],G,F););return F}function arrayEvery(F,B){for(var G=-1,W=null==F?0:F.length;++G<W;)if(!B(F[G],G,F))return!1;return!0}function arrayFilter(F,B){for(var G=-1,W=null==F?0:F.length,z=0,K=[];++G<W;){var J=F[G];B(J,G,F)&&(K[z++]=J)}return K}function arrayIncludes(F,B){return!!(null==F?0:F.length)&&baseIndexOf(F,B,0)>-1}function arrayIncludesWith(F,B,G){for(var W=-1,z=null==F?0:F.length;++W<z;)if(G(B,F[W]))return!0;return!1}function arrayMap(F,B){for(var G=-1,W=null==F?0:F.length,z=Array(W);++G<W;)z[G]=B(F[G],G,F);return z}function arrayPush(F,B){for(var G=-1,W=B.length,z=F.length;++G<W;)F[z+G]=B[G];return F}function arrayReduce(F,B,G,W){var z=-1,K=null==F?0:F.length;for(W&&K&&(G=F[++z]);++z<K;)G=B(G,F[z],z,F);return G}function arrayReduceRight(F,B,G,W){var z=null==F?0:F.length;for(W&&z&&(G=F[--z]);z--;)G=B(G,F[z],z,F);return G}function arraySome(F,B){for(var G=-1,W=null==F?0:F.length;++G<W;)if(B(F[G],G,F))return!0;return!1}var $n=baseProperty("length");function asciiToArray(F){return F.split("")}function asciiWords(F){return F.match(Ot)||[]}function baseFindKey(F,B,G){var W;return G(F,(function(F,G,z){if(B(F,G,z))return W=G,!1})),W}function baseFindIndex(F,B,G,W){for(var z=F.length,K=G+(W?1:-1);W?K--:++K<z;)if(B(F[K],K,F))return K;return-1}function baseIndexOf(F,B,G){return B==B?strictIndexOf(F,B,G):baseFindIndex(F,baseIsNaN,G)}function baseIndexOfWith(F,B,G,W){for(var z=G-1,K=F.length;++z<K;)if(W(F[z],B))return z;return-1}function baseIsNaN(F){return F!=F}function baseMean(F,B){var G=null==F?0:F.length;return G?baseSum(F,B)/G:Ie}function baseProperty(F){return function(B){return null==B?G:B[F]}}function basePropertyOf(F){return function(B){return null==F?G:F[B]}}function baseReduce(F,B,G,W,z){return z(F,(function(F,z,K){G=W?(W=!1,F):B(G,F,z,K)})),G}function baseSortBy(F,B){var G=F.length;for(F.sort(B);G--;)F[G]=F[G].value;return F}function baseSum(F,B){for(var W,z=-1,K=F.length;++z<K;){var J=B(F[z]);J!==G&&(W=W===G?J:W+J)}return W}function baseTimes(F,B){for(var G=-1,W=Array(F);++G<F;)W[G]=B(G);return W}function baseToPairs(F,B){return arrayMap(B,(function(B){return[B,F[B]]}))}function baseTrim(F){return F?F.slice(0,trimmedEndIndex(F)+1).replace(bt,""):F}function baseUnary(F){return function(B){return F(B)}}function baseValues(F,B){return arrayMap(B,(function(B){return F[B]}))}function cacheHas(F,B){return F.has(B)}function charsStartIndex(F,B){for(var G=-1,W=F.length;++G<W&&baseIndexOf(B,F[G],0)>-1;);return G}function charsEndIndex(F,B){for(var G=F.length;G--&&baseIndexOf(B,F[G],0)>-1;);return G}function countHolders(F,B){for(var G=F.length,W=0;G--;)F[G]===B&&++W;return W}var Xn=basePropertyOf(wn),Zn=basePropertyOf(Dn);function escapeStringChar(F){return"\\"+Ln[F]}function getValue(F,B){return null==F?G:F[B]}function hasUnicode(F){return In.test(F)}function hasUnicodeWord(F){return An.test(F)}function iteratorToArray(F){for(var B,G=[];!(B=F.next()).done;)G.push(B.value);return G}function mapToArray(F){var B=-1,G=Array(F.size);return F.forEach((function(F,W){G[++B]=[W,F]})),G}function overArg(F,B){return function(G){return F(B(G))}}function replaceHolders(F,B){for(var G=-1,W=F.length,z=0,K=[];++G<W;){var J=F[G];J!==B&&J!==Z||(F[G]=Z,K[z++]=G)}return K}function setToArray(F){var B=-1,G=Array(F.size);return F.forEach((function(F){G[++B]=F})),G}function setToPairs(F){var B=-1,G=Array(F.size);return F.forEach((function(F){G[++B]=[F,F]})),G}function strictIndexOf(F,B,G){for(var W=G-1,z=F.length;++W<z;)if(F[W]===B)return W;return-1}function strictLastIndexOf(F,B,G){for(var W=G+1;W--;)if(F[W]===B)return W;return W}function stringSize(F){return hasUnicode(F)?unicodeSize(F):$n(F)}function stringToArray(F){return hasUnicode(F)?unicodeToArray(F):asciiToArray(F)}function trimmedEndIndex(F){for(var B=F.length;B--&&It.test(F.charAt(B)););return B}var ei=basePropertyOf(Nn);function unicodeSize(F){for(var B=En.lastIndex=0;En.test(F);)++B;return B}function unicodeToArray(F){return F.match(En)||[]}function unicodeWords(F){return F.match(bn)||[]}var ti=function runInContext(F){var B,z=(F=null==F?jn:ni.defaults(jn.Object(),F,ni.pick(jn,Rn))).Array,It=F.Date,Ot=F.Error,Vt=F.Function,Gt=F.Math,Wt=F.Object,qt=F.RegExp,zt=F.String,Kt=F.TypeError,Jt=z.prototype,Qt=Vt.prototype,Yt=Wt.prototype,$t=F["__core-js_shared__"],Xt=Qt.toString,Zt=Yt.hasOwnProperty,en=0,tn=(B=/[^.]+$/.exec($t&&$t.keys&&$t.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"",nn=Yt.toString,rn=Xt.call(Wt),on=jn._,an=qt("^"+Xt.call(Zt).replace(Tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),sn=Vn?F.Buffer:G,cn=F.Symbol,ln=F.Uint8Array,dn=sn?sn.allocUnsafe:G,un=overArg(Wt.getPrototypeOf,Wt),pn=Wt.create,hn=Yt.propertyIsEnumerable,gn=Jt.splice,fn=cn?cn.isConcatSpreadable:G,mn=cn?cn.iterator:G,vn=cn?cn.toStringTag:G,yn=function(){try{var F=getNative(Wt,"defineProperty");return F({},"",{}),F}catch(F){}}(),Sn=F.clearTimeout!==jn.clearTimeout&&F.clearTimeout,_n=It&&It.now!==jn.Date.now&&It.now,En=F.setTimeout!==jn.setTimeout&&F.setTimeout,bn=Gt.ceil,In=Gt.floor,An=Wt.getOwnPropertySymbols,wn=sn?sn.isBuffer:G,Dn=F.isFinite,Nn=Jt.join,Ln=overArg(Wt.keys,Wt),xn=Gt.max,Un=Gt.min,Bn=It.now,Hn=F.parseInt,Gn=Gt.random,Wn=Jt.reverse,$n=getNative(F,"DataView"),ti=getNative(F,"Map"),ii=getNative(F,"Promise"),ri=getNative(F,"Set"),oi=getNative(F,"WeakMap"),ai=getNative(Wt,"create"),si=oi&&new oi,ci={},li=toSource($n),di=toSource(ti),ui=toSource(ii),pi=toSource(ri),hi=toSource(oi),gi=cn?cn.prototype:G,fi=gi?gi.valueOf:G,mi=gi?gi.toString:G;function lodash(F){if(isObjectLike(F)&&!_r(F)&&!(F instanceof LazyWrapper)){if(F instanceof LodashWrapper)return F;if(Zt.call(F,"__wrapped__"))return wrapperClone(F)}return new LodashWrapper(F)}var vi=function(){function object(){}return function(F){if(!isObject(F))return{};if(pn)return pn(F);object.prototype=F;var B=new object;return object.prototype=G,B}}();function baseLodash(){}function LodashWrapper(F,B){this.__wrapped__=F,this.__actions__=[],this.__chain__=!!B,this.__index__=0,this.__values__=G}function LazyWrapper(F){this.__wrapped__=F,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ae,this.__views__=[]}function lazyClone(){var F=new LazyWrapper(this.__wrapped__);return F.__actions__=copyArray(this.__actions__),F.__dir__=this.__dir__,F.__filtered__=this.__filtered__,F.__iteratees__=copyArray(this.__iteratees__),F.__takeCount__=this.__takeCount__,F.__views__=copyArray(this.__views__),F}function lazyReverse(){if(this.__filtered__){var F=new LazyWrapper(this);F.__dir__=-1,F.__filtered__=!0}else(F=this.clone()).__dir__*=-1;return F}function lazyValue(){var F=this.__wrapped__.value(),B=this.__dir__,G=_r(F),W=B<0,z=G?F.length:0,K=getView(0,z,this.__views__),J=K.start,Q=K.end,Y=Q-J,$=W?Q:J-1,X=this.__iteratees__,Z=X.length,ee=0,te=Un(Y,this.__takeCount__);if(!G||!W&&z==Y&&te==Y)return baseWrapperValue(F,this.__actions__);var ne=[];e:for(;Y--&&ee<te;){for(var ie=-1,re=F[$+=B];++ie<Z;){var oe=X[ie],ae=oe.iteratee,se=oe.type,ce=ae(re);if(se==_e)re=ce;else if(!ce){if(se==Se)continue e;break e}}ne[ee++]=re}return ne}function Hash(F){var B=-1,G=null==F?0:F.length;for(this.clear();++B<G;){var W=F[B];this.set(W[0],W[1])}}function hashClear(){this.__data__=ai?ai(null):{},this.size=0}function hashDelete(F){var B=this.has(F)&&delete this.__data__[F];return this.size-=B?1:0,B}function hashGet(F){var B=this.__data__;if(ai){var W=B[F];return W===$?G:W}return Zt.call(B,F)?B[F]:G}function hashHas(F){var B=this.__data__;return ai?B[F]!==G:Zt.call(B,F)}function hashSet(F,B){var W=this.__data__;return this.size+=this.has(F)?0:1,W[F]=ai&&B===G?$:B,this}function ListCache(F){var B=-1,G=null==F?0:F.length;for(this.clear();++B<G;){var W=F[B];this.set(W[0],W[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(F){var B=this.__data__,G=assocIndexOf(B,F);return!(G<0)&&(G==B.length-1?B.pop():gn.call(B,G,1),--this.size,!0)}function listCacheGet(F){var B=this.__data__,W=assocIndexOf(B,F);return W<0?G:B[W][1]}function listCacheHas(F){return assocIndexOf(this.__data__,F)>-1}function listCacheSet(F,B){var G=this.__data__,W=assocIndexOf(G,F);return W<0?(++this.size,G.push([F,B])):G[W][1]=B,this}function MapCache(F){var B=-1,G=null==F?0:F.length;for(this.clear();++B<G;){var W=F[B];this.set(W[0],W[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(ti||ListCache),string:new Hash}}function mapCacheDelete(F){var B=getMapData(this,F).delete(F);return this.size-=B?1:0,B}function mapCacheGet(F){return getMapData(this,F).get(F)}function mapCacheHas(F){return getMapData(this,F).has(F)}function mapCacheSet(F,B){var G=getMapData(this,F),W=G.size;return G.set(F,B),this.size+=G.size==W?0:1,this}function SetCache(F){var B=-1,G=null==F?0:F.length;for(this.__data__=new MapCache;++B<G;)this.add(F[B])}function setCacheAdd(F){return this.__data__.set(F,$),this}function setCacheHas(F){return this.__data__.has(F)}function Stack(F){var B=this.__data__=new ListCache(F);this.size=B.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(F){var B=this.__data__,G=B.delete(F);return this.size=B.size,G}function stackGet(F){return this.__data__.get(F)}function stackHas(F){return this.__data__.has(F)}function stackSet(F,B){var G=this.__data__;if(G instanceof ListCache){var W=G.__data__;if(!ti||W.length<K-1)return W.push([F,B]),this.size=++G.size,this;G=this.__data__=new MapCache(W)}return G.set(F,B),this.size=G.size,this}function arrayLikeKeys(F,B){var G=_r(F),W=!G&&Sr(F),z=!G&&!W&&Tr(F),K=!G&&!W&&!z&&Rr(F),J=G||W||z||K,Q=J?baseTimes(F.length,zt):[],Y=Q.length;for(var $ in F)!B&&!Zt.call(F,$)||J&&("length"==$||z&&("offset"==$||"parent"==$)||K&&("buffer"==$||"byteLength"==$||"byteOffset"==$)||isIndex($,Y))||Q.push($);return Q}function arraySample(F){var B=F.length;return B?F[baseRandom(0,B-1)]:G}function arraySampleSize(F,B){return shuffleSelf(copyArray(F),baseClamp(B,0,F.length))}function arrayShuffle(F){return shuffleSelf(copyArray(F))}function assignMergeValue(F,B,W){(W!==G&&!eq(F[B],W)||W===G&&!(B in F))&&baseAssignValue(F,B,W)}function assignValue(F,B,W){var z=F[B];Zt.call(F,B)&&eq(z,W)&&(W!==G||B in F)||baseAssignValue(F,B,W)}function assocIndexOf(F,B){for(var G=F.length;G--;)if(eq(F[G][0],B))return G;return-1}function baseAggregator(F,B,G,W){return yi(F,(function(F,z,K){B(W,F,G(F),K)})),W}function baseAssign(F,B){return F&&copyObject(B,keys(B),F)}function baseAssignIn(F,B){return F&&copyObject(B,keysIn(B),F)}function baseAssignValue(F,B,G){"__proto__"==B&&yn?yn(F,B,{configurable:!0,enumerable:!0,value:G,writable:!0}):F[B]=G}function baseAt(F,B){for(var W=-1,K=B.length,J=z(K),Q=null==F;++W<K;)J[W]=Q?G:get(F,B[W]);return J}function baseClamp(F,B,W){return F==F&&(W!==G&&(F=F<=W?F:W),B!==G&&(F=F>=B?F:B)),F}function baseClone(F,B,W,z,K,J){var Q,Y=B&ee,$=B&te,X=B&ne;if(W&&(Q=K?W(F,z,K,J):W(F)),Q!==G)return Q;if(!isObject(F))return F;var Z=_r(F);if(Z){if(Q=initCloneArray(F),!Y)return copyArray(F,Q)}else{var ie=Mi(F),re=ie==xe||ie==Ue;if(Tr(F))return cloneBuffer(F,Y);if(ie==Ve||ie==Me||re&&!K){if(Q=$||re?{}:initCloneObject(F),!Y)return $?copySymbolsIn(F,baseAssignIn(Q,F)):copySymbols(F,baseAssign(Q,F))}else{if(!Mn[ie])return K?F:{};Q=initCloneByTag(F,ie,Y)}}J||(J=new Stack);var oe=J.get(F);if(oe)return oe;J.set(F,Q),Ar(F)?F.forEach((function(G){Q.add(baseClone(G,B,W,G,F,J))})):br(F)&&F.forEach((function(G,z){Q.set(z,baseClone(G,B,W,z,F,J))}));var ae=Z?G:(X?$?getAllKeysIn:getAllKeys:$?keysIn:keys)(F);return arrayEach(ae||F,(function(G,z){ae&&(G=F[z=G]),assignValue(Q,z,baseClone(G,B,W,z,F,J))})),Q}function baseConforms(F){var B=keys(F);return function(G){return baseConformsTo(G,F,B)}}function baseConformsTo(F,B,W){var z=W.length;if(null==F)return!z;for(F=Wt(F);z--;){var K=W[z],J=B[K],Q=F[K];if(Q===G&&!(K in F)||!J(Q))return!1}return!0}function baseDelay(F,B,W){if("function"!=typeof F)throw new Kt(Q);return Ni((function(){F.apply(G,W)}),B)}function baseDifference(F,B,G,W){var z=-1,J=arrayIncludes,Q=!0,Y=F.length,$=[],X=B.length;if(!Y)return $;G&&(B=arrayMap(B,baseUnary(G))),W?(J=arrayIncludesWith,Q=!1):B.length>=K&&(J=cacheHas,Q=!1,B=new SetCache(B));e:for(;++z<Y;){var Z=F[z],ee=null==G?Z:G(Z);if(Z=W||0!==Z?Z:0,Q&&ee==ee){for(var te=X;te--;)if(B[te]===ee)continue e;$.push(Z)}else J(B,ee,W)||$.push(Z)}return $}lodash.templateSettings={escape:mt,evaluate:vt,interpolate:yt,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=vi(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=vi(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var yi=createBaseEach(baseForOwn),Si=createBaseEach(baseForOwnRight,!0);function baseEvery(F,B){var G=!0;return yi(F,(function(F,W,z){return G=!!B(F,W,z)})),G}function baseExtremum(F,B,W){for(var z=-1,K=F.length;++z<K;){var J=F[z],Q=B(J);if(null!=Q&&(Y===G?Q==Q&&!isSymbol(Q):W(Q,Y)))var Y=Q,$=J}return $}function baseFill(F,B,W,z){var K=F.length;for((W=toInteger(W))<0&&(W=-W>K?0:K+W),(z=z===G||z>K?K:toInteger(z))<0&&(z+=K),z=W>z?0:toLength(z);W<z;)F[W++]=B;return F}function baseFilter(F,B){var G=[];return yi(F,(function(F,W,z){B(F,W,z)&&G.push(F)})),G}function baseFlatten(F,B,G,W,z){var K=-1,J=F.length;for(G||(G=isFlattenable),z||(z=[]);++K<J;){var Q=F[K];B>0&&G(Q)?B>1?baseFlatten(Q,B-1,G,W,z):arrayPush(z,Q):W||(z[z.length]=Q)}return z}var _i=createBaseFor(),Ci=createBaseFor(!0);function baseForOwn(F,B){return F&&_i(F,B,keys)}function baseForOwnRight(F,B){return F&&Ci(F,B,keys)}function baseFunctions(F,B){return arrayFilter(B,(function(B){return isFunction(F[B])}))}function baseGet(F,B){for(var W=0,z=(B=castPath(B,F)).length;null!=F&&W<z;)F=F[toKey(B[W++])];return W&&W==z?F:G}function baseGetAllKeys(F,B,G){var W=B(F);return _r(F)?W:arrayPush(W,G(F))}function baseGetTag(F){return null==F?F===G?Qe:He:vn&&vn in Wt(F)?getRawTag(F):objectToString(F)}function baseGt(F,B){return F>B}function baseHas(F,B){return null!=F&&Zt.call(F,B)}function baseHasIn(F,B){return null!=F&&B in Wt(F)}function baseInRange(F,B,G){return F>=Un(B,G)&&F<xn(B,G)}function baseIntersection(F,B,W){for(var K=W?arrayIncludesWith:arrayIncludes,J=F[0].length,Q=F.length,Y=Q,$=z(Q),X=1/0,Z=[];Y--;){var ee=F[Y];Y&&B&&(ee=arrayMap(ee,baseUnary(B))),X=Un(ee.length,X),$[Y]=!W&&(B||J>=120&&ee.length>=120)?new SetCache(Y&&ee):G}ee=F[0];var te=-1,ne=$[0];e:for(;++te<J&&Z.length<X;){var ie=ee[te],re=B?B(ie):ie;if(ie=W||0!==ie?ie:0,!(ne?cacheHas(ne,re):K(Z,re,W))){for(Y=Q;--Y;){var oe=$[Y];if(!(oe?cacheHas(oe,re):K(F[Y],re,W)))continue e}ne&&ne.push(re),Z.push(ie)}}return Z}function baseInverter(F,B,G,W){return baseForOwn(F,(function(F,z,K){B(W,G(F),z,K)})),W}function baseInvoke(F,B,W){var z=null==(F=parent(F,B=castPath(B,F)))?F:F[toKey(last(B))];return null==z?G:apply(z,F,W)}function baseIsArguments(F){return isObjectLike(F)&&baseGetTag(F)==Me}function baseIsArrayBuffer(F){return isObjectLike(F)&&baseGetTag(F)==Xe}function baseIsDate(F){return isObjectLike(F)&&baseGetTag(F)==Le}function baseIsEqual(F,B,G,W,z){return F===B||(null==F||null==B||!isObjectLike(F)&&!isObjectLike(B)?F!=F&&B!=B:baseIsEqualDeep(F,B,G,W,baseIsEqual,z))}function baseIsEqualDeep(F,B,G,W,z,K){var J=_r(F),Q=_r(B),Y=J?we:Mi(F),$=Q?we:Mi(B),X=(Y=Y==Me?Ve:Y)==Ve,Z=($=$==Me?Ve:$)==Ve,ee=Y==$;if(ee&&Tr(F)){if(!Tr(B))return!1;J=!0,X=!1}if(ee&&!X)return K||(K=new Stack),J||Rr(F)?equalArrays(F,B,G,W,z,K):equalByTag(F,B,Y,G,W,z,K);if(!(G&ie)){var te=X&&Zt.call(F,"__wrapped__"),ne=Z&&Zt.call(B,"__wrapped__");if(te||ne){var re=te?F.value():F,oe=ne?B.value():B;return K||(K=new Stack),z(re,oe,G,W,K)}}return!!ee&&(K||(K=new Stack),equalObjects(F,B,G,W,z,K))}function baseIsMap(F){return isObjectLike(F)&&Mi(F)==je}function baseIsMatch(F,B,W,z){var K=W.length,J=K,Q=!z;if(null==F)return!J;for(F=Wt(F);K--;){var Y=W[K];if(Q&&Y[2]?Y[1]!==F[Y[0]]:!(Y[0]in F))return!1}for(;++K<J;){var $=(Y=W[K])[0],X=F[$],Z=Y[1];if(Q&&Y[2]){if(X===G&&!($ in F))return!1}else{var ee=new Stack;if(z)var te=z(X,Z,$,F,B,ee);if(!(te===G?baseIsEqual(Z,X,ie|re,z,ee):te))return!1}}return!0}function baseIsNative(F){return!(!isObject(F)||isMasked(F))&&(isFunction(F)?an:Ft).test(toSource(F))}function baseIsRegExp(F){return isObjectLike(F)&&baseGetTag(F)==qe}function baseIsSet(F){return isObjectLike(F)&&Mi(F)==ze}function baseIsTypedArray(F){return isObjectLike(F)&&isLength(F.length)&&!!On[baseGetTag(F)]}function baseIteratee(F){return"function"==typeof F?F:null==F?identity:"object"==typeof F?_r(F)?baseMatchesProperty(F[0],F[1]):baseMatches(F):property(F)}function baseKeys(F){if(!isPrototype(F))return Ln(F);var B=[];for(var G in Wt(F))Zt.call(F,G)&&"constructor"!=G&&B.push(G);return B}function baseKeysIn(F){if(!isObject(F))return nativeKeysIn(F);var B=isPrototype(F),G=[];for(var W in F)("constructor"!=W||!B&&Zt.call(F,W))&&G.push(W);return G}function baseLt(F,B){return F<B}function baseMap(F,B){var G=-1,W=isArrayLike(F)?z(F.length):[];return yi(F,(function(F,z,K){W[++G]=B(F,z,K)})),W}function baseMatches(F){var B=getMatchData(F);return 1==B.length&&B[0][2]?matchesStrictComparable(B[0][0],B[0][1]):function(G){return G===F||baseIsMatch(G,F,B)}}function baseMatchesProperty(F,B){return isKey(F)&&isStrictComparable(B)?matchesStrictComparable(toKey(F),B):function(W){var z=get(W,F);return z===G&&z===B?hasIn(W,F):baseIsEqual(B,z,ie|re)}}function baseMerge(F,B,W,z,K){F!==B&&_i(B,(function(J,Q){if(K||(K=new Stack),isObject(J))baseMergeDeep(F,B,Q,W,baseMerge,z,K);else{var Y=z?z(safeGet(F,Q),J,Q+"",F,B,K):G;Y===G&&(Y=J),assignMergeValue(F,Q,Y)}}),keysIn)}function baseMergeDeep(F,B,W,z,K,J,Q){var Y=safeGet(F,W),$=safeGet(B,W),X=Q.get($);if(X)assignMergeValue(F,W,X);else{var Z=J?J(Y,$,W+"",F,B,Q):G,ee=Z===G;if(ee){var te=_r($),ne=!te&&Tr($),ie=!te&&!ne&&Rr($);Z=$,te||ne||ie?_r(Y)?Z=Y:isArrayLikeObject(Y)?Z=copyArray(Y):ne?(ee=!1,Z=cloneBuffer($,!0)):ie?(ee=!1,Z=cloneTypedArray($,!0)):Z=[]:isPlainObject($)||Sr($)?(Z=Y,Sr(Y)?Z=toPlainObject(Y):isObject(Y)&&!isFunction(Y)||(Z=initCloneObject($))):ee=!1}ee&&(Q.set($,Z),K(Z,$,z,J,Q),Q.delete($)),assignMergeValue(F,W,Z)}}function baseNth(F,B){var W=F.length;if(W)return isIndex(B+=B<0?W:0,W)?F[B]:G}function baseOrderBy(F,B,G){B=B.length?arrayMap(B,(function(F){return _r(F)?function(B){return baseGet(B,1===F.length?F[0]:F)}:F})):[identity];var W=-1;B=arrayMap(B,baseUnary(getIteratee()));var z=baseMap(F,(function(F,G,z){var K=arrayMap(B,(function(B){return B(F)}));return{criteria:K,index:++W,value:F}}));return baseSortBy(z,(function(F,B){return compareMultiple(F,B,G)}))}function basePick(F,B){return basePickBy(F,B,(function(B,G){return hasIn(F,G)}))}function basePickBy(F,B,G){for(var W=-1,z=B.length,K={};++W<z;){var J=B[W],Q=baseGet(F,J);G(Q,J)&&baseSet(K,castPath(J,F),Q)}return K}function basePropertyDeep(F){return function(B){return baseGet(B,F)}}function basePullAll(F,B,G,W){var z=W?baseIndexOfWith:baseIndexOf,K=-1,J=B.length,Q=F;for(F===B&&(B=copyArray(B)),G&&(Q=arrayMap(F,baseUnary(G)));++K<J;)for(var Y=0,$=B[K],X=G?G($):$;(Y=z(Q,X,Y,W))>-1;)Q!==F&&gn.call(Q,Y,1),gn.call(F,Y,1);return F}function basePullAt(F,B){for(var G=F?B.length:0,W=G-1;G--;){var z=B[G];if(G==W||z!==K){var K=z;isIndex(z)?gn.call(F,z,1):baseUnset(F,z)}}return F}function baseRandom(F,B){return F+In(Gn()*(B-F+1))}function baseRange(F,B,G,W){for(var K=-1,J=xn(bn((B-F)/(G||1)),0),Q=z(J);J--;)Q[W?J:++K]=F,F+=G;return Q}function baseRepeat(F,B){var G="";if(!F||B<1||B>Ee)return G;do{B%2&&(G+=F),(B=In(B/2))&&(F+=F)}while(B);return G}function baseRest(F,B){return Li(overRest(F,B,identity),F+"")}function baseSample(F){return arraySample(values(F))}function baseSampleSize(F,B){var G=values(F);return shuffleSelf(G,baseClamp(B,0,G.length))}function baseSet(F,B,W,z){if(!isObject(F))return F;for(var K=-1,J=(B=castPath(B,F)).length,Q=J-1,Y=F;null!=Y&&++K<J;){var $=toKey(B[K]),X=W;if("__proto__"===$||"constructor"===$||"prototype"===$)return F;if(K!=Q){var Z=Y[$];(X=z?z(Z,$,Y):G)===G&&(X=isObject(Z)?Z:isIndex(B[K+1])?[]:{})}assignValue(Y,$,X),Y=Y[$]}return F}var Ti=si?function(F,B){return si.set(F,B),F}:identity,Ei=yn?function(F,B){return yn(F,"toString",{configurable:!0,enumerable:!1,value:constant(B),writable:!0})}:identity;function baseShuffle(F){return shuffleSelf(values(F))}function baseSlice(F,B,G){var W=-1,K=F.length;B<0&&(B=-B>K?0:K+B),(G=G>K?K:G)<0&&(G+=K),K=B>G?0:G-B>>>0,B>>>=0;for(var J=z(K);++W<K;)J[W]=F[W+B];return J}function baseSome(F,B){var G;return yi(F,(function(F,W,z){return!(G=B(F,W,z))})),!!G}function baseSortedIndex(F,B,G){var W=0,z=null==F?W:F.length;if("number"==typeof B&&B==B&&z<=Pe){for(;W<z;){var K=W+z>>>1,J=F[K];null!==J&&!isSymbol(J)&&(G?J<=B:J<B)?W=K+1:z=K}return z}return baseSortedIndexBy(F,B,identity,G)}function baseSortedIndexBy(F,B,W,z){var K=0,J=null==F?0:F.length;if(0===J)return 0;for(var Q=(B=W(B))!=B,Y=null===B,$=isSymbol(B),X=B===G;K<J;){var Z=In((K+J)/2),ee=W(F[Z]),te=ee!==G,ne=null===ee,ie=ee==ee,re=isSymbol(ee);if(Q)var oe=z||ie;else oe=X?ie&&(z||te):Y?ie&&te&&(z||!ne):$?ie&&te&&!ne&&(z||!re):!ne&&!re&&(z?ee<=B:ee<B);oe?K=Z+1:J=Z}return Un(J,Re)}function baseSortedUniq(F,B){for(var G=-1,W=F.length,z=0,K=[];++G<W;){var J=F[G],Q=B?B(J):J;if(!G||!eq(Q,Y)){var Y=Q;K[z++]=0===J?0:J}}return K}function baseToNumber(F){return"number"==typeof F?F:isSymbol(F)?Ie:+F}function baseToString(F){if("string"==typeof F)return F;if(_r(F))return arrayMap(F,baseToString)+"";if(isSymbol(F))return mi?mi.call(F):"";var B=F+"";return"0"==B&&1/F==-Te?"-0":B}function baseUniq(F,B,G){var W=-1,z=arrayIncludes,J=F.length,Q=!0,Y=[],$=Y;if(G)Q=!1,z=arrayIncludesWith;else if(J>=K){var X=B?null:Ai(F);if(X)return setToArray(X);Q=!1,z=cacheHas,$=new SetCache}else $=B?[]:Y;e:for(;++W<J;){var Z=F[W],ee=B?B(Z):Z;if(Z=G||0!==Z?Z:0,Q&&ee==ee){for(var te=$.length;te--;)if($[te]===ee)continue e;B&&$.push(ee),Y.push(Z)}else z($,ee,G)||($!==Y&&$.push(ee),Y.push(Z))}return Y}function baseUnset(F,B){return null==(F=parent(F,B=castPath(B,F)))||delete F[toKey(last(B))]}function baseUpdate(F,B,G,W){return baseSet(F,B,G(baseGet(F,B)),W)}function baseWhile(F,B,G,W){for(var z=F.length,K=W?z:-1;(W?K--:++K<z)&&B(F[K],K,F););return G?baseSlice(F,W?0:K,W?K+1:z):baseSlice(F,W?K+1:0,W?z:K)}function baseWrapperValue(F,B){var G=F;return G instanceof LazyWrapper&&(G=G.value()),arrayReduce(B,(function(F,B){return B.func.apply(B.thisArg,arrayPush([F],B.args))}),G)}function baseXor(F,B,G){var W=F.length;if(W<2)return W?baseUniq(F[0]):[];for(var K=-1,J=z(W);++K<W;)for(var Q=F[K],Y=-1;++Y<W;)Y!=K&&(J[K]=baseDifference(J[K]||Q,F[Y],B,G));return baseUniq(baseFlatten(J,1),B,G)}function baseZipObject(F,B,W){for(var z=-1,K=F.length,J=B.length,Q={};++z<K;){var Y=z<J?B[z]:G;W(Q,F[z],Y)}return Q}function castArrayLikeObject(F){return isArrayLikeObject(F)?F:[]}function castFunction(F){return"function"==typeof F?F:identity}function castPath(F,B){return _r(F)?F:isKey(F,B)?[F]:ki(toString(F))}var bi=baseRest;function castSlice(F,B,W){var z=F.length;return W=W===G?z:W,!B&&W>=z?F:baseSlice(F,B,W)}var Ii=Sn||function(F){return jn.clearTimeout(F)};function cloneBuffer(F,B){if(B)return F.slice();var G=F.length,W=dn?dn(G):new F.constructor(G);return F.copy(W),W}function cloneArrayBuffer(F){var B=new F.constructor(F.byteLength);return new ln(B).set(new ln(F)),B}function cloneDataView(F,B){var G=B?cloneArrayBuffer(F.buffer):F.buffer;return new F.constructor(G,F.byteOffset,F.byteLength)}function cloneRegExp(F){var B=new F.constructor(F.source,Nt.exec(F));return B.lastIndex=F.lastIndex,B}function cloneSymbol(F){return fi?Wt(fi.call(F)):{}}function cloneTypedArray(F,B){var G=B?cloneArrayBuffer(F.buffer):F.buffer;return new F.constructor(G,F.byteOffset,F.length)}function compareAscending(F,B){if(F!==B){var W=F!==G,z=null===F,K=F==F,J=isSymbol(F),Q=B!==G,Y=null===B,$=B==B,X=isSymbol(B);if(!Y&&!X&&!J&&F>B||J&&Q&&$&&!Y&&!X||z&&Q&&$||!W&&$||!K)return 1;if(!z&&!J&&!X&&F<B||X&&W&&K&&!z&&!J||Y&&W&&K||!Q&&K||!$)return-1}return 0}function compareMultiple(F,B,G){for(var W=-1,z=F.criteria,K=B.criteria,J=z.length,Q=G.length;++W<J;){var Y=compareAscending(z[W],K[W]);if(Y)return W>=Q?Y:Y*("desc"==G[W]?-1:1)}return F.index-B.index}function composeArgs(F,B,G,W){for(var K=-1,J=F.length,Q=G.length,Y=-1,$=B.length,X=xn(J-Q,0),Z=z($+X),ee=!W;++Y<$;)Z[Y]=B[Y];for(;++K<Q;)(ee||K<J)&&(Z[G[K]]=F[K]);for(;X--;)Z[Y++]=F[K++];return Z}function composeArgsRight(F,B,G,W){for(var K=-1,J=F.length,Q=-1,Y=G.length,$=-1,X=B.length,Z=xn(J-Y,0),ee=z(Z+X),te=!W;++K<Z;)ee[K]=F[K];for(var ne=K;++$<X;)ee[ne+$]=B[$];for(;++Q<Y;)(te||K<J)&&(ee[ne+G[Q]]=F[K++]);return ee}function copyArray(F,B){var G=-1,W=F.length;for(B||(B=z(W));++G<W;)B[G]=F[G];return B}function copyObject(F,B,W,z){var K=!W;W||(W={});for(var J=-1,Q=B.length;++J<Q;){var Y=B[J],$=z?z(W[Y],F[Y],Y,W,F):G;$===G&&($=F[Y]),K?baseAssignValue(W,Y,$):assignValue(W,Y,$)}return W}function copySymbols(F,B){return copyObject(F,Pi(F),B)}function copySymbolsIn(F,B){return copyObject(F,Oi(F),B)}function createAggregator(F,B){return function(G,W){var z=_r(G)?arrayAggregator:baseAggregator,K=B?B():{};return z(G,F,getIteratee(W,2),K)}}function createAssigner(F){return baseRest((function(B,W){var z=-1,K=W.length,J=K>1?W[K-1]:G,Q=K>2?W[2]:G;for(J=F.length>3&&"function"==typeof J?(K--,J):G,Q&&isIterateeCall(W[0],W[1],Q)&&(J=K<3?G:J,K=1),B=Wt(B);++z<K;){var Y=W[z];Y&&F(B,Y,z,J)}return B}))}function createBaseEach(F,B){return function(G,W){if(null==G)return G;if(!isArrayLike(G))return F(G,W);for(var z=G.length,K=B?z:-1,J=Wt(G);(B?K--:++K<z)&&!1!==W(J[K],K,J););return G}}function createBaseFor(F){return function(B,G,W){for(var z=-1,K=Wt(B),J=W(B),Q=J.length;Q--;){var Y=J[F?Q:++z];if(!1===G(K[Y],Y,K))break}return B}}function createBind(F,B,G){var W=B&oe,z=createCtor(F);function wrapper(){return(this&&this!==jn&&this instanceof wrapper?z:F).apply(W?G:this,arguments)}return wrapper}function createCaseFirst(F){return function(B){var W=hasUnicode(B=toString(B))?stringToArray(B):G,z=W?W[0]:B.charAt(0),K=W?castSlice(W,1).join(""):B.slice(1);return z[F]()+K}}function createCompounder(F){return function(B){return arrayReduce(words(deburr(B).replace(Cn,"")),F,"")}}function createCtor(F){return function(){var B=arguments;switch(B.length){case 0:return new F;case 1:return new F(B[0]);case 2:return new F(B[0],B[1]);case 3:return new F(B[0],B[1],B[2]);case 4:return new F(B[0],B[1],B[2],B[3]);case 5:return new F(B[0],B[1],B[2],B[3],B[4]);case 6:return new F(B[0],B[1],B[2],B[3],B[4],B[5]);case 7:return new F(B[0],B[1],B[2],B[3],B[4],B[5],B[6])}var G=vi(F.prototype),W=F.apply(G,B);return isObject(W)?W:G}}function createCurry(F,B,W){var K=createCtor(F);function wrapper(){for(var J=arguments.length,Q=z(J),Y=J,$=getHolder(wrapper);Y--;)Q[Y]=arguments[Y];var X=J<3&&Q[0]!==$&&Q[J-1]!==$?[]:replaceHolders(Q,$);return(J-=X.length)<W?createRecurry(F,B,createHybrid,wrapper.placeholder,G,Q,X,G,G,W-J):apply(this&&this!==jn&&this instanceof wrapper?K:F,this,Q)}return wrapper}function createFind(F){return function(B,W,z){var K=Wt(B);if(!isArrayLike(B)){var J=getIteratee(W,3);B=keys(B),W=function(F){return J(K[F],F,K)}}var Q=F(B,W,z);return Q>-1?K[J?B[Q]:Q]:G}}function createFlow(F){return flatRest((function(B){var W=B.length,z=W,K=LodashWrapper.prototype.thru;for(F&&B.reverse();z--;){var J=B[z];if("function"!=typeof J)throw new Kt(Q);if(K&&!Y&&"wrapper"==getFuncName(J))var Y=new LodashWrapper([],!0)}for(z=Y?z:W;++z<W;){var $=getFuncName(J=B[z]),X="wrapper"==$?Ri(J):G;Y=X&&isLaziable(X[0])&&X[1]==(pe|ce|de|he)&&!X[4].length&&1==X[9]?Y[getFuncName(X[0])].apply(Y,X[3]):1==J.length&&isLaziable(J)?Y[$]():Y.thru(J)}return function(){var F=arguments,G=F[0];if(Y&&1==F.length&&_r(G))return Y.plant(G).value();for(var z=0,K=W?B[z].apply(this,F):G;++z<W;)K=B[z].call(this,K);return K}}))}function createHybrid(F,B,W,K,J,Q,Y,$,X,Z){var ee=B&pe,te=B&oe,ne=B&ae,ie=B&(ce|le),re=B&ge,se=ne?G:createCtor(F);function wrapper(){for(var G=arguments.length,oe=z(G),ae=G;ae--;)oe[ae]=arguments[ae];if(ie)var ce=getHolder(wrapper),le=countHolders(oe,ce);if(K&&(oe=composeArgs(oe,K,J,ie)),Q&&(oe=composeArgsRight(oe,Q,Y,ie)),G-=le,ie&&G<Z){var de=replaceHolders(oe,ce);return createRecurry(F,B,createHybrid,wrapper.placeholder,W,oe,de,$,X,Z-G)}var ue=te?W:this,pe=ne?ue[F]:F;return G=oe.length,$?oe=reorder(oe,$):re&&G>1&&oe.reverse(),ee&&X<G&&(oe.length=X),this&&this!==jn&&this instanceof wrapper&&(pe=se||createCtor(pe)),pe.apply(ue,oe)}return wrapper}function createInverter(F,B){return function(G,W){return baseInverter(G,F,B(W),{})}}function createMathOperation(F,B){return function(W,z){var K;if(W===G&&z===G)return B;if(W!==G&&(K=W),z!==G){if(K===G)return z;"string"==typeof W||"string"==typeof z?(W=baseToString(W),z=baseToString(z)):(W=baseToNumber(W),z=baseToNumber(z)),K=F(W,z)}return K}}function createOver(F){return flatRest((function(B){return B=arrayMap(B,baseUnary(getIteratee())),baseRest((function(G){var W=this;return F(B,(function(F){return apply(F,W,G)}))}))}))}function createPadding(F,B){var W=(B=B===G?" ":baseToString(B)).length;if(W<2)return W?baseRepeat(B,F):B;var z=baseRepeat(B,bn(F/stringSize(B)));return hasUnicode(B)?castSlice(stringToArray(z),0,F).join(""):z.slice(0,F)}function createPartial(F,B,G,W){var K=B&oe,J=createCtor(F);function wrapper(){for(var B=-1,Q=arguments.length,Y=-1,$=W.length,X=z($+Q),Z=this&&this!==jn&&this instanceof wrapper?J:F;++Y<$;)X[Y]=W[Y];for(;Q--;)X[Y++]=arguments[++B];return apply(Z,K?G:this,X)}return wrapper}function createRange(F){return function(B,W,z){return z&&"number"!=typeof z&&isIterateeCall(B,W,z)&&(W=z=G),B=toFinite(B),W===G?(W=B,B=0):W=toFinite(W),baseRange(B,W,z=z===G?B<W?1:-1:toFinite(z),F)}}function createRelationalOperation(F){return function(B,G){return"string"==typeof B&&"string"==typeof G||(B=toNumber(B),G=toNumber(G)),F(B,G)}}function createRecurry(F,B,W,z,K,J,Q,Y,$,X){var Z=B&ce;B|=Z?de:ue,(B&=~(Z?ue:de))&se||(B&=~(oe|ae));var ee=[F,B,K,Z?J:G,Z?Q:G,Z?G:J,Z?G:Q,Y,$,X],te=W.apply(G,ee);return isLaziable(F)&&Di(te,ee),te.placeholder=z,setWrapToString(te,F,B)}function createRound(F){var B=Gt[F];return function(F,G){if(F=toNumber(F),(G=null==G?0:Un(toInteger(G),292))&&Dn(F)){var W=(toString(F)+"e").split("e");return+((W=(toString(B(W[0]+"e"+(+W[1]+G)))+"e").split("e"))[0]+"e"+(+W[1]-G))}return B(F)}}var Ai=ri&&1/setToArray(new ri([,-0]))[1]==Te?function(F){return new ri(F)}:noop;function createToPairs(F){return function(B){var G=Mi(B);return G==je?mapToArray(B):G==ze?setToPairs(B):baseToPairs(B,F(B))}}function createWrap(F,B,W,z,K,J,Y,$){var X=B&ae;if(!X&&"function"!=typeof F)throw new Kt(Q);var Z=z?z.length:0;if(Z||(B&=~(de|ue),z=K=G),Y=Y===G?Y:xn(toInteger(Y),0),$=$===G?$:toInteger($),Z-=K?K.length:0,B&ue){var ee=z,te=K;z=K=G}var ne=X?G:Ri(F),ie=[F,B,W,z,K,ee,te,J,Y,$];if(ne&&mergeData(ie,ne),F=ie[0],B=ie[1],W=ie[2],z=ie[3],K=ie[4],!($=ie[9]=ie[9]===G?X?0:F.length:xn(ie[9]-Z,0))&&B&(ce|le)&&(B&=~(ce|le)),B&&B!=oe)re=B==ce||B==le?createCurry(F,B,$):B!=de&&B!=(oe|de)||K.length?createHybrid.apply(G,ie):createPartial(F,B,W,z);else var re=createBind(F,B,W);return setWrapToString((ne?Ti:Di)(re,ie),F,B)}function customDefaultsAssignIn(F,B,W,z){return F===G||eq(F,Yt[W])&&!Zt.call(z,W)?B:F}function customDefaultsMerge(F,B,W,z,K,J){return isObject(F)&&isObject(B)&&(J.set(B,F),baseMerge(F,B,G,customDefaultsMerge,J),J.delete(B)),F}function customOmitClone(F){return isPlainObject(F)?G:F}function equalArrays(F,B,W,z,K,J){var Q=W&ie,Y=F.length,$=B.length;if(Y!=$&&!(Q&&$>Y))return!1;var X=J.get(F),Z=J.get(B);if(X&&Z)return X==B&&Z==F;var ee=-1,te=!0,ne=W&re?new SetCache:G;for(J.set(F,B),J.set(B,F);++ee<Y;){var oe=F[ee],ae=B[ee];if(z)var se=Q?z(ae,oe,ee,B,F,J):z(oe,ae,ee,F,B,J);if(se!==G){if(se)continue;te=!1;break}if(ne){if(!arraySome(B,(function(F,B){if(!cacheHas(ne,B)&&(oe===F||K(oe,F,W,z,J)))return ne.push(B)}))){te=!1;break}}else if(oe!==ae&&!K(oe,ae,W,z,J)){te=!1;break}}return J.delete(F),J.delete(B),te}function equalByTag(F,B,G,W,z,K,J){switch(G){case Ze:if(F.byteLength!=B.byteLength||F.byteOffset!=B.byteOffset)return!1;F=F.buffer,B=B.buffer;case Xe:return!(F.byteLength!=B.byteLength||!K(new ln(F),new ln(B)));case Ne:case Le:case Be:return eq(+F,+B);case Fe:return F.name==B.name&&F.message==B.message;case qe:case Ke:return F==B+"";case je:var Q=mapToArray;case ze:var Y=W&ie;if(Q||(Q=setToArray),F.size!=B.size&&!Y)return!1;var $=J.get(F);if($)return $==B;W|=re,J.set(F,B);var X=equalArrays(Q(F),Q(B),W,z,K,J);return J.delete(F),X;case Je:if(fi)return fi.call(F)==fi.call(B)}return!1}function equalObjects(F,B,W,z,K,J){var Q=W&ie,Y=getAllKeys(F),$=Y.length;if($!=getAllKeys(B).length&&!Q)return!1;for(var X=$;X--;){var Z=Y[X];if(!(Q?Z in B:Zt.call(B,Z)))return!1}var ee=J.get(F),te=J.get(B);if(ee&&te)return ee==B&&te==F;var ne=!0;J.set(F,B),J.set(B,F);for(var re=Q;++X<$;){var oe=F[Z=Y[X]],ae=B[Z];if(z)var se=Q?z(ae,oe,Z,B,F,J):z(oe,ae,Z,F,B,J);if(!(se===G?oe===ae||K(oe,ae,W,z,J):se)){ne=!1;break}re||(re="constructor"==Z)}if(ne&&!re){var ce=F.constructor,le=B.constructor;ce==le||!("constructor"in F)||!("constructor"in B)||"function"==typeof ce&&ce instanceof ce&&"function"==typeof le&&le instanceof le||(ne=!1)}return J.delete(F),J.delete(B),ne}function flatRest(F){return Li(overRest(F,G,flatten),F+"")}function getAllKeys(F){return baseGetAllKeys(F,keys,Pi)}function getAllKeysIn(F){return baseGetAllKeys(F,keysIn,Oi)}var Ri=si?function(F){return si.get(F)}:noop;function getFuncName(F){for(var B=F.name+"",G=ci[B],W=Zt.call(ci,B)?G.length:0;W--;){var z=G[W],K=z.func;if(null==K||K==F)return z.name}return B}function getHolder(F){return(Zt.call(lodash,"placeholder")?lodash:F).placeholder}function getIteratee(){var F=lodash.iteratee||iteratee;return F=F===iteratee?baseIteratee:F,arguments.length?F(arguments[0],arguments[1]):F}function getMapData(F,B){var G=F.__data__;return isKeyable(B)?G["string"==typeof B?"string":"hash"]:G.map}function getMatchData(F){for(var B=keys(F),G=B.length;G--;){var W=B[G],z=F[W];B[G]=[W,z,isStrictComparable(z)]}return B}function getNative(F,B){var W=getValue(F,B);return baseIsNative(W)?W:G}function getRawTag(F){var B=Zt.call(F,vn),W=F[vn];try{F[vn]=G;var z=!0}catch(F){}var K=nn.call(F);return z&&(B?F[vn]=W:delete F[vn]),K}var Pi=An?function(F){return null==F?[]:(F=Wt(F),arrayFilter(An(F),(function(B){return hn.call(F,B)})))}:stubArray,Oi=An?function(F){for(var B=[];F;)arrayPush(B,Pi(F)),F=un(F);return B}:stubArray,Mi=baseGetTag;function getView(F,B,G){for(var W=-1,z=G.length;++W<z;){var K=G[W],J=K.size;switch(K.type){case"drop":F+=J;break;case"dropRight":B-=J;break;case"take":B=Un(B,F+J);break;case"takeRight":F=xn(F,B-J)}}return{start:F,end:B}}function getWrapDetails(F){var B=F.match(Rt);return B?B[1].split(Pt):[]}function hasPath(F,B,G){for(var W=-1,z=(B=castPath(B,F)).length,K=!1;++W<z;){var J=toKey(B[W]);if(!(K=null!=F&&G(F,J)))break;F=F[J]}return K||++W!=z?K:!!(z=null==F?0:F.length)&&isLength(z)&&isIndex(J,z)&&(_r(F)||Sr(F))}function initCloneArray(F){var B=F.length,G=new F.constructor(B);return B&&"string"==typeof F[0]&&Zt.call(F,"index")&&(G.index=F.index,G.input=F.input),G}function initCloneObject(F){return"function"!=typeof F.constructor||isPrototype(F)?{}:vi(un(F))}function initCloneByTag(F,B,G){var W=F.constructor;switch(B){case Xe:return cloneArrayBuffer(F);case Ne:case Le:return new W(+F);case Ze:return cloneDataView(F,G);case et:case tt:case nt:case it:case rt:case ot:case at:case st:case ct:return cloneTypedArray(F,G);case je:return new W;case Be:case Ke:return new W(F);case qe:return cloneRegExp(F);case ze:return new W;case Je:return cloneSymbol(F)}}function insertWrapDetails(F,B){var G=B.length;if(!G)return F;var W=G-1;return B[W]=(G>1?"& ":"")+B[W],B=B.join(G>2?", ":" "),F.replace(At,"{\n/* [wrapped with "+B+"] */\n")}function isFlattenable(F){return _r(F)||Sr(F)||!!(fn&&F&&F[fn])}function isIndex(F,B){var G=typeof F;return!!(B=null==B?Ee:B)&&("number"==G||"symbol"!=G&&Ut.test(F))&&F>-1&&F%1==0&&F<B}function isIterateeCall(F,B,G){if(!isObject(G))return!1;var W=typeof B;return!!("number"==W?isArrayLike(G)&&isIndex(B,G.length):"string"==W&&B in G)&&eq(G[B],F)}function isKey(F,B){if(_r(F))return!1;var G=typeof F;return!("number"!=G&&"symbol"!=G&&"boolean"!=G&&null!=F&&!isSymbol(F))||(_t.test(F)||!St.test(F)||null!=B&&F in Wt(B))}function isKeyable(F){var B=typeof F;return"string"==B||"number"==B||"symbol"==B||"boolean"==B?"__proto__"!==F:null===F}function isLaziable(F){var B=getFuncName(F),G=lodash[B];if("function"!=typeof G||!(B in LazyWrapper.prototype))return!1;if(F===G)return!0;var W=Ri(G);return!!W&&F===W[0]}function isMasked(F){return!!tn&&tn in F}($n&&Mi(new $n(new ArrayBuffer(1)))!=Ze||ti&&Mi(new ti)!=je||ii&&Mi(ii.resolve())!=Ge||ri&&Mi(new ri)!=ze||oi&&Mi(new oi)!=Ye)&&(Mi=function(F){var B=baseGetTag(F),W=B==Ve?F.constructor:G,z=W?toSource(W):"";if(z)switch(z){case li:return Ze;case di:return je;case ui:return Ge;case pi:return ze;case hi:return Ye}return B});var wi=$t?isFunction:stubFalse;function isPrototype(F){var B=F&&F.constructor;return F===("function"==typeof B&&B.prototype||Yt)}function isStrictComparable(F){return F==F&&!isObject(F)}function matchesStrictComparable(F,B){return function(W){return null!=W&&(W[F]===B&&(B!==G||F in Wt(W)))}}function memoizeCapped(F){var B=memoize(F,(function(F){return G.size===X&&G.clear(),F})),G=B.cache;return B}function mergeData(F,B){var G=F[1],W=B[1],z=G|W,K=z<(oe|ae|pe),J=W==pe&&G==ce||W==pe&&G==he&&F[7].length<=B[8]||W==(pe|he)&&B[7].length<=B[8]&&G==ce;if(!K&&!J)return F;W&oe&&(F[2]=B[2],z|=G&oe?0:se);var Q=B[3];if(Q){var Y=F[3];F[3]=Y?composeArgs(Y,Q,B[4]):Q,F[4]=Y?replaceHolders(F[3],Z):B[4]}return(Q=B[5])&&(Y=F[5],F[5]=Y?composeArgsRight(Y,Q,B[6]):Q,F[6]=Y?replaceHolders(F[5],Z):B[6]),(Q=B[7])&&(F[7]=Q),W&pe&&(F[8]=null==F[8]?B[8]:Un(F[8],B[8])),null==F[9]&&(F[9]=B[9]),F[0]=B[0],F[1]=z,F}function nativeKeysIn(F){var B=[];if(null!=F)for(var G in Wt(F))B.push(G);return B}function objectToString(F){return nn.call(F)}function overRest(F,B,W){return B=xn(B===G?F.length-1:B,0),function(){for(var G=arguments,K=-1,J=xn(G.length-B,0),Q=z(J);++K<J;)Q[K]=G[B+K];K=-1;for(var Y=z(B+1);++K<B;)Y[K]=G[K];return Y[B]=W(Q),apply(F,this,Y)}}function parent(F,B){return B.length<2?F:baseGet(F,baseSlice(B,0,-1))}function reorder(F,B){for(var W=F.length,z=Un(B.length,W),K=copyArray(F);z--;){var J=B[z];F[z]=isIndex(J,W)?K[J]:G}return F}function safeGet(F,B){if(("constructor"!==B||"function"!=typeof F[B])&&"__proto__"!=B)return F[B]}var Di=shortOut(Ti),Ni=En||function(F,B){return jn.setTimeout(F,B)},Li=shortOut(Ei);function setWrapToString(F,B,G){var W=B+"";return Li(F,insertWrapDetails(W,updateWrapDetails(getWrapDetails(W),G)))}function shortOut(F){var B=0,W=0;return function(){var z=Bn(),K=ye-(z-W);if(W=z,K>0){if(++B>=ve)return arguments[0]}else B=0;return F.apply(G,arguments)}}function shuffleSelf(F,B){var W=-1,z=F.length,K=z-1;for(B=B===G?z:B;++W<B;){var J=baseRandom(W,K),Q=F[J];F[J]=F[W],F[W]=Q}return F.length=B,F}var ki=memoizeCapped((function(F){var B=[];return 46===F.charCodeAt(0)&&B.push(""),F.replace(Ct,(function(F,G,W,z){B.push(W?z.replace(wt,"$1"):G||F)})),B}));function toKey(F){if("string"==typeof F||isSymbol(F))return F;var B=F+"";return"0"==B&&1/F==-Te?"-0":B}function toSource(F){if(null!=F){try{return Xt.call(F)}catch(F){}try{return F+""}catch(F){}}return""}function updateWrapDetails(F,B){return arrayEach(Oe,(function(G){var W="_."+G[0];B&G[1]&&!arrayIncludes(F,W)&&F.push(W)})),F.sort()}function wrapperClone(F){if(F instanceof LazyWrapper)return F.clone();var B=new LodashWrapper(F.__wrapped__,F.__chain__);return B.__actions__=copyArray(F.__actions__),B.__index__=F.__index__,B.__values__=F.__values__,B}function chunk(F,B,W){B=(W?isIterateeCall(F,B,W):B===G)?1:xn(toInteger(B),0);var K=null==F?0:F.length;if(!K||B<1)return[];for(var J=0,Q=0,Y=z(bn(K/B));J<K;)Y[Q++]=baseSlice(F,J,J+=B);return Y}function compact(F){for(var B=-1,G=null==F?0:F.length,W=0,z=[];++B<G;){var K=F[B];K&&(z[W++]=K)}return z}function concat(){var F=arguments.length;if(!F)return[];for(var B=z(F-1),G=arguments[0],W=F;W--;)B[W-1]=arguments[W];return arrayPush(_r(G)?copyArray(G):[G],baseFlatten(B,1))}var Fi=baseRest((function(F,B){return isArrayLikeObject(F)?baseDifference(F,baseFlatten(B,1,isArrayLikeObject,!0)):[]})),xi=baseRest((function(F,B){var W=last(B);return isArrayLikeObject(W)&&(W=G),isArrayLikeObject(F)?baseDifference(F,baseFlatten(B,1,isArrayLikeObject,!0),getIteratee(W,2)):[]})),Ui=baseRest((function(F,B){var W=last(B);return isArrayLikeObject(W)&&(W=G),isArrayLikeObject(F)?baseDifference(F,baseFlatten(B,1,isArrayLikeObject,!0),G,W):[]}));function drop(F,B,W){var z=null==F?0:F.length;return z?baseSlice(F,(B=W||B===G?1:toInteger(B))<0?0:B,z):[]}function dropRight(F,B,W){var z=null==F?0:F.length;return z?baseSlice(F,0,(B=z-(B=W||B===G?1:toInteger(B)))<0?0:B):[]}function dropRightWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3),!0,!0):[]}function dropWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3),!0):[]}function fill(F,B,G,W){var z=null==F?0:F.length;return z?(G&&"number"!=typeof G&&isIterateeCall(F,B,G)&&(G=0,W=z),baseFill(F,B,G,W)):[]}function findIndex(F,B,G){var W=null==F?0:F.length;if(!W)return-1;var z=null==G?0:toInteger(G);return z<0&&(z=xn(W+z,0)),baseFindIndex(F,getIteratee(B,3),z)}function findLastIndex(F,B,W){var z=null==F?0:F.length;if(!z)return-1;var K=z-1;return W!==G&&(K=toInteger(W),K=W<0?xn(z+K,0):Un(K,z-1)),baseFindIndex(F,getIteratee(B,3),K,!0)}function flatten(F){return(null==F?0:F.length)?baseFlatten(F,1):[]}function flattenDeep(F){return(null==F?0:F.length)?baseFlatten(F,Te):[]}function flattenDepth(F,B){return(null==F?0:F.length)?baseFlatten(F,B=B===G?1:toInteger(B)):[]}function fromPairs(F){for(var B=-1,G=null==F?0:F.length,W={};++B<G;){var z=F[B];W[z[0]]=z[1]}return W}function head(F){return F&&F.length?F[0]:G}function indexOf(F,B,G){var W=null==F?0:F.length;if(!W)return-1;var z=null==G?0:toInteger(G);return z<0&&(z=xn(W+z,0)),baseIndexOf(F,B,z)}function initial(F){return(null==F?0:F.length)?baseSlice(F,0,-1):[]}var ji=baseRest((function(F){var B=arrayMap(F,castArrayLikeObject);return B.length&&B[0]===F[0]?baseIntersection(B):[]})),Bi=baseRest((function(F){var B=last(F),W=arrayMap(F,castArrayLikeObject);return B===last(W)?B=G:W.pop(),W.length&&W[0]===F[0]?baseIntersection(W,getIteratee(B,2)):[]})),Hi=baseRest((function(F){var B=last(F),W=arrayMap(F,castArrayLikeObject);return(B="function"==typeof B?B:G)&&W.pop(),W.length&&W[0]===F[0]?baseIntersection(W,G,B):[]}));function join(F,B){return null==F?"":Nn.call(F,B)}function last(F){var B=null==F?0:F.length;return B?F[B-1]:G}function lastIndexOf(F,B,W){var z=null==F?0:F.length;if(!z)return-1;var K=z;return W!==G&&(K=(K=toInteger(W))<0?xn(z+K,0):Un(K,z-1)),B==B?strictLastIndexOf(F,B,K):baseFindIndex(F,baseIsNaN,K,!0)}function nth(F,B){return F&&F.length?baseNth(F,toInteger(B)):G}var Vi=baseRest(pullAll);function pullAll(F,B){return F&&F.length&&B&&B.length?basePullAll(F,B):F}function pullAllBy(F,B,G){return F&&F.length&&B&&B.length?basePullAll(F,B,getIteratee(G,2)):F}function pullAllWith(F,B,W){return F&&F.length&&B&&B.length?basePullAll(F,B,G,W):F}var Gi=flatRest((function(F,B){var G=null==F?0:F.length,W=baseAt(F,B);return basePullAt(F,arrayMap(B,(function(F){return isIndex(F,G)?+F:F})).sort(compareAscending)),W}));function remove(F,B){var G=[];if(!F||!F.length)return G;var W=-1,z=[],K=F.length;for(B=getIteratee(B,3);++W<K;){var J=F[W];B(J,W,F)&&(G.push(J),z.push(W))}return basePullAt(F,z),G}function reverse(F){return null==F?F:Wn.call(F)}function slice(F,B,W){var z=null==F?0:F.length;return z?(W&&"number"!=typeof W&&isIterateeCall(F,B,W)?(B=0,W=z):(B=null==B?0:toInteger(B),W=W===G?z:toInteger(W)),baseSlice(F,B,W)):[]}function sortedIndex(F,B){return baseSortedIndex(F,B)}function sortedIndexBy(F,B,G){return baseSortedIndexBy(F,B,getIteratee(G,2))}function sortedIndexOf(F,B){var G=null==F?0:F.length;if(G){var W=baseSortedIndex(F,B);if(W<G&&eq(F[W],B))return W}return-1}function sortedLastIndex(F,B){return baseSortedIndex(F,B,!0)}function sortedLastIndexBy(F,B,G){return baseSortedIndexBy(F,B,getIteratee(G,2),!0)}function sortedLastIndexOf(F,B){if(null==F?0:F.length){var G=baseSortedIndex(F,B,!0)-1;if(eq(F[G],B))return G}return-1}function sortedUniq(F){return F&&F.length?baseSortedUniq(F):[]}function sortedUniqBy(F,B){return F&&F.length?baseSortedUniq(F,getIteratee(B,2)):[]}function tail(F){var B=null==F?0:F.length;return B?baseSlice(F,1,B):[]}function take(F,B,W){return F&&F.length?baseSlice(F,0,(B=W||B===G?1:toInteger(B))<0?0:B):[]}function takeRight(F,B,W){var z=null==F?0:F.length;return z?baseSlice(F,(B=z-(B=W||B===G?1:toInteger(B)))<0?0:B,z):[]}function takeRightWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3),!1,!0):[]}function takeWhile(F,B){return F&&F.length?baseWhile(F,getIteratee(B,3)):[]}var Wi=baseRest((function(F){return baseUniq(baseFlatten(F,1,isArrayLikeObject,!0))})),qi=baseRest((function(F){var B=last(F);return isArrayLikeObject(B)&&(B=G),baseUniq(baseFlatten(F,1,isArrayLikeObject,!0),getIteratee(B,2))})),zi=baseRest((function(F){var B=last(F);return B="function"==typeof B?B:G,baseUniq(baseFlatten(F,1,isArrayLikeObject,!0),G,B)}));function uniq(F){return F&&F.length?baseUniq(F):[]}function uniqBy(F,B){return F&&F.length?baseUniq(F,getIteratee(B,2)):[]}function uniqWith(F,B){return B="function"==typeof B?B:G,F&&F.length?baseUniq(F,G,B):[]}function unzip(F){if(!F||!F.length)return[];var B=0;return F=arrayFilter(F,(function(F){if(isArrayLikeObject(F))return B=xn(F.length,B),!0})),baseTimes(B,(function(B){return arrayMap(F,baseProperty(B))}))}function unzipWith(F,B){if(!F||!F.length)return[];var W=unzip(F);return null==B?W:arrayMap(W,(function(F){return apply(B,G,F)}))}var Ki=baseRest((function(F,B){return isArrayLikeObject(F)?baseDifference(F,B):[]})),Ji=baseRest((function(F){return baseXor(arrayFilter(F,isArrayLikeObject))})),Qi=baseRest((function(F){var B=last(F);return isArrayLikeObject(B)&&(B=G),baseXor(arrayFilter(F,isArrayLikeObject),getIteratee(B,2))})),Yi=baseRest((function(F){var B=last(F);return B="function"==typeof B?B:G,baseXor(arrayFilter(F,isArrayLikeObject),G,B)})),$i=baseRest(unzip);function zipObject(F,B){return baseZipObject(F||[],B||[],assignValue)}function zipObjectDeep(F,B){return baseZipObject(F||[],B||[],baseSet)}var Xi=baseRest((function(F){var B=F.length,W=B>1?F[B-1]:G;return W="function"==typeof W?(F.pop(),W):G,unzipWith(F,W)}));function chain(F){var B=lodash(F);return B.__chain__=!0,B}function tap(F,B){return B(F),F}function thru(F,B){return B(F)}var Zi=flatRest((function(F){var B=F.length,W=B?F[0]:0,z=this.__wrapped__,interceptor=function(B){return baseAt(B,F)};return!(B>1||this.__actions__.length)&&z instanceof LazyWrapper&&isIndex(W)?((z=z.slice(W,+W+(B?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:G}),new LodashWrapper(z,this.__chain__).thru((function(F){return B&&!F.length&&F.push(G),F}))):this.thru(interceptor)}));function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){this.__values__===G&&(this.__values__=toArray(this.value()));var F=this.__index__>=this.__values__.length;return{done:F,value:F?G:this.__values__[this.__index__++]}}function wrapperToIterator(){return this}function wrapperPlant(F){for(var B,W=this;W instanceof baseLodash;){var z=wrapperClone(W);z.__index__=0,z.__values__=G,B?K.__wrapped__=z:B=z;var K=z;W=W.__wrapped__}return K.__wrapped__=F,B}function wrapperReverse(){var F=this.__wrapped__;if(F instanceof LazyWrapper){var B=F;return this.__actions__.length&&(B=new LazyWrapper(this)),(B=B.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:G}),new LodashWrapper(B,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var er=createAggregator((function(F,B,G){Zt.call(F,G)?++F[G]:baseAssignValue(F,G,1)}));function every(F,B,W){var z=_r(F)?arrayEvery:baseEvery;return W&&isIterateeCall(F,B,W)&&(B=G),z(F,getIteratee(B,3))}function filter(F,B){return(_r(F)?arrayFilter:baseFilter)(F,getIteratee(B,3))}var tr=createFind(findIndex),nr=createFind(findLastIndex);function flatMap(F,B){return baseFlatten(map(F,B),1)}function flatMapDeep(F,B){return baseFlatten(map(F,B),Te)}function flatMapDepth(F,B,W){return W=W===G?1:toInteger(W),baseFlatten(map(F,B),W)}function forEach(F,B){return(_r(F)?arrayEach:yi)(F,getIteratee(B,3))}function forEachRight(F,B){return(_r(F)?arrayEachRight:Si)(F,getIteratee(B,3))}var ir=createAggregator((function(F,B,G){Zt.call(F,G)?F[G].push(B):baseAssignValue(F,G,[B])}));function includes(F,B,G,W){F=isArrayLike(F)?F:values(F),G=G&&!W?toInteger(G):0;var z=F.length;return G<0&&(G=xn(z+G,0)),isString(F)?G<=z&&F.indexOf(B,G)>-1:!!z&&baseIndexOf(F,B,G)>-1}var rr=baseRest((function(F,B,G){var W=-1,K="function"==typeof B,J=isArrayLike(F)?z(F.length):[];return yi(F,(function(F){J[++W]=K?apply(B,F,G):baseInvoke(F,B,G)})),J})),or=createAggregator((function(F,B,G){baseAssignValue(F,G,B)}));function map(F,B){return(_r(F)?arrayMap:baseMap)(F,getIteratee(B,3))}function orderBy(F,B,W,z){return null==F?[]:(_r(B)||(B=null==B?[]:[B]),_r(W=z?G:W)||(W=null==W?[]:[W]),baseOrderBy(F,B,W))}var ar=createAggregator((function(F,B,G){F[G?0:1].push(B)}),(function(){return[[],[]]}));function reduce(F,B,G){var W=_r(F)?arrayReduce:baseReduce,z=arguments.length<3;return W(F,getIteratee(B,4),G,z,yi)}function reduceRight(F,B,G){var W=_r(F)?arrayReduceRight:baseReduce,z=arguments.length<3;return W(F,getIteratee(B,4),G,z,Si)}function reject(F,B){return(_r(F)?arrayFilter:baseFilter)(F,negate(getIteratee(B,3)))}function sample(F){return(_r(F)?arraySample:baseSample)(F)}function sampleSize(F,B,W){return B=(W?isIterateeCall(F,B,W):B===G)?1:toInteger(B),(_r(F)?arraySampleSize:baseSampleSize)(F,B)}function shuffle(F){return(_r(F)?arrayShuffle:baseShuffle)(F)}function size(F){if(null==F)return 0;if(isArrayLike(F))return isString(F)?stringSize(F):F.length;var B=Mi(F);return B==je||B==ze?F.size:baseKeys(F).length}function some(F,B,W){var z=_r(F)?arraySome:baseSome;return W&&isIterateeCall(F,B,W)&&(B=G),z(F,getIteratee(B,3))}var sr=baseRest((function(F,B){if(null==F)return[];var G=B.length;return G>1&&isIterateeCall(F,B[0],B[1])?B=[]:G>2&&isIterateeCall(B[0],B[1],B[2])&&(B=[B[0]]),baseOrderBy(F,baseFlatten(B,1),[])})),cr=_n||function(){return jn.Date.now()};function after(F,B){if("function"!=typeof B)throw new Kt(Q);return F=toInteger(F),function(){if(--F<1)return B.apply(this,arguments)}}function ary(F,B,W){return B=W?G:B,B=F&&null==B?F.length:B,createWrap(F,pe,G,G,G,G,B)}function before(F,B){var W;if("function"!=typeof B)throw new Kt(Q);return F=toInteger(F),function(){return--F>0&&(W=B.apply(this,arguments)),F<=1&&(B=G),W}}var lr=baseRest((function(F,B,G){var W=oe;if(G.length){var z=replaceHolders(G,getHolder(lr));W|=de}return createWrap(F,W,B,G,z)})),dr=baseRest((function(F,B,G){var W=oe|ae;if(G.length){var z=replaceHolders(G,getHolder(dr));W|=de}return createWrap(B,W,F,G,z)}));function curry(F,B,W){var z=createWrap(F,ce,G,G,G,G,G,B=W?G:B);return z.placeholder=curry.placeholder,z}function curryRight(F,B,W){var z=createWrap(F,le,G,G,G,G,G,B=W?G:B);return z.placeholder=curryRight.placeholder,z}function debounce(F,B,W){var z,K,J,Y,$,X,Z=0,ee=!1,te=!1,ne=!0;if("function"!=typeof F)throw new Kt(Q);function invokeFunc(B){var W=z,J=K;return z=K=G,Z=B,Y=F.apply(J,W)}function leadingEdge(F){return Z=F,$=Ni(timerExpired,B),ee?invokeFunc(F):Y}function remainingWait(F){var G=B-(F-X);return te?Un(G,J-(F-Z)):G}function shouldInvoke(F){var W=F-X;return X===G||W>=B||W<0||te&&F-Z>=J}function timerExpired(){var F=cr();if(shouldInvoke(F))return trailingEdge(F);$=Ni(timerExpired,remainingWait(F))}function trailingEdge(F){return $=G,ne&&z?invokeFunc(F):(z=K=G,Y)}function cancel(){$!==G&&Ii($),Z=0,z=X=K=$=G}function flush(){return $===G?Y:trailingEdge(cr())}function debounced(){var F=cr(),W=shouldInvoke(F);if(z=arguments,K=this,X=F,W){if($===G)return leadingEdge(X);if(te)return Ii($),$=Ni(timerExpired,B),invokeFunc(X)}return $===G&&($=Ni(timerExpired,B)),Y}return B=toNumber(B)||0,isObject(W)&&(ee=!!W.leading,J=(te="maxWait"in W)?xn(toNumber(W.maxWait)||0,B):J,ne="trailing"in W?!!W.trailing:ne),debounced.cancel=cancel,debounced.flush=flush,debounced}var ur=baseRest((function(F,B){return baseDelay(F,1,B)})),pr=baseRest((function(F,B,G){return baseDelay(F,toNumber(B)||0,G)}));function flip(F){return createWrap(F,ge)}function memoize(F,B){if("function"!=typeof F||null!=B&&"function"!=typeof B)throw new Kt(Q);var memoized=function(){var G=arguments,W=B?B.apply(this,G):G[0],z=memoized.cache;if(z.has(W))return z.get(W);var K=F.apply(this,G);return memoized.cache=z.set(W,K)||z,K};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(F){if("function"!=typeof F)throw new Kt(Q);return function(){var B=arguments;switch(B.length){case 0:return!F.call(this);case 1:return!F.call(this,B[0]);case 2:return!F.call(this,B[0],B[1]);case 3:return!F.call(this,B[0],B[1],B[2])}return!F.apply(this,B)}}function once(F){return before(2,F)}memoize.Cache=MapCache;var hr=bi((function(F,B){var G=(B=1==B.length&&_r(B[0])?arrayMap(B[0],baseUnary(getIteratee())):arrayMap(baseFlatten(B,1),baseUnary(getIteratee()))).length;return baseRest((function(W){for(var z=-1,K=Un(W.length,G);++z<K;)W[z]=B[z].call(this,W[z]);return apply(F,this,W)}))})),gr=baseRest((function(F,B){var W=replaceHolders(B,getHolder(gr));return createWrap(F,de,G,B,W)})),fr=baseRest((function(F,B){var W=replaceHolders(B,getHolder(fr));return createWrap(F,ue,G,B,W)})),mr=flatRest((function(F,B){return createWrap(F,he,G,G,G,B)}));function rest(F,B){if("function"!=typeof F)throw new Kt(Q);return baseRest(F,B=B===G?B:toInteger(B))}function spread(F,B){if("function"!=typeof F)throw new Kt(Q);return B=null==B?0:xn(toInteger(B),0),baseRest((function(G){var W=G[B],z=castSlice(G,0,B);return W&&arrayPush(z,W),apply(F,this,z)}))}function throttle(F,B,G){var W=!0,z=!0;if("function"!=typeof F)throw new Kt(Q);return isObject(G)&&(W="leading"in G?!!G.leading:W,z="trailing"in G?!!G.trailing:z),debounce(F,B,{leading:W,maxWait:B,trailing:z})}function unary(F){return ary(F,1)}function wrap(F,B){return gr(castFunction(B),F)}function castArray(){if(!arguments.length)return[];var F=arguments[0];return _r(F)?F:[F]}function clone(F){return baseClone(F,ne)}function cloneWith(F,B){return baseClone(F,ne,B="function"==typeof B?B:G)}function cloneDeep(F){return baseClone(F,ee|ne)}function cloneDeepWith(F,B){return baseClone(F,ee|ne,B="function"==typeof B?B:G)}function conformsTo(F,B){return null==B||baseConformsTo(F,B,keys(B))}function eq(F,B){return F===B||F!=F&&B!=B}var vr=createRelationalOperation(baseGt),yr=createRelationalOperation((function(F,B){return F>=B})),Sr=baseIsArguments(function(){return arguments}())?baseIsArguments:function(F){return isObjectLike(F)&&Zt.call(F,"callee")&&!hn.call(F,"callee")},_r=z.isArray,Cr=qn?baseUnary(qn):baseIsArrayBuffer;function isArrayLike(F){return null!=F&&isLength(F.length)&&!isFunction(F)}function isArrayLikeObject(F){return isObjectLike(F)&&isArrayLike(F)}function isBoolean(F){return!0===F||!1===F||isObjectLike(F)&&baseGetTag(F)==Ne}var Tr=wn||stubFalse,Er=zn?baseUnary(zn):baseIsDate;function isElement(F){return isObjectLike(F)&&1===F.nodeType&&!isPlainObject(F)}function isEmpty(F){if(null==F)return!0;if(isArrayLike(F)&&(_r(F)||"string"==typeof F||"function"==typeof F.splice||Tr(F)||Rr(F)||Sr(F)))return!F.length;var B=Mi(F);if(B==je||B==ze)return!F.size;if(isPrototype(F))return!baseKeys(F).length;for(var G in F)if(Zt.call(F,G))return!1;return!0}function isEqual(F,B){return baseIsEqual(F,B)}function isEqualWith(F,B,W){var z=(W="function"==typeof W?W:G)?W(F,B):G;return z===G?baseIsEqual(F,B,G,W):!!z}function isError(F){if(!isObjectLike(F))return!1;var B=baseGetTag(F);return B==Fe||B==ke||"string"==typeof F.message&&"string"==typeof F.name&&!isPlainObject(F)}function isFinite(F){return"number"==typeof F&&Dn(F)}function isFunction(F){if(!isObject(F))return!1;var B=baseGetTag(F);return B==xe||B==Ue||B==De||B==We}function isInteger(F){return"number"==typeof F&&F==toInteger(F)}function isLength(F){return"number"==typeof F&&F>-1&&F%1==0&&F<=Ee}function isObject(F){var B=typeof F;return null!=F&&("object"==B||"function"==B)}function isObjectLike(F){return null!=F&&"object"==typeof F}var br=Kn?baseUnary(Kn):baseIsMap;function isMatch(F,B){return F===B||baseIsMatch(F,B,getMatchData(B))}function isMatchWith(F,B,W){return W="function"==typeof W?W:G,baseIsMatch(F,B,getMatchData(B),W)}function isNaN(F){return isNumber(F)&&F!=+F}function isNative(F){if(wi(F))throw new Ot(J);return baseIsNative(F)}function isNull(F){return null===F}function isNil(F){return null==F}function isNumber(F){return"number"==typeof F||isObjectLike(F)&&baseGetTag(F)==Be}function isPlainObject(F){if(!isObjectLike(F)||baseGetTag(F)!=Ve)return!1;var B=un(F);if(null===B)return!0;var G=Zt.call(B,"constructor")&&B.constructor;return"function"==typeof G&&G instanceof G&&Xt.call(G)==rn}var Ir=Jn?baseUnary(Jn):baseIsRegExp;function isSafeInteger(F){return isInteger(F)&&F>=-Ee&&F<=Ee}var Ar=Qn?baseUnary(Qn):baseIsSet;function isString(F){return"string"==typeof F||!_r(F)&&isObjectLike(F)&&baseGetTag(F)==Ke}function isSymbol(F){return"symbol"==typeof F||isObjectLike(F)&&baseGetTag(F)==Je}var Rr=Yn?baseUnary(Yn):baseIsTypedArray;function isUndefined(F){return F===G}function isWeakMap(F){return isObjectLike(F)&&Mi(F)==Ye}function isWeakSet(F){return isObjectLike(F)&&baseGetTag(F)==$e}var Pr=createRelationalOperation(baseLt),Or=createRelationalOperation((function(F,B){return F<=B}));function toArray(F){if(!F)return[];if(isArrayLike(F))return isString(F)?stringToArray(F):copyArray(F);if(mn&&F[mn])return iteratorToArray(F[mn]());var B=Mi(F);return(B==je?mapToArray:B==ze?setToArray:values)(F)}function toFinite(F){return F?(F=toNumber(F))===Te||F===-Te?(F<0?-1:1)*be:F==F?F:0:0===F?F:0}function toInteger(F){var B=toFinite(F),G=B%1;return B==B?G?B-G:B:0}function toLength(F){return F?baseClamp(toInteger(F),0,Ae):0}function toNumber(F){if("number"==typeof F)return F;if(isSymbol(F))return Ie;if(isObject(F)){var B="function"==typeof F.valueOf?F.valueOf():F;F=isObject(B)?B+"":B}if("string"!=typeof F)return 0===F?F:+F;F=baseTrim(F);var G=kt.test(F);return G||xt.test(F)?Fn(F.slice(2),G?2:8):Lt.test(F)?Ie:+F}function toPlainObject(F){return copyObject(F,keysIn(F))}function toSafeInteger(F){return F?baseClamp(toInteger(F),-Ee,Ee):0===F?F:0}function toString(F){return null==F?"":baseToString(F)}var Mr=createAssigner((function(F,B){if(isPrototype(B)||isArrayLike(B))copyObject(B,keys(B),F);else for(var G in B)Zt.call(B,G)&&assignValue(F,G,B[G])})),wr=createAssigner((function(F,B){copyObject(B,keysIn(B),F)})),Dr=createAssigner((function(F,B,G,W){copyObject(B,keysIn(B),F,W)})),Nr=createAssigner((function(F,B,G,W){copyObject(B,keys(B),F,W)})),Lr=flatRest(baseAt);function create(F,B){var G=vi(F);return null==B?G:baseAssign(G,B)}var kr=baseRest((function(F,B){F=Wt(F);var W=-1,z=B.length,K=z>2?B[2]:G;for(K&&isIterateeCall(B[0],B[1],K)&&(z=1);++W<z;)for(var J=B[W],Q=keysIn(J),Y=-1,$=Q.length;++Y<$;){var X=Q[Y],Z=F[X];(Z===G||eq(Z,Yt[X])&&!Zt.call(F,X))&&(F[X]=J[X])}return F})),Fr=baseRest((function(F){return F.push(G,customDefaultsMerge),apply(Hr,G,F)}));function findKey(F,B){return baseFindKey(F,getIteratee(B,3),baseForOwn)}function findLastKey(F,B){return baseFindKey(F,getIteratee(B,3),baseForOwnRight)}function forIn(F,B){return null==F?F:_i(F,getIteratee(B,3),keysIn)}function forInRight(F,B){return null==F?F:Ci(F,getIteratee(B,3),keysIn)}function forOwn(F,B){return F&&baseForOwn(F,getIteratee(B,3))}function forOwnRight(F,B){return F&&baseForOwnRight(F,getIteratee(B,3))}function functions(F){return null==F?[]:baseFunctions(F,keys(F))}function functionsIn(F){return null==F?[]:baseFunctions(F,keysIn(F))}function get(F,B,W){var z=null==F?G:baseGet(F,B);return z===G?W:z}function has(F,B){return null!=F&&hasPath(F,B,baseHas)}function hasIn(F,B){return null!=F&&hasPath(F,B,baseHasIn)}var xr=createInverter((function(F,B,G){null!=B&&"function"!=typeof B.toString&&(B=nn.call(B)),F[B]=G}),constant(identity)),Ur=createInverter((function(F,B,G){null!=B&&"function"!=typeof B.toString&&(B=nn.call(B)),Zt.call(F,B)?F[B].push(G):F[B]=[G]}),getIteratee),jr=baseRest(baseInvoke);function keys(F){return isArrayLike(F)?arrayLikeKeys(F):baseKeys(F)}function keysIn(F){return isArrayLike(F)?arrayLikeKeys(F,!0):baseKeysIn(F)}function mapKeys(F,B){var G={};return B=getIteratee(B,3),baseForOwn(F,(function(F,W,z){baseAssignValue(G,B(F,W,z),F)})),G}function mapValues(F,B){var G={};return B=getIteratee(B,3),baseForOwn(F,(function(F,W,z){baseAssignValue(G,W,B(F,W,z))})),G}var Br=createAssigner((function(F,B,G){baseMerge(F,B,G)})),Hr=createAssigner((function(F,B,G,W){baseMerge(F,B,G,W)})),Vr=flatRest((function(F,B){var G={};if(null==F)return G;var W=!1;B=arrayMap(B,(function(B){return B=castPath(B,F),W||(W=B.length>1),B})),copyObject(F,getAllKeysIn(F),G),W&&(G=baseClone(G,ee|te|ne,customOmitClone));for(var z=B.length;z--;)baseUnset(G,B[z]);return G}));function omitBy(F,B){return pickBy(F,negate(getIteratee(B)))}var Gr=flatRest((function(F,B){return null==F?{}:basePick(F,B)}));function pickBy(F,B){if(null==F)return{};var G=arrayMap(getAllKeysIn(F),(function(F){return[F]}));return B=getIteratee(B),basePickBy(F,G,(function(F,G){return B(F,G[0])}))}function result(F,B,W){var z=-1,K=(B=castPath(B,F)).length;for(K||(K=1,F=G);++z<K;){var J=null==F?G:F[toKey(B[z])];J===G&&(z=K,J=W),F=isFunction(J)?J.call(F):J}return F}function set(F,B,G){return null==F?F:baseSet(F,B,G)}function setWith(F,B,W,z){return z="function"==typeof z?z:G,null==F?F:baseSet(F,B,W,z)}var Wr=createToPairs(keys),qr=createToPairs(keysIn);function transform(F,B,G){var W=_r(F),z=W||Tr(F)||Rr(F);if(B=getIteratee(B,4),null==G){var K=F&&F.constructor;G=z?W?new K:[]:isObject(F)&&isFunction(K)?vi(un(F)):{}}return(z?arrayEach:baseForOwn)(F,(function(F,W,z){return B(G,F,W,z)})),G}function unset(F,B){return null==F||baseUnset(F,B)}function update(F,B,G){return null==F?F:baseUpdate(F,B,castFunction(G))}function updateWith(F,B,W,z){return z="function"==typeof z?z:G,null==F?F:baseUpdate(F,B,castFunction(W),z)}function values(F){return null==F?[]:baseValues(F,keys(F))}function valuesIn(F){return null==F?[]:baseValues(F,keysIn(F))}function clamp(F,B,W){return W===G&&(W=B,B=G),W!==G&&(W=(W=toNumber(W))==W?W:0),B!==G&&(B=(B=toNumber(B))==B?B:0),baseClamp(toNumber(F),B,W)}function inRange(F,B,W){return B=toFinite(B),W===G?(W=B,B=0):W=toFinite(W),baseInRange(F=toNumber(F),B,W)}function random(F,B,W){if(W&&"boolean"!=typeof W&&isIterateeCall(F,B,W)&&(B=W=G),W===G&&("boolean"==typeof B?(W=B,B=G):"boolean"==typeof F&&(W=F,F=G)),F===G&&B===G?(F=0,B=1):(F=toFinite(F),B===G?(B=F,F=0):B=toFinite(B)),F>B){var z=F;F=B,B=z}if(W||F%1||B%1){var K=Gn();return Un(F+K*(B-F+kn("1e-"+((K+"").length-1))),B)}return baseRandom(F,B)}var zr=createCompounder((function(F,B,G){return B=B.toLowerCase(),F+(G?capitalize(B):B)}));function capitalize(F){return Zr(toString(F).toLowerCase())}function deburr(F){return(F=toString(F))&&F.replace(jt,Xn).replace(Tn,"")}function endsWith(F,B,W){F=toString(F),B=baseToString(B);var z=F.length,K=W=W===G?z:baseClamp(toInteger(W),0,z);return(W-=B.length)>=0&&F.slice(W,K)==B}function escape(F){return(F=toString(F))&&ft.test(F)?F.replace(ht,Zn):F}function escapeRegExp(F){return(F=toString(F))&&Et.test(F)?F.replace(Tt,"\\$&"):F}var Kr=createCompounder((function(F,B,G){return F+(G?"-":"")+B.toLowerCase()})),Jr=createCompounder((function(F,B,G){return F+(G?" ":"")+B.toLowerCase()})),Qr=createCaseFirst("toLowerCase");function pad(F,B,G){F=toString(F);var W=(B=toInteger(B))?stringSize(F):0;if(!B||W>=B)return F;var z=(B-W)/2;return createPadding(In(z),G)+F+createPadding(bn(z),G)}function padEnd(F,B,G){F=toString(F);var W=(B=toInteger(B))?stringSize(F):0;return B&&W<B?F+createPadding(B-W,G):F}function padStart(F,B,G){F=toString(F);var W=(B=toInteger(B))?stringSize(F):0;return B&&W<B?createPadding(B-W,G)+F:F}function parseInt(F,B,G){return G||null==B?B=0:B&&(B=+B),Hn(toString(F).replace(bt,""),B||0)}function repeat(F,B,W){return B=(W?isIterateeCall(F,B,W):B===G)?1:toInteger(B),baseRepeat(toString(F),B)}function replace(){var F=arguments,B=toString(F[0]);return F.length<3?B:B.replace(F[1],F[2])}var Yr=createCompounder((function(F,B,G){return F+(G?"_":"")+B.toLowerCase()}));function split(F,B,W){return W&&"number"!=typeof W&&isIterateeCall(F,B,W)&&(B=W=G),(W=W===G?Ae:W>>>0)?(F=toString(F))&&("string"==typeof B||null!=B&&!Ir(B))&&!(B=baseToString(B))&&hasUnicode(F)?castSlice(stringToArray(F),0,W):F.split(B,W):[]}var $r=createCompounder((function(F,B,G){return F+(G?" ":"")+Zr(B)}));function startsWith(F,B,G){return F=toString(F),G=null==G?0:baseClamp(toInteger(G),0,F.length),B=baseToString(B),F.slice(G,G+B.length)==B}function template(F,B,W){var z=lodash.templateSettings;W&&isIterateeCall(F,B,W)&&(B=G),F=toString(F),B=Dr({},B,z,customDefaultsAssignIn);var K,J,Q=Dr({},B.imports,z.imports,customDefaultsAssignIn),$=keys(Q),X=baseValues(Q,$),Z=0,ee=B.interpolate||Bt,te="__p += '",ne=qt((B.escape||Bt).source+"|"+ee.source+"|"+(ee===yt?Dt:Bt).source+"|"+(B.evaluate||Bt).source+"|$","g"),ie="//# sourceURL="+(Zt.call(B,"sourceURL")?(B.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Pn+"]")+"\n";F.replace(ne,(function(B,G,W,z,Q,Y){return W||(W=z),te+=F.slice(Z,Y).replace(Ht,escapeStringChar),G&&(K=!0,te+="' +\n__e("+G+") +\n'"),Q&&(J=!0,te+="';\n"+Q+";\n__p += '"),W&&(te+="' +\n((__t = ("+W+")) == null ? '' : __t) +\n'"),Z=Y+B.length,B})),te+="';\n";var re=Zt.call(B,"variable")&&B.variable;if(re){if(Mt.test(re))throw new Ot(Y)}else te="with (obj) {\n"+te+"\n}\n";te=(J?te.replace(lt,""):te).replace(dt,"$1").replace(ut,"$1;"),te="function("+(re||"obj")+") {\n"+(re?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(K?", __e = _.escape":"")+(J?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+te+"return __p\n}";var oe=eo((function(){return Vt($,ie+"return "+te).apply(G,X)}));if(oe.source=te,isError(oe))throw oe;return oe}function toLower(F){return toString(F).toLowerCase()}function toUpper(F){return toString(F).toUpperCase()}function trim(F,B,W){if((F=toString(F))&&(W||B===G))return baseTrim(F);if(!F||!(B=baseToString(B)))return F;var z=stringToArray(F),K=stringToArray(B);return castSlice(z,charsStartIndex(z,K),charsEndIndex(z,K)+1).join("")}function trimEnd(F,B,W){if((F=toString(F))&&(W||B===G))return F.slice(0,trimmedEndIndex(F)+1);if(!F||!(B=baseToString(B)))return F;var z=stringToArray(F);return castSlice(z,0,charsEndIndex(z,stringToArray(B))+1).join("")}function trimStart(F,B,W){if((F=toString(F))&&(W||B===G))return F.replace(bt,"");if(!F||!(B=baseToString(B)))return F;var z=stringToArray(F);return castSlice(z,charsStartIndex(z,stringToArray(B))).join("")}function truncate(F,B){var W=fe,z=me;if(isObject(B)){var K="separator"in B?B.separator:K;W="length"in B?toInteger(B.length):W,z="omission"in B?baseToString(B.omission):z}var J=(F=toString(F)).length;if(hasUnicode(F)){var Q=stringToArray(F);J=Q.length}if(W>=J)return F;var Y=W-stringSize(z);if(Y<1)return z;var $=Q?castSlice(Q,0,Y).join(""):F.slice(0,Y);if(K===G)return $+z;if(Q&&(Y+=$.length-Y),Ir(K)){if(F.slice(Y).search(K)){var X,Z=$;for(K.global||(K=qt(K.source,toString(Nt.exec(K))+"g")),K.lastIndex=0;X=K.exec(Z);)var ee=X.index;$=$.slice(0,ee===G?Y:ee)}}else if(F.indexOf(baseToString(K),Y)!=Y){var te=$.lastIndexOf(K);te>-1&&($=$.slice(0,te))}return $+z}function unescape(F){return(F=toString(F))&&gt.test(F)?F.replace(pt,ei):F}var Xr=createCompounder((function(F,B,G){return F+(G?" ":"")+B.toUpperCase()})),Zr=createCaseFirst("toUpperCase");function words(F,B,W){return F=toString(F),(B=W?G:B)===G?hasUnicodeWord(F)?unicodeWords(F):asciiWords(F):F.match(B)||[]}var eo=baseRest((function(F,B){try{return apply(F,G,B)}catch(F){return isError(F)?F:new Ot(F)}})),to=flatRest((function(F,B){return arrayEach(B,(function(B){B=toKey(B),baseAssignValue(F,B,lr(F[B],F))})),F}));function cond(F){var B=null==F?0:F.length,G=getIteratee();return F=B?arrayMap(F,(function(F){if("function"!=typeof F[1])throw new Kt(Q);return[G(F[0]),F[1]]})):[],baseRest((function(G){for(var W=-1;++W<B;){var z=F[W];if(apply(z[0],this,G))return apply(z[1],this,G)}}))}function conforms(F){return baseConforms(baseClone(F,ee))}function constant(F){return function(){return F}}function defaultTo(F,B){return null==F||F!=F?B:F}var no=createFlow(),io=createFlow(!0);function identity(F){return F}function iteratee(F){return baseIteratee("function"==typeof F?F:baseClone(F,ee))}function matches(F){return baseMatches(baseClone(F,ee))}function matchesProperty(F,B){return baseMatchesProperty(F,baseClone(B,ee))}var ro=baseRest((function(F,B){return function(G){return baseInvoke(G,F,B)}})),oo=baseRest((function(F,B){return function(G){return baseInvoke(F,G,B)}}));function mixin(F,B,G){var W=keys(B),z=baseFunctions(B,W);null!=G||isObject(B)&&(z.length||!W.length)||(G=B,B=F,F=this,z=baseFunctions(B,keys(B)));var K=!(isObject(G)&&"chain"in G&&!G.chain),J=isFunction(F);return arrayEach(z,(function(G){var W=B[G];F[G]=W,J&&(F.prototype[G]=function(){var B=this.__chain__;if(K||B){var G=F(this.__wrapped__);return(G.__actions__=copyArray(this.__actions__)).push({func:W,args:arguments,thisArg:F}),G.__chain__=B,G}return W.apply(F,arrayPush([this.value()],arguments))})})),F}function noConflict(){return jn._===this&&(jn._=on),this}function noop(){}function nthArg(F){return F=toInteger(F),baseRest((function(B){return baseNth(B,F)}))}var ao=createOver(arrayMap),so=createOver(arrayEvery),co=createOver(arraySome);function property(F){return isKey(F)?baseProperty(toKey(F)):basePropertyDeep(F)}function propertyOf(F){return function(B){return null==F?G:baseGet(F,B)}}var lo=createRange(),uo=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return!0}function times(F,B){if((F=toInteger(F))<1||F>Ee)return[];var G=Ae,W=Un(F,Ae);B=getIteratee(B),F-=Ae;for(var z=baseTimes(W,B);++G<F;)B(G);return z}function toPath(F){return _r(F)?arrayMap(F,toKey):isSymbol(F)?[F]:copyArray(ki(toString(F)))}function uniqueId(F){var B=++en;return toString(F)+B}var po=createMathOperation((function(F,B){return F+B}),0),ho=createRound("ceil"),go=createMathOperation((function(F,B){return F/B}),1),fo=createRound("floor");function max(F){return F&&F.length?baseExtremum(F,identity,baseGt):G}function maxBy(F,B){return F&&F.length?baseExtremum(F,getIteratee(B,2),baseGt):G}function mean(F){return baseMean(F,identity)}function meanBy(F,B){return baseMean(F,getIteratee(B,2))}function min(F){return F&&F.length?baseExtremum(F,identity,baseLt):G}function minBy(F,B){return F&&F.length?baseExtremum(F,getIteratee(B,2),baseLt):G}var mo,vo=createMathOperation((function(F,B){return F*B}),1),yo=createRound("round"),So=createMathOperation((function(F,B){return F-B}),0);function sum(F){return F&&F.length?baseSum(F,identity):0}function sumBy(F,B){return F&&F.length?baseSum(F,getIteratee(B,2)):0}return lodash.after=after,lodash.ary=ary,lodash.assign=Mr,lodash.assignIn=wr,lodash.assignInWith=Dr,lodash.assignWith=Nr,lodash.at=Lr,lodash.before=before,lodash.bind=lr,lodash.bindAll=to,lodash.bindKey=dr,lodash.castArray=castArray,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.concat=concat,lodash.cond=cond,lodash.conforms=conforms,lodash.constant=constant,lodash.countBy=er,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=kr,lodash.defaultsDeep=Fr,lodash.defer=ur,lodash.delay=pr,lodash.difference=Fi,lodash.differenceBy=xi,lodash.differenceWith=Ui,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatMap=flatMap,lodash.flatMapDeep=flatMapDeep,lodash.flatMapDepth=flatMapDepth,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flattenDepth=flattenDepth,lodash.flip=flip,lodash.flow=no,lodash.flowRight=io,lodash.fromPairs=fromPairs,lodash.functions=functions,lodash.functionsIn=functionsIn,lodash.groupBy=ir,lodash.initial=initial,lodash.intersection=ji,lodash.intersectionBy=Bi,lodash.intersectionWith=Hi,lodash.invert=xr,lodash.invertBy=Ur,lodash.invokeMap=rr,lodash.iteratee=iteratee,lodash.keyBy=or,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=Br,lodash.mergeWith=Hr,lodash.method=ro,lodash.methodOf=oo,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=nthArg,lodash.omit=Vr,lodash.omitBy=omitBy,lodash.once=once,lodash.orderBy=orderBy,lodash.over=ao,lodash.overArgs=hr,lodash.overEvery=so,lodash.overSome=co,lodash.partial=gr,lodash.partialRight=fr,lodash.partition=ar,lodash.pick=Gr,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=Vi,lodash.pullAll=pullAll,lodash.pullAllBy=pullAllBy,lodash.pullAllWith=pullAllWith,lodash.pullAt=Gi,lodash.range=lo,lodash.rangeRight=uo,lodash.rearg=mr,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.reverse=reverse,lodash.sampleSize=sampleSize,lodash.set=set,lodash.setWith=setWith,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=sr,lodash.sortedUniq=sortedUniq,lodash.sortedUniqBy=sortedUniqBy,lodash.split=split,lodash.spread=spread,lodash.tail=tail,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=Wr,lodash.toPairsIn=qr,lodash.toPath=toPath,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.unary=unary,lodash.union=Wi,lodash.unionBy=qi,lodash.unionWith=zi,lodash.uniq=uniq,lodash.uniqBy=uniqBy,lodash.uniqWith=uniqWith,lodash.unset=unset,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=update,lodash.updateWith=updateWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.without=Ki,lodash.words=words,lodash.wrap=wrap,lodash.xor=Ji,lodash.xorBy=Qi,lodash.xorWith=Yi,lodash.zip=$i,lodash.zipObject=zipObject,lodash.zipObjectDeep=zipObjectDeep,lodash.zipWith=Xi,lodash.entries=Wr,lodash.entriesIn=qr,lodash.extend=wr,lodash.extendWith=Dr,mixin(lodash,lodash),lodash.add=po,lodash.attempt=eo,lodash.camelCase=zr,lodash.capitalize=capitalize,lodash.ceil=ho,lodash.clamp=clamp,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.cloneDeepWith=cloneDeepWith,lodash.cloneWith=cloneWith,lodash.conformsTo=conformsTo,lodash.deburr=deburr,lodash.defaultTo=defaultTo,lodash.divide=go,lodash.endsWith=endsWith,lodash.eq=eq,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=tr,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=nr,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.floor=fo,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.get=get,lodash.gt=vr,lodash.gte=yr,lodash.has=has,lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.invoke=jr,lodash.isArguments=Sr,lodash.isArray=_r,lodash.isArrayBuffer=Cr,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=isBoolean,lodash.isBuffer=Tr,lodash.isDate=Er,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isEqualWith=isEqualWith,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=br,lodash.isMatch=isMatch,lodash.isMatchWith=isMatchWith,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNil=isNil,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=Ir,lodash.isSafeInteger=isSafeInteger,lodash.isSet=Ar,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=Rr,lodash.isUndefined=isUndefined,lodash.isWeakMap=isWeakMap,lodash.isWeakSet=isWeakSet,lodash.join=join,lodash.kebabCase=Kr,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lowerCase=Jr,lodash.lowerFirst=Qr,lodash.lt=Pr,lodash.lte=Or,lodash.max=max,lodash.maxBy=maxBy,lodash.mean=mean,lodash.meanBy=meanBy,lodash.min=min,lodash.minBy=minBy,lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=stubObject,lodash.stubString=stubString,lodash.stubTrue=stubTrue,lodash.multiply=vo,lodash.nth=nth,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=cr,lodash.pad=pad,lodash.padEnd=padEnd,lodash.padStart=padStart,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.replace=replace,lodash.result=result,lodash.round=yo,lodash.runInContext=runInContext,lodash.sample=sample,lodash.size=size,lodash.snakeCase=Yr,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedIndexBy=sortedIndexBy,lodash.sortedIndexOf=sortedIndexOf,lodash.sortedLastIndex=sortedLastIndex,lodash.sortedLastIndexBy=sortedLastIndexBy,lodash.sortedLastIndexOf=sortedLastIndexOf,lodash.startCase=$r,lodash.startsWith=startsWith,lodash.subtract=So,lodash.sum=sum,lodash.sumBy=sumBy,lodash.template=template,lodash.times=times,lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=toLower,lodash.toNumber=toNumber,lodash.toSafeInteger=toSafeInteger,lodash.toString=toString,lodash.toUpper=toUpper,lodash.trim=trim,lodash.trimEnd=trimEnd,lodash.trimStart=trimStart,lodash.truncate=truncate,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.upperCase=Xr,lodash.upperFirst=Zr,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(mo={},baseForOwn(lodash,(function(F,B){Zt.call(lodash.prototype,B)||(mo[B]=F)})),mo),{chain:!1}),lodash.VERSION=W,arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(F){lodash[F].placeholder=lodash})),arrayEach(["drop","take"],(function(F,B){LazyWrapper.prototype[F]=function(W){W=W===G?1:xn(toInteger(W),0);var z=this.__filtered__&&!B?new LazyWrapper(this):this.clone();return z.__filtered__?z.__takeCount__=Un(W,z.__takeCount__):z.__views__.push({size:Un(W,Ae),type:F+(z.__dir__<0?"Right":"")}),z},LazyWrapper.prototype[F+"Right"]=function(B){return this.reverse()[F](B).reverse()}})),arrayEach(["filter","map","takeWhile"],(function(F,B){var G=B+1,W=G==Se||G==Ce;LazyWrapper.prototype[F]=function(F){var B=this.clone();return B.__iteratees__.push({iteratee:getIteratee(F,3),type:G}),B.__filtered__=B.__filtered__||W,B}})),arrayEach(["head","last"],(function(F,B){var G="take"+(B?"Right":"");LazyWrapper.prototype[F]=function(){return this[G](1).value()[0]}})),arrayEach(["initial","tail"],(function(F,B){var G="drop"+(B?"":"Right");LazyWrapper.prototype[F]=function(){return this.__filtered__?new LazyWrapper(this):this[G](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(F){return this.filter(F).head()},LazyWrapper.prototype.findLast=function(F){return this.reverse().find(F)},LazyWrapper.prototype.invokeMap=baseRest((function(F,B){return"function"==typeof F?new LazyWrapper(this):this.map((function(G){return baseInvoke(G,F,B)}))})),LazyWrapper.prototype.reject=function(F){return this.filter(negate(getIteratee(F)))},LazyWrapper.prototype.slice=function(F,B){F=toInteger(F);var W=this;return W.__filtered__&&(F>0||B<0)?new LazyWrapper(W):(F<0?W=W.takeRight(-F):F&&(W=W.drop(F)),B!==G&&(W=(B=toInteger(B))<0?W.dropRight(-B):W.take(B-F)),W)},LazyWrapper.prototype.takeRightWhile=function(F){return this.reverse().takeWhile(F).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(Ae)},baseForOwn(LazyWrapper.prototype,(function(F,B){var W=/^(?:filter|find|map|reject)|While$/.test(B),z=/^(?:head|last)$/.test(B),K=lodash[z?"take"+("last"==B?"Right":""):B],J=z||/^find/.test(B);K&&(lodash.prototype[B]=function(){var B=this.__wrapped__,Q=z?[1]:arguments,Y=B instanceof LazyWrapper,$=Q[0],X=Y||_r(B),interceptor=function(F){var B=K.apply(lodash,arrayPush([F],Q));return z&&Z?B[0]:B};X&&W&&"function"==typeof $&&1!=$.length&&(Y=X=!1);var Z=this.__chain__,ee=!!this.__actions__.length,te=J&&!Z,ne=Y&&!ee;if(!J&&X){B=ne?B:new LazyWrapper(this);var ie=F.apply(B,Q);return ie.__actions__.push({func:thru,args:[interceptor],thisArg:G}),new LodashWrapper(ie,Z)}return te&&ne?F.apply(this,Q):(ie=this.thru(interceptor),te?z?ie.value()[0]:ie.value():ie)})})),arrayEach(["pop","push","shift","sort","splice","unshift"],(function(F){var B=Jt[F],G=/^(?:push|sort|unshift)$/.test(F)?"tap":"thru",W=/^(?:pop|shift)$/.test(F);lodash.prototype[F]=function(){var F=arguments;if(W&&!this.__chain__){var z=this.value();return B.apply(_r(z)?z:[],F)}return this[G]((function(G){return B.apply(_r(G)?G:[],F)}))}})),baseForOwn(LazyWrapper.prototype,(function(F,B){var G=lodash[B];if(G){var W=G.name+"";Zt.call(ci,W)||(ci[W]=[]),ci[W].push({name:B,func:G})}})),ci[createHybrid(G,ae).name]=[{name:"wrapper",func:G}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.at=Zi,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.next=wrapperNext,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.first=lodash.prototype.head,mn&&(lodash.prototype[mn]=wrapperToIterator),lodash},ni=ti();Hn?((Hn.exports=ni)._=ni,Bn._=ni):jn._=ni}).call(z)}));class DefaultLogger{constructor(F,B=[],G=DefaultLogger.defaultLogRedirect){this._azureLogger=F,this._namespace=B,this._logRedirectCallback=G}createChild(F){return new DefaultLogger(this._azureLogger,[...this._namespace,"string"==typeof F?()=>F:F])}createFnLogger(F,B,...G){return this.createChild(this.getPrefix(F,B)+G.join(""))}log(...F){const B=this.getMessage(F);this._azureLogger.verbose(B),this._logRedirectCallback(`log:${B}`)}debug(...F){const B=this.getMessage(F);this._azureLogger.verbose(B),this._logRedirectCallback(`debug:${B}`)}info(...F){const B=this.getMessage(F);this._azureLogger.info(B),this._logRedirectCallback(`info:${B}`)}warn(...F){const B=this.getMessage(F);this._azureLogger.warning(B),this._logRedirectCallback(`warn:${B}`)}error(...F){const B=this.getMessage(F);this._azureLogger.error(this.getMessage(F)),this._logRedirectCallback(`error::${B}`)}getMessage(...F){return`${getDateInIsoFormat()} ${this.getNamespace()} ${F.join(" ")}`}getNamespace(){return this._namespace.map((F=>F())).join(":")}getPrefix(F,B){let G="";return B&&(G+=B),F&&(G+=F),G}redirectLog(F){this._logRedirectCallback=B=>{DefaultLogger.defaultLogRedirect(B),F(B)}}dumpAllLogs(){return[...DefaultLogger.logDump.toArray()]}}function handleCallOperationFailure(F,B,G){let W,z=0,K=0;return G&&(z=G.callEndDiagnosticsInfo?G.callEndDiagnosticsInfo.callControllerCode||ue:0,K=G.callEndDiagnosticsInfo&&G.callEndDiagnosticsInfo.callControllerSubCode||0),W=convertTerminatedReasonToString(F),B.error(`Call operation failure=${W}, code=${z}, subCode=${K}`),new CallingCommunicationError({message:W,code:z,subCode:K},F)}function handleVideoOperationFailure(F,B){let G=400,W=B||`Video operation failure ${De.UnknownFailureForVideoOperation}`;if(B&&B.type)switch(B.type){case De.SourceUnavailableError:W=`Video operation failure ${De.SourceUnavailableError}`,G=412;break;case De.PermissionDeniedError:W=`Video operation failure ${De.PermissionDeniedError}`,G=403;break;default:W=`Video operation failure ${De.UnknownFailureForVideoOperation}`,G=500}return new CallingCommunicationError({message:W,code:G})}DefaultLogger.logDump=new dp(null===(lp=null===(cp=getAcsEcsConfig())||void 0===cp?void 0:cp.debugInfo)||void 0===lp?void 0:lp.maxLogDumpLength),DefaultLogger.defaultLogRedirect=F=>{var B,G,W,z,K,J;if(null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.debugInfo)||void 0===G?void 0:G.enableLogDump){const sizeCheck=()=>{var F,B;DefaultLogger.logDump.length>(null===(B=null===(F=getAcsEcsConfig())||void 0===F?void 0:F.debugInfo)||void 0===B?void 0:B.maxLogDumpLength)&&DefaultLogger.logDump.shift()};if(null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.debugInfo)||void 0===z?void 0:z.includeList.some((B=>up.includes(F,B))))return DefaultLogger.logDump.push(F),void sizeCheck();if(!(null===(J=null===(K=getAcsEcsConfig())||void 0===K?void 0:K.debugInfo)||void 0===J?void 0:J.excludeList.some((B=>up.includes(F,B)))))return DefaultLogger.logDump.push(F),void sizeCheck()}};var __decorate$3=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$3=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$a=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class LocalVideoStream{constructor(F){if(this._disposed=!1,!(F instanceof VideoDeviceInfoImpl))throw new CallingCommunicationError({message:"Failed to create local video stream, source was not of type VideoDeviceInfo",code:de});const G=B.createClientLogger("ACS");this.logger=new DefaultLogger(G,[()=>`LocalVideoStream:${F.id}`]),this.logger.info("created"),this._telemetryLogManager=F.deviceManager.telemetryLogManager,this._source=F,this._mediaStreamType="Video"}get source(){return this._source}get mediaStreamType(){return this._mediaStreamType}get telemetryLogManager(){return this._telemetryLogManager}switchSource(F){return __awaiter$a(this,void 0,void 0,(function*(){const B=this.logger.createFnLogger(Ae.SwitchSource),G=+new Date,W=generateGuid();if(this.sendVideoStreamEvent({eventName:Mu.acs_calling_switch_video_source_attempt,timestampInfo:{attemptTimestamp:G},correlationId:W}),!(F instanceof VideoDeviceInfoImpl)){const F=new CallingCommunicationError({message:"Failed to switch source, source was not of type VideoDeviceInfo",code:de});throw this.sendVideoStreamEvent({eventName:Mu.acs_calling_switch_video_source_failure,timestampInfo:{attemptTimestamp:G},correlationId:W},F),F}if(this._source===F){const F=new CallingCommunicationError({message:"Unable to switch to the same source",code:ne}),B=+new Date;throw this.sendVideoStreamEvent({eventName:Mu.acs_calling_switch_video_source_failure,timestampInfo:{deltaTimeInMs:B-G},correlationId:W},F),F}try{F.deviceManager.getTsDeviceManager().selectDevices({camera:F.id}),this._source=F;const B=+new Date;this.sendVideoStreamEvent({eventName:Mu.acs_calling_switch_video_source_success,timestampInfo:{deltaTimeInMs:B-G},correlationId:W})}catch(F){const z=handleVideoOperationFailure(B,F),K=+new Date;throw this.sendVideoStreamEvent({eventName:Mu.acs_calling_switch_video_source_failure,timestampInfo:{deltaTimeInMs:K-G},correlationId:W},z),z}}))}getStreamMetadata(){const F=this.source.deviceManager;return{source:"local",streamType:this.mediaStreamType,deviceType:this.source.deviceType,deviceManagerPermissionState:JSON.stringify({cameraPermission:F.getVideoDevicePermission(),microphonePermission:F.getAudioDevicePermission()}),acsResourceId:F.getAcsResourceId()||"",clientId:F.getClientId()}}dispose(){this.logger.log("dispose"),this._disposed?this.logger.log("already disposed"):this._disposed=!0}sendVideoStreamEvent(F,B){try{const G=this.source.deviceManager;let W="string"==typeof(null==B?void 0:B.message)?null==B?void 0:B.message:void 0;F.eventName!==String(Mu.acs_calling_switch_video_source_failure)&&(W=void 0),this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:{timestampInfo:F.timestampInfo,correlationId:F.correlationId,failureReason:W||"",acsResourceId:G.getAcsResourceId()||"",clientId:G.getClientId(),deviceType:this.source.deviceType}})}catch(F){this.logger.debug("Unable to send video stream telemetry")}}}__decorate$3([loggerProperty,__metadata$3("design:type",Object)],LocalVideoStream.prototype,"logger",void 0),__decorate$3([asyncOperation(Ae.SwitchSource),__metadata$3("design:type",Function),__metadata$3("design:paramtypes",[Object]),__metadata$3("design:returntype",Promise)],LocalVideoStream.prototype,"switchSource",null);class AudioDeviceInfoImpl{constructor(F,B,G,W,z){this._name=F,this._id=B,this._isSystemDefault=G,this._deviceType=W,this._deviceManager=z}get name(){return this._name}setName(F){this._name=F}get id(){return this._id}setId(F){this._id=F}get isSystemDefault(){return this._isSystemDefault}setIsSystemDefault(F){this._isSystemDefault=F}get deviceType(){return this._deviceType}setDeviceType(F){this._deviceType=F}get deviceManager(){return this._deviceManager}}var pp,hp,__decorate$4=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$4=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$b=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class LocalAudioStream{constructor(F){const G=B.createClientLogger("ACS");if(this.logger=new DefaultLogger(G,[()=>`LocalAudioStream for default device with source: ${!!F}`]),this._eventEmitter=new CallingEventEmitter(this.logger),!(F instanceof AudioDeviceInfoImpl||F instanceof MediaStreamTrack))throw new CallingCommunicationError({message:"Failed to create local audio stream, source is not of type AudioDeviceInfo or MediaStreamTrack",code:de});if(F instanceof AudioDeviceInfoImpl&&"Microphone"!==F.deviceType)throw new CallingCommunicationError({message:"Failed to create local audio stream, source is not a microphone",code:de});this._source=F,this._disposed=!1,this.logger.info("created")}on(F,B){if("audioSourceChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("audioSourceChanged"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}get source(){return this._source}getMediaStreamTrack(){var F,B;return __awaiter$b(this,void 0,void 0,(function*(){if(this.subscribeToRawStreamChangedIfNeeded(),this._source instanceof AudioDeviceInfoImpl)return this._rawStream=this._source.deviceManager.getRawDeviceMediaStream(0),null===(B=yield null===(F=this._rawStream)||void 0===F?void 0:F.getMediaStream())||void 0===B?void 0:B.getTracks()[0];if(this._source instanceof MediaStreamTrack)return Promise.resolve(this._source);throw new CallingCommunicationError({message:"Failed to get media stream track source is not AudioDeviceInfo or MediaStreamTrack",code:de})}))}switchSource(F){return __awaiter$b(this,void 0,void 0,(function*(){if(!(F instanceof AudioDeviceInfoImpl||F instanceof MediaStreamTrack))throw new CallingCommunicationError({message:"Failed to switch source on local audio stream, source is not of type AudioDeviceInfo or MediaStreamTrack",code:de});if(F instanceof AudioDeviceInfoImpl&&"Microphone"!==F.deviceType)throw new CallingCommunicationError({message:"Failed to create local audio stream, source is not a microphone",code:de});this._source!==F&&(this._source=F,this._eventEmitter.emit("audioSourceChanged",{source:this}))}))}dispose(){this.logger.log("LocalAudioStream disposing"),this._disposed?this.logger.log("Already disposed"):(this.disposeRawStream(),this._disposed=!0,this.logger.log("LocalAudioStream disposed"))}subscribeToRawStreamChangedIfNeeded(){var F;this._source instanceof AudioDeviceInfoImpl&&!this._audioSourceChangedSub&&(this._audioSourceChangedSub=null===(F=this._rawStream)||void 0===F?void 0:F.changed((()=>{this._eventEmitter.emit("audioSourceChanged",{source:this})})))}disposeRawStream(){var F,B;null===(F=this._audioSourceChangedSub)||void 0===F||F.dispose(),null===(B=this._rawStream)||void 0===B||B.dispose(),this._audioSourceChangedSub=void 0}}__decorate$4([loggerProperty,__metadata$4("design:type",Object)],LocalAudioStream.prototype,"logger",void 0),__decorate$4([asyncOperation(Re.GetMediaStreamTrack),__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[]),__metadata$4("design:returntype",Promise)],LocalAudioStream.prototype,"getMediaStreamTrack",null),__decorate$4([asyncOperation(Re.SwitchSource),__metadata$4("design:type",Function),__metadata$4("design:paramtypes",[Object]),__metadata$4("design:returntype",Promise)],LocalAudioStream.prototype,"switchSource",null),function(F){F[F.JITTER=0]="JITTER",F[F.RTT=1]="RTT",F[F.PACKETS_LOSS=2]="PACKETS_LOSS",F[F.BIT_RATE=3]="BIT_RATE",F[F.BANDWIDTH=4]="BANDWIDTH"}(pp||(pp={})),function(F){F[F.AUDIO=0]="AUDIO",F[F.VIDEO=1]="VIDEO"}(hp||(hp={}));const gp="Unknown";var fp,mp;function collectMediaStatsForCreateView(F,B,G){var W,z,K;const J=["bitrate","packetsPerSecond","packetsLostPerSecond","jitterInMs","rttInMs","pairRttInMs","healedRatio","lossRate"],Q=["bitrate","packetsPerSecond","packetsLostPerSecond","jitterInMs","rttInMs","pairRttInMs","frameRateDecoded","frameRateReceived","frameWidthReceived","frameHeightReceived","longestFreezeDurationInMs","totalFreezeDurationInMs","framesReceived","framesDropped","framesDecoded","keyFramesDecoded"],Y=Q;if(B.audio.receive.length>0){const G=B.audio.receive[0];F.audio=null!==(W=F.audio)&&void 0!==W?W:{},J.forEach((B=>{var W;const z=B;if(void 0!==G[z]&&F.audio){const B=G[z];void 0===F.audio[z]?F.audio[z]=[B]:null===(W=F.audio[z])||void 0===W||W.push(B)}}))}if(B.video.receive.length>0){const W=B.video.receive.find((F=>F.streamId===G));void 0!==W&&(F.video=null!==(z=F.video)&&void 0!==z?z:{},Q.forEach((B=>{var G;const z=B;if(void 0!==W[z]&&F.video){const B=W[z];void 0===F.video[z]?F.video[z]=[B]:null===(G=F.video[z])||void 0===G||G.push(B)}})))}if(B.screenShare.receive.length>0){const W=B.screenShare.receive.find((F=>F.streamId===G));void 0!==W&&(F.screenShare=null!==(K=F.screenShare)&&void 0!==K?K:{},Y.forEach((B=>{var G;const z=B;if(void 0!==W[z]&&F.screenShare){const B=W[z];void 0===F.screenShare[z]?F.screenShare[z]=[B]:null===(G=F.screenShare[z])||void 0===G||G.push(B)}})))}}function calculateFirstAverage(F){if((null==F?void 0:F.count.length)&&(null==F?void 0:F.count[0])){return getRoundedAverage(F.sum[0],F.count[0])}return NaN}function calculateFirstSum(F){return(null==F?void 0:F.count.length)&&(null==F?void 0:F.count[0])?F.sum[0]:NaN}!function(F){F.Supported="Supported",F.NotSupported="NotSupported",F.Unknown="Unknown"}(fp||(fp={})),function(F){F.CompleteTest="CompleteTest",F.StartTest="StartTest",F.DeviceAccess="DeviceAccess",F.DeviceEnumerations="DeviceEnumerations",F.InCallDiagnostics="InCallDiagnostics",F.BrowserSupport="BrowserSupport"}(mp||(mp={}));var __awaiter$c=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class PreCallDiagnosticsFeatureImpl extends FirstPartyCallClientFeature{constructor(F){super(F),this._impl=new PreCallDiagnosticsImpl}initialize(F,B){const G=F.callClient,W=F.telemetryLogManager;this._logger=B,this._telemetryLogManager=W,this._impl.intialize(G,B,W),this._sendFeatureUsage("initialize",wu.initialize)}get name(){return this._sendFeatureUsage("name",wu.getter),"PreCallDiagnostics"}startTest(F){return this._impl.startTest(F)}_sendFeatureUsage(F,B){sendCallClientFeatureUsageTelemetry({featureName:"PreCallDiagnostics",featureType:"CallClient",initializationType:"OnExtendedObjectConstructor",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage("dispose",wu.attempt),this.disposed?this._sendFeatureUsage("dispose",wu.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage("dispose",wu.success))}}class PreCallDiagnosticsImpl{constructor(){this._printableObjectAll=!0,this._completeTestInfo={name:"",succeeded:!0},this._diagnosticsTestRunIds=[],this._callMediaStatistics=defer(),this._inCallDiagnostics={connected:!1,diagnostics:{audio:{jitter:gp,packetLoss:gp,rtt:gp},video:{jitter:gp,packetLoss:gp,rtt:gp}},bandWidth:gp},this._diagnosticsMediaTelemetry={jitter:{audio:{inbound:0,outbound:0},video:{inbound:0,outbound:0}},rtt:{audio:0,video:0},packets:{audioSent:0,audioSentLost:0,audioReceived:0,audioReceivedLost:0,videoSent:0,videoSentLost:0,videoReceived:0,videoReceivedLost:0},bandWidth:0},this._isCreatingNewCallAgent=!1}intialize(F,B,G){this._mainCallClient=F,this._logger=B,this._telemetryLogManager=G}startTest(F){var B,G,W;return __awaiter$c(this,void 0,void 0,(function*(){this._sendFeatureUsage("startTest",wu.attempt),this._currentTestRunId=generateGuid(),this._diagnosticsTestRunIds.push(this._currentTestRunId),this.telemetryLogAttemptEvents({diagnosticsTestRunId:this._currentTestRunId,testAttemptDetails:{name:mp.CompleteTest}}),this.telemetryLogAttemptEvents({diagnosticsTestRunId:this._currentTestRunId,testAttemptDetails:{name:mp.StartTest}});const z={diagnostics:{tags:["diagnostics",`test-run-id:${this._currentTestRunId}`]}};this._internalCallClient||(this._internalCallClient=this._mainCallClient.createInstance(z));try{this._internalDeviceManager=yield this._internalCallClient.getDeviceManager();const F=this._internalCallClient.callAgent,z=yield this._mainCallClient.getDeviceManager();null===(B=null==F?void 0:F.tsStack)||void 0===B||B.getDeviceManager().selectDevices({speaker:null===(G=z.selectedSpeaker)||void 0===G?void 0:G.id,microphone:null===(W=z.selectedMicrophone)||void 0===W?void 0:W.id});const K=yield this._internalCallClient.getDeviceManager(),J={mic:(yield K.getMicrophones()).length,speaker:(yield K.getSpeakers()).length};this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.StartTest,!0,`Device selection successful. Result: ${getPrintableObject(J,this._printableObjectAll)}`)})}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.StartTest,!1,"Device selection failed.")});const B="Failed to set default microphone or speaker with error";throw this._logger.warn(B,F),this._sendFeatureUsage("startTest",wu.failure),new CallingCommunicationError({message:B,code:le})}try{return this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.StartTest,!0,"StartTest succeeded")}),this._sendFeatureUsage("startTest",wu.success),{deviceAccess:this.deviceAccess(),deviceEnumeration:this.deviceEnumeration(),inCallDiagnostics:this.getInCallDiagnostics(F),browserSupport:this.getBrowserSupport(),callMediaStatistics:this.getcallMediaStatistics(),id:this._currentTestRunId}}catch(F){const B=`Unable to return call diagnostic information, failed with error: ${getPrintableObject(F)}`;throw this._logger.error(B),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.StartTest,!1,"StartTest failed.")}),this._sendFeatureUsage("startTest",wu.failure),new CallingCommunicationError({message:B,code:le})}}))}getBrowserSupport(){return __awaiter$c(this,void 0,void 0,(function*(){let F;this.telemetryLogAttemptEvents({diagnosticsTestRunId:this._currentTestRunId,testAttemptDetails:{name:mp.BrowserSupport}});try{const B=yield this._mainCallClient.getEnvironmentInfo();F={browser:B.isSupportedBrowser?fp.Supported:fp.NotSupported,os:B.isSupportedPlatform?fp.Supported:fp.NotSupported},this.updateTestInfo(mp.BrowserSupport,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:`Browser support successful. Result: ${getPrintableObject(F,this._printableObjectAll)}`,name:mp.BrowserSupport}})}catch(B){F={browser:fp.Unknown,os:fp.Unknown},this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.BrowserSupport,!1,`Browser support failed. Error: ${getPrintableObject(B)}`)}),this._logger.error(`Browser support failed: ${B}`)}return new Promise((B=>B(F)))}))}renderHiddenVideoElement(F,B){return __awaiter$c(this,void 0,void 0,(function*(){let G,W=F.tsCall,z=W.mediaStreams;try{yield new Promise(((F,B)=>{G=W.changed((()=>{void 0!==z[0]&&z[0].length>0&&z[0][0].isAvailable&&(F(),null==G||G.dispose(),this.updateTestInfo(mp.InCallDiagnostics,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:"Call mediaStreams successful.",name:mp.InCallDiagnostics}}))})),setTimeout((()=>{this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.InCallDiagnostics,!1,"Call mediaStreams failed. Error: Timeout")}),B(new CallingCommunicationError({message:"Timeout in checking media stream status",code:ne}))}),1e3*this._diagnosticsEcsConfig.CALL.MEDIASTREAM_TIMEOUT_IN_SEC)}));let K=W.mediaStreams[0][0],J=document.getElementById("_hiddenSelfRemoteStream");J&&J.remove(),J=document.createElement("div"),J.id="_hiddenSelfRemoteStream",J.style.position="relative",J.style.height="0px",J.style.width="0px";const Q=document.createElement("div");Q.style.position="absolute",Q.style.height=this._diagnosticsEcsConfig.CALL.VIDEO_SIZE.heigth+"px",Q.style.width=this._diagnosticsEcsConfig.CALL.VIDEO_SIZE.width+"px",Q.style.bottom="0px",Q.style.left="-2000px",J.appendChild(Q),document.getElementsByTagName("body")[0].appendChild(J),this.updateTestInfo(mp.InCallDiagnostics,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:`Video element rendering successful. CallId: ${F.id}, localParticipantId: ${B}`,name:mp.InCallDiagnostics}}),yield K.start(Q)}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.InCallDiagnostics,!1,`Call mediaStreams failed. Error: ${getPrintableObject(F)}`)}),this._logger.warn("Failed to render hidden video element")}}))}sineWaveAudioStream(){const F=new window.AudioContext,B=F.createMediaStreamDestination(),G=F.createOscillator();G.type="sine",G.frequency.value=500,G.connect(B),G.start();const{stream:W}=B,z=W.getAudioTracks()[0];return new LocalAudioStream(z)}receiveAndPlayCallAudio(F,B){return __awaiter$c(this,void 0,void 0,(function*(){try{const G=new window.AudioContext,W=F.remoteAudioStreams[0],z=new MediaStream,K=yield W.getMediaStreamTrack();z.addTrack(K);G.createMediaStreamSource(z).connect(G.destination),this.updateTestInfo(mp.InCallDiagnostics,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:`Call mediaStreams audio track succeeded. CallId: ${F.id}, localParticipantId: ${B}`,name:mp.InCallDiagnostics}})}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.InCallDiagnostics,!1,`Call mediaStreams audio track failed. Error: ${getPrintableObject(F)}`)}),this._logger.warn("Failed to send audio to call.")}}))}getcallMediaStatistics(){return __awaiter$c(this,void 0,void 0,(function*(){return this._callMediaStatistics.promise}))}setEcsConfig(){var F,B;this._diagnosticsEcsConfig=null===(B=null===(F=getAcsEcsConfig())||void 0===F?void 0:F.calling)||void 0===B?void 0:B.callDiagnostics}getInCallDiagnostics(F){var B,G;return __awaiter$c(this,void 0,void 0,(function*(){this.telemetryLogAttemptEvents({diagnosticsTestRunId:this._currentTestRunId,testAttemptDetails:{name:mp.InCallDiagnostics}}),this.setEcsConfig();const W={groupId:this._diagnosticsEcsConfig.CALL.GROUP_ID},z=yield this._internalDeviceManager.getCameras();let K,J="";0!==z.length&&(K=[new LocalVideoStream(z[0])]);const Q={videoOptions:{localVideoStreams:K},audioOptions:{muted:!1,localAudioStreams:[this.sineWaveAudioStream()]}};let Y;try{Y=yield null===(B=this._mainCallClient.callAgent)||void 0===B?void 0:B.getExistingCallAgentWithToken(F),Y?this._internalCallClient.setCallAgent(Y):(this._isCreatingNewCallAgent=!0,yield this._internalCallClient.createCallAgent(F)),this.updateTestInfo(mp.InCallDiagnostics,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:"Create CallAgent successful.",name:mp.InCallDiagnostics}})}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.InCallDiagnostics,!1,`Create CallAgent failed. Error: ${getPrintableObject(F)}`)});const B="Failed to get existing call agent or create a new one";throw this._logger.error(`${B} with error: ${F}`),new CallingCommunicationError({message:B,code:le})}const $=null===(G=this._internalCallClient.callAgent)||void 0===G?void 0:G.join(W,Q);if($){try{yield this.waitCallConnected($),J=$.tsCall.participantId,this.updateTestInfo(mp.InCallDiagnostics,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:"Call connected successfully",name:mp.InCallDiagnostics}})}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.InCallDiagnostics,!1,"Call connection failed.")});const B="Test call failed to connect";throw this._logger.error(`${B} with error: ${F}`),new CallingCommunicationError({message:B,code:le})}try{this.updateTestInfo(mp.InCallDiagnostics,!0),yield this.renderHiddenVideoElement($,J)}catch(F){const B="Call failed to render video.";throw this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.InCallDiagnostics,!1,`${B} Error: ${getPrintableObject(F)}`)}),new CallingCommunicationError({message:B,code:le})}this.receiveAndPlayCallAudio($,J);const F=$.feature(callFeatureFactory(MediaStatsCallFeatureImpl,{activationEvent:"OnExtendedObjectConstructor"}));this._callMediaStatistics.resolve(F);F.createCollector({aggregationInterval:this._diagnosticsEcsConfig.CALL.AGGREGATION.INTERVAL,dataPointsPerAggregation:this._diagnosticsEcsConfig.CALL.AGGREGATION.DATAPOINTS}).on("summaryReported",(F=>this.gatherCallStatistics(F)));try{yield sleep(1e3*this._diagnosticsEcsConfig.CALL.DURATION_IN_SEC),yield $.hangUp({forEveryone:!0}),this.updateTestInfo(mp.InCallDiagnostics,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:`Call hangup successful. Result: ${getPrintableObject(this._inCallDiagnostics,this._printableObjectAll)}`,name:mp.InCallDiagnostics}})}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.InCallDiagnostics,!1,"Call hangup failed.")});const B="Test call failed hang up the call";throw this._logger.error(`${B} with error: ${F}`),new CallingCommunicationError({message:B,code:le})}this.dispose()}return this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:this._completeTestInfo.succeeded,result:this._completeTestInfo.result||"InCallDiagnostics succeeded.",name:mp.CompleteTest}}),this._inCallDiagnostics}))}waitCallConnected(F){return __awaiter$c(this,void 0,void 0,(function*(){yield new Promise(((B,G)=>__awaiter$c(this,void 0,void 0,(function*(){F.on("stateChanged",(()=>{"Connected"==F.state&&(this._inCallDiagnostics.connected=!0,B()),"Disconnected"==F.state&&G("Call disconnected")}));const W=this._diagnosticsEcsConfig.CALL.CONNECT_TIMEOUT_IN_SEC;yield sleep(1e3*W),G({message:`Call timeout after ${W}`,code:se})}))))}))}qualityGrade(F,B,G){return F<=B?"Good":F>=G?"Bad":"Average"}bandwidthQualityGrade(F,B,G){return F>=B?"Good":F<=G?"Bad":"Average"}getQualityGradeForMetric(F,B,G){switch(F){case pp.JITTER:return G===hp.AUDIO?this.qualityGrade(B,this._diagnosticsEcsConfig.AUDIO.JITTER.GOOD,this._diagnosticsEcsConfig.AUDIO.JITTER.AVERAGE):this.qualityGrade(B,this._diagnosticsEcsConfig.VIDEO.JITTER.GOOD,this._diagnosticsEcsConfig.VIDEO.JITTER.AVERAGE);case pp.RTT:return G===hp.AUDIO?this.qualityGrade(B,this._diagnosticsEcsConfig.AUDIO.RTT.GOOD,this._diagnosticsEcsConfig.AUDIO.RTT.AVERAGE):this.qualityGrade(B,this._diagnosticsEcsConfig.VIDEO.RTT.GOOD,this._diagnosticsEcsConfig.VIDEO.RTT.AVERAGE);case pp.PACKETS_LOSS:return G===hp.AUDIO?this.qualityGrade(B,this._diagnosticsEcsConfig.AUDIO.PACKETS_LOSS_PERCENTAGE.GOOD,this._diagnosticsEcsConfig.AUDIO.PACKETS_LOSS_PERCENTAGE.AVERAGE):this.qualityGrade(B,this._diagnosticsEcsConfig.VIDEO.PACKETS_LOSS_PERCENTAGE.GOOD,this._diagnosticsEcsConfig.VIDEO.PACKETS_LOSS_PERCENTAGE.AVERAGE);case pp.BANDWIDTH:return this.bandwidthQualityGrade(B,this._diagnosticsEcsConfig.BANDWIDTH.GOOD,this._diagnosticsEcsConfig.BANDWIDTH.AVERAGE);default:return gp}}gatherCallStatistics(F){var B,G,W,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe;try{const ae=F.audio.receive.length?F.audio.receive[0]:void 0,se=F.audio.send.length?F.audio.send[0]:void 0,ce=F.audio.receive.length?F.video.receive[0]:void 0,le=F.audio.send.length?F.video.send[0]:void 0;this._diagnosticsMediaTelemetry.jitter.audio.inbound=calculateFirstAverage(null===(B=null==ae?void 0:ae.jitterInMs)||void 0===B?void 0:B.aggregation),this._diagnosticsMediaTelemetry.jitter.audio.outbound=calculateFirstAverage(null===(G=null==se?void 0:se.jitterInMs)||void 0===G?void 0:G.aggregation);const de=Math.max(null===(W=this._diagnosticsMediaTelemetry.jitter.audio)||void 0===W?void 0:W.inbound,null===(z=this._diagnosticsMediaTelemetry.jitter.audio)||void 0===z?void 0:z.outbound);this._inCallDiagnostics.diagnostics.audio.jitter=this.getQualityGradeForMetric(pp.JITTER,de,hp.AUDIO),this._diagnosticsMediaTelemetry.rtt.audio=calculateFirstAverage(null===(K=null==se?void 0:se.rttInMs)||void 0===K?void 0:K.aggregation),this._inCallDiagnostics.diagnostics.audio.rtt=this.getQualityGradeForMetric(pp.JITTER,this._diagnosticsMediaTelemetry.rtt.audio,hp.AUDIO),this._diagnosticsMediaTelemetry.packets.audioSent=calculateFirstSum(null===(J=null==se?void 0:se.packetsPerSecond)||void 0===J?void 0:J.aggregation),this._diagnosticsMediaTelemetry.packets.audioSentLost=calculateFirstSum(null===(Q=null==se?void 0:se.packetsLostPerSecond)||void 0===Q?void 0:Q.aggregation),this._diagnosticsMediaTelemetry.packets.audioReceived=calculateFirstSum(null===(Y=null==ae?void 0:ae.packetsPerSecond)||void 0===Y?void 0:Y.aggregation),this._diagnosticsMediaTelemetry.packets.audioReceivedLost=calculateFirstSum(null===($=null==ae?void 0:ae.packetsLostPerSecond)||void 0===$?void 0:$.aggregation);const ue=this._diagnosticsMediaTelemetry.packets.audioSent-this._diagnosticsMediaTelemetry.packets.audioSentLost,pe=this._diagnosticsMediaTelemetry.packets.audioReceived-this._diagnosticsMediaTelemetry.packets.audioReceivedLost,he=Math.max(ue,pe)/this._diagnosticsMediaTelemetry.packets.audioSent*100;this._inCallDiagnostics.diagnostics.audio.packetLoss=this.getQualityGradeForMetric(pp.PACKETS_LOSS,he,hp.AUDIO),this._diagnosticsMediaTelemetry.jitter.video.inbound=calculateFirstAverage(null===(X=null==ce?void 0:ce.jitterInMs)||void 0===X?void 0:X.aggregation),this._diagnosticsMediaTelemetry.jitter.video.outbound=calculateFirstAverage(null===(Z=null==le?void 0:le.jitterInMs)||void 0===Z?void 0:Z.aggregation);const ge=Math.max(this._diagnosticsMediaTelemetry.jitter.video.inbound,this._diagnosticsMediaTelemetry.jitter.video.outbound);this._inCallDiagnostics.diagnostics.video.jitter=this.getQualityGradeForMetric(pp.JITTER,ge,hp.VIDEO),this._diagnosticsMediaTelemetry.rtt.video=calculateFirstAverage(null===(ee=null==le?void 0:le.rttInMs)||void 0===ee?void 0:ee.aggregation),this._inCallDiagnostics.diagnostics.video.rtt=this.getQualityGradeForMetric(pp.RTT,this._diagnosticsMediaTelemetry.rtt.video,hp.VIDEO),this._diagnosticsMediaTelemetry.packets.videoSent=calculateFirstSum(null===(te=null==le?void 0:le.packetsPerSecond)||void 0===te?void 0:te.aggregation),this._diagnosticsMediaTelemetry.packets.videoSentLost=calculateFirstSum(null===(ne=null==le?void 0:le.packetsLostPerSecond)||void 0===ne?void 0:ne.aggregation),this._diagnosticsMediaTelemetry.packets.videoReceived=calculateFirstSum(null===(ie=null==ce?void 0:ce.packetsPerSecond)||void 0===ie?void 0:ie.aggregation),this._diagnosticsMediaTelemetry.packets.videoReceivedLost=calculateFirstSum(null===(re=null==ce?void 0:ce.packetsLostPerSecond)||void 0===re?void 0:re.aggregation);const fe=this._diagnosticsMediaTelemetry.packets.videoSent-this._diagnosticsMediaTelemetry.packets.videoSentLost,me=this._diagnosticsMediaTelemetry.packets.videoReceived-this._diagnosticsMediaTelemetry.packets.videoReceivedLost,ve=Math.max(fe,me)/this._diagnosticsMediaTelemetry.packets.videoSent*100;this._inCallDiagnostics.diagnostics.video.packetLoss=this.getQualityGradeForMetric(pp.PACKETS_LOSS,ve,hp.VIDEO),this._diagnosticsMediaTelemetry.bandWidth=calculateFirstAverage(null===(oe=null==le?void 0:le.availableBitrate)||void 0===oe?void 0:oe.aggregation),this._inCallDiagnostics.bandWidth=this.getQualityGradeForMetric(pp.BANDWIDTH,this._diagnosticsMediaTelemetry.bandWidth,hp.AUDIO)}catch(F){const B=new CallingCommunicationError({message:"Failed to get video call media stats",code:ue},F);this._logger.error("Failed to get audio call media stats",F),this._callMediaStatistics.reject(B)}}deviceAccess(){return __awaiter$c(this,void 0,void 0,(function*(){this.telemetryLogAttemptEvents({diagnosticsTestRunId:this._currentTestRunId,testAttemptDetails:{name:mp.DeviceAccess}});const F=this._internalDeviceManager.askDevicePermission({audio:!0,video:!0});try{const B=yield F;this.updateTestInfo(mp.DeviceAccess,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:`Device Access successful. Result: ${getPrintableObject(B,this._printableObjectAll)}`,name:mp.DeviceAccess}})}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.DeviceAccess,!1,"Device Access failed.")})}return F}))}deviceEnumeration(){return __awaiter$c(this,void 0,void 0,(function*(){const F={microphone:gp,camera:gp,speaker:gp};this.telemetryLogAttemptEvents({diagnosticsTestRunId:this._currentTestRunId,testAttemptDetails:{name:mp.DeviceEnumerations}});try{const B=0!==(yield this._internalDeviceManager.getMicrophones()).length,G=0!==(yield this._internalDeviceManager.getCameras()).length,W=0!==(yield this._internalDeviceManager.getSpeakers()).length;F.microphone=B?"Available":"NotAvailable",F.camera=G?"Available":"NotAvailable",F.speaker=W?"Available":"NotAvailable",this.updateTestInfo(mp.DeviceEnumerations,!0),this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:{succeeded:!0,result:`Device Enumeration successful. Result: ${getPrintableObject(F,this._printableObjectAll)}`,name:mp.DeviceEnumerations}})}catch(F){this.telemetryLogResultEvents({diagnosticsTestRunId:this._currentTestRunId,testResultDetails:this.updateTestInfo(mp.DeviceEnumerations,!1,"Device Enumeration failed.")}),this._logger.error(`Couldn't find mic, camera, or speaker: ${F}`)}return F}))}telemetryLogAttemptEvents(F){this._telemetryLogManager.sendEvent({name:Mu.acs_calling_diagnostics_attempt,tenant:ft,properties:{name:F.testAttemptDetails.name,diagnosticsTestRunId:F.diagnosticsTestRunId}})}telemetryLogResultEvents(F){this._telemetryLogManager.sendEvent({name:Mu.acs_calling_diagnostics_result,tenant:ft,properties:{name:F.testResultDetails.name,diagnosticsTestRunId:F.diagnosticsTestRunId,succeeded:F.testResultDetails.succeeded,result:F.testResultDetails.result}})}updateTestInfo(F,B,G){return this._completeTestInfo.succeeded&&(this._completeTestInfo={succeeded:B,name:F,result:G}),{succeeded:B,name:F,result:G||""}}_sendFeatureUsage(F,B){sendCallClientFeatureUsageTelemetry({featureName:"PreCallDiagnostics",featureType:"CallClient",initializationType:"OnExtendedObjectConstructor",featureDetails:{name:F,step:B}},this._telemetryLogManager,this._logger)}dispose(){var F;this._isCreatingNewCallAgent&&(null===(F=this._internalCallClient.callAgent)||void 0===F||F.dispose())}}class Debounce{constructor(F,B){this._debounce=void 0,this._updateFunction=F,this._timeout=B}debounce(){this._debounce?(clearTimeout(this._debounce),this._debounce=setTimeout((()=>{this._updateFunction(),this._debounce=void 0}),this._timeout)):(this._updateFunction(),this._debounce=setTimeout((()=>{this._debounce=void 0}),this._timeout))}}class VideoStreamCommonImpl{constructor(F,B,G,W,z){this._isReceiving=!1,this._mediaStreamType="Video",this._renderers=[],this._disposed=!1,this._size={height:0,width:0},this._setType=F=>{0===F.type?this._mediaStreamType="Video":1===F.type?this._mediaStreamType="ScreenSharing":2===F.type&&(this._mediaStreamType="LiveStream")},this._disposeRenderer=F=>{this.logger.log("disposing renderer");try{F.dispose(!0),this.logger.log("renderer disposed")}catch(F){this.logger.log("failed to dispose renderer")}},this.tsStream=F,this._setType(this.tsStream),this.logger=B.createChild((()=>`Stream:{id=${this.tsStream.id}}:{type=${this._mediaStreamType}}`)),this.telemetryLogManager=z,this._eventEmitter=new CallingEventEmitter(this.logger),this.call=G,this._tsParticipant=W,this.sendRemoteVideoStreamTelemetry(),this._debounceSize=new Debounce((()=>{var F;let B={height:0,width:0};null===(F=this._renderers)||void 0===F||F.forEach((F=>{(null==F?void 0:F.isRendering)&&F.size.height>B.height&&F.size.width>B.width&&(B.height=F.size.height,B.width=F.size.width)}),getAcsEcsConfig().rendering.remoteVideo.debounceTimeout),this._size.height===B.height&&this._size.width===B.width||(this._size.height=B.height,this._size.width=B.width,this.logger.info(`stream size changed to { height: ${this._size.height}, width: ${this._size.width} }`),this._eventEmitter.emit("sizeChanged"),this.sendRemoteVideoStreamTelemetry())}),getAcsEcsConfig().rendering.remoteVideo.debounceTimeout),this._debounceIsReceiving=new Debounce((()=>{var F;const B=(null===(F=this._renderers)||void 0===F?void 0:F.filter((F=>!!(null==F?void 0:F.isRendering))).length)>0;this._isReceiving!==B&&(this._isReceiving=B,this.logger.info(`isReceiving changed to ${this._isReceiving}`),this._eventEmitter.emit("isReceivingChanged"),this.sendRemoteVideoStreamTelemetry())}),getAcsEcsConfig().rendering.remoteVideo.debounceTimeout),this.logger.info("created")}on(F,B){if("sizeChanged"!==F&&"isReceivingChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("sizeChanged"!==F&&"isReceivingChanged"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}get id(){return this.tsStream.id}get isReceiving(){return this._isReceiving}get mediaStreamType(){return this._mediaStreamType}get size(){return{height:this._size.height,width:this._size.width}}updateSize(){this._debounceSize.debounce()}updateIsReceiving(){this._debounceIsReceiving.debounce()}registerRenderer(F){this._renderers.push(F),this.logger.info(`Renderer registered, view id: ${F.viewId}`)}unregisterRenderer(F){const B=this._renderers.indexOf(F);-1!==B&&(this._renderers.splice(B,1),this.logger.info(`Renderer un-registered, view id: ${F.viewId}`))}dispose(){this.logger.log("dispose"),this._disposed?this.logger.log("already disposed"):(this._disposed=!0,this._streamChangedHandler&&this._streamChangedHandler.dispose(),this._renderers.forEach((F=>this._disposeRenderer(F))),this._renderers=[],this._eventEmitter.removeAllListeners())}getRemoteParticipantId(){var F,B;let G="";try{G=(null===(B=null===(F=this._tsParticipant)||void 0===F?void 0:F.streams[this.tsStream.type].find((F=>F.id===this.id)))||void 0===B?void 0:B.participantId)||""}catch(F){G=""}return G}getRegisteredViewIds(){return this._renderers.map((F=>F.viewId)).join(", ")}sendRemoteVideoStreamTelemetry(){this.call.stats.recordEvent({name:Ou.remote_stream,callId:this.call.id,localParticipantId:this.call.tsCall.participantId,data:Object.assign({},this.getStreamMetadata())})}}var __awaiter$d=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class LiveStreamCallFeatureImpl extends FirstPartyCallFeature{constructor(F){super(F),this._impl=new LiveStreamCallFeatureImplOverTsCall(this.eventEmitter)}get name(){return"LiveStream"}initialize(F,B){this._impl.initialize(F.tsCall,F.callAgent,F.call,F.telemetryLogManager,B)}get liveStreams(){return this._impl.liveStreams}get participantCount(){return this._impl.streamingClientCount}on(F,B){if("liveStreamsUpdated"!==F&&"participantCountChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this.eventEmitter.on(F,B)}off(F,B){if("liveStreamsUpdated"!==F&&"participantCount"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe to event ${F}, unknown event name`,code:de});this.eventEmitter.off(F,B)}}class LiveStreamCallFeatureImplOverTsCall{constructor(F){this._eventEmitter=F,this._streamIdToStreamMap=new Map}initialize(F,B,G,W,z){this._logger=z.createChild((()=>`LiveStreamingCallFeature::Call(id='${F.callId}')`)),this._telemetryLogManager=W,this._call=G,this._tsCall=F,this._tsCall.on("participantAdded",(F=>__awaiter$d(this,void 0,void 0,(function*(){this.isLiveStreamingBot(F.id)&&(this._logger.info("Live streaming Bot added"),this.observeLiveStreamingParticipant(F))})))),this._tsCall.on("participantRemoved",(F=>__awaiter$d(this,void 0,void 0,(function*(){if(this.isLiveStreamingBot(F.id)){this._logger.info("Live streaming Bot removed");const B=[];this.removeAllStreams(F,B),this.emitLiveStreamsUpdatedEvent([],B)}})))),this._tsCall.participantCounts&&null!=this._tsCall.participantCounts.streamingClients&&(this._participantCount=this._tsCall.participantCounts.streamingClients),this._tsCall.on("participantCountsUpdated",(()=>{if(this._tsCall.participantCounts&&this._participantCount!==this._tsCall.participantCounts.streamingClients){const F=this._participantCount;this._participantCount=this._tsCall.participantCounts.streamingClients,this._logger.log(`tsCall participantCount changed from ${F} to ${this._participantCount}`),this._eventEmitter.emit("participantCountChanged")}}))}get liveStreams(){return[...this._streamIdToStreamMap.values()]}get streamingClientCount(){var F;return null!==(F=this._participantCount)&&void 0!==F?F:0}isLiveStreamingBot(F){return F===getAcsEcsConfig().calling.liveStreamingBotId}observeLiveStreamingParticipant(F){F.changed((()=>{this._logger.info(`Live streaming Bot - changed event triggered. state: ${F.state}`),this._mapStreams(F)})),this._logger.info(`Live streaming Bot state: ${F.state}`),this._mapStreams(F)}_mapStreams(F){const B=[],G=[];(W=>{if(F)if(isNonEmptyArray(F.streams&&F.streams[W])){let z=F.streams[W];this._logger.log(`Stream Type: ${W}`),z.forEach((G=>{if(void 0===G.id&&(G.id=-1),!this._streamIdToStreamMap.get(G.id)){const W=new LiveVideoStreamImpl(G,this._logger,this._call,this._callAgent,F,this._telemetryLogManager);this._logger.log(`stream created, type==${W.mediaStreamType} id=${G.id}`),B.push(W)}})),this._streamIdToStreamMap.forEach((B=>{void 0===B.tsParticipant||B.tsParticipant.id!==F.id||z.some((F=>F.id===B.id))||G.push(B)}))}else this.removeAllStreams(F,G)})(2),this.emitLiveStreamsUpdatedEvent(B,G)}removeAllStreams(F,B){this._streamIdToStreamMap.forEach((G=>{void 0!==G.tsParticipant&&G.tsParticipant.id===F.id&&B.push(G)}))}emitLiveStreamsUpdatedEvent(F,B){if(F.length>0||B.length>0){const handleNewStream=F=>{this._streamIdToStreamMap.set(F.id,F)},handleRemovedStream=F=>{const B=this._streamIdToStreamMap.get(F.id);B&&(this._logger.log(`stream removed, type==${B.mediaStreamType} id=${F.id}`),this._streamIdToStreamMap.delete(F.id),B.dispose())};F.forEach(handleNewStream),B.forEach(handleRemovedStream),this._eventEmitter.emit("liveStreamsUpdated",{added:F,removed:B})}}}class LiveVideoStreamImpl extends VideoStreamCommonImpl{constructor(F,B,G,W,z,K){super(F,B,G,z,K),this.kind="LiveVideoStreamInternal"}get tsParticipant(){return this._tsParticipant}getStreamMetadata(){var F;return{callId:null===(F=this.call)||void 0===F?void 0:F.id,streamType:this.mediaStreamType,localParticipantId:this.call.tsCall.participantId,remoteParticipantId:this.getRemoteParticipantId(),sourceId:this.id,source:"remote",isReceiving:this._isReceiving,isStreaming:this.tsStream.isStreaming,viewIdsRegistered:this.getRegisteredViewIds(),height:this._size.height,width:this._size.width,isDisposed:this._disposed}}}const vp={Recording:callFeatureFactory(RecordingCallFeatureImpl),Transfer:callFeatureFactory(TransferCallFeatureImpl),Transcription:callFeatureFactory(TranscriptionCallFeatureImpl),Captions:callFeatureFactory(CaptionsCallFeatureImpl),RaiseHand:callFeatureFactory(RaiseHandCallFeatureImpl),TeamsCaptions:callFeatureFactory(TeamsCaptionsCallFeatureImpl),DominantSpeakers:callFeatureFactory(DominantSpeakersCallFeatureImpl),LiveStream:callFeatureFactory(LiveStreamCallFeatureImpl),UserFacingDiagnostics:callFeatureFactory(UserFacingDiagnosticsFeatureImpl),MediaStats:callFeatureFactory(MediaStatsCallFeatureImpl,{activationEvent:"OnExtendedObjectConstructor"}),DebugInfo:callClientFeatureFactory(DebugInfoCallClientFeatureImpl,{activationEvent:"OnExtendedObjectConstructor"}),PreCallDiagnostics:callClientFeatureFactory(PreCallDiagnosticsFeatureImpl,{activationEvent:"OnExtendedObjectConstructor"})};function getRegisteredFeatures(F){switch(F){case Yt.CallClientFeature:return Object.entries(vp).filter((F=>!0===F[1].isCallClientFeature)).map((F=>F[1]));case Yt.CallAgentFeature:return Object.entries(vp).filter((F=>!0===F[1].isCallAgentFeature)).map((F=>F[1]));case Yt.CallFeature:return Object.entries(vp).filter((F=>!0===F[1].isCallFeature)).map((F=>F[1]))}}class CallStats{constructor(F,B){this._eventBag=[],this.resetEventBag=()=>{this._eventBag=[]},this._logger=F.createChild("CallStats"),this._telemetryLogManager=B}recordEvent(F){var B,G,W,z,K;try{if((null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.telemetry)||void 0===G?void 0:G.callStatsFlushTimeout)<0)return;if((null===(K=null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.telemetry)||void 0===z?void 0:z.blockedEvents)||void 0===K?void 0:K.indexOf(F.name))>-1)return;const J=Object.assign(Object.assign({},F),{timestamp:+new Date});this._logger.debug(`CallStat recorded=${F.name}`),this._eventBag.push(J),this.scheduleTelemtryFlush()}catch(F){this._logger.debug("Failed to record call stats")}}flushEvents(){if(this._logger.debug(`CallStats sending telemetry, number of events=${this._eventBag.length}`),0!==this._eventBag.length)try{const F=this._eventBag.reduce(((F,B)=>(F[B.localParticipantId]?F[B.localParticipantId].events.push(Object.assign({name:B.name,timestamp:B.timestamp},B.data)):F[B.localParticipantId]={callId:B.callId,localParticipantId:B.localParticipantId,events:[Object.assign({name:B.name,timestamp:B.timestamp},B.data)]},F)),{});Object.keys(F).forEach((B=>{this._telemetryLogManager.sendEvent({name:Mu.acs_calling_call_stats,tenant:ft,properties:Object.assign({},F[B])})})),this.resetEventBag()}catch(F){this._logger.debug("Failed to send call stats")}}scheduleTelemtryFlush(){this._callStatSendTimeout||(this._callStatSendTimeout=window.setTimeout((()=>{this.flushEvents(),this._callStatSendTimeout=void 0}),getAcsEcsConfig().telemetry.callStatsFlushTimeout))}}var __decorate$5=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$5=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$e=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class RemoteAudioStream{constructor(F){const G=B.createClientLogger("ACS");this.logger=new DefaultLogger(G,[()=>"RemoteAudioStream for media stream"]),this._source=F,this._disposed=!1,this.logger.info("created")}getMediaStreamTrack(){return __awaiter$e(this,void 0,void 0,(function*(){return(yield this._source.getMediaStream()).getTracks()[0]}))}dispose(){var F;this.logger.log("dispose"),this._disposed?this.logger.log("already disposed"):(null===(F=this._source)||void 0===F||F.dispose(),this._disposed=!0)}}__decorate$5([loggerProperty,__metadata$5("design:type",Object)],RemoteAudioStream.prototype,"logger",void 0);var yp,__decorate$6=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$6=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$f=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class CallCommonImpl{constructor(F,B,G,W,z){var K;this._callAgent=B,this._state="None",this._isMuted=!1,this._isIncomingAudioMuted=!1,this._isScreenSharingOn=!1,this._isVideoOn=!1,this._localVideoStreams=[],this._localAudioStreams=[],this._remoteAudioStreams=[],this._totalParticipantCount=1,this._isDeviceNotFunctioningMuted=!1,this._isMicrophoneMuted=!1,this._isServerMuted=!1,this._disposed=!1,this._lastTsCallState=0,this._isSpeakerMuted=!1,this._role="Unknown",this._remoteParticipants=[],this._getCallEndReason=()=>{let F=0,B=0,G="Unknown";this.tsCall&&(F=this.tsCall.callEndDiagnosticsInfo&&this.tsCall.callEndDiagnosticsInfo.callControllerCode||0,B=this.tsCall.callEndDiagnosticsInfo&&this.tsCall.callEndDiagnosticsInfo.callControllerSubCode||0,G=convertTerminatedReasonToString(this.tsCall.terminatedReason));const W={code:F,subCode:B};return this.logger[0===F?"info":"error"](`Call end reason=${G}, code=${F}, subCode=${B}`),W},this._handleCallingApplicationIdentifier=F=>{this._isClosedCaptionsBot(F)&&this.logger.info("Handle participant: Ignore closed captions application")},this._handleParticipantOperationFailure=F=>{const B=convertParticipantStateReasonToString(F);return this.logger.error(`Participant operation failure=${B}`),new CallingCommunicationError({message:B,code:ue,subCode:0},F)},this._handleMuteChanges=()=>{const F=this.tsCall.conversationType?!!(this._isMicrophoneMuted||this._isServerMuted||this._isDeviceNotFunctioningMuted):!(!this._isMicrophoneMuted&&!this._isDeviceNotFunctioningMuted);if(this._isMuted!=F){this.logger.info(`isMuted changed from ${this._isMuted} to ${F}`);let B=[];this._isMicrophoneMuted&&B.push("isMicrophoneMuted"),this._isServerMuted&&B.push("isServerMuted"),this._isDeviceNotFunctioningMuted&&B.push("isDeviceNotFunctioningMuted");let G="";B.length>=1&&(G=B.join(", ")),this.sendCallProgressEvent({eventName:Mu.acs_calling_call_progress,timestampInfo:{attemptTimestamp:+new Date},step:"isMuted-changed",additionalProperties:{oldIsMuted:this._isMuted,newIsMuted:F,reason:G}}),this._isMuted=F,this._eventEmitter.emit("isMutedChanged")}},this._handleIncomingAudioMuteChanges=()=>{const F=this._isSpeakerMuted;this._isIncomingAudioMuted!=F&&(this.logger.info(`newIncomingAudioMuted changed from ${this._isIncomingAudioMuted} to ${F}`),this.sendCallProgressEvent({eventName:Mu.acs_calling_call_progress,timestampInfo:{attemptTimestamp:+new Date},step:"isIncomingAudioMuted-changed",additionalProperties:{oldIsMuted:this._isIncomingAudioMuted,newIsMuted:F,reason:""}}),this._isIncomingAudioMuted=F,this._eventEmitter.emit("isIncomingAudioMutedChanged"))},this._isClosedCaptionsBot=F=>"28:b1902c3e-b9f7-4650-9b23-5772bd429747"===F.id,this._id=F.callId,this.tsCall=G,this._direction=F.isIncoming?"Incoming":"Outgoing",this.logger=this._callAgent.logger.createChild((()=>`Call:${this._id}:${this._state}`)),this._telemetryLogManager=W,this.stats=new CallStats(this.logger,this._telemetryLogManager),this._eventEmitter=new CallingEventEmitter(this.logger),this.activeRemoteVideoStreamViews=new Map,this._mediaMetricsDeviceEvents={},this._kind=z,getAcsEcsConfig().calling.mediaMetricsDeviceEventsEnabled&&(this._dmDevicesChangedSub=null===(K=this._callAgent.tsStack)||void 0===K?void 0:K.getDeviceManager().on("devicesChanged",(()=>{this.setOrUpdateMediaMetricsDeviceEvents()}))),this._extensibleApi=new ExtensibleFeatureImpl(this.logger,{call:this,callAgent:this._callAgent},{tsCall:this.tsCall,callAgent:this._callAgent,call:this,telemetryLogManager:this._telemetryLogManager});const J=getRegisteredFeatures(Yt.CallFeature);for(const F of J)"OnExtendedObjectConstructor"===F.activationOptions.activationEvent&&this.feature(F)}get id(){return this._id}get callerInfo(){return{identifier:this._callerIdentity,displayName:this._callerDisplayName}}get state(){return this._state}get role(){return this._role}get callEndReason(){return this._callEndReason}get kind(){return this._kind}get direction(){return this._direction}get isMuted(){return this._isMuted}get isScreenSharingOn(){return this._isScreenSharingOn}get isVideoOn(){return this._isVideoOn}get localVideoStreams(){return this._localVideoStreams}get localAudioStreams(){return this._localAudioStreams}get isIncomingAudioMuted(){return this._isIncomingAudioMuted}get remoteParticipants(){return this._remoteParticipants}get totalParticipantCount(){return this._totalParticipantCount}get remoteAudioStreams(){var F,B;const G=generateGuid(),W=+new Date;if(this.sendRawMediaEvent({eventName:Mu.acs_calling_get_remote_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"attempt",timestampInfo:"",additionalDetails:""}),this._remoteAudioStreams.length>0||3!=this.tsCall.state){const F=+new Date;return this.sendRawMediaEvent({eventName:Mu.acs_calling_get_remote_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"success",localAudioStream:this.localAudioStreams[0],timestampInfo:{deltaTimeInMs:F-W},additionalDetails:""}),this._remoteAudioStreams}if(!getAcsEcsConfig().calling.allowAccessRawMediaStream||!(null===(F=this.tsCall)||void 0===F?void 0:F.getIncomingRawAudioStream)){const F=new CallingCommunicationError({message:"Failed to get incoming audio stream",code:ue});this.logger.error("Failed to get incoming audio stream");const B=+new Date;return this.sendRawMediaEvent({eventName:Mu.acs_calling_get_remote_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"failure",timestampInfo:{deltaTimeInMs:B-W},additionalDetails:{failureReason:F.message||"",code:F.code,subCode:F.subCode}}),[]}let z=null===(B=this.tsCall)||void 0===B?void 0:B.getIncomingRawAudioStream();const K=+new Date;return this.sendRawMediaEvent({eventName:Mu.acs_calling_get_remote_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"success",localAudioStream:this.localAudioStreams[0],timestampInfo:{deltaTimeInMs:K-W},additionalDetails:""}),this._remoteAudioStreams.push(new RemoteAudioStream(z)),this._eventEmitter.emit("remoteAudioStreamsUpdated",{added:this._remoteAudioStreams,removed:[]}),this._remoteAudioStreams}accept(F={}){return __awaiter$f(this,void 0,void 0,(function*(){if(1!==this.tsCall.state)throw new CallingCommunicationError({message:'Call cannot be accepted because call state is not "Notified"',code:ne});const B=+new Date,G=generateGuid();this.sendCallStageEvent({eventName:Mu.acs_calling_call_accept_attempt,correlationId:G,timestampInfo:{attemptTimestamp:B}});const W=this.getLocalVideoStreamFromCallOptions(F);this.setLocalVideoStream(W);const z=this.getLocalAudioStreamFromCallOptions(F);return this.setLocalAudioStream(z),W&&this.sendVideoEvent({eventName:Mu.acs_calling_start_video_attempt,timestampInfo:{attemptTimestamp:B},correlationId:G,step:"accept",isScreenSharingOn:this._isScreenSharingOn}),this.tsCall.accept({withVideo:!!W,receiveOnlyAudioOnCallStart:!!z}).then((()=>__awaiter$f(this,void 0,void 0,(function*(){const F=+new Date;W&&this.shallRemoveLvsAfterConnectedSuccessfully(W,"accept",G,F,B),z&&(this.startAudioInternal(z,!0).catch((F=>{})),this.shallRemoveLasAfterConnectedSuccessfully(z,"accept",G,F,B)),this.sendCallStageEvent({eventName:Mu.acs_calling_call_accept_connected,correlationId:G,timestampInfo:{deltaTimeInMs:F-B}})})))).catch((F=>{const K=+new Date,J=handleCallOperationFailure(F,this.logger,this.tsCall);this.sendCallStageEvent({eventName:Mu.acs_calling_call_accept_failed,correlationId:G,timestampInfo:{deltaTimeInMs:K-B}},J),W&&(this.sendVideoEvent({correlationId:G,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:K-B},localVideoStream:W,step:"accept",isScreenSharingOn:this._isScreenSharingOn},J),this.removeLocalVideoStream(W)),z&&this.removeLocalAudioStream(z)})),this}))}reject(){return __awaiter$f(this,void 0,void 0,(function*(){const F=+new Date,B=generateGuid();if(this.sendCallStageEvent({eventName:Mu.acs_calling_call_reject_attempt,correlationId:B,timestampInfo:{attemptTimestamp:F}}),1!==this.tsCall.state){const G=new CallingCommunicationError({message:"Call cannot be rejectd because it is not incoming.",code:ne}),W=+new Date;throw this.sendCallStageEvent({eventName:Mu.acs_calling_call_reject_failed,correlationId:B,timestampInfo:{deltaTimeInMs:W-F}},G),G}return this.tsCall.reject().then((()=>{const G=+new Date;this.sendCallStageEvent({eventName:Mu.acs_calling_call_reject_success,correlationId:B,timestampInfo:{deltaTimeInMs:G-F}})})).catch((G=>{const W=+new Date;throw this.sendCallStageEvent({eventName:Mu.acs_calling_call_reject_failed,correlationId:B,timestampInfo:{deltaTimeInMs:W-F}},G),handleCallOperationFailure(G,this.logger,this.tsCall)}))}))}dispose(){this._disposed||(this._dmDevicesChangedSub&&this._dmDevicesChangedSub.dispose(),this._dmDevicesChangedSub=void 0,this._extensibleApi.dispose(),this._eventEmitter.removeAllListeners(),this._disposed=!0)}startAudioInternal(F,B=!1){var G,W,z;return __awaiter$f(this,void 0,void 0,(function*(){const K=generateGuid(),J=+new Date;let Q;this.sendRawMediaEvent({eventName:Mu.acs_calling_start_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:K,kindOfEvent:"attempt",isInternal:B,timestampInfo:"",additionalDetails:""});try{Q=yield F.getMediaStreamTrack()}catch(F){const G=new CallingCommunicationError({message:"Failed to get raw stream from local audio stream",code:ue});this.logger.error(`Failed to get raw stream with error: ${F}`);const W=+new Date;throw this.sendRawMediaEvent({eventName:Mu.acs_calling_start_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:K,isInternal:B,kindOfEvent:"failure",timestampInfo:{deltaTimeInMs:W-J},additionalDetails:{failureReason:G.message||"",code:G.code,subCode:G.subCode}}),G}const Y=null===(G=this._callAgent.tsStack)||void 0===G?void 0:G.getDeviceManager();if(!(null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.calling)||void 0===z?void 0:z.allowAccessRawMediaStream)||!(null==Y?void 0:Y.setRawMediaStream)){const F=new CallingCommunicationError({message:"Failed to set raw input audio stream track",code:ue});this.logger.error("Failed to set raw input audio stream track");const G=+new Date;throw this.sendRawMediaEvent({eventName:Mu.acs_calling_start_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:K,isInternal:B,kindOfEvent:"failure",timestampInfo:{deltaTimeInMs:G-J},additionalDetails:{failureReason:F.message||"",code:F.code,subCode:F.subCode}}),F}const $=new MediaStream([Q]);null==Y||Y.setRawMediaStream($,0),this.removeLocalAudioStream(this.localAudioStreams[0]),this.setLocalAudioStream(F);const X=+new Date;this.sendRawMediaEvent({eventName:Mu.acs_calling_start_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:K,kindOfEvent:"success",isInternal:B,localAudioStream:this.localAudioStreams[0],timestampInfo:{deltaTimeInMs:X-J},additionalDetails:""})}))}stopAudioInternal(F=!1){var B,G,W;const z=generateGuid(),K=+new Date;this.sendRawMediaEvent({eventName:Mu.acs_calling_stop_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:z,kindOfEvent:"attempt",isInternal:F,timestampInfo:"",additionalDetails:""});const J=null===(B=this._callAgent.tsStack)||void 0===B?void 0:B.getDeviceManager();if(!(null===(W=null===(G=getAcsEcsConfig())||void 0===G?void 0:G.calling)||void 0===W?void 0:W.allowAccessRawMediaStream)||!(null==J?void 0:J.unsetRawMediaStream)){const B=new CallingCommunicationError({message:"Failed to unset raw input audio stream track",code:ue});this.logger.error("Failed to unset raw input audio stream track");const G=+new Date;throw this.sendRawMediaEvent({eventName:Mu.acs_calling_stop_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:z,isInternal:F,kindOfEvent:"failure",timestampInfo:{deltaTimeInMs:G-K},additionalDetails:{failureReason:B.message||"",code:B.code,subCode:B.subCode}}),B}J.unsetRawMediaStream(0),this.removeLocalAudioStream(this.localAudioStreams[0]);const Q=+new Date;this.sendRawMediaEvent({eventName:Mu.acs_calling_stop_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:z,kindOfEvent:"success",isInternal:F,localAudioStream:this.localAudioStreams[0],timestampInfo:{deltaTimeInMs:Q-K},additionalDetails:""})}bindTsCall(){var F,B,G;void 0!==this.tsCall.callerMri&&(this._callerIdentity=constructIdentifierKindFromMri(this.tsCall.callerMri),this._callerDisplayName=null===(F=this.tsCall.participants.find((F=>F.id===this.tsCall.callerMri)))||void 0===F?void 0:F.displayName),this._lastTsCallState=this.tsCall.state,this.mapTsCallState(this.tsCall.state),this._setCallRole(this.tsCall.advancedMeetingRole),this.tsCall.changed((()=>{if(this.tsCall.callId!==this._id&&(this.logger.log(`tsCall callId changed=${this.tsCall.callId}`),this.sendCallProgressEvent({eventName:Mu.acs_calling_call_progress,timestampInfo:{attemptTimestamp:+new Date},step:"id-changed",additionalProperties:{oldCallId:this._id,newCallId:this.tsCall.callId}}),this._id=this.tsCall.callId,this._eventEmitter.emit("idChanged")),this.tsCall.state!==this._lastTsCallState&&(this.logger.log(`tsCall state changed=${this.tsCall.state}`),this._lastTsCallState=this.tsCall.state,this.mapTsCallState(this.tsCall.state)),this._isScreenSharingOn!==this.tsCall.isScreenSharingOn&&(this.logger.log(`tsCall isScreenSharingOn changed=${this.tsCall.isScreenSharingOn}`),this._isScreenSharingOn=this.tsCall.isScreenSharingOn,this._eventEmitter.emit("isScreenSharingOnChanged")),this._isVideoOn!==this._localVideoStreams.some((F=>"Video"===F.mediaStreamType))){let F=this._localVideoStreams.some((F=>"Video"===F.mediaStreamType));this.logger.log(`tsCall isVideoOn changed=${F}`),this._isVideoOn=F,this._eventEmitter.emit("isVideoOnChanged")}this._isMicrophoneMuted!==this.tsCall.isMuted&&(this.logger.log(`tsCall _isMicrophoneMuted changed=${this.tsCall.isMuted}`),this._isMicrophoneMuted=this.tsCall.isMuted,this._handleMuteChanges()),this._isSpeakerMuted!==this.tsCall.isSpeakerMuted&&(this.logger.log(`tsCall _isSpeakerMuted changed=${this.tsCall.isSpeakerMuted}`),this._isSpeakerMuted=this.tsCall.isSpeakerMuted,this._handleIncomingAudioMuteChanges()),this.tsCall.advancedMeetingRole!==this._lastTsCallAdvancedMeetingRole&&(this.logger.log(`tsCall advancedMeetingRole changed=${this.tsCall.advancedMeetingRole}`),this._setCallRole(this.tsCall.advancedMeetingRole))})),this._isServerMuted=this.tsCall.isServerMuted,this.tsCall.on("serverMutedChanged",(()=>{this.tsCall.isServerMuted!==this._isServerMuted&&(this.logger.log(`tsCall isServerMuted changed=${this.tsCall.isServerMuted}`),this._isServerMuted=this.tsCall.isServerMuted,this._handleMuteChanges())})),this.tsCall.participantCounts&&(this._totalParticipantCount=this.tsCall.participantCounts.totalParticipants),this.tsCall.on("participantCountsUpdated",(()=>{if(this.tsCall.participantCounts&&this._totalParticipantCount!==this.tsCall.participantCounts.totalParticipants){const F=this._totalParticipantCount;this._totalParticipantCount=this.tsCall.participantCounts.totalParticipants,this.logger.log(`tsCall totalParticipantCount changed from ${F} to ${this._totalParticipantCount}`),this._eventEmitter.emit("totalParticipantCountChanged");try{this.stats.recordEvent({name:Ou.number_of_participants,callId:this.id,localParticipantId:this.tsCall.participantId,data:{totalParticipantCount:this._totalParticipantCount,previousParticipantCount:F}})}catch(F){this.logger.error("failed to send participant count change telemetry")}}})),this.tsCall.on("callQualityChanged",(F=>__awaiter$f(this,void 0,void 0,(function*(){var B,G,W,z,K,J;try{let Q;Q=5===F.type||32===F.type||2===F.type||1===F.type||37===F.type?Ou.network_quality:44===F.type||43===F.type||9===F.type||25===F.type||27===F.type||45===F.type||33===F.type||34===F.type||55===F.type||26===F.type||47===F.type?Ou.video_device_issue:Ou.other_diagnostic,3===F.value||2===F.value?(this.logger.warn(`Ufd error raised!, ufd=${F.type}, value=${F.value}, kind=${Q}`),Q===Ou.network_quality&&window.dispatchEvent(new CustomEvent("online",{detail:!1}))):(this.logger.warn(`Ufd error recovered!, ufd=${F.type}, value=${F.value}, kind=${Q}`),Q===Ou.network_quality&&window.dispatchEvent(new CustomEvent("online",{detail:!0})));const Y={type:F.type.toString(),level:F.value,mediaType:F.mediaType};if(this.stats.recordEvent({name:Q,callId:this.id,localParticipantId:this.tsCall.participantId,data:Y}),this.shallStopVideo(F)){const B=+new Date,G=generateGuid();this.logger.warn(`Attempting to stop video gracefully due to video ufd being raised.UFD: ${F.type}, value: ${F.value}, call direction: ${this._direction}`),this.sendAudioEvent({eventName:Mu.acs_calling_stop_video_on_ufd_attempt,timestampInfo:{attemptTimestamp:B},correlationId:G,step:"mid-call"});try{this.stopVideo(this.localVideoStreams[0])}catch(B){const G=`Failed to stop video on video device start failed or capture mute event ${F.type} with value ${F.value}`;this.logger.error(G)}}if(this.shallRemoveLocalVideoStreamOnBadUfd(F)){this.removeLocalVideoStream(this.localVideoStreams[0]);const B=new CallingCommunicationError({message:`Removing local video stream due to video fail UFD beign raised before call connected. UFD: ${F.type}, value: ${F.value}, call direction: ${this._direction}`,code:ce});this.logger.error(B.message)}if(this.shallStopAudio(F)){const Q=+new Date,Y=generateGuid();if((null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.calling)||void 0===G?void 0:G.allowMuteOnBadUfd)&&!this.tsCall.isMuted){this.sendAudioEvent({eventName:Mu.acs_calling_mute_on_ufd_attempt,timestampInfo:{attemptTimestamp:Q},correlationId:Y,step:"mid-call"});try{yield this.mute()}catch(B){const G=`Failed to mute on microphone device not functioning or capture mute event ${F.type} with value ${F.value}`;this.logger.error(G)}}if(null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.calling)||void 0===z?void 0:z.preventStopAudio)return this.sendAudioEvent({eventName:Mu.acs_calling_prevent_stop_audio,timestampInfo:{attemptTimestamp:Q},correlationId:Y,step:"mid-call"}),void(!(null===(J=null===(K=getAcsEcsConfig())||void 0===K?void 0:K.calling)||void 0===J?void 0:J.preventFakeMute)&&this.markCallMuted());this.sendAudioEvent({eventName:Mu.acs_calling_stop_audio_attempt,timestampInfo:{attemptTimestamp:Q},correlationId:Y,step:"mid-call"});try{yield this.tsCall.stopAudio(),this.markCallMuted();const F=+new Date;this.sendAudioEvent({eventName:Mu.acs_calling_stop_audio_success,timestampInfo:{deltaTimeInMs:F-Q},correlationId:Y,step:"mid-call"})}catch(B){const G=`Failed to stop audio on microphone device not functioning or capture mute event ${F.type} with value ${F.value}`,W=new CallingCommunicationError({message:G,code:ne},B);this.logger.error(G);const z=+new Date;this.sendAudioEvent({eventName:Mu.acs_calling_stop_audio_failure,timestampInfo:{deltaTimeInMs:z-Q},correlationId:Y,step:"mid-call"},W)}}this.audioDidAutoRecover(F)&&(this._isDeviceNotFunctioningMuted=!1,this._handleMuteChanges())}catch(F){this.logger.error("Failed to send ufd telemetry")}})))),this.tsCall.on("participantAdded",(F=>__awaiter$f(this,void 0,void 0,(function*(){var B;this.logger.debug("tsCall participant added");const G=[];null===(B=F.endpoints)||void 0===B||B.endpointDetails.forEach((F=>G.push(F.participantId))),0===G.length&&G.push("remoteParticipantId unavailable");const W=constructIdentifierKindFromMri(F.id);if(this.sendParticipantAddedOrRemovedEvent(!0,G),isCallingApplication(F.id))return this.logger.info("Add participant: Handle calling application"),void this._handleCallingApplicationIdentifier(F);this._handleRemoteRingingForOutgoingCall(F);try{const B=this.getOrCreateRemoteParticipant(W);B.observeParticipant(F),this._eventEmitter.emit("remoteParticipantsUpdated",{added:[B],removed:[]})}catch(F){this.logger.log("unable to map call participant to ACS user")}})))),this.logger.debug(`tsCall current participant count=${null===(G=null===(B=this.tsCall)||void 0===B?void 0:B.participants)||void 0===G?void 0:G.length}`),this.tsCall.participants.forEach((F=>{const B=constructIdentifierKindFromMri(F.id),G=this.getOrCreateRemoteParticipant(B);this._handleRemoteRingingForOutgoingCall(F),G.observeParticipant(F)})),this.tsCall.on("participantRemoved",(F=>__awaiter$f(this,void 0,void 0,(function*(){var B;this.logger.debug("tsCall participant removed");const G=[];if(null===(B=F.endpoints)||void 0===B||B.endpointDetails.forEach((F=>G.push(F.participantId))),0===G.length&&G.push("remoteParticipantId unavailable"),this.sendParticipantAddedOrRemovedEvent(!1,G),isCallingApplication(F.id))return void this.logger.info("Remove participant: Ignore calling application");const W=F.id;if(W){const B=this._remoteParticipants.find((F=>getMriFromIdentifier(F.identifier)===W));B?(0!==F.stateReason&&B.setCallEndReason(this._getTsParticipantCallEndReason(F)),this._remoteParticipants.splice(this._remoteParticipants.indexOf(B),1),this._eventEmitter.emit("remoteParticipantsUpdated",{added:[],removed:[B]})):this.logger.log("unable to find participant to remove")}}))))}startCallInternal(F,B,G,W){var z,K,J,Q,Y;return __awaiter$f(this,void 0,void 0,(function*(){let $,X,Z,ee;const ne=+new Date,ie=generateGuid(),re={joinContextDescription:getJoinContextDescription(G),additionalProperties:{EmergencyCountryCode:(null===(z=this._callAgent._caConfigBag)||void 0===z?void 0:z.emergencyCountryCode)||"",IsUserEmergencyCountryCode:(null===(K=this._callAgent._caConfigBag)||void 0===K?void 0:K.IsUserEmergencyCountryCode)||!1,trouterState:this._callAgent.getTrouterState()}};this.sendCallStageEvent({eventName:Mu.acs_calling_call_attempt,correlationId:ie,timestampInfo:{attemptTimestamp:ne},additionalPayload:re});try{$=!!(null===(J=null==F?void 0:F.audioOptions)||void 0===J?void 0:J.muted),void 0===$&&($=!1),this._isMicrophoneMuted=$,(null==F?void 0:F.alternateCallerId)&&(ee=getMriFromIdentifier(F.alternateCallerId)),X=this.getLocalVideoStreamFromCallOptions(F),this.setLocalVideoStream(X),Z=this.getLocalAudioStreamFromCallOptions(F),this.setLocalAudioStream(Z)}catch(F){const B=+new Date,G=new CallingCommunicationError({message:"Failed to instantiate the Call.",code:ue},F);throw this.sendCallStageEvent({eventName:Mu.acs_calling_call_failed,correlationId:ie,timestampInfo:{deltaTimeInMs:B-ne},additionalPayload:re},G),this.logger.error(G.message),G}try{this.tsCall.init(W),X&&this.sendVideoEvent({correlationId:ie,eventName:Mu.acs_calling_start_video_attempt,timestampInfo:{attemptTimestamp:ne},localVideoStream:X,step:"start",isScreenSharingOn:this._isScreenSharingOn});let F={};(null===(Y=null===(Q=getAcsEcsConfig())||void 0===Q?void 0:Q.calling)||void 0===Y?void 0:Y.supportLiveStreaming)&&(F={clientEndpointCapabilities:32}),B?yield this.tsCall.startWithMeetingData(te.generateCauseId(),Object.assign({withVideo:!!X,muted:$,ringOthers:!0,alternateId:ee,shouldResurrect:"resurrect",receiveOnlyAudioOnCallStart:!!Z},F)):yield this.tsCall.start(Object.assign({withVideo:!!X,muted:$,ringOthers:!0,alternateId:ee,receiveOnlyAudioOnCallStart:!!Z},F));const G=+new Date;this.sendCallStageEvent({eventName:Mu.acs_calling_call_connected,correlationId:ie,timestampInfo:{deltaTimeInMs:G-ne},additionalPayload:re}),X&&this.shallRemoveLvsAfterConnectedSuccessfully(X,"start",ie,G,ne),Z&&(this.startAudioInternal(Z,!0).catch((F=>{})),this.shallRemoveLasAfterConnectedSuccessfully(Z,"start",ie,G,ne))}catch(F){const B=+new Date,G=handleCallOperationFailure(F,this.logger,this.tsCall);throw X&&(this.sendVideoEvent({correlationId:ie,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:B-ne},localVideoStream:X,step:"start",isScreenSharingOn:this._isScreenSharingOn},G),this.removeLocalVideoStream(X)),Z&&this.removeLocalAudioStream(Z),this.sendCallStageEvent({eventName:Mu.acs_calling_call_failed,correlationId:ie,timestampInfo:{deltaTimeInMs:B-ne},additionalPayload:re},G),this.logger.error(`Failed to start the call, code=${null==G?void 0:G.code}, subCode=${null==G?void 0:G.subCode}`),G}}))}feature(F){return this._extensibleApi.getApiObjectInstance(F.callApiCtor)}hangUp(F){return __awaiter$f(this,void 0,void 0,(function*(){const B=+new Date,G=generateGuid();return this.sendCallStageEvent({eventName:Mu.acs_calling_call_hangup_attempt,correlationId:G,timestampInfo:{attemptTimestamp:B}}),this.tsCall.stop(null==F?void 0:F.forEveryone).then((()=>{const F=+new Date;this.sendCallStageEvent({eventName:Mu.acs_calling_call_hangup_success,correlationId:G,timestampInfo:{deltaTimeInMs:F-B}})})).catch((F=>{const W=+new Date,z=handleCallOperationFailure(F,this.logger,this.tsCall);throw this.sendCallStageEvent({eventName:Mu.acs_calling_call_hangup_failure,correlationId:G,timestampInfo:{deltaTimeInMs:W-B}},z),z}))}))}mute(){return __awaiter$f(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(_e.Mute),B=+new Date,G=generateGuid();this.sendAudioEvent({eventName:Mu.acs_calling_mute_attempt,eventType:Du.MuteMicrophone,timestampInfo:{attemptTimestamp:B},correlationId:G,step:"mid-call"});try{F.info("mute"),yield this.tsCall.mute(),F.info("mute success");const W=+new Date;this.sendAudioEvent({eventName:Mu.acs_calling_mute_success,eventType:Du.MuteMicrophone,timestampInfo:{deltaTimeInMs:W-B},correlationId:G,step:"mid-call"})}catch(W){const z=new CallingCommunicationError({message:"Failed to mute microphone",code:ne});F.error("Failed to mute microphone");const K=+new Date;throw this.sendAudioEvent({eventName:Mu.acs_calling_mute_failure,eventType:Du.MuteMicrophone,timestampInfo:{deltaTimeInMs:K-B},correlationId:G,step:"mid-call"},z),z}}))}unmute(){var F,B;return __awaiter$f(this,void 0,void 0,(function*(){const G=this.logger.createFnLogger(_e.Unmute),W=+new Date,z=generateGuid();let K=!1;this.sendAudioEvent({eventName:Mu.acs_calling_unmute_attempt,eventType:Du.UnmuteMicrophone,timestampInfo:{attemptTimestamp:W},correlationId:z,step:"mid-call"});try{G.info("unmute"),yield this.tsCall.unmute(),G.info("unmute success");const J=+new Date;this.sendAudioEvent({eventName:Mu.acs_calling_unmute_success,eventType:Du.UnmuteMicrophone,timestampInfo:{deltaTimeInMs:J-W},correlationId:z,step:"mid-call"});const Q=+new Date;if(!(null===(B=null===(F=getAcsEcsConfig())||void 0===F?void 0:F.calling)||void 0===B?void 0:B.preventStopAudio)&&this._isDeviceNotFunctioningMuted){this.sendAudioEvent({eventName:Mu.acs_calling_start_audio_attempt,timestampInfo:{attemptTimestamp:Q},correlationId:z,step:"mid-call"}),K=!0,G.info("start audio"),yield this.tsCall.startAudio(),G.info("start audio success");const F=+new Date;this._isDeviceNotFunctioningMuted=!1,this._handleMuteChanges(),this.sendAudioEvent({eventName:Mu.acs_calling_start_audio_success,timestampInfo:{deltaTimeInMs:F-Q},correlationId:z,step:"mid-call"})}}catch(F){const B=K?"Failed to unmute and start audio, microphone device not functioning":"Failed to unmute microphone",J=new CallingCommunicationError({message:B,code:ne},F);G.error(B);const Q=+new Date;throw this.sendAudioEvent({eventName:K?Mu.acs_calling_start_audio_failure:Mu.acs_calling_unmute_failure,eventType:K?void 0:Du.UnmuteMicrophone,timestampInfo:{deltaTimeInMs:Q-W},correlationId:z,step:"mid-call"},J),J}}))}muteIncomingAudio(){return __awaiter$f(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(_e.MuteIncomingAudio),B=+new Date,G=generateGuid();this.sendAudioEvent({eventName:Mu.acs_calling_mute_attempt,eventType:Du.MuteIncomingAudio,timestampInfo:{attemptTimestamp:B},correlationId:G,step:"mid-call"});try{yield this.tsCall.muteSpeaker();const F=+new Date;this.sendAudioEvent({eventName:Mu.acs_calling_mute_success,eventType:Du.MuteIncomingAudio,timestampInfo:{deltaTimeInMs:F-B},correlationId:G,step:"mid-call"})}catch(W){const z="Failed to mute incoming audio",K=new CallingCommunicationError({message:z,code:ne},W);F.error(z);const J=+new Date;throw this.sendAudioEvent({eventName:Mu.acs_calling_mute_failure,eventType:Du.MuteIncomingAudio,timestampInfo:{deltaTimeInMs:J-B},correlationId:G,step:"mid-call"},K),K}}))}unmuteIncomingAudio(){return __awaiter$f(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(_e.MuteIncomingAudio),B=+new Date,G=generateGuid();this.sendAudioEvent({eventName:Mu.acs_calling_unmute_attempt,eventType:Du.UnmuteIncomingAudio,timestampInfo:{attemptTimestamp:B},correlationId:G,step:"mid-call"});try{yield this.tsCall.unmuteSpeaker();const F=+new Date;this.sendAudioEvent({eventName:Mu.acs_calling_unmute_success,eventType:Du.UnmuteIncomingAudio,timestampInfo:{deltaTimeInMs:F-B},correlationId:G,step:"mid-call"})}catch(W){const z="Failed to unmute incoming audio",K=new CallingCommunicationError({message:z,code:ne},W);F.error(z);const J=+new Date;throw this.sendAudioEvent({eventName:Mu.acs_calling_unmute_failure,eventType:Du.UnmuteIncomingAudio,timestampInfo:{deltaTimeInMs:J-B},correlationId:G,step:"mid-call"},K),K}}))}sendDtmf(F){return __awaiter$f(this,void 0,void 0,(function*(){const B=toDtmfTone(F);return this.tsCall.sendDtmfTone(B).catch((F=>{throw this.logger.error("Failed to send DTMF tone"),new CallingCommunicationError({message:"Failed to send DTMF tone",code:ne})}))}))}startVideo(F){var B,G;return __awaiter$f(this,void 0,void 0,(function*(){const W=this.logger.createFnLogger(_e.StartVideo),z=+new Date,K=generateGuid(),J=null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.calling)||void 0===G?void 0:G.preventStopAudio;if(this.sendVideoEvent({eventName:Mu.acs_calling_start_video_attempt,timestampInfo:{attemptTimestamp:z},localVideoStream:F,correlationId:K,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn}),this._isDeviceNotFunctioningMuted&&!J){this.sendAudioEvent({eventName:Mu.acs_calling_start_audio_attempt,timestampInfo:{attemptTimestamp:z},correlationId:K,step:"mid-call"});try{W.info("start audio before starting video"),yield this.tsCall.startAudio(),W.info("start audio success before starting video");const F=+new Date;this._isDeviceNotFunctioningMuted=!1,this._handleMuteChanges(),this.sendAudioEvent({eventName:Mu.acs_calling_start_audio_success,timestampInfo:{deltaTimeInMs:F-z},correlationId:K,step:"mid-call"})}catch(F){const B="Failed to start audio before starting video",G=new CallingCommunicationError({message:B,code:ne},F);W.error(B);const J=+new Date;throw this.sendAudioEvent({eventName:Mu.acs_calling_start_audio_failure,timestampInfo:{deltaTimeInMs:J-z},correlationId:K,step:"mid-call"},G),G}}if(!F){const B=new CallingCommunicationError({message:"Failed to start video, localVideoStream cannot be null",code:ne});throw this.sendVideoEvent({correlationId:K,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:z},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},B),B}if(!(F instanceof LocalVideoStream)){const B=new CallingCommunicationError({message:"Failed to start video, localVideoStream is not an instance of LocalVideoStream",code:ne});throw this.sendVideoEvent({correlationId:K,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:z},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},B),B}if(this.tsCall.isVideoOn){const B=new CallingCommunicationError({message:"Failed to start video, local video is already on",code:ne});throw this.sendVideoEvent({correlationId:K,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:z},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},B),B}if(this.localVideoStreams[0]){const B=new CallingCommunicationError({message:"Local video is already on, stop it first",code:ne});throw this.sendVideoEvent({correlationId:K,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:z},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},B),B}this.setLocalVideoStream(F);try{W.info("start video"),yield this.tsCall.startVideo();const B=+new Date;this.sendVideoEvent({correlationId:K,eventName:Mu.acs_calling_start_video_success,timestampInfo:{deltaTimeInMs:B-z},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn}),W.info("video started")}catch(B){const G=+new Date,J=handleVideoOperationFailure(W,B);throw this.sendVideoEvent({correlationId:K,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:G-z},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},J),this.removeLocalVideoStream(F),J}}))}stopVideo(F){return __awaiter$f(this,void 0,void 0,(function*(){const B=this.logger.createFnLogger(_e.StopVideo),G=+new Date,W=generateGuid();if(this.sendVideoEvent({correlationId:W,eventName:Mu.acs_calling_stop_video_attempt,timestampInfo:{attemptTimestamp:G},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn}),!this.tsCall.isVideoOn){const B=new CallingCommunicationError({message:"Failed to stop video, local video is already off",code:ne});throw this.sendVideoEvent({correlationId:W,eventName:Mu.acs_calling_stop_video_failure,timestampInfo:{attemptTimestamp:G},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},B),B}if(this.localVideoStreams[0]!==F){const B=new CallingCommunicationError({message:"Invalid LocalVideoStream, this LocalVideoStream is not being sent",code:ne});throw this.sendVideoEvent({correlationId:W,eventName:Mu.acs_calling_stop_video_failure,timestampInfo:{attemptTimestamp:G},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},B),B}try{B.info("stop video"),yield this.tsCall.stopVideo();const z=+new Date;this.sendVideoEvent({correlationId:W,eventName:Mu.acs_calling_stop_video_success,timestampInfo:{deltaTimeInMs:z-G},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn}),B.info("video stopped"),this.removeLocalVideoStream(F)}catch(z){const K=+new Date,J=handleVideoOperationFailure(B,z);throw this.sendVideoEvent({correlationId:W,eventName:Mu.acs_calling_stop_video_failure,timestampInfo:{deltaTimeInMs:K-G},localVideoStream:F,step:"mid-call",isScreenSharingOn:this._isScreenSharingOn},J),J}}))}startAudio(F){return this.startAudioInternal(F)}stopAudio(){return this.stopAudioInternal()}hold(){return __awaiter$f(this,void 0,void 0,(function*(){return this.tsCall.hold().catch((F=>{throw this.logger.error("Failed to hold call"),new CallingCommunicationError({message:"Failed to hold call",code:ne})}))}))}resume(){return __awaiter$f(this,void 0,void 0,(function*(){return this.tsCall.unhold().catch((F=>{throw this.logger.error("Failed to resume call"),new CallingCommunicationError({message:"Failed to resume call",code:ne})}))}))}startScreenSharing(){return __awaiter$f(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(_e.StartScreenShare),B=+new Date,G=generateGuid();return this.sendScreenShareEvent({eventName:Mu.acs_calling_start_screen_share,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"attempt",timestampInfo:"",additionalDetails:"",isVideoOn:this._isVideoOn}),this.tsCall.startScreenSharing().then((()=>{const F=+new Date;this.sendScreenShareEvent({eventName:Mu.acs_calling_start_screen_share,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"success",timestampInfo:{deltaTimeInMs:F-B},additionalDetails:"",isVideoOn:this._isVideoOn})})).catch((W=>{const z=+new Date,K=handleVideoOperationFailure(F,W);let J="string"==typeof(null==K?void 0:K.message)?null==K?void 0:K.message:void 0;throw this.sendScreenShareEvent({eventName:Mu.acs_calling_start_screen_share,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"failure",timestampInfo:{deltaTimeInMs:z-B},additionalDetails:{failureReason:J||"",code:K.code,subCode:K.subCode},isVideoOn:this._isVideoOn}),K}))}))}stopScreenSharing(){return __awaiter$f(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(_e.StopScreenShare),B=+new Date,G=generateGuid();return this.sendScreenShareEvent({eventName:Mu.acs_calling_stop_screen_share,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"attempt",timestampInfo:"",additionalDetails:"",isVideoOn:this._isVideoOn}),this.tsCall.stopScreenSharing().then((()=>{const F=+new Date;this.sendScreenShareEvent({eventName:Mu.acs_calling_stop_screen_share,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"success",timestampInfo:{deltaTimeInMs:F-B},additionalDetails:"",isVideoOn:this._isVideoOn})})).catch((W=>{const z=+new Date,K=handleVideoOperationFailure(F,W);let J="string"==typeof(null==K?void 0:K.message)?null==K?void 0:K.message:void 0;throw this.sendScreenShareEvent({eventName:Mu.acs_calling_stop_screen_share,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"failure",timestampInfo:{deltaTimeInMs:z-B},additionalDetails:{failureReason:J||"",code:K.code,subCode:K.subCode},isVideoOn:this._isVideoOn}),K}))}))}on(F,B){if("stateChanged"!==F&&"idChanged"!==F&&"isMutedChanged"!==F&&"isIncomingAudioMutedChanged"!==F&&"isScreenSharingOnChanged"!==F&&"isVideoOnChanged"!==F&&"remoteParticipantsUpdated"!==F&&"localVideoStreamsUpdated"!==F&&"localAudioStreamsUpdated"!==F&&"remoteAudioStreamsUpdated"!==F&&"totalParticipantCountChanged"!==F&&"roleChanged"!=F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("stateChanged"!==F&&"idChanged"!==F&&"isMutedChanged"!==F&&"isIncomingAudioMutedChanged"!=F&&"isScreenSharingOnChanged"!==F&&"isVideoOnChanged"!==F&&"remoteParticipantsUpdated"!==F&&"localVideoStreamsUpdated"!==F&&"localAudioStreamsUpdated"!==F&&"remoteAudioStreamsUpdated"!==F&&"totalParticipantCountChanged"!=F&&"roleChanged"!=F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}sendVideoEvent(F,B){var G;try{let W,z;try{W=null===(G=F.localVideoStream)||void 0===G?void 0:G.getStreamMetadata()}catch(F){this.logger.error("Unable to get stream meta data on send video event")}try{z=this.tsCall.mediaStreams[0][0].id}catch(F){}let K="string"==typeof(null==B?void 0:B.message)?null==B?void 0:B.message:void 0;F.eventName!==String(Mu.acs_calling_start_video_failure)&&F.eventName!==String(Mu.acs_calling_stop_video_failure)&&(K=void 0),this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:Object.assign(Object.assign({callId:this.id,localParticipantId:this.tsCall.participantId,timestampInfo:F.timestampInfo,correlationId:F.correlationId,step:F.step||""},W),{failureReason:K||"",sourceId:z||"",isScreenSharingOn:this._isScreenSharingOn})})}catch(F){this.logger.debug("Unable to send video telemetry")}}sendScreenShareEvent(F){try{this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:F})}catch(F){this.logger.debug("Unable to send screen share telemetry")}}sendRawMediaEvent(F){var B;const G=Object.assign({},F);G.localAudioStream=(null===(B=F.localAudioStream)||void 0===B?void 0:B.source)instanceof MediaStreamTrack?"MediaStreamTrack":"Device";try{this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:G})}catch(F){this.logger.debug("Unable to send raw media telemetry")}}sendAudioEvent(F,B){try{let G="string"==typeof(null==B?void 0:B.message)?null==B?void 0:B.message:void 0;F.eventName!==String(Mu.acs_calling_mute_failure)&&F.eventName!==String(Mu.acs_calling_unmute_failure)&&(G=void 0);const W={callId:this.id,localParticipantId:this.tsCall.participantId,timestampInfo:F.timestampInfo,correlationId:F.correlationId,step:F.step||"",failureReason:G||""};void 0!==F.eventType&&(W.eventType=F.eventType),this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:W})}catch(F){this.logger.debug("Unable to send audio telemetry")}}sendCallStageEvent(F,B){var G,W,z,K,J,Q;try{const Y=B instanceof CallingCommunicationError?B.message:"";let $;B&&($=(null===(G=null==this?void 0:this.tsCall)||void 0===G?void 0:G.callEndDiagnosticsInfo)||{});const X=Object.assign({localParticipantId:(null===(W=null==this?void 0:this.tsCall)||void 0===W?void 0:W.participantId)||"",callId:(null===(z=null==this?void 0:this.tsCall)||void 0===z?void 0:z.callId)||"",callType:(null===(K=null==this?void 0:this.tsCall)||void 0===K?void 0:K.callType)||"",callDirection:this._direction,failureReason:Y,callEndDiagnosticsInfo:$,groupJoin:!!(null===(J=null==this?void 0:this.tsCall)||void 0===J?void 0:J.groupId),meetingJoin:!!(null===(Q=null==this?void 0:this.tsCall)||void 0===Q?void 0:Q.meetingInfo),correlationId:F.correlationId,timestampInfo:F.timestampInfo},F.additionalPayload);this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:X})}catch(F){}}sendCallProgressEvent(F,B){var G,W,z,K,J,Q;try{const Y=B instanceof CallingCommunicationError?B.message:"",$=ap[this.tsCall.state]?ap[this.tsCall.state]:`unmapped TsCall state at acs layer: ${JSON.stringify(this.tsCall.state)}`;let X;B&&(X=(null===(G=null==this?void 0:this.tsCall)||void 0===G?void 0:G.callEndDiagnosticsInfo)||{});const Z=F.additionalProperties;getAcsEcsConfig().telemetry.gzipTelemetryPayload&&(Z.diagnosticInfo?(Z.diagnosticInfo.telemetryPayloadBytesOriginal=TelemetryLogManager.telemetryPayloadBytesOriginal,Z.diagnosticInfo.telemetryPayloadBytesCompressed=TelemetryLogManager.telemetryPayloadBytesCompressed):Z.diagnosticInfo={telemetryPayloadBytesOriginal:TelemetryLogManager.telemetryPayloadBytesOriginal,telemetryPayloadBytesCompressed:TelemetryLogManager.telemetryPayloadBytesCompressed},"Connecting"===Z.newState&&(TelemetryLogManager.telemetryPayloadBytesOriginal=0,TelemetryLogManager.telemetryPayloadBytesCompressed=0));const ee=Object.assign({localParticipantId:(null===(W=null==this?void 0:this.tsCall)||void 0===W?void 0:W.participantId)||"",callId:(null===(z=null==this?void 0:this.tsCall)||void 0===z?void 0:z.callId)||"",callType:(null===(K=null==this?void 0:this.tsCall)||void 0===K?void 0:K.callType)||"",callDirection:this._direction,failureReason:Y,callEndDiagnosticsInfo:X,groupJoin:!!(null===(J=null==this?void 0:this.tsCall)||void 0===J?void 0:J.groupId),meetingJoin:!!(null===(Q=null==this?void 0:this.tsCall)||void 0===Q?void 0:Q.meetingInfo),step:F.step,timestampInfo:F.timestampInfo,state:$},F.additionalProperties);this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:ee})}catch(F){}}sendRoleEvent(F,B){try{let G="string"==typeof(null==B?void 0:B.message)?null==B?void 0:B.message:void 0;F.eventName!==String(Mu.acs_calling_map_role_failure)&&(G=void 0),this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:{callId:this.id,localParticipantId:this.tsCall.participantId,timestampInfo:F.timestampInfo,correlationId:F.correlationId,failureReason:G||""}})}catch(F){this.logger.debug("Unable to send role telemetry")}}setLocalVideoStream(F){if(!this._callAgent.tsStack)throw new CallingCommunicationError({message:"Failed to process video because of internal call stack error",code:ue});F&&(this._localVideoStreams.push(F),this._callAgent.tsStack.getDeviceManager().selectDevices({camera:F.source.id}),this._eventEmitter.emit("localVideoStreamsUpdated",{added:[F],removed:[]}))}removeLocalVideoStream(F){if(F){this.logger.log("Attempting to remove local video stream");if(0===this._localVideoStreams.splice(this._localVideoStreams.indexOf(F),1).length)return void this.logger.warn("Stream not found, failed to remove stream from localVideoStreams collection");this.logger.log("Local video stream removed successfully"),this._eventEmitter.emit("localVideoStreamsUpdated",{added:[],removed:[F]})}}setLocalAudioStream(F){if(!this._callAgent.tsStack)throw new CallingCommunicationError({message:"Failed to process audio because of internal call stack error",code:ue});getAcsEcsConfig().calling.allowAccessRawMediaStream&&F&&(F.on("audioSourceChanged",this.audioSourceChanged),this._localAudioStreams.push(F),this._eventEmitter.emit("localAudioStreamsUpdated",{added:[F],removed:[]}))}removeLocalAudioStream(F){if(F){this.logger.log("Attempting to remove local audio stream"),F.off("audioSourceChanged",this.audioSourceChanged);if(0===this._localAudioStreams.splice(this._localAudioStreams.indexOf(F),1).length)return void this.logger.warn("Stream not found, failed to remove stream from localAudioStreams collection");this.logger.log("Local audio stream removed successfully"),this._eventEmitter.emit("localAudioStreamsUpdated",{added:[],removed:[F]})}}mapTsCallState(F){let B;if(ap[F])if(B=ap[F],"Disconnected"===B){this._callEndReason=this._getCallEndReason(),this._remoteParticipants.forEach((F=>{F.setParticipantState("Disconnected"),F.setCallEndReason(this._getTsParticipantCallEndReason(F.tsRemoteParticipant))}));const G=this._remoteParticipants.map((F=>F));this._remoteParticipants=[],this._eventEmitter.emit("remoteParticipantsUpdated",{added:[],removed:G}),this.localVideoStreams[0]&&this.removeLocalVideoStream(this.localVideoStreams[0]),getAcsEcsConfig().calling.allowAccessRawMediaStream&&this.localAudioStreams[0]&&this.removeLocalAudioStream(this.localAudioStreams[0]),getAcsEcsConfig().calling.allowAccessRawMediaStream&&this.remoteAudioStreams[0]&&this.removeRemoteAudioStream(this.remoteAudioStreams[0]),this._telemetryLogManager.flushAllEvents(this.id).then((()=>{this.logger.log("Telemetry flushed")})).catch((F=>{this.logger.warn("Failed to flush telemetry log manager events")})).then((()=>{this.logger.log(`Mapped tsCall state:${F} to ${B}`),this._setCallState(B)}))}else"Connected"===B?(this.logger.log(`Mapped tsCall state:${F} to ${B}`),this._setCallState(B),this.setOrUpdateMediaMetricsDeviceEvents(),getAcsEcsConfig().calling.allowAccessRawMediaStream&&this.remoteAudioStreams):(this.logger.log(`Mapped tsCall state:${F} to ${B}`),this._setCallState(B));else this.logger.log(`Unable to map tsCall state \`${F}\`, to ACS Call state`)}_getTsParticipantCallEndReason(F){let B=0,G=0,W="Unknown";if(F){if(F.callEndDiagnosticsInfo)B=F.callEndDiagnosticsInfo&&F.callEndDiagnosticsInfo.callControllerCode||0,G=F.callEndDiagnosticsInfo&&F.callEndDiagnosticsInfo.callControllerSubCode||0;else{const F=this._getCallEndReason();B=F.code,G=F.subCode||0}W=convertParticipantStateReasonToString(F.stateReason)}return this.logger[0===B?"info":"error"](`Participant call end reason=${W}, code=${B}, subCode=${G}`),{code:B,subCode:G}}shallStopVideo(F){var B,G,W,z,K,J;const Q=null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.calling)||void 0===G?void 0:G.deviceNotFunctioningMuted,Y=null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.calling)||void 0===z?void 0:z.deviceCaptureMutedVideo,$=null===(J=null===(K=getAcsEcsConfig())||void 0===K?void 0:K.calling)||void 0===J?void 0:J.preventStopVideo,X=25===F.type&&3===F.value,Z=X&&1===F.mediaType,ee=33===F.type&&3===F.value,te="ios"===getOS()&&"safari"===getPlatformName(),ne="android"===getOS(),ie=3===this.tsCall.state;return $?ie&&this.tsCall.isVideoOn&&ee:Q&&ie&&this.tsCall.isVideoOn&&(ee||te&&X||Y&&ne&&Z)}shallRemoveLocalVideoStreamOnBadUfd(F){var B,G;const W=this.tsCall.localMediaStreams.find((F=>1===F.mediaType)),z=1===F.mediaType&&3===F.value&&25===F.type,K=4==this.tsCall.state||5===this.tsCall.state;if("Mobile"===getBrowserInfo().formFactor&&(z||"hidden"==document.visibilityState)&&this.localVideoStreams[0]&&K&&!W)return!1;if(!(null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.calling)||void 0===G?void 0:G.removeLvsCheckOnCallStartAndCallAccept))return!1;const J=3===this.tsCall.state;return 1===F.mediaType&&3===F.value&&(33===F.type||25===F.type||34===F.type)&&!!this.localVideoStreams[0]&&!J&&!W}shallStopAudio(F){var B,G,W,z;const K=null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.calling)||void 0===G?void 0:G.deviceNotFunctioningMuted,J=null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.calling)||void 0===z?void 0:z.osAutoRecoverAudio,Q=25===F.type&&3===F.value&&0===F.mediaType,Y=9===F.type&&3===F.value,$="ios"===getOS()&&"safari"===getPlatformName(),X=3===this.tsCall.state;return J?K&&X&&Y:K&&!this._isDeviceNotFunctioningMuted&&X&&(Y||$&&Q)}markCallMuted(){this._isDeviceNotFunctioningMuted=!0,this._handleMuteChanges()}audioDidAutoRecover(F){var B,G,W,z;const K=(null===(G=null===(B=getAcsEcsConfig())||void 0===B?void 0:B.calling)||void 0===G?void 0:G.deviceCaptureMuteRecover)&&!(null===(z=null===(W=getAcsEcsConfig())||void 0===W?void 0:W.calling)||void 0===z?void 0:z.preventFakeMute),J=25===F.type&&1===F.value&&0===F.mediaType,Q=3===this.tsCall.state,Y="ios"===getOS()&&"safari"===getPlatformName(),$=9===F.type&&1===F.value;return K&&this._isDeviceNotFunctioningMuted&&Q&&($||Y&&J)}sendParticipantAddedOrRemovedEvent(F,B){try{this._telemetryLogManager.sendEvent({name:Mu.acs_calling_participant_added_or_removed,tenant:ft,properties:{callId:this.id,remotePerticipantId:B||"",participantAddedOrRemoved:F?"added":"removed",localParticipantId:this.tsCall.participantId}})}catch(F){this.logger.debug("Unable to send participant added telemtery")}}_handleRemoteRingingForOutgoingCall(F){F.changed((()=>{2===F.state&&"Connected"!==this._state&&"Outgoing"==this._direction&&this._setCallState("Ringing")}))}_setCallState(F){F!==this._state&&(this.logger.log(`state changed from ${this._state} to ${F}`),this.sendCallProgressEvent({eventName:Mu.acs_calling_call_progress,step:"state-changed",timestampInfo:{attemptTimestamp:+new Date},additionalProperties:{oldState:this._state,newState:F,diagnosticInfo:this.tsCall.callEndDiagnosticsInfo?this.tsCall.callEndDiagnosticsInfo:""}}),this._state=F,this._eventEmitter.emit("stateChanged"))}_setCallRole(F){if(F!==this._lastTsCallAdvancedMeetingRole){const B=generateGuid();this.sendRoleEvent({eventName:Mu.acs_calling_map_role_attempt,timestampInfo:+new Date,correlationId:B});let G=advancedMeetingRoleToParticipantRole(getAcsEcsConfig(),F);"Unknown"===G?(this.logger.log(`tsParticipant advancedMeetingRole=${this._role} had no mapping`),this.sendRoleEvent({eventName:Mu.acs_calling_map_role_failure,timestampInfo:+new Date,correlationId:B})):(this.logger.log(`mapped tsParticipant advancedMeetingRole=${F}=>${G}`),this.sendRoleEvent({eventName:Mu.acs_calling_map_role_success,timestampInfo:+new Date,correlationId:B})),this._role!=G&&(this.logger.log(`self-role changed ${this._role}=>${F}`),this._role=G,this._lastTsCallAdvancedMeetingRole=F,this._eventEmitter.emit("roleChanged"))}}audioSourceChanged(F){var B,G;return __awaiter$f(this,void 0,void 0,(function*(){this._telemetryLogManager.sendEvent({name:Mu.acs_calling_local_audio_source_changed,tenant:ft,properties:{callId:this.id,localParticipantId:this.tsCall.participantId,timestampInfo:+new Date,correlationId:generateGuid(),localAudioStream:(null===(B=F.source)||void 0===B?void 0:B.source)instanceof MediaStreamTrack?"MediaStreamTrack":"Device"}}),F.source instanceof AudioDeviceInfoImpl?(this.localAudioStreams[0]&&this.stopAudioInternal(!0),null===(G=this._callAgent.tsStack)||void 0===G||G.getDeviceManager().selectDevices({microphone:F.source.id})):yield this.startAudioInternal(F.source,!0)}))}removeRemoteAudioStream(F){if(F){this.logger.log("Attempting to remove remote audio stream");if(0===this._remoteAudioStreams.splice(this._remoteAudioStreams.indexOf(F),1).length)return void this.logger.warn("Stream not found, failed to remove stream from remoteAudioStreams collection");this.logger.log("remote audio stream removed successfully"),this._eventEmitter.emit("remoteAudioStreamsUpdated",{added:[],removed:[F]})}}setOrUpdateMediaMetricsDeviceEvents(){var F;return __awaiter$f(this,void 0,void 0,(function*(){if(getAcsEcsConfig().calling.mediaMetricsDeviceEventsEnabled)try{const B=this.tsCall.getMediaSessionStats();if(void 0!==(null===(F=null==B?void 0:B.metrics)||void 0===F?void 0:F.DeviceEvents)){const F=JSON.parse(B.metrics.DeviceEvents),G=getSafeObjectDiff(this._mediaMetricsDeviceEvents||{},F);G.length>0&&(this._mediaMetricsDeviceEvents=F,this.stats.recordEvent({name:Ou.media_metrics_device_events,callId:this.id,localParticipantId:this.tsCall.participantId,data:{metricsDeviceEvents:G||{},metricsDevicesChangeCount:(null==F?void 0:F.metrics_DevicesChangeCount)||0,metricsDevicesCount:(null==F?void 0:F.metrics_DevicesCount)||{}}}))}else this.logger.error("Failed to set media metrics device events telemetry: no valid events data")}catch(F){this.logger.error("Failed to set media metrics device events telemetry")}}))}getLocalVideoStreamFromCallOptions(F){var B,G,W;let z;if(Array.isArray(null===(B=null==F?void 0:F.videoOptions)||void 0===B?void 0:B.localVideoStreams)){if(1!==(null===(G=null==F?void 0:F.videoOptions)||void 0===G?void 0:G.localVideoStreams.length))throw new CallingCommunicationError({message:"Only single LocalVideoStream is supported currently",code:ne});if(z=null===(W=null==F?void 0:F.videoOptions)||void 0===W?void 0:W.localVideoStreams[0],!(z instanceof LocalVideoStream))throw new CallingCommunicationError({message:`${z[0]} is not an instance of LocalVideoStream`,code:de})}return z}getLocalAudioStreamFromCallOptions(F){var B,G,W;let z;if(Array.isArray(null===(B=null==F?void 0:F.audioOptions)||void 0===B?void 0:B.localAudioStreams)){if(1!==(null===(G=null==F?void 0:F.audioOptions)||void 0===G?void 0:G.localAudioStreams.length))throw new CallingCommunicationError({message:"Only single LocalAudioStream is supported currently",code:ne});if(z=null===(W=null==F?void 0:F.audioOptions)||void 0===W?void 0:W.localAudioStreams[0],!(z instanceof LocalAudioStream))throw new CallingCommunicationError({message:`${z[0]} is not an instance of LocalAudioStream`,code:de})}return z}shallRemoveLvsAfterConnectedSuccessfully(F,B,G,W,z){var K,J;if(this.tsCall.localMediaStreams.find((F=>1===F.mediaType)))this.sendVideoEvent({correlationId:G,eventName:Mu.acs_calling_start_video_success,timestampInfo:{deltaTimeInMs:W-z},localVideoStream:F,step:B,isScreenSharingOn:this._isScreenSharingOn});else{if(!(null===(J=null===(K=getAcsEcsConfig())||void 0===K?void 0:K.calling)||void 0===J?void 0:J.removeLvsCheckOnCallStartAndCallAccept))return;this.removeLocalVideoStream(this.localVideoStreams[0]);const W=+new Date;this.logger.error(`Removing local video stream because video failed to start during call-${B} process.`),this.sendVideoEvent({correlationId:G,eventName:Mu.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:W-z},localVideoStream:F,step:B,isScreenSharingOn:this._isScreenSharingOn},new CallingCommunicationError({message:`Video failed to start during call-${B} process.`,code:ne}))}}shallRemoveLasAfterConnectedSuccessfully(F,B,G,W,z){if(this.tsCall.localMediaStreams.find((F=>0===F.mediaType)))this.sendRawMediaEvent({eventName:Mu.acs_calling_start_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,kindOfEvent:"success",localAudioStream:F,timestampInfo:{deltaTimeInMs:W-z},additionalDetails:""});else{if(!getAcsEcsConfig().calling.removeLocalAudioStreamCheckOnCallStartAndCallAccept)return;this.removeLocalAudioStream(this.localAudioStreams[0]);const W=+new Date;this.logger.error(`Removing local audio stream because audio failed to start during call-${B} process.`);const K=new CallingCommunicationError({message:`Audio failed to start during call-${B} process.`,code:ne});this.sendRawMediaEvent({eventName:Mu.acs_calling_start_audio_stream_track,callId:this.id,localParticipantId:this.tsCall.participantId,correlationId:G,localAudioStream:F,kindOfEvent:"failure",timestampInfo:{deltaTimeInMs:W-z},additionalDetails:{failureReason:K.message||"",code:K.code,subCode:K.subCode}})}}}__decorate$6([loggerProperty,__metadata$6("design:type",Object)],CallCommonImpl.prototype,"logger",void 0),__decorate$6([syncOperation(_e.BindToCall),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",void 0)],CallCommonImpl.prototype,"bindTsCall",null),__decorate$6([syncOperation(_e.Feature),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[Object]),__metadata$6("design:returntype","function"==typeof(yp="undefined"!=typeof TFeature&&TFeature)?yp:Object)],CallCommonImpl.prototype,"feature",null),__decorate$6([asyncOperation(_e.HangUp),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[Object]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"hangUp",null),__decorate$6([asyncOperation(_e.Mute),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"mute",null),__decorate$6([asyncOperation(_e.Unmute),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"unmute",null),__decorate$6([asyncOperation(_e.MuteIncomingAudio),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"muteIncomingAudio",null),__decorate$6([asyncOperation(_e.UnmuteIncomingAudio),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"unmuteIncomingAudio",null),__decorate$6([asyncOperation(_e.SendDtmf),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[String]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"sendDtmf",null),__decorate$6([asyncOperation(_e.StartVideo),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[LocalVideoStream]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"startVideo",null),__decorate$6([asyncOperation(_e.StopVideo),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[LocalVideoStream]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"stopVideo",null),__decorate$6([asyncOperation(_e.startAudio),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[LocalAudioStream]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"startAudio",null),__decorate$6([validateEmergencyCallOperation(_e.Hold),asyncOperation(_e.Hold),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"hold",null),__decorate$6([validateEmergencyCallOperation(_e.Resume),asyncOperation(_e.Resume),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"resume",null),__decorate$6([asyncOperation(_e.StartScreenShare),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"startScreenSharing",null),__decorate$6([asyncOperation(_e.StopScreenShare),__metadata$6("design:type",Function),__metadata$6("design:paramtypes",[]),__metadata$6("design:returntype",Promise)],CallCommonImpl.prototype,"stopScreenSharing",null);class RemoteVideoStreamImpl extends VideoStreamCommonImpl{constructor(F,B,G,W,z,K){super(F,B,G,z,K),this.kind="RemoteVideoStreamInternal",this._isAvailable=!1,this._setIsAvailable=F=>{F!==this._isAvailable&&(this._isAvailable=!!F,this.logger.log(`isAvailable changed to ${this._isAvailable}`),this._eventEmitter.emit("isAvailableChanged",this._isAvailable),super.sendRemoteVideoStreamTelemetry())},this._setIsAvailable(this.tsStream.isAvailable),this._streamChangedHandler=this.tsStream.changed((()=>this._setIsAvailable(this.tsStream.isAvailable)))}on(F,B){if("isAvailableChanged"!==F&&"sizeChanged"!==F&&"isReceivingChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("isAvailableChanged"!==F&&"sizeChanged"!==F&&"isReceivingChanged"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}get isAvailable(){return this._isAvailable}getStreamMetadata(){var F;return{callId:null===(F=this.call)||void 0===F?void 0:F.id,streamType:this.mediaStreamType,localParticipantId:this.call.tsCall.participantId,remoteParticipantId:this.getRemoteParticipantId(),sourceId:this.id,source:"remote",rank:this.tsStream.rank,isAvailable:this.tsStream.isAvailable,isReceiving:this._isReceiving,isStreaming:this.tsStream.isStreaming,viewIdsRegistered:this._renderers.map((F=>F.viewId)).join(", "),height:this._size.height,width:this._size.width,isDisposed:this._disposed}}dispose(){this._setIsAvailable(!1),super.dispose()}}var __decorate$7=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$7=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)};class RemoteParticipantImpl{constructor(F,B,G,W,z){this._mappedStreams=new Map,this._state="Idle",this._lastTsParticipantState=0,this._isMuted=!1,this._isSpeaking=!1,this._displayName="",this._role="Unknown",this.acsToTsStreamType=F=>"Video"===F?0:"ScreenSharing"===F?1:void 0,this._identifier=F,this.logger=B.createChild((()=>`RemoteParticipant{${this._identifier.kind}}`)),this._telemetryLogManager=z,this._eventEmitter=new CallingEventEmitter(this.logger),this._callAgent=W,this._call=G,this.logger.log("created")}get identifier(){return this._identifier}get state(){return this._state}get videoStreams(){return[...this._mappedStreams.values()]}get isMuted(){return this._isMuted}get isSpeaking(){return this._isSpeaking}get callEndReason(){return this._callEndReason}get displayName(){return this._displayName}get role(){return this._role}on(F,B){if("stateChanged"!==F&&"isMutedChanged"!==F&&"isSpeakingChanged"!==F&&"displayNameChanged"!==F&&"roleChanged"!==F&&"videoStreamsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("stateChanged"!==F&&"isMutedChanged"!==F&&"isSpeakingChanged"!==F&&"displayNameChanged"!==F&&"roleChanged"!==F&&"videoStreamsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}dispose(){this.logger.log("dispose"),this._participantChangedHandler&&this._participantChangedHandler.dispose(),this._mappedStreams.forEach((F=>F.dispose())),this._mappedStreams.clear(),this._eventEmitter.removeAllListeners()}get tsRemoteParticipant(){return this._tsParticipant}setCallEndReason(F){this._callEndReason=F}observeParticipant(F){this._tsParticipant||(this._tsParticipant=F,this._displayName=F.displayName,this._participantChangedHandler=this._tsParticipant.changed((()=>{if(this._tsParticipant&&this._tsParticipant.state!==this._lastTsParticipantState&&(this._lastTsParticipantState=this._tsParticipant.state,this._mapTsParticipantState(this._tsParticipant.state)),this._mapStreams(),this._tsParticipant&&this._tsParticipant.isServerMuted!==this._isMuted&&(this._isMuted=this._tsParticipant.isServerMuted,this._eventEmitter.emit("isMutedChanged")),this._tsParticipant&&this._tsParticipant.displayName!==this._displayName&&(this._displayName=F.displayName,this._eventEmitter.emit("displayNameChanged")),this._tsParticipant&&this._tsParticipant.advancedMeetingRole!==this._lastTsParticipantAdvancedRole&&(this._lastTsParticipantAdvancedRole=F.advancedMeetingRole,this._setParticipantRole(this._tsParticipant.advancedMeetingRole)),this._tsParticipant){const F=0!==this._tsParticipant.voiceLevel;F!==this._isSpeaking&&(this._isSpeaking=F,this._eventEmitter.emit("isSpeakingChanged"))}})),this._mapTsParticipantState(this._tsParticipant.state),this._mapStreams(),this._lastTsParticipantAdvancedRole=this._tsParticipant.advancedMeetingRole,this._setParticipantRole(this._tsParticipant.advancedMeetingRole))}setParticipantState(F){F!==this._state&&(this.logger.log(`state changed ${this._state}=>${this.state}`),this._state=F,this._eventEmitter.emit("stateChanged",this._state))}_setParticipantRole(F){let B=advancedMeetingRoleToParticipantRole(getAcsEcsConfig(),F);"Unknown"===B?this.logger.log(`tsParticipant advancedMeetingRole=${F} had no mapping`):this.logger.log(`mapped tsParticipant advancedMeetingRole=${F}=>${B}`),this._role!=B&&(this.logger.log(`role changed ${this._role}=>${F}`),this._role=B,this._eventEmitter.emit("roleChanged"))}_mapTsParticipantState(F){let B;const G={0:"Idle",1:"Connecting",2:"Ringing",3:"Connected",4:"Disconnected",5:"Hold",7:"InLobby",6:"EarlyMedia"};G[F]?(B=G[F],this.logger.log(`mapped tsParticipant ${F}=>${this._state}`),this.setParticipantState(B)):this.logger.log(`unable to map tsCall state=${F} to call state`),"Disconnected"===this._state&&this.dispose()}_mapStreams(){const F=[],B=[],handleNewStream=F=>{this._mappedStreams.set(F.id,F)},handleRemovedStream=F=>{const B=this._mappedStreams.get(F.id);B&&(this.logger.log(`stream removed, type==${B.mediaStreamType} id=${F.id}`),this._mappedStreams.delete(F.id),B.dispose())},mapStreamsOfType=G=>{if(this._tsParticipant)if(isNonEmptyArray(this._tsParticipant.streams&&this._tsParticipant.streams[G])){let W=[];this._tsParticipant&&(W=this._tsParticipant.streams[G]),W.forEach((B=>{if(!this._mappedStreams.get(B.id)){const G=new RemoteVideoStreamImpl(B,this.logger,this._call,this._callAgent,this._tsParticipant,this._telemetryLogManager);this.logger.log(`stream created, type==${G.mediaStreamType} id=${B.id}`),F.push(G)}})),this._mappedStreams.forEach((F=>{if(this.acsToTsStreamType(F.mediaStreamType)===G){W.some((B=>B.id===F.id))||B.push(F)}}))}else this._mappedStreams.forEach((F=>{this.acsToTsStreamType(F.mediaStreamType)===G&&B.push(F)}))};mapStreamsOfType(0),mapStreamsOfType(1),(F.length>0||B.length>0)&&(F.forEach(handleNewStream),B.forEach(handleRemovedStream),this._eventEmitter.emit("videoStreamsUpdated",{added:F,removed:B}))}}__decorate$7([loggerProperty,__metadata$7("design:type",Object)],RemoteParticipantImpl.prototype,"logger",void 0);var __decorate$8=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$8=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$g=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class CallImpl extends CallCommonImpl{constructor(B,G,W,z){super(B,G,W,z,F.CallKind.Call),this._info=new CallInfoImpl(W,{roomId:B.roomId})}get info(){return this._info}getOrCreateRemoteParticipant(F){let B=this._remoteParticipants.find((B=>getMriFromIdentifier(B.identifier)===getMriFromIdentifier(F)));return B||(B=new RemoteParticipantImpl(F,this.logger,this,this._callAgent,this._telemetryLogManager),this._remoteParticipants.push(B)),B}dispose(){super.dispose(),this._extensibleApi.dispose()}addParticipant(F,B){let W,z,K=B,J=B,Q=B;if(this._callAgent.isCteUser()){switch(this.validateThreadId(F,B),G.getIdentifierKind(F).kind){case"communicationUser":z=K.threadId;break;case"microsoftTeamsUser":z=Q.threadId;break;case"phoneNumber":z=J.threadId;break;default:throw new CallingCommunicationError({message:"Not able to add unkown participant.",code:ne})}}if((null==J?void 0:J.alternateCallerId)&&(validateIdentifier(J.alternateCallerId),W=getMriFromIdentifier(J.alternateCallerId)),validateIdentifier(F),this._remoteParticipants.find((B=>getMriFromIdentifier(B.identifier)===getMriFromIdentifier(F))))throw new CallingCommunicationError({message:`${G.getIdentifierKind(F).kind} is already in the call`,code:ne});const Y=this.getOrCreateRemoteParticipant(constructIdentifierKindFromMri(getMriFromIdentifier(F)));return this.tsCall.addParticipant(getMriFromIdentifier(F),{alternateId:W,threadId:z}).catch((B=>{if(this._remoteParticipants.find((B=>getMriFromIdentifier(B.identifier)===getMriFromIdentifier(F)))){this._remoteParticipants.splice(this._remoteParticipants.indexOf(Y));const F=this._handleParticipantOperationFailure(B);Y.setCallEndReason({code:F.code,subCode:F.subCode}),this._eventEmitter.emit("remoteParticipantsUpdated",{added:[],removed:[Y]})}})),Y}removeParticipant(F,B){return __awaiter$g(this,void 0,void 0,(function*(){validateIdentifier(F);try{yield this.tsCall.removeParticipant(getMriFromIdentifier(F))}catch(F){throw this._handleParticipantOperationFailure(F)}}))}validateThreadId(F,B){if(!(null==B?void 0:B.threadId))throw new CallingCommunicationError({message:"Add participant failed: thread ID is missing in options.",code:ne})}}__decorate$8([syncOperation(_e.AddParticipant),__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[Object,Object]),__metadata$8("design:returntype",Object)],CallImpl.prototype,"addParticipant",null),__decorate$8([asyncOperation(_e.RemoveParticipant),__metadata$8("design:type",Function),__metadata$8("design:paramtypes",[Object,Object]),__metadata$8("design:returntype",Promise)],CallImpl.prototype,"removeParticipant",null);var __decorate$9=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$9=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)};class IncomingCallCommonImpl{constructor(F,B){this._callCommon=F,this._eventEmitter=new Jt.EventEmitter,this._kind=B,this._callCommon.on("stateChanged",(()=>{"Disconnected"===this._callCommon.state&&this._eventEmitter.emit("callEnded",{callEndReason:this._callCommon.callEndReason})}))}get kind(){return this._kind}get id(){return this._callCommon.id}get callerInfo(){return this._callCommon.callerInfo}get callEndReason(){return this._callCommon.callEndReason}on(F,B){this._eventEmitter.on(F,B)}off(F,B){this._eventEmitter.off(F,B)}reject(){return this._callCommon.reject()}}__decorate$9([asyncOperation(),__metadata$9("design:type",Function),__metadata$9("design:paramtypes",[]),__metadata$9("design:returntype",Promise)],IncomingCallCommonImpl.prototype,"reject",null);var __decorate$a=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$a=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$h=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class IncomingCallImpl extends IncomingCallCommonImpl{constructor(B){super(B,F.IncomingCallKind.IncomingCall),this._call=B}get info(){return this._call.info}accept(F){return __awaiter$h(this,void 0,void 0,(function*(){return yield this._call.accept(F),this._call}))}}__decorate$a([asyncOperation(_e.Accept),__metadata$a("design:type",Function),__metadata$a("design:paramtypes",[Object]),__metadata$a("design:returntype",Promise)],IncomingCallImpl.prototype,"accept",null);var Sp,_p=function bind(F,B){return function wrap(){for(var G=new Array(arguments.length),W=0;W<G.length;W++)G[W]=arguments[W];return F.apply(B,G)}},Cp=Object.prototype.toString,Tp=(Sp=Object.create(null),function(F){var B=Cp.call(F);return Sp[B]||(Sp[B]=B.slice(8,-1).toLowerCase())});function kindOfTest(F){return F=F.toLowerCase(),function isKindOf(B){return Tp(B)===F}}function isArray$3(F){return Array.isArray(F)}function isUndefined$2(F){return void 0===F}function isBuffer(F){return null!==F&&!isUndefined$2(F)&&null!==F.constructor&&!isUndefined$2(F.constructor)&&"function"==typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}var Ep=kindOfTest("ArrayBuffer");function isArrayBufferView(F){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(F):F&&F.buffer&&Ep(F.buffer)}function isString$2(F){return"string"==typeof F}function isNumber$2(F){return"number"==typeof F}function isObject$1(F){return null!==F&&"object"==typeof F}function isPlainObject(F){if("object"!==Tp(F))return!1;var B=Object.getPrototypeOf(F);return null===B||B===Object.prototype}var bp=kindOfTest("Date"),Ip=kindOfTest("File"),Ap=kindOfTest("Blob"),Rp=kindOfTest("FileList");function isFunction$2(F){return"[object Function]"===Cp.call(F)}function isStream(F){return isObject$1(F)&&isFunction$2(F.pipe)}function isFormData(F){var B="[object FormData]";return F&&("function"==typeof FormData&&F instanceof FormData||Cp.call(F)===B||isFunction$2(F.toString)&&F.toString()===B)}var Pp=kindOfTest("URLSearchParams");function trim(F){return F.trim?F.trim():F.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(F,B){if(null!=F)if("object"!=typeof F&&(F=[F]),isArray$3(F))for(var G=0,W=F.length;G<W;G++)B.call(null,F[G],G,F);else for(var z in F)Object.prototype.hasOwnProperty.call(F,z)&&B.call(null,F[z],z,F)}function merge(){var F={};function assignValue(B,G){isPlainObject(F[G])&&isPlainObject(B)?F[G]=merge(F[G],B):isPlainObject(B)?F[G]=merge({},B):isArray$3(B)?F[G]=B.slice():F[G]=B}for(var B=0,G=arguments.length;B<G;B++)forEach(arguments[B],assignValue);return F}function extend$1(F,B,G){return forEach(B,(function assignValue(B,W){F[W]=G&&"function"==typeof B?_p(B,G):B})),F}function stripBOM(F){return 65279===F.charCodeAt(0)&&(F=F.slice(1)),F}function inherits(F,B,G,W){F.prototype=Object.create(B.prototype,W),F.prototype.constructor=F,G&&Object.assign(F.prototype,G)}function toFlatObject(F,B,G){var W,z,K,J={};B=B||{};do{for(z=(W=Object.getOwnPropertyNames(F)).length;z-- >0;)J[K=W[z]]||(B[K]=F[K],J[K]=!0);F=Object.getPrototypeOf(F)}while(F&&(!G||G(F,B))&&F!==Object.prototype);return B}function endsWith(F,B,G){F=String(F),(void 0===G||G>F.length)&&(G=F.length),G-=B.length;var W=F.indexOf(B,G);return-1!==W&&W===G}function toArray(F){if(!F)return null;var B=F.length;if(isUndefined$2(B))return null;for(var G=new Array(B);B-- >0;)G[B]=F[B];return G}var Op,Mp=(Op="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(F){return Op&&F instanceof Op}),wp={isArray:isArray$3,isArrayBuffer:Ep,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString$2,isNumber:isNumber$2,isObject:isObject$1,isPlainObject:isPlainObject,isUndefined:isUndefined$2,isDate:bp,isFile:Ip,isBlob:Ap,isFunction:isFunction$2,isStream:isStream,isURLSearchParams:Pp,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend$1,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:Tp,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,isTypedArray:Mp,isFileList:Rp};function encode(F){return encodeURIComponent(F).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Dp=function buildURL(F,B,G){if(!B)return F;var W;if(G)W=G(B);else if(wp.isURLSearchParams(B))W=B.toString();else{var z=[];wp.forEach(B,(function serialize(F,B){null!=F&&(wp.isArray(F)?B+="[]":F=[F],wp.forEach(F,(function parseValue(F){wp.isDate(F)?F=F.toISOString():wp.isObject(F)&&(F=JSON.stringify(F)),z.push(encode(B)+"="+encode(F))})))})),W=z.join("&")}if(W){var K=F.indexOf("#");-1!==K&&(F=F.slice(0,K)),F+=(-1===F.indexOf("?")?"?":"&")+W}return F};function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(F,B,G){return this.handlers.push({fulfilled:F,rejected:B,synchronous:!!G&&G.synchronous,runWhen:G?G.runWhen:null}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(F){this.handlers[F]&&(this.handlers[F]=null)},InterceptorManager.prototype.forEach=function forEach(F){wp.forEach(this.handlers,(function forEachHandler(B){null!==B&&F(B)}))};var Np=InterceptorManager,Lp=function normalizeHeaderName(F,B){wp.forEach(F,(function processHeader(G,W){W!==B&&W.toUpperCase()===B.toUpperCase()&&(F[B]=G,delete F[W])}))};function AxiosError(F,B,G,W,z){Error.call(this),this.message=F,this.name="AxiosError",B&&(this.code=B),G&&(this.config=G),W&&(this.request=W),z&&(this.response=z)}wp.inherits(AxiosError,Error,{toJSON:function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var kp=AxiosError.prototype,Fp={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(F){Fp[F]={value:F}})),Object.defineProperties(AxiosError,Fp),Object.defineProperty(kp,"isAxiosError",{value:!0}),AxiosError.from=function(F,B,G,W,z,K){var J=Object.create(kp);return wp.toFlatObject(F,J,(function filter(F){return F!==Error.prototype})),AxiosError.call(J,F.message,B,G,W,z),J.name=F.name,K&&Object.assign(J,K),J};var xp=AxiosError,Up={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function toFormData(F,B){B=B||new FormData;var G=[];function convertValue(F){return null===F?"":wp.isDate(F)?F.toISOString():wp.isArrayBuffer(F)||wp.isTypedArray(F)?"function"==typeof Blob?new Blob([F]):Buffer.from(F):F}function build(F,W){if(wp.isPlainObject(F)||wp.isArray(F)){if(-1!==G.indexOf(F))throw Error("Circular reference detected in "+W);G.push(F),wp.forEach(F,(function each(F,G){if(!wp.isUndefined(F)){var z,K=W?W+"."+G:G;if(F&&!W&&"object"==typeof F)if(wp.endsWith(G,"{}"))F=JSON.stringify(F);else if(wp.endsWith(G,"[]")&&(z=wp.toArray(F)))return void z.forEach((function(F){!wp.isUndefined(F)&&B.append(K,convertValue(F))}));build(F,K)}})),G.pop()}else B.append(W,convertValue(F))}return build(F),B}var jp=toFormData,Bp=function settle(F,B,G){var W=G.config.validateStatus;G.status&&W&&!W(G.status)?B(new xp("Request failed with status code "+G.status,[xp.ERR_BAD_REQUEST,xp.ERR_BAD_RESPONSE][Math.floor(G.status/100)-4],G.config,G.request,G)):F(G)},Hp=wp.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(F,B,G,W,z,K){var J=[];J.push(F+"="+encodeURIComponent(B)),wp.isNumber(G)&&J.push("expires="+new Date(G).toGMTString()),wp.isString(W)&&J.push("path="+W),wp.isString(z)&&J.push("domain="+z),!0===K&&J.push("secure"),document.cookie=J.join("; ")},read:function read(F){var B=document.cookie.match(new RegExp("(^|;\\s*)("+F+")=([^;]*)"));return B?decodeURIComponent(B[3]):null},remove:function remove(F){this.write(F,"",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}},Vp=function isAbsoluteURL(F){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(F)},Gp=function combineURLs(F,B){return B?F.replace(/\/+$/,"")+"/"+B.replace(/^\/+/,""):F},Wp=function buildFullPath(F,B){return F&&!Vp(B)?Gp(F,B):B},qp=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],zp=function parseHeaders(F){var B,G,W,z={};return F?(wp.forEach(F.split("\n"),(function parser(F){if(W=F.indexOf(":"),B=wp.trim(F.substr(0,W)).toLowerCase(),G=wp.trim(F.substr(W+1)),B){if(z[B]&&qp.indexOf(B)>=0)return;z[B]="set-cookie"===B?(z[B]?z[B]:[]).concat([G]):z[B]?z[B]+", "+G:G}})),z):z},Kp=wp.isStandardBrowserEnv()?function standardBrowserEnv(){var F,B=/(msie|trident)/i.test(navigator.userAgent),G=document.createElement("a");function resolveURL(F){var W=F;return B&&(G.setAttribute("href",W),W=G.href),G.setAttribute("href",W),{href:G.href,protocol:G.protocol?G.protocol.replace(/:$/,""):"",host:G.host,search:G.search?G.search.replace(/^\?/,""):"",hash:G.hash?G.hash.replace(/^#/,""):"",hostname:G.hostname,port:G.port,pathname:"/"===G.pathname.charAt(0)?G.pathname:"/"+G.pathname}}return F=resolveURL(window.location.href),function isURLSameOrigin(B){var G=wp.isString(B)?resolveURL(B):B;return G.protocol===F.protocol&&G.host===F.host}}():function isURLSameOrigin(){return!0};function CanceledError(F){xp.call(this,null==F?"canceled":F,xp.ERR_CANCELED),this.name="CanceledError"}wp.inherits(CanceledError,xp,{__CANCEL__:!0});var Jp=CanceledError,Qp=function parseProtocol(F){var B=/^([-+\w]{1,25})(:?\/\/|:)/.exec(F);return B&&B[1]||""},Yp=function xhrAdapter(F){return new Promise((function dispatchXhrRequest(B,G){var W,z=F.data,K=F.headers,J=F.responseType;function done(){F.cancelToken&&F.cancelToken.unsubscribe(W),F.signal&&F.signal.removeEventListener("abort",W)}wp.isFormData(z)&&wp.isStandardBrowserEnv()&&delete K["Content-Type"];var Q=new XMLHttpRequest;if(F.auth){var Y=F.auth.username||"",$=F.auth.password?unescape(encodeURIComponent(F.auth.password)):"";K.Authorization="Basic "+btoa(Y+":"+$)}var X=Wp(F.baseURL,F.url);function onloadend(){if(Q){var W="getAllResponseHeaders"in Q?zp(Q.getAllResponseHeaders()):null,z={data:J&&"text"!==J&&"json"!==J?Q.response:Q.responseText,status:Q.status,statusText:Q.statusText,headers:W,config:F,request:Q};Bp((function _resolve(F){B(F),done()}),(function _reject(F){G(F),done()}),z),Q=null}}if(Q.open(F.method.toUpperCase(),Dp(X,F.params,F.paramsSerializer),!0),Q.timeout=F.timeout,"onloadend"in Q?Q.onloadend=onloadend:Q.onreadystatechange=function handleLoad(){Q&&4===Q.readyState&&(0!==Q.status||Q.responseURL&&0===Q.responseURL.indexOf("file:"))&&setTimeout(onloadend)},Q.onabort=function handleAbort(){Q&&(G(new xp("Request aborted",xp.ECONNABORTED,F,Q)),Q=null)},Q.onerror=function handleError(){G(new xp("Network Error",xp.ERR_NETWORK,F,Q,Q)),Q=null},Q.ontimeout=function handleTimeout(){var B=F.timeout?"timeout of "+F.timeout+"ms exceeded":"timeout exceeded",W=F.transitional||Up;F.timeoutErrorMessage&&(B=F.timeoutErrorMessage),G(new xp(B,W.clarifyTimeoutError?xp.ETIMEDOUT:xp.ECONNABORTED,F,Q)),Q=null},wp.isStandardBrowserEnv()){var Z=(F.withCredentials||Kp(X))&&F.xsrfCookieName?Hp.read(F.xsrfCookieName):void 0;Z&&(K[F.xsrfHeaderName]=Z)}"setRequestHeader"in Q&&wp.forEach(K,(function setRequestHeader(F,B){void 0===z&&"content-type"===B.toLowerCase()?delete K[B]:Q.setRequestHeader(B,F)})),wp.isUndefined(F.withCredentials)||(Q.withCredentials=!!F.withCredentials),J&&"json"!==J&&(Q.responseType=F.responseType),"function"==typeof F.onDownloadProgress&&Q.addEventListener("progress",F.onDownloadProgress),"function"==typeof F.onUploadProgress&&Q.upload&&Q.upload.addEventListener("progress",F.onUploadProgress),(F.cancelToken||F.signal)&&(W=function(F){Q&&(G(!F||F&&F.type?new Jp:F),Q.abort(),Q=null)},F.cancelToken&&F.cancelToken.subscribe(W),F.signal&&(F.signal.aborted?W():F.signal.addEventListener("abort",W))),z||(z=null);var ee=Qp(X);ee&&-1===["http","https","file"].indexOf(ee)?G(new xp("Unsupported protocol "+ee+":",xp.ERR_BAD_REQUEST,F)):Q.send(z)}))},$p=null,Xp={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(F,B){!wp.isUndefined(F)&&wp.isUndefined(F["Content-Type"])&&(F["Content-Type"]=B)}function getDefaultAdapter(){var F;return("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(F=Yp),F}function stringifySafely(F,B,G){if(wp.isString(F))try{return(B||JSON.parse)(F),wp.trim(F)}catch(F){if("SyntaxError"!==F.name)throw F}return(G||JSON.stringify)(F)}var Zp={transitional:Up,adapter:getDefaultAdapter(),transformRequest:[function transformRequest(F,B){if(Lp(B,"Accept"),Lp(B,"Content-Type"),wp.isFormData(F)||wp.isArrayBuffer(F)||wp.isBuffer(F)||wp.isStream(F)||wp.isFile(F)||wp.isBlob(F))return F;if(wp.isArrayBufferView(F))return F.buffer;if(wp.isURLSearchParams(F))return setContentTypeIfUnset(B,"application/x-www-form-urlencoded;charset=utf-8"),F.toString();var G,W=wp.isObject(F),z=B&&B["Content-Type"];if((G=wp.isFileList(F))||W&&"multipart/form-data"===z){var K=this.env&&this.env.FormData;return jp(G?{"files[]":F}:F,K&&new K)}return W||"application/json"===z?(setContentTypeIfUnset(B,"application/json"),stringifySafely(F)):F}],transformResponse:[function transformResponse(F){var B=this.transitional||Zp.transitional,G=B&&B.silentJSONParsing,W=B&&B.forcedJSONParsing,z=!G&&"json"===this.responseType;if(z||W&&wp.isString(F)&&F.length)try{return JSON.parse(F)}catch(F){if(z){if("SyntaxError"===F.name)throw xp.from(F,xp.ERR_BAD_RESPONSE,this,null,this.response);throw F}}return F}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$p},validateStatus:function validateStatus(F){return F>=200&&F<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};wp.forEach(["delete","get","head"],(function forEachMethodNoData(F){Zp.headers[F]={}})),wp.forEach(["post","put","patch"],(function forEachMethodWithData(F){Zp.headers[F]=wp.merge(Xp)}));var eh=Zp,th=function transformData(F,B,G){var W=this||eh;return wp.forEach(G,(function transform(G){F=G.call(W,F,B)})),F},nh=function isCancel(F){return!(!F||!F.__CANCEL__)};function throwIfCancellationRequested(F){if(F.cancelToken&&F.cancelToken.throwIfRequested(),F.signal&&F.signal.aborted)throw new Jp}var ih=function dispatchRequest(F){return throwIfCancellationRequested(F),F.headers=F.headers||{},F.data=th.call(F,F.data,F.headers,F.transformRequest),F.headers=wp.merge(F.headers.common||{},F.headers[F.method]||{},F.headers),wp.forEach(["delete","get","head","post","put","patch","common"],(function cleanHeaderConfig(B){delete F.headers[B]})),(F.adapter||eh.adapter)(F).then((function onAdapterResolution(B){return throwIfCancellationRequested(F),B.data=th.call(F,B.data,B.headers,F.transformResponse),B}),(function onAdapterRejection(B){return nh(B)||(throwIfCancellationRequested(F),B&&B.response&&(B.response.data=th.call(F,B.response.data,B.response.headers,F.transformResponse))),Promise.reject(B)}))},rh=function mergeConfig(F,B){B=B||{};var G={};function getMergedValue(F,B){return wp.isPlainObject(F)&&wp.isPlainObject(B)?wp.merge(F,B):wp.isPlainObject(B)?wp.merge({},B):wp.isArray(B)?B.slice():B}function mergeDeepProperties(G){return wp.isUndefined(B[G])?wp.isUndefined(F[G])?void 0:getMergedValue(void 0,F[G]):getMergedValue(F[G],B[G])}function valueFromConfig2(F){if(!wp.isUndefined(B[F]))return getMergedValue(void 0,B[F])}function defaultToConfig2(G){return wp.isUndefined(B[G])?wp.isUndefined(F[G])?void 0:getMergedValue(void 0,F[G]):getMergedValue(void 0,B[G])}function mergeDirectKeys(G){return G in B?getMergedValue(F[G],B[G]):G in F?getMergedValue(void 0,F[G]):void 0}var W={url:valueFromConfig2,method:valueFromConfig2,data:valueFromConfig2,baseURL:defaultToConfig2,transformRequest:defaultToConfig2,transformResponse:defaultToConfig2,paramsSerializer:defaultToConfig2,timeout:defaultToConfig2,timeoutMessage:defaultToConfig2,withCredentials:defaultToConfig2,adapter:defaultToConfig2,responseType:defaultToConfig2,xsrfCookieName:defaultToConfig2,xsrfHeaderName:defaultToConfig2,onUploadProgress:defaultToConfig2,onDownloadProgress:defaultToConfig2,decompress:defaultToConfig2,maxContentLength:defaultToConfig2,maxBodyLength:defaultToConfig2,beforeRedirect:defaultToConfig2,transport:defaultToConfig2,httpAgent:defaultToConfig2,httpsAgent:defaultToConfig2,cancelToken:defaultToConfig2,socketPath:defaultToConfig2,responseEncoding:defaultToConfig2,validateStatus:mergeDirectKeys};return wp.forEach(Object.keys(F).concat(Object.keys(B)),(function computeConfigValue(F){var B=W[F]||mergeDeepProperties,z=B(F);wp.isUndefined(z)&&B!==mergeDirectKeys||(G[F]=z)})),G},oh={version:"0.27.2"},ah=oh.version,sh={};["object","boolean","number","function","string","symbol"].forEach((function(F,B){sh[F]=function validator(G){return typeof G===F||"a"+(B<1?"n ":" ")+F}}));var ch={};function assertOptions(F,B,G){if("object"!=typeof F)throw new xp("options must be an object",xp.ERR_BAD_OPTION_VALUE);for(var W=Object.keys(F),z=W.length;z-- >0;){var K=W[z],J=B[K];if(J){var Q=F[K],Y=void 0===Q||J(Q,K,F);if(!0!==Y)throw new xp("option "+K+" must be "+Y,xp.ERR_BAD_OPTION_VALUE)}else if(!0!==G)throw new xp("Unknown option "+K,xp.ERR_BAD_OPTION)}}sh.transitional=function transitional(F,B,G){function formatMessage(F,B){return"[Axios v"+ah+"] Transitional option '"+F+"'"+B+(G?". "+G:"")}return function(G,W,z){if(!1===F)throw new xp(formatMessage(W," has been removed"+(B?" in "+B:"")),xp.ERR_DEPRECATED);return B&&!ch[W]&&(ch[W]=!0,console.warn(formatMessage(W," has been deprecated since v"+B+" and will be removed in the near future"))),!F||F(G,W,z)}};var lh={assertOptions:assertOptions,validators:sh},dh=lh.validators;function Axios(F){this.defaults=F,this.interceptors={request:new Np,response:new Np}}Axios.prototype.request=function request(F,B){"string"==typeof F?(B=B||{}).url=F:B=F||{},(B=rh(this.defaults,B)).method?B.method=B.method.toLowerCase():this.defaults.method?B.method=this.defaults.method.toLowerCase():B.method="get";var G=B.transitional;void 0!==G&&lh.assertOptions(G,{silentJSONParsing:dh.transitional(dh.boolean),forcedJSONParsing:dh.transitional(dh.boolean),clarifyTimeoutError:dh.transitional(dh.boolean)},!1);var W=[],z=!0;this.interceptors.request.forEach((function unshiftRequestInterceptors(F){"function"==typeof F.runWhen&&!1===F.runWhen(B)||(z=z&&F.synchronous,W.unshift(F.fulfilled,F.rejected))}));var K,J=[];if(this.interceptors.response.forEach((function pushResponseInterceptors(F){J.push(F.fulfilled,F.rejected)})),!z){var Q=[ih,void 0];for(Array.prototype.unshift.apply(Q,W),Q=Q.concat(J),K=Promise.resolve(B);Q.length;)K=K.then(Q.shift(),Q.shift());return K}for(var Y=B;W.length;){var $=W.shift(),X=W.shift();try{Y=$(Y)}catch(F){X(F);break}}try{K=ih(Y)}catch(F){return Promise.reject(F)}for(;J.length;)K=K.then(J.shift(),J.shift());return K},Axios.prototype.getUri=function getUri(F){F=rh(this.defaults,F);var B=Wp(F.baseURL,F.url);return Dp(B,F.params,F.paramsSerializer)},wp.forEach(["delete","get","head","options"],(function forEachMethodNoData(F){Axios.prototype[F]=function(B,G){return this.request(rh(G||{},{method:F,url:B,data:(G||{}).data}))}})),wp.forEach(["post","put","patch"],(function forEachMethodWithData(F){function generateHTTPMethod(B){return function httpMethod(G,W,z){return this.request(rh(z||{},{method:F,headers:B?{"Content-Type":"multipart/form-data"}:{},url:G,data:W}))}}Axios.prototype[F]=generateHTTPMethod(),Axios.prototype[F+"Form"]=generateHTTPMethod(!0)}));var uh=Axios;function CancelToken(F){if("function"!=typeof F)throw new TypeError("executor must be a function.");var B;this.promise=new Promise((function promiseExecutor(F){B=F}));var G=this;this.promise.then((function(F){if(G._listeners){var B,W=G._listeners.length;for(B=0;B<W;B++)G._listeners[B](F);G._listeners=null}})),this.promise.then=function(F){var B,W=new Promise((function(F){G.subscribe(F),B=F})).then(F);return W.cancel=function reject(){G.unsubscribe(B)},W},F((function cancel(F){G.reason||(G.reason=new Jp(F),B(G.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.prototype.subscribe=function subscribe(F){this.reason?F(this.reason):this._listeners?this._listeners.push(F):this._listeners=[F]},CancelToken.prototype.unsubscribe=function unsubscribe(F){if(this._listeners){var B=this._listeners.indexOf(F);-1!==B&&this._listeners.splice(B,1)}},CancelToken.source=function source(){var F;return{token:new CancelToken((function executor(B){F=B})),cancel:F}};var ph=CancelToken,hh=function spread(F){return function wrap(B){return F.apply(null,B)}},gh=function isAxiosError(F){return wp.isObject(F)&&!0===F.isAxiosError};function createInstance(F){var B=new uh(F),G=_p(uh.prototype.request,B);return wp.extend(G,uh.prototype,B),wp.extend(G,B),G.create=function create(B){return createInstance(rh(F,B))},G}var fh=createInstance(eh);fh.Axios=uh,fh.CanceledError=Jp,fh.CancelToken=ph,fh.isCancel=nh,fh.VERSION=oh.version,fh.toFormData=jp,fh.AxiosError=xp,fh.Cancel=fh.CanceledError,fh.all=function all(F){return Promise.all(F)},fh.spread=hh,fh.isAxiosError=gh;var mh=fh,vh=fh;mh.default=vh;var yh=mh,__awaiter$i=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class HttpRequestHelper{constructor(F){this.logger=F}sendRequestWithRetry(F,B,G,W,z,K=1,J){var Q;return __awaiter$i(this,void 0,void 0,(function*(){if(K>z)throw new Error("Max retry reached");W.timeout||(W.timeout=2e4),W.maxRedirects=0;try{switch(F){case"post":default:return yield yh.post(B,G,W);case"get":return yield yh.get(B,W);case"put":return yield yh.put(B,G,W);case"delete":return yield yh.delete(B,W)}}catch(Y){let $=null===(Q=null==Y?void 0:Y.response)||void 0===Q?void 0:Q.status;this.logger.error(`Found error for request ${F} ${B} ${$||""}`);const X=K+1;if(X<=z){let K=B;if(Y&&Y.response)if(301===Y.response.status||302===Y.response.status||303===Y.response.status||307===Y.response.status||404===Y.response.status)K=Y.response.headers&&Y.response.headers.location?Y.response.headers.location:K;else if(Y.response.status<500)throw Y;return this.logger.error(`Retrying, attempt #${X} url=${K}`),yield new Promise((F=>setTimeout(F,J))),this.sendRequestWithRetry(F,K,G,W,z,X,J)}throw Y}}))}}var Sh,__decorate$b=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$b=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$j=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};let _h=1;class CallAgentCommonImpl{constructor(F,B,G,W,z,K){var J,Q,Y,$;this._callClient=F,this._disposed=!1,this.tokenProvider=F=>__awaiter$j(this,void 0,void 0,(function*(){var B,G;if(!this._communicationTokenCredential)throw new CallingCommunicationError({message:"Attempted to get AccessToken before initialization",code:de});const W=yield parseTokenCredential(this._communicationTokenCredential,{abortSignal:this._abortController.signal});return W.acsResourceId===(null===(B=this._parsedTokenCredential)||void 0===B?void 0:B.acsResourceId)&&W.identityMri===(null===(G=this._parsedTokenCredential)||void 0===G?void 0:G.identityMri)||logErrorAndThrow("Refreshed AccessToken User Id doesnt match initial User Id",ne,this.logger),F?this._tokenFetchTries+=1:this._tokenFetchTries=0,this._tokenFetchTries>this._maxNmberOfRetries&&(this.sendTokenExpiredEvent(),this._disposed||(yield this.dispose()),logErrorAndThrow("Access token is expired and failed to fetch a valid one after retries",ne,this.logger)),W.jwtToken})),this.sendTokenChangedEvent=(F,B)=>{try{this._telemetryLogManager.sendEvent({name:B?Mu.acs_calling_token_expiration_changed:Mu.acs_calling_token_expiration_changed_failure,tenant:ft,properties:{deltaTimeInMs:F}})}catch(F){this.logger.debug("Unable to send token change telemetry")}},this.sendTokenExpiredEvent=()=>{try{this._telemetryLogManager.sendEvent({name:Mu.acs_calling_token_expired,tenant:ft})}catch(F){this.logger.debug("Unable to send token expired telemetry")}},this.logger=B.createChild("CallAgent"+_h++),this._telemetryLogManager=W,this._kind=K,this._eventEmitter=new CallingEventEmitter(this.logger),this.clientId=G,this._abortController=new AbortController,this._maxDisplayNameLength=(null===(Q=null===(J=getAcsEcsConfig())||void 0===J?void 0:J.calling)||void 0===Q?void 0:Q.maxDisplayNameLength)||Rt,this._previousTokenExpiration=0,this._tokenFetchTries=0,this._maxNmberOfRetries=(null===($=null===(Y=getAcsEcsConfig())||void 0===Y?void 0:Y.calling)||void 0===$?void 0:$.maxNumberOfTokenFetchRetries)||It,this._callStack=z,this._parsedTokenCredential={jwtToken:"",acsResourceId:void 0,identityMri:"",cloudType:Be.Public,isCte:!1,countryCode:""},this._caConfigBag={clientId:"",acsResourceId:this._parsedTokenCredential.acsResourceId,identityMri:this._parsedTokenCredential.identityMri,cloudType:this._parsedTokenCredential.cloudType,identityType:this._parsedTokenCredential.isCte?Ke.Enterprise:Ke.Consumer,countryCode:this._parsedTokenCredential.countryCode,emergencyCountryCode:void 0,IsUserEmergencyCountryCode:!1},this._httpRequestHelper=new HttpRequestHelper(this.logger),this._extensibleApi=new ExtensibleFeatureImpl(this.logger,{callClient:this._callClient,callAgent:this},{tsStack:this.tsStack,callAgent:this,telemetryLogManager:this._telemetryLogManager});const X=getRegisteredFeatures(Yt.CallAgentFeature);for(const F of X)"OnExtendedObjectConstructor"===F.activationOptions.activationEvent&&this.feature(F)}get kind(){return this._kind}getHttpRequestHelper(){return this._httpRequestHelper}getTrouterState(){return this._callStack.getTrouterState()}getAcsResourceId(){var F;return(null===(F=this._parsedTokenCredential)||void 0===F?void 0:F.acsResourceId)||""}getUserMri(){var F;return`8:${null===(F=this._parsedTokenCredential)||void 0===F?void 0:F.identityMri}`||""}initialize(F,B,G){var W,z;return __awaiter$j(this,void 0,void 0,(function*(){const K=+new Date;try{if(this.sendCallAgentInitializiedEvent(Mu.acs_calling_call_agent_init_attempt,{attemptTimestamp:K}),this._communicationTokenCredential=F,this._parsedTokenCredential=yield parseTokenCredential(F,{abortSignal:this._abortController.signal}),null==G?void 0:G.displayName){if(this.isCteUser())throw new CallingCommunicationError({message:"Display name is not allowed to be set for Teams users.",code:ne});if((null==G?void 0:G.displayName.length)>this._maxDisplayNameLength)throw new CallingCommunicationError({message:`Display name is too long, max length is ${this._maxDisplayNameLength} characters`,code:ne})}if(this._parsedTokenCredential.cloudType===Be.Public&&(!this._parsedTokenCredential.countryCode||""===this._parsedTokenCredential.countryCode)){try{const F=+new Date-K;this._telemetryLogManager.sendEvent({name:Mu.acs_calling_token_has_no_data_location,tenant:ft,properties:{deltaTimeInMs:F}})}catch(F){this.logger.debug("Unable to send token has no data location assigned")}getAcsEcsConfig().calling.eudb.defaultDataLocationEurope&&(this._parsedTokenCredential.countryCode=Je[0],this.logger.info("Used default data location because token has no data location assigned"))}this._caConfigBag={clientId:this.clientId,acsResourceId:this._parsedTokenCredential.acsResourceId,identityMri:this._parsedTokenCredential.identityMri,cloudType:this._parsedTokenCredential.cloudType,identityType:this._parsedTokenCredential.isCte?Ke.Enterprise:Ke.Consumer,emergencyCountryCode:null===(W=null==G?void 0:G.emergencyCallOptions)||void 0===W?void 0:W.countryCode,countryCode:this._parsedTokenCredential.countryCode,IsUserEmergencyCountryCode:!!(null===(z=null==G?void 0:G.emergencyCallOptions)||void 0===z?void 0:z.countryCode)},this.addToCallAgentsMap(this._parsedTokenCredential),this.onDisposedCallback=B;const J=this._communicationTokenCredential.getToken;this._disposed=!1;const wrappedGetToken=F=>__awaiter$j(this,void 0,void 0,(function*(){const B=+new Date;try{const G=yield J.apply(this._communicationTokenCredential,[F]),W=+new Date;return G.expiresOnTimestamp!==this._previousTokenExpiration&&(this.sendTokenChangedEvent(W-B,!0),this._previousTokenExpiration=G.expiresOnTimestamp),G}catch(F){const G=+new Date;this._previousTokenExpiration=0,this.sendTokenChangedEvent(G-B,!1),logErrorAndThrow("Failed to get token",ce,this.logger)}}));F.getToken=wrappedGetToken,this.tsStack=yield this._callStack.initializeStackForUser(this.tokenProvider,this._caConfigBag),this._telemetryLogManager.initialize(this._caConfigBag),this._tsCallRegistry=yield this.initializeCallRegistry(this.tsStack,G);const Q=+new Date;this.sendCallAgentInitializiedEvent(Mu.acs_calling_call_agent_init_success,{deltaTimeInMs:Q-K})}catch(F){this._caConfigBag&&!this._telemetryLogManager.isInitialized()&&this._telemetryLogManager.initialize(this._caConfigBag);const B=new CallingCommunicationError({message:"Failed to create CallAgent",code:ue},F);this.removeFromCallAgentsMap(this._parsedTokenCredential);const G=+new Date;throw this.sendCallAgentInitializiedEvent(Mu.acs_calling_call_agent_init_failure,{deltaTimeInMs:G-K},B),this._telemetryLogManager.clearTelemetryLoggers(),B}}))}isCteUser(){var F,B;return void 0!==(null===(F=this._parsedTokenCredential)||void 0===F?void 0:F.isCte)&&(null===(B=this._parsedTokenCredential)||void 0===B?void 0:B.isCte)}getClientId(){return this.clientId}getCallByCallId(F,B){var G;return B?this._tsCallRegistry.getCall(F,B):null===(G=this._tsCallRegistry.calls.filter((B=>B.callId===F)))||void 0===G?void 0:G[0]}createTransferTargetCall(F){const B=te.generateCauseId(),G=generateGuid(),W=generateGuid(),z=this._tsCallRegistry.createCall("",G,W,void 0,B),K=this.createNewCall(G,z);return this.addToCallArray(K),this.handleCallState(K),z.init({threadId:"",messageId:void 0,transferContext:F,mediaPeerType:0}),z.addParticipant(F.targetMri).catch((()=>{this.logger.error("Failed to add participant for transer call")})),K.bindTsCall(),this._eventEmitter.emit("callsUpdated",{added:[K],removed:[]}),K}feature(F){return this._extensibleApi.getApiObjectInstance(F.callAgentApiCtor)}sendCallAgentInitializiedEvent(F,B,G){try{let W="string"==typeof(null==G?void 0:G.message)?null==G?void 0:G.message:void 0;F!==Mu.acs_calling_call_agent_init_failure&&(W=void 0),this._telemetryLogManager.sendEvent({name:F,tenant:ft,properties:Object.assign(Object.assign({},B),{failureReason:W,additionalInformation:{trouterState:this.getTrouterState()}})})}catch(F){this.logger.debug("Unable to send telemtery")}}initializeCallRegistry(F,B){var G;return __awaiter$j(this,void 0,void 0,(function*(){let W=null===(G=B)||void 0===G?void 0:G.displayName;const z=yield this.getCallRegistry(F,this._parsedTokenCredential,this.tokenProvider,W);return this.logger.info(`registry created for version number=${getSdkVersion()}`),z}))}getCallRegistry(F,B,G,W){var z,K,J,Q;return __awaiter$j(this,void 0,void 0,(function*(){const Y={id:B.identityMri,displayName:W||"",tokenProvider:G},$=yield F.createCallRegistry(Y);yield $.login(Y);const X=(null===(J=null===(K=null===(z=getAcsEcsConfig())||void 0===z?void 0:z.tsCalling)||void 0===K?void 0:K.accountConfiguration)||void 0===J?void 0:J.ring)||void 0,Z=B.isCte?Ke.Enterprise:Ke.Consumer;let ee={acsResourceId:B.acsResourceId,clientType:Z,ring:X,region:B.countryCode};return(null===(Q=getAcsEcsConfig())||void 0===Q?void 0:Q.calling.supportLiveStreaming)&&(ee.clientSupportsMiddleLane=!0),$.setConfiguration(ee),$.on("callAdded",this.handleCallAdded),$.on("callRemoved",this.handleCallRemoved),W&&$.updateDisplayName(W),$}))}}__decorate$b([loggerProperty,__metadata$b("design:type",Object)],CallAgentCommonImpl.prototype,"logger",void 0),__decorate$b([asyncOperation(Se.Initialize),__metadata$b("design:type",Function),__metadata$b("design:paramtypes",[Object,Function,Object]),__metadata$b("design:returntype",Promise)],CallAgentCommonImpl.prototype,"initialize",null),__decorate$b([syncOperation(Se.Feature),__metadata$b("design:type",Function),__metadata$b("design:paramtypes",[Object]),__metadata$b("design:returntype","function"==typeof(Sh="undefined"!=typeof TFeature&&TFeature)?Sh:Object)],CallAgentCommonImpl.prototype,"feature",null);var __decorate$c=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$c=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$k=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};const Ch=new Map;class CallAgentImpl extends CallAgentCommonImpl{constructor(B,G,W,z,K,J){super(B,G,z,K,W,F.CallAgentKind.CallAgent),this._calls=[],this.handleCallRemoved=F=>{this.logger.info(`removing callId=${F.callId}`);const B=this._calls.find((B=>B.id===F.callId));if(B){const F=this._calls.indexOf(B);-1!==F&&this._calls.splice(F,1),B.dispose(),this._eventEmitter.emit("callsUpdated",{added:[],removed:[B]}),this.logger.info("call removed")}},this.handleCallAdded=F=>{if(!this._calls.find((B=>B.id===F.callId))){const B=F.on("callStateChanged",(()=>{if(1===F.state){const G=F.callId;B.dispose();const W=new CallImpl({callId:G,isIncoming:!0},this,F,this._telemetryLogManager),z=new IncomingCallImpl(W);this.handleCallState(W),W.bindTsCall(),this._eventEmitter.emit("incomingCall",{incomingCall:z})}}))}},this.handleCallState=F=>{F.on("stateChanged",(()=>{try{if("Disconnected"===F.state){this.tsStack?(this._tsCallRegistry.deleteCall(F.tsCall)||this.logger.error(`Failed to remove call from registry, call id: ${F.id}`),F.stats.flushEvents(),this._telemetryLogManager.flushAllEvents(F.id).catch((()=>{this.logger.error("Failed to flush telemetry log manager events")}))):this.logger.info("Unable to remove call from registry")}else"Connecting"===F.state&&"Incoming"==F.direction&&(this._calls.push(F),this._eventEmitter.emit("callsUpdated",{added:[F],removed:[]}))}catch(F){this.logger.error("Failed to handle call state changed event")}}))},this.displayName=null==J?void 0:J.displayName}get calls(){return this._calls}addToCallAgentsMap(F){Ch.get(null==F?void 0:F.identityMri)&&logErrorAndThrow("Failed to create call agent, call agent for this ACS Id already exists",ce,this.logger),Ch.set(null==F?void 0:F.identityMri,this)}removeFromCallAgentsMap(F){(null==F?void 0:F.identityMri)&&Ch.get(null==F?void 0:F.identityMri)===this&&Ch.delete(null==F?void 0:F.identityMri)}getExistingCallAgentWithToken(F){return __awaiter$k(this,void 0,void 0,(function*(){try{const B=yield parseTokenCredential(F);return Ch.get(B.identityMri)}catch(F){throw new CallingCommunicationError({message:"Failed to parse AccessToken",code:ne})}}))}createNewCall(F,B){return new CallImpl({callId:F},this,B,this._telemetryLogManager)}addToCallArray(F){this._calls.push(F)}startCall(F,B){var G;if(this.assertCallUserIds(F),(null==B?void 0:B.alternateCallerId)&&validateIdentifier(B.alternateCallerId),F.find((F=>getMriFromIdentifier(F)===this.getUserMri())))throw new CallingCommunicationError({message:"Call to yourself is not supported.",code:ne});if(this.isCteUser()&&F.length>1&&!(null==B?void 0:B.threadId))throw new CallingCommunicationError({message:"Starting a group call with Teams users must include thread ID in StartCallOptions.",code:ne});let W=null===(G=null==B?void 0:B.audioOptions)||void 0===G?void 0:G.muted;return void 0===W&&(W=!1),this.logger.info(`startCall with video=${!!(null==B?void 0:B.videoOptions)},muted=${W}`),this.createCall({participants:F,startCallOptions:B})}join(F,B){var G;if(this.isCteUser()&&F.groupId)throw new CallingCommunicationError({message:"Join using group ID is not supported for Teams users.",code:ne});this.assertCallContext(F);let W=null===(G=null==B?void 0:B.audioOptions)||void 0===G?void 0:G.muted;return void 0===W&&(W=!1),this.logger.info(`join with video=${!!(null==B?void 0:B.videoOptions)},muted=${W}`),this.createCall({callContext:F,startCallOptions:B})}dispose(){var F,B,G;return __awaiter$k(this,void 0,void 0,(function*(){if(this._disposed)throw new CallingCommunicationError({message:"Call Agent is already disposed",code:ce});this._disposed=!0,this._abortController.abort(),this._extensibleApi.dispose(),(null===(F=this._parsedTokenCredential)||void 0===F?void 0:F.identityMri)&&Ch.delete(null===(B=this._parsedTokenCredential)||void 0===B?void 0:B.identityMri);try{const F=this._tokenFetchTries>this._maxNmberOfRetries;yield null===(G=this._callStack)||void 0===G?void 0:G.dispose(F)}catch(F){this.logger.error("Call Agent failed to dispose to Call Stack")}delete this._callStack,this._telemetryLogManager.clearTelemetryLoggers(),this.onDisposedCallback&&this.onDisposedCallback()}))}on(F,B){if("incomingCall"!==F&&"callsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("incomingCall"!==F&&"callsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}createCall(F){var B,G,W,z,K,J,Q,Y,$,X,Z,ee,ne,ie;let re,oe,ae,se=(null===(B=null==F?void 0:F.callContext)||void 0===B?void 0:B.threadId)||(null===(G=null==F?void 0:F.startCallOptions)||void 0===G?void 0:G.threadId),ce=null===(W=null==F?void 0:F.callContext)||void 0===W?void 0:W.groupId;const le=null===(z=null==F?void 0:F.callContext)||void 0===z?void 0:z.roomId,de=null===(K=null==F?void 0:F.callContext)||void 0===K?void 0:K.meetingLink,pe=null===(J=null==F?void 0:F.callContext)||void 0===J?void 0:J.meetingId;if(ce&&ce.startsWith("19:")&&(se=ce,ce=""),de&&(oe=parseMeetingUrl(de)),(null===(Q=null==F?void 0:F.callContext)||void 0===Q?void 0:Q.threadId)&&(null===(Y=null==F?void 0:F.callContext)||void 0===Y?void 0:Y.organizerId)&&(null===($=null==F?void 0:F.callContext)||void 0===$?void 0:$.tenantId)&&(oe={threadId:null===(X=null==F?void 0:F.callContext)||void 0===X?void 0:X.threadId,messageId:(null===(Z=null==F?void 0:F.callContext)||void 0===Z?void 0:Z.messageId)?null===(ee=null==F?void 0:F.callContext)||void 0===ee?void 0:ee.messageId.toString():"0",organizerId:null===(ne=null==F?void 0:F.callContext)||void 0===ne?void 0:ne.organizerId,tenantId:null===(ie=null==F?void 0:F.callContext)||void 0===ie?void 0:ie.tenantId}),oe&&(ae={meetingType:"0"===oe.messageId?1:2,tenantId:oe.tenantId,organizerId:oe.organizerId,replyChainMessageId:oe.messageId}||void 0,se=oe.threadId,re=oe.messageId),this.tsStack){const B=te.generateCauseId(),G=generateGuid(),W=generateGuid();let z;z=ce?this._tsCallRegistry.createCallWithGroupId(ce,G,W,B):pe?this._tsCallRegistry.createCallWithMeetingData({meetingCode:pe,threadId:se},G,W,B):le?this._tsCallRegistry.createCallWithMeetingData({meetingCode:le},G,W,B):this._tsCallRegistry.createCall(se||"",G,W,re,B);const K=new CallImpl({callId:G,roomId:le},this,z,this._telemetryLogManager);this._calls.push(K),this.handleCallState(K);const J={threadId:se||"",messageId:re||"",meetingInfo:ae,mediaPeerType:2};return(null==F?void 0:F.participants)&&(null==F||F.participants.forEach((F=>{z.addParticipant(getMriFromIdentifier(F)).catch((()=>{this.logger.error("Failed to add participant during call start")}))}))),K.startCallInternal(null==F?void 0:F.startCallOptions,!!pe||!!le,null==F?void 0:F.callContext,J).catch(noop),K.bindTsCall(),this._eventEmitter.emit("callsUpdated",{added:[K],removed:[]}),K}throw new CallingCommunicationError({message:"Failed to start or join call, call stack did not initialize",code:ue})}assertCallContext(F){if(!F||this.checkForAtLeastOneValidCallConfig(F)||this.checkIfMultiplesConfigsWereSpecified(F)||this.checkForInvalidTeamsMeetingCoordinates(F))throw new CallingCommunicationError({message:"Invalid call configuration",code:ne})}checkForAtLeastOneValidCallConfig(F){return!(F.threadId||F.meetingLink||F.groupId||F.meetingId||F.roomId)}checkIfMultiplesConfigsWereSpecified(F){return F.threadId&&F.groupId||F.groupId&&F.meetingLink}checkForInvalidTeamsMeetingCoordinates(F){return!F.threadId&&F.tenantId&&F.organizerId||F.threadId&&(F.organizerId&&!F.tenantId||!F.organizerId&&F.tenantId)}assertCallUserIds(F){assertIsObject(F,"userIds must be object"),assertNotNull(F,"userIds cannot be null"),assertIsArrayOfIdentifiers(F,"userIds must be array of CommunicationIdentifier"),F.forEach((F=>{validateIdentifier(F)}))}}__decorate$c([syncOperation(Se.StartCall),__metadata$c("design:type",Function),__metadata$c("design:paramtypes",[Array,Object]),__metadata$c("design:returntype",Object)],CallAgentImpl.prototype,"startCall",null),__decorate$c([syncOperation(Se.Join),__metadata$c("design:type",Function),__metadata$c("design:paramtypes",[Object,Object]),__metadata$c("design:returntype",Object)],CallAgentImpl.prototype,"join",null),__decorate$c([asyncOperation(Se.Dispose),__metadata$c("design:type",Function),__metadata$c("design:paramtypes",[]),__metadata$c("design:returntype",Promise)],CallAgentImpl.prototype,"dispose",null);class EcsProvider{constructor(F,B){this.setConfigOrDefault=(F,B)=>{F&&Object.keys(F).forEach((G=>{void 0!==F[G]&&(B[G]=F[G])}))},this._logger=F,this.sdkUserAgent=B;const G=getAcsEcsConfig().calling.applicationSettingsUrls;this._trouterSettings={version:`${getPlatformId()}/${getSdkInternalVersion()}`,productName:"AcsWeb",trouterServiceUrl:G.Public_TrouterServiceUrl,registrarServiceUrl:G.Public_RegistrarServiceUrl,maxRegistrationTimeInMs:36e5,pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_2.0",environment:"Prod",platform:getPlatformName()},this._JsCsaConfig={languageCode:"en",emergencyCallCountry:"",autoResolveConflictedCall:!1,handleRosterFromCreateAndJoin:!0,conversationServiceUrl:G.Public_ConversationServiceUrl,useInternalHttpDispatcher:!0,supportsHostlessGroupCalls:!0,doHostlessCalling:!0,shouldServiceSendCallEventMessages:!0,shouldServiceSendNGCUpgradeMessages:!0,supportsCompressedServicePayload:!0,handleNewOfferRequest:!0,handleMediaOfferFromPushNotification:!0,isWebRtcEnabled:!0,supportsSynchronousTrouterResponse:!0,autoJoinOnConflict:!0,brokerEnabledOutgoing:!0,brokerEnabledIncoming:!0,brokerExclusively:!1,brokerRequestBatching:!0,isGVCOutgoingEnabled:!0,isGVCJoiningEnabled:!0,enableTokenCache:!1},this._JamaSettingsMobile={webrtcCameraOpenFs:900,webrtcMultipartyMaxScalingFs:900,webrtcMaxScalingFs:900},this._JamaSettings={debug:!1,numVideoChannelsGvc:6,webrtcVideoCapabilityMaxFS:3600,webrtcCameraOpenFs:3600,webrtcMultipartyMaxScalingFs:3600,webrtcMaxScalingFs:3600,webrtcMultiPartyRecvVideoMaxFS:3600,webrtcRecvVideoMaxFS:3600,webrtcRejectedFeatures:"byPass",webrtcRequiredFeatures:"nonByPass",webrtcEnabledTransportCC:!0,webrtcSimulcastSessionEnabled:!0,webrtcFmtParamListSupported:!0,webrtcAllowRestoreKeyframe:!0,webrtcUnifiedPlanEnabledMultiparty:!0,webrtcUnifiedPlanEnabled1on1:!0,preferSdesSrtp1on1:!1,preferSdesSrtpPstn:!1,preferSdesSrtpMultiparty:!1},this._MDNTrapSettings={Service:{url:G.Public_MdnTrapServiceUrl,tokenUrl:G.Public_MdnTrapServiceTokenUrl},Relay:{Skype:{addresses:[],fqdns:[G.Public_MdnTrapRelaySkypeFqdns],tcpPort:443,udpPort:3478},Turn:{addresses:[],fqdns:[G.Public_MdnTrapRelayTurnFqdns],tcpPort:443,udpPort:3478,url:G.Public_MdnTrapRelayTurnUrl}},Http:{connectionTimeout:30,requestTimeout:60},Token:{earlyRefreshMinutes:1080,earlyRefreshPercentage:25}},this._TrouterJScriptClient={TelemetryEnabled:!1,ClientTelemetryEventEnabled:{trouter_js_client_connected:!1,trouter_js_client_disconnected:!1,trouter_js_client_error:!1,trouter_js_client_progress:!1,trouter_js_client_response:!1,trouter_js_client_check_connection:!1,trouter_js_client_registration:!1,trouter_js_client_unregistration:!1,logHealthCheckError:!1,logSendPingError:!1,numberOfStepsToMaintain:0,sendProgressTimeoutSecs:0}}}getTrouterTelemetryConfig(){return Object.assign({enabled:this._TrouterJScriptClient.TelemetryEnabled},this._TrouterJScriptClient.ClientTelemetryEventEnabled)}getJamaSettings(){const F=getBrowserInfo();let B=this._JamaSettings;return"Mobile"==F.formFactor&&(B=Object.assign(Object.assign({},B),this._JamaSettingsMobile)),B}getClientInformation(){const F=getAcsEcsConfig().telemetry.reportSdkUaToService;return`ACSWeb(${getPlatformId()}/${getSdkInternalVersion()})`+(F?`/(${this.sdkUserAgent})`:"")}getJsCsaConfig(){return Object.assign(Object.assign({},this._JsCsaConfig),{clientInformation:this.getClientInformation()})}getMdnTrapSettings(){return this._MDNTrapSettings}getTrouterSettings(){return this._trouterSettings}setConfig(F,B){this._logger.info("Update ECS settings");const G=getAcsEcsConfig().calling.applicationSettingsUrls,W=isEudbLocation(getAcsEcsConfig().calling.eudb.countries,F);if((null==F?void 0:F.identityType)==Ke.Enterprise)this._trouterSettings.trouterServiceUrl=G.Enterprise_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=G.Enterprise_RegistrarServiceUrl;else switch(null==F?void 0:F.cloudType){case Be.Public:W&&(this._trouterSettings.trouterServiceUrl=G.Public_TrouterServiceUrl_EUDB,this._trouterSettings.registrarServiceUrl=G.Public_RegistrarServiceUrl_EUDB,this._JsCsaConfig.conversationServiceUrl=G.Public_ConversationServiceUrl_EUDB,this._MDNTrapSettings.Service.url=G.Public_MdnTrapServiceUrl_EUDB,this._MDNTrapSettings.Service.tokenUrl=G.Public_MdnTrapServiceTokenUrl_EUDB,this._MDNTrapSettings.Relay.Skype.fqdns=[G.Public_MdnTrapRelaySkypeFqdns_EUDB],this._MDNTrapSettings.Relay.Turn.fqdns=[G.Public_MdnTrapRelayTurnFqdns_EUDB],this._MDNTrapSettings.Relay.Turn.url=G.Public_MdnTrapRelayTurnUrl_EUDB);break;case Be.GccHigh:this._trouterSettings.trouterServiceUrl=G.GccHigh_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=G.GccHigh_RegistrarServiceUrl;break;case Be.Dod:this._trouterSettings.trouterServiceUrl=G.Dod_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=G.Dod_RegistrarServiceUrl;break;case Be.AirGap08:this._trouterSettings.trouterServiceUrl=G.AirGap08_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=G.AirGap08_RegistrarServiceUrl;break;case Be.AirGap09:this._trouterSettings.trouterServiceUrl=G.AirGap09_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=G.AirGap09_RegistrarServiceUrl}if(B)this.setConfigOrDefault(null==B?void 0:B.SkypeCalling,this._JsCsaConfig),this.setConfigOrDefault(null==B?void 0:B.MDN_TRAP,this._MDNTrapSettings),this.setConfigOrDefault(null==B?void 0:B.SkypeWebMedia.mediaAgent,this._JamaSettings),this.setConfigOrDefault(null==B?void 0:B.TrouterJScriptClient,this._TrouterJScriptClient);else if((null==F?void 0:F.identityType)===Ke.Enterprise)this._JsCsaConfig.conversationServiceUrl=G.Enterprise_ConversationServiceUrl,this._MDNTrapSettings.Service.url=G.Enterprise_MdnTrapServiceUrl,this._MDNTrapSettings.Service.tokenUrl=G.Enterprise_MdnTrapServiceTokenUrl,this._MDNTrapSettings.Relay.Skype.fqdns=[G.Enterprise_MdnTrapRelaySkypeFqdns],this._MDNTrapSettings.Relay.Turn.fqdns=[G.Enterprise_MdnTrapRelayTurnFqdns],this._MDNTrapSettings.Relay.Turn.url=G.Enterprise_MdnTrapRelayTurnUrl;else switch(null==F?void 0:F.cloudType){case Be.Public:W&&(this._trouterSettings.trouterServiceUrl=G.Public_TrouterServiceUrl_EUDB,this._trouterSettings.registrarServiceUrl=G.Public_RegistrarServiceUrl_EUDB,this._JsCsaConfig.conversationServiceUrl=G.Public_ConversationServiceUrl_EUDB,this._MDNTrapSettings.Service.url=G.Public_MdnTrapServiceUrl_EUDB,this._MDNTrapSettings.Service.tokenUrl=G.Public_MdnTrapServiceTokenUrl_EUDB,this._MDNTrapSettings.Relay.Skype.fqdns=[G.Public_MdnTrapRelaySkypeFqdns_EUDB],this._MDNTrapSettings.Relay.Turn.fqdns=[G.Public_MdnTrapRelayTurnFqdns_EUDB],this._MDNTrapSettings.Relay.Turn.url=G.Public_MdnTrapRelayTurnUrl_EUDB);break;case Be.GccHigh:this._JsCsaConfig.conversationServiceUrl=G.GccHigh_ConversationServiceUrl,this._MDNTrapSettings.Service.url=G.GccHigh_MdnTrapServiceUrl,this._MDNTrapSettings.Service.tokenUrl=G.GccHigh_MdnTrapServiceTokenUrl,this._MDNTrapSettings.Relay.Skype.fqdns=[G.GccHigh_MdnTrapRelaySkypeFqdns],this._MDNTrapSettings.Relay.Turn.fqdns=[G.GccHigh_MdnTrapRelayTurnFqdns],this._MDNTrapSettings.Relay.Turn.url=G.GccHigh_MdnTrapRelayTurnUrl;break;case Be.Dod:this._JsCsaConfig.conversationServiceUrl=G.Dod_ConversationServiceUrl,this._MDNTrapSettings.Service.url=G.Dod_MdnTrapServiceUrl,this._MDNTrapSettings.Service.tokenUrl=G.Dod_MdnTrapServiceTokenUrl,this._MDNTrapSettings.Relay.Skype.fqdns=[G.Dod_MdnTrapRelaySkypeFqdns],this._MDNTrapSettings.Relay.Turn.fqdns=[G.Dod_MdnTrapRelayTurnFqdns],this._MDNTrapSettings.Relay.Turn.url=G.Dod_MdnTrapRelayTurnUrl;break;case Be.AirGap08:this._JsCsaConfig.conversationServiceUrl=G.AirGap08_ConversationServiceUrl;break;case Be.AirGap09:this._JsCsaConfig.conversationServiceUrl=G.AirGap09_ConversationServiceUrl}}}var Th=createCommonjsModule((function(F,B){var G;G=function(){return function(F){function e(G){if(B[G])return B[G].exports;var W=B[G]={i:G,l:!1,exports:{}};return F[G].call(W.exports,W,W.exports,e),W.l=!0,W.exports}var B={};return e.m=F,e.c=B,e.i=function(F){return F},e.d=function(F,B,G){e.o(F,B)||Object.defineProperty(F,B,{configurable:!1,enumerable:!0,get:G})},e.n=function(F){var B=F&&F.__esModule?function(){return F.default}:function(){return F};return e.d(B,"a",B),B},e.o=function(F,B){return Object.prototype.hasOwnProperty.call(F,B)},e.p="",e(e.s=1)}([function(F,B,G){function n(F,B){var G,W=new Promise((function(B,W){fetch(F).then((function(F){clearTimeout(G),B(F)})).catch((function(F){clearTimeout(G),W(F)}))}));if(0!==B){var z=new Promise((function(W,z){G=setTimeout(z,B,new Error("Fetch for '"+F.url+"' timed out"))}));return Promise.race([W,z])}return W}function i(F){try{return JSON.stringify(F)}catch(B){return"Unable to serialize object of type "+typeof F}}Object.defineProperty(B,"__esModule",{value:!0}),B.fetchWithTimeout=n,B.toJson=i;var W=function(){function t(){this.start=Date.now()}return Object.defineProperty(t.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.start=Date.now()},t}();B.Timespan=W},function(F,B,G){function n(F,B,G){return new $(F,B,G)}var W=this&&this.__extends||function(){var F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])};return function(B,G){function n(){this.constructor=B}F(B,G),B.prototype=null===G?Object.create(G):(n.prototype=G.prototype,new n)}}(),z=this&&this.__awaiter||function(F,B,G,W){return new(G||(G=Promise))((function(z,K){function s(F){try{c(W.next(F))}catch(F){K(F)}}function a(F){try{c(W.throw(F))}catch(F){K(F)}}function c(F){F.done?z(F.value):new G((function(B){B(F.value)})).then(s,a)}c((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){function r(F){return function(B){return n([F,B])}}function n(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=(z=J.trys).length>0&&z[z.length-1])&&(6===K[0]||2===K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K};Object.defineProperty(B,"__esModule",{value:!0});var J=G(0),Q=function(F){function e(B){var G=F.call(this,B)||this;return G.name="CancelationError",G}return W(e,F),e}(Error),Y=function(){function t(F,B,G){this.logger=F,this.maxBackoffInMs=B,this.initialDelay=G,this.backoffCount=0,this.id=++t.idCounter}return t.prototype.delay=function(F){var B=this;if(void 0!==this.timerHandle)throw new Error("Retry sequence logical failure");if(-1===this.backoffCount)return new Promise((function(F,B){B(new Q("Cancelled"))}));var G=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off "+F+" for "+G+" milliseconds with ID "+this.id),new Promise((function(W,z){B.cancelFunc=z,B.timerHandle=setTimeout((function(){B.logger.info("[RegistrarClient] Back off for "+F+" with ID "+B.id+" complete"),B.timerHandle=void 0,W()}),G)}))},t.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new Q("Cancelled"))),this.backoffCount=-1},t.prototype.calculateNextBackoffMs=function(){var F=1+.4*(Math.random()-.5),B=this.initialDelay*Math.pow(2,this.backoffCount)*F;return B=Math.round(B),Math.min(this.maxBackoffInMs,B)},t.idCounter=0,t}(),$=function(){function t(F,B,G){this.logger=F,this.skypeTokenProvider=B,this.options=G,this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN=15,this.DEFAULT_MAX_BACKOFF_TIME_IN_MS=3e5,this.backoffs={},this.maxBackOffTime=this.options.maxRetryDelayMs>0?this.options.maxRetryDelayMs:this.DEFAULT_MAX_BACKOFF_TIME_IN_MS,this.maxRetriesForGetToken=void 0===G.maxRetriesForGetToken||null===G.maxRetriesForGetToken?this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN:G.maxRetriesForGetToken}return t.prototype.setTelemetryLogger=function(F){this.eventLogger=F},t.prototype.register=function(F,B){return z(this,void 0,void 0,(function(){return K(this,(function(G){switch(G.label){case 0:return[4,this.performRegistration(F,B,"pr_set_registration")];case 1:return G.sent(),this.cachedRegistrationParams=[F,B],[2]}}))}))},t.prototype.unregister=function(){return z(this,void 0,void 0,(function(){var F;return K(this,(function(B){switch(B.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),F=new Request(this.options.registrarUrl+"/"+this.options.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({accept:"application/json, text/javascript"})}),[4,this.callRegistrar(F,"pr_delete_registration")];case 1:return B.sent(),[2]}}))}))},t.prototype.cancelPendingRequests=function(){var F=this;Object.keys(this.backoffs).forEach((function(B){F.backoffs[B].cancel()})),this.backoffs={}},t.prototype.resendRegistration=function(){return z(this,void 0,void 0,(function(){return K(this,(function(F){switch(F.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return F.sent(),[2]}}))}))},t.prototype.performRegistration=function(F,B,G){return z(this,void 0,void 0,(function(){var W,z;return K(this,(function(K){switch(K.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),W={clientDescription:F,registrationId:this.options.registrationId,nodeId:"",transports:B},z=new Request(this.options.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"content-type":"application/json",accept:"application/json, text/javascript"}),body:J.toJson(W)}),[4,this.callRegistrar(z,G)];case 1:return K.sent(),[2]}}))}))},t.prototype.startBackoff=function(){var F=new Y(this.logger,this.maxBackOffTime,this.options.initialRetryDelayMs);return this.backoffs[F.id]=F,F},t.prototype.stopBackoff=function(F){F.cancel(),delete this.backoffs[F.id]},t.prototype.getSkypeToken=function(){return z(this,void 0,void 0,(function(){var F,B,G,W,z,J,Q;return K(this,(function(K){switch(K.label){case 0:F=this.startBackoff(),B=0,K.label=1;case 1:return K.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new skypetoken"),[4,this.skypeTokenProvider(!0)];case 2:return G=K.sent(),this.stopBackoff(F),[2,G];case 3:W=K.sent(),K.label=4;case 4:return K.trys.push([4,6,,7]),B++,z=JSON.stringify(W),B>this.maxRetriesForGetToken?(J="[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Error: "+z,this.logger.error(J),this.stopBackoff(F),[2,Promise.reject(J)]):(this.logger.warn("[RegistrarClient] Retrying for a new skype token. Retry Count: "+B+" Error: "+z),[4,F.delay("Fetching a new skypetoken")]);case 5:return K.sent(),[3,8];case 6:throw Q=K.sent(),this.stopBackoff(F),Q;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},t.prototype.callRegistrar=function(F,B){return z(this,void 0,void 0,(function(){var G,W,z,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae;return K(this,(function(K){switch(K.label){case 0:return G=this.startBackoff(),[4,this.skypeTokenProvider(!1)];case 1:W=K.sent(),this.setSkypeTokenHeader(F,W),z=new J.Timespan,Q=0,K.label=2;case 2:Y=void 0,K.label=3;case 3:return K.trys.push([3,8,13,14]),$=F.clone(),[4,J.fetchWithTimeout($,this.options.requestTimeoutMs)];case 4:return 401!==(Y=K.sent()).status?[3,6]:++Q>this.maxRetriesForGetToken?(X="[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '"+F.url+"' failed with "+Y.status+" "+Y.statusText,this.logger.error(X),this.stopBackoff(G),[2,Promise.reject(X)]):(this.logger.warn("[RegistrarClient] Retry Count "+Q+". Request '"+F.url+"' failed with "+Y.status+" "+Y.statusText),Z=this.setSkypeTokenHeader,ee=[F],[4,this.getSkypeToken()]);case 5:return Z.apply(this,ee.concat([K.sent()])),[3,20];case 6:if(Y.status>=500&&Y.status<600)throw new Error("Fetch for '"+F.url+"' failed with "+Y.status+" "+Y.statusText);K.label=7;case 7:return[3,14];case 8:te=K.sent(),this.logger.error("[RegistrarClient] Request failed with "+te),K.label=9;case 9:return K.trys.push([9,11,,12]),[4,G.delay("Registrar call retry")];case 10:return K.sent(),[3,20];case 11:throw ne=K.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(G),ne;case 12:return[3,14];case 13:return this.sendTelemetryEvent(B,F,Y,z),[7];case 14:return this.stopBackoff(G),Y.ok?[2,Y]:[3,15];case 15:ie=void 0,K.label=16;case 16:return K.trys.push([16,18,,19]),oe=(re=JSON).stringify,[4,Y.json()];case 17:return ie=oe.apply(re,[K.sent()]),[3,19];case 18:return K.sent(),ie="no details",[3,19];case 19:throw ae="Fetch for '"+F.url+"' failed with "+Y.status+" "+Y.statusText+" ("+ie+", MS-CV: "+Y.headers.get("MS-CV")+")",this.logger.error("[RegistrarClient] "+ae),new Error(ae);case 20:return[3,2];case 21:return[2]}}))}))},t.prototype.setSkypeTokenHeader=function(F,B){F.headers.set("X-Skypetoken",B)},t.prototype.sendTelemetryEvent=function(F,B,G,W){if(void 0!==this.eventLogger){var z={name:F,properties:{url:{value:B.url},result_code:{value:void 0!==G?G.status:0},begin_timestamp:{value:W.startTime},elapsed:{value:W.duration}}};this.eventLogger.logEvent(z)}},t}();B.RegistrarClient=$,B.createRegistrarClient=n}])},F.exports=G()})),Eh=createCommonjsModule((function(F,B){var G;G=function(F){return function(F){function e(G){if(B[G])return B[G].exports;var W=B[G]={i:G,l:!1,exports:{}};return F[G].call(W.exports,W,W.exports,e),W.l=!0,W.exports}var B={};return e.m=F,e.c=B,e.i=function(F){return F},e.d=function(F,B,G){e.o(F,B)||Object.defineProperty(F,B,{configurable:!1,enumerable:!0,get:G})},e.n=function(F){var B=F&&F.__esModule?function(){return F.default}:function(){return F};return e.d(B,"a",B),B},e.o=function(F,B){return Object.prototype.hasOwnProperty.call(F,B)},e.p="",e(e.s=19)}([function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function t(F,B){this.name=F,this.logger=B}return t.prototype.debug=function(F){this.logger.debug("["+this.name+"] "+F)},t.prototype.info=function(F){this.logger.info("["+this.name+"] "+F)},t.prototype.warn=function(F){this.logger.warn("["+this.name+"] "+F)},t.prototype.error=function(F){this.logger.error("["+this.name+"] "+F)},t}();B.Logger=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),B.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},B.CLIENT_VERSION="2022.35.01.26",B.HANDLED_MESSAGE_ACK=200,B.UNHANDLED_MESSAGE_ACK=404,B.FAILED_MESSAGE_ACK=500},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0}),function(F){F[F.Unknown=0]="Unknown",F[F.Active=1]="Active",F[F.Inactive=2]="Inactive"}(B.UserActivityState||(B.UserActivityState={}));var W=function(){function t(){}return t}();B.HttpHeaders=W,function(F){F[F.Unknown=0]="Unknown",F[F.Connected=2]="Connected",F[F.Disconnected=3]="Disconnected",F[F.Switching=9]="Switching"}(B.TrouterState||(B.TrouterState={}))},function(F,B,G){function o(F){try{return JSON.stringify(F)}catch(B){return"Unable to serialize object of type "+typeof F}}function i(F){var B=Math.round((new Date).getTime()/1e3);return void 0!==F&&F>B?F-B:0}function r(F){return Math.round((new Date).getTime()/1e3)+F}function s(F,B){return W(this,void 0,void 0,(function(){var G,W,K;return z(this,(function(z){return W=new Promise((function(B,W){fetch(F).then((function(F){clearTimeout(G),B(F)})).catch((function(F){clearTimeout(G),W(F)}))})),0!==B?(K=new Promise((function(W,z){var K=new URL(F.url),J=new Error(F.method+" "+K.origin+K.pathname+" timed out");G=setTimeout(z,B,J)})),[2,Promise.race([W,K])]):[2,W]}))}))}var W=this&&this.__awaiter||function(F,B,G,W){return new(G||(G=Promise))((function(z,K){function s(F){try{a(W.next(F))}catch(F){K(F)}}function c(F){try{a(W.throw(F))}catch(F){K(F)}}function a(F){F.done?z(F.value):new G((function(B){B(F.value)})).then(s,c)}a((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){function n(F){return function(B){return o([F,B])}}function o(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=(z=J.trys).length>0&&z[z.length-1])&&(6===K[0]||2===K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K};Object.defineProperty(B,"__esModule",{value:!0}),B.toJson=o,B.calculateTtlInSec=i,B.calculateExpireTsInSec=r,B.fetchWithTimeout=s;var K=function(){function t(F){this.base=void 0!==F?F:this.createCorrelationVectorBase(),this.extension=0}return t.extend=function(F){return new t(F)},t.prototype.increase=function(){this.extension++},t.prototype.value=function(){return this.base+"."+this.extension},t.prototype.createCorrelationVectorBase=function(){for(var F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+",B="AQgw",G="",W=0;W<21;W++)G+=F.charAt(Math.floor(Math.random()*F.length));return G+B.charAt(Math.floor(Math.random()*B.length))},t}();B.CorrelationVector=K;var J=function(){function t(){this.start=Date.now()}return Object.defineProperty(t.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.start=Date.now()},t}();B.Timespan=J},function(F,B){var G;G=function(){return this}();try{G=G||Function("return this")()||(0,eval)("this")}catch(F){"object"==typeof window&&(G=window)}F.exports=G},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(3),z=function(){function t(F,B,G,W,z,K,J){this.connectionId=F,this.connectedClientId=B,this.domId=G,this.unsecureUrl=W,this.url=z,this.c2cUrlBase=K,this.expirationTsSec=J}return t.prototype.getRemainingTtlInSec=function(){return W.calculateTtlInSec(this.expirationTsSec)},t}();B.ServerState=z,function(F){F[F.Unknown=0]="Unknown",F[F.Modified=1]="Modified",F[F.Snapshot=2]="Snapshot",F[F.Connected=3]="Connected"}(B.UserActivityEventReason||(B.UserActivityEventReason={}))},function(F,B,G){var W=this&&this.__assign||Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F};Object.defineProperty(B,"__esModule",{value:!0});var z,K=G(20),J=G(12),Q=G(3),Y=G(15),$=G(1),X=G(16),Z=G(2),ee=G(5),te=G(0),ne=G(17),ie=G(11),re=function(){function t(){this.cv=$.CLIENT_VERSION,this.ua="",this.hr="",this.v=""}return t}(),oe=function(){function t(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}return t}(),ae="MS-CV",se=function(){function t(F){this.cvCounter=0;var B=JSON.parse(F);this.startTS=B.hasOwnProperty("startTS")?B.startTS:0,this.url=B.hasOwnProperty("url")?B.url:"",this.shortUrl=B.hasOwnProperty("shortUrl")?B.shortUrl:"",this.body=B.hasOwnProperty("body")?B.body:"",this.headers=B.hasOwnProperty("headers")?B.headers:{},this.id=B.hasOwnProperty("id")&&"number"==typeof B.id?B.id:-1,this.method=B.hasOwnProperty("method")?B.method:"",this.replied=!1,this.timedout=!1,this.timeoutTimerId=0,this.receivedCv=this.headers[ae],this.updateCvHeader()}return Object.defineProperty(t.prototype,"correlationVector",{get:function(){return this.receivedCv?this.receivedCv+"."+this.cvCounter:""},enumerable:!0,configurable:!0}),t.prototype.on=function(F,B){"data"===F?this.dataCallback=B:"end"===F&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),B())},t.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},t.prototype.updateCvHeader=function(){var F=this.correlationVector;F&&(this.headers[ae]=F)},t}(),ce=function(){function t(F,B,G){this.request=F,this.responseData=B,this.sendResponse=G}return t.prototype.writeHead=function(F,B){this.responseData.status=F,this.responseData.headers=B},t.prototype.write=function(F){this.responseData.body+=F},t.prototype.end=function(F){return F&&(this.responseData.body+=F),this.sendResponse(this.request,this.responseData)},t}(),le=function(){function t(F){this.name=F,this.args={},this.timeoutTimerId=0}return t}();!function(F){F[F.Configuration=0]="Configuration",F[F.ServerInitiated=1]="ServerInitiated"}(z=B.ReconnectReason||(B.ReconnectReason={}));var de=function(){function t(F,B,G,W,z){var J=this;this.options=B,this.manager=G,this.tokenProvider=W,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.isNavigatorOnline=!0,this.onNavigatorOnlineStatusUpdateBound=this.onNavigatorOnlineStatusUpdate.bind(this),this.c2cUrlBase="",this.allocationErrorsInRow=0,this.unauthorizedErrorCount=0,this.pendingTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.logger=new te.Logger("Connection",F),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff=new X.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new re,this.clientInfo.cv=$.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new Y.ConnectionTracker(F,this.clientID,this.clientInfo,(function(){return J.getServerState()}),this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(B);var Q=this.options.incallModeTimeoutMs>0;if(this.fsm=new ne.TrouterFsm(F,this,Q),B.registration){var Z={registrarUrl:B.registration.registrarUrl,registrationId:B.registration.registrationId,requestTimeoutMs:B.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:B.timeoutOptions.maxBackoffMs};this.registrarClient=K.createRegistrarClient(F,this.tokenProvider,Z)}this.userActivityState=z}return t.prototype.start=function(F){this.logger.info("Starting"),this.reconnectParams=F,"undefined"!=typeof window&&window.navigator?(this.isNavigatorOnline=window.navigator.onLine,window.addEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.addEventListener("offline",this.onNavigatorOnlineStatusUpdateBound),this.logger.debug("Registered for browser online notifications - current state: "+this.isNavigatorOnline)):this.isNavigatorOnline=!0,this.fsm.start()},t.prototype.stop=function(F){this.logger.info("Stopping"),"undefined"!=typeof window&&window.navigator&&(window.removeEventListener("online",this.onNavigatorOnlineStatusUpdateBound),window.removeEventListener("offline",this.onNavigatorOnlineStatusUpdateBound)),this.fsm.stop(F),this.connectionTracker.close()},t.prototype.configure=function(F){var B=this.options.trouterUrl!==F.trouterUrl;this.options=F,this.applyConnectionTrackerOptions(F),B&&(this.logger.info("Configuration changed. Reconnection required."),this.fsm.onReconnectRequired(!1,z.Configuration))},t.prototype.checkConnection=function(F){this.logger.info("checkConnection called with "+F),this.fsm.checkConnection(F),F&&this.connectionTracker.sendTelemetry(Y.ClientEventName.CheckConnection,{disconnectDetected:F},[])},t.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegisterTimer(),this.resetRegisterBackoff(),this.fsm.disableAutoReconnect()},t.prototype.getServerState=function(){return new ee.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},t.prototype.getToken=function(F,B,G){var W=this;void 0===G&&(G=0),this.logger.info("Getting token "+(B?"with backoff":"without backoff"));var i=function(){W.connectionTracker.trackStart("token"),W.tokenProvider(!F).then((function(F){W.logger.debug("token is received"),W.connectionTracker.trackEnd("token"),W.fsm.onTokenReceived(F)})).catch((function(B){var z=Q.toJson(B.stack);if(W.logger.error("Getting token failed, will retry after timeout. Error: "+z),W.connectionTracker.trackError("token",z),!W.canRetryTokenFetchRequest(G+W.unauthorizedErrorCount))return W.connectionTracker.trackError("token","getToken retry limit hit, reached terminal error state"),W.resetTokenBackoff(),void W.fsm.onTerminalError();W.getToken(F,!0,G+1)}))};B?this.tokenBackoff.backoff("getting token",i):(this.resetTokenBackoff(),i())},t.prototype.startConnectionTimer=function(){var F=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout((function(){F.logger.info("Connection timeout is fired"),F.fsm.onConnectingTimeout()}),this.timeoutOptions.connectionTimeoutMs)},t.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},t.prototype.startPingTimer=function(){var F=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval((function(){F.logger.info("Ping interval fired"),F.fsm.onPingInterval()}),this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},t.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},t.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},t.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},t.prototype.startRegisterTimer=function(){var F=this;void 0!==this.registrationTimerId&&this.stopRegisterTimer();var B=this.getRegistrationTtl(),G=B[0],W=(B[1],G-30);W<=0?this.logger.debug("Not starting registration timer, ttl too low("+G+" sec)"):(this.logger.debug("Starting registration timeout for "+W+" sec"),this.registrationTimerId=setTimeout((function(){F.logger.info("Registration timeout is fired"),F.registrationTimerId=setTimeout((function(){F.registrationTimerId=void 0,F.logger.debug("Re-registration did not happen in time"),F.dispatchUnregistered()}),3e4),F.fsm.onRegistrationTimeout()}),1e3*W))},t.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},t.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.registrarClient.resendRegistration()},t.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");for(var F={},B=this.allocateResult.connectparams,G=0,W=Object.keys(B);G<W.length;G++){var z=W[G];B.hasOwnProperty(z)&&void 0!==B[z]&&(F[z]=B[z])}return F.v="v4",F.tc=encodeURI(Q.toJson(this.clientInfo)),F.timeout=this.timeoutOptions.pingTimeoutMs/1e3,F.auth="true",this.options.endpointId&&(F.epid=this.options.endpointId),this.userActivityState.state!==Z.UserActivityState.Unknown&&(F.userActivity=encodeURI(Q.toJson(this.userActivityState.toEventObject()))),this.appendConnectedClientIds(this.buildQuery(F),!0)},t.prototype.startSocketIo=function(){var F=this;if(this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var B=this.options.ioOptions||new oe;if(B["force new connection"]=!0,B.reconnect=!1,B.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+B.query),this.stopSocketIo(),this.socket=(this.options.io||ie).connect(this.allocateResult.socketio,B),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",(function(B){F.onSocketConnecting(B)})),this.socket.on("connect",(function(){F.onSocketConnect()})),this.socket.on("connect_failed",(function(B){F.onSocketConnectFailed(B)})),this.socket.on("disconnect",(function(B){F.onSocketDisconnect(B)})),this.socket.on("reconnect",(function(){F.onSocketReconnect()})),this.socket.on("reconnect_failed",(function(B){F.onSocketReconnectFailed(B)})),this.socket.on("reconnecting",(function(){F.onSocketReconnecting()})),this.socket.on("error",(function(B){F.onSocketError(B)})),this.socket.on("message",(function(B){F.onSocketMessage(B)})),this.socket.on("trouter.connected",(function(B){F.onTrouterConnected(B)})),this.socket.on("trouter.reconnect",(function(B){F.onTrouterReconnect(B)})),this.socket.on("trouter.message_loss",(function(B){F.onTrouterMessageLoss(B)}))},t.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var F=0,B=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];F<B.length;F++){var G=B[F];this.socket.removeAllListeners(G)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(F){this.logger.error("exception in disconnecting previous socket. Error: "+Q.toJson(F.stack))}}},t.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},t.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},t.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},t.prototype.dispatchDownstreamRequest=function(F){var B=this;this.logger.info("dispatching downstream request");try{var G=new ce(F,new Y.ResponseData(F.id),(function(F,G){return B.logger.info("sending response to downstream"),B.sendResponse(F,G)}));this.manager.onDownstreamRequest(this,F,G)}catch(F){this.logger.error("exception in socket.on message. Error : "+Q.toJson(F.stack))}},t.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},t.prototype.dispatchReconnectIsRequired=function(F,B){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this,F,B)},t.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},t.prototype.dispatchTrouterMessageLost=function(F){this.logger.info("dispatching trouter lost message"),this.manager.onTrouterMessageLost(F)},t.prototype.sendProcessedDroppedIndicators=function(F){var B=this;try{this.logger.info("emitting processed flow tags to the server");var G=new le("trouter.processed_message_loss");G.args={droppedIndicators:F},this.sendDownstreamEvent(G,(function(){B.logger.info("emitted processed flow tags to the server")}))}catch(F){var W=Q.toJson(F.stack);this.logger.error("unable to send processed message loss event. Error: "+W),this.connectionTracker.trackError("trouter.processed_message_loss",W,!1)}},t.prototype.sendAllocateRequest=function(F){var B=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var G,z=this.options.trouterUrl,K=z,J=this.reconnectParams;J&&J.se&&parseInt(J.se,10)<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: "+new Date(parseInt(J.se,10))),this.reconnectParams=J=void 0),J&&J.serviceUrl!==K&&(this.logger.warn("Dropping cached connection parameters for a different environment ("+J.serviceUrl+", now "+K+")"),this.reconnectParams=J=void 0),J&&J.reconnectUrl&&(K=J.reconnectUrl),G=J?W({},J,{serviceUrl:void 0,reconnectUrl:void 0}):null,K=this.appendCorrelationIds(K,!1),K=this.appendEndpointId(K,!1),G&&(K+="&"+this.buildQuery(G),G.v||(K+="&v=v4"));var Y=new Request(K,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":F,"Content-Type":"text/plain"})});this.logger.info("sendAllocateRequest: POST "+K),this.connectionTracker.trackStart("allocation");var $=Date.now(),X=-1;Q.fetchWithTimeout(Y,this.timeoutOptions.fetchTimeoutMs).then((function(F){if(X=F.status,!F.ok)throw new Error(F.statusText);var G=F.headers.get("content-type");if(!G||"application/json"!==G&&"application/json;"!==G.substring(0,17))throw new Error("Content-type '"+G+"' is unexpected");return B.connectionTracker.trackEnd("allocation"),F.json()})).then((function(F){B.allocationErrorsInRow=0,B.unauthorizedErrorCount=0,B.onAllocationResponse(F,z)})).catch((function(F){B.allocationErrorsInRow++;var G=F+", status code "+X;if(B.logger.error(B.allocationErrorsInRow+" failed allocation attempt(s) in a row. Error: "+G),B.connectionTracker.trackError("allocation",G),401===X&&B.unauthorizedErrorCount++,!B.canRetryTokenFetchRequest(B.unauthorizedErrorCount))return B.connectionTracker.trackError("allocation","getToken retry limit hit, reached terminal error state"),void B.fsm.onTerminalError();if(-1!==X||B.isNavigatorOnline){if(B.reconnectParams&&B.allocationErrorsInRow>=3)if(X>=400&&X<=599)B.logger.warn(B.allocationErrorsInRow+" connection attempts, server-side failure: erasing cached connection parameters"),B.reconnectParams=void 0;else if(B.reconnectParams.reconnectUrl&&B.allocationErrorsInRow%3==0){B.logger.warn(B.allocationErrorsInRow+" connection attempts, testing nominal service URL");var W=Math.min(B.timeoutOptions.connectionTimeoutMs-(Date.now()-$)-500,B.timeoutOptions.fetchTimeoutMs);return void B.testNominalUrlConnectivity(W).then((function(F){B.connectionTracker.trackProgress("nomcheck",F?"ok":"failed"),F?(B.logger.warn("Nominal service URL is reachable, erasing cached reconnect URL"),B.reconnectParams&&delete B.reconnectParams.reconnectUrl):B.logger.warn("Nominal service URL is not reachable either, keeping cached reconnect URL"),B.fsm.onAllocationFailed(!1)}),(function(F){B.fsm.onAllocationFailed(!1)}))}}else B.logger.info("Expected failure, the browser says it is not online at the moment");B.fsm.onAllocationFailed(401===X)}))},t.prototype.testNominalUrlConnectivity=function(F){var B,G=this;if(F<1e3)return this.logger.warn("There is no time left to reasonably perform the nominal service URL connectivity check ("+F+" ms), falling back to assuming that the connectivity is fine"),J.Promise.resolve(!0);try{var W=new URL(this.options.trouterUrl);W.pathname="/",W.search="?"+this.buildQuery({check:Date.now(),cor_id:encodeURIComponent(this.options.clientCorrelationID),epid:encodeURIComponent(this.options.endpointId?this.options.endpointId:""),tc:encodeURIComponent(Q.toJson(this.clientInfo))}),B=new Request(W.toString(),{method:"GET",headers:{Accept:"text/plain"}})}catch(F){return this.logger.warn("Nominal service URL connectivity test request could not be created ("+F+"), falling back to assuming that the connectivity is fine"),J.Promise.resolve(!0)}return Q.fetchWithTimeout(B,F).then((function(F){if(200!==F.status)throw new Error("Not 200 OK: "+F.status+" "+F.statusText);return F.text()})).then((function(F){if("Trouter"!==F)throw new Error('Not "Trouter": '+F.substring(0,16)+(F.length>16?"...":""));return!0})).catch((function(F){return G.logger.error("Nominal service URL connectivity test failed: "+F),!1}))},t.prototype.sendPingRequest=function(){var F=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event");var B=!1;this.socket.emit("ping",(function(){!0!==B&&F.onPingResponse()})),this.pingResponseTimerId=setTimeout((function(){F.logger.error("Ping response timeout is fired"),B=!0,F.clearPingResponseTimer(),F.fsm.onPingResponseTimeout()}),this.timeoutOptions.pongTimeoutMs)}catch(F){var G=Q.toJson(F.stack);this.logger.error("unable to send ping. Error: "+G),this.connectionTracker.trackError("ping",G,!1)}},t.prototype.setUserActivityState=function(F){var B=F.state!==this.userActivityState.state;this.userActivityState=F,this.fsm.onSetUserActivityState(F,B)},t.prototype.sendUserActivityState=function(F,B){this.userActivityState.state!==Z.UserActivityState.Unknown&&("websocket"===this.transportTypeName&&B?F===ee.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):"xhr-polling"===this.transportTypeName&&F===ee.UserActivityEventReason.Modified&&this.fsm.forceReconnect("user activity/force reconnect"))},t.prototype.sendRegisterRequest=function(){var F=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var B=new Q.Timespan;this.connectionTracker.trackStart("registration");var G=this.getRegistrationTtl(),W=G[0],z=G[1];this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:W}]}).then((function(){F.logger.info("Register request successful"),F.connectionTracker.trackEnd("registration"),F.fsm.onRegistrationSucceed(z),F.connectionTracker.sendTelemetry(Y.ClientEventName.Registration,{duration:B.duration},[])})).catch((function(G){F.logger.error("Register request failed. Error: "+G),F.connectionTracker.trackError("registration",G.message),F.fsm.onRegistrationFailed(!1),F.connectionTracker.sendTelemetry(Y.ClientEventName.Registration,{duration:B.duration},[])}))},t.prototype.sendUnregisterRequest=function(){var F=this;this.logger.info("sending unregister request");var B=new Q.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then((function(){F.logger.info("Unregister request successful"),F.connectionTracker.trackEnd("unregistration"),F.fsm.onUnregistrationSucceed(),F.connectionTracker.sendTelemetry(Y.ClientEventName.Unregistration,{duration:B.duration},[])})).catch((function(G){F.logger.error("Unregister request failed. Error: "+G),F.connectionTracker.trackError("unregistration",G.message),F.fsm.onUnregistrationFailed(!1),F.connectionTracker.sendTelemetry(Y.ClientEventName.Unregistration,{duration:B.duration},[])}))},t.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},t.prototype.resetRegisterBackoff=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},t.prototype.clearTimers=function(){this.logger.debug("Clearing all pending downstream events related timers");for(var F=0,B=Object.keys(this.pendingTimers);F<B.length;F++){var G=B[F];this.clearTimer(Number(G))}},t.prototype.restartIncallModeTimer=function(){var F=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout((function(){F.logger.info("Call mode timer fired"),F.fsm.onIncallModeTimer()}),this.options.incallModeTimeoutMs)},t.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},t.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},t.prototype.isIncallMode=function(){return this.inIncallMode},t.prototype.sendDisconnectTelemetryEvent=function(F){var B={reason:F,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(B),this.connectionTracker.clearConnectedInfo()},t.prototype.onSocketConnecting=function(F){this.logger.info("onSocketConnecting("+F+")"),this.transportTypeName=F,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},t.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},t.prototype.onSocketConnectFailed=function(F){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",F,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},t.prototype.onSocketDisconnect=function(F){this.logger.error("onSocketDisconnect, reason: "+F);var B=this.connectionTracker.getSessionLength()||0;"dup"===F&&"dup"===this.lastDisconnectReason&&B<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row after "+B+" ms which is below the threshold of "+this.options.duplicateDisconnectThresholdMs+" ms. Resetting cached connection parameters and making a new allocation."),this.reconnectParams=void 0),this.lastDisconnectReason=F,this.fsm.onSocketDisconnect(F),this.connectionExpireTimestampInSecs=void 0},t.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},t.prototype.onSocketReconnectFailed=function(F){this.logger.error("onSocketReconnectFailed with '"+F+"'"),this.fsm.onSocketDisconnect("string"==typeof F?F:void 0)},t.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},t.prototype.onSocketError=function(F){this.logger.error("onSocketError with '"+Q.toJson(F)+"'"),this.connectionTracker.trackError("connectSocket",F),this.fsm.onSocketDisconnect("string"==typeof F?F:void 0)},t.prototype.onSocketMessage=function(F){var B,G=this;this.logger.info("onSocketMessage");try{var W=(B=new se(F)).headers&&B.headers["X-Microsoft-Skype-Chain-ID"],z=W?" Chain-Id "+W:"";this.logger.info("Received request N "+B.id+z+" CV "+B.correlationVector+" to '"+B.url+"'"),B.startTS=Date.now(),B.url&&this.urlPath&&0===B.url.indexOf(this.urlPath)&&(B.shortUrl=B.url.substring(this.urlPath.length))}catch(F){var K=Q.toJson(F.stack);return this.logger.error("unable to parse request. Error: "+K),this.connectionTracker.trackRequest(void 0,K),void this.connectionTracker.sendResponseError("unable to parse request, error: "+F)}B.timeoutTimerId=setTimeout((function(){if(!B.replied){G.logger.error("Request "+B.id+" timed out");var F=new Y.ResponseData(B.id);F.status=504,F.headers={"Trouter-Responder":"ClientLib"},G.sendResponse(B,F),B.timedout=!0}}),this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(B),this.fsm.onDownstreamRequest(B)}catch(F){this.logger.error("exception in socket.on message. Error: "+Q.toJson(F.stack)),this.connectionTracker.sendResponseError(F.message,B,void 0)}},t.prototype.onTrouterConnected=function(F){if(this.allocateResult){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var B=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=Q.calculateExpireTsInSec(F.ttl),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(B,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set")},t.prototype.onTrouterReconnect=function(F){var B=F.target;this.logger.info("onTrouterReconnect target: "+B),"self"===B?this.fsm.onReconnectRequired(!0,z.ServerInitiated):this.fsm.onReconnectRequired(!1,z.ServerInitiated)},t.prototype.onTrouterMessageLoss=function(F){this.logger.info("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(F.droppedIndicators)},t.prototype.onNavigatorOnlineStatusUpdate=function(F){var B=window.navigator.onLine;this.logger.debug("Browser online status update - new state: "+B+", previously: "+this.isNavigatorOnline),B&&!this.isNavigatorOnline?(this.isNavigatorOnline=!0,this.tokenBackoff.expediteIfPending(),this.connectionTracker.trackProgress("browserNet","online")):!B&&this.isNavigatorOnline&&(this.isNavigatorOnline=!1,this.connectionTracker.trackProgress("browserNet","offline"))},t.prototype.onAllocationResponse=function(F,B){this.logger.info("Received allocation response "+JSON.stringify(F)),this.allocateResult=F,this.reconnectParams=W({serviceUrl:B,reconnectUrl:this.allocateResult.socketio+"v4/a"},F.connectparams);var G=+F.ttl;if(this.connectionExpireTimestampInSecs=Q.calculateExpireTsInSec(G),this.connectionId=this.allocateResult.id||"",this.connectedClientId=this.allocateResult.ccid,this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}"),this.c2cUrlBase=F.curlb||"",""===this.c2cUrlBase){var z=F.surl.indexOf("://");z>=0&&(z=F.surl.indexOf("/",z+3))>=5&&":3443"===F.surl.substr(z-5,5)&&(this.c2cUrlBase=F.surl.substr(0,z-5))}this.manager.onConnectionParametersUpdated(this.reconnectParams),this.fsm.onAllocationSucceed()},t.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},t.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},t.prototype.buildQuery=function(F){for(var B=[],G=0,W=Object.keys(F);G<W.length;G++){var z=W[G];F.hasOwnProperty(z)&&void 0!==F[z]&&B.push(z+"="+F[z])}return B.join("&")},t.prototype.appendConnectedClientIds=function(F,B){var G="";F.indexOf("ccid=")<0&&(G="ccid="+this.connectedClientId+"&"),this.domId&&(G+="dom="+this.domId+"&"),G.length>0&&(G=G.slice(0,-1));var W=B||-1!==F.indexOf("?")?"&":"?";return this.appendCorrelationIds(F+W+G,B)},t.prototype.appendEndpointId=function(F,B){var G=B||-1!==F.indexOf("?")?"&":"?";return F.indexOf("epid")<0&&this.options.endpointId?""+F+G+"epid="+this.options.endpointId:F},t.prototype.appendCorrelationIds=function(F,B){var G=B||-1!==F.indexOf("?")?"&":"?";return F.indexOf("cor_id")<0?""+F+G+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:F},t.prototype.safeString=function(F){return"string"==typeof F?F:""},t.prototype.sendResponse=function(F,B){if(F.timedout)return this.logger.error("Request "+F.id+" already timed out"),1;if(F.replied)return this.logger.error("Response for request "+F.id+" already sent"),2;clearTimeout(F.timeoutTimerId),F.timeoutTimerId=0,F.replied=!0,B.headers=B.headers||{};var G=F.correlationVector;this.logger.info("Sending response for request N "+F.id+" CV "+G+" with status "+B.status),G&&(B.headers[ae]=G),F.headers&&F.headers["trouter-request"]&&!B.headers["trouter-request"]&&(B.headers["trouter-request"]=F.headers["trouter-request"]);var W=Date.now()-F.startTS;if(B.headers["trouter-client"]=Q.toJson({cd:W}),this.logger.debug("response: "+Q.toJson(B)),!this.socket)return this.connectionTracker.sendResponseError("no socket",F,B),4;try{return this.socket.send(Q.toJson(B)),B.sentTS=Date.now(),F.incrementCorrelationVector(),this.connectionTracker.trackResponse(F,W,B),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(G){var z="unable to send data on response.end. Error: "+Q.toJson(G.stack);return this.logger.error(z),this.connectionTracker.sendResponseError(z,F,B),4}},t.prototype.sendUserActivityStateMultiple=function(F){var B=this,G=new le("user.activity"),W=this.userActivityState.toEventObject();G.args=W,this.userActivityState.correlationVector.increase(),this.logger.debug("Sending user activity '"+this.userActivityState.toEventJSON()+"', remaining "+(F-1));var z=!1;this.sendDownstreamEvent(G,(function(){if(!0!==z&&(B.logger.info("User activity state: "+W.state+", cv: "+W.cv+" accepted"),B.manager.onUserActivityStateAccepted&&B.manager.onUserActivityStateAccepted(W.cv),B.clearTimer(G.timeoutTimerId),F>1)){var K=setTimeout((function(){B.clearTimer(K),B.sendUserActivityStateMultiple(F-1)}),B.options.userActivitySecondResendDelayMs);B.registerTimer(K,"user.activity/resend")}})),G.timeoutTimerId=setTimeout((function(){B.logger.error("Activity state response timeout is fired"),z=!0,B.fsm.onActivityStateResponseTimeout(),B.clearTimer(G.timeoutTimerId)}),this.timeoutOptions.userActivityResponseTimeoutMs),this.registerTimer(G.timeoutTimerId,"user.activity/response")},t.prototype.sendDownstreamEvent=function(F,B){this.logger.info("Sending downstream event "+F.name),this.socket&&this.socket.emit(F.name,F.args,B)},t.prototype.registerTimer=function(F,B){this.logger.debug("registering timer "+F+" -> "+B),this.pendingTimers[F]=B},t.prototype.clearTimer=function(F){var B=this.pendingTimers[F];this.logger.debug("clearing timer "+F+" -> "+B),delete this.pendingTimers[F],clearTimeout(F)},t.prototype.getRegistrationTtl=function(){var F=Q.calculateTtlInSec(this.connectionExpireTimestampInSecs);if(this.logger.debug("Current connectionID will expire in "+F+" seconds"),this.options.registration&&this.options.registration.registrarTtlSec&&F>0){var B=this.options.registration.registrarTtlSec<F;return[Math.min(this.options.registration.registrarTtlSec,F),B]}return this.options.registration&&this.options.registration.registrarTtlSec?[this.options.registration.registrarTtlSec,!1]:F>0?[F,!1]:[3600,!1]},t.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},t.prototype.applyConnectionTrackerOptions=function(F){try{F.eventLogger&&"function"==typeof F.eventLogger.logEvent?(this.connectionTracker.mergeSettings(F.telemetrySettings),this.connectionTracker.enable(F.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(F){this.logger.warn("Trouter client event logging disabled. Error: "+Q.toJson(F.stack)),this.connectionTracker.disable()}},t.prototype.canRetryTokenFetchRequest=function(F){var B=this.options.retryLimitOnTokenFetch;return null==B||F<B||(this.logger.warn("Reached limit on maximum number of token fetch request. Current count: "+F+", retry limit: "+B),!1)},t}();B.TrouterConnection=de},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(1),z=function(){function t(F){this.logger=F,this.messageHandlers=[]}return t.prototype.register=function(F){if(this.messageHandlers.some((function(B){return B===F})))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(F)},t.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},t.prototype.active=function(){return this.messageHandlers.length>0},t.prototype.handleMessage=function(F){for(var B={resultCode:W.UNHANDLED_MESSAGE_ACK,isHandled:!1},G=0,z=this.messageHandlers;G<z.length;G++){var K=z[G],J=this.safeExecuteHandle(K,F);if(void 0!==J&&(void 0===J.isHandled||J.isHandled))return void 0===J.resultCode&&(J.resultCode=W.HANDLED_MESSAGE_ACK),J}return B},t.prototype.safeExecuteHandle=function(F,B){try{return F.handleMessage(B)}catch(F){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+F)}},t}();B.MessageHandlerRegistry=z},function(F,B,G){function o(F){var B,G=this;return function(K){return W(G,void 0,void 0,(function(){return z(this,(function(G){return K&&(B=void 0),[2,new Promise((function(G,W){F(K).then((function(F){B=F,G(F)})).catch((function(F){void 0!==B&&B.length>0&&G(B),W(F)}))}))]}))}))}}var W=this&&this.__awaiter||function(F,B,G,W){return new(G||(G=Promise))((function(z,K){function s(F){try{a(W.next(F))}catch(F){K(F)}}function c(F){try{a(W.throw(F))}catch(F){K(F)}}function a(F){F.done?z(F.value):new G((function(B){B(F.value)})).then(s,c)}a((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){function n(F){return function(B){return o([F,B])}}function o(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=(z=J.trys).length>0&&z[z.length-1])&&(6===K[0]||2===K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K};Object.defineProperty(B,"__esModule",{value:!0}),B.addCacheAsBackupTo=o},function(F,B,G){var W=this&&this.__awaiter||function(F,B,G,W){return new(G||(G=Promise))((function(z,K){function s(F){try{a(W.next(F))}catch(F){K(F)}}function c(F){try{a(W.throw(F))}catch(F){K(F)}}function a(F){F.done?z(F.value):new G((function(B){B(F.value)})).then(s,c)}a((W=W.apply(F,B||[])).next())}))},z=this&&this.__generator||function(F,B){function n(F){return function(B){return o([F,B])}}function o(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=(z=J.trys).length>0&&z[z.length-1])&&(6===K[0]||2===K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K};Object.defineProperty(B,"__esModule",{value:!0});var K=G(3),J=G(2),Q=G(0),Y=G(6),$=G(18),X=function(){function t(F,B){this.state=F,this.correlationVector=void 0!==B?B:K.CorrelationVector.extend()}return t.prototype.getStateString=function(){switch(this.state){case J.UserActivityState.Active:return"active";case J.UserActivityState.Inactive:return"inactive";case J.UserActivityState.Unknown:return"unknown";default:return"undefined"}},t.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},t.prototype.toEventJSON=function(){return K.toJson(this.toEventObject())},t}();B.UserActivityObject=X;var Z=function(){function t(F,B,G,W){this.logFunc=F,this.options=B,this.tokenProvider=G,this.listener=W,this.logger=new Q.Logger("Manager",F),this.logger.info("Created TrouterManager with options "+K.toJson(this.options)),this.fsm=new $.TrouterManagerFsm(F,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new X(J.UserActivityState.Unknown)}return t.prototype.start=function(){this.fsm.start()},t.prototype.stop=function(F){this.fsm.stop(F)},t.prototype.configure=function(F){this.options=F,void 0!==this.firstConnection&&this.firstConnection.configure(F),void 0!==this.secondConnection&&this.secondConnection.configure(F),this.logger.info("Reconfigured TrouterManager with options "+K.toJson(this.options))},t.prototype.checkConnection=function(F){void 0!==this.firstConnection&&this.firstConnection.checkConnection(F),void 0!==this.secondConnection&&this.secondConnection.checkConnection(F)},t.prototype.resendRegistration=function(){return W(this,void 0,void 0,(function(){return z(this,(function(F){return void 0!==this.secondConnection?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])}))}))},t.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},t.prototype.getState=function(){return this.fsm.getState()},t.prototype.startFirstConnection=function(){var F=new Y.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject);this.firstConnection=F,this.getConnectionCache().then((function(B){F.start(B)})).catch()},t.prototype.startSecondConnection=function(F){var B=new Y.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject);this.secondConnection=B,void 0!==this.firstConnection&&this.firstConnection.disableRegistrationsAndAutoReconnect(),F?this.getConnectionCache().then((function(F){B.start(F)})).catch():B.start()},t.prototype.stopFirstConnection=function(F){void 0!==this.firstConnection&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(F),this.firstConnection=void 0)},t.prototype.stopSecondConnection=function(F){void 0!==this.secondConnection&&(this.secondConnection.stop(F),this.secondConnection=void 0)},t.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var F=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in "+Math.round(this.options.lingeringConnectionDelayMs/1e3)+"s"),setTimeout((function(){F.stop(!0)}),this.options.lingeringConnectionDelayMs)}},t.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},t.prototype.switchConnections=function(){var F=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=F},t.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},t.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var F=this.firstConnection.getServerState(),B="/"===F.url.slice(-1)?F.url.slice(0,-1):F.url,G={baseEndpointUrl:B,newEndpointUrl:B!==this.baseEndpointUrl,c2cUrlBase:F.c2cUrlBase,clientId:F.connectedClientId,connectionId:F.connectionId,connectionTtlSec:F.getRemainingTtlInSec()};this.baseEndpointUrl=B,this.listener.onTrouterConnected(F.url,G)}},t.prototype.dispatchReconnecting=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},t.prototype.dispatchStopped=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},t.prototype.dispatchRegistrationState=function(F){this.options.registrationStateCallback&&this.options.registrationStateCallback(F)},t.prototype.onDownstreamRequest=function(F,B,G){var W={id:B.id,method:B.method,path:"/"+B.shortUrl,body:B.body,headers:B.headers},z={id:B.id,status:0,headers:{},body:"",send:function(){return z.status<=100||z.status>=999?3:(G.writeHead(z.status,z.headers),G.end(z.body))}};this.listener.onTrouterRequest(W,z)},t.prototype.onConnected=function(F){this.fsm.onConnected(F===this.firstConnection)},t.prototype.onRegistered=function(F){this.fsm.onRegistered(F===this.firstConnection)},t.prototype.onUnregistered=function(F){this.fsm.onUnregistered(F===this.firstConnection||F===this.storedFirstConnection)},t.prototype.onReconnecting=function(F){this.fsm.onReconnecting(F===this.firstConnection)},t.prototype.onReconnectIsRequired=function(F,B,G){this.fsm.onReconnectionRequired(F===this.firstConnection,B,G)},t.prototype.onDisconnected=function(F){this.fsm.onDisconnected(F===this.storedFirstConnection),this.storedFirstConnection=void 0},t.prototype.onUserActivityStateAccepted=function(F){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(F)},t.prototype.onConnectionParametersUpdated=function(F){this.setConnectionCache(F)},t.prototype.setUserActivityState=function(F,B){return this.userActivityObject=new X(F,K.CorrelationVector.extend(B)),void 0!==this.secondConnection?(this.logger.info("Setting user activity "+this.userActivityObject.toEventJSON()+" on the second/new connection"),void this.secondConnection.setUserActivityState(this.userActivityObject)):void 0!==this.firstConnection?(this.logger.info("Setting user activity "+this.userActivityObject.toEventJSON()+" on the first/current connection"),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},t.prototype.onTrouterMessageLost=function(F){var B=this;if(this.listener.onTrouterMessageLoss)if(F&&F.length){var G=F.filter((function(F){return void 0!==B.processedMessageLoss[F.tag+"-"+F.etag]}));if(G.length&&(this.logger.warn("onTrouterMessageLoss - removing duplicates and sending event to server"),this.sendProcessedDroppedIndicators(G),!(F=F.filter((function(F){return void 0===B.processedMessageLoss[F.tag+"-"+F.etag]}))).length))return void this.logger.warn("onTrouterMessageLoss - All the data are duplicated");if(!this.listener.onTrouterMessageLoss(F.map((function(F){return F.tag}))))return void this.logger.warn("onTrouterMessageLoss - flow tags have not been processed by listeners");F.forEach((function(F){B.processedMessageLoss[F.tag+"-"+F.etag]=""})),this.sendProcessedDroppedIndicators(F)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},t.prototype.getConnectionCache=function(){var F=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then((function(F){return F?JSON.parse(F):void 0})).catch((function(B){return F.logger.warn("Invalid connection cache content provided: "+B),F.connectionCache}))):Promise.resolve(this.connectionCache)},t.prototype.setConnectionCache=function(F){if(this.connectionCache=F,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(F))}catch(F){this.logger.warn("Error setting external connection cache: "+F)}},t.prototype.sendProcessedDroppedIndicators=function(F){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(F):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(F):void 0},t}();B.TrouterManager=Z},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function t(F){this.logger=F}return t.prototype.getPromise=function(){var F=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise((function(B,G){F.pendingPromiseResolveRef=B,F.pendingPromiseRejectRef=G}))):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},t.prototype.resolveUrl=function(F){this.url=F,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var B=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==B&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),B(F))},t.prototype.rejectUrl=function(F){this.logger.debug("[TrouterUrlPromise] aborting");var B=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==B&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),B(F))},t.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},t}();B.TrouterUrlPromise=W},function(F,B,G){(function(F,G){!function(F,B){var G=F;G.version="0.9.6",G.protocol=1,G.transports=[],G.j=[],G.sockets={},G.connect=function(F,W){var z,K,J=G.util.parseUri(F);B&&B.location&&(J.protocol=J.protocol||B.location.protocol.slice(0,-1),J.host=J.host||(B.document?B.document.domain:B.location.hostname),J.port=J.port||B.location.port),z=G.util.uniqueUri(J);var Q={host:J.host,secure:"https"==J.protocol,port:J.port||("https"==J.protocol?443:80),query:J.query||""};return G.util.merge(Q,W),!Q["force new connection"]&&G.sockets[z]||(K=new G.Socket(Q)),!Q["force new connection"]&&K&&(G.sockets[z]=K),(K=K||G.sockets[z]).of(J.path.length>1?J.path:"")}}(G.exports,void 0===F?window:F);var W=G.exports;!function(F,B){var G=F.util={},W=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,z=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];G.parseUri=function(F){for(var B=W.exec(F||""),G={},K=14;K--;)G[z[K]]=B[K]||"";return G},G.uniqueUri=function(F){var G=F.protocol,W=F.host,z=F.port;return"document"in B?(W=W||document.domain,z=z||("https"==G&&"https:"!==document.location.protocol?443:document.location.port)):(W=W||"localhost",z||"https"!=G||(z=443)),(G||"http")+"://"+W+":"+(z||80)},G.query=function(F,B){var W=G.chunkQuery(F||""),z=[];for(var K in G.merge(W,G.chunkQuery(B||"")),W)W.hasOwnProperty(K)&&z.push(K+"="+W[K]);return z.length?"?"+z.join("&"):""},G.chunkQuery=function(F){for(var B,G={},W=F.split("&"),z=0,K=W.length;z<K;++z)(B=W[z].split("="))[0]&&(G[B[0]]=B[1]);return G};var K=!1;G.load=function(F){if("document"in B&&"complete"===document.readyState||K)return F();G.on(B,"load",F,!1)},G.on=function(F,B,G,W){F.attachEvent?F.attachEvent("on"+B,G):F.addEventListener&&F.addEventListener(B,G,W)},G.request=function(F){if(F&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!F||G.ua.hasCORS))return new XMLHttpRequest;if(!F)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(F){}return null},"undefined"!=typeof window&&G.load((function(){K=!0})),G.defer=function(F){if(!G.ua.webkit||"undefined"!=typeof importScripts)return F();G.load((function(){setTimeout(F,100)}))},G.merge=function(F,B,W,z){var K,J=z||[],Q=void 0===W?2:W;for(K in B)B.hasOwnProperty(K)&&G.indexOf(J,K)<0&&("object"==typeof F[K]&&Q?G.merge(F[K],B[K],Q-1,J):(F[K]=B[K],J.push(B[K])));return F},G.mixin=function(F,B){G.merge(F.prototype,B.prototype)},G.inherit=function(F,B){function n(){}n.prototype=B.prototype,F.prototype=new n},G.isArray=Array.isArray||function(F){return"[object Array]"===Object.prototype.toString.call(F)},G.intersect=function(F,B){for(var W=[],z=F.length>B.length?F:B,K=F.length>B.length?B:F,J=0,Q=K.length;J<Q;J++)~G.indexOf(z,K[J])&&W.push(K[J]);return W},G.indexOf=function(F,B,G){var W=F.length;for(G=G<0?G+W<0?0:G+W:G||0;G<W&&F[G]!==B;G++);return W<=G?-1:G},G.toArray=function(F){for(var B=[],G=0,W=F.length;G<W;G++)B.push(F[G]);return B},G.ua={},G.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var F=new XMLHttpRequest}catch(F){return!1}return null!=F.withCredentials}(),G.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==W?W:G.exports,void 0===F?window:F),function(F,B){function n(){}F.EventEmitter=n,n.prototype.on=function(F,G){return this.$events||(this.$events={}),this.$events[F]?B.util.isArray(this.$events[F])?this.$events[F].push(G):this.$events[F]=[this.$events[F],G]:this.$events[F]=G,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(F,B){function n(){G.removeListener(F,n),B.apply(this,arguments)}var G=this;return n.listener=B,this.on(F,n),this},n.prototype.removeListener=function(F,G){if(this.$events&&this.$events[F]){var W=this.$events[F];if(B.util.isArray(W)){for(var z=-1,K=0,J=W.length;K<J;K++)if(W[K]===G||W[K].listener&&W[K].listener===G){z=K;break}if(z<0)return this;W.splice(z,1),W.length||delete this.$events[F]}else(W===G||W.listener&&W.listener===G)&&delete this.$events[F]}return this},n.prototype.removeAllListeners=function(F){return this.$events&&this.$events[F]&&(this.$events[F]=null),this},n.prototype.listeners=function(F){return this.$events||(this.$events={}),this.$events[F]||(this.$events[F]=[]),B.util.isArray(this.$events[F])||(this.$events[F]=[this.$events[F]]),this.$events[F]},n.prototype.emit=function(F){if(!this.$events)return!1;var G=this.$events[F];if(!G)return!1;var W=Array.prototype.slice.call(arguments,1);if("function"==typeof G)G.apply(this,W);else{if(!B.util.isArray(G))return!1;for(var z=G.slice(),K=0,J=z.length;K<J;K++)z[K].apply(this,W)}return!0}}(void 0!==W?W:G.exports,void 0!==W?W:G.parent.exports),function(F,B){if(B&&B.parse)return F.JSON={parse:B.parse,stringify:B.stringify};throw new Error("JSON not available")}(void 0!==W?W:G.exports,"undefined"!=typeof JSON?JSON:void 0),function(F,B){var G=F.parser={},W=G.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],z=G.reasons=["transport not supported","client not handshaken","unauthorized"],K=G.advice=["reconnect"],J=B.JSON,Q=B.util.indexOf;G.encodePacket=function(F){var B=Q(W,F.type),G=F.id||"",Y=F.endpoint||"",$=F.ack,X=null;switch(F.type){case"error":var Z=F.reason?Q(z,F.reason):"",ee=F.advice?Q(K,F.advice):"";""===Z&&""===ee||(X=Z+(""!==ee?"+"+ee:""));break;case"message":""!==F.data&&(X=F.data);break;case"event":var te={name:F.name};F.args&&F.args.length&&(te.args=F.args),X=J.stringify(te);break;case"json":X=J.stringify(F.data);break;case"connect":F.qs&&(X=F.qs);break;case"ack":X=F.ackId+(F.args&&F.args.length?"+"+J.stringify(F.args):"")}var ne=[B,G+("data"==$?"+":""),Y];return null!=X&&ne.push(X),ne.join(":")},G.encodePayload=function(F){var B="";if(1==F.length)return F[0];for(var G=0,W=F.length;G<W;G++)B+="�"+F[G].length+"�"+F[G];return B};var Y=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;G.decodePacket=function(F){if(!(Q=F.match(Y)))return{};var B=Q[2]||"",G=(F=Q[5]||"",{type:W[Q[1]],endpoint:Q[4]||""});switch(B&&(G.id=B,Q[3]?G.ack="data":G.ack=!0),G.type){case"error":var Q=F.split("+");G.reason=z[Q[0]]||"",G.advice=K[Q[1]]||"";break;case"message":G.data=F||"";break;case"event":try{var $=J.parse(F);G.name=$.name,G.args=$.args}catch(F){}G.args=G.args||[];break;case"json":try{G.data=J.parse(F)}catch(F){}break;case"connect":G.qs=F||"";break;case"ack":if((Q=F.match(/^([0-9]+)(\+)?(.*)/))&&(G.ackId=Q[1],G.args=[],Q[3]))try{G.args=Q[3]?J.parse(Q[3]):[]}catch(F){}break;case"disconnect":G.reason=F}return G},G.decodePayload=function(F){if("�"==F.charAt(0)){for(var B=[],W=1,z="";W<F.length;W++)"�"==F.charAt(W)?(B.push(G.decodePacket(F.substr(W+1).substr(0,z))),W+=Number(z)+1,z=""):z+=F.charAt(W);return B}return[G.decodePacket(F)]}}(void 0!==W?W:G.exports,void 0!==W?W:G.parent.exports),function(F,B){function n(F,B){this.socket=F,this.sessid=B,this.connectErrorCallback=void 0,this.isOpened=!1}F.Transport=n,B.util.mixin(n,B.EventEmitter),n.prototype.onData=function(F){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==F){var G=B.parser.decodePayload(F);if(G&&G.length)for(var W=0,z=G.length;W<z;W++)this.onPacket(G[W])}return this},n.prototype.onPacket=function(F){return this.socket.setHeartbeatTimeout(),"heartbeat"==F.type?this.onHeartbeat():("connect"==F.type&&""==F.endpoint&&this.onConnect(),"error"==F.type&&"reconnect"==F.advice&&(this.isOpened=!1),this.socket.onPacket(F),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var F=this;this.closeTimeout=setTimeout((function(){F.onDisconnect()}),this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(F){this.send(B.parser.encodePacket(F))},n.prototype.onHeartbeat=function(F){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var F=this.socket.options;return this.scheme()+"://"+F.host+":"+F.port+"/"+F.resource+"/"+B.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(F,B){B.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==W?W:G.exports,void 0!==W?W:G.parent.exports),function(F,B,G){function o(F){if(this.options={port:80,secure:!1,document:"document"in G&&document,resource:"socket.io",transports:B.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},B.util.merge(this.options,F),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||B.util.ua.hasCORS)){var W=this;B.util.on(G,"unload",(function(){W.disconnectSync()}),!1)}this.options["auto connect"]&&this.connect()}function i(){}F.Socket=o,B.util.mixin(o,B.EventEmitter),o.prototype.of=function(F){return this.namespaces[F]||(this.namespaces[F]=new B.SocketNamespace(this,F),""!==F&&this.namespaces[F].packet({type:"connect"})),this.namespaces[F]},o.prototype.publish=function(){var F;for(var B in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(B)&&(F=this.of(B)).$emit.apply(F,arguments)},o.prototype.handshake=function(F){function n(B){B instanceof Error?G.onError(B.message):F.apply(null,B.split(":"))}var G=this,W=this.options;if(!G.disconnected){var z=["http"+(W.secure?"s":"")+":/",W.host+":"+W.port,W.resource,B.protocol,B.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!B.util.ua.hasCORS){var K=document.getElementsByTagName("script")[0],J=document.createElement("script");J.src=z+"&jsonp="+B.j.length,K.parentNode.insertBefore(J,K),B.j.push((function(F){n(F),J.parentNode.removeChild(J)}))}else{var Q=B.util.request();Q.open("GET",z,!0),Q.onreadystatechange=function(){4==Q.readyState&&(Q.onreadystatechange=i,200==Q.status?n(Q.responseText):!G.reconnecting&&G.onError(Q.responseText))},Q.send(null)}}},o.prototype.getTransport=function(F){for(var G,W=F||this.transports,z=0;G=W[z];z++)if(B.Transport[G]&&B.Transport[G].check(this)&&(!this.isXDomain()||B.Transport[G].xdomainCheck()))return new B.Transport[G](this,this.sessionid);return null},o.prototype.connect=function(F){if(this.connecting||this.disconnected)return this;var G=this;return this.handshake((function(W,z,K,J){function c(){if(!G.connected&&!G.disconnected)if(G.connecting=!1,clearTimeout(G.connectTimeoutTimer),G.options["try multiple transports"]){for(;G.remainingTransports.length>0&&G.remainingTransports.splice(0,1)[0]!=G.transport.name;);G.remainingTransports.length?a(G.remainingTransports):G.publish("connect_failed")}else G.publish("connect_failed")}function a(F){if(G.transport&&(G.transport.clearTimeouts(),G.transport.clearEventHandlers()),G.transport=G.getTransport(F),!G.transport||G.disconnected)return G.publish("connect_failed");G.transport.ready(G,(function(){G.connecting=!0,G.publish("connecting",G.transport.name),G.transport.open(c),G.options["connect timeout"]&&(G.connectTimeoutTimer=setTimeout((function(){c()}),G.options["connect timeout"]))}))}G.sessionid=W,G.closeTimeout=1e3*K+2e3,G.heartbeatTimeout=1e3*z+2e3,G.transports=J?B.util.intersect(J.split(","),G.options.transports):G.options.transports,G.setHeartbeatTimeout(),G.remainingTransports=G.transports.slice(0),a(G.transports),G.once("connect",(function(){clearTimeout(G.connectTimeoutTimer),F&&"function"==typeof F&&F()}))})),this},o.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var F=this;this.heartbeatTimeoutTimer=setTimeout((function(){F.transport.onClose()}),this.heartbeatTimeout)},o.prototype.packet=function(F){return this.connected&&!this.doBuffer?this.transport.packet(F):this.buffer.push(F),this},o.prototype.setBuffer=function(F){this.doBuffer=F,!F&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},o.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},o.prototype.disconnectSync=function(){var F=B.util.request(),G=this.resource+"/"+B.protocol+"/"+this.sessionid;F.open("GET",G,!0),this.onDisconnect("booted")},o.prototype.isXDomain=function(){var F=G.location.port||("https:"==G.location.protocol?443:80);return this.options.host!==G.location.hostname||this.options.port!=F},o.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},o.prototype.onOpen=function(){this.open=!0},o.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},o.prototype.onPacket=function(F){this.of(F.endpoint).onPacket(F)},o.prototype.onError=function(F){F&&F.advice&&"reconnect"===F.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",F&&F.reason?F.reason:F)},o.prototype.onDisconnect=function(F){var B=this.connected,G=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(B||G)&&(this.transport.close(),this.transport.clearTimeouts(),B&&(this.publish("disconnect",F),"booted"!=F&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},o.prototype.reconnect=function(){function t(){if(F.connected){for(var B in F.namespaces)F.namespaces.hasOwnProperty(B)&&""!==B&&F.namespaces[B].packet({type:"connect"});F.publish("reconnect",F.transport.name,F.reconnectionAttempts)}clearTimeout(F.reconnectionTimer),F.removeListener("connect_failed",e),F.removeListener("connect",e),F.reconnecting=!1,delete F.reconnectionAttempts,delete F.reconnectionDelay,delete F.reconnectionTimer,delete F.redoTransports,F.options["try multiple transports"]=G}function e(){if(F.reconnecting)return F.connected?t():F.connecting&&F.reconnecting?F.reconnectionTimer=setTimeout(e,1e3):void(F.reconnectionAttempts++>=B?F.redoTransports?(F.publish("reconnect_failed"),t()):(F.on("connect_failed",e),F.options["try multiple transports"]=!0,F.transport=F.getTransport(),F.redoTransports=!0,F.connect()):(F.reconnectionDelay<W&&(F.reconnectionDelay*=2),F.connect(),F.publish("reconnecting",F.reconnectionDelay,F.reconnectionAttempts),F.reconnectionTimer=setTimeout(e,F.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var F=this,B=this.options["max reconnection attempts"],G=this.options["try multiple transports"],W=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)}}(void 0!==W?W:G.exports,void 0!==W?W:G.parent.exports,void 0===F?window:F),function(F,B){function n(F,B){this.socket=F,this.name=B||"",this.flags={},this.json=new o(this,"json"),this.ackPackets=0,this.acks={}}function o(F,B){this.namespace=F,this.name=B}F.SocketNamespace=n,B.util.mixin(n,B.EventEmitter),n.prototype.$emit=B.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(F){return F.endpoint=this.name,this.socket.packet(F),this.flags={},this},n.prototype.send=function(F,B){var G={type:this.flags.json?"json":"message",data:F};return"function"==typeof B&&(G.id=++this.ackPackets,G.ack=!0,this.acks[G.id]=B),this.packet(G)},n.prototype.emit=function(F){var B=Array.prototype.slice.call(arguments,1),G=B[B.length-1],W={type:"event",name:F};return"function"==typeof G&&(W.id=++this.ackPackets,W.ack="data",this.acks[W.id]=G,B=B.slice(0,B.length-1)),W.args=B,this.packet(W)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(F){function n(){G.packet({type:"ack",args:B.util.toArray(arguments),ackId:F.id})}var G=this;switch(F.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(F.reason||"booted"):this.$emit("disconnect",F.reason||"");break;case"message":case"json":var W=["message",F.data];"data"==F.ack?W.push(n):F.ack&&this.packet({type:"ack",ackId:F.id}),this.$emit.apply(this,W);break;case"event":W=[F.name].concat(F.args),"data"==F.ack&&W.push(n),this.$emit.apply(this,W);break;case"ack":this.acks[F.ackId]&&(this.acks[F.ackId].apply(this,F.args),delete this.acks[F.ackId]);break;case"error":F.advice?this.socket.onError(F):"unauthorized"==F.reason?this.$emit("connect_failed",F.reason):this.$emit("error",F.reason)}},o.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},o.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==W?W:G.exports,void 0!==W?W:G.parent.exports),function(F,B,G){function o(F){B.Transport.apply(this,arguments)}function i(){}F.websocket=o,B.util.inherit(o,B.Transport),o.prototype.name="websocket",o.prototype.open=function(F){var W,z=B.util.query(this.socket.options.query),K=this;return this.connectErrorCallback=F,W||(W=G.MozWebSocket||G.WebSocket),this.websocket=new W(this.prepareUrl()+z),this.websocket.onopen=function(){K.onOpen(),K.socket.setBuffer(!1)},this.websocket.onmessage=function(F){K.onData(F.data)},this.websocket.onclose=function(){K.onClose(),K.socket.setBuffer(!0)},this.websocket.onerror=function(F){K.onError(F)},this},o.prototype.send=function(F){return this.websocket.send(F),this},o.prototype.payload=function(F){for(var B=0,G=F.length;B<G;B++)this.packet(F[B]);return this},o.prototype.close=function(){return this.websocket.close(),this},o.prototype.onError=function(F){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(F)},o.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},o.check=function(){return"WebSocket"in G&&!("__addTask"in WebSocket)||"MozWebSocket"in G},o.xdomainCheck=function(){return!0},o.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=i),this},B.transports.push("websocket")}(void 0!==W?W.Transport:G.exports,void 0!==W?W:G.parent.exports,void 0===F?window:F),function(F,B,G){function o(F){F&&(B.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}F.XHR=o,B.util.inherit(o,B.Transport),o.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},o.prototype.payload=function(F){for(var G=[],W=0,z=F.length;W<z;W++)G.push(B.parser.encodePacket(F[W]));this.send(B.parser.encodePayload(G))},o.prototype.send=function(F){return this.post(F),this},o.prototype.post=function(F){function e(){4==this.readyState&&(this.onreadystatechange=i,B.posting=!1,200==this.status?(B.socket.setBuffer(!1),clearTimeout(B.sendXHR.ackTimeoutTimer)):B.onClose())}function o(){this.onload=i,B.socket.setBuffer(!1)}var B=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),G.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=o:this.sendXHR.onreadystatechange=e,this.sendXHR.send(F),B.sendXHR.ackTimeoutTimer=setTimeout((function(){B.onClose()}),B.socket.options.ackTimeoutMs)},o.prototype.close=function(){return this.onClose(),this},o.prototype.request=function(F){var G=B.util.request(this.socket.isXDomain()),W=B.util.query(this.socket.options.query,"t="+ +new Date);if(G.open(F||"GET",this.prepareUrl()+W,!0),"POST"==F)try{G.setRequestHeader?G.setRequestHeader("Content-type","text/plain;charset=UTF-8"):G.contentType="text/plain"}catch(F){}return G},o.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},o.check=function(F,W){try{var z=B.util.request(W),K=G.XDomainRequest&&z instanceof XDomainRequest,J=(F&&F.options&&F.options.secure?"https:":"http:")!=G.location.protocol;if(z&&(!K||!J))return!0}catch(F){}return!1},o.xdomainCheck=function(){return o.check(null,!0)},o.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=i),this}}(void 0!==W?W.Transport:G.exports,void 0!==W?W:G.parent.exports,void 0===F?window:F),function(F,B,G){function o(){B.Transport.XHR.apply(this,arguments)}function i(){}F["xhr-polling"]=o,B.util.inherit(o,B.Transport.XHR),B.util.merge(o,B.Transport.XHR),o.prototype.name="xhr-polling",o.prototype.open=function(F){var G=this;return G.connectErrorCallback=F,B.Transport.XHR.prototype.open.call(G),!1},o.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(F.connectErrorCallback=void 0,F.onData(this.responseText),F.get()):(F.onClose(),void 0!==F.connectErrorCallback&&(F.connectErrorCallback(),F.connectErrorCallback=void 0)))}function e(){F.connectErrorCallback=void 0,this.onload=i,this.onerror=i,F.onData(this.responseText),F.get()}function o(){F.onClose(),void 0!==F.connectErrorCallback&&(F.connectErrorCallback(),F.connectErrorCallback=void 0)}if(this.isOpened){var F=this;this.xhr=this.request(),G.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=o):this.xhr.onreadystatechange=t,this.xhr.send(null)}},o.prototype.onClose=function(){if(B.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(F){}this.xhr=null}},o.prototype.ready=function(F,G){var W=this;B.util.defer((function(){G.call(W)}))},o.prototype.clearEventHandlers=function(){return B.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i),this},B.transports.push("xhr-polling")}(void 0!==W?W.Transport:G.exports,void 0!==W?W:G.parent.exports,void 0===F?window:F),B.io=W}).call(B,G(4),G(14)(F))},function(F,B,G){(function(B,W){
/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(B,G){F.exports=G()}(0,(function(){function t(F){return"function"==typeof F||"object"==typeof F&&null!==F}function i(F){return"function"==typeof F}function r(F){Q=F}function s(F){V=F}function c(){return void 0!==J?function(){J(h)}:a()}function a(){var F=setTimeout;return function(){return F(h,1)}}function h(){for(var F=0;F<K;F+=2)(0,te[F])(te[F+1]),te[F]=void 0,te[F+1]=void 0;K=0}function u(F,B){var G=arguments,W=this,z=new this.constructor(p);void 0===z[ie]&&O(z);var K=W._state;return K?function(){var F=G[K-1];V((function(){return P(K,z,F,W._result)}))}():b(W,z,F,B),z}function l(F){var B=this;if(F&&"object"==typeof F&&F.constructor===B)return F;var G=new B(p);return k(G,F),G}function p(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function f(F){try{return F.then}catch(F){return se.error=F,se}}function v(F,B,G,W){try{F.call(B,G,W)}catch(F){return F}}function m(F,B,G){V((function(F){var W=!1,z=v(G,B,(function(G){W||(W=!0,B!==G?k(F,G):S(F,G))}),(function(B){W||(W=!0,C(F,B))}),"Settle: "+(F._label||" unknown promise"));!W&&z&&(W=!0,C(F,z))}),F)}function y(F,B){B._state===oe?S(F,B._result):B._state===ae?C(F,B._result):b(B,void 0,(function(B){return k(F,B)}),(function(B){return C(F,B)}))}function T(F,B,G){B.constructor===F.constructor&&G===u&&B.constructor.resolve===l?y(F,B):G===se?C(F,se.error):void 0===G?S(F,B):i(G)?m(F,B,G):S(F,B)}function k(F,B){F===B?C(F,d()):t(B)?T(F,B,f(B)):S(F,B)}function w(F){F._onerror&&F._onerror(F._result),R(F)}function S(F,B){F._state===re&&(F._result=B,F._state=oe,0!==F._subscribers.length&&V(R,F))}function C(F,B){F._state===re&&(F._state=ae,F._result=B,V(w,F))}function b(F,B,G,W){var z=F._subscribers,K=z.length;F._onerror=null,z[K]=B,z[K+oe]=G,z[K+ae]=W,0===K&&F._state&&V(R,F)}function R(F){var B=F._subscribers,G=F._state;if(0!==B.length){for(var W=void 0,z=void 0,K=F._result,J=0;J<B.length;J+=3)W=B[J],z=B[J+G],W?P(G,W,z,K):z(K);F._subscribers.length=0}}function I(){this.error=null}function E(F,B){try{return F(B)}catch(F){return ce.error=F,ce}}function P(F,B,G,W){var z=i(G),K=void 0,J=void 0,Q=void 0,Y=void 0;if(z){if((K=E(G,W))===ce?(Y=!0,J=K.error,K=null):Q=!0,B===K)return void C(B,g())}else K=W,Q=!0;B._state!==re||(z&&Q?k(B,K):Y?C(B,J):F===oe?S(B,K):F===ae&&C(B,K))}function U(F,B){try{B((function(B){k(F,B)}),(function(B){C(F,B)}))}catch(B){C(F,B)}}function _(){return le++}function O(F){F[ie]=le++,F._state=void 0,F._result=void 0,F._subscribers=[]}function M(F,B){this._instanceConstructor=F,this.promise=new F(p),this.promise[ie]||O(this.promise),z(B)?(this._input=B,this.length=B.length,this._remaining=B.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):C(this.promise,A())}function A(){return new Error("Array Methods must be provided an Array")}function x(F){return new M(this,F).promise}function D(F){var B=this;return new B(z(F)?function(G,W){for(var z=F.length,K=0;K<z;K++)B.resolve(F[K]).then(G,W)}:function(F,B){return B(new TypeError("You must pass an array to race."))})}function L(F){var B=new this(p);return C(B,F),B}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function q(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(F){this[ie]=_(),this._result=this._state=void 0,this._subscribers=[],p!==F&&("function"!=typeof F&&N(),this instanceof j?U(this,F):q())}function H(){var F=void 0;if(void 0!==W)F=W;else if("undefined"!=typeof self)F=self;else try{F=Function("return this")()}catch(F){throw new Error("polyfill failed because global object is unavailable in this environment")}var B=F.Promise;if(B){var G=null;try{G=Object.prototype.toString.call(B.resolve())}catch(F){}if("[object Promise]"===G&&!B.cast)return}F.Promise=j}var F=void 0;F=Array.isArray?Array.isArray:function(F){return"[object Array]"===Object.prototype.toString.call(F)};var z=F,K=0,J=void 0,Q=void 0,V=function(F,B){te[K]=F,te[K+1]=B,2===(K+=2)&&(Q?Q(h):ne())},Y="undefined"!=typeof window?window:void 0,$=Y||{},X=$.MutationObserver||$.WebKitMutationObserver,Z="undefined"==typeof self&&void 0!==B&&"[object process]"==={}.toString.call(B),ee="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,te=new Array(1e3),ne=void 0;ne=Z?function(){return B.nextTick(h)}:X?function(){var F=0,B=new X(h),G=document.createTextNode("");return B.observe(G,{characterData:!0}),function(){G.data=F=++F%2}}():ee?function(){var F=new MessageChannel;return F.port1.onmessage=h,function(){return F.port2.postMessage(0)}}():void 0===Y?function(){try{var F=G(21);return J=F.runOnLoop||F.runOnContext,c()}catch(F){return a()}}():a();var ie=Math.random().toString(36).substring(16),re=void 0,oe=1,ae=2,se=new I,ce=new I,le=0;return M.prototype._enumerate=function(){for(var F=this.length,B=this._input,G=0;this._state===re&&G<F;G++)this._eachEntry(B[G],G)},M.prototype._eachEntry=function(F,B){var G=this._instanceConstructor,W=G.resolve;if(W===l){var z=f(F);if(z===u&&F._state!==re)this._settledAt(F._state,B,F._result);else if("function"!=typeof z)this._remaining--,this._result[B]=F;else if(G===j){var K=new G(p);T(K,F,z),this._willSettleAt(K,B)}else this._willSettleAt(new G((function(B){return B(F)})),B)}else this._willSettleAt(W(F),B)},M.prototype._settledAt=function(F,B,G){var W=this.promise;W._state===re&&(this._remaining--,F===ae?C(W,G):this._result[B]=G),0===this._remaining&&S(W,this._result)},M.prototype._willSettleAt=function(F,B){var G=this;b(F,void 0,(function(F){return G._settledAt(oe,B,F)}),(function(F){return G._settledAt(ae,B,F)}))},j.all=x,j.race=D,j.resolve=l,j.reject=L,j._setScheduler=r,j._setAsap=s,j._asap=V,j.prototype={constructor:j,then:u,catch:function(F){return this.then(null,F)}},j.polyfill=H,j.Promise=j,j}))}).call(B,G(13),G(4))},function(F,B){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(F){if(G===setTimeout)return setTimeout(F,0);if((G===n||!G)&&setTimeout)return G=setTimeout,setTimeout(F,0);try{return G(F,0)}catch(B){try{return G.call(null,F,0)}catch(B){return G.call(this,F,0)}}}function r(F){if(W===clearTimeout)return clearTimeout(F);if((W===o||!W)&&clearTimeout)return W=clearTimeout,clearTimeout(F);try{return W(F)}catch(B){try{return W.call(null,F)}catch(B){return W.call(this,F)}}}function s(){Q&&K&&(Q=!1,K.length?J=K.concat(J):Y=-1,J.length&&c())}function c(){if(!Q){var F=i(s);Q=!0;for(var B=J.length;B;){for(K=J,J=[];++Y<B;)K&&K[Y].run();Y=-1,B=J.length}K=null,Q=!1,r(F)}}function a(F,B){this.fun=F,this.array=B}function h(){}var G,W,z=F.exports={};!function(){try{G="function"==typeof setTimeout?setTimeout:n}catch(F){G=n}try{W="function"==typeof clearTimeout?clearTimeout:o}catch(F){W=o}}();var K,J=[],Q=!1,Y=-1;z.nextTick=function(F){var B=new Array(arguments.length-1);if(arguments.length>1)for(var G=1;G<arguments.length;G++)B[G-1]=arguments[G];J.push(new a(F,B)),1!==J.length||Q||i(c)},a.prototype.run=function(){this.fun.apply(null,this.array)},z.title="browser",z.browser=!0,z.env={},z.argv=[],z.version="",z.versions={},z.on=h,z.addListener=h,z.once=h,z.off=h,z.removeListener=h,z.removeAllListeners=h,z.emit=h,z.prependListener=h,z.prependOnceListener=h,z.listeners=function(F){return[]},z.binding=function(F){throw new Error("process.binding is not supported")},z.cwd=function(){return"/"},z.chdir=function(F){throw new Error("process.chdir is not supported")},z.umask=function(){return 0}},function(F,B){F.exports=function(F){return F.webpackPolyfill||(F.deprecate=function(){},F.paths=[],F.children||(F.children=[]),Object.defineProperty(F,"loaded",{enumerable:!0,get:function(){return F.l}}),Object.defineProperty(F,"id",{enumerable:!0,get:function(){return F.i}}),F.webpackPolyfill=1),F}},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W,z=G(3),K=G(1),J=G(0),Q=function(){function t(F){this.id=F,this.status=200,this.headers={},this.body=""}return t}();B.ResponseData=Q,function(F){F.Connected="trouter_js_client_connected",F.Disconnected="trouter_js_client_disconnected",F.Error="trouter_js_client_error",F.Progress="trouter_js_client_progress",F.Response="trouter_js_client_response",F.Request="trouter_js_client_request",F.CheckConnection="trouter_js_client_check_connection",F.Registration="trouter_js_client_registration",F.Unregistration="trouter_js_client_unregistration"}(W=B.ClientEventName||(B.ClientEventName={}));var Y=function(){function t(F,B,G,W,z){this.stepName=F,this.operation=B,this.delta=G,this.ts=W,this.error=z}return t}();B.TrackerStep=Y;var $=function(){function t(){}return t}();B.Properties=$;var X=function(){function t(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0}return t}(),Z=function(){function t(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0}return t}(),ee=function(){function t(F,B,G,W,K,Q,Y){this.clientId=B,this.clientInfo=G,this.getServerState=W,this.endpointId=K,this.clientCorrelationID=Q,this.environment=Y,this.logger=new J.Logger("ConnectionTracker",F),this.clientCorrelationID=void 0!==Q?Q:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new z.Timespan,this.eventLogSettings=new Z,this.connectedInfo=new X}return t.prototype.enable=function(F){this.eventLogSettings.enabled=!0,this.eventLogger=F},t.prototype.disable=function(){this.eventLogSettings.enabled=!1},t.prototype.sendProgress=function(F){this.steps.length>0&&this.sendTelemetry(W.Progress,F,this.steps)},t.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},t.prototype.resetProgressSendTimer=function(){var F=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout((function(){F.sendProgress({reason:"timeout",timeoutSecs:F.eventLogSettings.sendProgressTimeoutSecs})}),1e3*this.eventLogSettings.sendProgressTimeoutSecs))},t.prototype.setConnectedInfo=function(F,B){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=F,this.connectedInfo.transportType=B,++this.connectedInfo.connectionNumber},t.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},t.prototype.copyProperties=function(F,B){for(var G=0,W=Object.keys(B);G<W.length;G++){var z=W[G];B.hasOwnProperty(z)&&void 0!==B[z]&&(F[z.replace(/-/g,"_")]={value:B[z]})}},t.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},t.prototype.sendTelemetry=function(F,B,G){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[F]&&void 0!==this.eventLogger){var W=this.getServerState(),J={name:F,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:z.toJson(G)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:K.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:W.connectionId},connectedClientId:{value:W.connectedClientId},domId:{value:W.domId},url:{value:W.unsecureUrl},surl:{value:W.url},ttlInSecs:{value:W.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(J.properties,B),this.eventLogger.logEvent(J)}}catch(B){this.logger.warn("error in sending event "+F+": "+z.toJson(B))}},t.prototype.createStep=function(F,B,G){return new Y(F,B,this.beginTimestamp.duration,Date.now(),G)},t.prototype.addStep=function(F,B,G){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(F,B,G)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var z=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(W.Progress,{reason:"flush"},z)}},t.prototype.trackStart=function(F){this.addStep(F,"start")},t.prototype.trackEnd=function(F){this.addStep(F,"end")},t.prototype.trackError=function(F,B,G,z){void 0===G&&(G=!0),"health"===F&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===F&&!1===this.eventLogSettings.logSendPingError||(void 0===z&&(z="error"),!0===G&&this.addStep(F,z,B),this.sendTelemetry(W.Error,{},[this.createStep(F,z,B)]))},t.prototype.trackProgress=function(F,B){this.addStep(F,B)},t.prototype.trackConnected=function(F,B){this.setConnectedInfo(F,B);var G=this.steps.slice(0),z=this.totalStepCount,K=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(W.Connected,{stepCount:G.length,totalStepCount:z,connectionEstablishmentMs_Total:K},G),this.cancelProgressTimer()},t.prototype.getSessionLength=function(){return Date.now()-this.connectedInfo.connectedTimestamp},t.prototype.trackDisconnected=function(F){F.sessionLengthMS=this.getSessionLength(),this.sendTelemetry(W.Disconnected,F,[]),this.resetProgressSendTimer()},t.prototype.trackNewConnection=function(){++this.connectionAttempt},t.prototype.trackRequest=function(F,B){var G={};void 0!==B&&(G.hasError=!0,G.error=B);try{if(F){G.requestID=F.id,G.httpMethod=F.method,G.url=F.url,G.bodyLength=F.body.length,G.shortUrl=F.shortUrl,G.requestTimeStamp=F.startTS,G.correlationVector=F.correlationVector;for(var K=F.headers,J=0,Q=Object.keys(K);J<Q.length;J++){var Y=Q[J];K.hasOwnProperty(Y)&&(G[Y]=K[Y])}}}catch(F){G.hasError=!0,G.error=G.error+" error creating request context "+z.toJson(F)}this.sendTelemetry(W.Request,G,[])},t.prototype.trackResponse=function(F,B,G,K){var J={};void 0!==K&&(J.hasError=!0,J.error=K);try{if(J.responseTimestamp=void 0!==G?G.sentTS:Date.now(),F){J.requestID=F.id,J.httpMethod=F.method,J.shortUrl=F.shortUrl,J.correlationVector=F.correlationVector;for(var Q=F.headers,Y=0,$=Object.keys(Q);Y<$.length;Y++){var X=$[Y];Q.hasOwnProperty(X)&&(J[X]=Q[X])}}G&&(J.latencyMS=B,J.responseCode=G.status,J.responseLength=G.body.length)}catch(F){J.hasError=!0,J.error=J.error+" error creating response context "+z.toJson(F)}this.sendTelemetry(W.Response,J,[])},t.prototype.sendResponseError=function(F,B,G){this.trackResponse(B,void 0,G,F)},t.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},t.prototype.mergeSettings=function(F){if(F){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==F.numberOfStepsToMaintain?F.numberOfStepsToMaintain:0));var B=Math.min(3600,Math.max(55,void 0!==F.sendProgressTimeoutSecs?F.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=F.logHealthCheckError,this.eventLogSettings.logSendPingError=F.logSendPingError;for(var G=0,z=Object.keys(W).map((function(F){return W[F]}));G<z.length;G++){var K=z[G];F.hasOwnProperty(K)&&void 0!==F[K]&&(this.eventLogSettings[K]=F[K])}this.eventLogSettings.sendProgressTimeoutSecs!==B&&(this.eventLogSettings.sendProgressTimeoutSecs=B,this.resetProgressSendTimer())}},t}();B.ConnectionTracker=ee},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function t(F,B){this.logger=F,this.maxBackoffInMs=B,this.backoffId=0,this.backoffCount=0}return t.calculateNextBackoffMs=function(F,B){var G=1+.4*(Math.random()-.5),W=1e3*Math.pow(2,F)*G;return W=Math.round(W),Math.min(B,W)},t.prototype.setMaxBackoffMs=function(F){this.maxBackoffInMs=F},t.prototype.backoff=function(F,B){var G=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var W=t.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+F+" for "+W+" milliseconds with ID "+this.backoffId),this.callback=function(){G.logger.info("Back off for "+F+" with ID "+G.backoffId+" complete, invoking handler"),G.timerHandle=void 0,G.callback=void 0,B()},this.timerHandle=setTimeout(this.callback,W)},t.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off with ID "+this.backoffId),clearTimeout(this.timerHandle),this.timerHandle=void 0,this.callback=void 0),this.backoffCount=0},t.prototype.expediteIfPending=function(){if(this.backoffCount=0,void 0!==this.timerHandle){this.logger.debug("Expediting back off with ID "+this.backoffId),clearTimeout(this.timerHandle),this.timerHandle=void 0;var F=this.callback;this.callback=void 0,F&&F()}},t}();B.ExponentialBackoff=W},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W,z,K=G(5),J=G(0);!function(F){F[F.Initial=0]="Initial",F[F.RetrievingToken=1]="RetrievingToken",F[F.Allocating=2]="Allocating",F[F.Handshaking=3]="Handshaking",F[F.Connecting=4]="Connecting",F[F.Connected=5]="Connected",F[F.UnregisteringRetrievingToken=6]="UnregisteringRetrievingToken",F[F.Unregistering=7]="Unregistering",F[F.TerminalError=8]="TerminalError"}(W=B.State||(B.State={})),function(F){F[F.Initial=0]="Initial",F[F.RetrievingToken=1]="RetrievingToken",F[F.Registering=2]="Registering",F[F.Registered=3]="Registered",F[F.NotRegistered=4]="NotRegistered"}(z||(z={}));var Q=function(){function t(F,B,G){this.worker=B,this.incallModeEnabled=G,this.state=W.Initial,this.autoReconnect=!0,this.logger=new J.Logger("ConnectionFsm",F),this.connectedSubstate=z.Initial}return t.prototype.getState=function(){return this.state},t.prototype.isActive=function(){return this.state===W.Allocating||this.state===W.Connected||this.state===W.Handshaking||this.state===W.Connecting||this.state===W.RetrievingToken},t.prototype.start=function(){return this.state===W.Initial?(this.setState(W.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},t.prototype.stop=function(F){F&&(this.connectedSubstate=z.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.resetRegisterBackoff(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopRegisterTimer(),this.state!==W.Connecting&&this.state!==W.Handshaking&&this.state!==W.Connected||(this.worker.stopSocketIo(),this.state===W.Connected&&this.worker.sendDisconnectTelemetryEvent("connection stopped")),this.isRegistered()&&this.state!==W.UnregisteringRetrievingToken&&this.state!==W.Unregistering?(this.setState(W.UnregisteringRetrievingToken),this.worker.getToken(!0,!1)):(this.setState(W.Initial),this.worker.dispatchDisconnected())},t.prototype.onTokenReceived=function(F){this.state===W.RetrievingToken?(this.setState(W.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(F)):this.state===W.Connected&&this.connectedSubstate===z.RetrievingToken?(this.connectedSubstate=z.Registering,this.worker.sendRegisterRequest()):this.state===W.UnregisteringRetrievingToken?(this.setState(W.Unregistering),this.worker.sendUnregisterRequest()):this.showIgnored("onTokenReceived")},t.prototype.checkConnection=function(F){F&&this.onPingInterval()},t.prototype.onAllocationSucceed=function(){return this.state===W.Allocating?(this.setState(W.Handshaking),this.connectedSubstate===z.Registered&&this.worker.dispatchUnregistered(),this.connectedSubstate=z.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},t.prototype.onAllocationFailed=function(F){this.state===W.Allocating?(this.setState(W.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!F,!0)):this.showIgnored("onAllocationFailed")},t.prototype.onConnectingTimeout=function(){this.state===W.Allocating||this.state===W.Connecting||this.state===W.Handshaking?(this.setState(W.RetrievingToken),this.worker.stopSocketIo(),this.worker.getToken(!0,!1)):this.showIgnored("onConnectingTimeout")},t.prototype.onConnecting=function(){this.state===W.Handshaking?this.setState(W.Connecting):this.showIgnored("onConnecting")},t.prototype.onConnectingFailed=function(){this.state===W.Connecting?this.onConnectingTimeout():this.state===W.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},t.prototype.onSocketDisconnect=function(F){this.state===W.Handshaking||this.state===W.Connected?(this.worker.stopSocketIo(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopConnectionTimer(),this.state===W.Connected&&this.worker.sendDisconnectTelemetryEvent(F),this.autoReconnect?(this.setState(W.RetrievingToken),this.worker.resetRegisterBackoff(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):(this.logger.debug("Socket error/disconnect occurred and automatic reconnect is disabled. Connection will stop."),this.stop(!0))):this.showIgnored("onSocketDisconnect")},t.prototype.onTrouterConnected=function(){this.state===W.Connecting?(this.setState(W.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(K.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.worker.shouldSkipRegistration()?(this.connectedSubstate=z.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=z.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},t.prototype.onReconnectRequired=function(F,B){this.worker.dispatchReconnectIsRequired(F,B)},t.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},t.prototype.onDownstreamRequest=function(F){this.state===W.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(F)):this.showIgnored("onDownstreamRequest")},t.prototype.onTrouterMessageLost=function(F){this.state===W.Connected?this.worker.dispatchTrouterMessageLost(F):this.showIgnored("onTrouterMessageLost")},t.prototype.onPingInterval=function(){this.state===W.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},t.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},t.prototype.onPingResponse=function(){this.state===W.Connected||this.showIgnored("onPingResponse")},t.prototype.onRegistrationFailed=function(F){this.state===W.Connected&&this.connectedSubstate===z.Registering?(this.connectedSubstate=z.RetrievingToken,this.worker.getToken(!F,!0)):this.showIgnored("onRegistrationFailed")},t.prototype.onRegistrationSucceed=function(F){this.state===W.Connected?(this.connectedSubstate===z.Registering&&(this.connectedSubstate=z.Registered,this.worker.dispatchRegistered()),F&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},t.prototype.onRegistrationTimeout=function(){this.state===W.Connected&&this.connectedSubstate!==z.NotRegistered?(this.connectedSubstate=z.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},t.prototype.onUnregistrationFailed=function(F){this.state===W.Unregistering?(this.setState(W.UnregisteringRetrievingToken),this.worker.getToken(!F,!F)):this.showIgnored("onUnregistrationFailed")},t.prototype.onUnregistrationSucceed=function(){this.state===W.Unregistering?(this.setState(W.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},t.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===W.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},t.prototype.onSetUserActivityState=function(F,B){B?(this.logger.info("Changing user activity state to '"+F.toEventJSON()+"'"),this.worker.sendUserActivityState(K.UserActivityEventReason.Modified,this.state===W.Connected)):this.logger.debug("Not changing the same user activity state '"+F.toEventJSON()+"'")},t.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},t.prototype.forceReconnect=function(F){this.state===W.Connected&&this.worker.sendDisconnectTelemetryEvent(F),this.setState(W.RetrievingToken),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.resetRegisterBackoff(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)},t.prototype.onTerminalError=function(){this.logger.error("Cannot proceed, reached terminal state. Switching from state '"+W[this.state]+"' to "+W[W.TerminalError]),this.setState(W.TerminalError)},t.prototype.onMissedResponse=function(F){this.state===W.Connected?(this.setState(W.RetrievingToken),this.worker.resetRegisterBackoff(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.sendDisconnectTelemetryEvent(F),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):this.showIgnored(F)},t.prototype.showIgnored=function(F){this.logger.debug("Ignoring event '"+F+"' in state '"+W[this.state]+"'")},t.prototype.setState=function(F){this.logger.info("Switching from state '"+W[this.state]+"' to state '"+W[F]+"'"),this.state!==F?this.state=F:this.logger.error("Attempt to switching into the current state '"+W[F]+"'")},t.prototype.isRegistered=function(){return this.connectedSubstate===z.Registered||this.connectedSubstate===z.Registering},t.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},t}();B.TrouterFsm=Q},function(F,B,G){Object.defineProperty(B,"__esModule",{value:!0});var W=G(2),z=G(0),K=G(6),J=function(){function t(F,B){this.worker=B,this.state=W.TrouterState.Unknown,this.logger=new z.Logger("ManagerFsm",F)}return t.prototype.start=function(){this.state===W.TrouterState.Unknown?(this.setState(W.TrouterState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):this.showIgnored("start")},t.prototype.stop=function(F){this.state!==W.TrouterState.Unknown?(this.setState(W.TrouterState.Unknown),this.worker.stopFirstConnection(!0===F),this.worker.stopSecondConnection(!0===F)):this.showIgnored("stop")},t.prototype.getState=function(){return this.state},t.prototype.onConnected=function(F){this.state===W.TrouterState.Disconnected&&F?this.worker.doesSecondConnectionExist()?this.setState(W.TrouterState.Switching):(this.setState(W.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+F+")")},t.prototype.onRegistered=function(F){this.state!==W.TrouterState.Disconnected||F?this.state!==W.TrouterState.Switching||F||(this.setState(W.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(W.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},t.prototype.onUnregistered=function(F){F&&this.worker.dispatchRegistrationState(!1)},t.prototype.onReconnecting=function(F){this.state===W.TrouterState.Connected&&F||this.state===W.TrouterState.Switching&&F?(this.setState(W.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+F+")")},t.prototype.onReconnectionRequired=function(F,B,G){this.state===W.TrouterState.Connected&&F?(this.setState(W.TrouterState.Switching),this.worker.startSecondConnection(B)):this.state===W.TrouterState.Disconnected&&F?this.worker.startSecondConnection(B):this.state===W.TrouterState.Switching&&F&&G===K.ReconnectReason.Configuration?(this.logger.debug("onReconnectionRequired: switch requested while already in Switching state"),this.worker.stopSecondConnection(!0),this.worker.startSecondConnection(B)):this.showIgnored("onReconnectionRequired("+F+")")},t.prototype.onDisconnected=function(F){this.state===W.TrouterState.Unknown&&F?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+F+")")},t.prototype.showIgnored=function(F){this.logger.info("Ignoring event '"+F+"' in state '"+W.TrouterState[this.state]+"'")},t.prototype.setState=function(F){this.logger.info("Switching from state '"+W.TrouterState[this.state]+"' to state '"+W.TrouterState[F]+"'"),this.state!==F?this.state=F:this.logger.error("Attempt to switching into the current state '"+W.TrouterState[F]+"'")},t}();B.TrouterManagerFsm=J},function(F,B,G){function o(F,B){if(!B)return F;var G=W({},F,{enabled:B.TelemetryEnabled});return void 0!==B.ClientTelemetryEventEnabled&&(G=W({},G,B.ClientTelemetryEventEnabled)),G}function i(F,B){return{clientInfo:{ua:F.trouterSettings.productName,v:F.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:F.trouterSettings.sessionId,environment:F.trouterSettings.environment,telemetrySettings:o(F.telemetryConfig.settings,B),eventLogger:F.telemetryConfig.eventLogger,endpointId:F.trouterSettings.registrationId,trouterUrl:B&&B.TrouterConnectionUrl||F.trouterSettings.trouterServiceUrl,registration:F.trouterSettings.registrarServiceUrl?{registrarUrl:F.trouterSettings.registrarServiceUrl,registrationId:F.trouterSettings.registrationId||"",pnhAppId:F.trouterSettings.pnhAppId||"",platform:F.trouterSettings.platform||"",pnhTemplateKey:F.trouterSettings.pnhTemplate||"",platformUIVersion:F.trouterSettings.platformUIVersion||"",productContext:F.trouterSettings.pnhProductContext||void 0,context:F.trouterSettings.pnhContext||"",registrarTtlSec:(F.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:W({connectionTimeoutMs:F.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:"TeamsCDL"===F.trouterSettings.productName?3e5:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},F.trouterSettings.timeoutOptions),incallTimeoutOptions:W({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:"TeamsCDL"===F.trouterSettings.productName?3e5:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},F.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:F.trouterSettings.incallModeTimeoutMs||0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:F.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:F.connectionCache,registrationStateCallback:F.registrationStateCallbackForAcsDoNotUse,retryLimitOnTokenFetch:"TeamsCDL"===F.trouterSettings.productName?15:F.trouterSettings.retryLimitOnTokenFetch}}function r(F){return new te(F)}function s(){return J.CLIENT_VERSION}function c(F,B){var G=F.indexOf("://");if(G>=0){var W=F.indexOf("/",G+3);if(W>=0)return B+F.substr(W)}return""}var W=this&&this.__assign||Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},z=this&&this.__awaiter||function(F,B,G,W){return new(G||(G=Promise))((function(z,K){function s(F){try{a(W.next(F))}catch(F){K(F)}}function c(F){try{a(W.throw(F))}catch(F){K(F)}}function a(F){F.done?z(F.value):new G((function(B){B(F.value)})).then(s,c)}a((W=W.apply(F,B||[])).next())}))},K=this&&this.__generator||function(F,B){function n(F){return function(B){return o([F,B])}}function o(K){if(G)throw new TypeError("Generator is already executing.");for(;J;)try{if(G=1,W&&(z=2&K[0]?W.return:K[0]?W.throw||((z=W.return)&&z.call(W),0):W.next)&&!(z=z.call(W,K[1])).done)return z;switch(W=0,z&&(K=[2&K[0],z.value]),K[0]){case 0:case 1:z=K;break;case 4:return J.label++,{value:K[1],done:!1};case 5:J.label++,W=K[1],K=[0];continue;case 7:K=J.ops.pop(),J.trys.pop();continue;default:if(!(z=(z=J.trys).length>0&&z[z.length-1])&&(6===K[0]||2===K[0])){J=0;continue}if(3===K[0]&&(!z||K[1]>z[0]&&K[1]<z[3])){J.label=K[1];break}if(6===K[0]&&J.label<z[1]){J.label=z[1],z=K;break}if(z&&J.label<z[2]){J.label=z[2],J.ops.push(K);break}z[2]&&J.ops.pop(),J.trys.pop();continue}K=B.call(F,J)}catch(F){K=[6,F],W=0}finally{G=z=0}if(5&K[0])throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}var G,W,z,K,J={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return K={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(K[Symbol.iterator]=function(){return this}),K};Object.defineProperty(B,"__esModule",{value:!0});var J=G(1),Q=G(2);B.TrouterState=Q.TrouterState,B.UserActivityState=Q.UserActivityState;var Y=G(0),$=G(7),X=G(8),Z=G(9),ee=G(10),te=function(){function t(F){this.logProvider=F,this.stateChangedListeners=[],this.logger=new Y.Logger("Trouter",F),this.trouterUrlPromise=new ee.TrouterUrlPromise(F),this.messageHandlers=new $.MessageHandlerRegistry(F),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version "+J.CLIENT_VERSION)}return t.prototype.start=function(F){if(this.logger.info("Start"),!F.trouterSettings.disableInternalSkypeTokenCache){var B=F.skypeTokenProvider;F.skypeTokenProvider=X.addCacheAsBackupTo(B)}this.trouterCfg=F;var G=i(F,this.ecsCfg);void 0===this.trouterServer&&(this.trouterServer=new Z.TrouterManager(this.logProvider,G,F.skypeTokenProvider,this)),this.trouterServer.start()},t.prototype.stop=function(F){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop(F)},t.prototype.setEcsConfig=function(F){return z(this,void 0,void 0,(function(){var B=this;return K(this,(function(G){return[2,new Promise((function(G,W){if(B.ecsCfg=F.TrouterJScriptClient,B.logger.info("Setting ECS configuration to "+JSON.stringify(B.ecsCfg)),void 0!==B.trouterServer&&void 0!==B.trouterCfg){var z=i(B.trouterCfg,B.ecsCfg);B.trouterServer.configure(z)}G()}))]}))}))},t.prototype.checkConnection=function(F){void 0!==this.trouterServer&&this.trouterServer.checkConnection(F||!1)},t.prototype.resendRegistration=function(){return z(this,void 0,void 0,(function(){return K(this,(function(F){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]}))}))},t.prototype.registerListener=function(F,B){return""===B||"/"!==B[0]||B.indexOf("?")>=0||B.indexOf("#")>=0?(this.logger.error("Listener path '"+B+"' is not valid"),!1):this.listeners[B]?(this.logger.error("Another listener is already registered for path '"+B+"'"),!1):(this.listeners[B]=F,this.logger.debug("Listener for path '"+B+"' registered"),this.connectionInfo&&F.onTrouterConnected(this.connectionInfo.baseEndpointUrl+B,this.connectionInfo),!0)},t.prototype.unregisterListener=function(F){for(var B=[],G=0,W=Object.keys(this.listeners);G<W.length;G++){var z=W[G];this.listeners[z]===F&&B.push(z)}if(0===B.length)return!1;for(var K=0,J=B;K<J.length;K++)z=J[K],delete this.listeners[z];return this.logger.debug("Listener for path(s) '"+B.join("', '")+"' unregistered"),!0},t.prototype.onTrouterConnected=function(F,B){this.logger.debug("Trouter is now connected");for(var G=0,W=Object.keys(this.listeners);G<W.length;G++){var z=W[G];try{this.listeners[z].onTrouterConnected(B.baseEndpointUrl+z,B)}catch(F){this.logger.error("Listener '"+z+"' threw an exception from onTrouterConnected(): "+F)}}this.connectionInfo=B,this.trouterUrlPromise.resolveUrl(F),this.notifyStateChanged(Q.TrouterState.Connected,{url:F,getRemainingTtlInSec:function(){return B.connectionTtlSec}})},t.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var F=0,B=Object.keys(this.listeners);F<B.length;F++){var G=B[F],W=this.listeners[G];if(W.onTrouterDisconnected)try{W.onTrouterDisconnected()}catch(F){this.logger.error("Listener '"+G+"' threw an exception from onTrouterDisconnected(): "+F)}}this.notifyStateChanged(Q.TrouterState.Disconnected)},t.prototype.onTrouterRequest=function(F,B){for(var G="",W=0,z=Object.keys(this.listeners);W<z.length;W++){var K=z[W];F.path.substring(0,K.length)===K&&K.length>G.length&&(G=K)}if(""===G)this.tryMessageHandlers(F,B)||(B.status=404,B.headers={"Trouter-Responder":"ClientLib"},B.send());else try{this.listeners[G].onTrouterRequest(F,B)}catch(F){this.logger.error("Listener '"+G+"' threw an exception from onTrouterRequest(): "+F),B.status=500,B.headers={"Trouter-Responder":"ClientLib"},B.send()}},t.prototype.onTrouterMessageLoss=function(F){this.logger.info("onTrouterMessageLoss called with value "+F);for(var B=!0,G=0,W=Object.keys(this.listeners);G<W.length;G++){var z=W[G],K=this.listeners[z];if(K.onTrouterMessageLoss)try{void 0===(B=K.onTrouterMessageLoss(F)&&B)&&(this.logger.error("Listener '"+z+"' did not response with boolean value onTrouterMessageLoss()"),B=!1)}catch(F){this.logger.error("Listener '"+z+"' threw an exception from onTrouterMessageLoss(): "+F),B=!1}}return B},t.prototype.onTrouterUserActivityStateAccepted=function(F){this.logger.debug("onTrouterUserActivityStateAccepted cv: "+F);for(var B=0,G=Object.keys(this.listeners);B<G.length;B++){var W=G[B],z=this.listeners[W];if(z.onTrouterUserActivityStateAccepted)try{z.onTrouterUserActivityStateAccepted(F)}catch(F){this.logger.error("Listener '"+W+"' threw an exception from onTrouterUserActivityStateAccepted(): "+F)}}},t.prototype.setUserActivityState=function(F,B){if(F!==Q.UserActivityState.Active&&F!==Q.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value "+F);if(this.logger.info("setUserActivityState called with value "+Q.UserActivityState[F]),!this.trouterServer||this.state()===Q.TrouterState.Unknown)throw new Error("setUserActivityState called too early");this.trouterServer.setUserActivityState(F,B)},t.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():Q.TrouterState.Unknown},t.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},t.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},t.prototype.onStateChanged=function(F){if(this.logger.info("onStateChanged called"),void 0===F)this.stateChangedListeners=this.stateChangedListeners.filter((function(F){return void 0===F.wrappedCallback}));else{this.offStateChanged(F);var e=function(B,G){F(B,G?G.url:"")};e.wrappedCallback=F,this.stateChangedListeners.push(e)}},t.prototype.offStateChanged=function(F){this.logger.info("offStateChanged called");var B=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter((function(B){return B.wrappedCallback!==F})),B>this.stateChangedListeners.length},t.prototype.addCallback=function(F){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(F,0)&&void 0!==F&&this.stateChangedListeners.push(F)},t.prototype.removeCallback=function(F){this.logger.info("removeListener called");var B=this.stateChangedListeners.indexOf(F,0);return B>-1&&(this.stateChangedListeners.splice(B,1),!0)},t.prototype.registerMessageHandler=function(F){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(F)},t.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},t.prototype.notifyStateChanged=function(F,B){var G=this;this.logger.info("notifyStateChanged called, will forward to "+this.stateChangedListeners.length+" listeners"),this.stateChangedListeners.forEach((function(W){try{W(F,B)}catch(F){G.logger.error("Error in callback "+F)}}))},t.prototype.tryMessageHandlers=function(F,B){if(!this.messageHandlers.active())return!1;var G,W=null;try{W=(G=JSON.parse(F.body))&&(G.evt||G.eventId)||null}catch(F){}var z={eventId:W,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+F.path,body:G,rawBody:F.body,headers:F.headers},K=this.messageHandlers.handleMessage(z);return!!K.isHandled&&(B.status=K.resultCode,K.responseHeaders&&(B.headers=K.responseHeaders),K.responseBody&&(B.body=K.responseBody),B.send(),!0)},t}();B.TrouterService=te,B.createTrouterService=r,B.getTrouterServiceVersion=s,B.replaceTrouterUrlBase=c},function(B,G){B.exports=F},function(F,B){}])},F.exports=G(Th)})),__awaiter$l=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class TelemetrySender{constructor(F,B){this.logEvent=F=>{this._logger.debug(F),this._telemetryLogManager.sendEvent({name:F.name,tenant:yt,properties:Object.assign({},F.properties)})},this._logger=F.createChild("TelemetrySender"),this._telemetryLogManager=B}}class Trouter{constructor(F,B,G,W){this._ecsProvider=B,this._tokenProvider=G,this._isRegistered=!1,this._logger=F.createChild("Trouter"),this._logger.info("init"),this._initialRegistrationCompleteDefer=defer$1(),this._telemetryLogManager=W}start(F){return __awaiter$l(this,void 0,void 0,(function*(){let B;if(this._trouterService)throw this._logger.error("Trouterservice already initialized"),new CallingCommunicationError({message:"Signaling service already initialized",code:ue});{const G=new Promise(((B,G)=>__awaiter$l(this,void 0,void 0,(function*(){try{if(this._logger.info("Trouterservice start"),this._trouterService=Eh.createTrouterService(this._logger),!this._trouterService)throw this._logger.error("Failed to create trouter service"),new CallingCommunicationError({message:"Failed to create trouter service",code:ue});this._options=this._getTrouterConfig(this._logger,this._tokenProvider),F&&(this._options.trouterSettings.environment=F.environment||"",this._options.trouterSettings.sessionId=F.sessionId);let G,W,z=+new Date;this._trouterService.start(this._options),this._trouterService.onStateChanged(((F,B)=>{F===Eh.TrouterState.Connected&&(G=+new Date)})),yield this._initialRegistrationCompleteDefer.promise;const K=+new Date;G=null!=G?G:+new Date,W=G,B({trouterRequestCompletionTimeDeltaMs:Math.max(0,G-z),registrarRequestCompletionTimeDeltaMs:Math.max(0,K-W)})}catch(F){G(F)}}))));try{const F=wait((()=>G),tt);B=yield F}catch(F){throw 408===(null==F?void 0:F.code)?(this._logger.error("Signaling init timeout"),new CallingCommunicationError({message:`Signaling init timeout, request took longer than ${tt} ms`,code:se})):(this._logger.error("Signaling init failed"),new CallingCommunicationError({message:"Signaling init failed",code:ue}))}}return B}))}isRegistered(){return this._isRegistered}stop(F){this._logger.info("Trouterservice stop"),this._trouterService?(this._trouterService.onStateChanged(void 0),this._trouterService.stop(F),this._trouterService=void 0):this._logger.error("Trouterservice not inited")}registerMessageHandler(F){this._logger.info("Trouterservice registerMessageHandler"),this._trouterService&&this._trouterService.registerMessageHandler(F)}clearMessageHandlers(){this._trouterService&&this._trouterService.clearMessageHandlers()}checkConnection(){this._trouterService&&this._trouterService.checkConnection()}state(){return this._logger.info("Trouterservice state"),this._trouterService?this._trouterService.state():Eh.TrouterState.Unknown}onStateChanged(F){this._logger.info("Trouterservice onStateChanged"),this._trouterService&&this._trouterService.onStateChanged(F)}offStateChanged(F){this._logger.info("Trouterservice offStateChanged"),this._trouterService&&this._trouterService.offStateChanged(F)}getTrouterUrlAsync(){return this._trouterService?(this._logger.info("getTrouterUrlAsync called"),this._trouterService.getTrouterUrlAsync()):Promise.reject("Trouterservice not started yet")}_getSettings(){return{registrationId:generateGuid(),registrarServiceUrl:this._ecsProvider.getTrouterSettings().registrarServiceUrl,registrarTtlInSeconds:this._ecsProvider.getTrouterSettings().registrarTtlInSeconds,maxRegistrationTimeInMs:this._ecsProvider.getTrouterSettings().maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:this._ecsProvider.getTrouterSettings().registrarRefreshTimeoutInMs,pnhAppId:this._ecsProvider.getTrouterSettings().pnhAppId,pnhTemplate:this._ecsProvider.getTrouterSettings().pnhTemplate,platform:this._ecsProvider.getTrouterSettings().platform,platformUIVersion:this._ecsProvider.getTrouterSettings().version,trouterServiceUrl:this._ecsProvider.getTrouterSettings().trouterServiceUrl,version:this._ecsProvider.getTrouterSettings().version,trouterConnectTimeoutInMs:this._ecsProvider.getTrouterSettings().trouterConnectTimeoutInMs,productName:this._ecsProvider.getTrouterSettings().productName,sessionId:generateGuid(),environment:this._ecsProvider.getTrouterSettings().environment,timeoutOptions:this._ecsProvider.getTrouterSettings().timeoutOptions}}_createTrouterTelemetryConfig(F){return{eventLogger:new TelemetrySender(F.createChild("TrouterTelemetry"),this._telemetryLogManager),settings:{enabled:this._ecsProvider.getTrouterTelemetryConfig().enabled,logHealthCheckError:this._ecsProvider.getTrouterTelemetryConfig().logHealthCheckError,trouter_js_client_connected:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_connected,trouter_js_client_disconnected:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_disconnected,trouter_js_client_error:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_error,trouter_js_client_progress:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_progress,trouter_js_client_response:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_response,numberOfStepsToMaintain:this._ecsProvider.getTrouterTelemetryConfig().numberOfStepsToMaintain,sendProgressTimeoutSecs:this._ecsProvider.getTrouterTelemetryConfig().sendProgressTimeoutSecs}}}_getTrouterConfig(F,B){return{trouterSettings:this._getSettings(),skypeTokenProvider:B,telemetryConfig:this._createTrouterTelemetryConfig(F),registrationStateCallbackForAcsDoNotUse:F=>{this._isRegistered=F,this._initialRegistrationCompleteDefer.isPending()&&this._isRegistered?this._initialRegistrationCompleteDefer.resolve():this._isRegistered?this._logger.info("Signaling service is currently registered"):this._logger.error("Signaling service is currently not registered. Unable to receive incoming calls")}}}}class TelemetryService{constructor(F){this._eventToTenantId={skypecosi_concore_web_csa_conversation_httprequest:mt,skypecosi_concore_web_ts_calling_in_call_session:mt,skypecosi_concore_web_ts_calling_call_setup_session:mt,skypecosi_concore_native_ts_calling_in_call_session:mt,skypecosi_concore_native_ts_calling_call_setup_session:mt,skypecosi_concore_web_pluginless_call_session:mt,skypecosi_concore_web_pluginless_modality_session:mt,skypecosi_concore_web_csa_conversation_callmodality:mt,skypecosi_concore_web_ts_calling_registry:mt,mdsc_webrtc_session:vt,mdsc_webrtc_session_initial:vt,mdsc_ortc_reports:vt,mdsc_ortc_reports_initial:vt,mdsc_rt_log:vt},this.getTenant=F=>this._eventToTenantId[F]?this._eventToTenantId[F]:"",this.getCallingAdapter=()=>({sendEvent:(F,B)=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(F),name:F,properties:B})}}),this.getGenericTelemetryLogger=F=>({sendEvent:F=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(F.eventName),name:F.eventName,properties:F.props})}}),this.getMediaAdapter=()=>({sendEvent:(F,B)=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(F),name:F,properties:B})}}),this.sendEvents=F=>(F.forEach((F=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(F.eventName),name:F.eventName,properties:F.props})})),Promise.resolve()),this._telemetryLogManager=F}}var bh,Ih=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0});var G=function(){function AllowBackgroundFetchData(){this._isAllowed=!1}return AllowBackgroundFetchData.prototype.putBackgroundFetchAllowed=function(F){if(this._isAllowed=F,this.isBackgroundFetchAllowed()&&this._isAllowedDeferral){var B=this._isAllowedDeferral;this._isAllowedDeferral=void 0,B.resolve(void 0)}},AllowBackgroundFetchData.prototype.isBackgroundFetchAllowed=function(){return this._isAllowed},AllowBackgroundFetchData.prototype.waitForBackgroundFetchAllowed=function(){return this.isBackgroundFetchAllowed()?Y.Resolved():(this._isAllowedDeferral||(this._isAllowedDeferral=Y.Defer()),this._isAllowedDeferral.promise())},AllowBackgroundFetchData}();B.default=G})),Ah=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0});var G=function(){function AppActiveData(){this._isActive=!1}return AppActiveData.prototype.putAppActive=function(F){if(this._isActive=F,this.isAppActive()&&this._appActiveDeferral){var B=this._appActiveDeferral;this._appActiveDeferral=void 0,B.resolve(void 0)}},AppActiveData.prototype.isAppActive=function(){return this._isActive},AppActiveData.prototype.waitForAppActive=function(){return this.isAppActive()?Y.Resolved():(this._appActiveDeferral||(this._appActiveDeferral=Y.Defer()),this._appActiveDeferral.promise())},AppActiveData}();B.default=G})),Rh=function(){function SubscriptionToken(F,B){this._event=F,this._callback=B}return SubscriptionToken.prototype.unsubscribe=function(){this._event.unsubscribe(this._callback)},SubscriptionToken}(),Ph=function(){function SubscribableEvent(F){void 0===F&&(F=!1);var B=this;this._allowStopPropagation=F,this.fire=function(){for(var F=[],G=0;G<arguments.length;G++)F[G]=arguments[G];for(var W=B._subscribers,z=W.length-1;z>=0;z--){var K=W[z].apply(null,F);if(B._allowStopPropagation&&K)return!0}return!1},this._subscribers=[]}return SubscribableEvent.prototype.dispose=function(){this._subscribers=[]},SubscribableEvent.prototype.subscribe=function(F){return this._subscribers=this._subscribers.concat(F),new Rh(this,F)},SubscribableEvent.prototype.unsubscribe=function(F){this._subscribers=this._subscribers.filter((function(B){return B!==F}))},SubscribableEvent}(),Oh=Object.freeze({__proto__:null,SubscriptionToken:Rh,default:Ph}),Mh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0}),function(F){F[F.Default=0]="Default",F[F.User=1]="User"}(B.EcsConfigType||(B.EcsConfigType={}))})),wh=getAugmentedNamespace(Oh),Dh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0});var G=function(){function Cache(F){this._config=F,this.configUpdated=new wh.default,this._cachedConfigs={}}return Cache.prototype.initialize=function(){return this.updateConfigsToFetch()},Cache.prototype.updateConfigsToFetch=function(){var F=this,B=this._config.getConfig(),G=B.databaseInterface,W=B.configsToFetch;if(!G)return Y.Resolved();for(var z=[],_loop_1=function(B){if(K._cachedConfigs[B])return"continue";z.push(G.getData(B).then((function(G){G&&(F._cachedConfigs[B]=G)})).catch((function(){return Y.Resolved()})))},K=this,J=0,Q=W;J<Q.length;J++){_loop_1(Q[J])}return Y.all(z).then((function(){z.length>0&&F.configUpdated.fire()}))},Cache.prototype.getEcsConfig=function(){return this._cachedConfigs[Mh.EcsConfigType.User]||this._cachedConfigs[Mh.EcsConfigType.Default]},Cache.prototype.getEcsConfigByType=function(F){return this._cachedConfigs[F]},Cache.prototype.putConfig=function(F){var B=this.getEcsConfig();this._cachedConfigs[F.configType]=F;var G=this.getEcsConfig();(G&&G.configType===F.configType||B&&G&&B.configType!==G.configType)&&this.configUpdated.fire();var W=this._config.getConfig().databaseInterface;return W?W.putData(F.configType,F):Y.Resolved()},Cache}();B.default=G})),Nh=createCommonjsModule((function(F,B){var G=z&&z.__assign||function(){return G=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},G.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function Config(){}return Config.prototype.initialize=function(F){if(this._config)throw"ECS Configuration already initialized";this._config=F},Config.prototype.getConfig=function(){if(!this._config)throw"ECS Configuration not yet initialized";return this._config},Config.prototype.setConfigsToFetch=function(F){if(!this._config)throw"ECS Configuration not yet initialized";this._config=G({},this._config,{configsToFetch:F})},Config.prototype.setFetchTimeout=function(F){if(!this._config)throw"ECS Configuration not yet initialized";this._config=G({},this._config,{fetchTimeout:F})},Config}();B.default=W})),Lh=createCommonjsModule((function(F,B){var G=z&&z.__assign||function(){return G=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},G.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0}),B.assert=function(F,B){if(!F)throw new Error(B)},B.isObject=function(F){return null!==F&&"object"==typeof F},B.isString=function(F){return"string"==typeof F},B.attempt=function(F){for(var B=[],G=1;G<arguments.length;G++)B[G-1]=arguments[G];try{return F.apply(void 0,B)}catch(F){return new Error(F)}},B.remove=function(F,B){for(var G=F.length-1;G>=0;G--)F[G]===B&&F.splice(G,1)},B.clone=function(F){return Array.isArray(F)?F.map(B.clone):B.isObject(F)?Object.keys(F).reduce((function(W,z){var K;return G(G({},W),((K={})[z]=B.clone(F[z]),K))}),{}):F}})),kh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0}),B.DEFAULT_TIME_GROW_FACTOR=2.718281828459045,B.DEFAULT_TIME_JITTER=.11962656472;var G=function(){function ExponentialTime(F,G,W,z){void 0===W&&(W=B.DEFAULT_TIME_GROW_FACTOR),void 0===z&&(z=B.DEFAULT_TIME_JITTER),this._initialTime=F,this._maxTime=G,this._growFactor=W,this._jitterFactor=z,Lh.assert(this._initialTime>0,"Initial delay must be positive"),Lh.assert(this._maxTime>0,"Delay upper bound must be positive"),Lh.assert(this._growFactor>=0,"Ratio must be non-negative"),Lh.assert(this._jitterFactor>=0,"Jitter factor must be non-negative"),this.reset()}return ExponentialTime.prototype.reset=function(){this._incrementCount=0,this._currentTime=Math.round(this._initialTime*(1+Math.random()*this._jitterFactor))},ExponentialTime.prototype.getTime=function(){return this._currentTime},ExponentialTime.prototype.getIncrementCount=function(){return this._incrementCount},ExponentialTime.prototype.calculateNext=function(){var F=this._currentTime*this._growFactor;return F>this._maxTime&&(F=this._maxTime),this._jitterFactor<1e-5?this._currentTime=F:this._currentTime=Math.round(Math.random()*F*this._jitterFactor+F),this._currentTime<this._initialTime&&(this._currentTime=this._initialTime),this._currentTime>this._maxTime&&(this._currentTime=this._maxTime),this._incrementCount++,this._currentTime},ExponentialTime.prototype.getTimeAndCalculateNext=function(){var F=this.getTime();return this.calculateNext(),F},ExponentialTime}();B.ExponentialTime=G})),Fh=createCommonjsModule((function(F,B){var G,W,K,J=z&&z.__extends||(G=function(F,B){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])},G(F,B)},function(F,B){function __(){this.constructor=F}G(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),Q=z&&z.__assign||function(){return Q=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},Q.apply(this,arguments)};function isJsonContentType(F){return!!F&&0===F.indexOf("application/json")}function isFormContentType(F){return!!F&&0===F.indexOf("application/x-www-form-urlencoded")}function isFormDataContentType(F){return!!F&&0===F.indexOf("multipart/form-data")}function DefaultErrorHandler(F,B){return B.canceled||!B.statusCode||B.statusCode>=400&&B.statusCode<600?K.DoNotRetry:K.RetryCountedWithBackoff}Object.defineProperty(B,"__esModule",{value:!0}),function(F){F[F.DontCare=0]="DontCare",F[F.Low=1]="Low",F[F.Normal=2]="Normal",F[F.High=3]="High",F[F.Critical=4]="Critical"}(W=B.WebRequestPriority||(B.WebRequestPriority={})),function(F){F[F.DoNotRetry=0]="DoNotRetry",F[F.RetryUncountedImmediately=1]="RetryUncountedImmediately",F[F.RetryUncountedWithBackoff=2]="RetryUncountedWithBackoff",F[F.RetryCountedWithBackoff=3]="RetryCountedWithBackoff",F[F.PauseUntilResumed=4]="PauseUntilResumed"}(K=B.ErrorHandlingType||(B.ErrorHandlingType={})),B.DefaultOptions={priority:W.Normal},B.SimpleWebRequestOptions={MaxSimultaneousRequests:5,HungRequestCleanupIntervalMs:1e4,setTimeout:function(F,B){return setTimeout(F,B)},clearTimeout:function(F){return clearTimeout(F)}},B.DefaultErrorHandler=DefaultErrorHandler;var $,X=[],Z=[],ee=[],te=0,ne=0,ie=function(){function SimpleWebRequestBase(F,G,W,z,K){this._action=F,this._url=G,this.options=W,this._getHeaders=z,this._blockRequestUntil=K,this._aborted=!1,this._timedOut=!1,this._paused=!1,this._created=Date.now(),this._finishHandled=!1,this._retryExponentialTime=new kh.ExponentialTime(1e3,3e5),this._options=Q(Q({},B.DefaultOptions),W)}return SimpleWebRequestBase.prototype.getPriority=function(){return this._options.priority||W.DontCare},SimpleWebRequestBase.checkQueueProcessing=function(){for(var _loop_1=function(){var F=X.shift();Z.push(F),(F._blockRequestUntil&&F._blockRequestUntil()||Y.Resolved()).finally((function(){Lh.remove(Z,F)})).then((function(){ee.length<B.SimpleWebRequestOptions.MaxSimultaneousRequests&&!F._aborted?(ee.push(F),re._scheduleHungRequestCleanupIfNeeded(),F._fire()):F._enqueue()}),(function(B){F._respond("_blockRequestUntil rejected: "+B)}))};X.length>0&&ee.length<B.SimpleWebRequestOptions.MaxSimultaneousRequests;)_loop_1()},SimpleWebRequestBase._scheduleHungRequestCleanupIfNeeded=function(){ee.length>0&&void 0===$?$=B.SimpleWebRequestOptions.setTimeout(this._hungRequestCleanupTimerCallback,B.SimpleWebRequestOptions.HungRequestCleanupIntervalMs):0===ee.length&&$&&(B.SimpleWebRequestOptions.clearTimeout($),$=void 0)},SimpleWebRequestBase.prototype._removeFromQueue=function(){Lh.remove(ee,this),Lh.remove(X,this)},SimpleWebRequestBase.prototype._assertAndClean=function(F,B){F||(this._removeFromQueue(),console.error(B),Lh.assert(F,B))},SimpleWebRequestBase.prototype._fire=function(){var F=this;this._xhr=new XMLHttpRequest,this._xhrRequestHeaders={};var G=Lh.attempt((function(){F._xhr.open(F._action,F._url,!0)}));if(G)this._respond(G.toString());else{if(this._options.timeout){var W=ne;3!==W&&(this._assertAndClean(!this._requestTimeoutTimer,"Double-fired requestTimeoutTimer"),this._requestTimeoutTimer=B.SimpleWebRequestOptions.setTimeout((function(){F._requestTimeoutTimer=void 0,F._timedOut=!0,F.abort()}),this._options.timeout)),(3===W||W<=1)&&(this._xhr.timeout=this._options.timeout,this._xhr.ontimeout=function(){ne=3,3===W&&(F._timedOut=!0,F._aborted=!0,F._respond("TimedOut"))})}var z=te;3!==z?(0===z&&(te=1),this._xhr.onreadystatechange=function(){F._xhr&&(3!==F._xhr.readyState||!F._options.streamingDownloadProgress||F._aborted?4===F._xhr.readyState&&(0===z&&1===te&&B.SimpleWebRequestOptions.setTimeout((function(){3!==te&&(te=2)}),1e4),F._respond()):F._options.streamingDownloadProgress(F._xhr.responseText))}):this._options.streamingDownloadProgress&&(this._xhr.onreadystatechange=function(){F._xhr&&3===F._xhr.readyState&&F._options.streamingDownloadProgress&&!F._aborted&&F._options.streamingDownloadProgress(F._xhr.responseText)}),2!==z&&(this._xhr.onload=function(){te=3,3===z&&F._respond()},this._xhr.onerror=function(){te=3,3===z&&F._respond()}),this._xhr.onabort=function(){F._aborted=!0,F._respond("Aborted")},this._xhr.upload&&this._options.onProgress&&(this._xhr.upload.onprogress=this._options.onProgress);var K=this._options.acceptType||"json",J=this._options.customResponseType||SimpleWebRequestBase._getResponseType(K),Q=Lh.attempt((function(){F._xhr.responseType=J}));if(Q&&"json"!==J)throw Q;re._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Accept",SimpleWebRequestBase.mapContentType(K)),this._xhr.withCredentials=!!this._options.withCredentials;var Y=this.getRequestHeaders(),$={};if(Object.keys(Y).forEach((function(B){var G=Y[B],W=B.toLowerCase();"content-type"!==W?"accept"!==W?(F._assertAndClean(!$[W],"Setting duplicate header key: "+$[W]+" and "+B),null!=G?($[W]=!0,re._setRequestHeader(F._xhr,F._xhrRequestHeaders,B,G)):console.warn('Tried to set header "'+B+'" on request with "'+G+'" value, header will be dropped')):F._assertAndClean(!1,"Don't set Accept with options.headers -- use it with the options.acceptType property"):F._assertAndClean(!1,"Don't set Content-Type with options.headers -- use it with the options.contentType property")})),this._options.sendData){var X=SimpleWebRequestBase.mapContentType(this._options.contentType||"json");re._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Content-Type",X);var Z=SimpleWebRequestBase.mapBody(this._options.sendData,X);this._xhr.send(Z)}else this._xhr.send()}},SimpleWebRequestBase._setRequestHeader=function(F,B,G,W){F.setRequestHeader(G,W),B[G]=W},SimpleWebRequestBase.mapContentType=function(F){return"json"===F?"application/json":"form"===F?"application/x-www-form-urlencoded":F},SimpleWebRequestBase.mapBody=function(F,B){if(isJsonContentType(B)){if(!Lh.isString(F))return JSON.stringify(F)}else if(isFormContentType(B)){if(!Lh.isString(F)&&Lh.isObject(F)){var G=F;return Object.keys(G).map((function(F){return encodeURIComponent(F)+(G[F]?"="+encodeURIComponent(G[F].toString()):"")})).join("&")}}else if(isFormDataContentType(B)){if(Lh.isObject(F)){var W=new FormData,z=F;return Object.keys(z).forEach((function(F){return W.append(F,z[F])})),W}Lh.assert(!1,"contentType multipart/form-data must include an object as sendData")}return F},SimpleWebRequestBase.prototype.setUrl=function(F){this._url=F},SimpleWebRequestBase.prototype.setHeader=function(F,B){this._options.augmentHeaders||(this._options.augmentHeaders={}),B?this._options.augmentHeaders[F]=B:delete this._options.augmentHeaders[F]},SimpleWebRequestBase.prototype.getRequestHeaders=function(){var F={};return!this._getHeaders||this._options.overrideGetHeaders||this._options.headers||(F=Q(Q({},F),this._getHeaders())),this._options.overrideGetHeaders&&(F=Q(Q({},F),this._options.overrideGetHeaders)),this._options.headers&&(F=Q(Q({},F),this._options.headers)),this._options.augmentHeaders&&(F=Q(Q({},F),this._options.augmentHeaders)),F},SimpleWebRequestBase.prototype.getOptions=function(){return Lh.clone(this._options)},SimpleWebRequestBase.prototype.setPriority=function(F){this._options.priority!==F&&(this._options.priority=F,this._paused||this._xhr||(Lh.remove(X,this),this._enqueue()))},SimpleWebRequestBase.prototype.resumeRetrying=function(){this._paused?(this._paused=!1,this._enqueue()):Lh.assert(!1,"resumeRetrying() called but not paused!")},SimpleWebRequestBase.prototype._enqueue=function(){var F=this;if(!this._aborted&&!(ee.indexOf(this)>=0||Z.indexOf(this)>=0||X.indexOf(this)>=0)){var B=X.findIndex((function(B){return B.getPriority()===F.getPriority()&&B._created>F._created||B.getPriority()<F.getPriority()}));B>-1?X.splice(B,0,this):X.push(this),SimpleWebRequestBase.checkQueueProcessing()}},SimpleWebRequestBase._getResponseType=function(F){return"blob"===F?"arraybuffer":"text/xml"===F||"application/xml"===F?"document":"text/plain"===F?"text":"json"},SimpleWebRequestBase._hungRequestCleanupTimerCallback=function(){$=void 0,ee.filter((function(F){return!(!F._xhr||4!==F._xhr.readyState)&&(console.warn("SimpleWebRequests found a completed XHR that hasn't invoked it's callback functions, manually responding"),!0)})).forEach((function(F){F._respond()})),re._scheduleHungRequestCleanupIfNeeded()},SimpleWebRequestBase}();B.SimpleWebRequestBase=ie;var re=function(F){function SimpleWebRequest(B,G,W,z,K){return F.call(this,B,G,W,z,K)||this}return J(SimpleWebRequest,F),SimpleWebRequest.prototype.abort=function(){this._aborted?Lh.assert(!1,"Already aborted "+this._action+" request to "+this._url):(this._aborted=!0,this._retryTimer&&(B.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(B.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._deferred?(this._respond("Aborted"),this._xhr&&this._xhr.abort()):Lh.assert(!1,"Haven't even fired start() yet -- can't abort"))},SimpleWebRequest.prototype.start=function(){var F=this;return this._deferred?(Lh.assert(!1,"WebRequest already started"),Y.Rejected("WebRequest already started")):(this._deferred=Y.Defer(),this._deferred.onCancel((function(){F.abort()})),this._enqueue(),this._deferred.promise())},SimpleWebRequest.prototype._respond=function(F){var G=this;if(!this._finishHandled){this._finishHandled=!0,this._removeFromQueue(),this._retryTimer&&(B.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(B.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0);var W,z=0;if(this._xhr)try{z=this._xhr.status,W=this._xhr.statusText||F}catch(F){}else W=F||"Browser Error - Possible CORS or Connectivity Issue";var J,Q,Y={};if(this._xhr){if((this._xhr.getAllResponseHeaders()||"").split(/\r?\n/).forEach((function(F){if(0!==F.length){var B=F.indexOf(":");-1===B?Y[F]="":Y[F.substr(0,B).toLowerCase()]=F.substr(B+1).trim()}})),!Y["content-type"]){var $=this._xhr.getResponseHeader("content-type");$&&(Y["content-type"]=$)}if(J=this._xhr.response,Y["content-type"]&&isJsonContentType(Y["content-type"])&&(!J||!Lh.isObject(J))&&("text"===this._xhr.responseType||""===this._xhr.responseType)&&this._xhr.responseText)try{J=JSON.parse(this._xhr.responseText)}catch(F){Q=F,console.warn("Failed to parse XHR JSON response")}}if(this._xhr&&4===this._xhr.readyState&&(z>=200&&z<300||304===z)){var X={url:this._xhr.responseURL||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:z,statusText:W,headers:Y,body:J,responseParsingException:Q};this._deferred.resolve(X)}else{var Z={url:(this._xhr?this._xhr.responseURL:void 0)||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:z,statusText:W,headers:Y,body:J,canceled:this._aborted,timedOut:this._timedOut,responseParsingException:Q};this._options.augmentErrorResponse&&this._options.augmentErrorResponse(Z);var ee=this._options.customErrorHandler?this._options.customErrorHandler(this,Z):DefaultErrorHandler(this,Z);ee!==K.DoNotRetry&&(this._options.retries&&this._options.retries>0||ee===K.PauseUntilResumed||ee===K.RetryUncountedImmediately||ee===K.RetryUncountedWithBackoff)?(ee===K.RetryCountedWithBackoff&&this._options.retries--,this._requestTimeoutTimer&&(B.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._aborted=!1,this._timedOut=!1,this._finishHandled=!1,this._xhr&&(this._xhr.onabort=null,this._xhr.onerror=null,this._xhr.onload=null,this._xhr.onprogress=null,this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=void 0,this._xhrRequestHeaders=void 0),ee===K.PauseUntilResumed?this._paused=!0:ee===K.RetryUncountedImmediately?this._enqueue():this._retryTimer=B.SimpleWebRequestOptions.setTimeout((function(){G._retryTimer=void 0,G._enqueue()}),this._retryExponentialTime.getTimeAndCalculateNext())):this._deferred.reject(Z)}ie.checkQueueProcessing()}},SimpleWebRequest}(ie);B.SimpleWebRequest=re})),xh=createCommonjsModule((function(F,B){var G=z&&z.__assign||function(){return G=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},G.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0});var W=function(){function GenericRestClient(F){this._defaultOptions={excludeEndpointUrl:!1,withCredentials:!1,retries:0},this._endpointUrl=F}return GenericRestClient.prototype._performApiCall=function(F,B,W,z){var K=this;void 0===z&&(z={});var J=G(G({},this._defaultOptions),z);W&&(J.sendData=W),J.eTag&&(J.augmentHeaders||(J.augmentHeaders={}),J.augmentHeaders["If-None-Match"]=J.eTag),J.contentType||(J.contentType=Lh.isString(J.sendData)?"form":"json");var Q=J.excludeEndpointUrl?F:this._endpointUrl+F;return new Fh.SimpleWebRequest(B,Q,J,(function(){return K._getHeaders(J)}),(function(){return K._blockRequestUntil(J)})).start().then((function(F){return K._processSuccessResponse(F),F}))},GenericRestClient.prototype._getHeaders=function(F){return{}},GenericRestClient.prototype._blockRequestUntil=function(F){},GenericRestClient.prototype._processSuccessResponse=function(F){},GenericRestClient.prototype.performApiGet=function(F,B){return this.performApiGetDetailed(F,B).then((function(F){return F.body}))},GenericRestClient.prototype.performApiGetDetailed=function(F,B){return this._performApiCall(F,"GET",void 0,B)},GenericRestClient.prototype.performApiPost=function(F,B,G){return this.performApiPostDetailed(F,B,G).then((function(F){return F.body}))},GenericRestClient.prototype.performApiPostDetailed=function(F,B,G){return this._performApiCall(F,"POST",B,G)},GenericRestClient.prototype.performApiPatch=function(F,B,G){return this.performApiPatchDetailed(F,B,G).then((function(F){return F.body}))},GenericRestClient.prototype.performApiPatchDetailed=function(F,B,G){return this._performApiCall(F,"PATCH",B,G)},GenericRestClient.prototype.performApiPut=function(F,B,G){return this.performApiPutDetailed(F,B,G).then((function(F){return F.body}))},GenericRestClient.prototype.performApiPutDetailed=function(F,B,G){return this._performApiCall(F,"PUT",B,G)},GenericRestClient.prototype.performApiDelete=function(F,B,G){return this.performApiDeleteDetailed(F,B,G).then((function(F){return F.body}))},GenericRestClient.prototype.performApiDeleteDetailed=function(F,B,G){return this._performApiCall(F,"DELETE",B,G)},GenericRestClient}();B.GenericRestClient=W})),Uh=createCommonjsModule((function(F,B){function __export(F){for(var G in F)B.hasOwnProperty(G)||(B[G]=F[G])}Object.defineProperty(B,"__esModule",{value:!0}),__export(kh),__export(xh),__export(Fh)})),jh=Uh,Bh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0});var G=function(){function TelemetryEventBase(){}return TelemetryEventBase.prototype.getAttributes=function(){return{Source:"ecs_client"}},TelemetryEventBase}();B.TelemetryEventBase=G})),Hh=createCommonjsModule((function(F,B){var G,W=z&&z.__extends||(G=function(F,B){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])},G(F,B)},function(F,B){function __(){this.constructor=F}G(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)});Object.defineProperty(B,"__esModule",{value:!0});var K=function(F){function EcsConfigFetchResponse(B,G,W,z,K,J,Q,Y,$,X,Z,ee,te){var ne=F.call(this)||this;return ne._responseTime=B,ne._responseCode=G,ne._fetchAttempts=W,ne._hasValidToken=z,ne._serverEndpoint=K,ne._etag=J,ne._fetchDurationValid=Q,ne._cacheAvailable=Y,ne._responseSize=$,ne._configAge=X,ne._configExpired=Z,ne._fetchStart=ee,ne._fetchEnd=te,ne}return W(EcsConfigFetchResponse,F),EcsConfigFetchResponse.prototype.getEventName=function(){return"ecs_tsclient_fetch_config"},EcsConfigFetchResponse.prototype.getAttributes=function(){var B=F.prototype.getAttributes.call(this);return B.fetch_delay_ms=this._responseTime,B.fetch_response_code=this._responseCode,B.fetch_attempts=this._fetchAttempts,B.authenticated_user=this._hasValidToken,B.url=this._serverEndpoint,B.fetched_etag=this._etag,B.fetch_duration_valid=this._fetchDurationValid,B.cache_available=this._cacheAvailable,B.response_size=this._responseSize,B.config_age=this._configAge,B.config_expired=this._configExpired,B.fetch_start=this._fetchStart,B.fetch_end=this._fetchEnd,B},EcsConfigFetchResponse}(Bh.TelemetryEventBase);B.EcsConfigFetchResponse=K})),Vh=createCommonjsModule((function(F,B){var G,W=z&&z.__extends||(G=function(F,B){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,B){F.__proto__=B}||function(F,B){for(var G in B)B.hasOwnProperty(G)&&(F[G]=B[G])},G(F,B)},function(F,B){function __(){this.constructor=F}G(F,B),F.prototype=null===B?Object.create(B):(__.prototype=B.prototype,new __)}),K=z&&z.__assign||function(){return K=Object.assign||function(F){for(var B,G=1,W=arguments.length;G<W;G++)for(var z in B=arguments[G])Object.prototype.hasOwnProperty.call(B,z)&&(F[z]=B[z]);return F},K.apply(this,arguments)};Object.defineProperty(B,"__esModule",{value:!0});var J,Q,$=1728e5,X=18e5,Z=31536e6,ee=3e4,te=function(F){function EcsFetcher(B,G,W,z,K,J,Q,Y){var $=F.call(this,B)||this;if($._config=G,$._skypeTokenData=W,$._appActiveData=z,$._allowBackgroundFetchData=K,$._etag=J,$._getUserConfig=Q,$._apiPath="/config/v1/"+$._config.getConfig().clientName+"/"+$._config.getConfig().clientVersion,Y){var X=Object.keys(Y).map((function(F){return encodeURIComponent(F)+"="+encodeURIComponent(Y[F].toString())}));X&&($._apiPath+="?"+X.join("&"))}return $}return W(EcsFetcher,F),EcsFetcher.prototype._blockRequestUntil=function(F){var B=this;if(this._getUserConfig&&!this._skypeTokenData.isSkypeTokenValid()&&console.log("ECS - Delaying User config fetch until we have a valid SkypeToken"),!this._appActiveData.isAppActive()&&!this._allowBackgroundFetchData.isBackgroundFetchAllowed()){var G=this._getUserConfig?"User config":"config";console.log("ECS - Delaying "+G+" fetch until the app is active (or background fetch is allowed)")}return Y.race([this._appActiveData.waitForAppActive(),this._allowBackgroundFetchData.waitForBackgroundFetchAllowed()]).then((function(){if(B._getUserConfig)return B._skypeTokenData.waitForValidSkypeToken()})).then((function(){Q=Date.now()}))},EcsFetcher.prototype._getHeaders=function(){var F={};return this._etag&&(F["If-None-Match"]=this._etag),this._getUserConfig&&(F.Authorization=this._skypeTokenData.getSkypeToken()),F},EcsFetcher.prototype.getConfig=function(){var B=this._config.getConfig().fetchTimeout;return void 0!==B&&(B<0?B=0:B>0&&B<ee&&(B=ee)),F.prototype.performApiGetDetailed.call(this,this._apiPath,{timeout:B})},EcsFetcher}(jh.GenericRestClient),ne=function(){function EcsClient(F,B,G,W,z){this._config=F,this._skypeTokenData=B,this._appActiveData=G,this._allowBackgroundFetchData=W,this._telemetryManager=z,this._ecsFailureBackoffTimer=new jh.ExponentialTime(1e3,3e5),this._cacheMaxAgeRegex=/.*max-age=(\d+).*/gi,this._serverIndex=NaN}return EcsClient.prototype.getConfig=function(F,B,G){var W=this,z=this._config.getConfig().hosts;if((isNaN(this._serverIndex)||this._serverIndex>z.length-1)&&(this._serverIndex=Math.floor(Math.random()*z.length)),!z||!z.length)return Y.Rejected(new Error("no configuration service endpoint"));var $=Y.Defer(),X=0,callConfigServer=function(){var ee=F&&F.eTag?F.eTag:void 0,ne=new te(z[W._serverIndex],W._config,W._skypeTokenData,W._appActiveData,W._allowBackgroundFetchData,ee,B,G);X++,ne.getConfig().then((function(G){var te=G.headers.etag,ne=G.headers.expires;if(G.body&&G.body.Headers&&(te||(te=G.body.Headers.ETag),ne||(ne=G.body.Headers.Expires)),J=Date.now(),!te||!ne)return console.warn("ECS - Service returned an empty ETag or Expiration header: "+JSON.stringify(G)),Y.Rejected();var ie,re=new Date(W._calculateExpirationDate(G.headers)).getTime();if(304===G.statusCode&&F)(ie=K({},F)).eTag=te,ie.expiration=re,ie.cacheUpdateTime=J,ie.lastFetchTokenHash=W._skypeTokenData.getSkypeTokenHash(G.requestHeaders.Authorization);else{if("object"!=typeof G.body)return console.warn("ECS - Service returned invalid response "+JSON.stringify(G)),Y.Rejected();ie={config:G.body,configType:B?Mh.EcsConfigType.User:Mh.EcsConfigType.Default,eTag:te,expiration:re,cacheUpdateTime:Q,lastFetchTokenHash:W._skypeTokenData.getSkypeTokenHash(G.requestHeaders.Authorization),appVersion:W._config.getConfig().clientVersion}}var oe=J-Q,ae=!(oe<0||oe>Z),se=F?Date.now()-F.cacheUpdateTime:0;W._telemetryManager.sendTelemetryEvent(new Hh.EcsConfigFetchResponse(oe,G.statusCode,X,W._skypeTokenData.isSkypeTokenValid(),z[W._serverIndex],te,ae,!!ee,JSON.stringify(G).length,se,!(F&&F.expiration-Date.now()>0),Q,J)),W._ecsFailureBackoffTimer.reset(),$.resolve(ie)})).catch((function(){W._serverIndex=(W._serverIndex+1)%z.length,setTimeout((function(){callConfigServer()}),W._ecsFailureBackoffTimer.getTimeAndCalculateNext())}))};return callConfigServer(),$.promise()},EcsClient.prototype._calculateExpirationDate=function(F){var B=Date.now()+$;if(F.date&&F.expires){var G=new Date(F.date).getTime(),W=Date.now()-G,z=new Date(F.expires).getTime();return isNaN(z)?B:Math.min(B,z+W)}var K=this._cacheMaxAgeRegex.exec(F["cache-control"]);return this._cacheMaxAgeRegex.lastIndex=0,K&&2===K.length?Math.min(B,Date.now()+1e3*Number(K[1])):Date.now()+X},EcsClient}();B.default=ne})),Gh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0});var G=function(){function Scheduler(F,B,G,W,z,K){var J=this;this._config=F,this._skypeTokenData=B,this._cache=G,this._isFetchingSettings={},this._pendingFetch={},this._paused=!1,this._fetchEcsSettingsIfNeeded=function(F){var B=J._config.getConfig(),G=J._cache.getEcsConfigByType(F);if(-1!==B.configsToFetch.indexOf(F)&&!J._isFetchingSettings[F])if(G||!J._pendingFetch[F]){var W=G?G.expiration-Date.now():-1;W<=0||G&&F===Mh.EcsConfigType.User&&J._skypeTokenData.isSkypeTokenValid()&&G.lastFetchTokenHash!==J._skypeTokenData.getSkypeTokenHash(J._skypeTokenData.getSkypeToken())?J._fetchSkypeEcsSettings(F):setTimeout((function(){return J._fetchEcsSettingsIfNeeded(F)}),W)}else J._fetchSkypeEcsSettings(F)},this._fetchSkypeEcsSettings=function(F,B){(void 0===B&&(B=!1),J._isFetchingSettings[F]||J._paused&&!B)?J._pendingFetch[F]=!0:(J._pendingFetch[F]=!1,J._isFetchingSettings[F]=!0,J._config.getConfig().getEcsParameters().catch((function(){return console.warn("ECS - Failed to fetch ECS fetching parameters"),{}})).then((function(B){return J._ecsClient.getConfig(J._cache.getEcsConfig(),F===Mh.EcsConfigType.User,B)})).then((function(B){console.log("ECS - Config fetch complete"),J._isFetchingSettings[F]=!1,J._cache.putConfig(B),J._fetchEcsSettingsIfNeeded(F)})))},this._ecsClient=new Vh.default(this._config,this._skypeTokenData,W,z,K)}return Scheduler.prototype.initialize=function(){var F=this;this.updateConfigsToFetch(),this._skypeTokenData.skypeTokenChanged.subscribe((function(){return F._fetchEcsSettingsIfNeeded(Mh.EcsConfigType.User)}))},Scheduler.prototype.updateConfigsToFetch=function(){for(var F=this._config.getConfig(),B=0,G=F.configsToFetch;B<G.length;B++){(K=G[B])in this._isFetchingSettings||(this._isFetchingSettings[K]=!1),K in this._isFetchingSettings||(this._pendingFetch[K]=!1)}for(var W=0,z=F.configsToFetch;W<z.length;W++){var K=z[W],J=this._cache.getEcsConfigByType(K);!J||J.appVersion&&J.appVersion!==F.clientVersion?this._fetchSkypeEcsSettings(K,!0):this._fetchEcsSettingsIfNeeded(K)}},Scheduler.prototype.requestUpdate=function(){for(var F=0,B=this._config.getConfig().configsToFetch;F<B.length;F++){var G=B[F];this._fetchSkypeEcsSettings(G)}},Scheduler.prototype.pause=function(){this._paused=!0},Scheduler.prototype.resume=function(){this._paused=!1;for(var F=0,B=this._config.getConfig().configsToFetch;F<B.length;F++){var G=B[F];this._fetchEcsSettingsIfNeeded(G)}},Scheduler}();B.default=G})),Wh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0});var G=function(){function SkypeTokenData(){this.skypeTokenChanged=new wh.default}return SkypeTokenData.prototype.putSkypeTokenData=function(F){if(this._data=F,this.isSkypeTokenValid()&&this.skypeTokenChanged.fire(),this.isSkypeTokenValid()&&this._validSkypeTokenDeferral){var B=this._validSkypeTokenDeferral;this._validSkypeTokenDeferral=void 0,B.resolve(void 0)}},SkypeTokenData.prototype.isSkypeTokenValid=function(){var F=this._data;return!!F&&!!F.skypeToken&&F.skypeTokenExpiration>Date.now()},SkypeTokenData.prototype.getSkypeToken=function(){var F=this._data;if(!F||!F.skypeToken)throw"No Skype Token provided";return F.skypeToken},SkypeTokenData.prototype.getSkypeTokenHash=function(F){return void 0===F?0:F.split("").reduce((function(F,B){return(101*F+B.charCodeAt(0))%999727999}),F.length)},SkypeTokenData.prototype.waitForValidSkypeToken=function(){return this.isSkypeTokenValid()?Y.Resolved():(this._validSkypeTokenDeferral||(this._validSkypeTokenDeferral=Y.Defer()),this._validSkypeTokenDeferral.promise())},SkypeTokenData}();B.default=G})),qh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0});var G=function(){function TelemetryManager(F){this._cache=F,this.telemetryEventAdded=new wh.default}return TelemetryManager.prototype.sendTelemetryEvent=function(F){var B=F.getEventName(),G=F.getAttributes(),W=!1,z=this._cache.getEcsConfig();if(z&&TelemetryManager._containsEcsClientTelemetryConfig(z.config)){var K=z.config.ECSCONFIG;K&&K.ecsClientTelemetry&&(W=!!K.ecsClientTelemetry[B])}W&&this.telemetryEventAdded.fire(B,G)},TelemetryManager._containsEcsClientTelemetryConfig=function(F){return!!F&&!!F.ECSCONFIG&&!!F.ECSCONFIG.ecsClientTelemetry},TelemetryManager}();B.default=G})),zh=createCommonjsModule((function(F,B){Object.defineProperty(B,"__esModule",{value:!0}),B.Models=Mh;var G=function(){function EcsClient(){this._allowBackgroundFetchData=new Ih.default,this._appActiveData=new Ah.default,this._config=new Nh.default,this._cache=new Dh.default(this._config),this._skypeTokenData=new Wh.default,this._telemetryManager=new qh.default(this._cache),this._scheduler=new Gh.default(this._config,this._skypeTokenData,this._cache,this._appActiveData,this._allowBackgroundFetchData,this._telemetryManager),this.telemetryEventAdded=this._telemetryManager.telemetryEventAdded,this.configUpdated=this._cache.configUpdated}return EcsClient.prototype.initialize=function(F){var B=this;return this._config.initialize(F),this._skypeTokenData.putSkypeTokenData(F.initialSkypeTokenData),this._appActiveData.putAppActive(F.initialAppActiveState),this._cache.initialize().then((function(){B._scheduler.initialize()}))},EcsClient.prototype.getConfig=function(){return this._cache.getEcsConfig()},EcsClient.prototype.getConfigType=function(){var F=this._cache.getEcsConfig();if(F)return F.configType},EcsClient.prototype.requestUpdate=function(){this._scheduler.requestUpdate()},EcsClient.prototype.pause=function(){this._scheduler.pause()},EcsClient.prototype.resume=function(){this._scheduler.resume()},EcsClient.prototype.setAllowBackgroundFetch=function(F){this._allowBackgroundFetchData.putBackgroundFetchAllowed(F)},EcsClient.prototype.useSkypeToken=function(F,B){this._skypeTokenData.putSkypeTokenData({skypeToken:F,skypeTokenExpiration:B})},EcsClient.prototype.setAppActive=function(F){this._appActiveData.putAppActive(F)},EcsClient.prototype.setConfigsToFetch=function(F){var B=this;return this._config.setConfigsToFetch(F),this._cache.updateConfigsToFetch().then((function(){B._scheduler.updateConfigsToFetch()}))},EcsClient.prototype.setFetchTimeout=function(F){this._config.setFetchTimeout(F)},EcsClient}();B.default=G})),Kh=getDefaultExportFromCjs(zh);!function(F){F[F.Default=0]="Default",F[F.User=1]="User"}(bh||(bh={}));class EcsSkypeToken{constructor(F,B){this.skypeToken=F,this.skypeTokenExpiration=B}}class EcsConfigFetcher{constructor(F,B){this._logger=F,this._ecsClient=B||new Kh,this._isSubscribed=this._initialized=!1}subscribeEcsConfig(F){return F.configType!==bh.Default&&F.configType!==bh.User?Promise.reject(Fe):(this._resetConfigCache(F),this._initialized||this._isSubscribed?Promise.reject(Ue):Promise.resolve(this._initializeEcsConfig(F).then((()=>{this._ecsClient.configUpdated.subscribe((()=>{this._isSubscribed=!0,this._config=this._ecsClient.getConfig(),void 0!==F.ecsConfigReceiver&&this._config&&F.ecsConfigReceiver(this._config.config)}))})).catch((F=>{this._logger.warn("Failed to initialize ECS config because: "+F)}))))}setConfigsToFetch(F){return this._ecsClient.setConfigsToFetch(F)}dispose(){try{this._ecsClient.configUpdated.dispose()}catch(F){this._logger.warn(`Failed to dispose ECS config update, e=${F}`)}}getConfigType(){if(void 0!==this._configDefCache)return this._ecsClient.getConfigType()}getETag(){return void 0===this._config?"":this._config.eTag}getConfigId(F){return void 0===this._config?Promise.reject(xe):Promise.resolve(this._config.config[ke][F])}setAllowBackgroundFetch(F){return this._ecsClient.setAllowBackgroundFetch(F),Promise.resolve()}setSkypeToken(F,B){return this._ecsClient.useSkypeToken(F,B),Promise.resolve()}setAppActiveState(F){return this._ecsClient.setAppActive(F),Promise.resolve()}_resetConfigCache(F){void 0===F||void 0===this._configDefCache||F.queryParameters===this._configDefCache.queryParameters&&F.configType===this._configDefCache.configType||(this._isSubscribed=!1,this._initialized=!1,this._config=void 0),this._configDefCache=F}_initializeEcsConfig(F){this._initialized=!0;const B={hosts:F.ecsHosts?F.ecsHosts:this._getHostUrls(F.caConfigBag),clientName:Le,clientVersion:this._getClientVersion(F.platformId),configsToFetch:this._getLibConfigType(F.configType),getEcsParameters:()=>this._getQueryParameterPromise(F.queryParameters),initialAppActiveState:F.isAppInitiallyInForeground,initialSkypeTokenData:new EcsSkypeToken(F.userRawSkypeToken,F.userSkypeTokenExpiration)};return new Promise(((F,G)=>{this._ecsClient.initialize(B).then(F,G)}))}_getHostUrls(F){if(!F)return[qe.Public_EcsServer_Url];if(F.identityType===Ke.Enterprise)return[qe.Enterprise_Ecs_ServerUrl];switch(F.cloudType){case Be.Public:return[qe.Public_EcsServer_Url];case Be.Dod:return[qe.Dod_EcsServer_Url];case Be.GccHigh:return[qe.GccHigh_EcsServer_Url];case Be.AirGap08:return[qe.AirGap08_EcsServer_Url];case Be.AirGap09:return[qe.AirGap09_EcsServer_Url];default:return[qe.Public_EcsServer_Url]}}_getClientVersion(F){let B="";return B+=F||getPlatformId(),B+="_",B+=getSdkInternalVersion(),B}_getLibConfigType(F){return[F===bh.Default?zh.Models.EcsConfigType.Default:zh.Models.EcsConfigType.User]}_getQueryParameterPromise(F={}){return Y.Resolved(F)}}class EcsConfigObj{constructor(F,B,G,W,z,K=!0,J,Q,Y,$){this.configType=F,this.caConfigBag=B,this.queryParameters=G,this.ecsConfigReceiver=W,this.platformId=z,this.isAppInitiallyInForeground=K,this.userRawSkypeToken=J,this.userSkypeTokenExpiration=Q,this.projectName=Y,this.ecsHosts=$}}var __decorate$d=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$d=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$m=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class CallStack{constructor(F,B,G,W){if(this._ECS_FETCH_TYPE_USER="User",this._ECS_FETCH_TYPE_DEFAULT="Default",this._disposed=!1,this.clientId=B,this._sdkUserAgent=W,this.logger=F.createChild("CallStack"),this._telemetryLogManager=G,"https:"!==location.protocol&&"file:"!==location.protocol&&"localhost"!==location.hostname)throw new CallingCommunicationError({message:"ACS Web Calling SDK must be used through https, file:, or localhost",code:ne});const z=getBrowserInfo();if("chrome"!==z.name&&"chromium"!==z.name&&"edgeanaheim"!==z.name&&"safari"!==z.name)throw new CallingCommunicationError({message:Ne.BrowserNotSupported,code:ae});this._telemetryService=new TelemetryService(this._telemetryLogManager),this._ecsProvider=new EcsProvider(this.logger,this._sdkUserAgent),this._ecsFetcher=new EcsConfigFetcher(this.logger)}getClientId(){return this.clientId}getTrouterState(){var F;const B=null===(F=null==this?void 0:this._trouterService)||void 0===F?void 0:F.state();let G="Uninitialized";if(void 0!==B)switch(B){case 0:G="Unknown";break;case 2:G="Connected";break;case 3:G="Disconnected";break;case 9:G="Switching";break;default:G=B.toString()}return G}createStackBase(F){return __awaiter$m(this,void 0,void 0,(function*(){if(this._createStackBaseWaitPromise)return this._createStackBaseWaitPromise;const B=new Promise(((B,G)=>__awaiter$m(this,void 0,void 0,(function*(){try{const G=this._getBaseStackConfig();this._tsStack=yield te.pluginlessStackFactory.buildBaseStack(G),yield this.initializeEcsBase(F),B(this._tsStack)}catch(F){G(F)}}))));try{this._createStackBaseWaitPromise=wait((()=>B),Ze);const F=yield this._createStackBaseWaitPromise;return this.logger.log("Base stack init success"),F}catch(F){throw yield this.dispose(),F.code===se?new CallingCommunicationError({message:"Failed to create stack base due to timeout during initialization",code:se}):new CallingCommunicationError({message:"Failed to create stack base due to failure in intialization",code:ue},F)}}))}initializeStackForUser(F,B){return __awaiter$m(this,void 0,void 0,(function*(){if(this.caConfigBag=B,this._initializeStackForUserWaitPromise)return this._initializeStackForUserWaitPromise;this._tsStack=yield this.createStackBase(B),this._disposed=!1;const G=new Promise(((G,W)=>__awaiter$m(this,void 0,void 0,(function*(){try{this._tsStack?(this._telemetryService=new TelemetryService(this._telemetryLogManager),this._ecsProvider=new EcsProvider(this.logger,this._sdkUserAgent),this._ecsFetcher=new EcsConfigFetcher(this.logger),yield this.initializeEcsBase(B),yield this.initializeEcsForUser(F),getAcsEcsConfig().calling.doNotWaitForTrouter?this._initTrouter(F).catch((()=>{this.logger.warn("Signaling failed to initialize")})):yield this._initTrouter(F),this.logger.log("Trouter initialized successfully"),yield this._tsStack.initializeMediaAgent({httpRequestDispatcher:new te.HttpRequestDispatcherImplementation,tokenProvider:F,configProvider:{getSkypeConfig:()=>Promise.resolve({}),getRelayConfig:()=>{const F=this._ecsProvider.getMdnTrapSettings();return Promise.resolve(F)}},appStateProvider:this._getAppStateProvider(),clientInformation:this._ecsProvider.getJsCsaConfig().clientInformation}),yield this._tsStack.initializeSignalingAgentProvider({signalingAgentConfig:this._getSignalingConfig(F),trouterService:this._trouterService}),yield this._tsStack.init(),G(this._tsStack)):(this.logger.error("Base stack failed to create"),W(new CallingCommunicationError({message:"Base stack failed to create",code:ue})))}catch(F){W(F)}}))));try{this._initializeStackForUserWaitPromise=wait((()=>G),et);const F=yield this._initializeStackForUserWaitPromise;return this.sendStackInitEvent(!0),this.logger.log("User stack init success"),F}catch(F){throw yield this.dispose(),F.code===se?(this.sendStackInitEvent(!1,"User stack init timeout",F),new CallingCommunicationError({message:"User stack init timeout",code:se})):(this.sendStackInitEvent(!1,"User stack init failed",F),new CallingCommunicationError({message:"User stack init failed",code:ue},F))}}))}initializeEcsBase(F){return __awaiter$m(this,void 0,void 0,(function*(){const B=defer(),G=this.getEcsQueryParameters(F),W=new EcsConfigObj(bh.Default,F,G,(G=>{var W,z;if((null===(W=null==G?void 0:G.Headers)||void 0===W?void 0:W.CountryCode)&&this.updateEmergencyCallCountry(null===(z=null==G?void 0:G.Headers)||void 0===z?void 0:z.CountryCode),B.resolve(),this._ecsFetcher.getConfigType()===bh.User&&this._ecsSetupCompleteForUser.resolve(),this._ecsFetcher&&this._tsStack&&void 0!==G){let B;try{setAcsEcsConfig(G,this._telemetryLogManager),this._ecsProvider.setConfig(F,G),setMediaConfig(this._ecsProvider.getJamaSettings()),B=JSON.stringify(G),this._tsStack.getEcsProvider().setEcsConfig({ecsBlob:B,userIdentity:"",etag:this._ecsFetcher.getETag()})}catch(F){this.logger.error("Unable to parse configuration")}}}),getPlatformId());yield this._ecsFetcher.subscribeEcsConfig(W);const z=generateGuid(),K=F?this._ECS_FETCH_TYPE_USER:this._ECS_FETCH_TYPE_DEFAULT,J=+new Date;try{this.sendEcsSettingsFetchedDataEvent(Mu.acs_calling_config_fetched_attempt,{attemptTimestamp:J},K,z);const F=wait((()=>B.promise),St);yield F;const G=+new Date;this.sendEcsSettingsFetchedDataEvent(Mu.acs_calling_config_fetched_success,{deltaTimeInMs:G-J},K,z)}catch(B){const G=+new Date;this.sendEcsSettingsFetchedDataEvent(Mu.acs_calling_config_fetched_failure,{deltaTimeInMs:G-J},K,z,B),this.logger.warn("Failed to fetch base settings. Stack will initialize without default settings",B),this._ecsProvider.setConfig(F,void 0)}}))}initializeEcsForUser(F){return __awaiter$m(this,void 0,void 0,(function*(){const B=yield F();this._ecsSetupCompleteForUser=defer();try{yield this._ecsFetcher.setConfigsToFetch([bh.User]),yield this._ecsFetcher.setSkypeToken(B,1e3*parseJWT(B).exp)}catch(F){throw this.logger.error("Unable to set skype token for user ecs config"),new CallingCommunicationError({message:"Failed to set configuration for stack",code:ue})}const G=generateGuid(),W=this.caConfigBag?"User":"Default",z=+new Date;try{this.sendEcsSettingsFetchedDataEvent(Mu.acs_calling_config_fetched_attempt,{attemptTimestamp:z},W,G);const F=wait((()=>this._ecsSetupCompleteForUser.promise),St);yield F;const B=+new Date;this.sendEcsSettingsFetchedDataEvent(Mu.acs_calling_config_fetched_success,{deltaTimeInMs:B-z},W,G)}catch(F){const B=+new Date;this.sendEcsSettingsFetchedDataEvent(Mu.acs_calling_config_fetched_failure,{deltaTimeInMs:B-z},W,G,F),this.logger.warn("Failed to fetch user settings. Stack will initialize without user settings",F)}}))}getDeviceManager(){return __awaiter$m(this,void 0,void 0,(function*(){if(!this._createStackBaseWaitPromise)throw new CallingCommunicationError({message:"Failed to get device manager due to internal call stack undefined",code:ue});return(yield this._createStackBaseWaitPromise).getDeviceManager()}))}dispose(F){return __awaiter$m(this,void 0,void 0,(function*(){if(!this._disposed){if(this._disposed=!0,this._trouterService)try{this._trouterService.clearMessageHandlers(),this._trouterService.stop(F),this._trouterService=void 0}catch(F){this.logger.error("Failed to dispose signaling")}if(this._tsStack)try{yield this._tsStack.dispose(),this._tsStack=void 0}catch(F){this.logger.error("Failed to dispose calling stack")}this._ecsFetcher.dispose(),this._createStackBaseWaitPromise=void 0,this._initializeStackForUserWaitPromise=void 0,this._tsStack=void 0,this.logger.info("Calling stack disposed")}}))}getEcsQueryParameters(F){const B={};try{B.CLRelease=te.getVersion();const G=getBrowserInfo();B.BrowserName=G.name,B.BrowserEngine=G.engine,B.BrowserVersion=G.version,B.FormFactor=G.formFactor,B.IdentityType=Ke.Consumer,B.Cloud=Be.Public,B.OSVer=`${getOS()}-${getOSVersion()}`,F&&(B.Cloud=F.cloudType,B.IdentityType=F.identityType);const W="_TS_BUILC_VERSION_".replace("C","D");B.CLRelease===W?B.CLRelease="9999.99":B.CLRelease.match(/^\d+\.\d+\.\d+\.\d+$/)||delete B.CLRelease}catch(F){throw this.logger.error(F),new CallingCommunicationError({message:"Failed to initialize callclient",code:ue},F)}return B}sendEcsSettingsFetchedDataEvent(F,B,G,W,z){let K="string"==typeof(null==z?void 0:z.message)?null==z?void 0:z.message:void 0;F!==Mu.acs_calling_config_fetched_failure&&(K=void 0),this._telemetryLogManager.sendEvent({name:F,tenant:ft,properties:Object.assign(Object.assign({},B),{ecsFetchType:G,correlationId:W,failureReason:K})})}updateEmergencyCallCountry(F){this.caConfigBag&&!this.caConfigBag.emergencyCountryCode&&!this.caConfigBag.IsUserEmergencyCountryCode&&F&&(this.caConfigBag.emergencyCountryCode=F)}_initTrouter(F){return __awaiter$m(this,void 0,void 0,(function*(){let B=+new Date;try{this._trouterService=new Trouter(this.logger,this._ecsProvider,(B=>F(B)),this._telemetryLogManager),B=+new Date;let G=yield this._trouterService.start();return void this.sendSignalingInitEvent(!0,+new Date-B,G.trouterRequestCompletionTimeDeltaMs,G.registrarRequestCompletionTimeDeltaMs)}catch(F){throw this.sendSignalingInitEvent(!1,+new Date-B,F),F}}))}_getBaseStackConfig(){const F=this._getMediaProviderConfig();return{clientInformation:this._ecsProvider.getClientInformation(),logger:this.logger,mediaSettings:F.mediaSettings,platformType:getPlatformName(),callSettings:{useLwjForAllCalls:!1},usePlatformSupportApi:!0,telemetryTenants:{media:"mediaAgent",signaling:"signalingAgent"},telemetryService:this._telemetryService}}_getSignalingConfig(F){var B,G;const W=Object.assign(Object.assign({},this._ecsProvider.getJsCsaConfig()),{httpRequestDispatcher:new te.HttpRequestDispatcherImplementation,telemetryManager:this._telemetryService.getCallingAdapter(),logger:this.logger,skypeToken:()=>F(),trouterServiceProvider:this._trouterService,ecsEtag:this._ecsFetcher.getETag()});return(null===(B=this.caConfigBag)||void 0===B?void 0:B.emergencyCountryCode)&&(W.emergencyCallCountry=null===(G=this.caConfigBag)||void 0===G?void 0:G.emergencyCountryCode),W}_getMediaProviderConfig(){return{logger:this.logger,mediaSettings:this._getMediaAgentConfig()}}_getMediaAgentConfig(){return Object.assign({},this._ecsProvider.getJamaSettings())}_getAppStateProvider(){return{isOnline:()=>!0}}sendStackInitEvent(F,B,G){try{const W=G instanceof CallingCommunicationError?G.message:"unknown";this._telemetryLogManager.sendEvent({name:Mu.acs_calling_stack_init,tenant:ft,properties:{success:F,reason:B,failureReason:W}})}catch(F){}}sendSignalingInitEvent(F,B,G,W,z){try{const K=z instanceof CallingCommunicationError?z.message:"unknown";this._telemetryLogManager.sendEvent({name:Mu.acs_calling_signaling_init,tenant:ft,properties:{success:F,failureReason:K,timestampInfo:{deltaTimeInMs:B,deltaTimeInMsTrouterRequest:G,deltaTimeInMsRegistrarRequest:W}}})}catch(F){}}}__decorate$d([loggerProperty,__metadata$d("design:type",Object)],CallStack.prototype,"logger",void 0),__decorate$d([asyncOperation(Te.CreateStackBase),__metadata$d("design:type",Function),__metadata$d("design:paramtypes",[Object]),__metadata$d("design:returntype",Promise)],CallStack.prototype,"createStackBase",null),__decorate$d([asyncOperation(Te.InitializeStackForUser),__metadata$d("design:type",Function),__metadata$d("design:paramtypes",[Function,Object]),__metadata$d("design:returntype",Promise)],CallStack.prototype,"initializeStackForUser",null),__decorate$d([asyncOperation(Te.InitializeEcsBase),__metadata$d("design:type",Function),__metadata$d("design:paramtypes",[Object]),__metadata$d("design:returntype",Promise)],CallStack.prototype,"initializeEcsBase",null),__decorate$d([asyncOperation(Te.InitializeEcsForUser),__metadata$d("design:type",Function),__metadata$d("design:paramtypes",[Function]),__metadata$d("design:returntype",Promise)],CallStack.prototype,"initializeEcsForUser",null),__decorate$d([asyncOperation(Te.GetDeviceManager),__metadata$d("design:type",Function),__metadata$d("design:paramtypes",[]),__metadata$d("design:returntype",Promise)],CallStack.prototype,"getDeviceManager",null),__decorate$d([asyncOperation(Te.Dispose),__metadata$d("design:type",Function),__metadata$d("design:paramtypes",[Boolean]),__metadata$d("design:returntype",Promise)],CallStack.prototype,"dispose",null);class ObservableSubjects{constructor(){this._eventEmitter=new Jt.EventEmitter}notifyAll(F){this._eventEmitter.emit(F)}waitFor(F,B){let G=!1;const listener=()=>{G=!0},handle=(B,W)=>{try{G&&B(),W({reason:"timeout"})}catch(F){W({reason:"error",error:F})}finally{this._eventEmitter.off(F,listener)}},W=new Promise(((F,W)=>{G?handle(F,W):setTimeout((()=>{handle(F,W)}),B)}));return this._eventEmitter.once(F,listener),W}}var __decorate$e=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$e=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$n=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class DeviceManagerImpl{constructor(F,B,G){this._callStack=B,this._videoDevices=[],this._audioDevices=[],this._tsDeviceTypeToAudioDeviceType={2:"Microphone",3:"Speaker",4:"CompositeAudioDevice"},this.logger=F.createChild("DeviceManager"),this._telemetryLogManager=G,this._eventEmitter=new CallingEventEmitter(this.logger),this._browserInfo=getBrowserInfo(),this._safariVideoPermissionState="unknown",this._combinedDevicePermission=new Map,this._deviceSelectionNotifications=new ObservableSubjects}get telemetryLogManager(){return this._telemetryLogManager}getRawDeviceMediaStream(F){var B,G;const W=generateGuid(),z=+new Date;if(this.sendRawMediaEvent({eventName:Mu.acs_calling_get_raw_device_media_stream,correlationId:W,kindOfEvent:"attempt",mediaType:F,timestampInfo:"",additionalDetails:""}),!(null===(B=this._tsDeviceManager)||void 0===B?void 0:B.getRawDeviceMediaStream)){const B=new CallingCommunicationError({message:"Failed to get raw device stream track",code:ue});this.logger.error("Failed to get raw device stream track");const G=+new Date;throw this.sendRawMediaEvent({eventName:Mu.acs_calling_get_raw_device_media_stream,correlationId:W,kindOfEvent:"failure",mediaType:F,timestampInfo:{deltaTimeInMs:G-z},additionalDetails:{failureReason:B.message||"",code:B.code,subCode:B.subCode}}),B}let K;try{K=null===(G=this._tsDeviceManager)||void 0===G?void 0:G.getRawDeviceMediaStream(F);const B=+new Date;return this.sendRawMediaEvent({eventName:Mu.acs_calling_get_raw_device_media_stream,correlationId:W,kindOfEvent:"success",mediaType:F,timestampInfo:{deltaTimeInMs:B-z},additionalDetails:""}),K}catch(B){const G=new CallingCommunicationError({message:"Failed to get raw device stream track, make sure there is available device",code:le});this.logger.error("Failed to get raw device stream track");const K=+new Date;throw this.sendRawMediaEvent({eventName:Mu.acs_calling_get_raw_device_media_stream,correlationId:W,kindOfEvent:"failure",mediaType:F,timestampInfo:{deltaTimeInMs:K-z},additionalDetails:{failureReason:G.message||"",code:G.code,subCode:G.subCode}}),G}}getClientId(){return this._callStack.getClientId()}getDeviceManager(){var F,B;return __awaiter$n(this,void 0,void 0,(function*(){if(this._tsDeviceManager)return;yield this._callStack.createStackBase(),this._tsDeviceManager=yield this._callStack.getDeviceManager();const G=yield this._tsDeviceManager.enumerateDevicesAsync();this.logger.info(`tsDevicesList:${JSON.stringify(G)}`),G.forEach((F=>{if(1===F.kind){const B=F;this._videoDevices.push(new VideoDeviceInfoImpl(B.label,B.id,"UsbCamera",this))}else if(2===F.kind||3===F.kind){const B=F,G=new AudioDeviceInfoImpl(B.label,B.id,B.isSystemDefault,this._tsDeviceTypeToAudioDeviceType[B.kind],this);2===F.kind&&B.isSystemDefault&&(this._selectedMicrophone=G),3===F.kind&&B.isSystemDefault&&(this._selectedSpeaker=G),this._audioDevices.push(G)}})),this._dmDevicesChangedSub=this._tsDeviceManager.on("devicesChanged",(()=>__awaiter$n(this,void 0,void 0,(function*(){var F;try{yield this.syncDeviceList(yield null===(F=this._tsDeviceManager)||void 0===F?void 0:F.enumerateDevicesAsync()),this.checkForSelectedDevicesChanges()}catch(F){this.logger.warn(`Unable to handle devicesChanged, error=${null==F?void 0:F.message}, code=${null==F?void 0:F.code}`)}})))),getAcsEcsConfig().calling.devicePermissions.getCurrentState&&(this._audioDevicePermission=permissionStateToBool(null===(F=this._tsDeviceManager)||void 0===F?void 0:F.getPermissionState("microphone"),this.logger),this._videoDevicePermission=permissionStateToBool(null===(B=this._tsDeviceManager)||void 0===B?void 0:B.getPermissionState("camera"),this.logger)),this.logger.info("Initial permission state audio:",this._audioDevicePermission,"video:",this._videoDevicePermission),this._dmDevicesPermissionChangedSub=this._tsDeviceManager.on("onPermissionStateChanged",this.permissionsChanged.bind(this))}))}on(F,B){if("videoDevicesUpdated"!==F&&"audioDevicesUpdated"!==F&&"selectedMicrophoneChanged"!==F&&"selectedSpeakerChanged"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("videoDevicesUpdated"!==F&&"audioDevicesUpdated"!==F&&"selectedMicrophoneChanged"!==F&&"selectedSpeakerChanged"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}getTsDeviceManager(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:"Unable to access device manager",code:ue});return this._tsDeviceManager}getSafariPermissionState(){return"safari"===this._browserInfo.name?this._safariVideoPermissionState:"unknown"}getAcsResourceId(){var F,B;return null===(B=null===(F=this._callStack)||void 0===F?void 0:F.caConfigBag)||void 0===B?void 0:B.acsResourceId}getAudioDevicePermission(){return this._audioDevicePermission}getVideoDevicePermission(){return this._videoDevicePermission}sendRawMediaEvent(F){try{this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:F})}catch(F){this.logger.debug("Unable to send raw media telemetry")}}permissionsChanged(F){var B,G;const W=this._audioDevicePermission,z=this._videoDevicePermission;let K,J;getAcsEcsConfig().calling.devicePermissions.getCurrentState?(K=permissionStateToBool(null===(B=this._tsDeviceManager)||void 0===B?void 0:B.getPermissionState("microphone"),this.logger),J=permissionStateToBool(null===(G=this._tsDeviceManager)||void 0===G?void 0:G.getPermissionState("camera"),this.logger)):(K=W,J=z),this._audioDevicePermission=K||!!(null==F?void 0:F.audio),this._videoDevicePermission=J||!!(null==F?void 0:F.video),W===this._audioDevicePermission&&z===this._videoDevicePermission||(this.logger.info(`permission state changed from audio: ${W}, video: ${z}\n                          to audio: ${this._audioDevicePermission}, video: ${this._videoDevicePermission}`),this._telemetryLogManager.sendEvent({name:Mu.acs_calling_device_permission_changed,tenant:ft,properties:{previousAudioDevicePermission:this.nullHandler(W),previousVideoDevicePermission:this.nullHandler(z),newAudioDevicePermission:this.nullHandler(this._audioDevicePermission),newVideoDevicePermission:this.nullHandler(this._videoDevicePermission)}}))}checkForSelectedDevicesChanges(){var F,B;if(this.logger.info("checkForSelectedDevicesChanges"),this._tsDeviceManager){const G=this._tsDeviceManager.getSelectedDevices();G.microphone!==(null===(F=this._selectedMicrophone)||void 0===F?void 0:F.id)&&(this._selectedMicrophone=this._audioDevices.find((F=>F.id===G.microphone)),this._eventEmitter.emit("selectedMicrophoneChanged"),void 0!==G.microphone&&this._deviceSelectionNotifications.notifyAll(G.microphone)),G.speaker!==(null===(B=this._selectedSpeaker)||void 0===B?void 0:B.id)&&(this._selectedSpeaker=this._audioDevices.find((F=>F.id===G.speaker)),this._eventEmitter.emit("selectedSpeakerChanged"),void 0!==G.speaker&&this._deviceSelectionNotifications.notifyAll(G.speaker))}else this.logger.warn("DeviceManager is undefined, Unable to check selected devices")}isACSDeviceEqualToTSDevice(F,B){return F.id===B.id}syncDeviceList(F){return __awaiter$n(this,void 0,void 0,(function*(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:"Unable to access device manager",code:ue});this.logger.info("syncDeviceList"),void 0===F&&(F=yield this._tsDeviceManager.enumerateDevicesAsync());const B=[];let G=[];const W=[];let z=[];F.map((F=>{if(1===F.kind){const G=this._videoDevices.find((B=>this.isACSDeviceEqualToTSDevice(B,F)));if(G)G.setName(F.label),G.setId(F.id),G.setDeviceType("UsbCamera");else{const G=new VideoDeviceInfoImpl(F.label,F.id,"UsbCamera",this);B.push(G),this._videoDevices.push(G)}}else if(2===F.kind||3===F.kind){const B=this._audioDevices.find((B=>this.isACSDeviceEqualToTSDevice(B,F)));if(B){const G=F;B.setName(G.label),B.setId(G.id),B.setIsSystemDefault(G.isSystemDefault),B.setDeviceType(this._tsDeviceTypeToAudioDeviceType[G.kind])}else{const B=new AudioDeviceInfoImpl(F.label,F.id,F.isSystemDefault,this._tsDeviceTypeToAudioDeviceType[F.kind],this);W.push(B),this._audioDevices.push(B)}}}));const calculateRemovedDiffs=B=>{const G=B.filter((B=>!F.find((F=>this.isACSDeviceEqualToTSDevice(B,F)))));return G.map((F=>{B.splice(B.indexOf(F),1)})),G};G=calculateRemovedDiffs(this._videoDevices),z=calculateRemovedDiffs(this._audioDevices),(B.length>0||G.length>0)&&this._eventEmitter.emit("videoDevicesUpdated",{added:B,removed:G}),(W.length>0||z.length>0)&&this._eventEmitter.emit("audioDevicesUpdated",{added:W,removed:z})}))}get isSpeakerSelectionAvailable(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:"Unable to access device manager",code:ue});return this._tsDeviceManager.isAudioOutputSelectionSupported}get selectedMicrophone(){return this._selectedMicrophone}get selectedSpeaker(){return this._selectedSpeaker}getCameras(){return __awaiter$n(this,void 0,void 0,(function*(){return yield this.syncDeviceList(),this._videoDevices}))}getMicrophones(){return __awaiter$n(this,void 0,void 0,(function*(){return yield this.syncDeviceList(),this._audioDevices.filter((F=>"Microphone"===F.deviceType))}))}getSpeakers(){return __awaiter$n(this,void 0,void 0,(function*(){if(this.isSpeakerSelectionAvailable)return yield this.syncDeviceList(),this._audioDevices.filter((F=>"Speaker"===F.deviceType));throw new CallingCommunicationError({message:"This device does not support speaker enumeration.",code:ae})}))}selectMicrophone(F){return __awaiter$n(this,void 0,void 0,(function*(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:"Unable to access device manager",code:ue});if(this.logger.info("selectMicrophone called"),this._selectedMicrophone!==F){const B=this._deviceSelectionNotifications.waitFor(F.id,3e3);this._tsDeviceManager.selectDevices({microphone:F.id});try{yield B}catch(F){throw new CallingCommunicationError({message:"There was an issue in selecting microphone",code:se})}}else this.logger.warn("microphoneDevice is already active")}))}selectSpeaker(F){return __awaiter$n(this,void 0,void 0,(function*(){const B=this.logger.createFnLogger(Ee.SelectSpeaker);if(!this._tsDeviceManager)throw new CallingCommunicationError({message:"Unable to access device manager",code:ue});if(!this.isSpeakerSelectionAvailable)throw new CallingCommunicationError({message:"This device does not support speaker selection.",code:ae});if(B.info("selectSpeaker called"),this._selectedSpeaker!==F){const B=this._deviceSelectionNotifications.waitFor(F.id,3e3);this._tsDeviceManager.selectDevices({speaker:F.id});try{yield B}catch(F){throw new CallingCommunicationError({message:"There was an issue in selecting speaker",code:se})}}else B.warn("device is already selected")}))}askDevicePermission(F){return __awaiter$n(this,void 0,void 0,(function*(){const B={audio:!!F.audio,video:!!F.video},G=generateGuid();if(this.sendAudioVideoPermissionEvent({eventName:Mu.acs_calling_adp_attempt,correlationId:G,audioPermissionRequested:B.audio,videoPermissionRequested:B.video}),!this._tsDeviceManager){const F=new CallingCommunicationError({message:"Unable to access device manager",code:ue});throw this.sendAudioVideoPermissionEvent({eventName:Mu.acs_calling_adp_failure,correlationId:G,audioPermissionRequested:B.audio,videoPermissionRequested:B.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission},F),F}if(!F.audio&&!F.video){const F=new CallingCommunicationError({message:"At least one permission must be requested",code:ne});throw this.sendAudioVideoPermissionEvent({eventName:Mu.acs_calling_adp_failure,correlationId:G,audioPermissionRequested:B.audio,videoPermissionRequested:B.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission},F),F}const W=this._combinedDevicePermission.get(this.getKeyForConstrains(B));if(W)return this.sendAudioVideoPermissionEvent({eventName:Mu.acs_calling_adp_attempt,correlationId:G,audioPermissionRequested:B.audio,videoPermissionRequested:B.video,adpInProgress:!0}),this.logger.info(`askDevicePermission attempt: audio:${B.audio}, video:${B.video} on pending existing request ${getPrintableObject(W)}`),W;const z=this.askDevicePermissionInternal(B);return this._combinedDevicePermission.set(this.getKeyForConstrains(B),z),z}))}getKeyForConstrains(F){return Object.keys(F).filter((B=>F[B])).toString()}askDevicePermissionInternal(F){return __awaiter$n(this,void 0,void 0,(function*(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:"Unable to access device manager",code:ue});this.logger.info(`askDevicePermission attempt: audio:${F.audio}, video:${F.video}`);const B=generateGuid(),G=+new Date;let W=[];try{if(getAcsEcsConfig().calling.devicePermissions.splitAskAudioVideo){this.logger.info("askDevicePermission, split permission check");const B=[];if(F.audio&&(this.logger.info("askDevicePermission, split permission audio"),B.push(this._tsDeviceManager.askDevicePermission({audio:F.audio,video:!1}))),F.video){const askDevicePermissionVideoWithDelay=B=>__awaiter$n(this,void 0,void 0,(function*(){return new Promise(((G,W)=>{const askDevicePermissionVideo=()=>__awaiter$n(this,void 0,void 0,(function*(){if(this.logger.info("askDevicePermission, split permission video"),!this._tsDeviceManager){const F="askDevicePermission, split permission video failed device manager not found";return this.logger.error(F),void W(F)}try{const B=yield this._tsDeviceManager.askDevicePermission({audio:!1,video:F.video});G(B)}catch(F){W(F)}}));B?window.setTimeout(askDevicePermissionVideo,B):askDevicePermissionVideo()}))}));B.push(askDevicePermissionVideoWithDelay(getAcsEcsConfig().calling.devicePermissions.timeoutInBetween))}const G=yield Promise.allSettled(B);let z={audio:!1,video:!1};G.forEach((F=>{var B,G;"fulfilled"===F.status&&(null==F?void 0:F.value)&&(z={audio:z.audio||!!(null===(B=null==F?void 0:F.value)||void 0===B?void 0:B.audio),video:z.video||!!(null===(G=null==F?void 0:F.value)||void 0===G?void 0:G.video)}),"rejected"===F.status&&(null==F?void 0:F.reason)&&W.push(F.reason)})),this.permissionsChanged(z),this._safariVideoPermissionState=this._videoDevicePermission?"granted":"denied"}else{const B=yield this._tsDeviceManager.askDevicePermission({audio:F.audio,video:F.video});this.permissionsChanged(B)}if((null==F?void 0:F.audio)&&!this._audioDevicePermission||(null==F?void 0:F.video)&&!this._videoDevicePermission)this.sendAudioVideoPermissionEvent({eventName:Mu.acs_calling_adp_failure,correlationId:B,audioPermissionRequested:F.audio,videoPermissionRequested:F.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission},{name:"Permissions not granted or failed",message:`${getPrintableObject(W)}}`});else{const W=+new Date;this.sendAudioVideoPermissionEvent({eventName:Mu.acs_calling_adp_success,correlationId:B,audioPermissionRequested:F.audio,videoPermissionRequested:F.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission,deltaTimeInMs:W-G})}}catch(W){this.logger.error(`Failed to get audio video permissions with error ${getPrintableObject(W)}`);const z=+new Date;this.sendAudioVideoPermissionEvent({eventName:Mu.acs_calling_adp_failure,correlationId:B,audioPermissionRequested:F.audio,videoPermissionRequested:F.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission,deltaTimeInMs:z-G},W)}return this._combinedDevicePermission.delete(this.getKeyForConstrains(F)),{audio:!!this._audioDevicePermission,video:!!this._videoDevicePermission}}))}sendAudioVideoPermissionEvent(F,B){try{let G,W="string"==typeof(null==B?void 0:B.message)?null==B?void 0:B.message:void 0;F.eventName!==String(Mu.acs_calling_adp_success)&&F.eventName!==String(Mu.acs_calling_adp_failure)&&(W=void 0),F.deltaTimeInMs&&(G=F.deltaTimeInMs>25e3),this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:{audioPermissionGranted:this.nullHandler(F.audioPermissionGranted),videoPermissionGranted:this.nullHandler(F.videoPermissionGranted),audioPermissionRequested:F.audioPermissionRequested,videoPermissionRequested:F.videoPermissionRequested,correlationId:F.correlationId||"",failureReason:W||"",deltaTimeInMs:F.deltaTimeInMs||"",deltaTimeGreaterThanJAMATimeout:this.nullHandler(G)}})}catch(F){this.logger.debug("Unable to send audio video permission failure success telemtery")}}nullHandler(F){return void 0===F?"":F}dispose(){this._dmDevicesChangedSub&&this._dmDevicesChangedSub.dispose(),this._dmDevicesPermissionChangedSub&&this._dmDevicesPermissionChangedSub.dispose(),this._dmDevicesPermissionChangedSub=void 0,this._dmDevicesChangedSub=void 0}}__decorate$e([loggerProperty,__metadata$e("design:type",Object)],DeviceManagerImpl.prototype,"logger",void 0),__decorate$e([asyncOperation(Ee.GetDeviceManager),__metadata$e("design:type",Function),__metadata$e("design:paramtypes",[]),__metadata$e("design:returntype",Promise)],DeviceManagerImpl.prototype,"getDeviceManager",null),__decorate$e([asyncOperation(Ee.GetCameras),__metadata$e("design:type",Function),__metadata$e("design:paramtypes",[]),__metadata$e("design:returntype",Promise)],DeviceManagerImpl.prototype,"getCameras",null),__decorate$e([asyncOperation(Ee.GetMicrophones),__metadata$e("design:type",Function),__metadata$e("design:paramtypes",[]),__metadata$e("design:returntype",Promise)],DeviceManagerImpl.prototype,"getMicrophones",null),__decorate$e([syncOperation(Ee.GetSpeakers),__metadata$e("design:type",Function),__metadata$e("design:paramtypes",[]),__metadata$e("design:returntype",Promise)],DeviceManagerImpl.prototype,"getSpeakers",null),__decorate$e([asyncOperation(Ee.SelectMicrophone),__metadata$e("design:type",Function),__metadata$e("design:paramtypes",[Object]),__metadata$e("design:returntype",Promise)],DeviceManagerImpl.prototype,"selectMicrophone",null),__decorate$e([asyncOperation(Ee.SelectSpeaker),__metadata$e("design:type",Function),__metadata$e("design:paramtypes",[Object]),__metadata$e("design:returntype",Promise)],DeviceManagerImpl.prototype,"selectSpeaker",null),__decorate$e([asyncOperation(Ee.AskDevicePermission),__metadata$e("design:type",Function),__metadata$e("design:paramtypes",[Object]),__metadata$e("design:returntype",Promise)],DeviceManagerImpl.prototype,"askDevicePermission",null);var __decorate$f=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$f=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$o=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class TeamsIncomingCallImpl extends IncomingCallCommonImpl{constructor(B){super(B,F.IncomingCallKind.TeamsIncomingCall),this._teamsCall=B}get info(){return this._teamsCall.info}accept(F){return __awaiter$o(this,void 0,void 0,(function*(){return yield this._teamsCall.accept(F),this._teamsCall}))}}__decorate$f([asyncOperation(_e.Accept),__metadata$f("design:type",Function),__metadata$f("design:paramtypes",[Object]),__metadata$f("design:returntype",Promise)],TeamsIncomingCallImpl.prototype,"accept",null);var __decorate$g=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$g=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$p=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class TeamsCallInfoImpl{constructor(F){this._tsCall=F,this._threadId=this._tsCall.threadId}get threadId(){return this._threadId}getServerCallId(){return __awaiter$p(this,void 0,void 0,(function*(){const F=JSON.parse(yield this._tsCall.getJoinBlob()),B=null==F?void 0:F.conversationUrl;if(!B)throw new CallingCommunicationError({message:"Failed to get serverCallId, serverCallId is empty",code:oe});return base64UrlEncoding(B)}))}}__decorate$g([asyncOperation(Ce.GetServerCallId),__metadata$g("design:type",Function),__metadata$g("design:paramtypes",[]),__metadata$g("design:returntype",Promise)],TeamsCallInfoImpl.prototype,"getServerCallId",null);var __awaiter$q=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class AcsMiddleTierPolicyService{constructor(){this._isPolicyFetchApplicable=!1,this._policySettingData={};const F=B.createClientLogger("ACS");this._logger=new DefaultLogger(F)}static getInstance(){return isNullOrUndefined$2(AcsMiddleTierPolicyService._instance)&&(this._instance=new AcsMiddleTierPolicyService),this._instance}initialize(F){this._localParticipant=F.localParticipant,this._skypeToken=F.skypeToken,this._userDialedPstnNumber=F.pstnNumber,this._emergencyNumber=this._userDialedPstnNumber,this._telemetryLogManager=F.telemetryLogManager}fetchUserPoliciesFromAcsMiddleTier(F,B){return __awaiter$q(this,void 0,void 0,(function*(){this._callId=F,this._participantId=B;let G="";const W=+new Date;if(this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_fetch_policy,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.attempt,timestampInfo:"",additionalDetails:""}),!this._localParticipant){const F=+new Date;throw G="Caller's MicrosoftTeamsUserIdentifier wasn't provided. Fetching Teams user policies and settings cannot proceed",this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_fetch_policy,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.failure,timestampInfo:{deltaTimeInMs:F-W},additionalDetails:{failureReason:G,code:le}}),new CallingCommunicationError({message:G,code:le})}let z=getAcsEcsConfig().MiddleTier.baseServiceUrl+getAcsEcsConfig().MiddleTier.policyUrlSuffix,K={id:this._localParticipant},J=AcsMiddleTierPolicyService._httpRequestHelper;isNullOrUndefined$2(J)&&(J=new HttpRequestHelper(this._logger));const Q=this.getAmtRequestHeader();try{let F=yield J.sendRequestWithRetry("post",z,K,{headers:Q},getAcsEcsConfig().MiddleTier.maxRetry);this._policySettingData=null==F?void 0:F.data;const B=+new Date;this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_fetch_policy,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.success,timestampInfo:{deltaTimeInMs:B-W},additionalDetails:""})}catch(F){G="Error Fetching Teams user policy from ACS MiddleTier Service";const B=+new Date;throw this._logger.error(G),this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_fetch_policy,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.failure,timestampInfo:{deltaTimeInMs:B-W},additionalDetails:{failureReason:G,code:ue}}),new CallingCommunicationError({message:G,code:ue},F)}}))}isEvEnabled(){var F,B;let G=null===(B=null===(F=this._policySettingData)||void 0===F?void 0:F.userAggregatedPolicySettingData)||void 0===B?void 0:B.userProperties;return(null==G?void 0:G.evEnabled)||!1}getEmergencyContent(){var F,B,G,W,z,K;const J=+new Date;let Q="";if(this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_emergency_content,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.attempt,timestampInfo:"",additionalDetails:""}),!this._userDialedPstnNumber){const F=+new Date;throw Q="PSTN number wasn't provided. Getting Emergency Content cannot proceed",this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_emergency_content,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.failure,timestampInfo:{deltaTimeInMs:F-J},additionalDetails:{failureReason:Q,code:le}}),new CallingCommunicationError({message:Q,code:le})}let Y="";this._logger.info("Fetching emergency Content from ACS MiddleTier Service for Teams user");try{if(!this.isEvEnabled())return this._logger.warn("Teams user is not eligible to make emergency call"),Y;let Q=this._policySettingData.userAggregatedPolicySettingData,$=Q.userPolicies,X=!1,Z="";if(null===(F=null==$?void 0:$.locationPolicy)||void 0===F?void 0:F.emergencyNumbers){let F=$.locationPolicy.emergencyNumbers||[];this.isPhoneNumberInLocationPolicy(F)&&(X=!0,Y=JSON.stringify({enableSecurityMemberNotifications:this.isSecurityDeskEnabled(),callerLocation:Q.userProperties.region,locationPolicyTag:null===(B=null==$?void 0:$.locationPolicy)||void 0===B?void 0:B.policyDocument,teamsEmergencyCallingPolicyTag:null===(G=null==$?void 0:$.teamsEmergencyCallingPolicy)||void 0===G?void 0:G.policyDocument}),Z="LocationPolicy")}if(!X&&(null==$?void 0:$.teamsEmergencyCallRoutingPolicy)){let F=(null===(W=null==$?void 0:$.teamsEmergencyCallRoutingPolicy)||void 0===W?void 0:W.emergencyNumbers)||[];this.isPhoneNumberInTeamsEmergenencyRoutingPolicy(F)&&(X=!0,Y=JSON.stringify({enableSecurityMemberNotifications:this.isSecurityDeskEnabled(),callerLocation:Q.userProperties.region,teamsEmergencyCallRoutingPolicyTag:null===(z=null==$?void 0:$.teamsEmergencyCallRoutingPolicy)||void 0===z?void 0:z.policyDocument,teamsEmergencyCallingPolicyTag:null===(K=null==$?void 0:$.teamsEmergencyCallingPolicy)||void 0===K?void 0:K.policyDocument}),Z="TeamsEmergencyCallingRoutingPolicy")}const ee=X?`Created Emergency content using ${Z}`:"This is NOT an emergency call",te=+new Date;this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_emergency_content,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.success,timestampInfo:{deltaTimeInMs:te-J},additionalDetails:""}),this._logger.info(`${ee}`)}catch(F){const B=+new Date;throw Q="Unable to retrieve emergency content from ACS MiddleTier Service response",this.sendMiddleTierPolicyEvent({eventName:Mu.acs_calling_middletier_gateway_emergency_content,callId:this._callId,localParticipantId:this._participantId,kindOfEvent:wu.failure,timestampInfo:{deltaTimeInMs:B-J},additionalDetails:{failureReason:Q,code:ue}}),new CallingCommunicationError({message:Q,code:ue},F)}return this._logger.info(`${Y}`),Y}isFetchUserPoliciesAndSettingsApplicable(F,B){return isNullOrUndefined$2(F)||isNullOrUndefined$2(B)||(this._isPolicyFetchApplicable=this.verifyFetchUserPoliciesSettings(F,B)),this._isPolicyFetchApplicable}getEmergencyNumber(){return this._emergencyNumber}getUserDialedPstnNumber(){return this._userDialedPstnNumber}isPhoneNumberInLocationPolicy(F){var B;if(!isNullOrUndefined$2(F))for(let G of F)if(G.dialString===this._userDialedPstnNumber||!isNullOrUndefined$2(null===(B=G.dialMask)||void 0===B?void 0:B.split(";").find((F=>F===this._userDialedPstnNumber))))return this._emergencyNumber=G.dialString,!0;return!1}isPhoneNumberInTeamsEmergenencyRoutingPolicy(F){var B;if(!isNullOrUndefined$2(F))for(let G of F)if(G.emergencyDialString===this._userDialedPstnNumber||!isNullOrUndefined$2(null===(B=G.emergencyDialMask)||void 0===B?void 0:B.split(";").find((F=>F===this._userDialedPstnNumber))))return this._emergencyNumber=G.emergencyDialString,!0;return!1}verifyFetchUserPoliciesSettings(F,B){let W=getAcsEcsConfig().MiddleTier;return W.enabled?W.userPolicySettingsApi?F?Array.isArray(B)&&(B.length>1||!G.isPhoneNumberIdentifier(B[0]))?(this._logger.info("Target particpant (Callee) is not a PSTN Number"),!1):Array.isArray(B)||G.isPhoneNumberIdentifier(B)?(this._logger.info("Teams user is eligible to fetch policies and settings from MiddleTier Service "),!0):(this._logger.info("Target particpant (Callee) is not a PSTN Number"),!1):(this._logger.info("Originator (Caller) is not a Teams User"),!1):(this._logger.info("ACS MiddleTier Policy API is disabled"),W.userPolicySettingsApi):(this._logger.info("ACS MiddleTier service is disabled"),W.enabled)}isSecurityDeskEnabled(){var F,B,G;let W=null===(F=this._policySettingData.userAggregatedPolicySettingData.userPolicies)||void 0===F?void 0:F.teamsEmergencyCallingPolicy;return!(isNullOrUndefined$2(null==W?void 0:W.notificationGroup)&&isNullOrUndefined$2(null==W?void 0:W.notificationDialOutNumber)||0==(null===(B=null==W?void 0:W.notificationGroup)||void 0===B?void 0:B.trim().length)&&0==(null===(G=null==W?void 0:W.notificationDialOutNumber)||void 0===G?void 0:G.trim().length))}getAmtRequestHeader(){return{"Content-Type":"application/json","X-Skypetoken":this._skypeToken||"","Access-Control-Allow-Origin":"*","X-Microsoft-Skype-Chain-ID":this._callId}}sendMiddleTierPolicyEvent(F){var B;try{null===(B=this._telemetryLogManager)||void 0===B||B.sendEvent({name:F.eventName,tenant:ft,properties:F})}catch(F){this._logger.debug("Unable to send AcsMiddleTierPolicyService telemetry")}}}var __decorate$h=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$h=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$r=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class TeamsCallImpl extends CallCommonImpl{constructor(B,G,W,z){super(B,G,W,z,F.CallKind.TeamsCall),this._isEmergencyCall=!1,this._info=new TeamsCallInfoImpl(W)}get info(){return this._info}getOrCreateRemoteParticipant(F){let B=this.remoteParticipants.find((B=>getMriFromIdentifier(B.identifier)===getMriFromIdentifier(F)));return B||(B=new RemoteParticipantImpl(F,this.logger,this,this._callAgent,this._telemetryLogManager),this._remoteParticipants.push(B)),B}startCallInternal(F,B,G,W,z){const K=Object.create(null,{startCallInternal:{get:()=>super.startCallInternal}});return __awaiter$r(this,void 0,void 0,(function*(){let J=AcsMiddleTierPolicyService.getInstance();if(J&&J.isFetchUserPoliciesAndSettingsApplicable()){let F="",B=!0;this._isEmergencyCall=!1;try{this.logger.info("Fetching Teams User policy from MiddleTier Service"),yield J.fetchUserPoliciesFromAcsMiddleTier(this.tsCall.callId,this.tsCall.participantId)}catch(F){B=!1,this.logger.warn("Fetching Teams user policy from ACS MiddleTier Service failed")}if(B){if(!J.isEvEnabled())throw new CallingCommunicationError({message:"The Teams user is not evEnabled. Cannot proceed with Emergency Call",code:ue});try{F=J.getEmergencyContent()}catch(F){throw new CallingCommunicationError({message:"Retrieving emergency content for Teams user failed",code:ue},F)}W&&(W.emergencyContent=F||"",W.isEmergency=(null==F?void 0:F.trim().length)>0||!1,this._isEmergencyCall=W.isEmergency)}}if(z){let F=[];Array.isArray(z)?F=z:F.push(z),this._isEmergencyCall&&1==F.length&&(this.logger.info(`user dialed number (${F[0].phoneNumber}) resolved to actual emergency number (${J.getEmergencyNumber()} during startCall`),F[0]={phoneNumber:J.getEmergencyNumber()}),F.forEach((F=>{this.tsCall.addParticipant(getMriFromIdentifier(F)).catch((F=>{throw new CallingCommunicationError({message:"Failed to add target paticipant during startCall",code:ue},F)}))})),this.logger.info("Paticipant added during startCall")}K.startCallInternal.call(this,F,B,G,W)}))}isEmergencyCallInProgress(){return this._isEmergencyCall}dispose(){super.dispose(),this._extensibleApi.dispose()}addParticipant(F,B){this.validateThreadId(F,B);let W=B.threadId;if(validateIdentifier(F),this._remoteParticipants.find((B=>getMriFromIdentifier(B.identifier)===getMriFromIdentifier(F))))throw new CallingCommunicationError({message:`${G.getIdentifierKind(F).kind} is already in the call`,code:ne});const z=this.getOrCreateRemoteParticipant(constructIdentifierKindFromMri(getMriFromIdentifier(F)));return this.tsCall.addParticipant(getMriFromIdentifier(F),{threadId:W}).catch((B=>{if(this._remoteParticipants.find((B=>getMriFromIdentifier(B.identifier)===getMriFromIdentifier(F)))){this._remoteParticipants.splice(this._remoteParticipants.indexOf(z));const F=this._handleParticipantOperationFailure(B);z.setCallEndReason({code:F.code,subCode:F.subCode}),this._eventEmitter.emit("remoteParticipantsUpdated",{added:[],removed:[z]})}})),z}removeParticipant(F){return __awaiter$r(this,void 0,void 0,(function*(){validateIdentifier(F);try{yield this.tsCall.removeParticipant(getMriFromIdentifier(F))}catch(F){throw this._handleParticipantOperationFailure(F)}}))}mute(){const F=Object.create(null,{mute:{get:()=>super.mute}});return __awaiter$r(this,void 0,void 0,(function*(){F.mute.call(this)}))}unmute(){const F=Object.create(null,{unmute:{get:()=>super.unmute}});return __awaiter$r(this,void 0,void 0,(function*(){F.unmute.call(this)}))}validateThreadId(F,B){if(!B.threadId)throw new CallingCommunicationError({message:"Add participant failed: thread ID is missing in options.",code:ne})}}__decorate$h([validateEmergencyCallOperation(_e.AddParticipant),syncOperation(_e.AddParticipant),__metadata$h("design:type",Function),__metadata$h("design:paramtypes",[Object,Object]),__metadata$h("design:returntype",Object)],TeamsCallImpl.prototype,"addParticipant",null),__decorate$h([validateEmergencyCallOperation(_e.RemoveParticipant),asyncOperation(_e.RemoveParticipant),__metadata$h("design:type",Function),__metadata$h("design:paramtypes",[Object]),__metadata$h("design:returntype",Promise)],TeamsCallImpl.prototype,"removeParticipant",null),__decorate$h([validateEmergencyCallOperation(_e.Mute),__metadata$h("design:type",Function),__metadata$h("design:paramtypes",[]),__metadata$h("design:returntype",Promise)],TeamsCallImpl.prototype,"mute",null),__decorate$h([validateEmergencyCallOperation(_e.Unmute),__metadata$h("design:type",Function),__metadata$h("design:paramtypes",[]),__metadata$h("design:returntype",Promise)],TeamsCallImpl.prototype,"unmute",null);var __decorate$i=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$i=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$s=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};const Jh=new Map;class TeamsCallAgentImpl extends CallAgentCommonImpl{constructor(B,G,W,z,K){super(B,G,z,K,W,F.CallAgentKind.TeamsCallAgent),this._calls=[],this.handleCallAdded=F=>{if(!this._calls.find((B=>B.id===F.callId))){const B=F.on("callStateChanged",(()=>{if(1===F.state){const G=F.callId;B.dispose();const W=new TeamsCallImpl({callId:G,isIncoming:!0},this,F,this._telemetryLogManager),z=new TeamsIncomingCallImpl(W);this.handleCallState(W),W.bindTsCall(),this._eventEmitter.emit("incomingCall",{incomingCall:z})}}))}},this.handleCallRemoved=F=>{this.logger.info(`removing callId=${F.callId}`);const B=this._calls.find((B=>B.id===F.callId));if(B){const F=this._calls.indexOf(B);-1!==F&&this._calls.splice(F,1),B.dispose(),this._eventEmitter.emit("callsUpdated",{added:[],removed:[B]}),this.logger.info("call removed")}},this.handleCallState=F=>{F.on("stateChanged",(()=>{try{if("Disconnected"===F.state){this.tsStack?(this._tsCallRegistry.deleteCall(F.tsCall)||this.logger.error(`Failed to remove call from registry, call id: ${F.id}`),F.stats.flushEvents(),this._telemetryLogManager.flushAllEvents(F.id).catch((()=>{this.logger.error("Failed to flush telemetry log manager events")}))):this.logger.info("Unable to remove call from registry")}else"Connecting"===F.state&&"Incoming"==F.direction&&(this._calls.push(F),this._eventEmitter.emit("callsUpdated",{added:[F],removed:[]}))}catch(F){this.logger.error("Failed to handle call state changed event")}}))},this.logger=G,this._teamsCallStack=W,this._mtPolicyService=AcsMiddleTierPolicyService.getInstance()}get calls(){return this._calls}createNewCall(F,B){return new TeamsCallImpl({callId:F},this,B,this._telemetryLogManager)}addToCallArray(F){this._calls.push(F)}addToCallAgentsMap(F){Jh.get(null==F?void 0:F.identityMri)&&logErrorAndThrow("Failed to create call agent, call agent for this ACS Id already exists",ce,this.logger),Jh.set(null==F?void 0:F.identityMri,this)}removeFromCallAgentsMap(F){(null==F?void 0:F.identityMri)&&Jh.get(null==F?void 0:F.identityMri)===this&&Jh.delete(null==F?void 0:F.identityMri)}getMiddleTierServiceInstance(){return this._mtPolicyService}startCall(F,B){var G;let W;if(this.assertParticipants(F),this.isCteUser()&&Array.isArray(F)){if(W=B,F.length>1&&!(null==W?void 0:W.threadId))throw new CallingCommunicationError({message:"Starting a group call must include thread ID in StartTeamsGroupCallOptions.",code:ne});if(1==F.length&&(null==W?void 0:W.threadId))throw new CallingCommunicationError({message:"Starting a one to one with thread ID is invalid.",code:ne})}else W=B;this._mtPolicyService.isFetchUserPoliciesAndSettingsApplicable(this.isCteUser(),F)&&this._mtPolicyService.initialize({localParticipant:this.getUserMri(),pstnNumber:Array.isArray(F)?F[0].phoneNumber:F.phoneNumber,skypeToken:this._parsedTokenCredential.jwtToken,telemetryLogManager:this._telemetryLogManager});let z=null===(G=null==W?void 0:W.audioOptions)||void 0===G?void 0:G.muted;return void 0===z&&(z=!1),this.logger.info(`startCall with video=${!!(null==W?void 0:W.videoOptions)},muted=${z}`),this.createCall({participants:F,startCallOptions:W})}join(F,B){var G;this.assertCallContext(F);let W=!!(null===(G=null==B?void 0:B.audioOptions)||void 0===G?void 0:G.muted);return this.logger.info(`join with video=${!!(null==B?void 0:B.videoOptions)},muted=${W}`),this.createCall({teamsCallContext:F,startCallOptions:B})}dispose(){var F,B,G;return __awaiter$s(this,void 0,void 0,(function*(){if(this._disposed)throw new CallingCommunicationError({message:"Teams Call Agent is already disposed",code:ce});this._disposed=!0,this._abortController.abort(),this._extensibleApi.dispose(),(null===(F=this._parsedTokenCredential)||void 0===F?void 0:F.identityMri)&&Jh.delete(null===(B=this._parsedTokenCredential)||void 0===B?void 0:B.identityMri);try{const F=this._tokenFetchTries>this._maxNmberOfRetries;yield null===(G=this._teamsCallStack)||void 0===G?void 0:G.dispose(F)}catch(F){this.logger.error("Call Agent failed to dispose to Call Stack")}delete this._teamsCallStack,this._telemetryLogManager.clearTelemetryLoggers(),this.onDisposedCallback&&this.onDisposedCallback()}))}on(F,B){if("incomingCall"!==F&&"callsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to subscribe to event ${F}, unknown event name`,code:de});this._eventEmitter.on(F,B)}off(F,B){if("incomingCall"!==F&&"callsUpdated"!==F)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${F}, unknown event name`,code:de});this._eventEmitter.off(F,B)}createCall(F){var B,G,W,z,K,J,Q,Y,$,X,Z;let ee,ne,ie,re=null===(B=null==F?void 0:F.teamsCallContext)||void 0===B?void 0:B.threadId;const oe=null===(G=null==F?void 0:F.teamsCallContext)||void 0===G?void 0:G.meetingLink,ae=null===(W=null==F?void 0:F.teamsCallContext)||void 0===W?void 0:W.meetingId,se=!!(null==F?void 0:F.participants)&&(Array.isArray(null==F?void 0:F.participants)&&(null==F?void 0:F.participants.length)>1);if(this.isCteUser()&&se&&(re=(null==F?void 0:F.startCallOptions).threadId),oe&&(ne=parseMeetingUrl(oe)),(null===(z=null==F?void 0:F.teamsCallContext)||void 0===z?void 0:z.threadId)&&(null===(K=null==F?void 0:F.teamsCallContext)||void 0===K?void 0:K.organizerId)&&(null===(J=null==F?void 0:F.teamsCallContext)||void 0===J?void 0:J.tenantId)&&(ne={threadId:null===(Q=null==F?void 0:F.teamsCallContext)||void 0===Q?void 0:Q.threadId,messageId:(null===(Y=null==F?void 0:F.teamsCallContext)||void 0===Y?void 0:Y.messageId)?null===($=null==F?void 0:F.teamsCallContext)||void 0===$?void 0:$.messageId.toString():"0",organizerId:null===(X=null==F?void 0:F.teamsCallContext)||void 0===X?void 0:X.organizerId,tenantId:null===(Z=null==F?void 0:F.teamsCallContext)||void 0===Z?void 0:Z.tenantId}),ne&&(ie={meetingType:"0"===ne.messageId?1:2,tenantId:ne.tenantId,organizerId:ne.organizerId,replyChainMessageId:ne.messageId}||void 0,re=ne.threadId,ee=ne.messageId),this.tsStack){const B=te.generateCauseId(),G=generateGuid(),W=generateGuid();let z;z=ae?this._tsCallRegistry.createCallWithMeetingData({meetingCode:ae,threadId:re},G,W,B):this._tsCallRegistry.createCall(re||"",G,W,ee,B);const K=new TeamsCallImpl({callId:G},this,z,this._telemetryLogManager);this._calls.push(K),this.handleCallState(K);const J={threadId:re||"",messageId:ee||"",meetingInfo:ie,mediaPeerType:2};return K.startCallInternal(null==F?void 0:F.startCallOptions,!!ae,null==F?void 0:F.teamsCallContext,J,null==F?void 0:F.participants).catch(noop),K.bindTsCall(),this._eventEmitter.emit("callsUpdated",{added:[K],removed:[]}),K}throw new CallingCommunicationError({message:"Failed to start call, call stack did not initialize",code:ue})}assertParticipants(F){assertIsObject(F,"participant must be object"),assertNotNull(F,"participant cannot be null")}assertCallContext(F){if(!F||this.checkForAtLeastOneValidCallConfig(F)||this.checkForInvalidTeamsMeetingCoordinates(F))throw new CallingCommunicationError({message:"Invalid call configuration",code:ne})}checkForAtLeastOneValidCallConfig(F){return!F.threadId&&!F.meetingLink&&!F.meetingId}checkForInvalidTeamsMeetingCoordinates(F){return!F.threadId&&F.tenantId&&F.organizerId||F.threadId&&(F.organizerId&&!F.tenantId||!F.organizerId&&F.tenantId)}}__decorate$i([syncOperation(Se.StartCall),__metadata$i("design:type",Function),__metadata$i("design:paramtypes",[Object,Object]),__metadata$i("design:returntype",Object)],TeamsCallAgentImpl.prototype,"startCall",null),__decorate$i([syncOperation(Se.Join),__metadata$i("design:type",Function),__metadata$i("design:paramtypes",[Object,Object]),__metadata$i("design:returntype",Object)],TeamsCallAgentImpl.prototype,"join",null),__decorate$i([asyncOperation(Se.Dispose),__metadata$i("design:type",Function),__metadata$i("design:paramtypes",[]),__metadata$i("design:returntype",Promise)],TeamsCallAgentImpl.prototype,"dispose",null);var Qh,__decorate$j=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$j=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$t=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};let Yh=1;class CallClient{constructor(F){this.sendTelemetry=()=>{try{if(getAcsEcsConfig().telemetry.telemetryBeforeUnload&&this._callAgent&&this._callAgent._calls)for(const F of this._callAgent._calls){F.tsCall.sendLastKnownStats()}}catch(F){this.logger.debug("Error logging telemetry",F)}},this.handleVisibilityChange=()=>{"hidden"===document.visibilityState?(this.logger.debug("Visibility changed to hidden"),this.sendPageVisibilityInfoEvent("visibilityChange",!0),this.hangupCalls()):(this.logger.debug("Visibility changed to visible"),this.sendPageVisibilityInfoEvent("visibilityChange",!1))},this.handlePageShow=()=>{this.logger.debug("Page show"),this.sendPageVisibilityInfoEvent("pageShow",!0)},this.handlePageHide=()=>{this.logger.debug("Page hide"),this.sendPageVisibilityInfoEvent("pageHide",!1)},this.handleOrientationChange=()=>{this.logger.debug(`Orientation changed to ${screen.orientation.type}`),this.sendOrientationChangeEvent(screen.orientation.type)},this.getOrientationBasedOnWindowSize=()=>window.innerHeight>window.innerWidth?"portrait-primary":"landscape-primary",this.handleResize=()=>{const F=this.getOrientationBasedOnWindowSize();this._previousOrientation!==F&&(this._previousOrientation=F,this.sendOrientationChangeEvent(F))},this.clientId=generateGuid();const G=(null==F?void 0:F.logger)||B.createClientLogger("ACS"),W=Yh++;this.logger=new DefaultLogger(G,[()=>`CallClient${W}`]),this._eventEmitter=new CallingEventEmitter(this.logger),this._sdkUserAgent=buildCallingUserAgent(getSdkVersion(),this.logger,F),this._telemetryLogManager=new TelemetryLogManager(this.logger,this._sdkUserAgent),this.logger.info("created"),this._callStack=new CallStack(this.logger,this.clientId,this._telemetryLogManager,this._sdkUserAgent),this._deviceManager=new DeviceManagerImpl(this.logger,this._callStack,this._telemetryLogManager),this._previousOrientation="",this.sendInitialOrientation(),window.addEventListener("beforeunload",this.sendTelemetry),window.addEventListener("visibilitychange",this.handleVisibilityChange,!1),window.addEventListener("pageshow",this.handlePageShow,!1),window.addEventListener("pagehide",this.handlePageHide,!1),screen.orientation?screen.orientation.addEventListener("change",this.handleOrientationChange):window.addEventListener("resize",this.handleResize,!1),this._extensibleApi=new ExtensibleFeatureImpl(this.logger,{callClient:this},{callClient:this,telemetryLogManager:this._telemetryLogManager});const z=getRegisteredFeatures(Yt.CallClientFeature);for(const F of z)"OnExtendedObjectConstructor"===F.activationOptions.activationEvent&&this.feature(F)}get callAgent(){return this._callAgent}get teamsCallAgent(){return this._teamsCallAgent}get userAgent(){return this._sdkUserAgent}setCallAgent(F){this._callAgent=F}setTeamsCallAgent(F){this._teamsCallAgent=F}on(F,B){this._eventEmitter.on(F,B)}off(F,B){this._eventEmitter.off(F,B)}createInstance(F){return new CallClient(F)}getSDKVersion(){return getSdkVersion()}feature(F){return this._extensibleApi.getApiObjectInstance(F.callClientApiCtor)}createCallAgent(F,B){return __awaiter$t(this,void 0,void 0,(function*(){(this._callAgent||this._teamsCallAgent)&&logErrorAndThrow("CallClient instance can support only one CallAgent or TeamsCallAgentcreate new CallClient instance to create new CallAgent or TeamsCallAgent",ue,this.logger),this.validateEmergencyCountryCode(B);try{const onDisposedCallback=()=>{this._callAgent=void 0};return this._callAgent=new CallAgentImpl(this,this.logger,this._callStack,this.clientId,this._telemetryLogManager,B),yield this._callAgent.initialize(F,onDisposedCallback,B),this._eventEmitter.emit("callAgentCreated"),this._callAgent}catch(F){throw this._callAgent=void 0,new CallingCommunicationError({message:"Failed to create CallAgent",code:ce},F)}}))}createTeamsCallAgent(F,B){return __awaiter$t(this,void 0,void 0,(function*(){(yield parseTokenCredential(F)).isCte||logErrorAndThrow("TeamsCallAgent can be created only with Teams token.",re,this.logger),(this._callAgent||this._teamsCallAgent)&&logErrorAndThrow("CallClient instance can support only one CallAgent or TeamsCallAgentcreate new CallClient instance to create new CallAgent or TeamsCallAgent",ue,this.logger);try{const onDisposedCallback=()=>{this._teamsCallAgent=void 0};return this._teamsCallAgent=new TeamsCallAgentImpl(this,this.logger,this._callStack,this.clientId,this._telemetryLogManager),yield this._teamsCallAgent.initialize(F,onDisposedCallback,B),this._eventEmitter.emit("teamsCallAgentCreated"),this._teamsCallAgent}catch(F){throw this._teamsCallAgent=void 0,new CallingCommunicationError({message:"Failed to create TeamsCallAgent",code:ce},F)}}))}getDeviceManager(){return __awaiter$t(this,void 0,void 0,(function*(){return yield this._deviceManager.getDeviceManager(),this._deviceManager}))}getEnvironmentInfo(){return __awaiter$t(this,void 0,void 0,(function*(){return yield this._callStack.createStackBase(),getEnvironmentInfos()}))}validateEmergencyCountryCode(F){var B,G;(null===(B=null==F?void 0:F.emergencyCallOptions)||void 0===B?void 0:B.countryCode)&&(null===(G=F.emergencyCallOptions)||void 0===G?void 0:G.countryCode.length)>_t&&logErrorAndThrow("EmergencyCountryCode is invalid, max length is 10",ne,this.logger)}sendOrientationChangeEvent(F,B=!1){var G,W;if(null===(W=null===(G=this._callAgent)||void 0===G?void 0:G._calls)||void 0===W?void 0:W.length)try{this._telemetryLogManager.sendEvent({name:Mu.acs_calling_orientation_changed,tenant:ft,properties:{orientation:F,isInitial:B}})}catch(F){this.logger.debug("Unable to send orientation change telemtery")}}sendInitialOrientation(){let F=screen.orientation&&screen.orientation.type;F||(F=this.getOrientationBasedOnWindowSize()),this.sendOrientationChangeEvent(F,!0)}hangupCalls(){var F;try{"Mobile"===getBrowserInfo().formFactor&&getAcsEcsConfig().calling.hangUpCallOnPageHide&&(null===(F=this._callAgent)||void 0===F||F.calls.forEach((F=>F.hangUp())))}catch(F){try{this.logger.error(`Unable to hangup call on page hide due to ${JSON.stringify(F)}`)}catch(F){this.logger.error("Unable to hangup call on page hide due to unknown error")}}}sendPageVisibilityInfoEvent(F,B){var G,W;if(null===(W=null===(G=this._callAgent)||void 0===G?void 0:G._calls)||void 0===W?void 0:W.length)try{this._telemetryLogManager.sendEvent({name:Mu.acs_calling_page_hidden,tenant:ft,properties:{eventName:F,pageHidden:B}})}catch(F){this.logger.debug("Unable to send page hide telemtery")}}}__decorate$j([loggerProperty,__metadata$j("design:type",Object)],CallClient.prototype,"logger",void 0),__decorate$j([syncOperation(ye.GetSDKVersion),__metadata$j("design:type",Function),__metadata$j("design:paramtypes",[]),__metadata$j("design:returntype",String)],CallClient.prototype,"getSDKVersion",null),__decorate$j([syncOperation(ye.Feature),__metadata$j("design:type",Function),__metadata$j("design:paramtypes",[Object]),__metadata$j("design:returntype","function"==typeof(Qh="undefined"!=typeof TFeature&&TFeature)?Qh:Object)],CallClient.prototype,"feature",null),__decorate$j([asyncOperation(ye.CreateCallAgent),__metadata$j("design:type",Function),__metadata$j("design:paramtypes",[Object,Object]),__metadata$j("design:returntype",Promise)],CallClient.prototype,"createCallAgent",null),__decorate$j([asyncOperation(ye.CreateTeamsCallAgent),__metadata$j("design:type",Function),__metadata$j("design:paramtypes",[Object,Object]),__metadata$j("design:returntype",Promise)],CallClient.prototype,"createTeamsCallAgent",null),__decorate$j([asyncOperation(ye.GetDeviceManager),__metadata$j("design:type",Function),__metadata$j("design:paramtypes",[]),__metadata$j("design:returntype",Promise)],CallClient.prototype,"getDeviceManager",null),__decorate$j([asyncOperation(ye.GetEnvironmentInfo),__metadata$j("design:type",Function),__metadata$j("design:paramtypes",[]),__metadata$j("design:returntype",Promise)],CallClient.prototype,"getEnvironmentInfo",null);var __decorate$k=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$k=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$u=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))},__rest=function(F,B){var G={};for(var W in F)Object.prototype.hasOwnProperty.call(F,W)&&B.indexOf(W)<0&&(G[W]=F[W]);if(null!=F&&"function"==typeof Object.getOwnPropertySymbols){var z=0;for(W=Object.getOwnPropertySymbols(F);z<W.length;z++)B.indexOf(W[z])<0&&Object.prototype.propertyIsEnumerable.call(F,W[z])&&(G[W[z]]=F[W[z]])}return G};let $h=1;class RemoteStreamRenderer{constructor(F,B,G,W,z,K){this._target=F,this._viewId=B,this._videoStream=G,this._onDisposedCallback=z,this._eventEmitter=new Jt.EventEmitter,this._isRendering=!1,this._scalingMode="Stretch",this._isMirrored=!1,this._size={height:0,width:0},this._disposed=!1,this._handleTsRendererChanged=F=>{var B;if(this.logger.debug(`rendering state is ${this._isRendering}, changed to ${null===(B=this._tsRenderer)||void 0===B?void 0:B.isRendering}`),this._tsRenderer)if(this._tsRenderer.isRendering!==this._isRendering&&(this._isRendering=this._tsRenderer.isRendering,this._videoStream.updateIsReceiving(),this._isRendering&&this._renderingDeferred&&this._renderingDeferred.isPending()&&this._renderingDeferred.resolve(),F.log(`isRendering change to ${this._isRendering}`)),this._tsRenderer.isRendering){const F=this._tsRenderer.streamSize.height,B=this._tsRenderer.streamSize.width;F===this._size.height&&B===this._size.width||(this._size.height=F,this._size.width=B,this._videoStream.updateSize())}else this._size.height=0,this._size.width=0,this._videoStream.updateSize();this.sendRendererTelemetry()},this.sendRendererTelemetry=()=>{var F,B;if(this._tsRenderer)try{const G={isRendering:this._tsRenderer.isRendering,streamWidth:this._tsRenderer.streamSize.width,streamHeight:this._tsRenderer.streamSize.height,isVideoAttached:this._target.isConnected,rendererWidth:null===(F=this._target)||void 0===F?void 0:F.offsetWidth,rendererHeight:null===(B=this._target)||void 0===B?void 0:B.offsetHeight};if(this.previousStats){if(shallowEqual(this.previousStats,G))return}else this.previousStats=G;this.previousStats=G;const W=this._videoStream.getStreamMetadata(),{callId:z,localParticipantId:K,isDisposed:J,viewIdsRegistered:Q,height:Y,width:$}=W,X=__rest(W,["callId","localParticipantId","isDisposed","viewIdsRegistered","height","width"]),Z=Object.assign(Object.assign(Object.assign({},G),X),{viewId:this._viewId,disposed:this._disposed});this._videoStream.call.stats.recordEvent({name:Ou.remote_view,callId:z,localParticipantId:K,data:Z})}catch(F){}},this._unsubscribeAvailabilityCallback=()=>{var F;this._availableCallback&&("RemoteVideoStreamInternal"===this._videoStream.kind&&(null===(F=this._videoStream)||void 0===F||F.off("isAvailableChanged",this._availableCallback)),this._availableCallback=void 0)},this._disposeTsRendererChangedObservable=()=>{this._tsRendererChanged&&(this._tsRendererChanged.dispose(),this._tsRendererChanged=void 0)},this._attemptToDisposeTsRenderer=()=>{var F;if(this.logger.debug("attempt to dispose underlying renderer"),this._tsRenderer){this.logger.debug("disposing underlying renderer");try{null===(F=this._tsRenderer)||void 0===F||F.dispose(),this._tsRenderer=void 0}catch(F){this.logger.warn(`tsRenderer dispose failed with ${F.message} error`)}}},this.logger=W.createChild("RemoteStreamRenderer"+$h++),this.logger.log("created"),void 0!==(null==K?void 0:K.scalingMode)&&(this._scalingMode=K.scalingMode),void 0!==(null==K?void 0:K.isMirrored)&&(this._isMirrored=K.isMirrored)}get isRendering(){return this._isRendering}get scalingMode(){return this._scalingMode}get isMirrored(){return this._isMirrored}get target(){return this._target}get viewId(){return this._viewId}get size(){return{height:this._size.height,width:this._size.width}}start(){return __awaiter$u(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(Me.Start);if(this._disposed)throw this.logger.warn("already disposed"),new CallingCommunicationError({message:"Failed to start stream, already disposed",code:ae});try{return F.info(`scalingMode=${toTsScalingMode(this._scalingMode)}`),this._videoStream.registerRenderer(this),this._renderingDeferred=defer$1(),this._renderingDeferred.promise.catch(noop),"RemoteVideoStreamInternal"===this._videoStream.kind&&(this._availableCallback=()=>{var B,G;"RemoteVideoStreamInternal"!==this._videoStream.kind||this._videoStream.isAvailable||(F.warn("stream isAvailable changed to false, attempting to reject operation"),(null===(B=this._renderingDeferred)||void 0===B?void 0:B.isPending())&&!this._disposed&&(null===(G=this._renderingDeferred)||void 0===G||G.reject(new CallingCommunicationError({message:"Failed to start stream, stream became unavailable",code:oe}))))},this._videoStream.on("isAvailableChanged",this._availableCallback)),this._videoStream.tsStream.start(this._target,{scalingMode:toTsScalingMode(this._scalingMode),transparent:!1}).then((B=>{var G;if(this._isMirrored&&(this._target.style.transform="rotateY(180deg)",this._target.style.webkitTransform="rotateY(180deg)"),this._tsRenderer=B,this.logger.info("subscribed to video, waiting for the first frame"),this._disposed)throw this.logger.warn("already disposed, dispose underlying renderer"),this._attemptToDisposeTsRenderer(),new CallingCommunicationError({message:"Failed to start stream, already disposed",code:ae});this.logger.info(`current state of rendering is ${this._tsRenderer.isRendering}`),this.sendRendererTelemetry(),-1!==getAcsEcsConfig().rendering.remoteVideo.createViewTimeout&&setTimeout((()=>{var F;if(null===(F=this._renderingDeferred)||void 0===F?void 0:F.isPending())try{this._renderingDeferred.reject(new CallingCommunicationError({message:"Failed to render stream, timeout",code:se}))}catch(F){}}),getAcsEcsConfig().rendering.remoteVideo.createViewTimeout),this._tsRendererChanged=this._tsRenderer.changed((()=>this._handleTsRendererChanged(F))),this._tsRenderer.isRendering&&(null===(G=this._renderingDeferred)||void 0===G?void 0:G.isPending())&&(this._isRendering=!0,this._videoStream.updateIsReceiving(),this._renderingDeferred.resolve())})).catch((F=>{var B;if(this.logger.info("Failed to subscribe to video"),null===(B=this._renderingDeferred)||void 0===B?void 0:B.isPending()){const B=new CallingCommunicationError({message:"Failed to start stream, fail to subscribe",code:ue},F);this._renderingDeferred.reject(B)}})),yield this._renderingDeferred.promise,this._unsubscribeAvailabilityCallback(),getAcsEcsConfig().rendering.remoteVideo.forceCheckIfVideoWasAttachedToDom&&this._checkIfVideoWasAttachedToDom(),this}catch(F){this.logger.warn(`Failed to render, message=${F}`);try{this.dispose()}catch(F){this.logger.warn(`dispose failed with ${F.message} error`)}throw new CallingCommunicationError({message:"Failed to start stream, internal error",code:ue},F)}}))}setScalingMode(F){return __awaiter$u(this,void 0,void 0,(function*(){if(!this._tsRenderer)throw new CallingCommunicationError({message:"Failed to change scaling mode",code:ue});yield this._tsRenderer.setScalingMode(toTsScalingMode(F)),this._scalingMode=F}))}dispose(F=!1){var B;if(this._disposed)throw new CallingCommunicationError({message:"Failed to dispose stream, already disposed",code:oe});this._disposed=!0,this._disposeTsRendererChangedObservable(),this._unsubscribeAvailabilityCallback(),this._attemptToDisposeTsRenderer(),(null===(B=this._renderingDeferred)||void 0===B?void 0:B.isPending())&&this._renderingDeferred.reject(new CallingCommunicationError({message:"Failed to start stream, disposing stream",code:ae})),this._target&&this._target.remove();try{F&&this._onDisposedCallback()}catch(F){this.logger.debug(`dispose callback failed with ${F.message} error`)}this._videoStream.unregisterRenderer(this),this._videoStream.updateSize(),this._videoStream.updateIsReceiving(),this._eventEmitter.removeAllListeners(),this._renderingDeferred=void 0}_checkIfVideoWasAttachedToDom(){if(getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_poll){let F=getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_intervalMaxTries;const check=()=>{this._target.isConnected||F<=0?this.sendRendererTelemetry():(F--,F>=0&&setTimeout((()=>check),getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_intervalTime))};check()}else setTimeout((()=>{this._target.isConnected&&this.sendRendererTelemetry()}),getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_timeout)}}__decorate$k([loggerProperty,__metadata$k("design:type",Object)],RemoteStreamRenderer.prototype,"logger",void 0),__decorate$k([asyncOperation(Me.Start),__metadata$k("design:type",Function),__metadata$k("design:paramtypes",[]),__metadata$k("design:returntype",Promise)],RemoteStreamRenderer.prototype,"start",null),__decorate$k([syncOperation(Me.Dispose),__metadata$k("design:type",Function),__metadata$k("design:paramtypes",[Object]),__metadata$k("design:returntype",void 0)],RemoteStreamRenderer.prototype,"dispose",null);var __decorate$l=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$l=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$v=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class LocalStreamRenderer{constructor(F,B,G,W,z){this._target=F,this._videoStream=B,this._onDisposed=W,this._eventEmitter=new Jt.EventEmitter,this._isRendering=!1,this._scalingMode="Stretch",this._isMirrored=!0,this._disposed=!1,this.logger=G.createChild("LocalStreamRenderer"),this.logger.log("created"),void 0!==(null==z?void 0:z.scalingMode)&&(this._scalingMode=z.scalingMode),void 0!==(null==z?void 0:z.isMirrored)&&(this._isMirrored=z.isMirrored)}get isRendering(){return this._isRendering}get scalingMode(){return this._scalingMode}get isMirrored(){return this._isMirrored}get target(){return this._target}on(F,B){this._eventEmitter.on(F,B)}off(F,B){this._eventEmitter.off(F,B)}start(){return __awaiter$v(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(Me.Start);try{F.info("attempting to select new device as a source");const B=this._videoStream.source.deviceManager.getTsDeviceManager();return B.selectDevices({camera:this._videoStream.source.id}),F.info("device selected"),F.info("creating preview"),this._tsRenderer=yield B.createPreview(this._target,{kind:"camera"},{scalingMode:toTsScalingMode(this._scalingMode),transparent:!1,ignoreMirroring:!1,disposeRendererWhenStreamisNotAvailable:()=>!0}),this._isMirrored&&(this._target.style.transform="rotateY(180deg)",this._target.style.webkitTransform="rotateY(180deg)"),this}catch(B){this.dispose();throw handleVideoOperationFailure(F,B)}}))}setScalingMode(F){if(!this._tsRenderer)throw new CallingCommunicationError({message:"Failed to change scaling mode",code:ne});this._tsRenderer.setScalingMode(toTsScalingMode(F)),this._scalingMode=F}dispose(){this._disposed||(this._tsRenderer&&(this.logger.log("dispose"),this._tsRenderer.dispose(),this._tsRenderer=void 0),this._target.remove(),this._onDisposed&&this._onDisposed(this),this._eventEmitter.removeAllListeners(),this._disposed=!0)}}__decorate$l([loggerProperty,__metadata$l("design:type",Object)],LocalStreamRenderer.prototype,"logger",void 0),__decorate$l([asyncOperation(we.Start),__metadata$l("design:type",Function),__metadata$l("design:paramtypes",[]),__metadata$l("design:returntype",Promise)],LocalStreamRenderer.prototype,"start",null),__decorate$l([syncOperation(we.SetScalingMode),__metadata$l("design:type",Function),__metadata$l("design:paramtypes",[String]),__metadata$l("design:returntype",void 0)],LocalStreamRenderer.prototype,"setScalingMode",null),__decorate$l([syncOperation(we.Dispose),__metadata$l("design:type",Function),__metadata$l("design:paramtypes",[]),__metadata$l("design:returntype",void 0)],LocalStreamRenderer.prototype,"dispose",null);var __decorate$m=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$m=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$w=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};let Xh=1;class VideoStreamRendererViewImpl{constructor(F,B,G,W){if(this.videoStream=F,this._viewId=G,this.options=W,this._disposed=!1,this.attemptToDisposeStreamRenderer=()=>{this.logger.debug("attempt to dispose stream renderer");try{this._streamRenderer.dispose()}catch(F){this.logger.warn(`Failed to dispose stream renderer, message=${F.message}`)}},this._deleteActiveRemoteVideoStreamView=(F,B)=>{var G,W,z;if(null===(G=F.call.activeRemoteVideoStreamViews)||void 0===G?void 0:G.has(F.id)){let G=null===(W=F.call.activeRemoteVideoStreamViews)||void 0===W?void 0:W.get(F.id);null==G||G.delete(B),0==(null==G?void 0:G.size)&&(null===(z=F.call.activeRemoteVideoStreamViews)||void 0===z||z.delete(F.id))}},this.logger=B.createChild("VideoStreamRendererView"+Xh++),this.target=document.createElement("div"),this.target.style.width="100%",this.target.style.height="100%",this.videoStream instanceof RemoteVideoStreamImpl||this.videoStream instanceof LiveVideoStreamImpl)this._streamRenderer=new RemoteStreamRenderer(this.target,this._viewId,this.videoStream,this.logger,(()=>this.dispose),this.options);else{if(!(this.videoStream instanceof LocalVideoStream))throw new CallingCommunicationError({message:"Failed to create VideoStreamRendererView, videoStream must be either LocalVideoStream or RemoteVideoStream type",code:de});this._streamRenderer=new LocalStreamRenderer(this.target,this.videoStream,this.logger,(()=>this.dispose),this.options)}this._telemetryLogManager=this.videoStream.telemetryLogManager,this.logger.info("created")}get scalingMode(){return this._streamRenderer.scalingMode}get isMirrored(){return this._streamRenderer.isMirrored}render(){return __awaiter$w(this,void 0,void 0,(function*(){const F=this.logger.createFnLogger(this.videoStream instanceof RemoteVideoStreamImpl?be.RenderRemoteStream:be.RenderLocalStream);if(this._disposed)throw F.log("failed, stream disposed!"),new CallingCommunicationError({message:"Failed to render, stream disposed",code:oe});try{yield this._streamRenderer.start()}catch(B){F.error("failed");try{this.dispose()}catch(F){this.logger.warn(`Failed to dispose, message=${F.message}`)}throw B}}))}updateScalingMode(F){return __awaiter$w(this,void 0,void 0,(function*(){if(this._disposed)throw new CallingCommunicationError({message:"Failed to updateScalingMode, VideoStreamRendererView is disposed",code:oe});if("Crop"!==F&&"Fit"!==F&&"Stretch"!==F)throw new CallingCommunicationError({message:"Failed to updateScalingMode, wrong scalingMode value",code:ne});try{yield this._streamRenderer.setScalingMode(F)}catch(F){throw new CallingCommunicationError({message:"Failed to updateScalingMode, failed to update",code:ue},F)}}))}dispose(){var F;if(this._disposed)throw new CallingCommunicationError({message:"Failed to dispose, VideoStreamRendererView is disposed",code:oe});this._disposed=!0;const B=+new Date,G=generateGuid();try{this.sendDisposeViewEvent({eventName:Mu.acs_calling_dispose_view_attempt,correlationId:G,timestampInfo:{attemptTimestamp:B}}),this.videoStream instanceof RemoteVideoStreamImpl&&this._deleteActiveRemoteVideoStreamView(this.videoStream,this._viewId),this.attemptToDisposeStreamRenderer(),null===(F=this.target)||void 0===F||F.remove();const W=+new Date;this.sendDisposeViewEvent({eventName:Mu.acs_calling_dispose_view_success,correlationId:G,timestampInfo:{deltaTimeInMs:W-B}})}catch(F){const W=+new Date;throw this.sendDisposeViewEvent({eventName:Mu.acs_calling_dispose_view_failure,correlationId:G,timestampInfo:{deltaTimeInMS:W-B}},F),new CallingCommunicationError({message:"Failed to dispose view",code:ue},F)}}sendDisposeViewEvent(F,B){var G,W;try{let z;this.videoStream instanceof RemoteVideoStreamImpl&&(z=null===(G=this.videoStream)||void 0===G?void 0:G.getStreamMetadata()),this.videoStream instanceof LocalVideoStream&&(z=null===(W=this.videoStream)||void 0===W?void 0:W.getStreamMetadata());let K="string"==typeof(null==B?void 0:B.message)?null==B?void 0:B.message:"";F.eventName!==Mu.acs_calling_dispose_view_failure&&(K=""),this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:Object.assign(Object.assign({viewId:this._viewId,correlationId:F.correlationId,timestampInfo:F.timestampInfo},z),{failureReason:K})})}catch(F){this.logger.debug("Unable to send telemtery")}}}__decorate$m([loggerProperty,__metadata$m("design:type",Object)],VideoStreamRendererViewImpl.prototype,"logger",void 0),__decorate$m([asyncOperation(be.Render),__metadata$m("design:type",Function),__metadata$m("design:paramtypes",[]),__metadata$m("design:returntype",Promise)],VideoStreamRendererViewImpl.prototype,"render",null),__decorate$m([asyncOperation(be.UpdateScalingMode),__metadata$m("design:type",Function),__metadata$m("design:paramtypes",[String]),__metadata$m("design:returntype",Promise)],VideoStreamRendererViewImpl.prototype,"updateScalingMode",null),__decorate$m([syncOperation(be.Dispose),__metadata$m("design:type",Function),__metadata$m("design:paramtypes",[]),__metadata$m("design:returntype",void 0)],VideoStreamRendererViewImpl.prototype,"dispose",null);var __decorate$n=function(F,B,G,W){var z,K=arguments.length,J=K<3?B:null===W?W=Object.getOwnPropertyDescriptor(B,G):W;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)J=Reflect.decorate(F,B,G,W);else for(var Q=F.length-1;Q>=0;Q--)(z=F[Q])&&(J=(K<3?z(J):K>3?z(B,G,J):z(B,G))||J);return K>3&&J&&Object.defineProperty(B,G,J),J},__metadata$n=function(F,B){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(F,B)},__awaiter$x=function(F,B,G,W){function adopt(F){return F instanceof G?F:new G((function(B){B(F)}))}return new(G||(G=Promise))((function(G,z){function fulfilled(F){try{step(W.next(F))}catch(F){z(F)}}function rejected(F){try{step(W.throw(F))}catch(F){z(F)}}function step(F){F.done?G(F.value):adopt(F.value).then(fulfilled,rejected)}step((W=W.apply(F,B||[])).next())}))};class VideoStreamRenderer{constructor(F){this.size={height:0,width:0},this.views=new Map,this.disposed=!1,this._createViewStats={},this._attemptToDisposeView=F=>{try{null==F||F.dispose()}catch(F){this.logger.warn((null==F?void 0:F.message)||"Failed to dispose, unknown error")}},this._addActiveRemoteVideoStreamView=(F,B,G)=>{var W,z,K;if(null===(W=F.call.activeRemoteVideoStreamViews)||void 0===W?void 0:W.has(F.id)){let W=null===(z=F.call.activeRemoteVideoStreamViews)||void 0===z?void 0:z.get(F.id);W&&W.set(B,G)}else{let W=new Map;W.set(B,G),null===(K=F.call.activeRemoteVideoStreamViews)||void 0===K||K.set(F.id,W)}};const G=B.createClientLogger("ACS");if(this._videoStream=F,!(F instanceof LocalVideoStream||F instanceof RemoteVideoStreamImpl||F instanceof LiveVideoStreamImpl))throw new CallingCommunicationError({message:"Failed to create VideoStreamRenderer, videoStream must be either LocalVideoStream or RemoteVideoStream type",code:de});this._telemetryLogManager=F.telemetryLogManager,this.logger=new DefaultLogger(G,F instanceof LocalVideoStream?[()=>{var B;return`VideoStreamRenderer:LocalVideoStream:${ee.pii.Omit(null===(B=null==F?void 0:F.source)||void 0===B?void 0:B.id)}`}]:F instanceof RemoteVideoStreamImpl?[()=>`VideoStreamRenderer:RemoteVideoStream:${null==F?void 0:F.id}`]:[()=>`VideoStreamRenderer:LiveVideoStream:${null==F?void 0:F.id}`]),this.logger.info("created")}createView(F){var B,G,W,z,K;return __awaiter$x(this,void 0,void 0,(function*(){if(this.disposed)throw new CallingCommunicationError({message:"Failed to create view, VideoStreamRenderer is disposed",code:oe});const J=+new Date,Q=generateGuid(),Y=generateGuid();let $,X;try{if(this.sendCreateViewEvent({eventName:Mu.acs_calling_create_view_attempt,viewId:Q,correlationId:Y,timestampInfo:{attemptTimestamp:J}}),this._videoStream instanceof RemoteVideoStreamImpl&&(null===(B=getAcsEcsConfig())||void 0===B?void 0:B.calling.applyViewLimit)&&(null===(G=getMediaConfig())||void 0===G?void 0:G.numVideoChannelsGvc)){let F=getMediaConfig().numVideoChannelsGvc;if(!(null===(W=this._videoStream.call.activeRemoteVideoStreamViews)||void 0===W?void 0:W.has(this._videoStream.id))&&(null===(z=this._videoStream.call.activeRemoteVideoStreamViews)||void 0===z?void 0:z.size)>=F){const B=new CallingCommunicationError({message:`Failed to create view, maximum number of ${F} active RemoteVideoStream has been reached`,code:le}),G=+new Date;throw this.sendCreateViewEvent({eventName:Mu.acs_calling_create_view_failure,viewId:Q,correlationId:Y,timestampInfo:{deltaTimeInMs:G-J}},B),B}}(null===(K=getAcsEcsConfig())||void 0===K?void 0:K.rendering.remoteVideo.createViewSendMediaStats)&&this._videoStream instanceof RemoteVideoStreamImpl&&(this._createViewStats={},X=this._videoStream.call.feature(vp.MediaStats).createCollector(),X.on("sampleReported",(F=>{const B=this._videoStream.id;collectMediaStatsForCreateView(this._createViewStats,F,B)}))),$=new VideoStreamRendererViewImpl(this._videoStream,this.logger,Q,F),this.views.set(Q,$),yield $.render(),this._videoStream instanceof RemoteVideoStreamImpl&&this._addActiveRemoteVideoStreamView(this._videoStream,Q,$);const Z=+new Date;return this.sendCreateViewEvent({eventName:Mu.acs_calling_create_view_success,viewId:Q,correlationId:Y,timestampInfo:{deltaTimeInMs:Z-J}}),null==X||X.dispose(),$}catch(F){this.views.delete(Q),this._attemptToDisposeView($),null==X||X.dispose();const B=+new Date;throw this.sendCreateViewEvent({eventName:Mu.acs_calling_create_view_failure,viewId:Q,correlationId:Y,timestampInfo:{deltaTimeInMs:B-J}},F),new CallingCommunicationError({message:"Failed to create view",code:ue},F)}}))}sendCreateViewEvent(F,B){var G,W,z,K,J,Q,Y,$,X,Z,ee;return __awaiter$x(this,void 0,void 0,(function*(){try{let te;te=this._videoStream instanceof RemoteVideoStreamImpl?null===(G=this._videoStream)||void 0===G?void 0:G.getStreamMetadata():null===(W=this._videoStream)||void 0===W?void 0:W.getStreamMetadata();let ne="string"==typeof(null==B?void 0:B.message)?null==B?void 0:B.message:"";F.eventName!==Mu.acs_calling_create_view_failure&&(ne="");let ie={},re={};if((null===(z=getAcsEcsConfig())||void 0===z?void 0:z.rendering.remoteVideo.createViewSendMediaStats)&&(F.eventName===Mu.acs_calling_create_view_failure||F.eventName===Mu.acs_calling_create_view_success)&&this._videoStream instanceof RemoteVideoStreamImpl){const B=this._videoStream.call.tsCall.getMediaSessionStats();ie={videoSubscriptionEvents:null===(K=null==B?void 0:B.extensions)||void 0===K?void 0:K.Video_SubscriptionEvents,screenSharingSubscriptionEvents:null===(J=null==B?void 0:B.extensions)||void 0===J?void 0:J.Sharing_SubscriptionEvents,videoSendMaxCapabilities:null===(Q=null==B?void 0:B.extensions)||void 0===Q?void 0:Q.Video_send_MaxCapabilities,screenSharingSendMaxCapabilities:null===(Y=null==B?void 0:B.extensions)||void 0===Y?void 0:Y.Sharing_send_MaxCapabilities,iceConnectedStateTime:null===($=null==B?void 0:B.metrics)||void 0===$?void 0:$.IceConnectedStateTime,relayCandidate:null===(X=null==B?void 0:B.extensions)||void 0===X?void 0:X.RelayCandidate,videoRecvTimeToFirstFrame:null===(Z=null==B?void 0:B.extensions)||void 0===Z?void 0:Z.Video_recv_TimeToFirstFrame,screenSharingRecvTimeToFirstFrame:null===(ee=null==B?void 0:B.extensions)||void 0===ee?void 0:ee.Sharing_recv_TimeToFirstFrame},F.eventName===Mu.acs_calling_create_view_failure&&"string"==typeof ne&&ne.includes("timeout")&&(re=this._createViewStats)}this._telemetryLogManager.sendEvent({name:F.eventName,tenant:ft,properties:Object.assign(Object.assign({viewId:F.viewId,correlationId:F.correlationId,timestampInfo:F.timestampInfo},te),{failureReason:ne,additionalProperties:ie,stats:re})})}catch(F){this.logger.debug("Unable to send telemtery")}}))}dispose(){if(this.disposed)throw new CallingCommunicationError({message:"Failed to dispose, VideoStreamRendererView is already disposed",code:oe});this.disposed=!0,this.views.forEach(this._attemptToDisposeView),this.views.clear()}}__decorate$n([loggerProperty,__metadata$n("design:type",Object)],VideoStreamRenderer.prototype,"logger",void 0),__decorate$n([asyncOperation(Ie.CreateView),__metadata$n("design:type",Function),__metadata$n("design:paramtypes",[Object]),__metadata$n("design:returntype",Promise)],VideoStreamRenderer.prototype,"createView",null),__decorate$n([syncOperation(Ie.Dispose),__metadata$n("design:type",Function),__metadata$n("design:paramtypes",[]),__metadata$n("design:returntype",void 0)],VideoStreamRenderer.prototype,"dispose",null),F.CallClient=CallClient,F.Features=vp,F.LocalAudioStream=LocalAudioStream,F.LocalVideoStream=LocalVideoStream,F.VideoStreamRenderer=VideoStreamRenderer,Object.defineProperty(F,"__esModule",{value:!0})}));
